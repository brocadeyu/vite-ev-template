/**
 * @license
 * Cesium - https://github.com/CesiumGS/cesium
 * Version 1.105.2
 *
 * Copyright 2011-2022 Cesium Contributors
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * Columbus View (Pat. Pend.)
 *
 * Portions licensed separately.
 * See https://github.com/CesiumGS/cesium/blob/main/LICENSE.md for full licensing details.
 */

var Yx=Object.create;var Yp=Object.defineProperty;var Xx=Object.getOwnPropertyDescriptor;var jx=Object.getOwnPropertyNames;var Kx=Object.getPrototypeOf,Qx=Object.prototype.hasOwnProperty;var Au=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports);var Zx=(e,t,r,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let i of jx(t))!Qx.call(e,i)&&i!==r&&Yp(e,i,{get:()=>t[i],enumerable:!(n=Xx(t,i))||n.enumerable});return e};var dh=(e,t,r)=>(r=e!=null?Yx(Kx(e)):{},Zx(t||!e||!e.__esModule?Yp(r,"default",{value:e,enumerable:!0}):r,e));var Xp=Au((bo,wo)=>{/*! https://mths.be/punycode v1.4.0 by @mathias */(function(e){var t=typeof bo=="object"&&bo&&!bo.nodeType&&bo,r=typeof wo=="object"&&wo&&!wo.nodeType&&wo,n=typeof global=="object"&&global;(n.global===n||n.window===n||n.self===n)&&(e=n);var i,s=2147483647,a=36,o=1,u=26,f=38,l=700,c=72,h=128,d="-",m=/^xn--/,g=/[^\x20-\x7E]/,p=/[\x2E\u3002\uFF0E\uFF61]/g,v={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},_=a-o,y=Math.floor,x=String.fromCharCode,E;function S(D){throw new RangeError(v[D])}function I(D,O){for(var U=D.length,q=[];U--;)q[U]=O(D[U]);return q}function P(D,O){var U=D.split("@"),q="";U.length>1&&(q=U[0]+"@",D=U[1]),D=D.replace(p,".");var Y=D.split("."),W=I(Y,O).join(".");return q+W}function w(D){for(var O=[],U=0,q=D.length,Y,W;U<q;)Y=D.charCodeAt(U++),Y>=55296&&Y<=56319&&U<q?(W=D.charCodeAt(U++),(W&64512)==56320?O.push(((Y&1023)<<10)+(W&1023)+65536):(O.push(Y),U--)):O.push(Y);return O}function N(D){return I(D,function(O){var U="";return O>65535&&(O-=65536,U+=x(O>>>10&1023|55296),O=56320|O&1023),U+=x(O),U}).join("")}function B(D){return D-48<10?D-22:D-65<26?D-65:D-97<26?D-97:a}function C(D,O){return D+22+75*(D<26)-((O!=0)<<5)}function b(D,O,U){var q=0;for(D=U?y(D/l):D>>1,D+=y(D/O);D>_*u>>1;q+=a)D=y(D/_);return y(q+(_+1)*D/(D+f))}function T(D){var O=[],U=D.length,q,Y=0,W=h,K=c,re,ce,Se,de,Ae,ye,Ie,$,De;for(re=D.lastIndexOf(d),re<0&&(re=0),ce=0;ce<re;++ce)D.charCodeAt(ce)>=128&&S("not-basic"),O.push(D.charCodeAt(ce));for(Se=re>0?re+1:0;Se<U;){for(de=Y,Ae=1,ye=a;Se>=U&&S("invalid-input"),Ie=B(D.charCodeAt(Se++)),(Ie>=a||Ie>y((s-Y)/Ae))&&S("overflow"),Y+=Ie*Ae,$=ye<=K?o:ye>=K+u?u:ye-K,!(Ie<$);ye+=a)De=a-$,Ae>y(s/De)&&S("overflow"),Ae*=De;q=O.length+1,K=b(Y-de,q,de==0),y(Y/q)>s-W&&S("overflow"),W+=y(Y/q),Y%=q,O.splice(Y++,0,W)}return N(O)}function A(D){var O,U,q,Y,W,K,re,ce,Se,de,Ae,ye=[],Ie,$,De,se;for(D=w(D),Ie=D.length,O=h,U=0,W=c,K=0;K<Ie;++K)Ae=D[K],Ae<128&&ye.push(x(Ae));for(q=Y=ye.length,Y&&ye.push(d);q<Ie;){for(re=s,K=0;K<Ie;++K)Ae=D[K],Ae>=O&&Ae<re&&(re=Ae);for($=q+1,re-O>y((s-U)/$)&&S("overflow"),U+=(re-O)*$,O=re,K=0;K<Ie;++K)if(Ae=D[K],Ae<O&&++U>s&&S("overflow"),Ae==O){for(ce=U,Se=a;de=Se<=W?o:Se>=W+u?u:Se-W,!(ce<de);Se+=a)se=ce-de,De=a-de,ye.push(x(C(de+se%De,0))),ce=y(se/De);ye.push(x(C(ce,0))),W=b(U,$,q==Y),U=0,++q}++U,++O}return ye.join("")}function R(D){return P(D,function(O){return m.test(O)?T(O.slice(4).toLowerCase()):O})}function F(D){return P(D,function(O){return g.test(O)?"xn--"+A(O):O})}if(i={version:"1.3.2",ucs2:{decode:w,encode:N},decode:T,encode:A,toASCII:F,toUnicode:R},typeof define=="function"&&typeof define.amd=="object"&&define.amd)define("punycode",function(){return i});else if(t&&r)if(wo.exports==t)r.exports=i;else for(E in i)i.hasOwnProperty(E)&&(t[E]=i[E]);else e.punycode=i})(bo)});var Kp=Au((jp,ul)=>{/*!
 * URI.js - Mutating URLs
 * IPv6 Support
 *
 * Version: 1.19.11
 *
 * Author: Rodney Rehm
 * Web: http://medialize.github.io/URI.js/
 *
 * Licensed under
 *   MIT License http://www.opensource.org/licenses/mit-license
 *
 */(function(e,t){"use strict";typeof ul=="object"&&ul.exports?ul.exports=t():typeof define=="function"&&define.amd?define(t):e.IPv6=t(e)})(jp,function(e){"use strict";var t=e&&e.IPv6;function r(i){var s=i.toLowerCase(),a=s.split(":"),o=a.length,u=8;a[0]===""&&a[1]===""&&a[2]===""?(a.shift(),a.shift()):a[0]===""&&a[1]===""?a.shift():a[o-1]===""&&a[o-2]===""&&a.pop(),o=a.length,a[o-1].indexOf(".")!==-1&&(u=7);var f;for(f=0;f<o&&a[f]!=="";f++);if(f<u)for(a.splice(f,1,"0000");a.length<u;)a.splice(f,0,"0000");for(var l,c=0;c<u;c++){l=a[c].split("");for(var h=0;h<3&&(l[0]==="0"&&l.length>1);h++)l.splice(0,1);a[c]=l.join("")}var d=-1,m=0,g=0,p=-1,v=!1;for(c=0;c<u;c++)v?a[c]==="0"?g+=1:(v=!1,g>m&&(d=p,m=g)):a[c]==="0"&&(v=!0,p=c,g=1);g>m&&(d=p,m=g),m>1&&a.splice(d,m,""),o=a.length;var _="";for(a[0]===""&&(_=":"),c=0;c<o&&(_+=a[c],c!==o-1);c++)_+=":";return a[o-1]===""&&(_+=":"),_}function n(){return e.IPv6===this&&(e.IPv6=t),this}return{best:r,noConflict:n}})});var Zp=Au((Qp,fl)=>{/*!
 * URI.js - Mutating URLs
 * Second Level Domain (SLD) Support
 *
 * Version: 1.19.11
 *
 * Author: Rodney Rehm
 * Web: http://medialize.github.io/URI.js/
 *
 * Licensed under
 *   MIT License http://www.opensource.org/licenses/mit-license
 *
 */(function(e,t){"use strict";typeof fl=="object"&&fl.exports?fl.exports=t():typeof define=="function"&&define.amd?define(t):e.SecondLevelDomains=t(e)})(Qp,function(e){"use strict";var t=e&&e.SecondLevelDomains,r={list:{ac:" com gov mil net org ",ae:" ac co gov mil name net org pro sch ",af:" com edu gov net org ",al:" com edu gov mil net org ",ao:" co ed gv it og pb ",ar:" com edu gob gov int mil net org tur ",at:" ac co gv or ",au:" asn com csiro edu gov id net org ",ba:" co com edu gov mil net org rs unbi unmo unsa untz unze ",bb:" biz co com edu gov info net org store tv ",bh:" biz cc com edu gov info net org ",bn:" com edu gov net org ",bo:" com edu gob gov int mil net org tv ",br:" adm adv agr am arq art ato b bio blog bmd cim cng cnt com coop ecn edu eng esp etc eti far flog fm fnd fot fst g12 ggf gov imb ind inf jor jus lel mat med mil mus net nom not ntr odo org ppg pro psc psi qsl rec slg srv tmp trd tur tv vet vlog wiki zlg ",bs:" com edu gov net org ",bz:" du et om ov rg ",ca:" ab bc mb nb nf nl ns nt nu on pe qc sk yk ",ck:" biz co edu gen gov info net org ",cn:" ac ah bj com cq edu fj gd gov gs gx gz ha hb he hi hl hn jl js jx ln mil net nm nx org qh sc sd sh sn sx tj tw xj xz yn zj ",co:" com edu gov mil net nom org ",cr:" ac c co ed fi go or sa ",cy:" ac biz com ekloges gov ltd name net org parliament press pro tm ",do:" art com edu gob gov mil net org sld web ",dz:" art asso com edu gov net org pol ",ec:" com edu fin gov info med mil net org pro ",eg:" com edu eun gov mil name net org sci ",er:" com edu gov ind mil net org rochest w ",es:" com edu gob nom org ",et:" biz com edu gov info name net org ",fj:" ac biz com info mil name net org pro ",fk:" ac co gov net nom org ",fr:" asso com f gouv nom prd presse tm ",gg:" co net org ",gh:" com edu gov mil org ",gn:" ac com gov net org ",gr:" com edu gov mil net org ",gt:" com edu gob ind mil net org ",gu:" com edu gov net org ",hk:" com edu gov idv net org ",hu:" 2000 agrar bolt casino city co erotica erotika film forum games hotel info ingatlan jogasz konyvelo lakas media news org priv reklam sex shop sport suli szex tm tozsde utazas video ",id:" ac co go mil net or sch web ",il:" ac co gov idf k12 muni net org ",in:" ac co edu ernet firm gen gov i ind mil net nic org res ",iq:" com edu gov i mil net org ",ir:" ac co dnssec gov i id net org sch ",it:" edu gov ",je:" co net org ",jo:" com edu gov mil name net org sch ",jp:" ac ad co ed go gr lg ne or ",ke:" ac co go info me mobi ne or sc ",kh:" com edu gov mil net org per ",ki:" biz com de edu gov info mob net org tel ",km:" asso com coop edu gouv k medecin mil nom notaires pharmaciens presse tm veterinaire ",kn:" edu gov net org ",kr:" ac busan chungbuk chungnam co daegu daejeon es gangwon go gwangju gyeongbuk gyeonggi gyeongnam hs incheon jeju jeonbuk jeonnam k kg mil ms ne or pe re sc seoul ulsan ",kw:" com edu gov net org ",ky:" com edu gov net org ",kz:" com edu gov mil net org ",lb:" com edu gov net org ",lk:" assn com edu gov grp hotel int ltd net ngo org sch soc web ",lr:" com edu gov net org ",lv:" asn com conf edu gov id mil net org ",ly:" com edu gov id med net org plc sch ",ma:" ac co gov m net org press ",mc:" asso tm ",me:" ac co edu gov its net org priv ",mg:" com edu gov mil nom org prd tm ",mk:" com edu gov inf name net org pro ",ml:" com edu gov net org presse ",mn:" edu gov org ",mo:" com edu gov net org ",mt:" com edu gov net org ",mv:" aero biz com coop edu gov info int mil museum name net org pro ",mw:" ac co com coop edu gov int museum net org ",mx:" com edu gob net org ",my:" com edu gov mil name net org sch ",nf:" arts com firm info net other per rec store web ",ng:" biz com edu gov mil mobi name net org sch ",ni:" ac co com edu gob mil net nom org ",np:" com edu gov mil net org ",nr:" biz com edu gov info net org ",om:" ac biz co com edu gov med mil museum net org pro sch ",pe:" com edu gob mil net nom org sld ",ph:" com edu gov i mil net ngo org ",pk:" biz com edu fam gob gok gon gop gos gov net org web ",pl:" art bialystok biz com edu gda gdansk gorzow gov info katowice krakow lodz lublin mil net ngo olsztyn org poznan pwr radom slupsk szczecin torun warszawa waw wroc wroclaw zgora ",pr:" ac biz com edu est gov info isla name net org pro prof ",ps:" com edu gov net org plo sec ",pw:" belau co ed go ne or ",ro:" arts com firm info nom nt org rec store tm www ",rs:" ac co edu gov in org ",sb:" com edu gov net org ",sc:" com edu gov net org ",sh:" co com edu gov net nom org ",sl:" com edu gov net org ",st:" co com consulado edu embaixada gov mil net org principe saotome store ",sv:" com edu gob org red ",sz:" ac co org ",tr:" av bbs bel biz com dr edu gen gov info k12 name net org pol tel tsk tv web ",tt:" aero biz cat co com coop edu gov info int jobs mil mobi museum name net org pro tel travel ",tw:" club com ebiz edu game gov idv mil net org ",mu:" ac co com gov net or org ",mz:" ac co edu gov org ",na:" co com ",nz:" ac co cri geek gen govt health iwi maori mil net org parliament school ",pa:" abo ac com edu gob ing med net nom org sld ",pt:" com edu gov int net nome org publ ",py:" com edu gov mil net org ",qa:" com edu gov mil net org ",re:" asso com nom ",ru:" ac adygeya altai amur arkhangelsk astrakhan bashkiria belgorod bir bryansk buryatia cbg chel chelyabinsk chita chukotka chuvashia com dagestan e-burg edu gov grozny int irkutsk ivanovo izhevsk jar joshkar-ola kalmykia kaluga kamchatka karelia kazan kchr kemerovo khabarovsk khakassia khv kirov koenig komi kostroma kranoyarsk kuban kurgan kursk lipetsk magadan mari mari-el marine mil mordovia mosreg msk murmansk nalchik net nnov nov novosibirsk nsk omsk orenburg org oryol penza perm pp pskov ptz rnd ryazan sakhalin samara saratov simbirsk smolensk spb stavropol stv surgut tambov tatarstan tom tomsk tsaritsyn tsk tula tuva tver tyumen udm udmurtia ulan-ude vladikavkaz vladimir vladivostok volgograd vologda voronezh vrn vyatka yakutia yamal yekaterinburg yuzhno-sakhalinsk ",rw:" ac co com edu gouv gov int mil net ",sa:" com edu gov med net org pub sch ",sd:" com edu gov info med net org tv ",se:" a ac b bd c d e f g h i k l m n o org p parti pp press r s t tm u w x y z ",sg:" com edu gov idn net org per ",sn:" art com edu gouv org perso univ ",sy:" com edu gov mil net news org ",th:" ac co go in mi net or ",tj:" ac biz co com edu go gov info int mil name net nic org test web ",tn:" agrinet com defense edunet ens fin gov ind info intl mincom nat net org perso rnrt rns rnu tourism ",tz:" ac co go ne or ",ua:" biz cherkassy chernigov chernovtsy ck cn co com crimea cv dn dnepropetrovsk donetsk dp edu gov if in ivano-frankivsk kh kharkov kherson khmelnitskiy kiev kirovograd km kr ks kv lg lugansk lutsk lviv me mk net nikolaev od odessa org pl poltava pp rovno rv sebastopol sumy te ternopil uzhgorod vinnica vn zaporizhzhe zhitomir zp zt ",ug:" ac co go ne or org sc ",uk:" ac bl british-library co cym gov govt icnet jet lea ltd me mil mod national-library-scotland nel net nhs nic nls org orgn parliament plc police sch scot soc ",us:" dni fed isa kids nsn ",uy:" com edu gub mil net org ",ve:" co com edu gob info mil net org web ",vi:" co com k12 net org ",vn:" ac biz com edu gov health info int name net org pro ",ye:" co com gov ltd me net org plc ",yu:" ac co edu gov org ",za:" ac agric alt bourse city co cybernet db edu gov grondar iaccess imt inca landesign law mil net ngo nis nom olivetti org pix school tm web ",zm:" ac co com edu gov net org sch ",com:"ar br cn de eu gb gr hu jpn kr no qc ru sa se uk us uy za ",net:"gb jp se uk ",org:"ae",de:"com "},has:function(n){var i=n.lastIndexOf(".");if(i<=0||i>=n.length-1)return!1;var s=n.lastIndexOf(".",i-1);if(s<=0||s>=i-1)return!1;var a=r.list[n.slice(i+1)];return a?a.indexOf(" "+n.slice(s+1,i)+" ")>=0:!1},is:function(n){var i=n.lastIndexOf(".");if(i<=0||i>=n.length-1)return!1;var s=n.lastIndexOf(".",i-1);if(s>=0)return!1;var a=r.list[n.slice(i+1)];return a?a.indexOf(" "+n.slice(0,i)+" ")>=0:!1},get:function(n){var i=n.lastIndexOf(".");if(i<=0||i>=n.length-1)return null;var s=n.lastIndexOf(".",i-1);if(s<=0||s>=i-1)return null;var a=r.list[n.slice(i+1)];return!a||a.indexOf(" "+n.slice(s+1,i)+" ")<0?null:n.slice(s+1)},noConflict:function(){return e.SecondLevelDomains===this&&(e.SecondLevelDomains=t),this}};return r})});var mh=Au((Jp,ll)=>{/*!
 * URI.js - Mutating URLs
 *
 * Version: 1.19.11
 *
 * Author: Rodney Rehm
 * Web: http://medialize.github.io/URI.js/
 *
 * Licensed under
 *   MIT License http://www.opensource.org/licenses/mit-license
 *
 */(function(e,t){"use strict";typeof ll=="object"&&ll.exports?ll.exports=t(Xp(),Kp(),Zp()):typeof define=="function"&&define.amd?define(["./punycode","./IPv6","./SecondLevelDomains"],t):e.URI=t(e.punycode,e.IPv6,e.SecondLevelDomains,e)})(Jp,function(e,t,r,n){"use strict";var i=n&&n.URI;function s(C,b){var T=arguments.length>=1,A=arguments.length>=2;if(!(this instanceof s))return T?A?new s(C,b):new s(C):new s;if(C===void 0){if(T)throw new TypeError("undefined is not a valid argument for URI");typeof location<"u"?C=location.href+"":C=""}if(C===null&&T)throw new TypeError("null is not a valid argument for URI");return this.href(C),b!==void 0?this.absoluteTo(b):this}function a(C){return/^[0-9]+$/.test(C)}s.version="1.19.11";var o=s.prototype,u=Object.prototype.hasOwnProperty;function f(C){return C.replace(/([.*+?^=!:${}()|[\]\/\\])/g,"\\$1")}function l(C){return C===void 0?"Undefined":String(Object.prototype.toString.call(C)).slice(8,-1)}function c(C){return l(C)==="Array"}function h(C,b){var T={},A,R;if(l(b)==="RegExp")T=null;else if(c(b))for(A=0,R=b.length;A<R;A++)T[b[A]]=!0;else T[b]=!0;for(A=0,R=C.length;A<R;A++){var F=T&&T[C[A]]!==void 0||!T&&b.test(C[A]);F&&(C.splice(A,1),R--,A--)}return C}function d(C,b){var T,A;if(c(b)){for(T=0,A=b.length;T<A;T++)if(!d(C,b[T]))return!1;return!0}var R=l(b);for(T=0,A=C.length;T<A;T++)if(R==="RegExp"){if(typeof C[T]=="string"&&C[T].match(b))return!0}else if(C[T]===b)return!0;return!1}function m(C,b){if(!c(C)||!c(b)||C.length!==b.length)return!1;C.sort(),b.sort();for(var T=0,A=C.length;T<A;T++)if(C[T]!==b[T])return!1;return!0}function g(C){var b=/^\/+|\/+$/g;return C.replace(b,"")}s._parts=function(){return{protocol:null,username:null,password:null,hostname:null,urn:null,port:null,path:null,query:null,fragment:null,preventInvalidHostname:s.preventInvalidHostname,duplicateQueryParameters:s.duplicateQueryParameters,escapeQuerySpace:s.escapeQuerySpace}},s.preventInvalidHostname=!1,s.duplicateQueryParameters=!1,s.escapeQuerySpace=!0,s.protocol_expression=/^[a-z][a-z0-9.+-]*$/i,s.idn_expression=/[^a-z0-9\._-]/i,s.punycode_expression=/(xn--)/i,s.ip4_expression=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,s.ip6_expression=/^\s*((([0-9A-Fa-f]{1,4}:){7}([0-9A-Fa-f]{1,4}|:))|(([0-9A-Fa-f]{1,4}:){6}(:[0-9A-Fa-f]{1,4}|((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){5}(((:[0-9A-Fa-f]{1,4}){1,2})|:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){4}(((:[0-9A-Fa-f]{1,4}){1,3})|((:[0-9A-Fa-f]{1,4})?:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){3}(((:[0-9A-Fa-f]{1,4}){1,4})|((:[0-9A-Fa-f]{1,4}){0,2}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){2}(((:[0-9A-Fa-f]{1,4}){1,5})|((:[0-9A-Fa-f]{1,4}){0,3}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){1}(((:[0-9A-Fa-f]{1,4}){1,6})|((:[0-9A-Fa-f]{1,4}){0,4}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(:(((:[0-9A-Fa-f]{1,4}){1,7})|((:[0-9A-Fa-f]{1,4}){0,5}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))(%.+)?\s*$/,s.find_uri_expression=/\b((?:[a-z][\w-]+:(?:\/{1,3}|[a-z0-9%])|www\d{0,3}[.]|[a-z0-9.\-]+[.][a-z]{2,4}\/)(?:[^\s()<>]+|\(([^\s()<>]+|(\([^\s()<>]+\)))*\))+(?:\(([^\s()<>]+|(\([^\s()<>]+\)))*\)|[^\s`!()\[\]{};:'".,<>?«»“”‘’]))/ig,s.findUri={start:/\b(?:([a-z][a-z0-9.+-]*:\/\/)|www\.)/gi,end:/[\s\r\n]|$/,trim:/[`!()\[\]{};:'".,<>?«»“”„‘’]+$/,parens:/(\([^\)]*\)|\[[^\]]*\]|\{[^}]*\}|<[^>]*>)/g},s.leading_whitespace_expression=/^[\x00-\x20\u00a0\u1680\u2000-\u200a\u2028\u2029\u202f\u205f\u3000\ufeff]+/,s.ascii_tab_whitespace=/[\u0009\u000A\u000D]+/g,s.defaultPorts={http:"80",https:"443",ftp:"21",gopher:"70",ws:"80",wss:"443"},s.hostProtocols=["http","https"],s.invalid_hostname_characters=/[^a-zA-Z0-9\.\-:_]/,s.domAttributes={a:"href",blockquote:"cite",link:"href",base:"href",script:"src",form:"action",img:"src",area:"href",iframe:"src",embed:"src",source:"src",track:"src",input:"src",audio:"src",video:"src"},s.getDomAttribute=function(C){if(!(!C||!C.nodeName)){var b=C.nodeName.toLowerCase();if(!(b==="input"&&C.type!=="image"))return s.domAttributes[b]}};function p(C){return escape(C)}function v(C){return encodeURIComponent(C).replace(/[!'()*]/g,p).replace(/\*/g,"%2A")}s.encode=v,s.decode=decodeURIComponent,s.iso8859=function(){s.encode=escape,s.decode=unescape},s.unicode=function(){s.encode=v,s.decode=decodeURIComponent},s.characters={pathname:{encode:{expression:/%(24|26|2B|2C|3B|3D|3A|40)/ig,map:{"%24":"$","%26":"&","%2B":"+","%2C":",","%3B":";","%3D":"=","%3A":":","%40":"@"}},decode:{expression:/[\/\?#]/g,map:{"/":"%2F","?":"%3F","#":"%23"}}},reserved:{encode:{expression:/%(21|23|24|26|27|28|29|2A|2B|2C|2F|3A|3B|3D|3F|40|5B|5D)/ig,map:{"%3A":":","%2F":"/","%3F":"?","%23":"#","%5B":"[","%5D":"]","%40":"@","%21":"!","%24":"$","%26":"&","%27":"'","%28":"(","%29":")","%2A":"*","%2B":"+","%2C":",","%3B":";","%3D":"="}}},urnpath:{encode:{expression:/%(21|24|27|28|29|2A|2B|2C|3B|3D|40)/ig,map:{"%21":"!","%24":"$","%27":"'","%28":"(","%29":")","%2A":"*","%2B":"+","%2C":",","%3B":";","%3D":"=","%40":"@"}},decode:{expression:/[\/\?#:]/g,map:{"/":"%2F","?":"%3F","#":"%23",":":"%3A"}}}},s.encodeQuery=function(C,b){var T=s.encode(C+"");return b===void 0&&(b=s.escapeQuerySpace),b?T.replace(/%20/g,"+"):T},s.decodeQuery=function(C,b){C+="",b===void 0&&(b=s.escapeQuerySpace);try{return s.decode(b?C.replace(/\+/g,"%20"):C)}catch{return C}};var _={encode:"encode",decode:"decode"},y,x=function(C,b){return function(T){try{return s[b](T+"").replace(s.characters[C][b].expression,function(A){return s.characters[C][b].map[A]})}catch{return T}}};for(y in _)s[y+"PathSegment"]=x("pathname",_[y]),s[y+"UrnPathSegment"]=x("urnpath",_[y]);var E=function(C,b,T){return function(A){var R;T?R=function(U){return s[b](s[T](U))}:R=s[b];for(var F=(A+"").split(C),D=0,O=F.length;D<O;D++)F[D]=R(F[D]);return F.join(C)}};s.decodePath=E("/","decodePathSegment"),s.decodeUrnPath=E(":","decodeUrnPathSegment"),s.recodePath=E("/","encodePathSegment","decode"),s.recodeUrnPath=E(":","encodeUrnPathSegment","decode"),s.encodeReserved=x("reserved","encode"),s.parse=function(C,b){var T;return b||(b={preventInvalidHostname:s.preventInvalidHostname}),C=C.replace(s.leading_whitespace_expression,""),C=C.replace(s.ascii_tab_whitespace,""),T=C.indexOf("#"),T>-1&&(b.fragment=C.substring(T+1)||null,C=C.substring(0,T)),T=C.indexOf("?"),T>-1&&(b.query=C.substring(T+1)||null,C=C.substring(0,T)),C=C.replace(/^(https?|ftp|wss?)?:+[/\\]*/i,"$1://"),C=C.replace(/^[/\\]{2,}/i,"//"),C.substring(0,2)==="//"?(b.protocol=null,C=C.substring(2),C=s.parseAuthority(C,b)):(T=C.indexOf(":"),T>-1&&(b.protocol=C.substring(0,T)||null,b.protocol&&!b.protocol.match(s.protocol_expression)?b.protocol=void 0:C.substring(T+1,T+3).replace(/\\/g,"/")==="//"?(C=C.substring(T+3),C=s.parseAuthority(C,b)):(C=C.substring(T+1),b.urn=!0))),b.path=C,b},s.parseHost=function(C,b){C||(C=""),C=C.replace(/\\/g,"/");var T=C.indexOf("/"),A,R;if(T===-1&&(T=C.length),C.charAt(0)==="[")A=C.indexOf("]"),b.hostname=C.substring(1,A)||null,b.port=C.substring(A+2,T)||null,b.port==="/"&&(b.port=null);else{var F=C.indexOf(":"),D=C.indexOf("/"),O=C.indexOf(":",F+1);O!==-1&&(D===-1||O<D)?(b.hostname=C.substring(0,T)||null,b.port=null):(R=C.substring(0,T).split(":"),b.hostname=R[0]||null,b.port=R[1]||null)}return b.hostname&&C.substring(T).charAt(0)!=="/"&&(T++,C="/"+C),b.preventInvalidHostname&&s.ensureValidHostname(b.hostname,b.protocol),b.port&&s.ensureValidPort(b.port),C.substring(T)||"/"},s.parseAuthority=function(C,b){return C=s.parseUserinfo(C,b),s.parseHost(C,b)},s.parseUserinfo=function(C,b){var T=C,A=C.indexOf("\\");A!==-1&&(C=C.replace(/\\/g,"/"));var R=C.indexOf("/"),F=C.lastIndexOf("@",R>-1?R:C.length-1),D;return F>-1&&(R===-1||F<R)?(D=C.substring(0,F).split(":"),b.username=D[0]?s.decode(D[0]):null,D.shift(),b.password=D[0]?s.decode(D.join(":")):null,C=T.substring(F+1)):(b.username=null,b.password=null),C},s.parseQuery=function(C,b){if(!C)return{};if(C=C.replace(/&+/g,"&").replace(/^\?*&*|&+$/g,""),!C)return{};for(var T={},A=C.split("&"),R=A.length,F,D,O,U=0;U<R;U++)F=A[U].split("="),D=s.decodeQuery(F.shift(),b),O=F.length?s.decodeQuery(F.join("="),b):null,D!=="__proto__"&&(u.call(T,D)?((typeof T[D]=="string"||T[D]===null)&&(T[D]=[T[D]]),T[D].push(O)):T[D]=O);return T},s.build=function(C){var b="",T=!1;return C.protocol&&(b+=C.protocol+":"),!C.urn&&(b||C.hostname)&&(b+="//",T=!0),b+=s.buildAuthority(C)||"",typeof C.path=="string"&&(C.path.charAt(0)!=="/"&&T&&(b+="/"),b+=C.path),typeof C.query=="string"&&C.query&&(b+="?"+C.query),typeof C.fragment=="string"&&C.fragment&&(b+="#"+C.fragment),b},s.buildHost=function(C){var b="";if(C.hostname)s.ip6_expression.test(C.hostname)?b+="["+C.hostname+"]":b+=C.hostname;else return"";return C.port&&(b+=":"+C.port),b},s.buildAuthority=function(C){return s.buildUserinfo(C)+s.buildHost(C)},s.buildUserinfo=function(C){var b="";return C.username&&(b+=s.encode(C.username)),C.password&&(b+=":"+s.encode(C.password)),b&&(b+="@"),b},s.buildQuery=function(C,b,T){var A="",R,F,D,O;for(F in C)if(F!=="__proto__"&&u.call(C,F))if(c(C[F]))for(R={},D=0,O=C[F].length;D<O;D++)C[F][D]!==void 0&&R[C[F][D]+""]===void 0&&(A+="&"+s.buildQueryParameter(F,C[F][D],T),b!==!0&&(R[C[F][D]+""]=!0));else C[F]!==void 0&&(A+="&"+s.buildQueryParameter(F,C[F],T));return A.substring(1)},s.buildQueryParameter=function(C,b,T){return s.encodeQuery(C,T)+(b!==null?"="+s.encodeQuery(b,T):"")},s.addQuery=function(C,b,T){if(typeof b=="object")for(var A in b)u.call(b,A)&&s.addQuery(C,A,b[A]);else if(typeof b=="string"){if(C[b]===void 0){C[b]=T;return}else typeof C[b]=="string"&&(C[b]=[C[b]]);c(T)||(T=[T]),C[b]=(C[b]||[]).concat(T)}else throw new TypeError("URI.addQuery() accepts an object, string as the name parameter")},s.setQuery=function(C,b,T){if(typeof b=="object")for(var A in b)u.call(b,A)&&s.setQuery(C,A,b[A]);else if(typeof b=="string")C[b]=T===void 0?null:T;else throw new TypeError("URI.setQuery() accepts an object, string as the name parameter")},s.removeQuery=function(C,b,T){var A,R,F;if(c(b))for(A=0,R=b.length;A<R;A++)C[b[A]]=void 0;else if(l(b)==="RegExp")for(F in C)b.test(F)&&(C[F]=void 0);else if(typeof b=="object")for(F in b)u.call(b,F)&&s.removeQuery(C,F,b[F]);else if(typeof b=="string")T!==void 0?l(T)==="RegExp"?!c(C[b])&&T.test(C[b])?C[b]=void 0:C[b]=h(C[b],T):C[b]===String(T)&&(!c(T)||T.length===1)?C[b]=void 0:c(C[b])&&(C[b]=h(C[b],T)):C[b]=void 0;else throw new TypeError("URI.removeQuery() accepts an object, string, RegExp as the first parameter")},s.hasQuery=function(C,b,T,A){switch(l(b)){case"String":break;case"RegExp":for(var R in C)if(u.call(C,R)&&b.test(R)&&(T===void 0||s.hasQuery(C,R,T)))return!0;return!1;case"Object":for(var F in b)if(u.call(b,F)&&!s.hasQuery(C,F,b[F]))return!1;return!0;default:throw new TypeError("URI.hasQuery() accepts a string, regular expression or object as the name parameter")}switch(l(T)){case"Undefined":return b in C;case"Boolean":var D=!!(c(C[b])?C[b].length:C[b]);return T===D;case"Function":return!!T(C[b],b,C);case"Array":if(!c(C[b]))return!1;var O=A?d:m;return O(C[b],T);case"RegExp":return c(C[b])?A?d(C[b],T):!1:!!(C[b]&&C[b].match(T));case"Number":T=String(T);case"String":return c(C[b])?A?d(C[b],T):!1:C[b]===T;default:throw new TypeError("URI.hasQuery() accepts undefined, boolean, string, number, RegExp, Function as the value parameter")}},s.joinPaths=function(){for(var C=[],b=[],T=0,A=0;A<arguments.length;A++){var R=new s(arguments[A]);C.push(R);for(var F=R.segment(),D=0;D<F.length;D++)typeof F[D]=="string"&&b.push(F[D]),F[D]&&T++}if(!b.length||!T)return new s("");var O=new s("").segment(b);return(C[0].path()===""||C[0].path().slice(0,1)==="/")&&O.path("/"+O.path()),O.normalize()},s.commonPath=function(C,b){var T=Math.min(C.length,b.length),A;for(A=0;A<T;A++)if(C.charAt(A)!==b.charAt(A)){A--;break}return A<1?C.charAt(0)===b.charAt(0)&&C.charAt(0)==="/"?"/":"":((C.charAt(A)!=="/"||b.charAt(A)!=="/")&&(A=C.substring(0,A).lastIndexOf("/")),C.substring(0,A+1))},s.withinString=function(C,b,T){T||(T={});var A=T.start||s.findUri.start,R=T.end||s.findUri.end,F=T.trim||s.findUri.trim,D=T.parens||s.findUri.parens,O=/[a-z0-9-]=["']?$/i;for(A.lastIndex=0;;){var U=A.exec(C);if(!U)break;var q=U.index;if(T.ignoreHtml){var Y=C.slice(Math.max(q-3,0),q);if(Y&&O.test(Y))continue}for(var W=q+C.slice(q).search(R),K=C.slice(q,W),re=-1;;){var ce=D.exec(K);if(!ce)break;var Se=ce.index+ce[0].length;re=Math.max(re,Se)}if(re>-1?K=K.slice(0,re)+K.slice(re).replace(F,""):K=K.replace(F,""),!(K.length<=U[0].length)&&!(T.ignore&&T.ignore.test(K))){W=q+K.length;var de=b(K,q,W,C);if(de===void 0){A.lastIndex=W;continue}de=String(de),C=C.slice(0,q)+de+C.slice(W),A.lastIndex=q+de.length}}return A.lastIndex=0,C},s.ensureValidHostname=function(C,b){var T=!!C,A=!!b,R=!1;if(A&&(R=d(s.hostProtocols,b)),R&&!T)throw new TypeError("Hostname cannot be empty, if protocol is "+b);if(C&&C.match(s.invalid_hostname_characters)){if(!e)throw new TypeError('Hostname "'+C+'" contains characters other than [A-Z0-9.-:_] and Punycode.js is not available');if(e.toASCII(C).match(s.invalid_hostname_characters))throw new TypeError('Hostname "'+C+'" contains characters other than [A-Z0-9.-:_]')}},s.ensureValidPort=function(C){if(C){var b=Number(C);if(!(a(b)&&b>0&&b<65536))throw new TypeError('Port "'+C+'" is not a valid port')}},s.noConflict=function(C){if(C){var b={URI:this.noConflict()};return n.URITemplate&&typeof n.URITemplate.noConflict=="function"&&(b.URITemplate=n.URITemplate.noConflict()),n.IPv6&&typeof n.IPv6.noConflict=="function"&&(b.IPv6=n.IPv6.noConflict()),n.SecondLevelDomains&&typeof n.SecondLevelDomains.noConflict=="function"&&(b.SecondLevelDomains=n.SecondLevelDomains.noConflict()),b}else n.URI===this&&(n.URI=i);return this},o.build=function(C){return C===!0?this._deferred_build=!0:(C===void 0||this._deferred_build)&&(this._string=s.build(this._parts),this._deferred_build=!1),this},o.clone=function(){return new s(this)},o.valueOf=o.toString=function(){return this.build(!1)._string};function S(C){return function(b,T){return b===void 0?this._parts[C]||"":(this._parts[C]=b||null,this.build(!T),this)}}function I(C,b){return function(T,A){return T===void 0?this._parts[C]||"":(T!==null&&(T=T+"",T.charAt(0)===b&&(T=T.substring(1))),this._parts[C]=T,this.build(!A),this)}}o.protocol=S("protocol"),o.username=S("username"),o.password=S("password"),o.hostname=S("hostname"),o.port=S("port"),o.query=I("query","?"),o.fragment=I("fragment","#"),o.search=function(C,b){var T=this.query(C,b);return typeof T=="string"&&T.length?"?"+T:T},o.hash=function(C,b){var T=this.fragment(C,b);return typeof T=="string"&&T.length?"#"+T:T},o.pathname=function(C,b){if(C===void 0||C===!0){var T=this._parts.path||(this._parts.hostname?"/":"");return C?(this._parts.urn?s.decodeUrnPath:s.decodePath)(T):T}else return this._parts.urn?this._parts.path=C?s.recodeUrnPath(C):"":this._parts.path=C?s.recodePath(C):"/",this.build(!b),this},o.path=o.pathname,o.href=function(C,b){var T;if(C===void 0)return this.toString();this._string="",this._parts=s._parts();var A=C instanceof s,R=typeof C=="object"&&(C.hostname||C.path||C.pathname);if(C.nodeName){var F=s.getDomAttribute(C);C=C[F]||"",R=!1}if(!A&&R&&C.pathname!==void 0&&(C=C.toString()),typeof C=="string"||C instanceof String)this._parts=s.parse(String(C),this._parts);else if(A||R){var D=A?C._parts:C;for(T in D)T!=="query"&&u.call(this._parts,T)&&(this._parts[T]=D[T]);D.query&&this.query(D.query,!1)}else throw new TypeError("invalid input");return this.build(!b),this},o.is=function(C){var b=!1,T=!1,A=!1,R=!1,F=!1,D=!1,O=!1,U=!this._parts.urn;switch(this._parts.hostname&&(U=!1,T=s.ip4_expression.test(this._parts.hostname),A=s.ip6_expression.test(this._parts.hostname),b=T||A,R=!b,F=R&&r&&r.has(this._parts.hostname),D=R&&s.idn_expression.test(this._parts.hostname),O=R&&s.punycode_expression.test(this._parts.hostname)),C.toLowerCase()){case"relative":return U;case"absolute":return!U;case"domain":case"name":return R;case"sld":return F;case"ip":return b;case"ip4":case"ipv4":case"inet4":return T;case"ip6":case"ipv6":case"inet6":return A;case"idn":return D;case"url":return!this._parts.urn;case"urn":return!!this._parts.urn;case"punycode":return O}return null};var P=o.protocol,w=o.port,N=o.hostname;o.protocol=function(C,b){if(C&&(C=C.replace(/:(\/\/)?$/,""),!C.match(s.protocol_expression)))throw new TypeError('Protocol "'+C+`" contains characters other than [A-Z0-9.+-] or doesn't start with [A-Z]`);return P.call(this,C,b)},o.scheme=o.protocol,o.port=function(C,b){return this._parts.urn?C===void 0?"":this:(C!==void 0&&(C===0&&(C=null),C&&(C+="",C.charAt(0)===":"&&(C=C.substring(1)),s.ensureValidPort(C))),w.call(this,C,b))},o.hostname=function(C,b){if(this._parts.urn)return C===void 0?"":this;if(C!==void 0){var T={preventInvalidHostname:this._parts.preventInvalidHostname},A=s.parseHost(C,T);if(A!=="/")throw new TypeError('Hostname "'+C+'" contains characters other than [A-Z0-9.-]');C=T.hostname,this._parts.preventInvalidHostname&&s.ensureValidHostname(C,this._parts.protocol)}return N.call(this,C,b)},o.origin=function(C,b){if(this._parts.urn)return C===void 0?"":this;if(C===void 0){var T=this.protocol(),A=this.authority();return A?(T?T+"://":"")+this.authority():""}else{var R=s(C);return this.protocol(R.protocol()).authority(R.authority()).build(!b),this}},o.host=function(C,b){if(this._parts.urn)return C===void 0?"":this;if(C===void 0)return this._parts.hostname?s.buildHost(this._parts):"";var T=s.parseHost(C,this._parts);if(T!=="/")throw new TypeError('Hostname "'+C+'" contains characters other than [A-Z0-9.-]');return this.build(!b),this},o.authority=function(C,b){if(this._parts.urn)return C===void 0?"":this;if(C===void 0)return this._parts.hostname?s.buildAuthority(this._parts):"";var T=s.parseAuthority(C,this._parts);if(T!=="/")throw new TypeError('Hostname "'+C+'" contains characters other than [A-Z0-9.-]');return this.build(!b),this},o.userinfo=function(C,b){if(this._parts.urn)return C===void 0?"":this;if(C===void 0){var T=s.buildUserinfo(this._parts);return T&&T.substring(0,T.length-1)}else return C[C.length-1]!=="@"&&(C+="@"),s.parseUserinfo(C,this._parts),this.build(!b),this},o.resource=function(C,b){var T;return C===void 0?this.path()+this.search()+this.hash():(T=s.parse(C),this._parts.path=T.path,this._parts.query=T.query,this._parts.fragment=T.fragment,this.build(!b),this)},o.subdomain=function(C,b){if(this._parts.urn)return C===void 0?"":this;if(C===void 0){if(!this._parts.hostname||this.is("IP"))return"";var T=this._parts.hostname.length-this.domain().length-1;return this._parts.hostname.substring(0,T)||""}else{var A=this._parts.hostname.length-this.domain().length,R=this._parts.hostname.substring(0,A),F=new RegExp("^"+f(R));if(C&&C.charAt(C.length-1)!=="."&&(C+="."),C.indexOf(":")!==-1)throw new TypeError("Domains cannot contain colons");return C&&s.ensureValidHostname(C,this._parts.protocol),this._parts.hostname=this._parts.hostname.replace(F,C),this.build(!b),this}},o.domain=function(C,b){if(this._parts.urn)return C===void 0?"":this;if(typeof C=="boolean"&&(b=C,C=void 0),C===void 0){if(!this._parts.hostname||this.is("IP"))return"";var T=this._parts.hostname.match(/\./g);if(T&&T.length<2)return this._parts.hostname;var A=this._parts.hostname.length-this.tld(b).length-1;return A=this._parts.hostname.lastIndexOf(".",A-1)+1,this._parts.hostname.substring(A)||""}else{if(!C)throw new TypeError("cannot set domain empty");if(C.indexOf(":")!==-1)throw new TypeError("Domains cannot contain colons");if(s.ensureValidHostname(C,this._parts.protocol),!this._parts.hostname||this.is("IP"))this._parts.hostname=C;else{var R=new RegExp(f(this.domain())+"$");this._parts.hostname=this._parts.hostname.replace(R,C)}return this.build(!b),this}},o.tld=function(C,b){if(this._parts.urn)return C===void 0?"":this;if(typeof C=="boolean"&&(b=C,C=void 0),C===void 0){if(!this._parts.hostname||this.is("IP"))return"";var T=this._parts.hostname.lastIndexOf("."),A=this._parts.hostname.substring(T+1);return b!==!0&&r&&r.list[A.toLowerCase()]&&r.get(this._parts.hostname)||A}else{var R;if(C)if(C.match(/[^a-zA-Z0-9-]/))if(r&&r.is(C))R=new RegExp(f(this.tld())+"$"),this._parts.hostname=this._parts.hostname.replace(R,C);else throw new TypeError('TLD "'+C+'" contains characters other than [A-Z0-9]');else{if(!this._parts.hostname||this.is("IP"))throw new ReferenceError("cannot set TLD on non-domain host");R=new RegExp(f(this.tld())+"$"),this._parts.hostname=this._parts.hostname.replace(R,C)}else throw new TypeError("cannot set TLD empty");return this.build(!b),this}},o.directory=function(C,b){if(this._parts.urn)return C===void 0?"":this;if(C===void 0||C===!0){if(!this._parts.path&&!this._parts.hostname)return"";if(this._parts.path==="/")return"/";var T=this._parts.path.length-this.filename().length-1,A=this._parts.path.substring(0,T)||(this._parts.hostname?"/":"");return C?s.decodePath(A):A}else{var R=this._parts.path.length-this.filename().length,F=this._parts.path.substring(0,R),D=new RegExp("^"+f(F));return this.is("relative")||(C||(C="/"),C.charAt(0)!=="/"&&(C="/"+C)),C&&C.charAt(C.length-1)!=="/"&&(C+="/"),C=s.recodePath(C),this._parts.path=this._parts.path.replace(D,C),this.build(!b),this}},o.filename=function(C,b){if(this._parts.urn)return C===void 0?"":this;if(typeof C!="string"){if(!this._parts.path||this._parts.path==="/")return"";var T=this._parts.path.lastIndexOf("/"),A=this._parts.path.substring(T+1);return C?s.decodePathSegment(A):A}else{var R=!1;C.charAt(0)==="/"&&(C=C.substring(1)),C.match(/\.?\//)&&(R=!0);var F=new RegExp(f(this.filename())+"$");return C=s.recodePath(C),this._parts.path=this._parts.path.replace(F,C),R?this.normalizePath(b):this.build(!b),this}},o.suffix=function(C,b){if(this._parts.urn)return C===void 0?"":this;if(C===void 0||C===!0){if(!this._parts.path||this._parts.path==="/")return"";var T=this.filename(),A=T.lastIndexOf("."),R,F;return A===-1?"":(R=T.substring(A+1),F=/^[a-z0-9%]+$/i.test(R)?R:"",C?s.decodePathSegment(F):F)}else{C.charAt(0)==="."&&(C=C.substring(1));var D=this.suffix(),O;if(D)C?O=new RegExp(f(D)+"$"):O=new RegExp(f("."+D)+"$");else{if(!C)return this;this._parts.path+="."+s.recodePath(C)}return O&&(C=s.recodePath(C),this._parts.path=this._parts.path.replace(O,C)),this.build(!b),this}},o.segment=function(C,b,T){var A=this._parts.urn?":":"/",R=this.path(),F=R.substring(0,1)==="/",D=R.split(A);if(C!==void 0&&typeof C!="number"&&(T=b,b=C,C=void 0),C!==void 0&&typeof C!="number")throw new Error('Bad segment "'+C+'", must be 0-based integer');if(F&&D.shift(),C<0&&(C=Math.max(D.length+C,0)),b===void 0)return C===void 0?D:D[C];if(C===null||D[C]===void 0)if(c(b)){D=[];for(var O=0,U=b.length;O<U;O++)!b[O].length&&(!D.length||!D[D.length-1].length)||(D.length&&!D[D.length-1].length&&D.pop(),D.push(g(b[O])))}else(b||typeof b=="string")&&(b=g(b),D[D.length-1]===""?D[D.length-1]=b:D.push(b));else b?D[C]=g(b):D.splice(C,1);return F&&D.unshift(""),this.path(D.join(A),T)},o.segmentCoded=function(C,b,T){var A,R,F;if(typeof C!="number"&&(T=b,b=C,C=void 0),b===void 0){if(A=this.segment(C,b,T),!c(A))A=A!==void 0?s.decode(A):void 0;else for(R=0,F=A.length;R<F;R++)A[R]=s.decode(A[R]);return A}if(!c(b))b=typeof b=="string"||b instanceof String?s.encode(b):b;else for(R=0,F=b.length;R<F;R++)b[R]=s.encode(b[R]);return this.segment(C,b,T)};var B=o.query;return o.query=function(C,b){if(C===!0)return s.parseQuery(this._parts.query,this._parts.escapeQuerySpace);if(typeof C=="function"){var T=s.parseQuery(this._parts.query,this._parts.escapeQuerySpace),A=C.call(this,T);return this._parts.query=s.buildQuery(A||T,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),this.build(!b),this}else return C!==void 0&&typeof C!="string"?(this._parts.query=s.buildQuery(C,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),this.build(!b),this):B.call(this,C,b)},o.setQuery=function(C,b,T){var A=s.parseQuery(this._parts.query,this._parts.escapeQuerySpace);if(typeof C=="string"||C instanceof String)A[C]=b!==void 0?b:null;else if(typeof C=="object")for(var R in C)u.call(C,R)&&(A[R]=C[R]);else throw new TypeError("URI.addQuery() accepts an object, string as the name parameter");return this._parts.query=s.buildQuery(A,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),typeof C!="string"&&(T=b),this.build(!T),this},o.addQuery=function(C,b,T){var A=s.parseQuery(this._parts.query,this._parts.escapeQuerySpace);return s.addQuery(A,C,b===void 0?null:b),this._parts.query=s.buildQuery(A,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),typeof C!="string"&&(T=b),this.build(!T),this},o.removeQuery=function(C,b,T){var A=s.parseQuery(this._parts.query,this._parts.escapeQuerySpace);return s.removeQuery(A,C,b),this._parts.query=s.buildQuery(A,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),typeof C!="string"&&(T=b),this.build(!T),this},o.hasQuery=function(C,b,T){var A=s.parseQuery(this._parts.query,this._parts.escapeQuerySpace);return s.hasQuery(A,C,b,T)},o.setSearch=o.setQuery,o.addSearch=o.addQuery,o.removeSearch=o.removeQuery,o.hasSearch=o.hasQuery,o.normalize=function(){return this._parts.urn?this.normalizeProtocol(!1).normalizePath(!1).normalizeQuery(!1).normalizeFragment(!1).build():this.normalizeProtocol(!1).normalizeHostname(!1).normalizePort(!1).normalizePath(!1).normalizeQuery(!1).normalizeFragment(!1).build()},o.normalizeProtocol=function(C){return typeof this._parts.protocol=="string"&&(this._parts.protocol=this._parts.protocol.toLowerCase(),this.build(!C)),this},o.normalizeHostname=function(C){return this._parts.hostname&&(this.is("IDN")&&e?this._parts.hostname=e.toASCII(this._parts.hostname):this.is("IPv6")&&t&&(this._parts.hostname=t.best(this._parts.hostname)),this._parts.hostname=this._parts.hostname.toLowerCase(),this.build(!C)),this},o.normalizePort=function(C){return typeof this._parts.protocol=="string"&&this._parts.port===s.defaultPorts[this._parts.protocol]&&(this._parts.port=null,this.build(!C)),this},o.normalizePath=function(C){var b=this._parts.path;if(!b)return this;if(this._parts.urn)return this._parts.path=s.recodeUrnPath(this._parts.path),this.build(!C),this;if(this._parts.path==="/")return this;b=s.recodePath(b);var T,A="",R,F;for(b.charAt(0)!=="/"&&(T=!0,b="/"+b),(b.slice(-3)==="/.."||b.slice(-2)==="/.")&&(b+="/"),b=b.replace(/(\/(\.\/)+)|(\/\.$)/g,"/").replace(/\/{2,}/g,"/"),T&&(A=b.substring(1).match(/^(\.\.\/)+/)||"",A&&(A=A[0]));R=b.search(/\/\.\.(\/|$)/),R!==-1;){if(R===0){b=b.substring(3);continue}F=b.substring(0,R).lastIndexOf("/"),F===-1&&(F=R),b=b.substring(0,F)+b.substring(R+3)}return T&&this.is("relative")&&(b=A+b.substring(1)),this._parts.path=b,this.build(!C),this},o.normalizePathname=o.normalizePath,o.normalizeQuery=function(C){return typeof this._parts.query=="string"&&(this._parts.query.length?this.query(s.parseQuery(this._parts.query,this._parts.escapeQuerySpace)):this._parts.query=null,this.build(!C)),this},o.normalizeFragment=function(C){return this._parts.fragment||(this._parts.fragment=null,this.build(!C)),this},o.normalizeSearch=o.normalizeQuery,o.normalizeHash=o.normalizeFragment,o.iso8859=function(){var C=s.encode,b=s.decode;s.encode=escape,s.decode=decodeURIComponent;try{this.normalize()}finally{s.encode=C,s.decode=b}return this},o.unicode=function(){var C=s.encode,b=s.decode;s.encode=v,s.decode=unescape;try{this.normalize()}finally{s.encode=C,s.decode=b}return this},o.readable=function(){var C=this.clone();C.username("").password("").normalize();var b="";if(C._parts.protocol&&(b+=C._parts.protocol+"://"),C._parts.hostname&&(C.is("punycode")&&e?(b+=e.toUnicode(C._parts.hostname),C._parts.port&&(b+=":"+C._parts.port)):b+=C.host()),C._parts.hostname&&C._parts.path&&C._parts.path.charAt(0)!=="/"&&(b+="/"),b+=C.path(!0),C._parts.query){for(var T="",A=0,R=C._parts.query.split("&"),F=R.length;A<F;A++){var D=(R[A]||"").split("=");T+="&"+s.decodeQuery(D[0],this._parts.escapeQuerySpace).replace(/&/g,"%26"),D[1]!==void 0&&(T+="="+s.decodeQuery(D[1],this._parts.escapeQuerySpace).replace(/&/g,"%26"))}b+="?"+T.substring(1)}return b+=s.decodeQuery(C.hash(),!0),b},o.absoluteTo=function(C){var b=this.clone(),T=["protocol","username","password","hostname","port"],A,R,F;if(this._parts.urn)throw new Error("URNs do not have any generally defined hierarchical components");if(C instanceof s||(C=new s(C)),b._parts.protocol||(b._parts.protocol=C._parts.protocol,this._parts.hostname))return b;for(R=0;F=T[R];R++)b._parts[F]=C._parts[F];return b._parts.path?(b._parts.path.substring(-2)===".."&&(b._parts.path+="/"),b.path().charAt(0)!=="/"&&(A=C.directory(),A=A||(C.path().indexOf("/")===0?"/":""),b._parts.path=(A?A+"/":"")+b._parts.path,b.normalizePath())):(b._parts.path=C._parts.path,b._parts.query||(b._parts.query=C._parts.query)),b.build(),b},o.relativeTo=function(C){var b=this.clone().normalize(),T,A,R,F,D;if(b._parts.urn)throw new Error("URNs do not have any generally defined hierarchical components");if(C=new s(C).normalize(),T=b._parts,A=C._parts,F=b.path(),D=C.path(),F.charAt(0)!=="/")throw new Error("URI is already relative");if(D.charAt(0)!=="/")throw new Error("Cannot calculate a URI relative to another relative URI");if(T.protocol===A.protocol&&(T.protocol=null),T.username!==A.username||T.password!==A.password||T.protocol!==null||T.username!==null||T.password!==null)return b.build();if(T.hostname===A.hostname&&T.port===A.port)T.hostname=null,T.port=null;else return b.build();if(F===D)return T.path="",b.build();if(R=s.commonPath(F,D),!R)return b.build();var O=A.path.substring(R.length).replace(/[^\/]*$/,"").replace(/.*?\//g,"../");return T.path=O+T.path.substring(R.length)||"./",b.build()},o.equals=function(C){var b=this.clone(),T=new s(C),A={},R={},F={},D,O,U;if(b.normalize(),T.normalize(),b.toString()===T.toString())return!0;if(D=b.query(),O=T.query(),b.query(""),T.query(""),b.toString()!==T.toString()||D.length!==O.length)return!1;A=s.parseQuery(D,this._parts.escapeQuerySpace),R=s.parseQuery(O,this._parts.escapeQuerySpace);for(U in A)if(u.call(A,U)){if(c(A[U])){if(!m(A[U],R[U]))return!1}else if(A[U]!==R[U])return!1;F[U]=!0}for(U in R)if(u.call(R,U)&&!F[U])return!1;return!0},o.preventInvalidHostname=function(C){return this._parts.preventInvalidHostname=!!C,this},o.duplicateQueryParameters=function(C){return this._parts.duplicateQueryParameters=!!C,this},o.escapeQuerySpace=function(C){return this._parts.escapeQuerySpace=!!C,this},s})});var Kv=Au((B3,jv)=>{var Ms=function(e){e==null&&(e=new Date().getTime()),this.N=624,this.M=397,this.MATRIX_A=2567483615,this.UPPER_MASK=2147483648,this.LOWER_MASK=2147483647,this.mt=new Array(this.N),this.mti=this.N+1,e.constructor==Array?this.init_by_array(e,e.length):this.init_seed(e)};Ms.prototype.init_seed=function(e){for(this.mt[0]=e>>>0,this.mti=1;this.mti<this.N;this.mti++){var e=this.mt[this.mti-1]^this.mt[this.mti-1]>>>30;this.mt[this.mti]=(((e&4294901760)>>>16)*1812433253<<16)+(e&65535)*1812433253+this.mti,this.mt[this.mti]>>>=0}};Ms.prototype.init_by_array=function(e,t){var r,n,i;for(this.init_seed(19650218),r=1,n=0,i=this.N>t?this.N:t;i;i--){var s=this.mt[r-1]^this.mt[r-1]>>>30;this.mt[r]=(this.mt[r]^(((s&4294901760)>>>16)*1664525<<16)+(s&65535)*1664525)+e[n]+n,this.mt[r]>>>=0,r++,n++,r>=this.N&&(this.mt[0]=this.mt[this.N-1],r=1),n>=t&&(n=0)}for(i=this.N-1;i;i--){var s=this.mt[r-1]^this.mt[r-1]>>>30;this.mt[r]=(this.mt[r]^(((s&4294901760)>>>16)*1566083941<<16)+(s&65535)*1566083941)-r,this.mt[r]>>>=0,r++,r>=this.N&&(this.mt[0]=this.mt[this.N-1],r=1)}this.mt[0]=2147483648};Ms.prototype.random_int=function(){var e,t=new Array(0,this.MATRIX_A);if(this.mti>=this.N){var r;for(this.mti==this.N+1&&this.init_seed(5489),r=0;r<this.N-this.M;r++)e=this.mt[r]&this.UPPER_MASK|this.mt[r+1]&this.LOWER_MASK,this.mt[r]=this.mt[r+this.M]^e>>>1^t[e&1];for(;r<this.N-1;r++)e=this.mt[r]&this.UPPER_MASK|this.mt[r+1]&this.LOWER_MASK,this.mt[r]=this.mt[r+(this.M-this.N)]^e>>>1^t[e&1];e=this.mt[this.N-1]&this.UPPER_MASK|this.mt[0]&this.LOWER_MASK,this.mt[this.N-1]=this.mt[this.M-1]^e>>>1^t[e&1],this.mti=0}return e=this.mt[this.mti++],e^=e>>>11,e^=e<<7&2636928640,e^=e<<15&4022730752,e^=e>>>18,e>>>0};Ms.prototype.random_int31=function(){return this.random_int()>>>1};Ms.prototype.random_incl=function(){return this.random_int()*(1/4294967295)};Ms.prototype.random=function(){return this.random_int()*(1/4294967296)};Ms.prototype.random_excl=function(){return(this.random_int()+.5)*(1/4294967296)};Ms.prototype.random_long=function(){var e=this.random_int()>>>5,t=this.random_int()>>>6;return(e*67108864+t)*(1/9007199254740992)};jv.exports=Ms});var er={_maximumCombinedTextureImageUnits:0,_maximumCubeMapSize:0,_maximumFragmentUniformVectors:0,_maximumTextureImageUnits:0,_maximumRenderbufferSize:0,_maximumTextureSize:0,_maximumVaryingVectors:0,_maximumVertexAttributes:0,_maximumVertexTextureImageUnits:0,_maximumVertexUniformVectors:0,_minimumAliasedLineWidth:0,_maximumAliasedLineWidth:0,_minimumAliasedPointSize:0,_maximumAliasedPointSize:0,_maximumViewportWidth:0,_maximumViewportHeight:0,_maximumTextureFilterAnisotropy:0,_maximumDrawBuffers:0,_maximumColorAttachments:0,_maximumSamples:0,_highpFloatSupported:!1,_highpIntSupported:!1};Object.defineProperties(er,{maximumCombinedTextureImageUnits:{get:function(){return er._maximumCombinedTextureImageUnits}},maximumCubeMapSize:{get:function(){return er._maximumCubeMapSize}},maximumFragmentUniformVectors:{get:function(){return er._maximumFragmentUniformVectors}},maximumTextureImageUnits:{get:function(){return er._maximumTextureImageUnits}},maximumRenderbufferSize:{get:function(){return er._maximumRenderbufferSize}},maximumTextureSize:{get:function(){return er._maximumTextureSize}},maximumVaryingVectors:{get:function(){return er._maximumVaryingVectors}},maximumVertexAttributes:{get:function(){return er._maximumVertexAttributes}},maximumVertexTextureImageUnits:{get:function(){return er._maximumVertexTextureImageUnits}},maximumVertexUniformVectors:{get:function(){return er._maximumVertexUniformVectors}},minimumAliasedLineWidth:{get:function(){return er._minimumAliasedLineWidth}},maximumAliasedLineWidth:{get:function(){return er._maximumAliasedLineWidth}},minimumAliasedPointSize:{get:function(){return er._minimumAliasedPointSize}},maximumAliasedPointSize:{get:function(){return er._maximumAliasedPointSize}},maximumViewportWidth:{get:function(){return er._maximumViewportWidth}},maximumViewportHeight:{get:function(){return er._maximumViewportHeight}},maximumTextureFilterAnisotropy:{get:function(){return er._maximumTextureFilterAnisotropy}},maximumDrawBuffers:{get:function(){return er._maximumDrawBuffers}},maximumColorAttachments:{get:function(){return er._maximumColorAttachments}},maximumSamples:{get:function(){return er._maximumSamples}},highpFloatSupported:{get:function(){return er._highpFloatSupported}},highpIntSupported:{get:function(){return er._highpIntSupported}}});var Re=er;function Jx(e,t){e.scene._context._gl.getExtension("EXT_shader_texture_lod"),e.scene._context._gl.getExtension("OES_texture_float")?window.NO_support_OES_float=!1:window.NO_support_OES_float=!0,Re._maximumCombinedTextureImageUnits=Cesium.ContextLimits._maximumCombinedTextureImageUnits,Re._maximumCubeMapSize=Cesium.ContextLimits._maximumCubeMapSize,Re._maximumFragmentUniformVectors=Cesium.ContextLimits._maximumFragmentUniformVectors,Re._maximumTextureImageUnits=Cesium.ContextLimits._maximumTextureImageUnits,Re._maximumRenderbufferSize=Cesium.ContextLimits._maximumRenderbufferSize,Re._maximumTextureSize=Cesium.ContextLimits._maximumTextureSize,Re._maximumVertexAttributes=Cesium.ContextLimits._maximumVertexAttributes,Re._maximumVertexTextureImageUnits=Cesium.ContextLimits._maximumVertexTextureImageUnits,Re._maximumVertexUniformVectors=Cesium.ContextLimits._maximumVertexUniformVectors,Re._minimumAliasedLineWidth=Cesium.ContextLimits._minimumAliasedLineWidth,Re._maximumAliasedLineWidth=Cesium.ContextLimits._maximumAliasedLineWidth,Re._minimumAliasedPointSize=Cesium.ContextLimits._minimumAliasedPointSize,Re._maximumAliasedPointSize=Cesium.ContextLimits._maximumAliasedPointSize,Re._maximumViewportWidth=Cesium.ContextLimits._maximumViewportWidth,Re._maximumViewportHeight=Cesium.ContextLimits._maximumViewportHeight,Re._highpFloatSupported=Cesium.ContextLimits._highpFloatSupported,Re._highpIntSupported=Cesium.ContextLimits._highpIntSupported,Re._maximumTextureFilterAnisotropy=Cesium.ContextLimits._maximumTextureFilterAnisotropy,Re._maximumDrawBuffers=Cesium.ContextLimits._maximumDrawBuffers,Re._maximumColorAttachments=Cesium.ContextLimits._maximumColorAttachments}var $x=Jx;var eE={IMAGE:0,DEM:1,E3M:2,CROSS:3,E3M_OLD:4},Fa=Object.freeze(eE);var $p=dh(mh(),1);function bs(){this._demLayers=[],this._tilingScheme=void 0,this._maxLevel=void 0}Object.defineProperties(bs.prototype,{tiling:{get:function(){return this._tilingScheme}},maxLevel:{get:function(){return this._maxLevel}}});bs.prototype.addDEMLayer=function(e){let t=e._name,r=e._url;if(!Cesium.defined(t)||!Cesium.defined(r))throw new Cesium.DeveloperError("\u56FE\u5C42\u540D\u79F0\u6216\u8005\u670D\u52A1\u5668\u5730\u5740\u672A\u5B9A\u4E49\uFF01");if(Cesium.defined(eg(this._demLayers,t))){console.log("\u6DFB\u52A0\u5931\u8D25\uFF0C\u5DF2\u7ECF\u5B58\u5728\u6B64\u540D\u79F0\u7684\u56FE\u5C42\uFF01");return}let n=this,i=new $p.default(r);i.path()!=="/"?(r=`${r}/EV_WebService/MetadataService/GetDEMObjectInfo?demName=${t}`,Cesium.Resource.createIfNeeded(r).fetchXML().then(s).catch(o)):(i=`${r}/earthview/manager/config/getVersionInfo`,Cesium.Resource.createIfNeeded(i).fetchJson().then(function(c){c&&(r+=`/earthview/rest/services/edeserver/getLayerInfo?layer=${t}`,Cesium.Resource.createIfNeeded(r).fetchJson().then(a).catch(o),e._evServerVersion=7)}).catch(function(){r=`${r}/EV_WebService/MetadataService/GetDEMObjectInfo?demName=${t}`,Cesium.Resource.createIfNeeded(r).fetchXML().then(s).catch(o),e._evServerVersion=void 0}));function s(l){if(!Cesium.defined(l.getElementsByTagName("minDataLevel")[0])){console.log(`${t} \u6DFB\u52A0\u5931\u8D25,\u9519\u8BEF\u7684\u6E90\u6570\u636E\u683C\u5F0F\uFF01`);return}e._minDataLevel=parseInt(l.getElementsByTagName("minDataLevel")[0].textContent),e._maxDataLevel=parseInt(l.getElementsByTagName("maxDataLevel")[0].textContent);let c=l.getElementsByTagName("SRS")[0].textContent;if(c==="WGS_1984"){if(Cesium.defined(n._tilingScheme)){if(n._tilingScheme instanceof Cesium.WebMercatorTilingScheme)throw new Cesium.DeveloperError("\u56FE\u5C42\u6295\u5F71\u5750\u6807\u7CFB\u4E0D\u4E00\u81F4\uFF01");e._tilingScheme=n._tilingScheme}else e._tilingScheme=new Cesium.GeographicTilingScheme({numberOfLevelZeroTilesX:18,numberOfLevelZeroTilesY:9});let h=Cesium.Math.toRadians(parseFloat(l.getElementsByTagName("minX")[0].textContent)),d=Cesium.Math.toRadians(parseFloat(l.getElementsByTagName("minY")[0].textContent)),m=Cesium.Math.toRadians(parseFloat(l.getElementsByTagName("maxX")[0].textContent)),g=Cesium.Math.toRadians(parseFloat(l.getElementsByTagName("maxY")[0].textContent));e._rectangle=new Cesium.Rectangle(h,d,m,g)}else if(c==="Mercator_Web"){if(Cesium.defined(n._tilingScheme)){if(n._tilingScheme instanceof Cesium.GeographicTilingScheme)throw new Cesium.DeveloperError("\u56FE\u5C42\u6295\u5F71\u5750\u6807\u7CFB\u4E0D\u4E00\u81F4\uFF01");e._tilingScheme=n._tilingScheme}else e._tilingScheme=new Cesium.WebMercatorTilingScheme;let h=parseFloat(l.getElementsByTagName("minX")[0].textContent),d=parseFloat(l.getElementsByTagName("minY")[0].textContent),m=parseFloat(l.getElementsByTagName("maxX")[0].textContent),g=parseFloat(l.getElementsByTagName("maxY")[0].textContent);g=f(g),d=f(d),m>3.14159265315248&&(m=3.14159265315248),g>1.4835298641571906&&(g=1.4835298641571906),d<-1.4835298641571923&&(d=-1.4835298641571923),h<-3.14159265315248&&(h=-3.14159265315248),e._rectangle=new Cesium.Rectangle(h,d,m,g)}else{o(`SRS ${c} is not supported.`);return}Cesium.defined(n._tilingScheme)||(n._tilingScheme=e._tilingScheme),e._demType=l.getElementsByTagName("demType")[0].textContent,e._tileSize=parseInt(l.getElementsByTagName("samplesPerTile")[0].textContent),e._vaild=!0,n._demLayers.push(e),cl(n),e._readyPromise.resolve(!0)}function a(l){e._minDataLevel=l.minLevel,e._maxDataLevel=l.maxLevel;let c=l.tileModel;if(c==="TM_DEM_WGS84")e._tilingScheme=new Cesium.GeographicTilingScheme({numberOfLevelZeroTilesX:18,numberOfLevelZeroTilesY:9}),e._rectangle=new Rectangle.fromDegrees(l.minx,l.miny,l.maxx,l.maxy);else if(c==="TM_DEM_WebMercator"){e._tilingScheme=new Cesium.WebMercatorTilingScheme;let h=new Cesium.WebMercatorProjection,d=h.unproject(new Cesium.Cartesian3(l.minx,l.miny)),m=h.unproject(new Cesium.Cartesian3(l.maxx,l.maxy));e._rectangle=new Cesium.Rectangle(d.longitude,d.latitude,m.longitude,m.latitude)}else{o(`SRS ${c} is not supported.`);return}switch(Cesium.defined(n._tilingScheme)||(n._tilingScheme=e._tilingScheme),e._demType=l.tileDataFormat,e._tileSize=l.tileWidth,e._heightMapWidth||(e._heightMapWidth=l.tileWidth),l.dataStorageFormat){case"DataStorageType_BIL_7Z":e._dataStorageFormat="7z";break;case"DataStorageType_BIL_GZIP":e._dataStorageFormat="gz";break;default:e._dataStorageFormat="";break}e._vaild=!0,n._demLayers.push(e),cl(n),e._readyPromise.resolve(!0)}function o(l){console.log(`${t} \u6DFB\u52A0\u5931\u8D25\uFF0C\u8BF7\u6C42\u8BBF\u95EE\u5931\u8D25\uFF01`)}function u(){resource.fetchXML().then(s).catch(o)}function f(l){let c=180/(4*Math.atan(1)),h=Math.atan(Math.sinh(l));return h*=c,h>85&&(h=90),h<-85&&(h=-90),Cesium.Math.toRadians(h)}return e};bs.prototype.removeDEMLayer=function(e){let t;typeof e=="string"?t=this.getDEMLayer(e):typeof e=="object"&&(t=e),rE(this._demLayers,t),cl(this)};bs.prototype.getDEMLayer=function(e){return eg(this._demLayers,e)};bs.prototype.getFitLayer=function(e,t,r){if(!Cesium.defined(this._tilingScheme))return;let n,i=this._tilingScheme.tileXYToRectangle(e,t,r);for(let s=0;s<this._demLayers.length;s++){let a=this._demLayers[s];a._vaild&&a._show&&Cesium.Rectangle.simpleIntersection(i,a._rectangle)&&(Cesium.defined(n)||(n=a),a._maxDataLevel>n._maxDataLevel&&(n=a))}return n};bs.prototype.isTileDataAvailable=function(e,t,r){if(Cesium.defined(this._maxLevel)||cl(this),Cesium.defined(this._maxLevel)&&this._maxLevel<r)return!1;if(r===0)return!0;if(!Cesium.defined(this._tilingScheme))return!1;let n=this._tilingScheme.tileXYToRectangle(e,t,r),i=!0;for(let s=0;s<this._demLayers.length;s++){let a=this._demLayers[s];if(a._vaild&&a._show&&Cesium.Rectangle.simpleIntersection(n,a._rectangle)){i=!1;break}}if(i)return!1};bs.prototype.getRectangles=function(){let e=[];for(let t=0;t<this._demLayers.length;t++){let r=this._demLayers[t];r._vaild&&r._show&&e.push(r._rectangle)}return e};bs.prototype.getFitLayers=function(e,t,r){if(!Cesium.defined(this._tilingScheme))return;let n=[],i,s=this._tilingScheme.tileXYToRectangle(e,t,r);for(let a=0;a<this._demLayers.length;a++){let o=this._demLayers[a];o._vaild&&o._show&&Cesium.Rectangle.simpleIntersection(s,o._rectangle)&&(Cesium.defined(i)||(i=o),o._maxDataLevel>i._maxDataLevel&&(i=o),o._maxDataLevel>=r&&n.push(o))}return n.length===0&&n.push(i),n};function tE(e,t){for(let r=0;r<e.length;r++)if(e[r]===t)return r;return-1}function rE(e,t){let r=tE(e,t);r>-1&&e.splice(r,1)}function eg(e,t){for(let r=0;r<e.length;r++)if(e[r].name===t)return e[r]}function cl(e){let t,r=e._demLayers;for(let n=0;n<r.length;n++){let i=r[n];i._vaild&&i._show&&(Cesium.defined(t)?t<r[n]._maxDataLevel&&(t=r[n]._maxDataLevel):t=r[n]._maxDataLevel)}Cesium.defined(t)&&(e._maxLevel=t,e._tilingScheme instanceof Cesium.WebMercatorTilingScheme&&e._maxLevel--)}var ph=bs;function hl(e){let t=e.name;if(!Cesium.defined(t))throw new Cesium.DeveloperError("name is required");if(typeof t!="string")throw new Cesium.DeveloperError("name is required to be a string ");let r=e.url;if(!Cesium.defined(r))throw new Cesium.DeveloperError("url is required");if(this._scene=e.scene,this._name=t,this._url=r,this._type=1,this._minDataLevel=0,this._maxDataLevel=0,this._rectangle=void 0,this._vaild=!1,this._tilingScheme=void 0,this._demType=void 0,this._tileSize=void 0,this._heightMapWidth=void 0,this._evServerVersion=void 0,this._readyPromise=Cesium.defer(),this._customTag=e.customTag,Cesium.defined(e.demOption)&&Cesium.defined(e.demOption.heightMapWidth)){let n=e.demOption.heightMapWidth;if(typeof n!="number")throw new Cesium.DeveloperError("heightMapWidth is required to be a number ");e.heightMapWidth=n,this._heightMapWidth=n}e.url=`${e.url}/EV_WebService/MetadataService/GetDEMObjectInfo?demName=${e.name}`,this._cesiumLayer=void 0,this.layerShownOrHidden=new Cesium.Event,this._show=!0}Object.defineProperties(hl.prototype,{name:{get:function(){return this._name}},url:{get:function(){return this._url}},type:{get:function(){return this._type}},readyPromise:{get:function(){return this._readyPromise.promise}},customTag:{get:function(){return this._customTag},set:function(e){this._customTag=e}},show:{get:function(){return this._show},set:function(e){typeof e!="boolean"?console.warn("visible is required to be a boolean"):this._show!==e&&(this._show=e,this.layerShownOrHidden.raiseEvent(this,0,this._show))}},rectangle:{get:function(){return this._rectangle}},vaild:{get:function(){return this._vaild}},minDataLevel:{get:function(){return this._minDataLevel}},maxDataLevel:{get:function(){return this._maxDataLevel}},useIndexedDBCache:{get:function(){return this._useIndexedDBCache},set:function(e){typeof e!="boolean"?this._useIndexedDBCache=!1:this._useIndexedDBCache=e}},scene:{get:function(){return this._scene},set:function(e){if(e instanceof Cesium.Scene)this._scene=e;else throw new Cesium.DeveloperError("value must be a instance of Cesium.Scene.")}}});hl.prototype.getCesiumLayer=function(){return this._cesiumLayer};hl.prototype.getHeight=function(e){let t=this._scene.globe,r=t._surface._levelZeroTiles;if(!Cesium.defined(r))return;let n=new Cesium.Cartesian3,i=new Cesium.Cartesian3,s=new Cesium.Cartographic,a=new Cesium.Ray,o,u,f=r.length;for(u=0;u<f&&(o=r[u],!Cesium.Rectangle.contains(o.rectangle,e));++u);if(u>=f)return;for(;o._lastSelectionResult===Cesium.TileSelectionResult.REFINED;)o=gh(o.southwestChild,e)||gh(o.southeastChild,e)||gh(o.northwestChild,e)||o.northeastChild;if(!Cesium.defined(o.data)||!Cesium.defined(o.data.renderedMesh))return;let l=t._surface._tileProvider.tilingScheme.ellipsoid,c=Cesium.Cartesian3.fromRadians(e.longitude,e.latitude,0,l,n),h=a,d=l.geodeticSurfaceNormal(c,h.direction),m=l.getSurfaceNormalIntersectionWithZAxis(c,11500,h.origin);if(!Cesium.defined(m)){let v=Math.min(Cesium.defaultValue(o.data.minimumHeight,0),-11500),_=Cesium.Cartesian3.multiplyByScalar(d,Math.abs(v)+1,i);Cesium.Cartesian3.subtract(c,_,h.origin)}let g=o.data.pick(h,void 0,void 0,!1,i);if(!Cesium.defined(g))return;let p=l.cartesianToCartographic(g,s).height;return p=p<0?0:p,p};function gh(e,t){return Cesium.Rectangle.contains(e.rectangle,t)?e:void 0}var vh=hl;function Yn(e){e=Cesium.defaultValue(e,Cesium.defaultValue.EMPTY_OBJECT),this._errorEvent=new Cesium.Event,this._ready=!1,this._readyPromise=Cesium.defer(),this._heightmapWidth=Cesium.defaultValue(e.heightMapWidth,65),this._terrainModifyInfoCollection=new Cesium.AssociativeArray,this._terrainDataStructure={heightScale:1,heightOffset:0,elementsPerHeight:1,stride:1,elementMultiplier:256,isBigEndian:!1,lowestEncodedHeight:-256*128*256*256,highestEncodedHeight:256*128*256*256-1,terrainModifyInfoCollection:this._terrainModifyInfoCollection};let t=e.credit;typeof t=="string"&&(t=new Cesium.Credit({text:t})),this._credit=t,this._heightmapWidth=Cesium.defaultValue(e.heightMapWidth,65),this._heightmapHeight=this._heightmapWidth,this._demLayerCollection=e.demLayerCollection,this._tilingScheme=this._demLayerCollection._tilingScheme,this._levelZeroMaximumGeometricError=Cesium.TerrainProvider.getEstimatedLevelZeroGeometricErrorForAHeightmap(Cesium.Ellipsoid.WGS84,this._heightmapHeight,this._tilingScheme.getNumberOfXTilesAtLevel(0)),this._ready=!0,this._readyPromise.resolve(!0)}Object.defineProperties(Yn.prototype,{errorEvent:{get:function(){return this._errorEvent}},credit:{get:function(){return this._credit}},tilingScheme:{get:function(){return this._tilingScheme}},ready:{get:function(){return this._ready}},readyPromise:{get:function(){return this._readyPromise.promise}},hasWaterMask:{get:function(){return!1}},hasVertexNormals:{get:function(){return!1}},terrainModifyInfoCollection:{get:function(){return this._terrainModifyInfoCollection}},maxDataLevel:{get:function(){return this._demLayerCollection._maxLevel}},useIndexedDBCache:{get:function(){return this._useIndexedDBCache},set:function(e){typeof e!="boolean"?this._useIndexedDBCache=!1:this._useIndexedDBCache=e}}});Yn.prototype.getRequestTileGeometryUrlAndUpsampling=function(e,t,r,n){let i=r,s=t,a=e;this._tilingScheme instanceof Cesium.GeographicTilingScheme?s=this._tilingScheme.getNumberOfYTilesAtLevel(r)-t-1:i++;let o;if(Cesium.defined(n)?o=n:o=this._demLayerCollection.getFitLayer(e,t,r),!Cesium.defined(o))return{url:void 0,createdByUpsampling:!1};let u=o._tileSize,f=o._demType,l=o._maxDataLevel,c=!1;return r>l&&(c=!0),{url:`${o._url}/EV_WebService/get/globeservice/10000/GetDEMData/${o._name}/${i}/${s}/${a}`,createdByUpsampling:c}};Yn.prototype.getFitLayers=function(e,t,r){let n=r,i=t,s=e;return this._tilingScheme instanceof Cesium.GeographicTilingScheme?i=this._tilingScheme.getNumberOfYTilesAtLevel(r)-t-1:n++,this._demLayerCollection.getFitLayers(e,t,r)};Yn.prototype.createHeightmapTerrainData=function(e,t,r,n,i){let s=new Cesium.HeightmapTerrainData({buffer:e,width:this._heightmapWidth,height:this._heightmapWidth,childTileMask:pl(this,r,n,t),structure:this._terrainDataStructure,createdByUpsampling:i}),a=this.tilingScheme.ellipsoid,u=Cesium.TerrainProvider.getEstimatedLevelZeroGeometricErrorForAHeightmap(a,s._width,this.tilingScheme.getNumberOfXTilesAtLevel(0))/(1<<t);return s._skirtHeight=Math.min(u*64,1e3),s};Yn.prototype.requestTileGeometry=function(e,t,r,n,i){let s=r,a=t,o=e;this._tilingScheme instanceof Cesium.GeographicTilingScheme?a=this._tilingScheme.getNumberOfYTilesAtLevel(r)-t-1:s++;let u=this,f=Cesium.defined(i)?i:this._demLayerCollection.getFitLayer(e,t,r);if(!Cesium.defined(f)){let p=new Promise(function(v,_){v()});return Promise.resolve(p).then(function(){return new Cesium.HeightmapTerrainData({buffer:new Float32Array(17*17),width:17,height:17,childTileMask:pl(u,e,t,r),structure:u._terrainDataStructure,createdByUpsampling:!1})})}let l=f._tileSize,c=f._demType,h=f._maxDataLevel,d;f._evServerVersion?d=`${f._url}/earthview/rest/services/edeserver/tms/${f._name}/${s}/${o}/${a}.${f._dataStorageFormat}`:d=`${f._url}/EV_WebService/get/globeservice/10000/GetDEMData/${f._name}/${s}/${a}/${o}`;let g=Cesium.Resource.createIfNeeded(d).fetchArrayBuffer();if(Cesium.defined(g))return Cesium.defined(n)&&(n.url=d),Promise.resolve(g).then(function(p){if((!Cesium.defined(p)||p.byteLength===0)&&r!==0)throw new DeveloperError("terrain data is empty!");let v,_,y=[],x=u._heightmapWidth*u._heightmapWidth;c==="DEM_Byte"?(v=new Uint8Array(p),_=new Float32Array(x)):c==="DEM_UInt16"||c==="DEM_UInt"?(v=new Uint16Array(p),_=new Float32Array(x)):c==="DEM_Int16"||c==="DEM_Int"||c==="TDF_DEM_Int16"?(v=new Int16Array(p),_=new Float32Array(x)):c==="DEM_UInt32"?(v=new Uint32Array(p),_=new Float32Array(x)):c==="DEM_Int32"?(v=new Int32Array(p),_=new Float32Array(x)):c==="DEM_Float32"||c==="DEM_Float"||c==="TDF_DEM_Float"?(v=new Float32Array(p),_=new Float32Array(x)):(c==="DEM_Float64"||c==="DEM_Double"||c==="TDF_DEM_Double")&&(v=new Float64Array(p),_=new Float64Array(x));let E=!1;if(l===u._heightmapWidth)for(let S=0;S<u._heightmapWidth;++S)for(let I=0;I<u._heightmapWidth;++I){let P=S*u._heightmapWidth+I;!isNaN(v[P])&&v[P]<9999&&v[P]>-2e4?_[P]=v[P]:y.push(P)}else{let S=0,I=0,P=u._tilingScheme.tileXYToRectangle(e,t,r),w=Cesium.Math.toDegrees(P.west),N=Cesium.Math.toDegrees(P.south),B=Cesium.Math.toDegrees(P.east),C=Cesium.Math.toDegrees(P.north);r>h&&(E=!0);let b=(C-N)/(u._heightmapWidth-1),T=(B-w)/(u._heightmapWidth-1);for(let A=0;A<u._heightmapWidth;++A){S=A==u._heightmapWidth-1?N:C-A*b;for(let R=0;R<u._heightmapWidth;++R){I=R==u._heightmapWidth-1?B:w+R*T,I>180?I=I-360:I<-180&&(I=360+I),S>90?S=180-S:S<-90&&(S=-S-180);let F=S,D=I,O=function(Y,W,K,re,ce,Se,de){if(!v||v.length===0)return 0;let Ae=K-Y,ye=W-re,Ie=Ae*(de-1)/(K-ce),$=ye*(de-1)/(Se-re),De=Math.floor(Ie),se=Math.ceil(Ie),be=Math.floor($),lr=Math.ceil($);De>=de&&(De=de-1),se>=de&&(se=de-1),be>=de&&(be=de-1),lr>=de&&(lr=de-1);let kt=Ie-De,Br=De*de+be,fn=Br+1,en=se*de+be,fi=en+1;v.length>0&&Br>=v.length&&(Br=v.length-1),v.length>0&&fn>=v.length&&(fn=v.length-1),v.length>0&&en>=v.length&&(en=v.length-1),v.length>0&&fi>=v.length&&(fi=v.length-1);let $i=0,li=0,xt=v.byteLength,At=!0,yn=0;(c=="DEM_Float32"||c=="DEM_Float")&&(Br*4>xt||en*4>xt||fn*4>xt||fi*4>xt)&&(At=!1);let St=v[Br];At&&!ml(St)&&(At=!1);let Vr=v[en];At&&!ml(Vr)&&(At=!1);let Js=v[fn];At&&!ml(Js)&&(At=!1);let Mu=v[fi];return At&&!ml(Mu)&&(At=!1),At&&($i=St*(1-kt)+Vr*kt,li=Js*(1-kt)+Mu*kt),Math.abs($i)>1e5&&(At=!1),Math.abs(li)>1e5&&(At=!1),At&&(kt=$-be,yn=$i*(1-kt)+li*kt),yn},U=A*u._heightmapWidth+R,q=O(F,D,C,w,N,B,l);isNaN(q)||(_[U]=q)}}}return _&&_.length>0?new Cesium.HeightmapTerrainData({buffer:_,width:u._heightmapWidth,height:u._heightmapWidth,childTileMask:pl(u,e,t,r),structure:u._terrainDataStructure,createdByUpsampling:E,invalidHeightIndex:y}):new Cesium.HeightmapTerrainData({buffer:new Float32Array(x),width:u._heightmapWidth,height:u._heightmapWidth,childTileMask:pl(u,e,t,r),structure:u._terrainDataStructure,createdByUpsampling:E})})};Yn.prototype.getLevelMaximumGeometricError=function(e){return this._levelZeroMaximumGeometricError/(1<<e)};function pl(e,t,r,n){let i=e._tilingScheme,s=e._demLayerCollection.getRectangles(),a=i.tileXYToRectangle(t,r,n),o=15;if(n>e._demLayerCollection._maxLevel-1)return 0;for(let u=0;u<s.length&&o!==15;++u){let f=s[u];if(f.maxLevel<=n)continue;let l=f.rectangle,c=new Cesium.Rectangle,h=Cesium.Rectangle.intersection(l,a,c);Cesium.defined(h)&&(dl(i,l,t*2,r*2,n+1,c)&&(o|=4),dl(i,l,t*2+1,r*2,n+1,c)&&(o|=8),dl(i,l,t*2,r*2+1,n+1,c)&&(o|=1),dl(i,l,t*2+1,r*2+1,n+1,c)&&(o|=2))}return o}function dl(e,t,r,n,i,s){let a=e.tileXYToRectangle(r,n,i);return Cesium.defined(Cesium.Rectangle.intersection(a,t,s))}function ml(e){return Math.abs(Math.abs(e)-9999)>1e-4}Yn.prototype.getTileDataAvailable=function(e,t,r){return this._demLayerCollection.isTileDataAvailable(e,t,r)};Yn.prototype.addTerrainModifyInfo=function(e){if(!Cesium.defined(e)||!Cesium.defined(e.name)||!Cesium.defined(e.terrainModifyType)||!Cesium.defined(e.points)||!Cesium.defined(e.value))throw new Cesium.DeveloperError("terrainModifyInfo name,terrainModifyType,polygonGraphics,value is required.");return this._terrainModifyInfoCollection.contains(e.name)?(console.log("\u5730\u5F62\u4FEE\u6539\u540D\u79F0\u5DF2\u7ECF\u5B58\u5728"),!1):(this._terrainModifyInfoCollection.set(e.name,e),!0)};Yn.prototype.containsTerrainModifyInfo=function(e){return this._terrainModifyInfoCollection.contains(e)};Yn.prototype.removeTerrainModifyInfo=function(e){this._terrainModifyInfoCollection.contains(e)&&this._terrainModifyInfoCollection.remove(e)};Yn.prototype.removeAllTerrainModifyInfo=function(){this._terrainModifyInfoCollection.removeAll()};Yn.prototype.getTerrainModifyInfo=function(e){return this._terrainModifyInfoCollection.contains(e)?this._terrainModifyInfoCollection.get(e):null};var _h=Yn;function nE(e){let t=new ph;t._tilingScheme=new Cesium.WebMercatorTilingScheme;let r=new vh({name:e.name,url:e.url}),n=t.addDEMLayer(r),i=new _h({demLayerCollection:t});return Cesium.defined(n)&&n.readyPromise.then(function(){i._heightmapWidth=Cesium.defaultValue(n._heightMapWidth,65),i._demLayerCollection=t,i._tilingScheme=t._tilingScheme,i._levelZeroMaximumGeometricError=Cesium.TerrainProvider.getEstimatedLevelZeroGeometricErrorForAHeightmap(Cesium.Ellipsoid.WGS84,i._heightmapWidth,i._tilingScheme.getNumberOfXTilesAtLevel(0)),e.scene.terrainProvider=i}),i}var Ch=nE;/**
  @license
  when.js - https://github.com/cujojs/when

  MIT License (c) copyright B Cavalier & J Hann

 * A lightweight CommonJS Promises/A and when() implementation
 * when is part of the cujo.js family of libraries (http://cujojs.com/)
 *
 * Licensed under the MIT License at:
 * http://www.opensource.org/licenses/mit-license.php
 *
 * @version 1.7.1
 */var rg,ng,gl;cr.defer=Ru;cr.resolve=So;cr.reject=iE;cr.join=oE;cr.all=ag;cr.map=xh;cr.reduce=uE;cr.any=aE;cr.some=sg;cr.chain=fE;cr.isPromise=ig;function cr(e,t,r,n){return So(e).then(t,r,n)}function So(e){var t,r;return e instanceof Du?t=e:ig(e)?(r=Ru(),e.then(function(n){r.resolve(n)},function(n){r.reject(n)},function(n){r.progress(n)}),t=r.promise):t=sE(e),t}function iE(e){return cr(e,To)}function Du(e){this.then=e}Du.prototype={always:function(e,t){return this.then(e,e,t)},otherwise:function(e){return this.then(gl,e)},catch:function(e){return this.then(gl,e)},yield:function(e){return this.then(function(){return e})},spread:function(e){return this.then(function(t){return ag(t,function(r){return e.apply(gl,r)})})}};function sE(e){var t=new Du(function(r){try{return So(r?r(e):e)}catch(n){return To(n)}});return t}function To(e){var t=new Du(function(r,n){try{return n?So(n(e)):To(e)}catch(i){return To(i)}});return t}function Ru(){var e,t,r,n,i,s,a;return t=new Du(o),e={then:o,resolve:u,reject:f,progress:l,promise:t,resolver:{resolve:u,reject:f,progress:l}},r=[],n=[],i=function(c,h,d){var m,g;return m=Ru(),g=typeof d=="function"?function(p){try{m.progress(d(p))}catch(v){m.progress(v)}}:function(p){m.progress(p)},r.push(function(p){p.then(c,h).then(m.resolve,m.reject,g)}),n.push(g),m.promise},s=function(c){return tg(n,c),c},a=function(c){return c=So(c),i=c.then,a=So,s=yh,tg(r,c),n=r=gl,c},e;function o(c,h,d){return i(c,h,d)}function u(c){return a(c)}function f(c){return a(To(c))}function l(c){return s(c)}}function ig(e){return e&&typeof e.then=="function"}function sg(e,t,r,n,i){return og(2,arguments),cr(e,function(s){var a,o,u,f,l,c,h,d,m,g;if(m=s.length>>>0,a=Math.max(0,Math.min(t,m)),u=[],o=m-a+1,f=[],l=Ru(),!a)l.resolve(u);else for(d=l.progress,h=function(_){f.push(_),--o||(c=h=yh,l.reject(f))},c=function(_){u.push(_),--a||(c=h=yh,l.resolve(u))},g=0;g<m;++g)g in s&&cr(s[g],v,p,d);return l.then(r,n,i);function p(_){h(_)}function v(_){c(_)}})}function aE(e,t,r,n){function i(s){return t?t(s[0]):s[0]}return sg(e,1,i,r,n)}function ag(e,t,r,n){return og(1,arguments),xh(e,ug).then(t,r,n)}function oE(){return xh(arguments,ug)}function xh(e,t){return cr(e,function(r){var n,i,s,a,o,u;if(s=i=r.length>>>0,n=[],u=Ru(),!s)u.resolve(n);else for(a=function(l,c){cr(l,t).then(function(h){n[c]=h,--s||u.resolve(n)},u.reject)},o=0;o<i;o++)o in r?a(r[o],o):--s;return u.promise})}function uE(e,t){var r=ng.call(arguments,1);return cr(e,function(n){var i;return i=n.length,r[0]=function(s,a,o){return cr(s,function(u){return cr(a,function(f){return t(u,f,o,i)})})},rg.apply(n,r)})}function fE(e,t,r){var n=arguments.length>2;return cr(e,function(i){return i=n?r:i,t.resolve(i),i},function(i){return t.reject(i),To(i)},t.progress)}function tg(e,t){for(var r,n=0;r=e[n++];)r(t)}function og(e,t){for(var r,n=t.length;n>e;)if(r=t[--n],r!=null&&typeof r!="function")throw new Error("arg "+n+" must be a function")}function yh(){}ng=[].slice;rg=[].reduce||function(e){var t,r,n,i,s;if(s=0,t=Object(this),i=t.length>>>0,r=arguments,r.length<=1)for(;;){if(s in t){n=t[s++];break}if(++s>=i)throw new TypeError}else n=r[1];for(;s<i;++s)s in t&&(n=e(n,t[s],s,t));return n};function ug(e){return e}var Ne=cr;function lE(e,t,r,n){if(typeof e.fill=="function")return e.fill(t,r,n);for(var i=e.length>>>0,s=Cesium.defaultValue(r,0),a=s<0?Math.max(i+s,0):Math.min(s,i),o=Cesium.defaultValue(n,i),u=o<0?Math.max(i+o,0):Math.min(o,i);a<u;)e[a]=t,a++;return e}var Ba=lE;function Ri(e){e=Cesium.defaultValue(e,Cesium.defaultValue.EMPTY_OBJECT);var t=e.context,r=e.width,n=e.height,i=e.source,s=1;Cesium.defined(i)&&Cesium.defined(i.length)&&i.length>0&&!Cesium.defined(i.arrayBufferView)&&(i.arrayBufferView={},i.arrayBufferView.byteLength=i[0].bufferView.byteLength,s=i.length),Cesium.defined(i)&&(Cesium.defined(r)||(r=Cesium.defaultValue(i.videoWidth,i.width)),Cesium.defined(n)||(n=Cesium.defaultValue(i.videoHeight,i.height)));var a=Cesium.defaultValue(e.pixelFormat,Cesium.PixelFormat.RGBA),o=Cesium.defaultValue(e.pixelDatatype,Cesium.PixelDatatype.UNSIGNED_BYTE),u=a,f=Cesium.PixelFormat.isCompressedFormat(u);if(t.webgl2){if(a===Cesium.PixelFormat.DEPTH_STENCIL?u=Cesium.WebGLConstants.DEPTH24_STENCIL8:a===Cesium.PixelFormat.DEPTH_COMPONENT&&(o===Cesium.PixelDatatype.UNSIGNED_SHORT?u=Cesium.WebGLConstants.DEPTH_COMPONENT16:o===Cesium.PixelDatatype.UNSIGNED_INT&&(u=Cesium.WebGLConstants.DEPTH_COMPONENT24)),o===Cesium.PixelDatatype.FLOAT)switch(a){case Cesium.PixelFormat.RGBA:u=Cesium.WebGLConstants.RGBA32F;break;case Cesium.PixelFormat.RGB:u=Cesium.WebGLConstants.RGB32F;break;case Cesium.PixelFormat.RG:u=Cesium.WebGLConstants.RG32F;break;case Cesium.PixelFormat.R:u=Cesium.WebGLConstants.R32F;break}else if(o===Cesium.PixelDatatype.HALF_FLOAT)switch(a){case Cesium.PixelFormat.RGBA:u=Cesium.WebGLConstants.RGBA16F;break;case Cesium.PixelFormat.RGB:u=Cesium.WebGLConstants.RGB16F;break;case Cesium.PixelFormat.RG:u=Cesium.WebGLConstants.RG16F;break;case Cesium.PixelFormat.R:u=Cesium.WebGLConstants.R16F;break}}var l=e.preMultiplyAlpha||a===Cesium.PixelFormat.RGB||a===Cesium.PixelFormat.LUMINANCE,c=Cesium.defaultValue(e.flipY,!0),h=!0,d=t._gl,m=d.TEXTURE_2D,g=d.createTexture();d.activeTexture(d.TEXTURE0),d.bindTexture(m,g),t.webgl2&&o===Cesium.PixelDatatype.HALF_FLOAT&&(o=Cesium.WebGLConstants.HALF_FLOAT);var p=4;if(Cesium.defined(i)&&Cesium.defined(i.arrayBufferView)&&!f&&(p=Cesium.PixelFormat.alignmentInBytes(a,o,r)),d.pixelStorei(d.UNPACK_ALIGNMENT,p),Cesium.defined(i))if(Cesium.defined(i.arrayBufferView)){d.pixelStorei(d.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),d.pixelStorei(d.UNPACK_FLIP_Y_WEBGL,!1);var v=i.arrayBufferView;if(f)if(Cesium.defined(i.length)&&i.length>0){var _=r,y=n,x=0,E=0;if(t.webgl2){for(var S=0,I=0,P=[],w=_,N=y;s===1||w>=1||N>=1;){var B=Cesium.PixelFormat.compressedTextureSizeInBytes(u,w,N),C;if(E<s?(C=i[E].bufferView,P.push({level:E,width:w,height:N,offset:S,imageSize:C.length}),E<s-1&&(S+=C.byteLength),I+=C.byteLength,x+=B):P.push({level:E,width:w,height:N,offset:S,imageSize:B}),w==1&&N==1||s===1)break;w!=1&&(w/=2),N!=1&&(N/=2),E++}for(var b=0,T=new Uint8Array(I),A=0;A<i.length&&P.length>=i.length;A++)T.set(i[A].bufferView,b),b+=i[A].bufferView.length;var R=d.createBuffer();d.bindBuffer(d.PIXEL_UNPACK_BUFFER,R),d.bufferData(d.PIXEL_UNPACK_BUFFER,T,d.STATIC_DRAW);for(var F=0;F<P.length;F++)d.compressedTexImage2D(m,P[F].level,u,P[F].width,P[F].height,0,P[F].imageSize,P[F].offset);d.bindBuffer(d.PIXEL_UNPACK_BUFFER,null)}else for(;s===1||_>=1||y>=1;){let Y=Cesium.PixelFormat.compressedTextureSizeInBytes(u,_,y),W;if(E<s?W=i[E].bufferView:W=i[s-1].bufferView.subarray(0,Y),d.compressedTexImage2D(m,E,u,_,y,0,W),_==1&&y==1||s===1)break;_!=1&&(_/=2),y!=1&&(y/=2),x+=Y,E++}s=E}else if(t.webgl2){var R=d.createBuffer();d.bindBuffer(d.PIXEL_UNPACK_BUFFER,R),d.bufferData(d.PIXEL_UNPACK_BUFFER,v,d.STATIC_DRAW),d.compressedTexImage2D(m,0,u,r,n,0,v.length,0),d.bindBuffer(d.PIXEL_UNPACK_BUFFER,null)}else d.compressedTexImage2D(m,0,u,r,n,0,v);else if(c&&(v=Cesium.PixelFormat.flipY(v,a,o,r,n)),d.texImage2D(m,0,u,r,n,0,a,o,v),Cesium.defined(i.mipLevels))for(var D=r,O=n,U=0;U<i.mipLevels.length;++U)D=Math.floor(D/2)|0,D<1&&(D=1),O=Math.floor(O/2)|0,O<1&&(O=1),d.texImage2D(m,U+1,u,D,O,0,a,o,i.mipLevels[U])}else Cesium.defined(i.framebuffer)?(d.pixelStorei(d.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),d.pixelStorei(d.UNPACK_FLIP_Y_WEBGL,!1),i.framebuffer!==t.defaultFramebuffer&&i.framebuffer._bind(),d.copyTexImage2D(m,0,u,i.xOffset,i.yOffset,r,n,0),i.framebuffer!==t.defaultFramebuffer&&i.framebuffer._unBind()):(d.pixelStorei(d.UNPACK_PREMULTIPLY_ALPHA_WEBGL,l),d.pixelStorei(d.UNPACK_FLIP_Y_WEBGL,c),d.texImage2D(m,0,u,a,o,i));else d.texImage2D(m,0,u,r,n,0,a,o,null),h=!1;d.bindTexture(m,null);var q;f?q=Cesium.PixelFormat.compressedTextureSizeInBytes(a,r,n):q=Cesium.PixelFormat.textureSizeInBytes(a,o,r,n),this._id=Cesium.createGuid(),this._context=t,this._textureFilterAnisotropic=t._textureFilterAnisotropic,this._textureTarget=m,this._texture=g,this._pixelFormat=a,this._pixelDatatype=o,this._width=r,this._height=n,this._dimensions=new Cesium.Cartesian2(r,n),this._hasMipmap=!1,this._sizeInBytes=q,this._preMultiplyAlpha=l,this._flipY=c,this._initialized=h,this._sampler=void 0,this.sampler=Cesium.defined(e.sampler)?e.sampler:new Cesium.Sampler}Ri.create=function(e){return new Ri(e)};Ri.fromFramebuffer=function(e){e=Cesium.defaultValue(e,Cesium.defaultValue.EMPTY_OBJECT);var t=e.context,r=t._gl,n=Cesium.defaultValue(e.pixelFormat,Cesium.PixelFormat.RGB),i=Cesium.defaultValue(e.framebufferXOffset,0),s=Cesium.defaultValue(e.framebufferYOffset,0),a=Cesium.defaultValue(e.width,r.drawingBufferWidth),o=Cesium.defaultValue(e.height,r.drawingBufferHeight),u=e.framebuffer,f=new Ri({context:t,width:a,height:o,pixelFormat:n,source:{framebuffer:Cesium.defined(u)?u:t.defaultFramebuffer,xOffset:i,yOffset:s,width:a,height:o}});return f};Object.defineProperties(Ri.prototype,{id:{get:function(){return this._id}},sampler:{get:function(){return this._sampler},set:function(e){var t=e.minificationFilter,r=e.magnificationFilter,n=t===Cesium.TextureMinificationFilter.NEAREST_MIPMAP_NEAREST||t===Cesium.TextureMinificationFilter.NEAREST_MIPMAP_LINEAR||t===Cesium.TextureMinificationFilter.LINEAR_MIPMAP_NEAREST||t===Cesium.TextureMinificationFilter.LINEAR_MIPMAP_LINEAR,i=this._context,s=this._pixelDatatype;(s===Cesium.PixelDatatype.FLOAT&&!i.textureFloatLinear||s===Cesium.PixelDatatype.HALF_FLOAT&&!i.textureHalfFloatLinear)&&(t=n?Cesium.TextureMinificationFilter.NEAREST_MIPMAP_NEAREST:Cesium.TextureMinificationFilter.NEAREST,r=Cesium.TextureMagnificationFilter.NEAREST);var a=i._gl,o=this._textureTarget;a.activeTexture(a.TEXTURE0),a.bindTexture(o,this._texture),a.texParameteri(o,a.TEXTURE_MIN_FILTER,t),a.texParameteri(o,a.TEXTURE_MAG_FILTER,r),a.texParameteri(o,a.TEXTURE_WRAP_S,e.wrapS),a.texParameteri(o,a.TEXTURE_WRAP_T,e.wrapT),Cesium.defined(this._textureFilterAnisotropic)&&a.texParameteri(o,this._textureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,e.maximumAnisotropy),a.bindTexture(o,null),this._sampler=e}},pixelFormat:{get:function(){return this._pixelFormat}},pixelDatatype:{get:function(){return this._pixelDatatype}},dimensions:{get:function(){return this._dimensions}},preMultiplyAlpha:{get:function(){return this._preMultiplyAlpha}},flipY:{get:function(){return this._flipY}},width:{get:function(){return this._width}},height:{get:function(){return this._height}},sizeInBytes:{get:function(){return this._hasMipmap?Math.floor(this._sizeInBytes*4/3):this._sizeInBytes}},_target:{get:function(){return this._textureTarget}}});Ri.prototype.copyFrom=function(e,t,r){t=Cesium.defaultValue(t,0),r=Cesium.defaultValue(r,0);var n=this._context._gl,i=this._textureTarget;n.activeTexture(n.TEXTURE0),n.bindTexture(i,this._texture);var s=e.width,a=e.height,o=e.arrayBufferView,u=this._width,f=this._height,l=this._pixelFormat,c=this._pixelDatatype,h=this._preMultiplyAlpha,d=this._flipY,m=4;Cesium.defined(o)&&(m=Cesium.PixelFormat.alignmentInBytes(l,c,s)),n.pixelStorei(n.UNPACK_ALIGNMENT,m);var g=!1;if(!this._initialized){if(t===0&&r===0&&s===u&&a===f)Cesium.defined(o)?(n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,!1),d&&(o=Cesium.PixelFormat.flipY(o,l,c,u,f)),n.texImage2D(i,0,l,u,f,0,l,c,o)):(n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,h),n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,d),n.texImage2D(i,0,l,l,c,e)),g=!0;else{n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,!1);var p=Cesium.PixelFormat.createTypedArray(l,c,u,f);n.texImage2D(i,0,l,u,f,0,l,c,p)}this._initialized=!0}g||(Cesium.defined(o)?(n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,!1),d&&(o=Cesium.PixelFormat.flipY(o,l,c,s,a)),n.texSubImage2D(i,0,t,r,s,a,l,c,o)):(n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,h),n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,d),t==0&&r==0?n.texImage2D(i,0,l,l,c,e):n.texSubImage2D(i,0,t,r,l,c,e)))};Ri.prototype.copyFromFramebuffer=function(e,t,r,n,i,s){e=Cesium.defaultValue(e,0),t=Cesium.defaultValue(t,0),r=Cesium.defaultValue(r,0),n=Cesium.defaultValue(n,0),i=Cesium.defaultValue(i,this._width),s=Cesium.defaultValue(s,this._height);var a=this._context._gl,o=this._textureTarget;a.activeTexture(a.TEXTURE0),a.bindTexture(o,this._texture),a.copyTexSubImage2D(o,0,e,t,r,n,i,s),a.bindTexture(o,null),this._initialized=!0};Ri.prototype.generateMipmap=function(e){e=Cesium.defaultValue(e,Cesium.MipmapHint.DONT_CARE),this._hasMipmap=!0;var t=this._context._gl,r=this._textureTarget;t.hint(t.GENERATE_MIPMAP_HINT,e),t.activeTexture(t.TEXTURE0),t.bindTexture(r,this._texture),t.generateMipmap(r),t.bindTexture(r,null)};Ri.prototype.isDestroyed=function(){return!1};Ri.prototype.destroy=function(){return this._context._gl.deleteTexture(this._texture),Cesium.destroyObject(this)};var Ir=Ri;var Ou=Cesium.Color.WHITE,bh=!0,cE=Cesium.Cartesian3.ZERO;function Ct(e,t,r,n,i){this.featuresLength=t,this._translucentFeaturesLength=0;var s;Cesium.defined(r)&&(s=r.extensions),this._extensions=Cesium.defaultValue(s,{});var a=hE(r);this._properties=a,dE(r,e),this._batchTableHierarchy=mE(this,r,n),this._batchTableBinaryProperties=wh(t,a,n),this._showAlphaProperties=void 0,this._batchValues=void 0,this._batchValuesDirty=!1,this._batchTexture=void 0,this._defaultTexture=void 0,this._transValues=void 0,this._translationTexture=void 0,this._defaultTransTexture=void 0,this._scaleValues=void 0,this._scaleTexture=void 0,this._defaultScaleTexture=void 0,this._rotationValues=void 0,this._rotationTexture=void 0,this._defaultRotationTexture=void 0,this._pickTexture=void 0,this._pickIds=[],this._content=e,this._colorChangedCallback=i;var o,u;if(t>0){var f=Math.min(t,Cesium.ContextLimits.maximumTextureSize),l=Math.ceil(t/Cesium.ContextLimits.maximumTextureSize),c=1/f,h=c*.5,d=1/l,m=d*.5;o=new Cesium.Cartesian2(f,l),u=new Cesium.Cartesian4(c,h,d,m)}this._textureDimensions=o,this._textureStep=u}Ct._deprecationWarning=Cesium.deprecationWarning;Object.defineProperties(Ct.prototype,{memorySizeInBytes:{get:function(){var e=0;return Cesium.defined(this._pickTexture)&&(e+=this._pickTexture.sizeInBytes),Cesium.defined(this._batchTexture)&&(e+=this._batchTexture.sizeInBytes),Cesium.defined(this._translationTexture)&&(e+=this._translationTexture.sizeInBytes),Cesium.defined(this._scaleTexture)&&(e+=this._scaleTexture.sizeInBytes),Cesium.defined(this._rotationTexture)&&(e+=this._rotationTexture.sizeInBytes),e}}});function hE(e){var t={};if(!Cesium.defined(e))return t;for(var r in e)e.hasOwnProperty(r)&&r!=="HIERARCHY"&&r!=="extensions"&&r!=="extras"&&(t[r]=Cesium.clone(e[r],!0));return t}function dE(e,t){if(!(!Cesium.defined(e)||!Cesium.defined(e.extensions))){var r=e.extensions["3DTILES_batch_table_EVFORMAT"];if(Cesium.defined(r)){var n=t._tileset,i=t._tile,s=r.children;n.addNode_ev(i,s)}}}function mE(e,t,r){if(Cesium.defined(t)){var n=e._extensions["3DTILES_batch_table_hierarchy"],i=t.HIERARCHY;if(Cesium.defined(i)&&(Ct._deprecationWarning("batchTableHierarchyExtension","The batch table HIERARCHY property has been moved to an extension. Use extensions.3DTILES_batch_table_hierarchy instead."),e._extensions["3DTILES_batch_table_hierarchy"]=i,n=i),!!Cesium.defined(n))return pE(n,r)}}function pE(e,t){var r,n,i,s=e.instancesLength,a=e.classes,o=e.classIds,u=e.parentCounts,f=e.parentIds,l=s;Cesium.defined(o.byteOffset)&&(o.componentType=Cesium.defaultValue(o.componentType,Cesium.ComponentDatatype.UNSIGNED_SHORT),o.type=Cesium.AttributeType.SCALAR,i=Cesium.getBinaryAccessor(o),o=i.createArrayBufferView(t.buffer,t.byteOffset+o.byteOffset,s));var c;if(Cesium.defined(u))for(Cesium.defined(u.byteOffset)&&(u.componentType=Cesium.defaultValue(u.componentType,Cesium.ComponentDatatype.UNSIGNED_SHORT),u.type=Cesium.AttributeType.SCALAR,i=Cesium.getBinaryAccessor(u),u=i.createArrayBufferView(t.buffer,t.byteOffset+u.byteOffset,s)),c=new Uint16Array(s),l=0,r=0;r<s;++r)c[r]=l,l+=u[r];Cesium.defined(f)&&Cesium.defined(f.byteOffset)&&(f.componentType=Cesium.defaultValue(f.componentType,Cesium.ComponentDatatype.UNSIGNED_SHORT),f.type=Cesium.AttributeType.SCALAR,i=Cesium.getBinaryAccessor(f),f=i.createArrayBufferView(t.buffer,t.byteOffset+f.byteOffset,l));var h=a.length;for(r=0;r<h;++r){var d=a[r].length,m=a[r].instances,g=wh(d,m,t);a[r].instances=Cesium.combine(g,m)}var p=Ba(new Array(h),0),v=new Uint16Array(s);for(r=0;r<s;++r)n=o[r],v[r]=p[n],++p[n];var _={classes:a,classIds:o,classIndexes:v,parentCounts:u,parentIndexes:c,parentIds:f};return _}function wh(e,t,r){var n;for(var i in t)if(t.hasOwnProperty(i)){var s=t[i],a=s.byteOffset;if(Cesium.defined(a)){var o=s.componentType,u=s.type;if(!Cesium.defined(o))throw new Cesium.RuntimeError("componentType is required.");if(!Cesium.defined(u))throw new Cesium.RuntimeError("type is required.");if(!Cesium.defined(r))throw new Cesium.RuntimeError("Property "+i+" requires a batch table binary.");var f=Cesium.getBinaryAccessor(s),l=f.componentsPerAttribute,c=f.classType,h=f.createArrayBufferView(r.buffer,r.byteOffset+a,e);Cesium.defined(n)||(n={}),n[i]={typedArray:h,componentCount:l,type:c}}}return n}Ct.getBinaryProperties=function(e,t,r){return wh(e,t,r)};function Nu(e){var t=e._textureDimensions;return t.x*t.y*4}function lg(e){if(!Cesium.defined(e._batchValues)){var t=Nu(e),r=new Uint8Array(t);Ba(r,255),e._batchValues=r}return e._batchValues}function gE(e){if(!Cesium.defined(e._transValues)){var t=Nu(e),r=new Float32Array(t);Ba(r,0),e._transValues=r}return e._transValues}function vE(e){if(!Cesium.defined(e._scaleValues)){var t=Nu(e),r=new Float32Array(t);Ba(r,1),e._scaleValues=r}return e._scaleValues}function _E(e){if(!Cesium.defined(e._rotationValues)){for(var t=Nu(e),r=new Float32Array(t),n=0;n<t;n+=4)r[n]=0,r[n+1]=0,r[n+2]=0,r[n+3]=1;e._rotationValues=r}return e._rotationValues}function cg(e){if(!Cesium.defined(e._showAlphaProperties)){var t=2*e.featuresLength,r=new Uint8Array(t);Ba(r,255),e._showAlphaProperties=r}return e._showAlphaProperties}Ct.prototype.setShow=function(e,t){if(!(t&&!Cesium.defined(this._showAlphaProperties))){var r=cg(this),n=e*2,i=t?255:0;if(r[n]!==i){r[n]=i;var s=lg(this),a=e*4+3;s[a]=t?r[n+1]:0,this._batchValuesDirty=!0}}};Ct.prototype.setAllShow=function(e){for(var t=this.featuresLength,r=0;r<t;++r)this.setShow(r,e)};Ct.prototype.hasPropertyBySemantic=function(){return!1};Ct.prototype.getShow=function(e){if(!Cesium.defined(this._showAlphaProperties))return!0;var t=e*2;return this._showAlphaProperties[t]===255};var CE=new Array(4);Ct.prototype.setColor=function(e,t){if(!(Cesium.Color.equals(t,Ou)&&!Cesium.defined(this._batchValues))){var r=t.toBytes(CE),n=r[3],i=lg(this),s=e*4,a=cg(this),o=e*2;if(i[s]!==r[0]||i[s+1]!==r[1]||i[s+2]!==r[2]||a[o+1]!==n){i[s]=r[0],i[s+1]=r[1],i[s+2]=r[2];var u=a[o+1]!==255,f=a[o]!==0;i[s+3]=f?n:0,a[o+1]=n;var l=n!==255;l&&!u?++this._translucentFeaturesLength:!l&&u&&--this._translucentFeaturesLength,this._batchValuesDirty=!0,Cesium.defined(this._colorChangedCallback)&&this._colorChangedCallback(e,t)}}};Ct.prototype.setTranslation=function(e,t){if(!(Cesium.Cartesian3.equals(t,cE)&&!Cesium.defined(this._transValues))){Cesium.defined(this.upMatrix)&&Cesium.Matrix4.multiplyByPoint(this.upMatrix,t,t);var r=[];r.push(t.x/1),r.push(t.y/1),r.push(t.z/1);var n=gE(this),i=e*4;(n[i]!==r[0]||n[i+1]!==r[1]||n[i+2]!==r[2])&&(n[i]=r[0],n[i+1]=r[1],n[i+2]=r[2],this._batchValuesDirty=!0)}};var yE=new Cesium.Cartesian3(1,1,1);Ct.prototype.setScale=function(e,t){if(!(Cesium.Cartesian3.equals(t,yE)&&!Cesium.defined(this._scaleValues))){if(Cesium.defined(this.upMatrix)){var r=t.y;t.y=t.z,t.z=r}var n=[];n.push(t.x/1),n.push(t.y/1),n.push(t.z/1);var i=vE(this),s=e*4;(i[s]!==n[0]||i[s+1]!==n[1]||i[s+2]!==n[2])&&(i[s]=n[0],i[s+1]=n[1],i[s+2]=n[2],this._batchValuesDirty=!0)}};var xE=new Cesium.Cartesian4(0,0,0,1);Ct.prototype.setRotation=function(e,t){if(!(Cesium.Cartesian4.equals(t,xE)&&!Cesium.defined(this._rotationValues))){if(Cesium.defined(this.upMatrix)){var r=new Cesium.Quaternion(t.x,t.y,t.z,t.w),n=Cesium.Quaternion.computeAngle(r),i=Cesium.Quaternion.computeAxis(r,new Cesium.Cartesian3);Cesium.Matrix4.multiplyByPoint(this.upMatrix,i,i),t=Cesium.Quaternion.fromAxisAngle(i,n)}var s=[];s.push(t.x),s.push(t.y),s.push(t.z),s.push(t.w);var a=_E(this),o=e*4;(a[o]!==s[0]||a[o+1]!==s[1]||a[o+2]!==s[2]||a[o+3]!==s[3])&&(a[o]=s[0],a[o+1]=s[1],a[o+2]=s[2],a[o+3]=s[3],this._batchValuesDirty=!0)}};Ct.prototype.setAllColor=function(e){for(var t=this.featuresLength,r=0;r<t;++r)this.setColor(r,e)};Ct.prototype.getColor=function(e,t){if(!Cesium.defined(this._batchValues))return Cesium.Color.clone(Ou,t);var r=this._batchValues,n=e*4,i=this._showAlphaProperties,s=e*2;return Cesium.Color.fromBytes(r[n],r[n+1],r[n+2],i[s+1],t)};Ct.prototype.getPickColor=function(e){return this._pickIds[e]};var EE=new Cesium.Color;Ct.prototype.applyStyle=function(e){if(!Cesium.defined(e)){this.setAllColor(Ou),this.setAllShow(bh);return}for(var t=this._content,r=this.featuresLength,n=0;n<r;++n){var i=t.getFeature(n),s=Cesium.defined(e.color)?e.color.evaluateColor(i,EE):Ou,a=Cesium.defined(e.show)?e.show.evaluate(i):bh;if(this.setColor(n,s),this.setShow(n,a),Cesium.defined(e.translation)){var o=e.translation.evaluate(i);this.setTranslation(n,o)}if(Cesium.defined(e.scale)){var u=e.scale.evaluate(i);this.setScale(n,u)}if(Cesium.defined(e.rotation)){var f=e.rotation.evaluate(i);this.setRotation(n,f)}}};function hg(e,t){var r=e.typedArray,n=e.componentCount;return n===1?r[t]:e.type.unpack(r,t*n)}function dg(e,t,r){var n=e.typedArray,i=e.componentCount;i===1?n[t]=r:e.type.pack(r,n,t*i)}var bE=[],wE=[],SE=0;function TE(e,t,r){var n=e.classIds,i=e.parentCounts,s=e.parentIds,a=e.parentIndexes,o=n.length,u=bE;u.length=Math.max(u.length,o);var f=++SE,l=wE;for(l.length=0,l.push(t);l.length>0;)if(t=l.pop(),u[t]!==f){u[t]=f;var c=r(e,t);if(Cesium.defined(c))return c;for(var h=i[t],d=a[t],m=0;m<h;++m){var g=s[d+m];g!==t&&l.push(g)}}}function IE(e,t,r){for(var n=!0;n;){var i=r(e,t);if(Cesium.defined(i))return i;var s=e.parentIds[t];n=s!==t,t=s}}function Fu(e,t,r){var n=e.parentCounts,i=e.parentIds;if(Cesium.defined(i)){if(Cesium.defined(n))return TE(e,t,r)}else return r(e,t);return IE(e,t,r)}function LE(e,t,r){var n=e._batchTableHierarchy,i=Fu(n,t,function(s,a){var o=s.classIds[a],u=s.classes[o].instances;if(Cesium.defined(u[r]))return!0});return Cesium.defined(i)}function PE(e,t,r){var n=e._batchTableHierarchy;Fu(n,t,function(i,s){var a=i.classIds[s],o=i.classes[a].instances;for(var u in o)o.hasOwnProperty(u)&&r.indexOf(u)===-1&&r.push(u)})}function ME(e,t,r){var n=e._batchTableHierarchy;return Fu(n,t,function(i,s){var a=i.classIds[s],o=i.classes[a],u=i.classIndexes[s],f=o.instances[r];if(Cesium.defined(f))return Cesium.defined(f.typedArray)?hg(f,u):Cesium.clone(f[u],!0)})}function AE(e,t,r,n){var i=e._batchTableHierarchy,s=Fu(i,t,function(a,o){var u=a.classIds[o],f=a.classes[u],l=a.classIndexes[o],c=f.instances[r];if(Cesium.defined(c))return Cesium.defined(c.typedArray)?dg(c,l,n):c[l]=Cesium.clone(n,!0),!0});return Cesium.defined(s)}Ct.prototype.isClass=function(e,t){var r=this._batchTableHierarchy;if(!Cesium.defined(r))return!1;var n=Fu(r,e,function(i,s){var a=i.classIds[s],o=i.classes[a];if(o.name===t)return!0});return Cesium.defined(n)};Ct.prototype.isExactClass=function(e,t){return this.getExactClassName(e)===t};Ct.prototype.getExactClassName=function(e){var t=this._batchTableHierarchy;if(Cesium.defined(t)){var r=t.classIds[e],n=t.classes[r];return n.name}};Ct.prototype.hasProperty=function(e,t){return Cesium.defined(this._properties[t])||Cesium.defined(this._batchTableHierarchy)&&LE(this,e,t)};Ct.prototype.getPropertyNames=function(e,t){t=Cesium.defined(t)?t:[],t.length=0;var r=Object.keys(this._properties);return t.push.apply(t,r),Cesium.defined(this._batchTableHierarchy)&&PE(this,e,t),t};Ct.prototype.getProperty=function(e,t){if(Cesium.defined(this._batchTableBinaryProperties)){var r=this._batchTableBinaryProperties[t];if(Cesium.defined(r))return hg(r,e)}var n=this._properties[t];if(Cesium.defined(n))return Cesium.clone(n[e],!0);if(Cesium.defined(this._batchTableHierarchy)){var i=ME(this,e,t);if(Cesium.defined(i))return i}};Ct.prototype.setProperty=function(e,t,r){var n=this.featuresLength;if(Cesium.defined(this._batchTableBinaryProperties)){var i=this._batchTableBinaryProperties[t];if(Cesium.defined(i)){dg(i,e,r);return}}if(!(Cesium.defined(this._batchTableHierarchy)&&AE(this,e,t,r))){var s=this._properties[t];Cesium.defined(s)||(this._properties[t]=new Array(n),s=this._properties[t]),s[e]=Cesium.clone(r,!0)}};function DE(e){return e._textureDimensions.y===1?`uniform vec4 tile_textureStep; 
vec2 computeSt(float batchId) 
{ 
    float stepX = tile_textureStep.x; 
    float centerX = tile_textureStep.y; 
    return vec2(centerX + (batchId * stepX), 0.5); 
} 
`:`uniform vec4 tile_textureStep; 
uniform vec2 tile_textureDimensions; 
vec2 computeSt(float batchId) 
{ 
    float stepX = tile_textureStep.x; 
    float centerX = tile_textureStep.y; 
    float stepY = tile_textureStep.z; 
    float centerY = tile_textureStep.w; 
    float xId = mod(batchId, tile_textureDimensions.x); 
    float yId = floor(batchId / tile_textureDimensions.x); 
    return vec2(centerX + (xId * stepX), centerY + (yId * stepY)); 
} 
`}var Eh=`mat4 ev_fromTranslationQuaternionRotationScale(vec3 translation, vec4 quaternion, vec3 scale)
{
      float x2 = quaternion.x * quaternion.x;
      float xy = quaternion.x * quaternion.y;
      float xz = quaternion.x * quaternion.z;
      float xw = quaternion.x * quaternion.w;
      float y2 = quaternion.y * quaternion.y;
      float yz = quaternion.y * quaternion.z;
      float yw = quaternion.y * quaternion.w;
      float z2 = quaternion.z * quaternion.z;
      float zw = quaternion.z * quaternion.w;
      float w2 = quaternion.w * quaternion.w;

      float m00 = x2 - y2 - z2 + w2;
      float m01 = 2.0 * (xy - zw);
      float m02 = 2.0 * (xz + yw);

      float m10 = 2.0 * (xy + zw);
      float m11 = -x2 + y2 - z2 + w2;
      float m12 = 2.0 * (yz - xw);

      float m20 = 2.0 * (xz - yw);
      float m21 = 2.0 * (yz + xw);
      float m22 = -x2 - y2 + z2 + w2;
      return mat4(
        m00 * scale.x , m01* scale.x, m02* scale.x, 0.0,
        m10 * scale.y, m11 * scale.y, m12 * scale.y, 0.0,
        m20 * scale.z, m21 * scale.z, m22 * scale.z, 0.0,
        translation.x, translation.y, translation.z, 1.0);
}
`;Ct.prototype.getVertexShaderCallback=function(e,t,r){if(this.featuresLength!==0){var n=this;return function(i){var s=mg(i,r,!1),a=!1;NO_support_OES_float||(s.indexOf("gl_Position = u_modelViewProj * vec4(a_position,1.0);")!=-1?(a=!0,s=s.replace("attribute vec3 a_position;",`attribute vec3 a_position;
vec4 trans;
vec4 scale;
vec4 rotation;`),s=s.replace("gl_Position = u_modelViewProj * vec4(a_position,1.0);","gl_Position = u_modelViewProj * (ev_fromTranslationQuaternionRotationScale(trans.xyz,rotation,scale.xyz) * vec4(a_position,1.0));"),s=Eh+s):s.indexOf("vec3 gltf_a_dec_position")!=-1?(a=!0,s=s.replace("vec3 gltf_a_dec_position;",`vec3 gltf_a_dec_position;
vec4 trans;
vec4 scale;
vec4 rotation;`),s.indexOf("gl_Position = u_modelViewProj * vec4(gltf_a_dec_position,1.0)")!=-1?s=s.replace("gl_Position = u_modelViewProj * vec4(gltf_a_dec_position,1.0);"," gl_Position = u_modelViewProj * (ev_fromTranslationQuaternionRotationScale(trans.xyz,rotation,scale.xyz) * vec4(gltf_a_dec_position,1.0));"):s.indexOf("gl_Position = czm_instanced_modelViewProjection * vec4(gltf_a_dec_position,1.0)")!=-1?s=s.replace("gltf_a_dec_position = gltf_u_dec_position_min + a_position * gltf_u_dec_position_normConstant;","gltf_a_dec_position = gltf_u_dec_position_min + (ev_fromTranslationQuaternionRotationScale(trans.xyz,rotation,scale.xyz) * vec4(a_position,1.0)).xyz* gltf_u_dec_position_normConstant;"):s.indexOf("xlat_temp_input.position = vec4(gltf_a_dec_position,1.0)")!=-1&&(s=s.replace("xlat_temp_input.position = vec4(gltf_a_dec_position,1.0);","xlat_temp_input.position = ev_fromTranslationQuaternionRotationScale(trans.xyz,rotation,scale.xyz) * vec4(gltf_a_dec_position,1.0);")),s=Eh+s):s.indexOf("position = u_modelViewMatrix * position")!=-1&&(a=!0,s=s.replace("attribute vec3 a_position;",`attribute vec3 a_position;
vec4 trans;
vec4 scale;
vec4 rotation;`),s=s.replace("position = u_modelViewMatrix * position;","position = u_modelViewMatrix * (ev_fromTranslationQuaternionRotationScale(trans.xyz,rotation,scale.xyz) * position);"),s=Eh+s));var o;Cesium.ContextLimits.maximumVertexTextureImageUnits>0?(o="",e&&(o+=`uniform bool tile_translucentCommand; 
`),a&&(o+=`uniform sampler2D tile_transTexture; 
uniform sampler2D tile_scaleTexture; 
uniform sampler2D tile_rotationTexture; 
`),o+=`uniform sampler2D tile_batchTexture; 
uniform sampler2D tile_pickTexture; 
varying vec4 tile_featureColor; 
varying vec2 tile_featureSt; 
void main() 
{ 
    vec2 st = computeSt(`+t+`); 
    vec4 featureProperties = texture2D(tile_batchTexture, st); 
`,a&&(o+=`    trans = texture2D(tile_transTexture, vec2(st.x,0.0)); 
`,o+=`    scale = texture2D(tile_scaleTexture, vec2(st.x,0.0)); 
`,o+=`    rotation = texture2D(tile_rotationTexture, vec2(st.x,0.0)); 
`),o+=`    tile_color(featureProperties); 
    float show = ceil(featureProperties.a); 
    gl_Position *= show; 
`,e&&(o+=`    bool isStyleTranslucent = (featureProperties.a != 1.0); 
    if (czm_pass == czm_passTranslucent) 
    { 
        if (!isStyleTranslucent && !tile_translucentCommand) 
        { 
            gl_Position *= 0.0; 
        } 
    } 
    else 
    { 
        if (isStyleTranslucent) 
        { 
            gl_Position *= 0.0; 
        } 
    } 
`),o+=`    tile_featureColor = featureProperties; 
    tile_featureSt = st; 
}`):o=`varying vec2 tile_featureSt; 
void main() 
{ 
    tile_color(vec4(1.0)); 
    tile_featureSt = computeSt(`+t+`); 
}`;var u=s+`
`+DE(n)+o;return n._content.constructor.name==="Vector3DTileContent"&&n._content._tileset._tilesetFlat&&(u=n._content._tileset._tilesetFlat._updateVertexShader(u)),u}}};function fg(e,t){return e=Cesium.ShaderSource.replaceMain(e,"tile_main"),t?e+`uniform float tile_colorBlend; 
void tile_color(vec4 tile_featureColor) 
{ 
    tile_main(); 
    tile_featureColor = czm_gammaCorrect(tile_featureColor); 
    gl_FragColor.a *= tile_featureColor.a; 
    float highlight = ceil(tile_colorBlend); 
 if(!all(greaterThan(tile_featureColor.rgb, vec3(1.0 - czm_epsilon3)))){ 
	if(highlight== 0.0){
		gl_FragColor.rgb = mix(tile_featureColor.rgb, gl_FragColor.rgb, 0.4);
	}else if(highlight== 1.0){
		gl_FragColor.rgb = tile_featureColor.rgb;
	}else{
		gl_FragColor.rgb *= mix(tile_featureColor.rgb, vec3(1.0), highlight);
	}
 } 
} 
`:e+`void tile_color(vec4 tile_featureColor) 
{ 
    tile_main(); 
} 
`}function RE(e,t){for(var r="texture2D("+t,n=0,i=e.indexOf(r,n),s;i>-1;){for(var a=0,o=i;o<e.length;++o){var u=e.charAt(o);if(u==="(")++a;else if(u===")"&&(--a,a===0)){s=o+1;break}}var f=e.slice(i,s),l="tile_diffuse_final("+f+", tile_diffuse)";e=e.slice(0,i)+l+e.slice(s),n=i+l.length,i=e.indexOf(r,n)}return e}function mg(e,t,r){if(!Cesium.defined(t))return fg(e,r);var n=new RegExp("(uniform|attribute|in)\\s+(vec[34]|sampler2D)\\s+"+t+";"),i=e.match(n);if(!Cesium.defined(i))return fg(e,r);var s=i[0],a=i[2];e=Cesium.ShaderSource.replaceMain(e,"tile_main"),e=e.replace(s,"");var o=`bool isWhite(vec3 color) 
{ 
    return all(greaterThan(color, vec3(1.0 - czm_epsilon3))); 
} 
vec4 tile_diffuse_final(vec4 sourceDiffuse, vec4 tileDiffuse) 
{ 
    vec4 blendDiffuse = mix(sourceDiffuse, tileDiffuse, tile_colorBlend); 
    vec4 diffuse = isWhite(tileDiffuse.rgb) ? sourceDiffuse : blendDiffuse; 
    return vec4(diffuse.rgb, sourceDiffuse.a); 
} 
`,u=`    tile_featureColor = czm_gammaCorrect(tile_featureColor); 
    gl_FragColor.a *= tile_featureColor.a; 
    float highlight = ceil(tile_colorBlend); 
 if(!all(greaterThan(tile_featureColor.rgb, vec3(1.0 - czm_epsilon3)))){ 
	if(highlight== 0.0){
		gl_FragColor.rgb = mix(tile_featureColor.rgb, gl_FragColor.rgb, 0.4);
	}else if(highlight== 1.0){
		gl_FragColor.rgb = tile_featureColor.rgb;
	}else{
		gl_FragColor.rgb *= mix(tile_featureColor.rgb, vec3(1.0), highlight);
	}
 }`,f;if(a==="vec3"||a==="vec4"){var l=a==="vec3"?"vec4("+t+", 1.0)":t,c=a==="vec3"?"tile_diffuse.xyz":"tile_diffuse";n=new RegExp(t,"g"),e=e.replace(n,c),f="    vec4 source = "+l+`; 
    tile_diffuse = tile_diffuse_final(source, tile_featureColor); 
    tile_main(); 
`}else a==="sampler2D"&&(e=RE(e,t),f=`    tile_diffuse = tile_featureColor; 
    tile_main(); 
`);return e=`uniform float tile_colorBlend; 
vec4 tile_diffuse = vec4(1.0); 
`+o+s+`
`+e+`
void tile_color(vec4 tile_featureColor) 
{ 
`+f,r&&(e+=u),e+=`} 
`,e}Ct.prototype.getFragmentShaderCallback=function(e,t){if(this.featuresLength!==0)return function(r){return r=mg(r,t,!0),Cesium.ContextLimits.maximumVertexTextureImageUnits>0?r+=`uniform sampler2D tile_pickTexture; 
varying vec2 tile_featureSt; 
varying vec4 tile_featureColor; 
void main() 
{ 
    tile_color(tile_featureColor); 
}`:(e&&(r+=`uniform bool tile_translucentCommand; 
`),r+=`uniform sampler2D tile_pickTexture; 
uniform sampler2D tile_batchTexture; 
varying vec2 tile_featureSt; 
void main() 
{ 
    vec4 featureProperties = texture2D(tile_batchTexture, tile_featureSt); 
    if (featureProperties.a == 0.0) { 
        discard; 
    } 
`,e&&(r+=`    bool isStyleTranslucent = (featureProperties.a != 1.0); 
    if (czm_pass == czm_passTranslucent) 
    { 
        if (!isStyleTranslucent && !tile_translucentCommand) 
        { 
            discard; 
        } 
    } 
    else 
    { 
        if (isStyleTranslucent) 
        { 
            discard; 
        } 
    } 
`),r+=`    tile_color(featureProperties); 
} 
`),r}};Ct.prototype.getClassificationFragmentShaderCallback=function(){if(this.featuresLength!==0)return function(e){return e=Cesium.ShaderSource.replaceMain(e,"tile_main"),Cesium.ContextLimits.maximumVertexTextureImageUnits>0?e+=`uniform sampler2D tile_pickTexture;
varying vec2 tile_featureSt; 
varying vec4 tile_featureColor; 
void main() 
{ 
    tile_main(); 
    gl_FragColor = tile_featureColor; 
}`:e+=`uniform sampler2D tile_batchTexture; 
uniform sampler2D tile_pickTexture;
varying vec2 tile_featureSt; 
void main() 
{ 
    tile_main(); 
    vec4 featureProperties = texture2D(tile_batchTexture, tile_featureSt); 
    if (featureProperties.a == 0.0) { 
        discard; 
    } 
    gl_FragColor = featureProperties; 
} 
`,e}};function OE(e){var t=e._content.tileset,r=t.colorBlendMode,n=t.colorBlendAmount;if(r===Cesium.Cesium3DTileColorBlendMode.HIGHLIGHT)return 0;if(r===Cesium.Cesium3DTileColorBlendMode.REPLACE)return 1;if(r===Cesium.Cesium3DTileColorBlendMode.MIX)return Cesium.Math.clamp(n,Cesium.Math.EPSILON4,1)}Ct.prototype.getUniformMapCallback=function(){if(this.featuresLength!==0){var e=this;return function(t){var r={tile_batchTexture:function(){return Cesium.defaultValue(e._batchTexture,e._defaultTexture)},tile_transTexture:function(){return Cesium.defaultValue(e._translationTexture,e._defaultTransTexture)},tile_scaleTexture:function(){return Cesium.defaultValue(e._scaleTexture,e._defaultScaleTexture)},tile_rotationTexture:function(){return Cesium.defaultValue(e._rotationTexture,e._defaultRotationTexture)},tile_textureDimensions:function(){return e._textureDimensions},tile_textureStep:function(){return e._textureStep},tile_colorBlend:function(){return OE(e)},tile_pickTexture:function(){return Cesium.defaultValue(e._pickTexture,e._defaultTexture)}};return e._content.constructor.name==="Vector3DTileContent"&&e._content._tileset._tilesetFlat&&(t=Cesium.combine(t,e._content._tileset._tilesetFlat._updateModelUniformMap())),Cesium.combine(t,r)}}};Ct.prototype.getPickId=function(){return"texture2D(tile_pickTexture, tile_featureSt)"};var $s={ALL_OPAQUE:0,ALL_TRANSLUCENT:1,OPAQUE_AND_TRANSLUCENT:2};Ct.prototype.addDerivedCommands=function(e,t){for(var r=e.commandList,n=r.length,i=this._content._tile,s=i._finalResolution,a=i.tileset,o=a._skipLevelOfDetail&&a._hasMixedContent&&e.context.stencilBuffer,u=NE(this),f=t;f<n;++f){var l=r[f],c=l.derivedCommands.tileset;(!Cesium.defined(c)||l.dirty)&&(c={},l.derivedCommands.tileset=c,c.originalCommand=FE(l),l.dirty=!1);var h=c.originalCommand;u!==$s.ALL_OPAQUE&&l.pass!==Cesium.Pass.TRANSLUCENT&&(Cesium.defined(c.translucent)||(c.translucent=BE(h))),u!==$s.ALL_TRANSLUCENT&&l.pass!==Cesium.Pass.TRANSLUCENT&&(Cesium.defined(c.opaque)||(c.opaque=VE(h)),o&&(s||(Cesium.defined(c.zback)||(c.zback=kE(e.context,h)),a._backfaceCommands.push(c.zback)),(!Cesium.defined(c.stencil)||i._selectionDepth!==GE(c.stencil))&&(l.renderState.depthMask?c.stencil=UE(h,i._selectionDepth):c.stencil=c.opaque)));var d=o?c.stencil:c.opaque,m=c.translucent;l.pass!==Cesium.Pass.TRANSLUCENT?(u===$s.ALL_OPAQUE&&(r[f]=d),u===$s.ALL_TRANSLUCENT&&(r[f]=m),u===$s.OPAQUE_AND_TRANSLUCENT&&(r[f]=d,r.push(m))):r[f]=h}};function NE(e){var t=e._translucentFeaturesLength;return t===0?$s.ALL_OPAQUE:t===e.featuresLength?$s.ALL_TRANSLUCENT:$s.OPAQUE_AND_TRANSLUCENT}function FE(e){var t=Cesium.DrawCommand.shallowClone(e),r=t.pass===Cesium.Pass.TRANSLUCENT;return t.uniformMap=Cesium.defined(t.uniformMap)?t.uniformMap:{},t.uniformMap.tile_translucentCommand=function(){return r},t}function BE(e){var t=Cesium.DrawCommand.shallowClone(e);return t.pass=Cesium.Pass.TRANSLUCENT,t.renderState=qE(e.renderState),t}function VE(e){var t=Cesium.DrawCommand.shallowClone(e);return t.renderState=HE(e.renderState),t}function zE(e,t){var r=e.shaderCache.getDerivedShaderProgram(t,"zBackfaceLogDepth");if(!Cesium.defined(r)){var n=t.fragmentShaderSource.clone();n.defines=Cesium.defined(n.defines)?n.defines.slice(0):[],n.defines.push("POLYGON_OFFSET"),n.sources.unshift(`#ifdef GL_OES_standard_derivatives
#extension GL_OES_standard_derivatives : enable
#endif
`),r=e.shaderCache.createDerivedShaderProgram(t,"zBackfaceLogDepth",{vertexShaderSource:t.vertexShaderSource,fragmentShaderSource:n,attributeLocations:t._attributeLocations})}return r}function kE(e,t){var r=Cesium.DrawCommand.shallowClone(t),n=Cesium.clone(r.renderState,!0);n.cull.enabled=!0,n.cull.face=Cesium.CullFace.FRONT,n.colorMask={red:!1,green:!1,blue:!1,alpha:!1},n.polygonOffset={enabled:!0,factor:5,units:5},n.stencilTest=Cesium.StencilConstants.setCesium3DTileBit(),n.stencilMask=Cesium.StencilConstants.CESIUM_3D_TILE_MASK,r.renderState=Cesium.RenderState.fromCache(n),r.castShadows=!1,r.receiveShadows=!1,r.uniformMap=Cesium.clone(t.uniformMap);var i=new Cesium.Cartesian2(5,5);return r.uniformMap.u_polygonOffset=function(){return i},r.shaderProgram=zE(e,t.shaderProgram),r}function UE(e,t){var r=Cesium.DrawCommand.shallowClone(e),n=Cesium.clone(r.renderState,!0);return n.stencilTest.enabled=!0,n.stencilTest.mask=Cesium.StencilConstants.SKIP_LOD_MASK,n.stencilTest.reference=Cesium.StencilConstants.CESIUM_3D_TILE_MASK|t<<Cesium.StencilConstants.SKIP_LOD_BIT_SHIFT,n.stencilTest.frontFunction=Cesium.StencilFunction.GREATER_OR_EQUAL,n.stencilTest.frontOperation.zPass=Cesium.StencilOperation.REPLACE,n.stencilTest.backFunction=Cesium.StencilFunction.GREATER_OR_EQUAL,n.stencilTest.backOperation.zPass=Cesium.StencilOperation.REPLACE,n.stencilMask=Cesium.StencilConstants.CESIUM_3D_TILE_MASK|Cesium.StencilConstants.SKIP_LOD_MASK,r.renderState=Cesium.RenderState.fromCache(n),r}function GE(e){var t=e.renderState.stencilTest.reference;return(t&Cesium.StencilConstants.SKIP_LOD_MASK)>>>Cesium.StencilConstants.SKIP_LOD_BIT_SHIFT}function qE(e){var t=Cesium.clone(e,!0);return t.cull.enabled=!1,t.depthTest.enabled=!0,t.depthMask=!1,t.blending=Cesium.BlendingState.ALPHA_BLEND,Cesium.RenderState.fromCache(t)}function HE(e){var t=Cesium.clone(e,!0);return t.stencilTest=Cesium.StencilConstants.setCesium3DTileBit(),t.stencilMask=Cesium.StencilConstants.CESIUM_3D_TILE_MASK,Cesium.RenderState.fromCache(t)}function Sh(e,t,r){var n=e._textureDimensions;return new Ir({context:t,pixelFormat:Cesium.PixelFormat.RGBA,pixelDatatype:Cesium.PixelDatatype.UNSIGNED_BYTE,source:{width:n.x,height:n.y,arrayBufferView:r},flipY:!1,sampler:Cesium.Sampler.NEAREST})}function Io(e,t,r){var n=e._textureDimensions;return new Ir({context:t,pixelFormat:Cesium.PixelFormat.RGBA,pixelDatatype:Cesium.PixelDatatype.FLOAT,source:{width:n.x,height:n.y,arrayBufferView:r},flipY:!1,sampler:Cesium.Sampler.NEAREST})}function pg(e,t){var r=e.featuresLength;if(!Cesium.defined(e._pickTexture)&&r>0){for(var n=e._pickIds,i=Nu(e),s=new Uint8Array(i),a=e._content,o=0;o<r;++o){var u=t.createPickId(a.getFeature(o));n.push(u);var f=u.color,l=o*4;s[l]=Cesium.Color.floatToByte(f.red),s[l+1]=Cesium.Color.floatToByte(f.green),s[l+2]=Cesium.Color.floatToByte(f.blue),s[l+3]=Cesium.Color.floatToByte(f.alpha)}e._pickTexture=Sh(e,t,s),a.tileset._statistics.batchTableByteLength+=e._pickTexture.sizeInBytes}}function gg(e){var t=e._textureDimensions;e._batchTexture.copyFrom({width:t.x,height:t.y,arrayBufferView:e._batchValues})}function Lo(e,t,r){var n=e._textureDimensions;r.copyFrom({width:n.x,height:n.y,arrayBufferView:t})}function vl(e,t){return new Ir({context:t,pixelFormat:Cesium.PixelFormat.RGBA,pixelDatatype:Cesium.PixelDatatype.FLOAT,source:{width:1,height:1,arrayBufferView:new Float32Array([0,0,0,1])},flipY:!1,sampler:Cesium.Sampler.NEAREST})}function vg(e,t){return new Ir({context:t,pixelFormat:Cesium.PixelFormat.RGBA,pixelDatatype:Cesium.PixelDatatype.FLOAT,source:{width:1,height:1,arrayBufferView:new Float32Array([1,1,1,1])},flipY:!1,sampler:Cesium.Sampler.NEAREST})}Ct.prototype.update=function(e,t){var r=t.context;this._defaultTexture=r.defaultTexture,!NO_support_OES_float&&!Cesium.defined(this._defaultTransTexture)&&Cesium.defined(this._textureDimensions)&&(this._defaultTransTexture=vl(this,r)),!NO_support_OES_float&&!Cesium.defined(this._defaultScaleTexture)&&Cesium.defined(this._textureDimensions)&&(this._defaultScaleTexture=vg(this,r)),!NO_support_OES_float&&!Cesium.defined(this._defaultRotationTexture)&&Cesium.defined(this._textureDimensions)&&(this._defaultRotationTexture=vl(this,r));var n=t.passes;(n.pick||n.postProcess)&&pg(this,r),this._batchValuesDirty&&(this._batchValuesDirty=!1,!Cesium.defined(this._batchTexture)&&Cesium.defined(this._batchValues)&&(this._batchTexture=Sh(this,r,this._batchValues),e._statistics.batchTableByteLength+=this._batchTexture.sizeInBytes),!NO_support_OES_float&&!Cesium.defined(this._translationTexture)&&Cesium.defined(this._transValues)&&(this._translationTexture=Io(this,r,this._transValues)),!NO_support_OES_float&&!Cesium.defined(this._scaleTexture)&&Cesium.defined(this._scaleValues)&&(this._scaleTexture=Io(this,r,this._scaleValues)),!NO_support_OES_float&&!Cesium.defined(this._rotationTexture)&&Cesium.defined(this._rotationValues)&&(this._rotationTexture=Io(this,r,this._rotationValues)),Cesium.defined(this._batchValues)&&gg(this),!NO_support_OES_float&&Cesium.defined(this._transValues)&&Lo(this,this._transValues,this._translationTexture),!NO_support_OES_float&&Cesium.defined(this._scaleValues)&&Lo(this,this._scaleValues,this._scaleTexture),!NO_support_OES_float&&Cesium.defined(this._rotationValues)&&Lo(this,this._rotationValues,this._rotationTexture))};Ct.prototype.updateNoStatistics=function(e,t){var r=t.context;this._defaultTexture=r.defaultTexture,!NO_support_OES_float&&!Cesium.defined(this._defaultTransTexture)&&Cesium.defined(this._textureDimensions)&&(this._defaultTransTexture=vl(this,r)),!NO_support_OES_float&&!Cesium.defined(this._defaultScaleTexture)&&Cesium.defined(this._textureDimensions)&&(this._defaultTransTexture=vg(this,r)),!NO_support_OES_float&&!Cesium.defined(this._defaultRotationTexture)&&Cesium.defined(this._textureDimensions)&&(this._defaultTransTexture=vl(this,r));var n=t.passes;(n.pick||n.postProcess)&&pg(this,r),this._batchValuesDirty&&(this._batchValuesDirty=!1,!Cesium.defined(this._batchTexture)&&Cesium.defined(this._batchValues)&&(this._batchTexture=Sh(this,r,this._batchValues)),!NO_support_OES_float&&!Cesium.defined(this._translationTexture)&&Cesium.defined(this._transValues)&&(this._translationTexture=Io(this,r,this._transValues)),!NO_support_OES_float&&!Cesium.defined(this._scaleTexture)&&Cesium.defined(this._scaleValues)&&(this._scaleTexture=Io(this,r,this._scaleValues)),!NO_support_OES_float&&!Cesium.defined(this._rotationTexture)&&Cesium.defined(this._rotationValues)&&(this._rotationTexture=Io(this,r,this._rotationValues)),Cesium.defined(this._batchValues)&&gg(this),!NO_support_OES_float&&Cesium.defined(this._transValues)&&Lo(this,this._transValues,this._translationTexture),!NO_support_OES_float&&Cesium.defined(this._scaleValues)&&Lo(this,this._scaleValues,this._scaleTexture),!NO_support_OES_float&&Cesium.defined(this._rotationValues)&&Lo(this,this._rotationValues,this._rotationTexture))};Ct.prototype.isDestroyed=function(){return!1};Ct.prototype.destroy=function(){this._batchTexture=this._batchTexture&&this._batchTexture.destroy(),this._translationTexture=this._translationTexture&&this._translationTexture.destroy(),this._scaleTexture=this._scaleTexture&&this._scaleTexture.destroy(),this._rotationTexture=this._rotationTexture&&this._rotationTexture.destroy(),this._pickTexture=this._pickTexture&&this._pickTexture.destroy();for(var e=this._pickIds,t=e.length,r=0;r<t;++r)e[r].destroy();return Cesium.destroyObject(this)};Ct._DEFAULT_COLOR_VALUE=Ou;Ct._DEFAULT_SHOW_VALUE=bh;var zr=Ct;function Xn(e,t){this._content=e,this._batchId=t,this._color=void 0,this.cesium3DTileFeature=!0}Object.defineProperties(Xn.prototype,{show:{get:function(){return this._content.batchTable.getShow(this._batchId)},set:function(e){this._content.batchTable.setShow(this._batchId,e)}},color:{get:function(){return Cesium.defined(this._color)||(this._color=new Cesium.Color),this._content.batchTable.getColor(this._batchId,this._color)},set:function(e){this._content.batchTable.setColor(this._batchId,e)}},content:{get:function(){return this._content}},tileset:{get:function(){return this._content.tileset}},primitive:{get:function(){return this._content.tileset}},pickId:{get:function(){if(!this._content.isDestroyed())return this._content.batchTable.getPickColor(this._batchId)}}});Xn.prototype.hasProperty=function(e){return this._content.batchTable.hasProperty(this._batchId,e)};Xn.prototype.getPropertyNames=function(e){return this._content.batchTable.getPropertyNames(this._batchId,e)};Xn.prototype.getProperty=function(e){return this._content.batchTable.getProperty(this._batchId,e)};Xn.prototype.getPropertyInherited=function(e){return this._content.batchTable.getProperty(this._batchId,e)};Xn.prototype.setProperty=function(e,t){this._content.batchTable.setProperty(this._batchId,e,t),this._content.featurePropertiesDirty=!0};Xn.prototype.setTranslation=function(e){this._content.batchTable.setTranslation(this._batchId,e)};Xn.prototype.setScale=function(e){this._content.batchTable.setScale(this._batchId,e)};Xn.prototype.setRotation=function(e){this._content.batchTable.setRotation(this._batchId,e)};Xn.prototype.isExactClass=function(e){return this._content.batchTable.isExactClass(this._batchId,e)};Xn.prototype.isClass=function(e){return this._content.batchTable.isClass(this._batchId,e)};Xn.prototype.getExactClassName=function(){return this._content.batchTable.getExactClassName(this._batchId)};var Rn=Xn;function _l(e,t){this.json=e,this.buffer=t,this._cachedTypedArrays={},this.featuresLength=0}function _g(e,t,r,n,i,s){var a=e._cachedTypedArrays,o=a[t];return Cesium.defined(o)||(o=Cesium.ComponentDatatype.createArrayBufferView(r,e.buffer.buffer,e.buffer.byteOffset+s,i*n),a[t]=o),o}function WE(e,t,r,n){var i=e._cachedTypedArrays,s=i[t];return Cesium.defined(s)||(s=Cesium.ComponentDatatype.createTypedArray(r,n),i[t]=s),s}_l.prototype.getGlobalProperty=function(e,t,r){var n=this.json[e];if(Cesium.defined(n))return Cesium.defined(n.byteOffset)?(t=Cesium.defaultValue(t,Cesium.ComponentDatatype.UNSIGNED_INT),r=Cesium.defaultValue(r,1),_g(this,e,t,r,1,n.byteOffset)):n};_l.prototype.getPropertyArray=function(e,t,r){var n=this.json[e];if(Cesium.defined(n))return Cesium.defined(n.byteOffset)?(Cesium.defined(n.componentType)&&(t=Cesium.ComponentDatatype.fromName(n.componentType)),_g(this,e,t,r,this.featuresLength,n.byteOffset)):WE(this,e,t,n)};_l.prototype.getProperty=function(e,t,r,n,i){var s=this.json[e];if(Cesium.defined(s)){var a=this.getPropertyArray(e,t,r);if(r===1)return a[n];for(var o=0;o<r;++o)i[o]=a[r*n+o];return i}};var ws=_l;function Po(e,t,r,n){this._format=e,this._width=t,this._height=r,this._buffer=n}Object.defineProperties(Po.prototype,{internalFormat:{get:function(){return this._format}},width:{get:function(){return this._width}},height:{get:function(){return this._height}},bufferView:{get:function(){return this._buffer}}});Po.clone=function(e){if(Cesium.defined(e))return new Po(e._format,e._width,e._height,e._buffer)};Po.prototype.clone=function(){return Po.clone(this)};var ea=Po;var YE=new Cesium.TaskProcessor("transcodeCRNToDXT",Number.POSITIVE_INFINITY);function XE(e){let t;if(e instanceof ArrayBuffer||ArrayBuffer.isView(e)?t=Promise.resolve(e):t=Cesium.Resource.createIfNeeded(e).fetchArrayBuffer(),!!Cesium.defined(t))return t.then(function(r){if(!Cesium.defined(r))return;let n=[];return r instanceof ArrayBuffer?n.push(r):(r.byteOffset===0&&r.byteLength===r.buffer.byteLength||(r=r.slice(0,r.length)),n.push(r.buffer)),YE.scheduleTask(r,n)}).then(function(r){return ea.clone(r)})}var Va=XE;function jE(e){var t;if(e instanceof ArrayBuffer||ArrayBuffer.isView(e))t=Ne.resolve(e);else{var r=Cesium.Resource.createIfNeeded(e);t=r.fetchArrayBuffer()}if(Cesium.defined(t))return t.then(function(n){if(Cesium.defined(n))return QE(n)})}var Cg=[171,75,84,88,32,49,49,187,13,10,26,10],KE=67305985,yg=["positiveX","negativeX","positiveY","negativeY","positiveZ","negativeZ"],On=4;function QE(e){var t=new Uint8Array(e),r=!0,n;for(n=0;n<Cg.length;++n)if(Cg[n]!==t[n]){r=!1;break}if(!r)throw new Cesium.RuntimeError("Invalid KTX file.");var i,s;Cesium.defined(e.buffer)?(i=new DataView(e.buffer),s=e.byteOffset):(i=new DataView(e),s=0),s+=12;var a=i.getUint32(s,!0);if(s+=On,a!==KE)throw new Cesium.RuntimeError("File is the wrong endianness.");var o=i.getUint32(s,!0);s+=On;var u=i.getUint32(s,!0);s+=On;var f=i.getUint32(s,!0);s+=On;var l=i.getUint32(s,!0);s+=On;var c=i.getUint32(s,!0);s+=On;var h=i.getUint32(s,!0);s+=On;var d=i.getUint32(s,!0);s+=On;var m=i.getUint32(s,!0);s+=On;var g=i.getUint32(s,!0);s+=On;var p=i.getUint32(s,!0);s+=On;var v=i.getUint32(s,!0);s+=On;var _=i.getUint32(s,!0);s+=On,s+=_;var y=i.getUint32(s,!0);s+=On;var x;if(Cesium.defined(e.buffer)?x=new Uint8Array(e.buffer,s,y):x=new Uint8Array(e,s,y),l===Cesium.WebGLConstants.RGB8?l=Cesium.PixelFormat.RGB:l===Cesium.WebGLConstants.RGBA8&&(l=Cesium.PixelFormat.RGBA),!Cesium.PixelFormat.validate(l))throw new Cesium.RuntimeError("glInternalFormat is not a valid format.");if(Cesium.PixelFormat.isCompressedFormat(l)){if(o!==0)throw new Cesium.RuntimeError("glType must be zero when the texture is compressed.");if(u!==1)throw new Cesium.RuntimeError("The type size for compressed textures must be 1.");if(f!==0)throw new Cesium.RuntimeError("glFormat must be zero when the texture is compressed.")}else{if(o!==Cesium.WebGLConstants.UNSIGNED_BYTE)throw new Cesium.RuntimeError("Only unsigned byte buffers are supported.");if(c!==f)throw new Cesium.RuntimeError("The base internal format must be the same as the format for uncompressed textures.")}if(m!==0)throw new Cesium.RuntimeError("3D textures are unsupported.");if(g!==0)throw new Cesium.RuntimeError("Texture arrays are unsupported.");var E=x.byteOffset,S=new Array(v);for(n=0;n<v;++n){for(var I=S[n]={},P=0;P<p;++P){var w=h>>n,N=d>>n;w<1&&(w=1),N<1&&(N=1);var B=Cesium.PixelFormat.isCompressedFormat(l)?Cesium.PixelFormat.compressedTextureSizeInBytes(l,w,N):Cesium.PixelFormat.textureSizeInBytes(l,o,w,N),C=new Uint8Array(x.buffer,E,B);I[yg[P]]=new ea(l,w,N,C),E+=B}Cesium.defined(e.buffer)?E+=4:E+=3-(E+3)%4+4}var b=S;if(p===1)for(n=0;n<v;++n)b[n]=b[n][yg[0]];return v===1&&(b=b[0]),b}var za=jE;function ZE(e,t){return Cesium.defined(e.extensionsUsed)&&e.extensionsUsed.indexOf(t)>=0}var ka=ZE;function JE(e,t,r){if(typeof e.slice=="function")return e.slice(t,r);for(var n=Array.prototype.slice.call(e,t,r),i=Cesium.FeatureDetection.typedArrayTypes,s=i.length,a=0;a<s;++a)if(e instanceof i[a]){n=new i[a](n);break}return n}var xn=JE;function ct(){}ct._maxDecodingConcurrency=Math.max(Cesium.FeatureDetection.hardwareConcurrency-1,1);ct._decoderTaskProcessor=void 0;ct._taskProcessorReady=!1;ct._getDecoderTaskProcessor=function(){if(!Cesium.defined(ct._decoderTaskProcessor)){var e=new Cesium.TaskProcessor("decodeDraco",ct._maxDecodingConcurrency);e.initWebAssemblyModule({modulePath:"ThirdParty/Workers/draco_wasm_wrapper.js",wasmBinaryFile:"ThirdParty/draco_decoder1.wasm",fallbackModulePath:"ThirdParty/Workers/draco_decoder.js"}).then(function(){ct._taskProcessorReady=!0}),ct._decoderTaskProcessor=e}return ct._decoderTaskProcessor};ct.hasExtension=function(e){return Cesium.defined(e.extensionsRequired.KHR_draco_mesh_compression)||Cesium.defined(e.extensionsUsed.KHR_draco_mesh_compression)};function Eg(e,t){var r="runtime."+Object.keys(e.createdBufferViews).length,n=e.buffers,i=Object.keys(n).length;return n[i]=t,e.createdBufferViews[r]={buffer:i,byteOffset:0,byteLength:t.byteLength},r}function bg(e,t,r){var n=t._loadResources,i=Eg(n,e);return n.vertexBuffersToCreate.enqueue(i),i}function wg(e,t,r){var n=e.typedArray,i=t._loadResources,s=Eg(i,n);return i.indexBuffersToCreate.enqueue({id:s,componentType:Cesium.ComponentDatatype.fromTypedArray(n)}),{bufferViewId:s,numberOfIndices:e.numberOfIndices}}function xg(e,t,r,n){if(ct._taskProcessorReady){var i=r.primitivesToDecode.peek();if(Cesium.defined(i)){var s=e.scheduleTask(i,[i.array.buffer]);if(Cesium.defined(s))return r.activeDecodingTasks++,r.primitivesToDecode.dequeue(),s.then(function(a){a.taskDataMesh=i.mesh,a.taskDataPrimitive=i.primitive,t.meshPrimitives.push(a),r.activeDecodingTasks--;var o=wg(a.indexArray,t,n),u={},f=a.attributeData;for(var l in f)if(f.hasOwnProperty(l)){var c=f[l],h=c.array,d=bg(h,t,n),m=c.data;m.bufferView=d,u[l]=m}t._decodedData[i.mesh+".primitive."+i.primitive]={bufferView:o.bufferViewId,numberOfIndices:o.numberOfIndices,attributes:u}})}}}ct._decodedModelResourceCache=void 0;ct.parse=function(e,t){if(ct.hasExtension(e)){var r=e._loadResources,n=e.cacheKey;if(Cesium.defined(n)){Cesium.defined(ct._decodedModelResourceCache)||(Cesium.defined(t.cache.modelDecodingCache)||(t.cache.modelDecodingCache={}),ct._decodedModelResourceCache=t.cache.modelDecodingCache);var i=ct._decodedModelResourceCache[n];if(Cesium.defined(i)){i.count++,r.pendingDecodingCache=!0;return}}var s=e._dequantizeInShader,a=e.gltf;Cesium.ForEach.mesh(a,function(o,u){Cesium.ForEach.meshPrimitive(o,function(f,l){if(Cesium.defined(f.extensions)){var c=f.extensions.KHR_draco_mesh_compression;if(Cesium.defined(c)){var h=a.bufferViews[c.bufferView],d=xn(a.buffers[h.buffer].extras._pipeline.source,h.byteOffset,h.byteOffset+h.byteLength);r.primitivesToDecode.enqueue({mesh:u,primitive:l,array:d,bufferView:h,compressedAttributes:c.attributes,dequantizeInShader:s})}}})})}};ct.parseDecodedData=function(e,t,r){if(!Cesium.defined(e.taskDataMesh)||!Cesium.defined(e.taskDataPrimitive)||!Cesium.defined(e.indexArray)||!Cesium.defined(e.attributeData)){console.log("indexeddb\u4E2D\u5B58\u50A8\u6A21\u578Bmesh\u6570\u636E\u6709\u95EE\u9898");return}var n=wg(e.indexArray,t,r),i={},s=e.attributeData;for(var a in s)if(s.hasOwnProperty(a)){var o=s[a],u=o.array,f=bg(u,t,r),l=o.data;l.bufferView=f,i[a]=l}t._decodedData[e.taskDataMesh+".primitive."+e.taskDataPrimitive]={bufferView:n.bufferViewId,numberOfIndices:n.numberOfIndices,attributes:i}};ct.decodeModel=function(e,t){if(!ct.hasExtension(e))return Ne.resolve();var r=e._loadResources,n=e.cacheKey;if(Cesium.defined(n)&&Cesium.defined(ct._decodedModelResourceCache)){var i=ct._decodedModelResourceCache[n];if(Cesium.defined(i)&&r.pendingDecodingCache)return Ne(i.ready,function(){e._decodedData=i.data,r.pendingDecodingCache=!1});ct._decodedModelResourceCache[n]={ready:!1,count:1,data:void 0}}if(r.primitivesToDecode.length===0)return Ne.resolve();for(var s=ct._getDecoderTaskProcessor(),a=[],o=xg(s,e,r,t);Cesium.defined(o);)a.push(o),o=xg(s,e,r,t);return Ne.all(a)};ct.decodePointCloud=function(e){var t=ct._getDecoderTaskProcessor();if(ct._taskProcessorReady)return t.scheduleTask(e,[e.buffer.buffer])};ct.cacheDataForModel=function(e){var t=e.cacheKey;if(Cesium.defined(t)&&Cesium.defined(ct._decodedModelResourceCache)){var r=ct._decodedModelResourceCache[t];Cesium.defined(r)&&(r.ready=!0,r.data=e._decodedData)}};ct.parseGltf=function(e,t,r){var n=[];Cesium.ForEach.mesh(e,function(f,l){Cesium.ForEach.meshPrimitive(f,function(c,h){if(Cesium.defined(c.extensions)){var d=c.extensions.KHR_draco_mesh_compression;if(Cesium.defined(d)){var m=e.bufferViews[d.bufferView],g=xn(e.buffers[m.buffer].extras._pipeline.source,m.byteOffset,m.byteOffset+m.byteLength);n.push({mesh:l,primitive:h,array:g,bufferView:m,compressedAttributes:d.attributes,dequantizeInShader:t})}}})});var i=ct._getDecoderTaskProcessor();i._maximumActiveTasks=n.length+1;for(var s=[],a=0;a<n.length;a++){var o=n[a];if(!Cesium.defined(o))return;var u=$E(i,o,r);Cesium.defined(u)&&s.push(u)}return Ne.all(s)};function $E(e,t,r){if(ct._taskProcessorReady&&Cesium.defined(t)){var n=e.scheduleTask(t,[t.array.buffer]);if(Cesium.defined(n))return n.then(function(i){i.taskDataMesh=t.mesh,i.taskDataPrimitive=t.primitive,r.push(i)})}}ct.destroyCachedDataForModel=function(e){var t=e.cacheKey;if(Cesium.defined(t)&&Cesium.defined(ct._decodedModelResourceCache)){var r=ct._decodedModelResourceCache[t];Cesium.defined(r)&&--r.count===0&&delete ct._decodedModelResourceCache[t]}};var es=ct;var Le={};Le.updateForwardAxis=function(e){var t=e.gltf.extras.sourceVersion;(Cesium.defined(t)&&t!=="2.0"||Le.getAssetVersion(e.gltf)!=="2.0")&&(e._gltfForwardAxis=Cesium.Axis.X)};Le.getAssetVersion=function(e){return!Cesium.defined(e.asset)||!Cesium.defined(e.asset.version)?"1.0":e.asset.version};Le.splitIncompatibleMaterials=function(e){var t=e.accessors,r=e.materials,n={};return Cesium.ForEach.mesh(e,function(i){Cesium.ForEach.meshPrimitive(i,function(s){var a=s.material,o=r[a],u=s.attributes.JOINTS_0,f,l;if(Cesium.defined(u)){var c=t[u];f=c.componentType,l=c.type}var h=Cesium.defined(u),d=Cesium.defined(s.attributes.COLOR_0),m=Cesium.defined(s.targets),g=Cesium.defined(s.attributes.NORMAL),p=Cesium.defined(s.attributes.TANGENT),v=Cesium.defined(s.attributes.TEXCOORD_0),_=Cesium.defined(s.extensions)&&Cesium.defined(s.extensions.CESIUM_primitive_outline),y=n[a];if(!Cesium.defined(y))n[a]={skinning:{skinned:h,componentType:f,type:l},hasVertexColors:d,hasMorphTargets:m,hasNormals:g,hasTangents:p,hasTexCoords:v,hasOutline:_};else if(y.skinning.skinned!==h||y.skinning.type!==l||y.hasVertexColors!==d||y.hasMorphTargets!==m||y.hasNormals!==g||y.hasTangents!==p||y.hasTexCoords!==v||y.hasOutline!==_){var x=Cesium.clone(o,!0);a=Cesium.addToArray(r,x),s.material=a,n[a]={skinning:{skinned:h,componentType:f,type:l},hasVertexColors:d,hasMorphTargets:m,hasNormals:g,hasTangents:p,hasTexCoords:v,hasOutline:_}}})}),n};Le.getShaderVariable=function(e){return e==="SCALAR"?"float":e.toLowerCase()};Le.ModelState={NEEDS_LOAD:0,LOADING:1,LOADED:2,FAILED:3};Le.getFailedLoadFunction=function(e,t,r){return function(n){e._state=Le.ModelState.FAILED;var i="Failed to load "+t+": "+r;Cesium.defined(n)&&(i+=`
`+n.message),e._readyPromise.reject(new Cesium.RuntimeError(i))}};Le.parseBuffers=function(e,t){var r=e._loadResources;Cesium.ForEach.buffer(e.gltf,function(n,i){if(Cesium.defined(n.extras._pipeline.source))r.buffers[i]=n.extras._pipeline.source;else if(Cesium.defined(t)){var s=e._resource.getDerivedResource({url:n.uri});++r.pendingBufferLoads,s.fetchArrayBuffer().then(t(e,i)).catch(Le.getFailedLoadFunction(e,"buffer",s.url))}})};var eb=new Cesium.Cartesian3,tb=new Cesium.Cartesian3;Le.computeBoundingSphere=function(e){for(var t=e.gltf,r=t.nodes,n=t.meshes,i=t.scenes[t.scene].nodes,s=i.length,a=[],o=new Cesium.Cartesian3(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),u=new Cesium.Cartesian3(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),f=0;f<s;++f){var l=r[i[f]];for(l._transformToRoot=Le.getTransform(l),a.push(l);a.length>0;){l=a.pop();var c=l._transformToRoot,h=l.mesh;if(Cesium.defined(h))for(var d=n[h],m=d.primitives,g=m.length,p=0;p<g;++p){var v=m[p].attributes.POSITION;if(Cesium.defined(v)){var _=Le.getAccessorMinMax(t,v);if(Cesium.defined(_.min)&&Cesium.defined(_.max)){var y=Cesium.Cartesian3.fromArray(_.min,0,eb),x=Cesium.Cartesian3.fromArray(_.max,0,tb);Cesium.defined(o)&&Cesium.defined(u)&&(Cesium.Matrix4.multiplyByPoint(c,y,y),Cesium.Matrix4.multiplyByPoint(c,x,x),Cesium.Cartesian3.minimumByComponent(o,y,o),Cesium.Cartesian3.maximumByComponent(u,x,u))}}}var E=l.children;if(Cesium.defined(E))for(var S=E.length,I=0;I<S;++I){var P=r[E[I]];P._transformToRoot=Le.getTransform(P),Cesium.Matrix4.multiplyTransformation(c,P._transformToRoot,P._transformToRoot),a.push(P)}delete l._transformToRoot}}var w=Cesium.BoundingSphere.fromCornerPoints(o,u);return e._forwardAxis===Cesium.Axis.Z&&Cesium.BoundingSphere.transformWithoutScale(w,Cesium.Axis.Z_UP_TO_X_UP,w),e._upAxis===Cesium.Axis.Y?Cesium.BoundingSphere.transformWithoutScale(w,Cesium.Axis.Y_UP_TO_Z_UP,w):e._upAxis===Cesium.Axis.X&&Cesium.BoundingSphere.transformWithoutScale(w,Cesium.Axis.X_UP_TO_Z_UP,w),w};function rb(e,t){return Cesium.ForEach.techniqueAttribute(e,function(r,n){if(r.semantic===t)return n})}function nb(e,t){var r=e.accessors,n=e.materials,i=e.extensions.KHR_techniques_webgl,s=i.techniques,a=i.programs,o=i.shaders,u=t.targets,f=t.attributes;for(var l in u)if(u.hasOwnProperty(l)){var c=u[l];for(var h in c)h!=="extras"&&(f[h+"_"+l]=c[h])}var d=n[t.material],m=s[d.extensions.KHR_techniques_webgl.technique],g=a[m.program],p=o[g.vertexShader];for(var v in f)if(f.hasOwnProperty(v)&&!Cesium.defined(rb(m,v))){var _=f[v],y=r[_],x=v.toLowerCase();x.charAt(0)==="_"&&(x=x.slice(1));var E="a_"+x;m.attributes[E]={semantic:v,type:y.componentType};var S=p.extras._pipeline,I=S.source;I="attribute "+Le.getShaderVariable(y.type)+" "+E+`;
`+I,S.source=I}}Le.ensureSemanticExistence=function(e){return Cesium.ForEach.mesh(e,function(t){Cesium.ForEach.meshPrimitive(t,function(r){nb(e,r)})}),e};Le.createAttributeLocations=function(e,t){var r={},n=!1,i=1;if(Cesium.ForEach.techniqueAttribute(e,function(a,o){/pos/i.test(o)&&!n?(r[o]=0,n=!0):r[o]=i++}),Cesium.defined(t))for(var s in t)t.hasOwnProperty(s)&&(r[s]=i++);return r};Le.getAccessorMinMax=function(e,t){var r=e.accessors[t],n=r.extensions,i=r.min,s=r.max;if(Cesium.defined(n)){var a=n.WEB3D_quantized_attributes;Cesium.defined(a)&&(i=a.decodedMin,s=a.decodedMax)}return{min:i,max:s}};function Sg(e,t,r,n){return ka(e,"KHR_techniques_webgl")?function(i,s){if(i.semantic===r&&(!n||!Cesium.defined(i.node)))return s}:function(i,s){var a=t.parameters[i];if(a.semantic===r&&(!n||!Cesium.defined(a.node)))return s}}Le.getAttributeOrUniformBySemantic=function(e,t,r,n){return Cesium.ForEach.technique(e,function(i){if(!(Cesium.defined(r)&&i.program!==r)){var s=Cesium.ForEach.techniqueAttribute(i,Sg(e,i,t,n));return Cesium.defined(s)?s:Cesium.ForEach.techniqueUniform(i,Sg(e,i,t,n))}})};Le.getDiffuseAttributeOrUniform=function(e,t){var r=Le.getAttributeOrUniformBySemantic(e,"COLOR_0",t);return Cesium.defined(r)||(r=Le.getAttributeOrUniformBySemantic(e,"_3DTILESDIFFUSE",t)),r};var ib=new Cesium.Cartesian3,sb=new Cesium.Quaternion,ab=new Cesium.Cartesian3;Le.getTransform=function(e,t){return Cesium.defined(e.matrix)?Cesium.Matrix4.fromColumnMajorArray(e.matrix,t):Cesium.Matrix4.fromTranslationQuaternionRotationScale(Cesium.Cartesian3.fromArray(e.translation,0,ib),Cesium.Quaternion.unpack(e.rotation,0,sb),Cesium.Cartesian3.fromArray(e.scale,0,ab),t)};Le.getUsedExtensions=function(e){var t=e.extensionsUsed,r={};if(Cesium.defined(t))for(var n=t.length,i=0;i<n;i++){var s=t[i];r[s]=!0}return r};Le.getRequiredExtensions=function(e){var t=e.extensionsRequired,r={};if(Cesium.defined(t))for(var n=t.length,i=0;i<n;i++){var s=t[i];r[s]=!0}return r};Le.supportedExtensions={AGI_articulations:!0,CESIUM_RTC:!0,EXT_texture_webp:!0,KHR_blend:!0,KHR_binary_glTF:!0,KHR_draco_mesh_compression:!0,KHR_materials_common:!0,KHR_techniques_webgl:!0,KHR_materials_unlit:!0,KHR_materials_pbrSpecularGlossiness:!0,KHR_texture_transform:!0,WEB3D_quantized_attributes:!0};Le.checkSupportedExtensions=function(e,t){for(var r in e)if(e.hasOwnProperty(r)){if(!Le.supportedExtensions[r])throw new Cesium.RuntimeError("Unsupported glTF Extension: "+r);if(r==="EXT_texture_webp"&&t===!1)throw new Cesium.RuntimeError("Loaded model requires WebP but browser does not support it.")}};Le.checkSupportedGlExtensions=function(e,t){if(Cesium.defined(e))for(var r=e.length,n=0;n<r;n++){var i=e[n];if(i!=="OES_element_index_uint")throw new Cesium.RuntimeError("Unsupported WebGL Extension: "+i);if(!t.elementIndexUint)throw new Cesium.RuntimeError("OES_element_index_uint WebGL extension is not enabled.")}};function Th(e,t,r){t+="(?!\\w)",t=new RegExp(t,"g");var n=e.search(t);return e.replace(t,function(i,s){return n===s?i:r})}function ob(e,t){var r=e.accessors[t],n=r.extensions;if(Cesium.defined(n))return n.WEB3D_quantized_attributes}function Tg(e,t,r){var n=t.material,i=e.materials[n];if(!(!ka(e,"KHR_techniques_webgl")||!Cesium.defined(i.extensions)||!Cesium.defined(i.extensions.KHR_techniques_webgl))){var s=i.extensions.KHR_techniques_webgl.technique,a=e.extensions.KHR_techniques_webgl,o=a.techniques[s];return Cesium.ForEach.techniqueAttribute(o,function(u,f){var l=u.semantic;if(l===r)return f})}}Le.modifyShaderForDracoQuantizedAttributes=function(e,t,r,n){var i={};for(var s in n)if(n.hasOwnProperty(s)){var a=n[s],o=a.quantization;if(!Cesium.defined(o))continue;var u=Tg(e,t,s);if(!Cesium.defined(u))continue;s.charAt(0)==="_"&&(s=s.substring(1));var f="gltf_u_dec_"+s.toLowerCase();if(!Cesium.defined(i[f])){var l="gltf_decoded_"+s,c=u.replace("a_","gltf_a_dec_"),h=a.componentsPerAttribute;r=Th(r,u,c);var d;o.octEncoded?d="vec3":h>1?d="vec"+h:d="float",r=d+" "+c+`;
`+r;var m=h===3&&s==="COLOR_0";m&&(r=Th(r,c,"vec4("+c+", 1.0)"));var g="";if(o.octEncoded){var p=f+"_rangeConstant";r="uniform float "+p+`;
`+r,g=`
void main() {
    `+c+" = czm_octDecode("+u+".xy, "+p+`).zxy;
    `+l+`();
}
`}else{var v=f+"_normConstant",_=f+"_min";r="uniform float "+v+`;
uniform `+d+" "+_+`;
`+r;var y=m?".xyz":"";g=`
void main() {
    `+c+" = "+_+" + "+u+y+" * "+v+`;
    `+l+`();
}
`}r=Cesium.ShaderSource.replaceMain(r,l),r+=g}}return{shader:r}};Le.modifyShaderForQuantizedAttributes=function(e,t,r){var n={},i=t.attributes;for(var s in i)if(i.hasOwnProperty(s)){var a=Tg(e,t,s),o=t.attributes[s];s.charAt(0)==="_"&&(s=s.substring(1));var u="gltf_u_dec_"+s.toLowerCase(),f=u+"_scale",l=u+"_translate";if(!Cesium.defined(n[u])&&!Cesium.defined(n[f])){var c=ob(e,o);if(Cesium.defined(c)){var h=c.decodeMatrix,d="gltf_decoded_"+s,m=a.replace("a_","gltf_a_dec_"),g=Math.floor(Math.sqrt(h.length));r=Th(r,a,m);var p;g>2?p="vec"+(g-1):p="float",r=p+" "+m+`;
`+r;var v="";g===5?(r="uniform mat4 "+f+`;
`+r,r="uniform vec4 "+l+`;
`+r,v=`
void main() {
    `+m+" = "+f+" * "+a+" + "+l+`;
    `+d+`();
}
`,n[f]={mat:4},n[l]={vec:4}):(r="uniform mat"+g+" "+u+`;
`+r,v=`
void main() {
    `+m+" = "+p+"("+u+" * vec"+g+"("+a+`,1.0));
    `+d+`();
}
`,n[u]={mat:g}),r=Cesium.ShaderSource.replaceMain(r,d),r+=v}}}return{shader:r,uniforms:n}};Le.toClipCoordinatesGLSL=function(e,t){var r=Le.getAttributeOrUniformBySemantic(e,"POSITION"),n=r.replace("a_","gltf_a_dec_");t.indexOf(n)!==-1&&(r=n);var i=Le.getAttributeOrUniformBySemantic(e,"MODELVIEWPROJECTION",void 0,!0);if(!Cesium.defined(i)||t.indexOf(i)===-1){var s=Le.getAttributeOrUniformBySemantic(e,"PROJECTION",void 0,!0),a=Le.getAttributeOrUniformBySemantic(e,"MODELVIEW",void 0,!0);t.indexOf("czm_instanced_modelView ")!==-1?a="czm_instanced_modelView":Cesium.defined(a)||(a=Le.getAttributeOrUniformBySemantic(e,"CESIUM_RTC_MODELVIEW",void 0,!0)),i=s+" * "+a}return i+" * vec4("+r+".xyz, 1.0)"};Le.modifyFragmentShaderForLogDepth=function(e){return e=Cesium.ShaderSource.replaceMain(e,"czm_depth_main"),e+=`
void main() 
{ 
    czm_depth_main(); 
    czm_writeLogDepth(); 
} 
`,e};Le.modifyFragmentShaderForLogDepthAddRoller=function(e){return e=Cesium.ShaderSource.replaceMain(e,"czm_depth_main"),e+=`
void main() 
{ 
    czm_rollerShutter(gl_FragCoord.xy,u_rollerRegion); 
    czm_depth_main(); 
    czm_writeLogDepth(); 
} 
`,e};Le.modifyVertexShaderForLogDepth=function(e,t){return e=Cesium.ShaderSource.replaceMain(e,"czm_depth_main"),e+=`
void main() 
{ 
    czm_depth_main(); 
    czm_vertexLogDepth(`+t+`); 
} 
`,e};function Ao(e){var t={value:e,clone:function(r,n){return r},func:function(){return t.value}};return t}function yl(e){var t={value:Cesium.Cartesian2.fromArray(e),clone:Cesium.Cartesian2.clone,func:function(){return t.value}};return t}function xl(e){var t={value:Cesium.Cartesian3.fromArray(e),clone:Cesium.Cartesian3.clone,func:function(){return t.value}};return t}function Do(e){var t={value:Cesium.Cartesian4.fromArray(e),clone:Cesium.Cartesian4.clone,func:function(){return t.value}};return t}function Ih(e){var t={value:Cesium.Matrix2.fromColumnMajorArray(e),clone:Cesium.Matrix2.clone,func:function(){return t.value}};return t}function Lh(e){var t={value:Cesium.Matrix3.fromColumnMajorArray(e),clone:Cesium.Matrix3.clone,func:function(){return t.value}};return t}function Cl(e){var t={value:Cesium.Matrix4.fromColumnMajorArray(e),clone:Cesium.Matrix4.clone,func:function(){return t.value}};return t}function El(e,t,r){this._value=void 0,this._textureId=e.index,this._textures=t,this._defaultTexture=r}Object.defineProperties(El.prototype,{value:{get:function(){if(!Cesium.defined(this._value)){var e=this._textures[this._textureId];if(Cesium.defined(e))this._value=e;else return this._defaultTexture}return this._value},set:function(e){this._value=e}}});El.prototype.clone=function(e){return e};El.prototype.func=void 0;function ub(e,t,r){var n=new El(e,t,r);return n.func=function(){return n.value},n}var tn={};tn[Cesium.WebGLConstants.FLOAT]=Ao;tn[Cesium.WebGLConstants.FLOAT_VEC2]=yl;tn[Cesium.WebGLConstants.FLOAT_VEC3]=xl;tn[Cesium.WebGLConstants.FLOAT_VEC4]=Do;tn[Cesium.WebGLConstants.INT]=Ao;tn[Cesium.WebGLConstants.INT_VEC2]=yl;tn[Cesium.WebGLConstants.INT_VEC3]=xl;tn[Cesium.WebGLConstants.INT_VEC4]=Do;tn[Cesium.WebGLConstants.BOOL]=Ao;tn[Cesium.WebGLConstants.BOOL_VEC2]=yl;tn[Cesium.WebGLConstants.BOOL_VEC3]=xl;tn[Cesium.WebGLConstants.BOOL_VEC4]=Do;tn[Cesium.WebGLConstants.FLOAT_MAT2]=Ih;tn[Cesium.WebGLConstants.FLOAT_MAT3]=Lh;tn[Cesium.WebGLConstants.FLOAT_MAT4]=Cl;tn[Cesium.WebGLConstants.SAMPLER_2D]=ub;Le.createUniformFunction=function(e,t,r,n){return tn[e](t,r,n)};function fb(e){return[e[0],e[1],e[2],e[3],e[5],e[6],e[7],e[8],e[10],e[11],e[12],e[13],e[15],e[16],e[17],e[18]]}function lb(e){return[e[20],e[21],e[22],e[23]]}Le.createUniformsForDracoQuantizedAttributes=function(e){var t={};for(var r in e)if(e.hasOwnProperty(r)){var n=e[r],i=n.quantization;if(!Cesium.defined(i))continue;r.charAt(0)==="_"&&(r=r.substring(1));var s="gltf_u_dec_"+r.toLowerCase();if(i.octEncoded){var a=s+"_rangeConstant",o=(1<<i.quantizationBits)-1;t[a]=Ao(o).func;continue}var u=s+"_normConstant",f=i.range/(1<<i.quantizationBits);t[u]=Ao(f).func;var l=s+"_min";switch(n.componentsPerAttribute){case 1:t[l]=Ao(i.minValues).func;break;case 2:t[l]=yl(i.minValues).func;break;case 3:t[l]=xl(i.minValues).func;break;case 4:t[l]=Do(i.minValues).func;break}}return t};Le.createUniformsForQuantizedAttributes=function(e,t,r){var n=e.accessors,i={},s={},a=t.attributes;for(var o in a)if(a.hasOwnProperty(o)){var u=a[o],f=n[u],l=f.extensions;if(o.charAt(0)==="_"&&(o=o.substring(1)),Cesium.defined(l)){var c=l.WEB3D_quantized_attributes;if(Cesium.defined(c)){var h=c.decodeMatrix,d="gltf_u_dec_"+o.toLowerCase();switch(f.type){case Cesium.AttributeType.SCALAR:s[d]=Ih(h).func,i[d]=!0;break;case Cesium.AttributeType.VEC2:s[d]=Lh(h).func,i[d]=!0;break;case Cesium.AttributeType.VEC3:s[d]=Cl(h).func,i[d]=!0;break;case Cesium.AttributeType.VEC4:var m=d+"_scale",g=d+"_translate";s[m]=Cl(fb(h)).func,s[g]=Do(lb(h)).func,i[m]=!0,i[g]=!0;break}}}}for(var p in r)if(r.hasOwnProperty(p)&&!i[p]){var v=r[p];Cesium.defined(v.mat)&&(v.mat===2?s[p]=Ih(Cesium.Matrix2.IDENTITY).func:v.mat===3?s[p]=Lh(Cesium.Matrix3.IDENTITY).func:v.mat===4&&(s[p]=Cl(Cesium.Matrix4.IDENTITY).func)),Cesium.defined(v.vec)&&v.vec===4&&(s[p]=Do([0,0,0,0]).func)}return s};var Mo=new Cesium.Cartesian3,cb={MODEL:function(e,t){return function(){return e.model}},VIEW:function(e,t){return function(){return e.view}},PROJECTION:function(e,t){return function(){return e.projection}},MODELVIEW:function(e,t){return function(){return e.modelView}},CESIUM_RTC_MODELVIEW:function(e,t){var r=new Cesium.Matrix4;return function(){return Cesium.defined(t._rtcCenter)?(Cesium.Matrix4.getTranslation(e.model,Mo),Cesium.Cartesian3.add(Mo,t._rtcCenter,Mo),Cesium.Matrix4.multiplyByPoint(e.view,Mo,Mo),Cesium.Matrix4.setTranslation(e.modelView,Mo,r)):e.modelView}},MODELVIEWPROJECTION:function(e,t){return function(){return e.modelViewProjection}},MODELINVERSE:function(e,t){return function(){return e.inverseModel}},VIEWINVERSE:function(e,t){return function(){return e.inverseView}},PROJECTIONINVERSE:function(e,t){return function(){return e.inverseProjection}},MODELVIEWINVERSE:function(e,t){return function(){return e.inverseModelView}},MODELVIEWPROJECTIONINVERSE:function(e,t){return function(){return e.inverseModelViewProjection}},MODELINVERSETRANSPOSE:function(e,t){return function(){return e.inverseTransposeModel}},MODELVIEWINVERSETRANSPOSE:function(e,t){return function(){return e.normal}},VIEWPORT:function(e,t){return function(){return e.viewportCartesian4}}};Le.getGltfSemanticUniforms=function(){return cb};var ee=Le;function bl(e){this._meshId=Cesium.defaultValue(e.meshId,-1),this._instances=Cesium.defaultValue(e.instances,[]),this._model=Cesium.defaultValue(e.model,void 0),this._frameState=Cesium.defaultValue(e.frameState,void 0),this.show=Cesium.defaultValue(e.show,!0),this._instancingSupported=!1,this._dynamic=Cesium.defaultValue(e.dynamic,!1),this._allowPicking=Cesium.defaultValue(e.allowPicking,!0),this._dirty=!1,this.resource=e.model.content._resource,this._cull=Cesium.defaultValue(e.cull,!0),this._opaquePass=Cesium.defaultValue(e.opaquePass,Cesium.Pass.OPAQUE),this._drawCommands=[];let t=this._model.content._batchTable,r=0;Cesium.defined(t)&&Cesium.defined(t._properties.EVID)?r=Cesium.defined(t._properties.EVID[0])?t._properties.EVID[0]:1:r=t._content._tile._header.EVID;let n={EVID:[],id:[],name:[]},i=this._model.gltf.nodes;for(let s=0;s<this._instances.length;s++){let a=this._instances[s]._nodeId,o=i[a];this._instances[s]._instanceId=o.instanceIndex,n.id.push(o.componentID),n.name.push(o.componentName),n.EVID.push(r)}this._batchTable=new zr(Cesium.defined(this._model)?this._model.content:void 0,this._instances.length,n),this._batchTable.upMatrix=Cesium.Axis.Y_UP_TO_Z_UP,this._features=void 0,this._vertexBufferTypedArray=void 0,this._vertexBuffer=void 0,this._batchIdBuffer=void 0,this._pickIdBuffer=void 0,this._features=void 0,this._drawCommands=[],this._modelCommands=void 0,Cesium.defined(this._model.content._tile._boundingVolume)?this._boundingSphere=Cesium.BoundingSphere.clone(this._model.content._tile._boundingVolume._boundingSphere):this._boundingSphere=hb(this),this._center=Cesium.Cartesian3.clone(this._boundingSphere.center),this._rtcTransform=Cesium.Matrix4.clone(Cesium.Matrix4.IDENTITY),this._rtcModelView=new Cesium.Matrix4,this._mode=void 0,this.modelMatrix=Cesium.Matrix4.clone(Cesium.Matrix4.IDENTITY),this._modelMatrix=Cesium.Matrix4.clone(this.modelMatrix),this._boundingVolume=mb(this._boundingSphere,this.modelMatrix),this._asynchronous=e.asynchronous,this._incrementallyLoadTextures=e.incrementallyLoadTextures,this._upAxis=e.upAxis,this._forwardAxis=e.forwardAxis,this._tileset=this._model.content.tileset}Object.defineProperties(bl.prototype,{length:{get:function(){return this._instances.length}},featuresLength:{get:function(){return this._batchTable.featuresLength}},tileset:{get:function(){return this._tileset}},batchTable:{get:function(){return this._batchTable}},url:{get:function(){return this.resource.getUrlComponent(!0)}}});bl.prototype.isDestroyed=function(){return!1};bl.prototype.destroy=function(){return this._instances=[],Cesium.defined(this._pickIdBuffer)&&!this._pickIdBuffer.isDestroyed()&&this._pickIdBuffer.destroy(),Cesium.defined(this._batchIdBuffer)&&!this._batchIdBuffer.isDestroyed()&&this._batchIdBuffer.destroy(),this._batchTable=this._batchTable&&this._batchTable.destroy(),Cesium.destroyObject(this)};function hb(e){let t=e.length,r=new Array(t);for(let n=0;n<t;++n)r[n]=Cesium.Matrix4.getTranslation(e._instances[n]._modelMatrix,new Cesium.Cartesian3);return Cesium.BoundingSphere.fromPoints(r)}var db=new Cesium.Cartesian3;function mb(e,t){if(!Cesium.defined(e))throw new Cesium.RuntimeError("boundingSphere must be defined");if(Cesium.defined(e)){let r=e.center,n=e.radius;r=Cesium.Matrix4.multiplyByPoint(t,r,r);let i=Cesium.Matrix4.getScale(t,db),s=Cesium.Cartesian3.maximumComponent(i);return n*=s,new Cesium.TileBoundingSphere(r,n)}}function ta(e){if(!Cesium.defined(e.model))throw new Cesium.DeveloperError("EV_E3MInternalInstance: options.model is required.");this._model=e.model,this.modelInstanceCollections=[],this._instancedUniformsByProgram=void 0,this._usesBatchTable=!0,this._tileset=this._model.content.tileset,this._precreatedAttributes=void 0}ta.prototype.postUpdate=function(e,t){for(let r=0;r<this.modelInstanceCollections.length;r++){let n=this.modelInstanceCollections[r],i=e.mode!==n._mode,s=t.modelMatrix,a=!Cesium.Matrix4.equals(n._modelMatrix,s);pb(n,n._tileset,e),(i||a)&&(n._mode=e.mode,Cesium.Matrix4.clone(s,n._modelMatrix),n._rtcTransform=n._modelMatrix)}};function pb(e,t,r){if(t.debugShowBoundingVolume||t.debugShowContentBoundingVolume){let i=Cesium.Color.BLUE;Cesium.defined(e._debugBoundingVolume)||(e._debugBoundingVolume=e._boundingVolume.createDebugVolume(i)),e._debugBoundingVolume.update(r)}}ta.prototype.generateInstanceCommandByGltf=function(e,t,r,n){let i=[];for(let s in r._hash)if(r.length>0){let a=new bl({instances:r._hash[s],model:e,meshId:s,frameState:n});n&&this.cesium3DTileBatchTableUpdate(e.content,n),Sb(this,a,t,n.scene3DOnly),this.modelInstanceCollections.push(a)}};var gb=new Cesium.Color;ta.prototype.applyStyle=function(e){for(let t=0;t<this.modelInstanceCollections.length;t++){let r=this.modelInstanceCollections[t];if(r.featuresLength===0){let n=Cesium.defined(e)&&Cesium.defined(e.color),i=Cesium.defined(e)&&Cesium.defined(e.show);r._model.color=n?e.color.evaluateColor(void 0,r._model.color):Cesium.Color.clone(Cesium.Color.WHITE,r._model.color),r._model.show=i?e.show.evaluate(void 0):!0}else{if(!Cesium.defined(e)){r._batchTable.setAllColor(zr._DEFAULT_COLOR_VALUE),r._batchTable.setAllShow(zr._DEFAULT_SHOW_VALUE);return}let n=r._batchTable.featuresLength;for(let i=0;i<n;++i){let s=Dh(r,i),a=Cesium.defined(e.color)?e.color.evaluateColor(s,gb):zr._DEFAULT_COLOR_VALUE,o=Cesium.defined(e.show)?e.show.evaluate(s):zr._DEFAULT_SHOW_VALUE;if(r._batchTable.setColor(i,a),r._batchTable.setShow(i,o),Cesium.defined(e.translation)){let u=e.translation.evaluate(s);r._batchTable.setTranslation(i,u)}if(Cesium.defined(e.scale)){let u=e.scale.evaluate(s);r._batchTable.setScale(i,u)}if(Cesium.defined(e.rotation)){let u=e.rotation.evaluate(s);r._batchTable.setRotation(i,u)}}}}};ta.prototype.cesium3DTileBatchTableUpdate=function(e,t){let r=t.context,n=t.passes;for(let i=0;i<this.modelInstanceCollections.length;i++){let s=this.modelInstanceCollections[i],a=s._batchTable;a._defaultTexture=r.defaultTexture,!NO_support_OES_float&&!Cesium.defined(a._defaultTransTexture)&&Cesium.defined(a._textureDimensions)&&(a._defaultTransTexture=Ig(a,r)),!NO_support_OES_float&&!Cesium.defined(a._defaultScaleTexture)&&Cesium.defined(a._textureDimensions)&&(a._defaultScaleTexture=xb(a,r)),!NO_support_OES_float&&!Cesium.defined(a._defaultRotationTexture)&&Cesium.defined(a._textureDimensions)&&(a._defaultRotationTexture=Ig(a,r)),(n.pick||n.postProcess)&&_b(a,r,s),a._batchValuesDirty&&(a._batchValuesDirty=!1,!Cesium.defined(a._batchTexture)&&Cesium.defined(a._batchValues)&&(a._batchTexture=Pg(a,r,a._batchValues),e._statistics.batchTableByteLength+=a._batchTexture.sizeInBytes),!NO_support_OES_float&&!Cesium.defined(a._translationTexture)&&Cesium.defined(a._transValues)&&(a._translationTexture=Ph(a,r,a._transValues)),!NO_support_OES_float&&!Cesium.defined(a._scaleTexture)&&Cesium.defined(a._scaleValues)&&(a._scaleTexture=Ph(a,r,a._scaleValues)),!NO_support_OES_float&&!Cesium.defined(a._rotationTexture)&&Cesium.defined(a._rotationValues)&&(a._rotationTexture=Ph(a,r,a._rotationValues)),Cesium.defined(a._batchValues)&&yb(a),!NO_support_OES_float&&Cesium.defined(a._transValues)&&Mh(a,a._transValues,a._translationTexture),!NO_support_OES_float&&Cesium.defined(a._scaleValues)&&Mh(a,a._scaleValues,a._scaleTexture),!NO_support_OES_float&&Cesium.defined(a._rotationValues)&&Mh(a,a._rotationValues,a._rotationTexture))}};ta.prototype.destroy=function(){Cesium.defined(this._precreatedAttributes)&&vb(this._model._rendererResources.vertexArrays);for(let e=0;e<this.modelInstanceCollections.length;e++)this.modelInstanceCollections[e].destroy(),this.modelInstanceCollections[e]=void 0;return this.modelInstanceCollections=[],this._model=null,Cesium.destroyObject(this)};ta.prototype.regenerateShaders=function(e,t,r){Yb(e,t,r,this)};ta.prototype.getFeature=function(e,t){return Dh(e,t)};function vb(e){for(let t in e)e.hasOwnProperty(t)&&(e[t].isDestroyed()||e[t].destroy())}function _b(e,t,r){let n=e.featuresLength;if(!Cesium.defined(e._pickTexture)&&n>0){let i=e._pickIds,s=e._textureDimensions,a=s.x*s.y*4,o=new Uint8Array(a),u=e._content;for(let f=0;f<n;++f){let l=t.createPickId(Dh(r,f));i.push(l);let c=l.color,h=f*4;o[h]=Cesium.Color.floatToByte(c.red),o[h+1]=Cesium.Color.floatToByte(c.green),o[h+2]=Cesium.Color.floatToByte(c.blue),o[h+3]=Cesium.Color.floatToByte(c.alpha)}e._pickTexture=Pg(e,t,o),u.tileset._statistics.batchTableByteLength+=e._pickTexture.sizeInBytes}}function Dh(e,t){let r=e.featuresLength;return Cb(e),e._features[t]}function Cb(e){let t=e.featuresLength;if(!Cesium.defined(e._features)&&t>0){let r=new Array(t);for(let n=0;n<t;++n)r[n]=new Rn(e,n);e._features=r}}function Pg(e,t,r){let n=e._textureDimensions;return new Ir({context:t,pixelFormat:Cesium.PixelFormat.RGBA,pixelDatatype:Cesium.PixelDatatype.UNSIGNED_BYTE,source:{width:n.x,height:n.y,arrayBufferView:r},flipY:!1,sampler:Cesium.Sampler.NEAREST})}function Ph(e,t,r){let n=e._textureDimensions;return new Ir({context:t,pixelFormat:Cesium.PixelFormat.RGBA,pixelDatatype:Cesium.PixelDatatype.FLOAT,source:{width:n.x,height:n.y,arrayBufferView:r},flipY:!1,sampler:Cesium.Sampler.NEAREST})}function yb(e){let t=e._textureDimensions;e._batchTexture.copyFrom({width:t.x,height:t.y,arrayBufferView:e._batchValues})}function Mh(e,t,r){let n=e._textureDimensions;r.copyFrom({width:n.x,height:n.y,arrayBufferView:t})}function Ig(e,t){return new Ir({context:t,pixelFormat:Cesium.PixelFormat.RGBA,pixelDatatype:Cesium.PixelDatatype.FLOAT,source:{width:1,height:1,arrayBufferView:new Float32Array([0,0,0,1])},flipY:!1,sampler:Cesium.Sampler.NEAREST})}function xb(e,t){return new Ir({context:t,pixelFormat:Cesium.PixelFormat.RGBA,pixelDatatype:Cesium.PixelDatatype.FLOAT,source:{width:1,height:1,arrayBufferView:new Float32Array([1,1,1,1])},flipY:!1,sampler:Cesium.Sampler.NEAREST})}function Eb(e,t){let r,i=e._instances.length,s=e._dynamic,a=Cesium.defined(e._batchTable);if(a){let u=new Uint16Array(i);for(r=0;r<i;++r)u[r]=r;e._batchIdBuffer=Cesium.Buffer.createVertexBuffer({context:t,typedArray:u,usage:Cesium.BufferUsage.STATIC_DRAW})}if(!a){let u=new Uint8Array(i*4);for(r=0;r<i;++r){let l=e._pickIds[r].color,c=r*4;u[c]=Cesium.Color.floatToByte(l.red),u[c+1]=Cesium.Color.floatToByte(l.green),u[c+2]=Cesium.Color.floatToByte(l.blue),u[c+3]=Cesium.Color.floatToByte(l.alpha)}e._pickIdBuffer=Cesium.Buffer.createVertexBuffer({context:t,typedArray:u,usage:Cesium.BufferUsage.STATIC_DRAW})}let o=wb(e);e._vertexBuffer=Cesium.Buffer.createVertexBuffer({context:t,typedArray:o,usage:s?Cesium.BufferUsage.STREAM_DRAW:Cesium.BufferUsage.STATIC_DRAW})}var bb=new Cesium.Matrix4;function wb(e){let t=e._instances,r=t.length,n=e._center,i=12,s=e._vertexBufferTypedArray;Cesium.defined(s)||(s=new Float32Array(r*i)),e._dynamic&&(e._vertexBufferTypedArray=s);for(let a=0;a<r;++a){let o=t[a]._modelMatrix,u=Cesium.Matrix4.clone(o,bb),f=a*i;s[f+0]=u[0],s[f+1]=u[4],s[f+2]=u[8],s[f+3]=u[12],s[f+4]=u[1],s[f+5]=u[5],s[f+6]=u[9],s[f+7]=u[13],s[f+8]=u[2],s[f+9]=u[6],s[f+10]=u[10],s[f+11]=u[14]}return s}function Sb(e,t,r,n){Eb(t,r);let i=Cesium.defined(t._batchTable),s=12,a=Cesium.ComponentDatatype.getSizeInBytes(Cesium.ComponentDatatype.FLOAT),o={czm_modelMatrixRow0:{index:0,vertexBuffer:t._vertexBuffer,componentsPerAttribute:4,componentDatatype:Cesium.ComponentDatatype.FLOAT,normalize:!1,offsetInBytes:0,strideInBytes:a*s,instanceDivisor:1},czm_modelMatrixRow1:{index:0,vertexBuffer:t._vertexBuffer,componentsPerAttribute:4,componentDatatype:Cesium.ComponentDatatype.FLOAT,normalize:!1,offsetInBytes:a*4,strideInBytes:a*s,instanceDivisor:1},czm_modelMatrixRow2:{index:0,vertexBuffer:t._vertexBuffer,componentsPerAttribute:4,componentDatatype:Cesium.ComponentDatatype.FLOAT,normalize:!1,offsetInBytes:a*8,strideInBytes:a*s,instanceDivisor:1}};i&&(o.a_batchId={index:0,vertexBuffer:t._batchIdBuffer,componentsPerAttribute:1,componentDatatype:Cesium.ComponentDatatype.UNSIGNED_SHORT,normalize:!1,offsetInBytes:0,strideInBytes:0,instanceDivisor:1}),i||(o.pickColor={index:0,vertexBuffer:t._pickIdBuffer,componentsPerAttribute:4,componentDatatype:Cesium.ComponentDatatype.UNSIGNED_BYTE,normalize:!0,offsetInBytes:0,strideInBytes:0,instanceDivisor:1});let u=t._model;e._precreatedAttributes=o;let f=u._nodeCommands,l=u._pickIds,c=u.allowPicking,h=u._runtime.meshesByName,d=u._rendererResources,m=d.vertexArrays,g=d.programs,p=d.renderStates,v=u._uniformMaps,_=u._runtime.nodes,y=u.gltf,x=y.accessors,S=y.meshes[t._meshId],I=S.primitives,P=I.length;for(let w=0;w<P;++w){let N=I[w],B=x[N.indices],C=u._runtime.materialsById[N.material],b=C._program,T=u._decodedData[`${t._meshId}.primitive.${w}`],A,R=N.attributes.POSITION;if(Cesium.defined(R)){let be=ee.getAccessorMinMax(y,R);A=Cesium.BoundingSphere.fromCornerPoints(Cesium.Cartesian3.fromArray(be.min),Cesium.Cartesian3.fromArray(be.max))}zb(e,t,C._technique,u,r);let F=y.nodes[t._instances[0]._nodeId],D=_[t._instances[0]._nodeId];if(D.matrix=Cesium.Matrix4.IDENTITY,!Cesium.defined(F.mesh))continue;let O=m[`${t._meshId}.primitive.${w}`],U,q;Cesium.defined(T)?(q=T.numberOfIndices,U=0):Cesium.defined(B)?(q=B.count,U=B.byteOffset/Cesium.IndexDatatype.getSizeInBytes(B.componentType)):(q=x[N.attributes.POSITION].count,U=0),u._trianglesLength+=Vb(N,q);let Y=v[N.material],W=Y.uniformMap;if(Cesium.defined(Y.jointMatrixUniformName)){let be={};be[Y.jointMatrixUniformName]=$b(D),W=Cesium.combine(W,be)}if(u._tilesetFlat&&(W=Cesium.combine(W,u._tilesetFlat._updateModelUniformMap())),Cesium.defined(Y.morphWeightsUniformName)){let be={};be[Y.morphWeightsUniformName]=e1(D),W=Cesium.combine(W,be)}W=Cesium.combine(W,{gltf_color:t1(u),gltf_colorBlend:r1(u),gltf_clippingPlanes:n1(u),gltf_clippingPlanesEdgeStyle:i1(u),gltf_clippingPlanesMatrix:a1(u),gltf_iblFactor:u1(u),gltf_lightColor:f1(u),gltf_sphericalHarmonicCoefficients:c1(u),gltf_specularMap:h1(u),gltf_specularMapSize:d1(u),gltf_maxSpecularLOD:m1(u),gltf_luminanceAtZenith:l1(u)}),W=Tb(t,r,W,b,D);let K={};u.extensionsUsed.WEB3D_quantized_attributes?K=p1(u,N):u._dequantizeInShader&&Cesium.defined(T)&&(K=g1(T)),W=Cesium.combine(W,K);let re=p[N.material],ce=re.blending.enabled,Se;Cesium.defined(Se)||(Se={primitive:u,id:u.id,node:D.publicNode,mesh:h[S.name],meshId:t._meshId});let de=Cesium.ShadowMode.castShadows(u._shadows),Ae=Cesium.ShadowMode.receiveShadows(u._shadows),ye;if(c&&!Cesium.defined(u._uniformMapLoaded)){ye=r.createPickId(Se),l.push(ye);let be={czm_pickColor:Bg(ye.color)};W=Cesium.combine(W,be)}c&&(Cesium.defined(u._pickIdLoaded)&&Cesium.defined(u._uniformMapLoaded)?ye=u._pickIdLoaded():ye="czm_pickColor");let Ie=new Cesium.DrawCommand({boundingVolume:new Cesium.BoundingSphere,cull:u.cull,modelMatrix:new Cesium.Matrix4,primitiveType:N.mode,vertexArray:O,count:q,offset:U,shaderProgram:g[b],castShadows:de,receiveShadows:Ae,uniformMap:W,renderState:re,owner:Se,pass:ce?Cesium.Pass.TRANSLUCENT:u.opaquePass,pickId:ye,debugShowBoundingVolume:!1}),$;n||($=Cesium.DrawCommand.shallowClone(Ie),$.boundingVolume=new Cesium.BoundingSphere,$.modelMatrix=new Cesium.Matrix4);let De={show:!0,boundingSphere:A,command:Ie,command2D:$,silhouetteModelCommand:void 0,silhouetteModelCommand2D:void 0,silhouetteColorCommand:void 0,silhouetteColorCommand2D:void 0,translucentCommand:void 0,translucentCommand2D:void 0,programId:b};t._instancingSupported=r.instancedArrays;let se=t._instancingSupported;Ob(t,se,[De.command]),Ab(t),Db(t),Rb(t),Cesium.ForEach.object(t._drawCommands,function(be,lr){D.gltfInstaced=!0,De.command=be,D.commands.push(De),f.push(De)})}}function Tb(e,t,r,n,i){r=Cesium.clone(r),r.czm_instanced_modifiedModelView=Lb(e,t),r.czm_instanced_nodeTransform=Ib(i),r.czm_instanced_modelMatrix=Pb(e),r.czm_instanced_inverseModelMatrix=Mb(e);let s=Rh(e,n);for(let a in s)s.hasOwnProperty(a)&&delete r[a];return Cesium.defined(e._batchTable)&&(r=e._batchTable.getUniformMapCallback()(r)),r}function Ib(e){return function(){return e.computedMatrix}}function Lb(e,t){return function(){return Cesium.Matrix4.multiply(t.uniformState.view,e._rtcTransform,e._rtcModelView)}}function Pb(e){return function(){return e._rtcTransform}}function Mb(e){return function(){return Cesium.Matrix4.inverse(e._rtcTransform,new Cesium.Matrix4)}}function Ab(e){if(e.shadows!==e._shadows){e._shadows=e.shadows;let t=Cesium.ShadowMode.castShadows(e.shadows),r=Cesium.ShadowMode.receiveShadows(e.shadows),n=e._drawCommands,i=n.length;for(let s=0;s<i;++s){let a=n[s];a.castShadows=t,a.receiveShadows=r}}}function Db(e){if(e._debugWireframe!==e.debugWireframe){e._debugWireframe=e.debugWireframe;let t=e.debugWireframe?Cesium.PrimitiveType.LINES:Cesium.PrimitiveType.TRIANGLES,r=e._drawCommands,n=r.length;for(let i=0;i<n;++i)r[i].primitiveType=t}}function Rb(e){if(e.debugShowBoundingVolume!==e._debugShowBoundingVolume){e._debugShowBoundingVolume=e.debugShowBoundingVolume;let t=e._drawCommands,r=t.length;for(let n=0;n<r;++n)t[n].debugShowBoundingVolume=e.debugShowBoundingVolume}}function Ob(e,t,r){t?Nb(e,r):(Fb(e,r),Bb(e))}function Nb(e,t){let r=t.length,n=e.length,i=e._boundingSphere,s=e._cull;for(let a=0;a<r;++a){let o=Cesium.DrawCommand.shallowClone(t[a]);o.instanceCount=n,o.boundingVolume=i,o.cull=s,Cesium.defined(e._batchTable)?o.pickId=e._batchTable.getPickId():o.pickId="v_pickColor",e._drawCommands.push(o)}}function Fb(e,t){let r=e._instances,n=t.length,i=e.length,s=e._batchTable,a=Cesium.defined(s),o=e._cull;for(let u=0;u<n;++u)for(let f=0;f<i;++f){let l=Cesium.DrawCommand.shallowClone(t[u]);if(l.modelMatrix=new Cesium.Matrix4,l.boundingVolume=new Cesium.BoundingSphere,l.cull=o,l.uniformMap=Cesium.clone(l.uniformMap),a)l.uniformMap.a_batchId=createBatchIdFunction(r[f]._instanceId);else{let c=e._pickIds[f];l.uniformMap.czm_pickColor=Bg(c.color)}e._drawCommands.push(l)}}function Bb(e){let t=e._modelCommands,r=t.length,n=e.length,i=e._rtcTransform,s=e._center;for(let a=0;a<r;++a){let o=t[a];for(let u=0;u<n;++u){let f=a*n+u,l=e._drawCommands[f],c=Cesium.Matrix4.clone(e._instances[u]._modelMatrix,void 0);c[12]-=s.x,c[13]-=s.y,c[14]-=s.z,c=Cesium.Matrix4.multiply(i,c,void 0);let h=o.modelMatrix,d=l.modelMatrix;Cesium.Matrix4.multiply(c,h,d);let m=o.boundingVolume,g=l.boundingVolume;Cesium.BoundingSphere.transform(m,c,g)}}}function Vb(e,t){switch(e.mode){case Cesium.PrimitiveType.TRIANGLES:return t/3;case Cesium.PrimitiveType.TRIANGLE_STRIP:case Cesium.PrimitiveType.TRIANGLE_FAN:return Math.max(t-2,0);default:return 0}}function zb(e,t,r,n,i){let s=n._quantizedVertexShaders,a=Cesium.defined(n._toClipCoordinatesGLSL)?n._toClipCoordinatesGLSL:n._toClipCoordinatesGLSL={},u=n._rendererResources.sourceShaders,f=n._sourceTechniques,l=n._sourcePrograms;if(f.hasOwnProperty(r)){let c=f[r].program,h=l[c],d=u[h.vertexShader];if(ee.checkSupportedGlExtensions(h.glExtensions,i),n.extensionsUsed.WEB3D_quantized_attributes||n._dequantizeInShader){let g=s[c];Cesium.defined(g)||(g=Rg(d,c,n),s[c]=g),d=g}d=Wb(t,r,d,c,e),a[c]=ee.toClipCoordinatesGLSL(n.gltf,d),Xb({programId:c,techniqueId:r},t,n,i,e),jb(n,t._meshId,i,e)}}function Rh(e,t,r){if(Cesium.defined(e._instancedUniformsByProgram)&&e._instancedUniformsByProgram.hasOwnProperty(r))return e._instancedUniformsByProgram[r];let n={};e._instancedUniformsByProgram=n;let i=["MODEL","MODELVIEW","CESIUM_RTC_MODELVIEW","MODELVIEWPROJECTION","MODELINVERSE","MODELVIEWINVERSE","MODELVIEWPROJECTIONINVERSE","MODELINVERSETRANSPOSE","MODELVIEWINVERSETRANSPOSE"],s=["MODELVIEW","CESIUM_RTC_MODELVIEW","MODELVIEWPROJECTION","MODELVIEWINVERSETRANSPOSE"],a=e._model._sourceTechniques;if(a.hasOwnProperty(t)){let o=a[t],u=o.program;if(!Cesium.defined(n[u])){let f={};n[u]=f,Cesium.ForEach.techniqueUniform(o,kb(i,s,r,f))}}return n[r]}function kb(e,t,r,n){return function(i,s){let a=i.semantic;if(Cesium.defined(a)&&e.indexOf(a)>-1)if(t.indexOf(a)>-1)n[s]=a;else throw new Cesium.RuntimeError(`Shader program cannot be optimized for instancing. Uniform "${s}" in program "${r}" uses unsupported semantic "${a}"`)}}function Mg(e,t,r){let n=r._usesBatchTable;if(Cesium.defined(n)){let i=r._model.gltf,s=ee.getDiffuseAttributeOrUniform(i,t);e=Gb(!0,s,e)}else e=`varying vec4 v_pickColor;
${e}`;return e}function Ag(e,t,r,n){let i=Rh(n,r,t),s=n._usesBatchTable,a=Cesium.ShaderSource.replaceMain(e,"czm_instancing_main"),o="",u="";for(let m in i)if(i.hasOwnProperty(m)){let g=i[m],p;g==="MODELVIEW"||g==="CESIUM_RTC_MODELVIEW"?p="czm_instanced_modelView":g==="MODELVIEWPROJECTION"?(p="czm_instanced_modelViewProjection",o+=`mat4 czm_instanced_modelViewProjection;
`,u+=`czm_instanced_modelViewProjection = czm_projection * czm_instanced_modelView;
`):g==="MODELVIEWINVERSETRANSPOSE"&&(p="czm_instanced_modelViewInverseTranspose",o+=`mat3 czm_instanced_modelViewInverseTranspose;
`,u+=`czm_instanced_modelViewInverseTranspose = mat3(czm_instanced_modelView);
`);let v=new RegExp(`uniform.*${m}.*`);a=a.replace(v,""),v=new RegExp(`${m}\\b`,"g"),a=a.replace(v,p)}let f=`uniform mat4 czm_instanced_modifiedModelView;
uniform mat4 czm_instanced_modelMatrix;
uniform mat4 czm_instanced_inverseModelMatrix;
uniform mat4 czm_instanced_nodeTransform;
`,l,c,h;s?(l="",c="",h=""):(l="",c=`attribute vec4 pickColor;
varying vec4 v_pickColor;
`,h=`    v_pickColor = pickColor;
`);let d=`${f+o}mat4 czm_instanced_modelView;
attribute vec4 czm_modelMatrixRow0;
attribute vec4 czm_modelMatrixRow1;
attribute vec4 czm_modelMatrixRow2;
${l}${c}${a}void main()
{
    mat4 czm_instanced_model = mat4(czm_modelMatrixRow0.x, czm_modelMatrixRow1.x, czm_modelMatrixRow2.x, 0.0, czm_modelMatrixRow0.y, czm_modelMatrixRow1.y, czm_modelMatrixRow2.y, 0.0, czm_modelMatrixRow0.z, czm_modelMatrixRow1.z, czm_modelMatrixRow2.z, 0.0, czm_modelMatrixRow0.w, czm_modelMatrixRow1.w, czm_modelMatrixRow2.w, 1.0);
    czm_instanced_modelView = czm_instanced_modifiedModelView * czm_instanced_model *  czm_instanced_nodeTransform      ;
${u}    czm_instancing_main();
${h}}
`;if(s){let m=n._model.gltf,g=ee.getDiffuseAttributeOrUniform(m,t);d=Ub(!0,"a_batchId",g,d)}return d}var Ah=`mat4 ev_fromTranslationQuaternionRotationScale(vec3 translation, vec4 quaternion, vec3 scale)
{
      float x2 = quaternion.x * quaternion.x;
      float xy = quaternion.x * quaternion.y;
      float xz = quaternion.x * quaternion.z;
      float xw = quaternion.x * quaternion.w;
      float y2 = quaternion.y * quaternion.y;
      float yz = quaternion.y * quaternion.z;
      float yw = quaternion.y * quaternion.w;
      float z2 = quaternion.z * quaternion.z;
      float zw = quaternion.z * quaternion.w;
      float w2 = quaternion.w * quaternion.w;

      float m00 = x2 - y2 - z2 + w2;
      float m01 = 2.0 * (xy - zw);
      float m02 = 2.0 * (xz + yw);

      float m10 = 2.0 * (xy + zw);
      float m11 = -x2 + y2 - z2 + w2;
      float m12 = 2.0 * (yz - xw);

      float m20 = 2.0 * (xz - yw);
      float m21 = 2.0 * (yz + xw);
      float m22 = -x2 - y2 + z2 + w2;
      return mat4(
        m00 * scale.x , m01* scale.x, m02* scale.x, 0.0,
        m10 * scale.y, m11 * scale.y, m12 * scale.y, 0.0,
        m20 * scale.z, m21 * scale.z, m22 * scale.z, 0.0,
        translation.x, translation.y, translation.z, 1.0);
}
`;function Ub(e,t,r,n){let i=Dg(n,r,!1),s=!1;NO_support_OES_float||(i.indexOf("gl_Position = u_modelViewProj * vec4(a_position,1.0);")!==-1?(s=!0,i=i.replace("attribute vec3 a_position;",`attribute vec3 a_position;
vec4 trans;
vec4 scale;
vec4 rotation;`),i=i.replace("gl_Position = u_modelViewProj * vec4(a_position,1.0);","gl_Position = u_modelViewProj * (ev_fromTranslationQuaternionRotationScale(trans.xyz,rotation,scale.xyz) * vec4(a_position,1.0));"),i=Ah+i):i.indexOf("vec3 gltf_a_dec_position")!==-1?(s=!0,i=i.replace("vec3 gltf_a_dec_position;",`vec3 gltf_a_dec_position;
vec4 trans;
vec4 scale;
vec4 rotation;`),i.indexOf("gl_Position = u_modelViewProj * vec4(gltf_a_dec_position,1.0)")!==-1?i=i.replace("gl_Position = u_modelViewProj * vec4(gltf_a_dec_position,1.0);"," gl_Position = u_modelViewProj * (ev_fromTranslationQuaternionRotationScale(trans.xyz,rotation,scale.xyz) * vec4(gltf_a_dec_position,1.0));"):i.indexOf("gl_Position = czm_instanced_modelViewProjection * vec4(gltf_a_dec_position,1.0)")!==-1?i=i.replace("czm_instanced_modelView = czm_instanced_modifiedModelView * czm_instanced_model *  czm_instanced_nodeTransform"," czm_instanced_modelView = czm_instanced_modifiedModelView * ev_fromTranslationQuaternionRotationScale(trans.xyz,rotation,scale.xyz)* czm_instanced_model * czm_instanced_nodeTransform"):i.indexOf("xlat_temp_input.position = vec4(gltf_a_dec_position,1.0)")!==-1&&(i=i.replace("xlat_temp_input.position = vec4(gltf_a_dec_position,1.0);","xlat_temp_input.position = ev_fromTranslationQuaternionRotationScale(trans.xyz,rotation,scale.xyz) * vec4(gltf_a_dec_position,1.0);")),i=Ah+i):i.indexOf("position = u_modelViewMatrix * position")!==-1&&(s=!0,i=i.replace("attribute vec3 a_position;",`attribute vec3 a_position;
vec4 trans;
vec4 scale;
vec4 rotation;`),i=i.replace("position = u_modelViewMatrix * position;","position = u_modelViewMatrix * (ev_fromTranslationQuaternionRotationScale(trans.xyz,rotation,scale.xyz) * position);"),i=Ah+i));let a;return Cesium.ContextLimits.maximumVertexTextureImageUnits>0?(a="",e&&(a+=`uniform bool tile_translucentCommand; 
`),s&&(a+=`uniform sampler2D tile_transTexture; 
uniform sampler2D tile_scaleTexture; 
uniform sampler2D tile_rotationTexture; 
`),a+=`uniform sampler2D tile_batchTexture; 
varying vec4 tile_featureColor; 
varying vec2 tile_featureSt; 
void main() 
{ 
    vec2 st = computeSt(${t}); 
    vec4 featureProperties = texture2D(tile_batchTexture, st); 
`,s&&(a+=`    trans = texture2D(tile_transTexture, vec2(st.x,0.0)); 
`,a+=`    scale = texture2D(tile_scaleTexture, vec2(st.x,0.0)); 
`,a+=`    rotation = texture2D(tile_rotationTexture, vec2(st.x,0.0)); 
`),a+=`    tile_color(featureProperties); 
    float show = ceil(featureProperties.a); 
    gl_Position *= show; 
`,e&&(a+=`    bool isStyleTranslucent = (featureProperties.a != 1.0); 
    if (czm_pass == czm_passTranslucent) 
    { 
        if (!isStyleTranslucent && !tile_translucentCommand) 
        { 
            gl_Position *= 0.0; 
        } 
    } 
    else 
    { 
        if (isStyleTranslucent) 
        { 
            gl_Position *= 0.0; 
        } 
    } 
`),a+=`    tile_featureColor = featureProperties; 
    tile_featureSt = st; 
}`):a=`varying vec2 tile_featureSt; 
void main() 
{ 
    tile_color(vec4(1.0)); 
    tile_featureSt = computeSt(${t}); 
}`,`${i}
${Hb()}${a}`}function Gb(e,t,r){return r=Dg(r,t,!0),Cesium.ContextLimits.maximumVertexTextureImageUnits>0?r+=`uniform sampler2D tile_pickTexture; 
varying vec2 tile_featureSt; 
varying vec4 tile_featureColor; 
void main() 
{ 
    tile_color(tile_featureColor); 
}`:(e&&(r+=`uniform bool tile_translucentCommand; 
`),r+=`uniform sampler2D tile_pickTexture; 
uniform sampler2D tile_batchTexture; 
varying vec2 tile_featureSt; 
void main() 
{ 
    vec4 featureProperties = texture2D(tile_batchTexture, tile_featureSt); 
    if (featureProperties.a == 0.0) { 
        discard; 
    } 
`,e&&(r+=`    bool isStyleTranslucent = (featureProperties.a != 1.0); 
    if (czm_pass == czm_passTranslucent) 
    { 
        if (!isStyleTranslucent && !tile_translucentCommand) 
        { 
            discard; 
        } 
    } 
    else 
    { 
        if (isStyleTranslucent) 
        { 
            discard; 
        } 
    } 
`),r+=`    tile_color(featureProperties); 
} 
`),r}function Dg(e,t,r){if(!Cesium.defined(t))return Lg(e,r);let n=new RegExp(`(uniform|attribute|in)\\s+(vec[34]|sampler2D)\\s+${t};`),i=e.match(n);if(!Cesium.defined(i))return Lg(e,r);let s=i[0],a=i[2];e=Cesium.ShaderSource.replaceMain(e,"tile_main"),e=e.replace(s,"");let o=`bool isWhite(vec3 color) 
{ 
    return all(greaterThan(color, vec3(1.0 - czm_epsilon3))); 
} 
vec4 tile_diffuse_final(vec4 sourceDiffuse, vec4 tileDiffuse) 
{ 
    vec4 blendDiffuse = mix(sourceDiffuse, tileDiffuse, tile_colorBlend); 
    vec4 diffuse = isWhite(tileDiffuse.rgb) ? sourceDiffuse : blendDiffuse; 
    return vec4(diffuse.rgb, sourceDiffuse.a); 
} 
`,u=`    tile_featureColor = czm_gammaCorrect(tile_featureColor); 
    gl_FragColor.a *= tile_featureColor.a; 
    float highlight = ceil(tile_colorBlend); 
 if(!all(greaterThan(tile_featureColor.rgb, vec3(1.0 - czm_epsilon3)))){ 
	if(highlight== 0.0){
		gl_FragColor.rgb = mix(tile_featureColor.rgb, gl_FragColor.rgb, 0.4);
	}else if(highlight== 1.0){
		gl_FragColor.rgb = tile_featureColor.rgb;
	}else{
		gl_FragColor.rgb *= mix(tile_featureColor.rgb, vec3(1.0), highlight);
	}
 }`,f;if(a==="vec3"||a==="vec4"){let l=a==="vec3"?`vec4(${t}, 1.0)`:t,c=a==="vec3"?"tile_diffuse.xyz":"tile_diffuse";n=new RegExp(t,"g"),e=e.replace(n,c),f=`    vec4 source = ${l}; 
    tile_diffuse = tile_diffuse_final(source, tile_featureColor); 
    tile_main(); 
`}else a==="sampler2D"&&(e=qb(e,t),f=`    tile_diffuse = tile_featureColor; 
    tile_main(); 
`);return e=`uniform float tile_colorBlend; 
vec4 tile_diffuse = vec4(1.0); 
${o}${s}
${e}
void tile_color(vec4 tile_featureColor) 
{ 
${f}`,r&&(e+=u),e+=`} 
`,e}function Lg(e,t){return e=Cesium.ShaderSource.replaceMain(e,"tile_main"),t?`${e}uniform float tile_colorBlend; 
void tile_color(vec4 tile_featureColor) 
{ 
    tile_main(); 
    tile_featureColor = czm_gammaCorrect(tile_featureColor); 
    gl_FragColor.a *= tile_featureColor.a; 
    float highlight = ceil(tile_colorBlend); 
    gl_FragColor.rgb *= mix(tile_featureColor.rgb, vec3(1.0), highlight); 
     if(highlight==1.0 && !all(greaterThan(tile_featureColor.rgb, vec3(1.0 - czm_epsilon3)))){ 
       gl_FragColor.rgb = tile_featureColor.rgb; 
      } 
} 
`:`${e}void tile_color(vec4 tile_featureColor) 
{ 
    tile_main(); 
} 
`}function qb(e,t){let r=`texture2D(${t}`,n=0,i=e.indexOf(r,n),s;for(;i>-1;){let a=0;for(let f=i;f<e.length;++f){let l=e.charAt(f);if(l==="(")++a;else if(l===")"&&(--a,a===0)){s=f+1;break}}let u=`tile_diffuse_final(${e.slice(i,s)}, tile_diffuse)`;e=e.slice(0,i)+u+e.slice(s),n=i+u.length,i=e.indexOf(r,n)}return e}function Hb(){return`uniform vec4 tile_textureStep; 
uniform vec2 tile_textureDimensions; 
vec2 computeSt(float batchId) 
{ 
    float stepX = tile_textureStep.x; 
    float centerX = tile_textureStep.y; 
    float stepY = tile_textureStep.z; 
    float centerY = tile_textureStep.w; 
    float xId = mod(batchId, tile_textureDimensions.x); 
    float yId = floor(batchId / tile_textureDimensions.x); 
    return vec2(centerX + (xId * stepX), centerY + (yId * stepY)); 
} 
`}function Wb(e,t,r,n,i){let s=r,a=n,o=Rh(i,t,a),u=Cesium.defined(e._batchTable),f=Cesium.ShaderSource.replaceMain(s,"czm_instancing_main"),l="",c="";for(let v in o)if(o.hasOwnProperty(v)){let _=o[v],y;_==="MODELVIEW"||_==="CESIUM_RTC_MODELVIEW"?y="czm_instanced_modelView":_==="MODELVIEWPROJECTION"?(y="czm_instanced_modelViewProjection",l+=`mat4 czm_instanced_modelViewProjection;
`,c+=`czm_instanced_modelViewProjection = czm_projection * czm_instanced_modelView;
`):_==="MODELVIEWINVERSETRANSPOSE"&&(y="czm_instanced_modelViewInverseTranspose",l+=`mat3 czm_instanced_modelViewInverseTranspose;
`,c+=`czm_instanced_modelViewInverseTranspose = mat3(czm_instanced_modelView);
`);let x=new RegExp(`uniform.*${v}.*`);f=f.replace(x,""),x=new RegExp(`${v}\\b`,"g"),f=f.replace(x,y)}let h=`uniform mat4 czm_instanced_modifiedModelView;
uniform mat4 czm_instanced_modelMatrix;
uniform mat4 czm_instanced_inverseModelMatrix;
uniform mat4 czm_instanced_nodeTransform;
`,d,m,g;u?(d="",m="",g=""):(d="",m=`attribute vec4 pickColor;
varying vec4 v_pickColor;
`,g=`    v_pickColor = pickColor;
`);let p=`${h+l}mat4 czm_instanced_modelView;
attribute vec4 czm_modelMatrixRow0;
attribute vec4 czm_modelMatrixRow1;
attribute vec4 czm_modelMatrixRow2;
${d}${m}${f}void main()
{
    mat4 czm_instanced_model = mat4(czm_modelMatrixRow0.x, czm_modelMatrixRow1.x, czm_modelMatrixRow2.x, 0.0, czm_modelMatrixRow0.y, czm_modelMatrixRow1.y, czm_modelMatrixRow2.y, 0.0, czm_modelMatrixRow0.z, czm_modelMatrixRow1.z, czm_modelMatrixRow2.z, 0.0, czm_modelMatrixRow0.w, czm_modelMatrixRow1.w, czm_modelMatrixRow2.w, 1.0);
    czm_instanced_modelView = czm_instanced_modifiedModelView * czm_instanced_model * czm_instanced_nodeTransform  ;
${c}    czm_instancing_main();
${g}}
`;if(u){let v=e._model.gltf,_=ee.getDiffuseAttributeOrUniform(v,a);p=e._batchTable.getVertexShaderCallback(!0,"a_batchId",_)(p)}return r=p,r}function Rg(e,t,r){let n,i=r._programPrimitives[t];if(!Cesium.defined(i))return e;let s;for(s in i)if(i.hasOwnProperty(s)&&(n=i[s],Fg(r,n)===t))break;r._programPrimitives[t]=void 0;let a;if(r.extensionsUsed.WEB3D_quantized_attributes)a=ee.modifyShaderForQuantizedAttributes(r.gltf,n,e),r._quantizedUniforms[t]=a.uniforms;else{let o=r._decodedData[s];if(Cesium.defined(o))a=ee.modifyShaderForDracoQuantizedAttributes(r.gltf,n,e,o.attributes);else return e}return a.shader}var Og=new Cesium.Cartesian4(0,0,1,1);function Yb(e,t,r,n){let i=e.programId,s=e.techniqueId;n._model=t;let a=t._sourcePrograms[i],o=t._rendererResources.sourceShaders,u=t._quantizedVertexShaders,f=t.clippingPlanes,l=Jb(t),c=o[a.vertexShader],h=o[a.fragmentShader];if(h+="uniform vec4 u_rollerRegion;",(t.extensionsUsed.WEB3D_quantized_attributes||t._dequantizeInShader)&&(c=u[i]),(t.extensionsUsed.WEB3D_quantized_attributes||t._dequantizeInShader)&&t._toClipCoordinatesGLSL[i].indexOf("czm_instanced_modelView ")===-1){let x=`
czm_instanced_modelView `;c.indexOf("gltf_a_dec_position")!==-1&&(x=`${x}
gltf_a_dec_position `),t._toClipCoordinatesGLSL[i]=ee.toClipCoordinatesGLSL(t.gltf,x)}let d=t._toClipCoordinatesGLSL[i],m=h;Zb(t)&&(m=o1(m)),l&&(m=Qb(m,f,r,t));let g=Ag(c,i,s,n),p=Mg(m,i,n);if(t._tilesetFlat&&(g=t._tilesetFlat._updateVertexShader(g)),Cesium.FeatureDetection.isInternetExplorer()||(g=ee.modifyVertexShaderForLogDepth(g,d),t.rollerRegion.equals(Og)?p=ee.modifyFragmentShaderForLogDepth(p):p=ee.modifyFragmentShaderForLogDepthAddRoller(p)),Cesium.defined(t._uniformMapLoaded)||(p=`uniform vec4 czm_pickColor;
${p}`),Cesium.defined(t._scene)&&Cesium.defined(t._scene.ev_Fog)&&t._scene.ev_Fog.enabled){if(g.indexOf("u_modelViewMatrix")>-1){g=`
 varying vec4 v_viewPosition; 
`+g;var v=`v_viewPosition = u_modelViewMatrix * vec4(a_position.xyz, 1.0); 
`;g.indexOf("gltf_a_dec_position")!=-1&&(v=`v_viewPosition = u_modelViewMatrix * vec4(gltf_a_dec_position.xyz, 1.0); 
`);var _=g.lastIndexOf("}");_&&(g=g.slice(0,_)+v+g.slice(_)),p=`
varying vec4 v_viewPosition; 
#if defined(FOG) && (defined(ENABLE_VERTEX_LIGHTING) || defined(ENABLE_DAYNIGHT_SHADING)) || defined(GROUND_ATMOSPHERE) 
uniform float u_minimumBrightness ;
#endif 
vec3 colorCorrect(vec3 rgb) {
#ifdef COLOR_CORRECT
    // Convert rgb color to hsb
    vec3 hsb = czm_RGBToHSB(rgb);
    // Perform hsb shift
    hsb.x += u_hsbShift.x; // hue
    hsb.y = clamp(hsb.y + u_hsbShift.y, 0.0, 1.0); // saturation
    hsb.z = hsb.z > czm_epsilon7 ? hsb.z + u_hsbShift.z : 0.0; // brightness
    // Convert shifted hsb back to rgb
    rgb = czm_HSBToRGB(hsb);
#endif
    return rgb;
} 
`+Cesium._shadersGroundAtmosphereOld+`
`+p,t._scene.fog.enabled&&(p=`#define FOG 

`+p)}else if(g.indexOf("u_modelViewProj")>-1&&g.indexOf("u_projectionMatrix")>-1){g=`
 varying vec4 v_viewPosition; 
`+g;var v=`v_viewPosition = u_projectionMatrix*u_modelViewProj * vec4(a_position.xyz, 1.0); 
`;g.indexOf("gltf_a_dec_position")!=-1&&(v=`v_viewPosition = u_projectionMatrix*u_modelViewProj * vec4(gltf_a_dec_position.xyz, 1.0); 
`);var _=g.lastIndexOf("}");_&&(g=g.slice(0,_)+v+g.slice(_)),p=`
varying vec4 v_viewPosition; 
#if defined(FOG) && (defined(ENABLE_VERTEX_LIGHTING) || defined(ENABLE_DAYNIGHT_SHADING)) || defined(GROUND_ATMOSPHERE) 
uniform float u_minimumBrightness ;
#endif 
vec3 colorCorrect(vec3 rgb) {
#ifdef COLOR_CORRECT
    // Convert rgb color to hsb
    vec3 hsb = czm_RGBToHSB(rgb);
    // Perform hsb shift
    hsb.x += u_hsbShift.x; // hue
    hsb.y = clamp(hsb.y + u_hsbShift.y, 0.0, 1.0); // saturation
    hsb.z = hsb.z > czm_epsilon7 ? hsb.z + u_hsbShift.z : 0.0; // brightness
    // Convert shifted hsb back to rgb
    rgb = czm_HSBToRGB(hsb);
#endif
    return rgb;
} 
`+Cesium._shadersGroundAtmosphereOld+`
`+p,t._scene.fog.enabled&&(p=`#define FOG 

`+p)}}let y=t._imageBasedLightingFactor.x>0||t._imageBasedLightingFactor.y>0;if(y&&(p=`#define USE_IBL_LIGHTING 

${p}`),Cesium.defined(t._lightColor)&&(p=`#define USE_CUSTOM_LIGHT_COLOR 

${p}`),(t._sourceVersion!=="2.0"||t._sourceKHRTechniquesWebGL)&&(p=Cesium.ShaderSource.replaceMain(p,"non_gamma_corrected_main"),p=`${p}
void main() { 
    non_gamma_corrected_main(); 
    gl_FragColor = czm_gammaCorrect(gl_FragColor); 
} 
`),Cesium.defined(t._scene)&&Cesium.defined(t._scene.ev_Fog)&&t._scene.ev_Fog.enabled){let x=`
#if defined(FOG)
  vec4 finalColor =  gl_FragColor; 
  float vDistance =  length(v_viewPosition.xyz); 
  vec4 worldPosition = czm_inverseView3D * v_viewPosition;  AtmosphereColor atmosFogColor = computeGroundAtmosphereFromSpace(vec3(worldPosition.x, worldPosition.y, worldPosition.z), false, vec3(0.0));
  vec3 fogColor = colorCorrect(atmosFogColor.mie) + finalColor.rgb * colorCorrect(atmosFogColor.rayleigh);
 #ifndef HDR
  const float fExposure = 4.0;
  fogColor = vec3(1.0) - exp(-fExposure * fogColor);
 #endif
 #ifdef FOG
   #if defined(ENABLE_VERTEX_LIGHTING) || defined(ENABLE_DAYNIGHT_SHADING)
      float darken = clamp(dot(normalize(czm_viewerPositionWC), normalize(czm_sunPositionWC)), u_minimumBrightness, 1.0);
      fogColor *= darken;
   #endif
   #ifdef HDR
       const float modifier = 0.15;
      finalColor = vec4(czm_fog(vDistance, finalColor.rgb, fogColor, modifier), finalColor.a);
    #else
      finalColor = vec4(czm_fog(vDistance, finalColor.rgb, fogColor), finalColor.a);
    #endif
 #endif
 gl_FragColor = finalColor;
#endif
`,E=p.lastIndexOf("}");E&&(p=p.slice(0,E)+x+p.slice(E))}if(Cesium.OctahedralProjectedCubeMap.isSupported(r)){let x=Cesium.defined(t._sphericalHarmonicCoefficients)||t._useDefaultSphericalHarmonics,E=Cesium.defined(t._specularEnvironmentMapAtlas)&&t._specularEnvironmentMapAtlas.ready||t._useDefaultSpecularMaps;!l&&(x||E||y)&&(p=`uniform mat4 gltf_clippingPlanesMatrix; 
${p}`),Cesium.defined(t._sphericalHarmonicCoefficients)?p=`#define DIFFUSE_IBL 
#define CUSTOM_SPHERICAL_HARMONICS 
uniform vec3 gltf_sphericalHarmonicCoefficients[9]; 
${p}`:t._useDefaultSphericalHarmonics&&(p=`#define DIFFUSE_IBL 
${p}`),Cesium.defined(t._specularEnvironmentMapAtlas)&&t._specularEnvironmentMapAtlas.ready?p=`#define SPECULAR_IBL 
#define CUSTOM_SPECULAR_IBL 
uniform sampler2D gltf_specularMap; 
uniform vec2 gltf_specularMapSize; 
uniform float gltf_maxSpecularLOD; 
${p}`:t._useDefaultSpecularMaps&&(p=`#define SPECULAR_IBL 
${p}`)}Cesium.defined(t._luminanceAtZenith)&&(p=`#define USE_SUN_LUMINANCE 
uniform float gltf_luminanceAtZenith;
${p}`),Ng(i,s,p,g,t,r,n)}function Xb(e,t,r,n,i){let s=e.programId,a=e.techniqueId,o=r._sourcePrograms[s],u=r._rendererResources.sourceShaders;if(i._model=r,Cesium.defined(o.name)&&Cesium.defined(r.instancedPrograms[o.name])){if(r.instancedPrograms[o.name].attributeLocations===r._rendererResources.programs[s]._attributeLocations)return;let _=r.instancedPrograms[o.name];r._rendererResources.programs[s]=Cesium.ShaderProgram.fromCache({context:n,vertexShaderSource:_.vertexShaderSource,fragmentShaderSource:_.fragmentShaderSource,attributeLocations:_.attributeLocations});return}let f=u[o.vertexShader],l=u[o.fragmentShader];l+="uniform vec4 u_rollerRegion;";let c=r._quantizedVertexShaders,h=r._toClipCoordinatesGLSL[s];if(r.extensionsUsed.WEB3D_quantized_attributes||r._dequantizeInShader){let _=c[s];Cesium.defined(_)||(_=Rg(f,s,r),c[s]=_),f=_}let d=Ag(f,s,a,i),m=Mg(l,s,i);if(r._tilesetFlat&&(d=r._tilesetFlat._updateVertexShader(d)),Cesium.FeatureDetection.isInternetExplorer()||(d=ee.modifyVertexShaderForLogDepth(d,h),r.rollerRegion.equals(Og)?m=ee.modifyFragmentShaderForLogDepth(m):m=ee.modifyFragmentShaderForLogDepthAddRoller(m)),Cesium.defined(r._uniformMapLoaded)||(m=`uniform vec4 czm_pickColor;
${m}`),Cesium.defined(r._scene)&&Cesium.defined(r._scene.ev_Fog)&&r._scene.ev_Fog.enabled){if(d.indexOf("u_modelViewMatrix")>-1){d=`
 varying vec4 v_viewPosition; 
`+d;var g=`v_viewPosition = u_modelViewMatrix * vec4(a_position.xyz, 1.0); 
`;d.indexOf("gltf_a_dec_position")!=-1&&(g=`v_viewPosition = u_modelViewMatrix * vec4(gltf_a_dec_position.xyz, 1.0); 
`);var p=d.lastIndexOf("}");p&&(d=d.slice(0,p)+g+d.slice(p)),m=`
varying vec4 v_viewPosition; 
#if defined(FOG) && (defined(ENABLE_VERTEX_LIGHTING) || defined(ENABLE_DAYNIGHT_SHADING)) || defined(GROUND_ATMOSPHERE) 
uniform float u_minimumBrightness ;
#endif 
vec3 colorCorrect(vec3 rgb) {
#ifdef COLOR_CORRECT
    // Convert rgb color to hsb
    vec3 hsb = czm_RGBToHSB(rgb);
    // Perform hsb shift
    hsb.x += u_hsbShift.x; // hue
    hsb.y = clamp(hsb.y + u_hsbShift.y, 0.0, 1.0); // saturation
    hsb.z = hsb.z > czm_epsilon7 ? hsb.z + u_hsbShift.z : 0.0; // brightness
    // Convert shifted hsb back to rgb
    rgb = czm_HSBToRGB(hsb);
#endif
    return rgb;
} 
`+Cesium._shadersGroundAtmosphereOld+`
`+m,r._scene.fog.enabled&&(m=`#define FOG 

`+m)}else if(d.indexOf("u_modelViewProj")>-1&&d.indexOf("u_projectionMatrix")>-1){d=`
 varying vec4 v_viewPosition; 
`+d;var g=`v_viewPosition = u_projectionMatrix*u_modelViewProj * vec4(a_position.xyz, 1.0); 
`;d.indexOf("gltf_a_dec_position")!=-1&&(g=`v_viewPosition = u_projectionMatrix*u_modelViewProj * vec4(gltf_a_dec_position.xyz, 1.0); 
`);var p=d.lastIndexOf("}");p&&(d=d.slice(0,p)+g+d.slice(p)),m=`
varying vec4 v_viewPosition; 
#if defined(FOG) && (defined(ENABLE_VERTEX_LIGHTING) || defined(ENABLE_DAYNIGHT_SHADING)) || defined(GROUND_ATMOSPHERE) 
uniform float u_minimumBrightness ;
#endif 
vec3 colorCorrect(vec3 rgb) {
#ifdef COLOR_CORRECT
    // Convert rgb color to hsb
    vec3 hsb = czm_RGBToHSB(rgb);
    // Perform hsb shift
    hsb.x += u_hsbShift.x; // hue
    hsb.y = clamp(hsb.y + u_hsbShift.y, 0.0, 1.0); // saturation
    hsb.z = hsb.z > czm_epsilon7 ? hsb.z + u_hsbShift.z : 0.0; // brightness
    // Convert shifted hsb back to rgb
    rgb = czm_HSBToRGB(hsb);
#endif
    return rgb;
} 
`+Cesium._shadersGroundAtmosphereOld+`
`+m,r._scene.fog.enabled&&(m=`#define FOG 

`+m)}}let v=r._imageBasedLightingFactor.x>0||r._imageBasedLightingFactor.y>0;if(v&&(m=`#define USE_IBL_LIGHTING 

${m}`),Cesium.defined(r._lightColor)&&(m=`#define USE_CUSTOM_LIGHT_COLOR 

${m}`),(r._sourceVersion!=="2.0"||r._sourceKHRTechniquesWebGL)&&(m=Cesium.ShaderSource.replaceMain(m,"non_gamma_corrected_main"),m=`${m}
void main() { 
    non_gamma_corrected_main(); 
    gl_FragColor = czm_gammaCorrect(gl_FragColor); 
} 
`),Cesium.defined(r._scene)&&Cesium.defined(r._scene.ev_Fog)&&r._scene.ev_Fog.enabled){let _=`
#if defined(FOG)
  vec4 finalColor =  gl_FragColor; 
  float vDistance =  length(v_viewPosition.xyz); 
  vec4 worldPosition = czm_inverseView3D * v_viewPosition;  AtmosphereColor atmosFogColor = computeGroundAtmosphereFromSpace(vec3(worldPosition.x, worldPosition.y, worldPosition.z), false, vec3(0.0));
  vec3 fogColor = colorCorrect(atmosFogColor.mie) + finalColor.rgb * colorCorrect(atmosFogColor.rayleigh);
 #ifndef HDR
  const float fExposure = 4.0;
  fogColor = vec3(1.0) - exp(-fExposure * fogColor);
 #endif
 #ifdef FOG
   #if defined(ENABLE_VERTEX_LIGHTING) || defined(ENABLE_DAYNIGHT_SHADING)
      float darken = clamp(dot(normalize(czm_viewerPositionWC), normalize(czm_sunPositionWC)), u_minimumBrightness, 1.0);
      fogColor *= darken;
   #endif
   #ifdef HDR
       const float modifier = 0.15;
      finalColor = vec4(czm_fog(vDistance, finalColor.rgb, fogColor, modifier), finalColor.a);
    #else
      finalColor = vec4(czm_fog(vDistance, finalColor.rgb, fogColor), finalColor.a);
    #endif
 #endif
 gl_FragColor = finalColor;
#endif
`,y=m.lastIndexOf("}");y&&(m=m.slice(0,y)+_+m.slice(y))}if(Cesium.OctahedralProjectedCubeMap.isSupported(n)){let _=Cesium.defined(r._sphericalHarmonicCoefficients)||r._useDefaultSphericalHarmonics,y=Cesium.defined(r._specularEnvironmentMapAtlas)&&r._specularEnvironmentMapAtlas.ready||r._useDefaultSpecularMaps;(_||y||v)&&(m=`uniform mat4 gltf_clippingPlanesMatrix; 
${m}`),Cesium.defined(r._sphericalHarmonicCoefficients)?m=`#define DIFFUSE_IBL 
#define CUSTOM_SPHERICAL_HARMONICS 
uniform vec3 gltf_sphericalHarmonicCoefficients[9]; 
${m}`:r._useDefaultSphericalHarmonics&&(m=`#define DIFFUSE_IBL 
${m}`),Cesium.defined(r._specularEnvironmentMapAtlas)&&r._specularEnvironmentMapAtlas.ready?m=`#define SPECULAR_IBL 
#define CUSTOM_SPECULAR_IBL 
uniform sampler2D gltf_specularMap; 
uniform vec2 gltf_specularMapSize; 
uniform float gltf_maxSpecularLOD; 
${m}`:r._useDefaultSpecularMaps&&(m=`#define SPECULAR_IBL 
${m}`)}Cesium.defined(r._luminanceAtZenith)&&(m=`#define USE_SUN_LUMINANCE 
uniform float gltf_luminanceAtZenith;
${m}`),Ng(s,a,m,d,r,n,i,t)}function Ng(e,t,r,n,i,s,a){let o=i._sourceTechniques[t],u=i._sourcePrograms[e],f=ee.createAttributeLocations(o,a._precreatedAttributes);i.isExternal=!0,i._rendererResources.programs[e]=Cesium.ShaderProgram.fromCache({context:s,vertexShaderSource:n,fragmentShaderSource:r,attributeLocations:f,isExternal:!0}),i.instancedPrograms[u.name]={vertexShaderSource:n,fragmentShaderSource:r,attributeLocations:f,isExternal:!0}}function jb(e,t,r,n){let i=e._rendererResources.buffers,s=e._rendererResources.vertexArrays,a=e.gltf,o=a.accessors,u=a.meshes[t];Cesium.ForEach.meshPrimitive(u,function(f,l){let c=[],h,d=Kb(e,f,n),m=e._decodedData[`${t}.primitive.${l}`];Cesium.ForEach.meshPrimitiveAttribute(f,function(y,x){if(h=d[x],Cesium.defined(h)){if(Cesium.defined(m)){let I=m.attributes;if(I.hasOwnProperty(x)){let P=I[x];c.push({index:h,vertexBuffer:i[P.bufferView],componentsPerAttribute:P.componentsPerAttribute,componentDatatype:P.componentDatatype,normalize:P.normalized,offsetInBytes:P.byteOffset,strideInBytes:P.byteStride});return}}let E=o[y],S=Cesium.defined(E.normalized)&&E.normalized;c.push({index:h,vertexBuffer:i[E.bufferView],componentsPerAttribute:Cesium.numberOfComponentsForType(E.type),componentDatatype:E.componentType,normalize:S,offsetInBytes:E.byteOffset,strideInBytes:Cesium.getAccessorByteStride(a,E)})}});let g,p,v=n._precreatedAttributes;if(Cesium.defined(v))for(p in v)v.hasOwnProperty(p)&&(h=d[p],Cesium.defined(h)&&(g=v[p],g.index=h,c.push(g)));let _;if(Cesium.defined(f.indices)){let x=o[f.indices].bufferView;Cesium.defined(m)&&(x=m.bufferView),_=i[x]}s[`${t}.primitive.${l}`]=new Cesium.VertexArray({context:r,attributes:c,indexBuffer:_})})}function Kb(e,t,r){let n=e._sourceTechniques,i={},s,a,o=e._runtime.materialsById[t.material];if(!Cesium.defined(o))return i;let u=n[o._technique];if(!Cesium.defined(u))return i;let f=u.attributes,l=e._rendererResources.programs[u.program],c=l.vertexAttributes,h=l._attributeLocations;for(s in c)if(c.hasOwnProperty(s)){let m=f[s];Cesium.defined(m)&&(a=h[s],i[m.semantic]=a)}let d=r._precreatedAttributes;if(Cesium.defined(d))for(s in d)d.hasOwnProperty(s)&&(a=h[s],i[s]=a);return i}function Qb(e,t,r,n){return e=Cesium.ShaderSource.replaceMain(e,"gltf_clip_main"),e+=`${Cesium.getClippingFunction(t,r)}
`,e+=`uniform sampler2D gltf_clippingPlanes; 
uniform mat4 gltf_clippingPlanesMatrix; 
uniform vec4 gltf_clippingPlanesEdgeStyle; 
void main() 
{ 
    gltf_clip_main(); 
${Cesium.getClipAndStyleCode("gltf_clippingPlanes","gltf_clippingPlanesMatrix","gltf_clippingPlanesEdgeStyle")}} 
`,e}function Zb(e){return!Cesium.Color.equals(e.color,Cesium.Color.WHITE)||e.colorBlendMode!==Cesium.ColorBlendMode.HIGHLIGHT}function Jb(e){let t=e._clippingPlanes;return Cesium.defined(t)&&t.enabled&&t.length!==0}function $b(e){return function(){return e.computedJointMatrices}}function e1(e){return function(){return e.weights}}function t1(e){return function(){return e.color}}function r1(e){return function(){return Cesium.ColorBlendMode.getColorBlend(e.colorBlendMode,e.colorBlendAmount)}}function n1(e){return function(){let t=e.clippingPlanes;return!Cesium.defined(t)||!t.enabled?e._defaultTexture:t.texture}}function i1(e){return function(){let t=e.clippingPlanes;if(!Cesium.defined(t))return Cesium.Color.WHITE.withAlpha(0);let r=Cesium.Color.clone(t.edgeColor);return r.alpha=t.edgeWidth,r}}var s1=new Cesium.Matrix4;function a1(e){return function(){let t=e.clippingPlanes;if(!Cesium.defined(t)&&!Cesium.defined(e._sphericalHarmonicCoefficients)&&!Cesium.defined(e._specularEnvironmentMaps))return Cesium.Matrix4.IDENTITY;let r=Cesium.defined(t)?t.modelMatrix:Cesium.Matrix4.IDENTITY;return Cesium.Matrix4.multiply(e._clippingPlaneModelViewMatrix,r,s1)}}function o1(e){return e=Cesium.ShaderSource.replaceMain(e,"gltf_blend_main"),e+=`uniform vec4 gltf_color; 
uniform float gltf_colorBlend; 
void main() 
{ 
    gltf_blend_main(); 
    gl_FragColor.rgb = mix(gl_FragColor.rgb, gltf_color.rgb, gltf_colorBlend); 
    float highlight = ceil(gltf_colorBlend); 
    gl_FragColor.rgb *= mix(gltf_color.rgb, vec3(1.0), highlight); 
    gl_FragColor.a *= gltf_color.a; 
} 
`,e}function u1(e){return function(){return e._imageBasedLightingFactor}}function f1(e){return function(){return e._lightColor}}function l1(e){return function(){return e.luminanceAtZenith}}function c1(e){return function(){return e._sphericalHarmonicCoefficients}}function h1(e){return function(){return e._specularEnvironmentMapAtlas.texture}}function d1(e){return function(){return e._specularEnvironmentMapAtlas.texture.dimensions}}function m1(e){return function(){return e._specularEnvironmentMapAtlas.maximumMipmapLevel}}function p1(e,t){let r=Fg(e,t),n=e._quantizedUniforms[r];return ee.createUniformsForQuantizedAttributes(e.gltf,t,n)}function Fg(e,t){let r=e._runtime.materialsById[t.material];if(Cesium.defined(r))return r._program}function g1(e){return ee.createUniformsForDracoQuantizedAttributes(e.attributes)}function Bg(e){return function(){return e}}var Oh=ta;function Ss(){this.initialized=!1,this.resourcesParsed=!1,this.vertexBuffersToCreate=new Cesium.Queue,this.indexBuffersToCreate=new Cesium.Queue,this.buffers={},this.pendingBufferLoads=0,this.programsToCreate=new Cesium.Queue,this.shaders={},this.pendingShaderLoads=0,this.texturesToCreate=new Cesium.Queue,this.pendingTextureLoads=0,this.texturesToCreateFromBufferView=new Cesium.Queue,this.pendingBufferViewToImage=0,this.createSamplers=!0,this.createSkins=!0,this.createRuntimeAnimations=!0,this.createVertexArrays=!0,this.createRenderStates=!0,this.createUniformMaps=!0,this.createRuntimeNodes=!0,this.createdBufferViews={},this.primitivesToDecode=new Cesium.Queue,this.activeDecodingTasks=0,this.pendingDecodingCache=!1,this.skinnedNodesIds=[]}function v1(e,t,r){return e.subarray(t,t+r)}Ss.prototype.getBuffer=function(e){return v1(this.buffers[e.buffer],e.byteOffset,e.byteLength)};Ss.prototype.finishedPendingBufferLoads=function(){return this.pendingBufferLoads===0};Ss.prototype.finishedBuffersCreation=function(){return this.pendingBufferLoads===0&&this.vertexBuffersToCreate.length===0&&this.indexBuffersToCreate.length===0};Ss.prototype.finishedProgramCreation=function(){return this.pendingShaderLoads===0&&this.programsToCreate.length===0};Ss.prototype.finishedTextureCreation=function(){let e=this.pendingTextureLoads===0,t=this.texturesToCreate.length===0&&this.texturesToCreateFromBufferView.length===0;return e&&t};Ss.prototype.finishedEverythingButTextureCreation=function(){let e=this.pendingBufferLoads===0&&this.pendingShaderLoads===0,t=this.vertexBuffersToCreate.length===0&&this.indexBuffersToCreate.length===0&&this.programsToCreate.length===0&&this.pendingBufferViewToImage===0;return this.finishedDecoding()&&e&&t};Ss.prototype.finishedDecoding=function(){return this.primitivesToDecode.length===0&&this.activeDecodingTasks===0&&!this.pendingDecodingCache};Ss.prototype.finished=function(){return this.finishedDecoding()&&this.finishedTextureCreation()&&this.finishedEverythingButTextureCreation()};var Nh=Ss;function _1(e,t){if(t=Cesium.defaultValue(t,Cesium.defaultValue.EMPTY_OBJECT),!Cesium.defined(e)||!Cesium.usesExtension(e,"KHR_materials_common"))return;Cesium.usesExtension(e,"KHR_techniques_webgl")||(Cesium.defined(e.extensions)||(e.extensions={}),e.extensions.KHR_techniques_webgl={programs:[],shaders:[],techniques:[]},e.extensionsUsed.push("KHR_techniques_webgl"),e.extensionsRequired.push("KHR_techniques_webgl"));let r=e.extensions.KHR_techniques_webgl;E1(e);let n=C1(e),i=ee.splitIncompatibleMaterials(e),s={},a=!1;return Cesium.ForEach.material(e,function(o,u){if(Cesium.defined(o.extensions)&&Cesium.defined(o.extensions.KHR_materials_common)){let f=o.extensions.KHR_materials_common,l=i[u],c=x1(f,l),h=s[c];Cesium.defined(h)||(h=y1(e,r,l,f,n,t.addBatchIdToGeneratedShaders),s[c]=h,a=!0);let d={},m=f.values,g;for(let p in m)m.hasOwnProperty(p)&&p!=="transparent"&&p!=="doubleSided"&&(g=`u_${p.toLowerCase()}`,d[g]=m[p]);o.extensions.KHR_techniques_webgl={technique:h,values:d},o.alphaMode="OPAQUE",f.transparent&&(o.alphaMode="BLEND"),f.doubleSided&&(o.doubleSided=!0)}}),a&&ee.ensureSemanticExistence(e),e}function C1(e){let t={},r;if(Cesium.defined(e.extensions)&&Cesium.defined(e.extensions.KHR_materials_common)&&(r=e.extensions.KHR_materials_common.lights),Cesium.defined(r)){let n=e.nodes;for(let s in n)if(n.hasOwnProperty(s)){let a=n[s];if(Cesium.defined(a.extensions)&&Cesium.defined(a.extensions.KHR_materials_common)){let o=a.extensions.KHR_materials_common.light;Cesium.defined(o)&&Cesium.defined(r[o])&&(r[o].node=s),delete a.extensions.KHR_materials_common}}let i=0;for(let s in r)if(r.hasOwnProperty(s)){let a=r[s],o=a.type;if(o!=="ambient"&&!Cesium.defined(a.node)){delete r[s];continue}let u=`light${i.toString()}`;a.baseName=u;let f,l,c,h;switch(o){case"ambient":f=a.ambient,t[`${u}Color`]={type:Cesium.WebGLConstants.FLOAT_VEC3,value:f.color};break;case"directional":l=a.directional,t[`${u}Color`]={type:Cesium.WebGLConstants.FLOAT_VEC3,value:l.color},Cesium.defined(a.node)&&(t[`${u}Transform`]={node:a.node,semantic:"MODELVIEW",type:Cesium.WebGLConstants.FLOAT_MAT4});break;case"point":c=a.point,t[`${u}Color`]={type:Cesium.WebGLConstants.FLOAT_VEC3,value:c.color},Cesium.defined(a.node)&&(t[`${u}Transform`]={node:a.node,semantic:"MODELVIEW",type:Cesium.WebGLConstants.FLOAT_MAT4}),t[`${u}Attenuation`]={type:Cesium.WebGLConstants.FLOAT_VEC3,value:[c.constantAttenuation,c.linearAttenuation,c.quadraticAttenuation]};break;case"spot":h=a.spot,t[`${u}Color`]={type:Cesium.WebGLConstants.FLOAT_VEC3,value:h.color},Cesium.defined(a.node)&&(t[`${u}Transform`]={node:a.node,semantic:"MODELVIEW",type:Cesium.WebGLConstants.FLOAT_MAT4},t[`${u}InverseTransform`]={node:a.node,semantic:"MODELVIEWINVERSE",type:Cesium.WebGLConstants.FLOAT_MAT4,useInFragment:!0}),t[`${u}Attenuation`]={type:Cesium.WebGLConstants.FLOAT_VEC3,value:[h.constantAttenuation,h.linearAttenuation,h.quadraticAttenuation]},t[`${u}FallOff`]={type:Cesium.WebGLConstants.FLOAT_VEC2,value:[h.fallOffAngle,h.fallOffExponent]};break}++i}}return t}function y1(e,t,r,n,i,s){Cesium.defined(n)||(n={}),s=Cesium.defaultValue(s,!1);let a=t.techniques,o=t.shaders,u=t.programs,f=n.technique.toUpperCase(),l;Cesium.defined(e.extensions)&&Cesium.defined(e.extensions.KHR_materials_common)&&(l=e.extensions.KHR_materials_common.lights);let c=n.values,h=Cesium.defaultValue(n.jointCount,0),d,m=!1,g=!1;Cesium.defined(r)&&(d=r.skinning,m=d.skinned,g=r.hasVertexColors);let p=`precision highp float;
`,v=`precision highp float;
`,_=f!=="CONSTANT",y={u_modelViewMatrix:{semantic:Cesium.usesExtension(e,"CESIUM_RTC")?"CESIUM_RTC_MODELVIEW":"MODELVIEW",type:Cesium.WebGLConstants.FLOAT_MAT4},u_projectionMatrix:{semantic:"PROJECTION",type:Cesium.WebGLConstants.FLOAT_MAT4}};_&&(y.u_normalMatrix={semantic:"MODELVIEWINVERSETRANSPOSE",type:Cesium.WebGLConstants.FLOAT_MAT3}),m&&(y.u_jointMatrix={count:h,semantic:"JOINTMATRIX",type:Cesium.WebGLConstants.FLOAT_MAT4});let x,E=!1;for(let O in c)if(c.hasOwnProperty(O)&&O!=="transparent"&&O!=="doubleSided"){let U=Vg(O,c[O]);x=`u_${O.toLowerCase()}`,!E&&U===Cesium.WebGLConstants.SAMPLER_2D&&(E=!0),y[x]={type:U}}if(Cesium.defined(y.u_diffuse)&&(y.u_diffuse.semantic="_3DTILESDIFFUSE"),Cesium.defined(i))for(let O in i)i.hasOwnProperty(O)&&(x=`u_${O}`,y[x]=i[O]);for(x in y)if(y.hasOwnProperty(x)){let O=y[x],U=Cesium.defined(O.count)?`[${O.count}]`:"";O.type!==Cesium.WebGLConstants.FLOAT_MAT3&&O.type!==Cesium.WebGLConstants.FLOAT_MAT4||O.useInFragment?(v+=`uniform ${Cesium.webGLConstantToGlslType(O.type)} ${x}${U};
`,delete O.useInFragment):p+=`uniform ${Cesium.webGLConstantToGlslType(O.type)} ${x}${U};
`}let S="";m&&(S+=`    mat4 skinMatrix =
        a_weight.x * u_jointMatrix[int(a_joint.x)] +
        a_weight.y * u_jointMatrix[int(a_joint.y)] +
        a_weight.z * u_jointMatrix[int(a_joint.z)] +
        a_weight.w * u_jointMatrix[int(a_joint.w)];
`);let I={a_position:{semantic:"POSITION"}};p+=`attribute vec3 a_position;
`,p+=`varying vec3 v_positionEC;
`,m?S+=`  vec4 pos = u_modelViewMatrix * skinMatrix * vec4(a_position,1.0);
`:S+=`  vec4 pos = u_modelViewMatrix * vec4(a_position,1.0);
`,S+=`  v_positionEC = pos.xyz;
`,S+=`  gl_Position = u_projectionMatrix * pos;
`,v+=`varying vec3 v_positionEC;
`,_&&(I.a_normal={semantic:"NORMAL"},p+=`attribute vec3 a_normal;
`,p+=`varying vec3 v_normal;
`,m?S+=`  v_normal = u_normalMatrix * mat3(skinMatrix) * a_normal;
`:S+=`  v_normal = u_normalMatrix * a_normal;
`,v+=`varying vec3 v_normal;
`);let P;E&&(I.a_texcoord_0={semantic:"TEXCOORD_0"},P="v_texcoord_0",p+=`attribute vec2 a_texcoord_0;
`,p+=`varying vec2 ${P};
`,S+=`  ${P} = a_texcoord_0;
`,v+=`varying vec2 ${P};
`),m&&(I.a_joint={semantic:"JOINTS_0"},I.a_weight={semantic:"WEIGHTS_0"},p+=`attribute vec4 a_joint;
`,p+=`attribute vec4 a_weight;
`),g&&(I.a_vertexColor={semantic:"COLOR_0"},p+=`attribute vec4 a_vertexColor;
`,p+=`varying vec4 v_vertexColor;
`,S+=`  v_vertexColor = a_vertexColor;
`,v+=`varying vec4 v_vertexColor;
`),s&&(I.a_batchId={semantic:"_BATCHID"},p+=`attribute float a_batchId;
`);let w=_&&(f==="BLINN"||f==="PHONG")&&Cesium.defined(y.u_specular)&&Cesium.defined(y.u_shininess)&&y.u_shininess>0,N=!1,B=!1,C="";for(let O in l)if(l.hasOwnProperty(O)){let U=l[O],q=U.type.toLowerCase(),Y=U.baseName;C+=`  {
`;let W=`u_${Y}Color`;if(q==="ambient")B=!0,C+=`    ambientLight += ${W};
`;else if(_){N=!0;let K=`v_${Y}Direction`,re=`v_${Y}Position`;q!=="point"&&(p+=`varying vec3 ${K};
`,v+=`varying vec3 ${K};
`,S+=`  ${K} = mat3(u_${Y}Transform) * vec3(0.,0.,1.);
`,q==="directional"&&(C+=`    vec3 l = normalize(${K});
`)),q!=="directional"?(p+=`varying vec3 ${re};
`,v+=`varying vec3 ${re};
`,S+=`  ${re} = u_${Y}Transform[3].xyz;
`,C+=`    vec3 VP = ${re} - v_positionEC;
`,C+=`    vec3 l = normalize(VP);
`,C+=`    float range = length(VP);
`,C+=`    float attenuation = 1.0 / (u_${Y}Attenuation.x + `,C+=`(u_${Y}Attenuation.y * range) + `,C+=`(u_${Y}Attenuation.z * range * range));
`):C+=`    float attenuation = 1.0;
`,q==="spot"&&(C+=`    float spotDot = dot(l, normalize(${K}));
`,C+=`    if (spotDot < cos(u_${Y}FallOff.x * 0.5))
`,C+=`    {
`,C+=`      attenuation = 0.0;
`,C+=`    }
`,C+=`    else
`,C+=`    {
`,C+=`        attenuation *= max(0.0, pow(spotDot, u_${Y}FallOff.y));
`,C+=`    }
`),C+=`    diffuseLight += ${W}* max(dot(normal,l), 0.) * attenuation;
`,w&&(f==="BLINN"?(C+=`    vec3 h = normalize(l + viewDir);
`,C+=`    float specularIntensity = max(0., pow(max(dot(normal, h), 0.), u_shininess)) * attenuation;
`):(C+=`    vec3 reflectDir = reflect(-l, normal);
`,C+=`    float specularIntensity = max(0., pow(max(dot(reflectDir, viewDir), 0.), u_shininess)) * attenuation;
`),C+=`    specularLight += ${W} * specularIntensity;
`)}C+=`  }
`}B||(C+=`  ambientLight += vec3(0.2, 0.2, 0.2);
`),!N&&f!=="CONSTANT"&&(v+=`#ifdef USE_CUSTOM_LIGHT_COLOR 
`,v+=`uniform vec3 gltf_lightColor; 
`,v+=`#endif 
`,C+=`#ifndef USE_CUSTOM_LIGHT_COLOR 
`,C+=`    vec3 lightColor = czm_lightColor;
`,C+=`#else 
`,C+=`    vec3 lightColor = gltf_lightColor;
`,C+=`#endif 
`,C+=`  vec3 l = normalize(czm_lightDirectionEC);
`,C+=`  diffuseLight += lightColor * max(dot(normal,l), 0.2);
`,w&&(f==="BLINN"?(C+=`  vec3 h = normalize(l + viewDir);
`,C+=`  float specularIntensity = max(0., pow(max(dot(normal, h), 0.), u_shininess));
`):(C+=`  vec3 reflectDir = reflect(-l, normal);
`,C+=`  float specularIntensity = max(0., pow(max(dot(reflectDir, viewDir), 0.), u_shininess));
`),C+=`  specularLight += lightColor * specularIntensity;
`)),p+=`void main(void) {
`,p+=S,p+=`}
`,v+=`void main(void) {
`;let b=`  vec3 color = vec3(0.0, 0.0, 0.0);
`;_&&(v+=`  vec3 normal = normalize(v_normal);
`,n.doubleSided&&(v+=`  if (czm_backFacing())
`,v+=`  {
`,v+=`    normal = -normal;
`,v+=`  }
`));let T;f!=="CONSTANT"?(Cesium.defined(y.u_diffuse)&&(y.u_diffuse.type===Cesium.WebGLConstants.SAMPLER_2D?v+=`  vec4 diffuse = texture2D(u_diffuse, ${P});
`:v+=`  vec4 diffuse = u_diffuse;
`,v+=`  vec3 diffuseLight = vec3(0.0, 0.0, 0.0);
`,b+=`  color += diffuse.rgb * diffuseLight;
`),w&&(y.u_specular.type===Cesium.WebGLConstants.SAMPLER_2D?v+=`  vec3 specular = texture2D(u_specular, ${P}).rgb;
`:v+=`  vec3 specular = u_specular.rgb;
`,v+=`  vec3 specularLight = vec3(0.0, 0.0, 0.0);
`,b+=`  color += specular * specularLight;
`),Cesium.defined(y.u_transparency)?T=`  gl_FragColor = vec4(color * diffuse.a * u_transparency, diffuse.a * u_transparency);
`:T=`  gl_FragColor = vec4(color * diffuse.a, diffuse.a);
`):Cesium.defined(y.u_transparency)?T=`  gl_FragColor = vec4(color * u_transparency, u_transparency);
`:T=`  gl_FragColor = vec4(color, 1.0);
`,g&&(b+=`  color *= v_vertexColor.rgb;
`),Cesium.defined(y.u_emission)&&(y.u_emission.type===Cesium.WebGLConstants.SAMPLER_2D?v+=`  vec3 emission = texture2D(u_emission, ${P}).rgb;
`:v+=`  vec3 emission = u_emission.rgb;
`,b+=`  color += emission;
`),(Cesium.defined(y.u_ambient)||f!=="CONSTANT")&&(Cesium.defined(y.u_ambient)?y.u_ambient.type===Cesium.WebGLConstants.SAMPLER_2D?v+=`  vec3 ambient = texture2D(u_ambient, ${P}).rgb;
`:v+=`  vec3 ambient = u_ambient.rgb;
`:v+=`  vec3 ambient = diffuse.rgb;
`,b+=`  color += ambient * ambientLight;
`),v+=`  vec3 viewDir = -normalize(v_positionEC);
`,v+=`  vec3 ambientLight = vec3(0.0, 0.0, 0.0);
`,v+=C,v+=b,v+=T,v+=`}
`;let A=Cesium.addToArray(o,{type:Cesium.WebGLConstants.VERTEX_SHADER,extras:{_pipeline:{source:p,extension:".glsl"}}}),R=Cesium.addToArray(o,{type:Cesium.WebGLConstants.FRAGMENT_SHADER,extras:{_pipeline:{source:v,extension:".glsl"}}}),F=Cesium.addToArray(u,{fragmentShader:R,vertexShader:A});return Cesium.addToArray(a,{attributes:I,program:F,uniforms:y})}function Vg(e,t){let r;switch(Cesium.defined(t.value)?r=t.value:Cesium.defined(t.index)?r=[t.index]:r=t,e){case"ambient":return r.length===1?Cesium.WebGLConstants.SAMPLER_2D:Cesium.WebGLConstants.FLOAT_VEC4;case"diffuse":return r.length===1?Cesium.WebGLConstants.SAMPLER_2D:Cesium.WebGLConstants.FLOAT_VEC4;case"emission":return r.length===1?Cesium.WebGLConstants.SAMPLER_2D:Cesium.WebGLConstants.FLOAT_VEC4;case"specular":return r.length===1?Cesium.WebGLConstants.SAMPLER_2D:Cesium.WebGLConstants.FLOAT_VEC4;case"shininess":return Cesium.WebGLConstants.FLOAT;case"transparency":return Cesium.WebGLConstants.FLOAT;case"transparent":return Cesium.WebGLConstants.BOOL;case"doubleSided":return Cesium.WebGLConstants.BOOL}}function x1(e,t){let r="";r+=`technique:${e.technique};`;let n=e.values,i=Object.keys(n).sort(),s=i.length;for(let o=0;o<s;++o){let u=i[o];n.hasOwnProperty(u)&&(r+=`${u}:${Vg(u,n[u])}`,r+=";")}let a=Cesium.defaultValue(e.jointCount,0);if(r+=`${a.toString()};`,Cesium.defined(t)){let o=t.skinning;a>0&&(r+=`${o.type};`),r+=t.hasVertexColors}return r}function E1(e){let t=e.extensions.KHR_materials_common;if(!Cesium.defined(t)||!Cesium.defined(t.lights))return;let r=t.lights,n=r.length;for(let i=0;i<n;i++){let s=r[i];if(s.type==="ambient"){Cesium.defined(s.ambient)||(s.ambient={});let a=s.ambient;Cesium.defined(a.color)||(a.color=[1,1,1])}else if(s.type==="directional"){Cesium.defined(s.directional)||(s.directional={});let a=s.directional;Cesium.defined(a.color)||(a.color=[1,1,1])}else if(s.type==="point"){Cesium.defined(s.point)||(s.point={});let a=s.point;Cesium.defined(a.color)||(a.color=[1,1,1]),a.constantAttenuation=Cesium.defaultValue(a.constantAttenuation,1),a.linearAttenuation=Cesium.defaultValue(a.linearAttenuation,0),a.quadraticAttenuation=Cesium.defaultValue(a.quadraticAttenuation,0)}else if(s.type==="spot"){Cesium.defined(s.spot)||(s.spot={});let a=s.spot;Cesium.defined(a.color)||(a.color=[1,1,1]),a.constantAttenuation=Cesium.defaultValue(a.constantAttenuation,1),a.fallOffAngle=Cesium.defaultValue(a.fallOffAngle,3.14159265),a.fallOffExponent=Cesium.defaultValue(a.fallOffExponent,0),a.linearAttenuation=Cesium.defaultValue(a.linearAttenuation,0),a.quadraticAttenuation=Cesium.defaultValue(a.quadraticAttenuation,0)}}}var Fh=_1;function b1(e,t){if(t=Cesium.defaultValue(t,Cesium.defaultValue.EMPTY_OBJECT),Cesium.usesExtension(e,"KHR_techniques_webgl")||!Cesium.defined(e.materials)||e.materials.length===0)return e;Cesium.defined(e.extensions)||(e.extensions={}),Cesium.defined(e.extensionsUsed)||(e.extensionsUsed=[]),Cesium.defined(e.extensionsRequired)||(e.extensionsRequired=[]),e.extensions.KHR_techniques_webgl={programs:[],shaders:[],techniques:[]},e.extensionsUsed.push("KHR_techniques_webgl"),e.extensionsRequired.push("KHR_techniques_webgl");let r=ee.splitIncompatibleMaterials(e);return Cesium.ForEach.material(e,function(n,i){let s={},a=L1(e,n,i,s,r,t);Cesium.defined(n.extensions)||(n.extensions={}),n.extensions.KHR_techniques_webgl={values:s,technique:a}}),ee.ensureSemanticExistence(e),e}function w1(e){return Cesium.defined(e.extensions)&&Cesium.defined(e.extensions.KHR_materials_pbrSpecularGlossiness)}function Ua(e,t,r,n,i){let s,a=r[t];return Cesium.defined(a)&&Cesium.defined(a.texCoord)&&a.texCoord===1&&(n=n.replace("0","1")),Cesium.defined(r[`${t}Offset`])?(s=`${t}Coord`,i.fragmentShaderMain+=`    vec2 ${s} = computeTexCoord(${n}, ${t}Offset, ${t}Rotation, ${t}Scale);
`):s=n,s}var S1=[0,0],T1=[0],I1=[1,1];function Bh(e,t,r){if(e.indexOf("Texture")===-1||!Cesium.defined(t.extensions)||!Cesium.defined(t.extensions.KHR_texture_transform))return;let n=`u_${e}`,i=t.extensions.KHR_texture_transform;r[`${n}Offset`]=Cesium.defaultValue(i.offset,S1),r[`${n}Rotation`]=Cesium.defaultValue(i.rotation,T1),r[`${n}Scale`]=Cesium.defaultValue(i.scale,I1),Cesium.defined(t.texCoord)&&Cesium.defined(i.texCoord)&&(r[n].texCoord=i.texCoord)}function L1(e,t,r,n,i,s){let a=Cesium.defaultValue(s.addBatchIdToGeneratedShaders,!1),o=e.extensions.KHR_techniques_webgl,u=o.techniques,f=o.shaders,l=o.programs,c=w1(t),h,d,m;if(!c){let se=t.pbrMetallicRoughness;if(Cesium.defined(se))for(d in se)se.hasOwnProperty(d)&&(m=se[d],h=`u_${d}`,n[h]=m,Bh(d,m,n));else n.u_baseColorFactor=[1,1,1,1]}if(c){let se=t.extensions.KHR_materials_pbrSpecularGlossiness;for(d in se)se.hasOwnProperty(d)&&(m=se[d],h=`u_${d}`,n[h]=m,Bh(d,m,n))}for(let se in t)t.hasOwnProperty(se)&&(se.indexOf("Texture")>=0||se.indexOf("Factor")>=0)&&(m=t[se],h=`u_${se}`,n[h]=m,Bh(se,m,n));let g=`precision highp float;
`,p=`precision highp float;
`,v;Cesium.defined(e.skins)&&(v=e.skins[0]);let _=Cesium.defined(v)?v.joints:[],y=_.length,x=i[r],E,S=!1,I=!1,P=!1,w=!1,N=!1,B=!1,C=!1,b=!1,T=!1;Cesium.defined(x)&&(E=x.skinning,S=E.skinned&&_.length>0,I=x.hasVertexColors,P=x.hasMorphTargets,w=x.hasNormals,N=x.hasTangents,B=x.hasTexCoords,C=x.hasTexCoord1,b=x.hasOutline);let A;P&&Cesium.ForEach.mesh(e,function(se){Cesium.ForEach.meshPrimitive(se,function(be){if(be.material===r){let lr=be.targets;Cesium.defined(lr)&&(A=lr)}})});let R={u_modelViewMatrix:{semantic:Cesium.usesExtension(e,"CESIUM_RTC")?"CESIUM_RTC_MODELVIEW":"MODELVIEW",type:Cesium.WebGLConstants.FLOAT_MAT4},u_projectionMatrix:{semantic:"PROJECTION",type:Cesium.WebGLConstants.FLOAT_MAT4}};Cesium.defined(t.extensions)&&Cesium.defined(t.extensions.KHR_materials_unlit)&&(T=!0),w&&(R.u_normalMatrix={semantic:"MODELVIEWINVERSETRANSPOSE",type:Cesium.WebGLConstants.FLOAT_MAT3}),S&&(R.u_jointMatrix={count:y,semantic:"JOINTMATRIX",type:Cesium.WebGLConstants.FLOAT_MAT4}),P&&(R.u_morphWeights={count:A.length,semantic:"MORPHWEIGHTS",type:Cesium.WebGLConstants.FLOAT});let F=t.alphaMode;Cesium.defined(F)&&F==="MASK"&&(R.u_alphaCutoff={semantic:"ALPHACUTOFF",type:Cesium.WebGLConstants.FLOAT});for(h in n)n.hasOwnProperty(h)&&(R[h]={type:P1(h)});let D=Cesium.defaultValue(R.u_baseColorTexture,R.u_baseColorFactor);Cesium.defined(D)&&(D.semantic="_3DTILESDIFFUSE");for(h in R)if(R.hasOwnProperty(h)){let se=R[h],be=Cesium.defined(se.count)?`[${se.count}]`:"";se.type!==Cesium.WebGLConstants.FLOAT_MAT3&&se.type!==Cesium.WebGLConstants.FLOAT_MAT4&&h!=="u_morphWeights"||se.useInFragment?(p+=`uniform ${Cesium.webGLConstantToGlslType(se.type)} ${h}${be};
`,delete se.useInFragment):g+=`uniform ${Cesium.webGLConstantToGlslType(se.type)} ${h}${be};
`}b&&(p+=`uniform sampler2D u_outlineTexture;
`);let O="";S&&(O+=`    mat4 skinMatrix =
        a_weight.x * u_jointMatrix[int(a_joint.x)] +
        a_weight.y * u_jointMatrix[int(a_joint.y)] +
        a_weight.z * u_jointMatrix[int(a_joint.z)] +
        a_weight.w * u_jointMatrix[int(a_joint.w)];
`);let U={a_position:{semantic:"POSITION"}};if(b&&(U.a_outlineCoordinates={semantic:"_OUTLINE_COORDINATES"}),g+=`attribute vec3 a_position;
`,w&&(g+=`varying vec3 v_positionEC;
`),b&&(g+=`attribute vec3 a_outlineCoordinates;
`,g+=`varying vec3 v_outlineCoordinates;
`),O+=`    vec3 weightedPosition = a_position;
`,w&&(O+=`    vec3 weightedNormal = a_normal;
`),N&&(O+=`    vec4 weightedTangent = a_tangent;
`),P)for(let se=0;se<A.length;se++){let be=A[se];for(let lr in be)if(be.hasOwnProperty(lr)&&lr!=="extras"){let kt=`a_${lr}_${se}`;U[kt]={semantic:`${lr}_${se}`},g+=`attribute vec3 ${kt};
`,lr==="POSITION"?O+=`    weightedPosition += u_morphWeights[${se}] * ${kt};
`:lr==="NORMAL"?O+=`    weightedNormal += u_morphWeights[${se}] * ${kt};
`:N&&lr==="TANGENT"&&(O+=`    weightedTangent.xyz += u_morphWeights[${se}] * ${kt};
`)}}S?O+=`    vec4 position = skinMatrix * vec4(weightedPosition, 1.0);
`:O+=`    vec4 position = vec4(weightedPosition, 1.0);
`,O+=`    position = u_modelViewMatrix * position;
`,w&&(O+=`    v_positionEC = position.xyz;
`),O+=`    gl_Position = u_projectionMatrix * position;
`,b&&(O+=`    v_outlineCoordinates = a_outlineCoordinates;
`),w&&(U.a_normal={semantic:"NORMAL"},g+=`attribute vec3 a_normal;
`,T||(g+=`varying vec3 v_normal;
`,S?O+=`    v_normal = u_normalMatrix * mat3(skinMatrix) * weightedNormal;
`:O+=`    v_normal = u_normalMatrix * weightedNormal;
`,p+=`varying vec3 v_normal;
`),p+=`varying vec3 v_positionEC;
`),N&&(U.a_tangent={semantic:"TANGENT"},g+=`attribute vec4 a_tangent;
`,g+=`varying vec4 v_tangent;
`,O+=`    v_tangent.xyz = u_normalMatrix * weightedTangent.xyz;
`,O+=`    v_tangent.w = weightedTangent.w;
`,p+=`varying vec4 v_tangent;
`),b&&(p+=`varying vec3 v_outlineCoordinates;
`);let q="",Y,W,K,re,ce,Se,de,Ae;if(B){if(U.a_texcoord_0={semantic:"TEXCOORD_0"},Y="v_texcoord_0",g+=`attribute vec2 a_texcoord_0;
`,g+=`varying vec2 ${Y};
`,O+=`    ${Y} = a_texcoord_0;
`,p+=`varying vec2 ${Y};
`,C){U.a_texcoord_1={semantic:"TEXCOORD_1"};let be=Y.replace("0","1");g+=`attribute vec2 a_texcoord_1;
`,g+=`varying vec2 ${be};
`,O+=`    ${be} = a_texcoord_1;
`,p+=`varying vec2 ${be};
`}let se={fragmentShaderMain:q};W=Ua(e,"u_normalTexture",n,Y,se),K=Ua(e,"u_baseColorTexture",n,Y,se),re=Ua(e,"u_specularGlossinessTexture",n,Y,se),ce=Ua(e,"u_diffuseTexture",n,Y,se),Se=Ua(e,"u_metallicRoughnessTexture",n,Y,se),de=Ua(e,"u_occlusionTexture",n,Y,se),Ae=Ua(e,"u_emissiveTexture",n,Y,se),q=se.fragmentShaderMain}S&&(U.a_joint={semantic:"JOINTS_0"},U.a_weight={semantic:"WEIGHTS_0"},g+=`attribute vec4 a_joint;
`,g+=`attribute vec4 a_weight;
`),I&&(U.a_vertexColor={semantic:"COLOR_0"},g+=`attribute vec4 a_vertexColor;
`,g+=`varying vec4 v_vertexColor;
`,O+=`  v_vertexColor = a_vertexColor;
`,p+=`varying vec4 v_vertexColor;
`),a&&(U.a_batchId={semantic:"_BATCHID"},g+=`attribute float a_batchId;
`),g+=`void main(void) 
{
`,g+=O,g+=`}
`,w&&!T&&(p+=`const float M_PI = 3.141592653589793;
`,p+=`vec3 lambertianDiffuse(vec3 diffuseColor) 
{
    return diffuseColor / M_PI;
}

`,p+=`vec3 fresnelSchlick2(vec3 f0, vec3 f90, float VdotH) 
{
    return f0 + (f90 - f0) * pow(clamp(1.0 - VdotH, 0.0, 1.0), 5.0);
}

`,p+=`vec3 fresnelSchlick(float metalness, float VdotH) 
{
    return metalness + (vec3(1.0) - metalness) * pow(1.0 - VdotH, 5.0);
}

`,p+=`float smithVisibilityG1(float NdotV, float roughness) 
{
    float k = (roughness + 1.0) * (roughness + 1.0) / 8.0;
    return NdotV / (NdotV * (1.0 - k) + k);
}

`,p+=`float smithVisibilityGGX(float roughness, float NdotL, float NdotV) 
{
    return smithVisibilityG1(NdotL, roughness) * smithVisibilityG1(NdotV, roughness);
}

`,p+=`float GGX(float roughness, float NdotH) 
{
    float roughnessSquared = roughness * roughness;
    float f = (NdotH * roughnessSquared - NdotH) * NdotH + 1.0;
    return roughnessSquared / (M_PI * f * f);
}

`),p+=`vec3 SRGBtoLINEAR3(vec3 srgbIn) 
{
    return pow(srgbIn, vec3(2.2));
}

`,p+=`vec4 SRGBtoLINEAR4(vec4 srgbIn) 
{
    vec3 linearOut = pow(srgbIn.rgb, vec3(2.2));
    return vec4(linearOut, srgbIn.a);
}

`,p+=`vec3 applyTonemapping(vec3 linearIn) 
{
#ifndef HDR 
    return czm_acesTonemapping(linearIn);
#else 
    return linearIn;
#endif 
}

`,p+=`vec3 LINEARtoSRGB(vec3 linearIn) 
{
#ifndef HDR 
    return pow(linearIn, vec3(1.0/2.2));
#else 
    return linearIn;
#endif 
}

`,p+=`vec2 computeTexCoord(vec2 texCoords, vec2 offset, float rotation, vec2 scale) 
{
    rotation = -rotation; 
    mat3 transform = mat3(
        cos(rotation) * scale.x, sin(rotation) * scale.x, 0.0, 
       -sin(rotation) * scale.y, cos(rotation) * scale.y, 0.0, 
        offset.x, offset.y, 1.0); 
    vec2 transformedTexCoords = (transform * vec3(fract(texCoords), 1.0)).xy; 
    return transformedTexCoords; 
}

`,p+=`#ifdef USE_IBL_LIGHTING 
`,p+=`uniform vec2 gltf_iblFactor; 
`,p+=`#endif 
`,p+=`#ifdef USE_CUSTOM_LIGHT_COLOR 
`,p+=`uniform vec3 gltf_lightColor; 
`,p+=`#endif 
`,p+=`void main(void) 
{
`,p+=q,w&&!T&&(p+=`    vec3 ng = normalize(v_normal);
`,p+=`    vec3 positionWC = vec3(czm_inverseView * vec4(v_positionEC, 1.0));
`,Cesium.defined(n.u_normalTexture)?N?(p+=`    vec3 t = normalize(v_tangent.xyz);
`,p+=`    vec3 b = normalize(cross(ng, t) * v_tangent.w);
`,p+=`    mat3 tbn = mat3(t, b, ng);
`,p+=`    vec3 n = texture2D(u_normalTexture, ${W}).rgb;
`,p+=`    n = normalize(tbn * (2.0 * n - 1.0));
`):(p=`#ifdef GL_OES_standard_derivatives
#extension GL_OES_standard_derivatives : enable
#endif
${p}`,p+=`#ifdef GL_OES_standard_derivatives
`,p+=`    vec3 pos_dx = dFdx(v_positionEC);
`,p+=`    vec3 pos_dy = dFdy(v_positionEC);
`,p+=`    vec3 tex_dx = dFdx(vec3(${W},0.0));
`,p+=`    vec3 tex_dy = dFdy(vec3(${W},0.0));
`,p+=`    vec3 t = (tex_dy.t * pos_dx - tex_dx.t * pos_dy) / (tex_dx.s * tex_dy.t - tex_dy.s * tex_dx.t);
`,p+=`    t = normalize(t - ng * dot(ng, t));
`,p+=`    vec3 b = normalize(cross(ng, t));
`,p+=`    mat3 tbn = mat3(t, b, ng);
`,p+=`    vec3 n = texture2D(u_normalTexture, ${W}).rgb;
`,p+=`    n = normalize(tbn * (2.0 * n - 1.0));
`,p+=`#else
`,p+=`    vec3 n = ng;
`,p+=`#endif
`):p+=`    vec3 n = ng;
`),Cesium.defined(n.u_baseColorTexture)?(p+=`    vec4 baseColorWithAlpha = SRGBtoLINEAR4(texture2D(u_baseColorTexture, ${K}));
`,Cesium.defined(n.u_baseColorFactor)&&(p+=`    baseColorWithAlpha *= u_baseColorFactor;
`)):Cesium.defined(n.u_baseColorFactor)?p+=`    vec4 baseColorWithAlpha = u_baseColorFactor;
`:p+=`    vec4 baseColorWithAlpha = vec4(1.0);
`,I&&(p+=`    baseColorWithAlpha *= v_vertexColor;
`),p+=`    vec3 baseColor = baseColorWithAlpha.rgb;
`,w&&!T?(c?(Cesium.defined(n.u_specularGlossinessTexture)?(p+=`    vec4 specularGlossiness = SRGBtoLINEAR4(texture2D(u_specularGlossinessTexture, ${re}));
`,p+=`    vec3 specular = specularGlossiness.rgb;
`,p+=`    float glossiness = specularGlossiness.a;
`,Cesium.defined(n.u_specularFactor)&&(p+=`    specular *= u_specularFactor;
`),Cesium.defined(n.u_glossinessFactor)&&(p+=`    glossiness *= u_glossinessFactor;
`)):(Cesium.defined(n.u_specularFactor)?p+=`    vec3 specular = clamp(u_specularFactor, vec3(0.0), vec3(1.0));
`:p+=`    vec3 specular = vec3(1.0);
`,Cesium.defined(n.u_glossinessFactor)?p+=`    float glossiness = clamp(u_glossinessFactor, 0.0, 1.0);
`:p+=`    float glossiness = 1.0;
`),Cesium.defined(n.u_diffuseTexture)?(p+=`    vec4 diffuse = SRGBtoLINEAR4(texture2D(u_diffuseTexture, ${ce}));
`,Cesium.defined(n.u_diffuseFactor)&&(p+=`    diffuse *= u_diffuseFactor;
`)):Cesium.defined(n.u_diffuseFactor)?p+=`    vec4 diffuse = clamp(u_diffuseFactor, vec4(0.0), vec4(1.0));
`:p+=`    vec4 diffuse = vec4(1.0);
`,p+=`    baseColorWithAlpha.a = diffuse.a;
`):Cesium.defined(n.u_metallicRoughnessTexture)?(p+=`    vec3 metallicRoughness = texture2D(u_metallicRoughnessTexture, ${Se}).rgb;
`,p+=`    float metalness = clamp(metallicRoughness.b, 0.0, 1.0);
`,p+=`    float roughness = clamp(metallicRoughness.g, 0.04, 1.0);
`,Cesium.defined(n.u_metallicFactor)&&(p+=`    metalness *= u_metallicFactor;
`),Cesium.defined(n.u_roughnessFactor)&&(p+=`    roughness *= u_roughnessFactor;
`)):(Cesium.defined(n.u_metallicFactor)?p+=`    float metalness = clamp(u_metallicFactor, 0.0, 1.0);
`:p+=`    float metalness = 1.0;
`,Cesium.defined(n.u_roughnessFactor)?p+=`    float roughness = clamp(u_roughnessFactor, 0.04, 1.0);
`:p+=`    float roughness = 1.0;
`),p+=`    vec3 v = -normalize(v_positionEC);
`,p+=`#ifndef USE_CUSTOM_LIGHT_COLOR 
`,p+=`    vec3 lightColorHdr = czm_lightColorHdr;
`,p+=`#else 
`,p+=`    vec3 lightColorHdr = gltf_lightColor;
`,p+=`#endif 
`,p+=`    vec3 l = normalize(czm_lightDirectionEC);
`,p+=`    vec3 h = normalize(v + l);
`,p+=`    float NdotL = clamp(dot(n, l), 0.001, 1.0);
`,p+=`    float NdotV = abs(dot(n, v)) + 0.001;
`,p+=`    float NdotH = clamp(dot(n, h), 0.0, 1.0);
`,p+=`    float LdotH = clamp(dot(l, h), 0.0, 1.0);
`,p+=`    float VdotH = clamp(dot(v, h), 0.0, 1.0);
`,p+=`    vec3 f0 = vec3(0.04);
`,c?(p+=`    float roughness = 1.0 - glossiness;
`,p+=`    vec3 diffuseColor = diffuse.rgb * (1.0 - max(max(specular.r, specular.g), specular.b));
`,p+=`    vec3 specularColor = specular;
`):(p+=`    vec3 diffuseColor = baseColor * (1.0 - metalness) * (1.0 - f0);
`,p+=`    vec3 specularColor = mix(f0, baseColor, metalness);
`),p+=`    float alpha = roughness * roughness;
`,p+=`    float reflectance = max(max(specularColor.r, specularColor.g), specularColor.b);
`,p+=`    vec3 r90 = vec3(clamp(reflectance * 25.0, 0.0, 1.0));
`,p+=`    vec3 r0 = specularColor.rgb;
`,p+=`    vec3 F = fresnelSchlick2(r0, r90, VdotH);
`,p+=`    float G = smithVisibilityGGX(alpha, NdotL, NdotV);
`,p+=`    float D = GGX(alpha, NdotH);
`,p+=`    vec3 diffuseContribution = (1.0 - F) * lambertianDiffuse(diffuseColor);
`,p+=`    vec3 specularContribution = F * G * D / (4.0 * NdotL * NdotV);
`,p+=`    vec3 color = NdotL * lightColorHdr * (diffuseContribution + specularContribution);
`,p+=`#if defined(USE_IBL_LIGHTING) && !defined(DIFFUSE_IBL) && !defined(SPECULAR_IBL) 
`,p+=`    vec3 r = normalize(czm_inverseViewRotation * normalize(reflect(v, n)));
`,p+=`    float vertexRadius = length(positionWC);
`,p+=`    float horizonDotNadir = 1.0 - min(1.0, czm_ellipsoidRadii.x / vertexRadius);
`,p+=`    float reflectionDotNadir = dot(r, normalize(positionWC));
`,p+=`    r.x = -r.x;
`,p+=`    r = -normalize(czm_temeToPseudoFixed * r);
`,p+=`    r.x = -r.x;
`,p+=`    float inverseRoughness = 1.04 - roughness;
`,p+=`    inverseRoughness *= inverseRoughness;
`,p+=`    vec3 sceneSkyBox = textureCube(czm_environmentMap, r).rgb * inverseRoughness;
`,p+=`    float atmosphereHeight = 0.05;
`,p+=`    float blendRegionSize = 0.1 * ((1.0 - inverseRoughness) * 8.0 + 1.1 - horizonDotNadir);
`,p+=`    float blendRegionOffset = roughness * -1.0;
`,p+=`    float farAboveHorizon = clamp(horizonDotNadir - blendRegionSize * 0.5 + blendRegionOffset, 1.0e-10 - blendRegionSize, 0.99999);
`,p+=`    float aroundHorizon = clamp(horizonDotNadir + blendRegionSize * 0.5, 1.0e-10 - blendRegionSize, 0.99999);
`,p+=`    float farBelowHorizon = clamp(horizonDotNadir + blendRegionSize * 1.5, 1.0e-10 - blendRegionSize, 0.99999);
`,p+=`    float smoothstepHeight = smoothstep(0.0, atmosphereHeight, horizonDotNadir);
`,p+=`    vec3 belowHorizonColor = mix(vec3(0.1, 0.15, 0.25), vec3(0.4, 0.7, 0.9), smoothstepHeight);
`,p+=`    vec3 nadirColor = belowHorizonColor * 0.5;
`,p+=`    vec3 aboveHorizonColor = mix(vec3(0.9, 1.0, 1.2), belowHorizonColor, roughness * 0.5);
`,p+=`    vec3 blueSkyColor = mix(vec3(0.18, 0.26, 0.48), aboveHorizonColor, reflectionDotNadir * inverseRoughness * 0.5 + 0.75);
`,p+=`    vec3 zenithColor = mix(blueSkyColor, sceneSkyBox, smoothstepHeight);
`,p+=`    vec3 blueSkyDiffuseColor = vec3(0.7, 0.85, 0.9);
`,p+=`    float diffuseIrradianceFromEarth = (1.0 - horizonDotNadir) * (reflectionDotNadir * 0.25 + 0.75) * smoothstepHeight;
`,p+=`    float diffuseIrradianceFromSky = (1.0 - smoothstepHeight) * (1.0 - (reflectionDotNadir * 0.25 + 0.25));
`,p+=`    vec3 diffuseIrradiance = blueSkyDiffuseColor * clamp(diffuseIrradianceFromEarth + diffuseIrradianceFromSky, 0.0, 1.0);
`,p+=`    float notDistantRough = (1.0 - horizonDotNadir * roughness * 0.8);
`,p+=`    vec3 specularIrradiance = mix(zenithColor, aboveHorizonColor, smoothstep(farAboveHorizon, aroundHorizon, reflectionDotNadir) * notDistantRough);
`,p+=`    specularIrradiance = mix(specularIrradiance, belowHorizonColor, smoothstep(aroundHorizon, farBelowHorizon, reflectionDotNadir) * inverseRoughness);
`,p+=`    specularIrradiance = mix(specularIrradiance, nadirColor, smoothstep(farBelowHorizon, 1.0, reflectionDotNadir) * inverseRoughness);
`,p+=`#ifdef USE_SUN_LUMINANCE 
`,p+=`    float LdotZenith = clamp(dot(normalize(czm_inverseViewRotation * l), normalize(positionWC * -1.0)), 0.001, 1.0);
`,p+=`    float S = acos(LdotZenith);
`,p+=`    float NdotZenith = clamp(dot(normalize(czm_inverseViewRotation * n), normalize(positionWC * -1.0)), 0.001, 1.0);
`,p+=`    float gamma = acos(NdotL);
`,p+=`    float numerator = ((0.91 + 10.0 * exp(-3.0 * gamma) + 0.45 * pow(NdotL, 2.0)) * (1.0 - exp(-0.32 / NdotZenith)));
`,p+=`    float denominator = (0.91 + 10.0 * exp(-3.0 * S) + 0.45 * pow(LdotZenith,2.0)) * (1.0 - exp(-0.32));
`,p+=`    float luminance = gltf_luminanceAtZenith * (numerator / denominator);
`,p+=`#endif 
`,p+=`    vec2 brdfLut = texture2D(czm_brdfLut, vec2(NdotV, roughness)).rg;
`,p+=`    vec3 IBLColor = (diffuseIrradiance * diffuseColor * gltf_iblFactor.x) + (specularIrradiance * SRGBtoLINEAR3(specularColor * brdfLut.x + brdfLut.y) * gltf_iblFactor.y);
`,p+=`    float maximumComponent = max(max(lightColorHdr.x, lightColorHdr.y), lightColorHdr.z);
`,p+=`    vec3 lightColor = lightColorHdr / max(maximumComponent, 1.0);
`,p+=`    IBLColor *= lightColor;
`,p+=`#ifdef USE_SUN_LUMINANCE 
`,p+=`    color += IBLColor * luminance;
`,p+=`#else 
`,p+=`    color += IBLColor; 
`,p+=`#endif 
`,p+=`#elif defined(DIFFUSE_IBL) || defined(SPECULAR_IBL) 
`,p+=`    const mat3 yUpToZUp = mat3(-1.0, 0.0, 0.0, 0.0, 0.0, -1.0, 0.0, 1.0, 0.0); 
`,p+=`    vec3 cubeDir = normalize(yUpToZUp * gltf_iblReferenceFrameMatrix * normalize(reflect(-v, n))); 
`,p+=`#ifdef DIFFUSE_IBL 
`,p+=`#ifdef CUSTOM_SPHERICAL_HARMONICS 
`,p+=`    vec3 diffuseIrradiance = czm_sphericalHarmonics(cubeDir, gltf_sphericalHarmonicCoefficients); 
`,p+=`#else 
`,p+=`    vec3 diffuseIrradiance = czm_sphericalHarmonics(cubeDir, czm_sphericalHarmonicCoefficients); 
`,p+=`#endif 
`,p+=`#else 
`,p+=`    vec3 diffuseIrradiance = vec3(0.0); 
`,p+=`#endif 
`,p+=`#ifdef SPECULAR_IBL 
`,p+=`    vec2 brdfLut = texture2D(czm_brdfLut, vec2(NdotV, roughness)).rg;
`,p+=`#ifdef CUSTOM_SPECULAR_IBL 
`,p+=`    vec3 specularIBL = czm_sampleOctahedralProjection(gltf_specularMap, gltf_specularMapSize, cubeDir,  roughness * gltf_maxSpecularLOD, gltf_maxSpecularLOD);
`,p+=`#else 
`,p+=`    vec3 specularIBL = czm_sampleOctahedralProjection(czm_specularEnvironmentMaps, czm_specularEnvironmentMapSize, cubeDir,  roughness * czm_specularEnvironmentMapsMaximumLOD, czm_specularEnvironmentMapsMaximumLOD);
`,p+=`#endif 
`,p+=`    specularIBL *= F * brdfLut.x + brdfLut.y;
`,p+=`#else 
`,p+=`    vec3 specularIBL = vec3(0.0); 
`,p+=`#endif 
`,p+=`    color += diffuseIrradiance * diffuseColor + specularColor * specularIBL;
`,p+=`#endif 
`):p+=`    vec3 color = baseColor;
`,T||(Cesium.defined(n.u_occlusionTexture)&&(p+=`    color *= texture2D(u_occlusionTexture, ${de}).r;
`),Cesium.defined(n.u_emissiveTexture)?(p+=`    vec3 emissive = SRGBtoLINEAR3(texture2D(u_emissiveTexture, ${Ae}).rgb);
`,Cesium.defined(n.u_emissiveFactor)&&(p+=`    emissive *= u_emissiveFactor;
`),p+=`    color += emissive;
`):Cesium.defined(n.u_emissiveFactor)&&(p+=`    color += u_emissiveFactor;
`)),T||(p+=`    color = applyTonemapping(color);
`),p+=`    color = LINEARtoSRGB(color);
`,b&&(p+=`    float outlineness = max(
`,p+=`        texture2D(u_outlineTexture, vec2(v_outlineCoordinates.x, 0.5)).r,
`,p+=`        max(
`,p+=`          texture2D(u_outlineTexture, vec2(v_outlineCoordinates.y, 0.5)).r,
`,p+=`          texture2D(u_outlineTexture, vec2(v_outlineCoordinates.z, 0.5)).r));
`,p+=`    color = mix(color, vec3(0.0, 0.0, 0.0), outlineness);
`),Cesium.defined(F)?F==="MASK"?(p+=`    if (baseColorWithAlpha.a < u_alphaCutoff) {
`,p+=`        discard;
`,p+=`    }
`,p+=`    gl_FragColor = vec4(color, 1.0);
`):F==="BLEND"?p+=`    gl_FragColor = vec4(color, baseColorWithAlpha.a);
`:p+=`    gl_FragColor = vec4(color, 1.0);
`:p+=`    gl_FragColor = vec4(color, 1.0);
`,p+=`}
`;let ye=Cesium.addToArray(f,{type:Cesium.WebGLConstants.VERTEX_SHADER,extras:{_pipeline:{source:g,extension:".glsl"}}}),Ie=Cesium.addToArray(f,{type:Cesium.WebGLConstants.FRAGMENT_SHADER,extras:{_pipeline:{source:p,extension:".glsl"}}}),$=Cesium.addToArray(l,{fragmentShader:Ie,vertexShader:ye});return Cesium.addToArray(u,{attributes:U,program:$,uniforms:R})}function P1(e){if(e.indexOf("Offset")!==-1)return Cesium.WebGLConstants.FLOAT_VEC2;if(e.indexOf("Rotation")!==-1)return Cesium.WebGLConstants.FLOAT;if(e.indexOf("Scale")!==-1)return Cesium.WebGLConstants.FLOAT_VEC2;if(e.indexOf("Texture")!==-1)return Cesium.WebGLConstants.SAMPLER_2D;switch(e){case"u_baseColorFactor":return Cesium.WebGLConstants.FLOAT_VEC4;case"u_metallicFactor":return Cesium.WebGLConstants.FLOAT;case"u_roughnessFactor":return Cesium.WebGLConstants.FLOAT;case"u_emissiveFactor":return Cesium.WebGLConstants.FLOAT_VEC3;case"u_diffuseFactor":return Cesium.WebGLConstants.FLOAT_VEC4;case"u_specularFactor":return Cesium.WebGLConstants.FLOAT_VEC3;case"u_glossinessFactor":return Cesium.WebGLConstants.FLOAT}}var Vh=b1;function wl(e,t,r){this._name=t.name,this._id=r,this._uniformMap=e._uniformMaps[r],this._technique=void 0,this._program=void 0,this._values=void 0}Object.defineProperties(wl.prototype,{name:{get:function(){return this._name}},id:{get:function(){return this._id}}});wl.prototype.setValue=function(e,t){let r=`u_${e}`,n=this._uniformMap.values[r];n.value=n.clone(t,n.value)};wl.prototype.getValue=function(e){let t=`u_${e}`,r=this._uniformMap.values[t];if(Cesium.defined(r))return r.value};var zh=wl;function zg(e,t,r){let n=[],i=e.primitives,s=i.length;for(let a=0;a<s;++a){let o=i[a];n[a]=t[o.material]}this._name=e.name,this._materials=n,this._id=r}Object.defineProperties(zg.prototype,{name:{get:function(){return this._name}},id:{get:function(){return this._id}},materials:{get:function(){return this._materials}}});var kh=zg;var M1=65534;function Bu(){}Bu.hasExtension=function(e){return Cesium.defined(e.extensionsRequired.CESIUM_primitive_outline)||Cesium.defined(e.extensionsUsed.CESIUM_primitive_outline)};Bu.outlinePrimitives=function(e){if(!Bu.hasExtension(e))return;let t=e.gltfInternal,r=[];Cesium.ForEach.mesh(t,function(n,i){Cesium.ForEach.meshPrimitive(n,function(s,a){if(!Cesium.defined(s.extensions))return;let o=s.extensions.CESIUM_primitive_outline;if(!Cesium.defined(o))return;let u=N1(e,s);u!==void 0&&(r.indexOf(u)<0&&r.push(u),A1(e,i,a,o.indices,u))})});for(let n=0;n<r.length;++n)D1(e,r[n].bufferViews);R1(e)};Bu.createTexture=function(e,t){let r=t.cache.modelOutliningCache;if(Cesium.defined(r)||(r=t.cache.modelOutliningCache={}),Cesium.defined(r.outlineTexture))return r.outlineTexture;let n=Math.min(4096,Cesium.ContextLimits.maximumTextureSize),i=n,s=Ug(i),a=[];for(;i>1;)i>>=1,a.push(Ug(i));let o=new Ir({context:t,source:{arrayBufferView:s,mipLevels:a},width:n,height:1,pixelFormat:Cesium.PixelFormat.LUMINANCE,sampler:new Cesium.Sampler({wrapS:Cesium.TextureWrap.CLAMP_TO_EDGE,wrapT:Cesium.TextureWrap.CLAMP_TO_EDGE,minificationFilter:Cesium.TextureMinificationFilter.LINEAR_MIPMAP_LINEAR,magnificationFilter:Cesium.TextureMagnificationFilter.LINEAR})});return r.outlineTexture=o,o};function A1(e,t,r,n,i){let s=i.vertexCopies,a=i.extraVertices,o=i.outlineCoordinates,u=e.gltfInternal,l=u.meshes[t].primitives[r],c=u.accessors,h=u.bufferViews,d;for(let N in l.attributes)if(l.attributes.hasOwnProperty(N)){let B=l.attributes[N],C=c[B];if(Cesium.defined(C)){d=C.count;break}}if(!Cesium.defined(d))return;let m=c[l.indices],g=h[m.bufferView],p=c[n],v=h[p.bufferView],_=e._loadResources,y=_.getBuffer(g),x=_.getBuffer(v),E=m.componentType===5123?new Uint16Array(y.buffer,y.byteOffset+m.byteOffset,m.count):new Uint32Array(y.buffer,y.byteOffset+m.byteOffset,m.count),S=p.componentType===5123?new Uint16Array(x.buffer,x.byteOffset+p.byteOffset,p.count):new Uint32Array(x.buffer,x.byteOffset+p.byteOffset,p.count),I=d,P=[I],w;for(w=0;w<S.length;w+=2){let N=S[w],B=S[w+1],C=Math.min(N,B),b=Math.max(N,B);P[C*I+b]=1}for(w=0;w<E.length;w+=3){let N=E[w],B=E[w+1],C=E[w+2],b=!1,T=b||qh(P,N,B),A=b||qh(P,B,C),R=b||qh(P,C,N),F=kg(o,N,B,C,T,A,R);for(;F>=0;){let D;if(F===N?D=s[N]:F===B?D=s[B]:D=s[C],D===void 0){D=d+a.length;let O=F;for(;O>=d;)O=a[O-d];a.push(O),s[F]=D}D>M1&&E instanceof Uint16Array&&(E=new Uint32Array(E),m.componentType=5125,g.buffer=u.buffers.push({byteLength:E.byteLength,extras:{_pipeline:{source:E.buffer}}})-1,g.byteLength=E.byteLength,g.byteOffset=0,e._loadResources.buffers[g.buffer]=new Uint8Array(E.buffer,0,E.byteLength),_.indexBuffersToCreate._array.forEach(function(O){Cesium.defined(O)&&O.id===m.bufferView&&(O.componentType=m.componentType)})),F===N?(N=D,E[w]=D):F===B?(B=D,E[w+1]=D):(C=D,E[w+2]=D),Cesium.defined(m.max)&&(m.max[0]=Math.max(m.max[0],D)),F=kg(o,N,B,C,T,A,R)}}}function Uh(e,t,r,n,i){let s=t*3,a=e[s],o=e[s+1],u=e[s+2];return a===void 0?63:((a===r&&o===n&&u===i)<<0)+((a===r&&o===i&&u===n)<<1)+((a===n&&o===r&&u===i)<<2)+((a===n&&o===i&&u===r)<<3)+((a===i&&o===r&&u===n)<<4)+((a===i&&o===n&&u===r)<<5)}function Gh(e){return(e&1)+(e>>1&1)+(e>>2&1)+(e>>3&1)+(e>>4&1)+(e>>5&1)}function kg(e,t,r,n,i,s,a){let o=a?1:0,u=i?1:0,f=0,l=Uh(e,t,o,u,f);if(l===0)return t;let c=0,h=i?1:0,d=s?1:0,m=Uh(e,r,c,h,d);if(m===0)return r;let g=a?1:0,p=0,v=s?1:0,_=Uh(e,n,g,p,v);if(_===0)return n;let y=l&m&_,x,E,S;if(y&1)x=0,E=1,S=2;else if(y&2)x=0,S=1,E=2;else if(y&4)E=0,x=1,S=2;else if(y&8)E=0,S=1,x=2;else if(y&16)S=0,x=1,E=2;else if(y&32)S=0,E=1,x=2;else{let N=Gh(l),B=Gh(m),C=Gh(_);return N<B&&N<C?t:B<C?r:n}let I=t*3;e[I+x]=o,e[I+E]=u,e[I+S]=f;let P=r*3;e[P+x]=c,e[P+E]=h,e[P+S]=d;let w=n*3;return e[w+x]=g,e[w+E]=p,e[w+S]=v,-1}function qh(e,t,r){let n=e[0],i=Math.min(t,r)*n+Math.max(t,r);return e[i]===1}function Ug(e){let t=new Uint8Array(e);return t[e-1]=192,e===8?t[e-1]=96:e===4?t[e-1]=48:e===2?t[e-1]=24:e===1&&(t[e-1]=12),t}function D1(e,t){let r=e.gltfInternal,n=e._loadResources,i,s;for(i=0;i<t.length;++i){let a=t[i],o=a.extras._pipeline.vertexNumberingScope;a.extras._pipeline.vertexNumberingScope=void 0;let u=o.extraVertices,f=n.getBuffer(a),l=a.byteStride||4,c=u.length,h=new Uint8Array(f.byteLength+c*l);for(h.set(f),s=0;s<c;++s){let g=u[s]*l,p=f.length+s*l;for(let v=0;v<l;++v)h[p+v]=h[g+v]}a.byteOffset=0,a.byteLength=h.byteLength;let d=r.buffers.push({byteLength:h.byteLength,extras:{_pipeline:{source:h.buffer}}})-1;a.buffer=d,n.buffers[d]=h;let m=o.accessors;for(s=0;s<m.length;++s){let g=m[s];r.accessors[g].count+=c}if(!o.createdOutlines){let g=o.outlineCoordinates,p=new Float32Array(g),v=e.gltfInternal.buffers.push({byteLength:p.byteLength,extras:{_pipeline:{source:p.buffer}}})-1;n.buffers[v]=new Uint8Array(p.buffer,0,p.byteLength);let _=e.gltfInternal.bufferViews.push({buffer:v,byteLength:p.byteLength,byteOffset:0,byteStride:3*Float32Array.BYTES_PER_ELEMENT,target:34962})-1,y=e.gltfInternal.accessors.push({bufferView:_,byteOffset:0,componentType:5126,count:p.length/3,type:"VEC3",min:[0,0,0],max:[1,1,1]})-1,x=o.primitives;for(s=0;s<x.length;++s)x[s].attributes._OUTLINE_COORDINATES=y;n.vertexBuffersToCreate.enqueue(_),o.createdOutlines=!0}}}function R1(e){let t=e.gltfInternal,r=e._loadResources,n;for(n=0;n<t.buffers.length;++n){let i=t.buffers[n],s=t.bufferViews.filter(O1.bind(void 0,n)),a=s.reduce(function(f,l){return f+l.byteLength},0);if(a===i.byteLength)continue;let o=new Uint8Array(a),u=0;for(let f=0;f<s.length;++f){let l=s[f],c=r.getBuffer(l);o.set(c,u),l.byteOffset=u,u+=c.byteLength}r.buffers[n]=o,i.extras._pipeline.source=o.buffer,i.byteLength=a}}function O1(e,t){return t.buffer===e}function N1(e,t){let r=t.attributes;if(r===void 0)return;let n=e.gltfInternal,i;for(let s in r){if(!r.hasOwnProperty(s))continue;let a=r[s],u=n.accessors[a].bufferView,f=n.bufferViews[u];if(Cesium.defined(f.extras)||(f.extras={}),Cesium.defined(f.extras._pipeline)||(f.extras._pipeline={}),!Cesium.defined(f.extras._pipeline.vertexNumberingScope))f.extras._pipeline.vertexNumberingScope=i||{vertexCopies:[],extraVertices:[],outlineCoordinates:[],accessors:[],bufferViews:[],primitives:[],createdOutlines:!1};else if(i!==void 0&&f.extras._pipeline.vertexNumberingScope!==i)return;i=f.extras._pipeline.vertexNumberingScope,i.bufferViews.indexOf(f)<0&&i.bufferViews.push(f),i.accessors.indexOf(a)<0&&i.accessors.push(a)}return i.primitives.push(t),i}var Sl=Bu;function F1(e){Cesium.ForEach.accessor(e,function(r){Cesium.defined(r.bufferView)&&(r.byteOffset=Cesium.defaultValue(r.byteOffset,0))}),Cesium.ForEach.bufferView(e,function(r){Cesium.defined(r.buffer)&&(r.byteOffset=Cesium.defaultValue(r.byteOffset,0))}),Cesium.ForEach.mesh(e,function(r){Cesium.ForEach.meshPrimitive(r,function(n){if(n.mode=Cesium.defaultValue(n.mode,Cesium.WebGLConstants.TRIANGLES),!Cesium.defined(n.material)){Cesium.defined(e.materials)||(e.materials=[]);let i={name:"default"};n.material=Cesium.addToArray(e.materials,i)}})}),Cesium.ForEach.accessorContainingVertexAttributeData(e,function(r){let n=e.accessors[r],i=n.bufferView;if(n.normalized=Cesium.defaultValue(n.normalized,!1),Cesium.defined(i)){let s=e.bufferViews[i];s.byteStride=Cesium.getAccessorByteStride(e,n),s.target=Cesium.WebGLConstants.ARRAY_BUFFER}}),Cesium.ForEach.accessorContainingIndexData(e,function(r){let i=e.accessors[r].bufferView;if(Cesium.defined(i)){let s=e.bufferViews[i];s.target=Cesium.WebGLConstants.ELEMENT_ARRAY_BUFFER}}),Cesium.ForEach.material(e,function(r){let n=Cesium.defaultValue(r.extensions,Cesium.defaultValue.EMPTY_OBJECT),i=n.KHR_materials_common;if(Cesium.defined(i)){let u=i.technique,f=Cesium.defined(i.values)?i.values:{};i.values=f,f.ambient=Cesium.defined(f.ambient)?f.ambient:[0,0,0,1],f.emission=Cesium.defined(f.emission)?f.emission:[0,0,0,1],f.transparency=Cesium.defaultValue(f.transparency,1),f.transparent=Cesium.defaultValue(f.transparent,!1),f.doubleSided=Cesium.defaultValue(f.doubleSided,!1),u!=="CONSTANT"&&(f.diffuse=Cesium.defined(f.diffuse)?f.diffuse:[0,0,0,1],u!=="LAMBERT"&&(f.specular=Cesium.defined(f.specular)?f.specular:[0,0,0,1],f.shininess=Cesium.defaultValue(f.shininess,0)));return}r.emissiveFactor=Cesium.defaultValue(r.emissiveFactor,[0,0,0]),r.alphaMode=Cesium.defaultValue(r.alphaMode,"OPAQUE"),r.doubleSided=Cesium.defaultValue(r.doubleSided,!1),r.alphaMode==="MASK"&&(r.alphaCutoff=Cesium.defaultValue(r.alphaCutoff,.5));let s=n.KHR_techniques_webgl;Cesium.defined(s)&&Cesium.ForEach.materialValue(r,function(u){Cesium.defined(u.index)&&Ga(u)}),Ga(r.emissiveTexture),Ga(r.normalTexture),Ga(r.occlusionTexture);let a=r.pbrMetallicRoughness;Cesium.defined(a)&&(a.baseColorFactor=Cesium.defaultValue(a.baseColorFactor,[1,1,1,1]),a.metallicFactor=Cesium.defaultValue(a.metallicFactor,1),a.roughnessFactor=Cesium.defaultValue(a.roughnessFactor,1),Ga(a.baseColorTexture),Ga(a.metallicRoughnessTexture));let o=n.KHR_materials_pbrSpecularGlossiness;Cesium.defined(o)&&(o.diffuseFactor=Cesium.defaultValue(o.diffuseFactor,[1,1,1,1]),o.specularFactor=Cesium.defaultValue(o.specularFactor,[1,1,1]),o.glossinessFactor=Cesium.defaultValue(o.glossinessFactor,1),Ga(o.specularGlossinessTexture))}),Cesium.ForEach.animation(e,function(r){Cesium.ForEach.animationSampler(r,function(n){n.interpolation=Cesium.defaultValue(n.interpolation,"LINEAR")})});let t=B1(e);return Cesium.ForEach.node(e,function(r,n){Cesium.defined(t[n])||Cesium.defined(r.translation)||Cesium.defined(r.rotation)||Cesium.defined(r.scale)?(r.translation=Cesium.defaultValue(r.translation,[0,0,0]),r.rotation=Cesium.defaultValue(r.rotation,[0,0,0,1]),r.scale=Cesium.defaultValue(r.scale,[1,1,1])):r.matrix=Cesium.defaultValue(r.matrix,[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}),Cesium.ForEach.sampler(e,function(r){r.wrapS=Cesium.defaultValue(r.wrapS,Cesium.WebGLConstants.REPEAT),r.wrapT=Cesium.defaultValue(r.wrapT,Cesium.WebGLConstants.REPEAT)}),Cesium.defined(e.scenes)&&!Cesium.defined(e.scene)&&(e.scene=0),e}function B1(e){let t={};return Cesium.ForEach.animation(e,function(r){Cesium.ForEach.animationChannel(r,function(n){let i=n.target,s=i.node,a=i.path;(a==="translation"||a==="rotation"||a==="scale")&&(t[s]=!0)})}),t}function Ga(e){Cesium.defined(e)&&(e.texCoord=Cesium.defaultValue(e.texCoord,0))}var Hh=F1;var Tl={.8:q1,"1.0":fw,"2.0":void 0};function V1(e,t){t=Cesium.defaultValue(t,Cesium.defaultValue.EMPTY_OBJECT);let r=t.targetVersion,n=e.version;e.asset=Cesium.defaultValue(e.asset,{version:"1.0"}),e.asset.version=Cesium.defaultValue(e.asset.version,"1.0"),n=Cesium.defaultValue(n,e.asset.version).toString(),Object.prototype.hasOwnProperty.call(Tl,n)||(Cesium.defined(n)&&(n=n.substring(0,3)),Object.prototype.hasOwnProperty.call(Tl,n)||(n="1.0"));let i=Tl[n];for(;Cesium.defined(i)&&n!==r;)i(e,t),n=e.asset.version,i=Tl[n];return e}function qg(e){let t=e.materials;for(let r in t)if(Object.prototype.hasOwnProperty.call(t,r)){let n=t[r],i=n.instanceTechnique;Cesium.defined(i)&&(n.technique=i.technique,n.values=i.values,delete n.instanceTechnique)}}function z1(e){let t=e.meshes;for(let r in t)if(Object.prototype.hasOwnProperty.call(t,r)){let i=t[r].primitives;if(Cesium.defined(i)){let s=i.length;for(let a=0;a<s;++a){let o=i[a],u=Cesium.defaultValue(o.primitive,Cesium.WebGLConstants.TRIANGLES);o.mode=Cesium.defaultValue(o.mode,u),delete o.primitive}}}}function k1(e){let t=e.nodes,r=new Cesium.Cartesian3,n=new Cesium.Quaternion;for(let i in t)if(Object.prototype.hasOwnProperty.call(t,i)){let s=t[i];if(Cesium.defined(s.rotation)){let o=s.rotation;Cesium.Cartesian3.fromArray(o,0,r),Cesium.Quaternion.fromAxisAngle(r,o[3],n),s.rotation=[n.x,n.y,n.z,n.w]}let a=s.instanceSkin;Cesium.defined(a)&&(s.skeletons=a.skeletons,s.skin=a.skin,s.meshes=a.meshes,delete s.instanceSkin)}}function U1(e){let t=e.animations,r=e.accessors,n=e.bufferViews,i=e.buffers,s={},a=new Cesium.Cartesian3,o=new Cesium.Quaternion;for(let u in t)if(Object.prototype.hasOwnProperty.call(t,u)){let f=t[u],l=f.channels,c=f.parameters,h=f.samplers;if(Cesium.defined(l)){let d=l.length;for(let m=0;m<d;++m){let g=l[m];if(g.target.path==="rotation"){let p=c[h[g.sampler].output];if(Cesium.defined(s[p]))continue;s[p]=!0;let v=r[p],_=n[v.bufferView],x=i[_.buffer].extras._pipeline.source,E=x.byteOffset+_.byteOffset+v.byteOffset,S=v.componentType,I=v.count,P=Cesium.numberOfComponentsForType(v.type),w=v.count*P,N=Cesium.ComponentDatatype.createArrayBufferView(S,x.buffer,E,w);for(let B=0;B<I;B++){let C=B*P;Cesium.Cartesian3.unpack(N,C,a);let b=N[C+3];Cesium.Quaternion.fromAxisAngle(a,b,o),Cesium.Quaternion.pack(o,N,C)}}}}}}function G1(e){let t=e.techniques;for(let r in t)if(Object.prototype.hasOwnProperty.call(t,r)){let n=t[r],i=n.passes;if(Cesium.defined(i)){let s=Cesium.defaultValue(n.pass,"defaultPass");if(Object.prototype.hasOwnProperty.call(i,s)){let a=i[s],o=a.instanceProgram;n.attributes=Cesium.defaultValue(n.attributes,o.attributes),n.program=Cesium.defaultValue(n.program,o.program),n.uniforms=Cesium.defaultValue(n.uniforms,o.uniforms),n.states=Cesium.defaultValue(n.states,a.states)}delete n.passes,delete n.pass}}}function q1(e){Cesium.defined(e.asset)||(e.asset={});let t=e.asset;if(t.version="1.0",typeof t.profile=="string"){let r=t.profile.split(" ");t.profile={api:r[0],version:r[1]}}else t.profile={};if(Cesium.defined(e.version)&&delete e.version,qg(e),z1(e),k1(e),U1(e),G1(e),Cesium.defined(e.allExtensions)&&(e.extensionsUsed=e.allExtensions,delete e.allExtensions),Cesium.defined(e.lights)){let r=Cesium.defaultValue(e.extensions,{});e.extensions=r;let n=Cesium.defaultValue(r.KHR_materials_common,{});r.KHR_materials_common=n,n.lights=e.lights,delete e.lights,Cesium.addExtensionsUsed(e,"KHR_materials_common")}}function H1(e){let t=e.animations;for(let r in t)if(Object.prototype.hasOwnProperty.call(t,r)){let n=t[r],i=n.parameters;if(Cesium.defined(i)){let s=n.samplers;for(let a in s)if(Object.prototype.hasOwnProperty.call(s,a)){let o=s[a];o.input=i[o.input],o.output=i[o.output]}delete n.parameters}}}function Gg(e,t){let r=[];for(let n in e)if(Object.prototype.hasOwnProperty.call(e,n)){let i=e[n];t[n]=r.length,r.push(i),Cesium.defined(i.name)||(i.name=n)}return r}function W1(e){let t,r={accessors:{},animations:{},buffers:{},bufferViews:{},cameras:{},images:{},materials:{},meshes:{},nodes:{},programs:{},samplers:{},scenes:{},shaders:{},skins:{},textures:{},techniques:{}},n,i={},s=e.nodes;for(let a in s)Object.prototype.hasOwnProperty.call(s,a)&&(n=s[a].jointName,Cesium.defined(n)&&(i[n]=a));for(let a in e)if(Object.prototype.hasOwnProperty.call(e,a)&&Cesium.defined(r[a])){let o={},u=e[a];e[a]=Gg(u,o),r[a]=o}for(n in i)Object.prototype.hasOwnProperty.call(i,n)&&(i[n]=r.nodes[i[n]]);Cesium.defined(e.scene)&&(e.scene=r.scenes[e.scene]),Cesium.ForEach.bufferView(e,function(a){Cesium.defined(a.buffer)&&(a.buffer=r.buffers[a.buffer])}),Cesium.ForEach.accessor(e,function(a){Cesium.defined(a.bufferView)&&(a.bufferView=r.bufferViews[a.bufferView])}),Cesium.ForEach.shader(e,function(a){let o=a.extensions;if(Cesium.defined(o)){let u=o.KHR_binary_glTF;Cesium.defined(u)&&(a.bufferView=r.bufferViews[u.bufferView],delete o.KHR_binary_glTF),Object.keys(o).length===0&&delete a.extensions}}),Cesium.ForEach.program(e,function(a){Cesium.defined(a.vertexShader)&&(a.vertexShader=r.shaders[a.vertexShader]),Cesium.defined(a.fragmentShader)&&(a.fragmentShader=r.shaders[a.fragmentShader])}),Cesium.ForEach.technique(e,function(a){Cesium.defined(a.program)&&(a.program=r.programs[a.program]),Cesium.ForEach.techniqueParameter(a,function(o){Cesium.defined(o.node)&&(o.node=r.nodes[o.node]);let u=o.value;typeof u=="string"&&(o.value={index:r.textures[u]})})}),Cesium.ForEach.mesh(e,function(a){Cesium.ForEach.meshPrimitive(a,function(o){Cesium.defined(o.indices)&&(o.indices=r.accessors[o.indices]),Cesium.ForEach.meshPrimitiveAttribute(o,function(u,f){o.attributes[f]=r.accessors[u]}),Cesium.defined(o.material)&&(o.material=r.materials[o.material])})}),Cesium.ForEach.node(e,function(a){let o=a.children;if(Cesium.defined(o)){let u=o.length;for(t=0;t<u;++t)o[t]=r.nodes[o[t]]}if(Cesium.defined(a.meshes)){let u=a.meshes,f=u.length;if(f>0)for(a.mesh=r.meshes[u[0]],t=1;t<f;++t){let l={mesh:r.meshes[u[t]]},c=Cesium.addToArray(e.nodes,l);Cesium.defined(o)||(o=[],a.children=o),o.push(c)}delete a.meshes}if(Cesium.defined(a.camera)&&(a.camera=r.cameras[a.camera]),Cesium.defined(a.skin)&&(a.skin=r.skins[a.skin]),Cesium.defined(a.skeletons)){let u=a.skeletons;if(u.length>0&&Cesium.defined(a.skin)){let l=e.skins[a.skin];l.skeleton=r.nodes[u[0]]}delete a.skeletons}Cesium.defined(a.jointName)&&delete a.jointName}),Cesium.ForEach.skin(e,function(a){Cesium.defined(a.inverseBindMatrices)&&(a.inverseBindMatrices=r.accessors[a.inverseBindMatrices]);let o=a.jointNames;if(Cesium.defined(o)){let u=[],f=o.length;for(t=0;t<f;++t)u[t]=i[o[t]];a.joints=u,delete a.jointNames}}),Cesium.ForEach.scene(e,function(a){let o=a.nodes;if(Cesium.defined(o)){let u=o.length;for(t=0;t<u;++t)o[t]=r.nodes[o[t]]}}),Cesium.ForEach.animation(e,function(a){let o={};a.samplers=Gg(a.samplers,o),Cesium.ForEach.animationSampler(a,function(u){u.input=r.accessors[u.input],u.output=r.accessors[u.output]}),Cesium.ForEach.animationChannel(a,function(u){u.sampler=o[u.sampler];let f=u.target;Cesium.defined(f)&&(f.node=r.nodes[f.id],delete f.id)})}),Cesium.ForEach.material(e,function(a){Cesium.defined(a.technique)&&(a.technique=r.techniques[a.technique]),Cesium.ForEach.materialValue(a,function(u,f){typeof u=="string"&&(a.values[f]={index:r.textures[u]})});let o=a.extensions;if(Cesium.defined(o)){let u=o.KHR_materials_common;Cesium.defined(u)&&Cesium.ForEach.materialValue(u,function(f,l){typeof f=="string"&&(u.values[l]={index:r.textures[f]})})}}),Cesium.ForEach.image(e,function(a){let o=a.extensions;if(Cesium.defined(o)){let u=o.KHR_binary_glTF;Cesium.defined(u)&&(a.bufferView=r.bufferViews[u.bufferView],a.mimeType=u.mimeType,delete o.KHR_binary_glTF),Object.keys(o).length===0&&delete a.extensions}}),Cesium.ForEach.texture(e,function(a){Cesium.defined(a.sampler)&&(a.sampler=r.samplers[a.sampler]),Cesium.defined(a.source)&&(a.source=r.images[a.source])})}function Y1(e){Cesium.ForEach.animation(e,function(t){Cesium.ForEach.animationSampler(t,function(r){delete r.name})})}function X1(e){for(let t in e)if(Object.prototype.hasOwnProperty.call(e,t)){let r=e[t];Array.isArray(r)&&r.length===0&&delete e[t]}Cesium.ForEach.node(e,function(t){Cesium.defined(t.children)&&t.children.length===0&&delete t.children})}function j1(e){let t=e.asset;delete t.profile,delete t.premultipliedAlpha}var K1={CESIUM_RTC:!0,KHR_materials_common:!0,WEB3D_quantized_attributes:!0};function Q1(e){let t=e.extensionsUsed;if(e.extensionsRequired=Cesium.defaultValue(e.extensionsRequired,[]),Cesium.defined(t)){let r=t.length;for(let n=0;n<r;++n){let i=t[n];Cesium.defined(K1[i])&&e.extensionsRequired.push(i)}}}function Z1(e){Cesium.ForEach.buffer(e,function(t){delete t.type})}function J1(e){Cesium.ForEach.texture(e,function(t){delete t.format,delete t.internalFormat,delete t.target,delete t.type})}function $1(e){Cesium.ForEach.mesh(e,function(t){Cesium.ForEach.meshPrimitive(t,function(r){Cesium.ForEach.meshPrimitiveAttribute(r,function(n,i){i==="TEXCOORD"?r.attributes.TEXCOORD_0=n:i==="COLOR"&&(r.attributes.COLOR_0=n)}),delete r.attributes.TEXCOORD,delete r.attributes.COLOR})}),Cesium.ForEach.technique(e,function(t){Cesium.ForEach.techniqueParameter(t,function(r){let n=r.semantic;Cesium.defined(n)&&(n==="TEXCOORD"?r.semantic="TEXCOORD_0":n==="COLOR"&&(r.semantic="COLOR_0"))})})}var ew={POSITION:!0,NORMAL:!0,TANGENT:!0},tw={COLOR:"COLOR",JOINT:"JOINTS",JOINTS:"JOINTS",TEXCOORD:"TEXCOORD",WEIGHT:"WEIGHTS",WEIGHTS:"WEIGHTS"};function rw(e){let t={};Cesium.ForEach.mesh(e,function(r){Cesium.ForEach.meshPrimitive(r,function(n){Cesium.ForEach.meshPrimitiveAttribute(n,function(i,s){if(s.charAt(0)!=="_"){let a=s.search(/_[0-9]+/g),o=s,u="_0";a>=0&&(o=s.substring(0,a),u=s.substring(a));let f,l=tw[o];Cesium.defined(l)?(f=l+u,t[s]=f):Cesium.defined(ew[o])||(f="_"+s,t[s]=f)}});for(let i in t)if(Object.prototype.hasOwnProperty.call(t,i)){let s=t[i],a=n.attributes[i];Cesium.defined(a)&&(delete n.attributes[i],n.attributes[s]=a)}})}),Cesium.ForEach.technique(e,function(r){Cesium.ForEach.techniqueParameter(r,function(n){let i=t[n.semantic];Cesium.defined(i)&&(n.semantic=i)})})}function nw(e){Cesium.ForEach.camera(e,function(t){let r=t.perspective;if(Cesium.defined(r)){let n=r.aspectRatio;Cesium.defined(n)&&n===0&&delete r.aspectRatio;let i=r.yfov;Cesium.defined(i)&&i===0&&(r.yfov=1)}})}function Wh(e,t){return Cesium.defined(t.byteStride)&&t.byteStride!==0?t.byteStride:Cesium.getAccessorByteStride(e,t)}function iw(e){Cesium.ForEach.buffer(e,function(t){Cesium.defined(t.byteLength)||(t.byteLength=t.extras._pipeline.source.length)}),Cesium.ForEach.accessor(e,function(t){let r=t.bufferView;if(Cesium.defined(r)){let n=e.bufferViews[r],i=Wh(e,t),s=t.byteOffset+t.count*i;n.byteLength=Math.max(Cesium.defaultValue(n.byteLength,0),s)}})}function sw(e){let t,r,n,i=e.bufferViews,s={};Cesium.ForEach.accessorContainingVertexAttributeData(e,function(o){let u=e.accessors[o];Cesium.defined(u.bufferView)&&(s[u.bufferView]=!0)});let a={};Cesium.ForEach.accessor(e,function(o){Cesium.defined(o.bufferView)&&(a[o.bufferView]=Cesium.defaultValue(a[o.bufferView],[]),a[o.bufferView].push(o))});for(let o in a)if(Object.prototype.hasOwnProperty.call(a,o)){n=i[o];let u=a[o];u.sort(function(h,d){return h.byteOffset-d.byteOffset});let f=0,l=0,c=u.length;for(t=0;t<c;++t){let h=u[t],d=Wh(e,h),m=h.byteOffset,g=h.count*d;delete h.byteStride;let p=t<c-1,v=p?Wh(e,u[t+1]):void 0;if(d!==v){let _=Cesium.clone(n,!0);s[o]&&(_.byteStride=d),_.byteOffset+=f,_.byteLength=m+g-f;let y=Cesium.addToArray(i,_);for(r=l;r<=t;++r)h=u[r],h.bufferView=y,h.byteOffset=h.byteOffset-f;f=p?u[t+1].byteOffset:void 0,l=t+1}}}Cesium.removeUnusedElements(e,["accessor","bufferView","buffer"])}function aw(e){Cesium.ForEach.accessorWithSemantic(e,"POSITION",function(t){let r=e.accessors[t];if(!Cesium.defined(r.min)||!Cesium.defined(r.max)){let n=Cesium.findAccessorMinMax(e,r);r.min=n.min,r.max=n.max}})}function Hg(e){return(!Cesium.defined(e.children)||e.children.length===0)&&(!Cesium.defined(e.meshes)||e.meshes.length===0)&&!Cesium.defined(e.camera)&&!Cesium.defined(e.skin)&&!Cesium.defined(e.skeletons)&&!Cesium.defined(e.jointName)&&(!Cesium.defined(e.translation)||Cesium.Cartesian3.fromArray(e.translation).equals(Cesium.Cartesian3.ZERO))&&(!Cesium.defined(e.scale)||Cesium.Cartesian3.fromArray(e.scale).equals(new Cesium.Cartesian3(1,1,1)))&&(!Cesium.defined(e.rotation)||Cesium.Cartesian4.fromArray(e.rotation).equals(new Cesium.Cartesian4(0,0,0,1)))&&(!Cesium.defined(e.matrix)||Cesium.Matrix4.fromColumnMajorArray(e.matrix).equals(Cesium.Matrix4.IDENTITY))&&!Cesium.defined(e.extensions)&&!Cesium.defined(e.extras)}function Wg(e,t){Cesium.ForEach.scene(e,function(r){let n=r.nodes;if(Cesium.defined(n)){let i=n.length;for(let s=i;s>=0;--s)if(n[s]===t){n.splice(s,1);return}}}),Cesium.ForEach.node(e,function(r,n){if(Cesium.defined(r.children)){let i=r.children.indexOf(t);i>-1&&(r.children.splice(i,1),Hg(r)&&Wg(e,n))}}),delete e.nodes[t]}function ow(e){return Cesium.ForEach.node(e,function(t,r){Hg(t)&&Wg(e,r)}),e}function uw(e){Cesium.ForEach.animation(e,function(t){Cesium.ForEach.animationSampler(t,function(r){let n=e.accessors[r.input];if(!Cesium.defined(n.min)||!Cesium.defined(n.max)){let i=Cesium.findAccessorMinMax(e,n);n.min=i.min,n.max=i.max}})})}function fw(e){e.asset=Cesium.defaultValue(e.asset,{}),e.asset.version="2.0",qg(e),H1(e),ow(e),W1(e),Y1(e),j1(e),Q1(e),iw(e),sw(e),aw(e),uw(e),Z1(e),J1(e),$1(e),rw(e),Cesium.updateAccessorComponentTypes(e),nw(e),Cesium.moveTechniqueRenderStates(e),Cesium.moveTechniquesToExtension(e),X1(e)}var Yh=V1;var lw={TERRAIN:0,IMAGERY:1,TILES3D:2,BIN:3,IMAGE:4,FILE:5},Xt=Object.freeze(lw);function H(){}H._maxTaskConcurrency=500;H.indexDbCache=new Cesium.AssociativeArray;H._saverTaskProcessor=void 0;H._loadTaskProcessor=void 0;H._getSaverTaskProcessor=function(){return Cesium.defined(H._saverTaskProcessor)||(H._saverTaskProcessor=new Cesium.TaskProcessor("indexDBSaveWorker",H._maxTaskConcurrency)),H._saverTaskProcessor};H._getLoadTaskProcessor=function(){return Cesium.defined(H._loadTaskProcessor)||(H._loadTaskProcessor=new Cesium.TaskProcessor("indexDBLoadWorker",H._maxTaskConcurrency)),H._loadTaskProcessor};function Ro(e){let t=e.data;if(Cesium.defined(t.workerType)){let r=H.indexDbCache.get(t.dataName);switch(t.workerType){case Xt.TERRAIN:case Xt.IMAGERY:if(Cesium.defined(r)){for(let n=0;n<r.length;n++)Cesium.defined(t.data)&&t.success?Cesium.defined(r[n])&&Cesium.defined(r[n].downloadSuccessFun)&&(r[n].data=t.data,r[n].level=t.level,r[n].x=t.x,r[n].y=t.y,r[n].upsample=t.upsample,r[n].downloadSuccessFun(r[n],t.data)):Cesium.defined(r[n].downloadErrorFun)&&r[n].downloadErrorFun(r[n]);H.indexDbCache.remove(t.dataName)}break;case Xt.TILES3D:if(Cesium.defined(r)){for(let n=0;n<r.length;n++)Cesium.defined(t.data)&&t.success?Cesium.defined(r[n])&&Cesium.defined(r[n].downloadSuccessFun)&&(r[n].meshPrimitives=t.meshPrimitives,r[n].downloadSuccessFun(r[n],t.data)):Cesium.defined(r[n].downloadErrorFun)&&r[n].downloadErrorFun(r[n]);H.indexDbCache.remove(t.dataName)}break;case Xt.BIN:if(Cesium.defined(r)){for(let n=0;n<r.length;n++)Cesium.defined(t.data)&&t.success?Cesium.defined(r[n])&&Cesium.defined(r[n].downloadSuccessFun)&&r[n].downloadSuccessFun(t.data):Cesium.defined(r[n].downloadErrorFun)&&r[n].downloadErrorFun(r[n]);H.indexDbCache.remove(t.dataName)}break;case Xt.IMAGE:if(Cesium.defined(r)){for(let n=0;n<r.length;n++)Cesium.defined(t.data)&&t.success?Cesium.defined(r[n])&&Cesium.defined(r[n].downloadSuccessFun)&&r[n].downloadSuccessFun(r[n],t.data):Cesium.defined(r[n].downloadErrorFun)&&r[n].downloadErrorFun(r[n]);H.indexDbCache.remove(t.dataName)}break;case Xt.FILE:if(Cesium.defined(r)){for(let n=0;n<r.length;n++)Cesium.defined(t.data)&&t.success?Cesium.defined(r[n])&&Cesium.defined(r[n].downloadSuccessFun)&&r[n].downloadSuccessFun(t.data):Cesium.defined(r[n].downloadErrorFun)&&r[n].downloadErrorFun(r[n]);H.indexDbCache.remove(t.dataName)}break}Yg(H._loadTaskProcessor,t.workerTaskID)}}function Oo(e){let t=e.data;if(Cesium.defined(t.workerType)){let r=`save_${t.dataName}`,n=H.indexDbCache.get(r);switch(t.workerType){case Xt.TERRAIN:if(n){for(let i=0;i<n.length;i++)n[i]&&n[i]();H.indexDbCache.remove(r)}break;case Xt.TILES3D:H.indexDbCache.remove(r);break;case Xt.BIN:H.indexDbCache.remove(r);break;case Xt.IMAGE:H.indexDbCache.remove(r);break;case Xt.FILE:H.indexDbCache.remove(r);break}Yg(H._saverTaskProcessor,t.workerTaskID)}}H.saveCesium3DTile=function(e){if(!Cesium.defined(H._saverTaskProcessor))return H._getSaverTaskProcessor(),!1;let t=`save_${e.keyName}`;if(H.indexDbCache.contains(t))return H.indexDbCache.get(t).push(e),!0;let r=H._saverTaskProcessor.scheduleTask({taskData:{keyName:e.keyName,data:e.data,meshPrimitives:Cesium.defined(e.meshPrimitives)?e.meshPrimitives:[],workerType:Xt.TILES3D}});if(Cesium.defined(r))H._saverTaskProcessor._worker.onmessage.name!=="onSaveMessage"&&(H._saverTaskProcessor._worker.onmessage=Oo);else return!1;return!0};H.loadCesium3DTile=function(e){if(!Cesium.defined(H._loadTaskProcessor))return H._getLoadTaskProcessor(),!1;if(H.indexDbCache.contains(e.keyName))return H.indexDbCache.get(e.keyName).push(e),!0;let t=H._loadTaskProcessor.scheduleTask({taskData:{keyName:e.keyName,data:void 0,workerType:Xt.TILES3D}});if(Cesium.defined(t))H.indexDbCache.set(e.keyName,[e]),H._loadTaskProcessor._worker.onmessage.name!=="onLoadMessage"&&(H._loadTaskProcessor._worker.onmessage=Ro);else return!1;return!0};H.saveGltfBin=function(e){if(!Cesium.defined(H._saverTaskProcessor))return H._getSaverTaskProcessor(),!1;let t=`save_${e.keyName}`;if(H.indexDbCache.contains(t))return H.indexDbCache.get(t).push(e),!0;let r=H._saverTaskProcessor.scheduleTask({taskData:{keyName:e.keyName,data:e.data,workerType:Xt.BIN}});if(H.indexDbCache.set(t,[e]),Cesium.defined(r))H._saverTaskProcessor._worker.onmessage.name!=="onSaveMessage"&&(H._saverTaskProcessor._worker.onmessage=Oo);else return!1;return!0};H.loadGltfBin=function(e){if(!Cesium.defined(H._loadTaskProcessor))return H._getLoadTaskProcessor(),!1;if(H.indexDbCache.contains(e.keyName))return H.indexDbCache.get(e.keyName).push(e),!0;let t=H._loadTaskProcessor.scheduleTask({taskData:{keyName:e.keyName,workerType:Xt.BIN,data:void 0}});if(Cesium.defined(t))H.indexDbCache.set(e.keyName,[e]),this._loadTaskProcessor._worker.onmessage.name!=="onLoadMessage"&&(this._loadTaskProcessor._worker.onmessage=Ro);else return!1;return!0};H.saveDEM=function(e){if(!Cesium.defined(H._saverTaskProcessor))return H._getSaverTaskProcessor(),!1;let t=`save_${e.keyName}`;if(H.indexDbCache.contains(t))return H.indexDbCache.get(t).push(e.callbackFun),!0;let r=H._saverTaskProcessor.scheduleTask({taskData:{keyName:e.keyName,level:e.level,x:e.x,y:e.y,data:e.data,upsample:e.upsample,workerType:Xt.TERRAIN}});if(H.indexDbCache.set(t,[e.callbackFun]),Cesium.defined(r))H._saverTaskProcessor._worker.onmessage.name!=="onSaveMessage"&&(H._saverTaskProcessor._worker.onmessage=Oo);else return!1;return!0};H.loadDEM=function(e){if(!Cesium.defined(H._loadTaskProcessor))return H._getLoadTaskProcessor(),!1;if(H.indexDbCache.contains(e.keyName))return H.indexDbCache.get(e.keyName).push(e),!1;let t=H._loadTaskProcessor.scheduleTask({taskData:{keyName:e.keyName,workerType:Xt.TERRAIN,data:void 0}});if(Cesium.defined(t))H.indexDbCache.set(e.keyName,[e]),this._loadTaskProcessor._worker.onmessage.name!=="onLoadMessage"&&(this._loadTaskProcessor._worker.onmessage=Ro);else return!1;return!0};H.saveImagery=function(e,t){if(!Cesium.defined(H._saverTaskProcessor))return H._getSaverTaskProcessor(),!1;let r=H._saverTaskProcessor.scheduleTask({taskData:{keyName:e.keyName,level:e.level,x:e.x,y:e.y,data:e.data,upsample:e.upsample,workerType:Xt.IMAGERY}});if(Cesium.defined(r))H._saverTaskProcessor._worker.onmessage.name!=="onSaveMessage"&&(H._saverTaskProcessor._worker.onmessage=Oo);else return!1;return!0};H.loadImagery=function(e){if(!Cesium.defined(H._loadTaskProcessor))return H._getLoadTaskProcessor(),!1;if(H.indexDbCache.contains(e.keyName))return H.indexDbCache.get(e.keyName).push(e),!1;let t=H._loadTaskProcessor.scheduleTask({taskData:{keyName:e.keyName,workerType:Xt.IMAGERY,data:void 0}});if(Cesium.defined(t))H.indexDbCache.set(e.keyName,[e]),this._loadTaskProcessor._worker.onmessage.name!=="onLoadMessage"&&(this._loadTaskProcessor._worker.onmessage=Ro);else return!1;return!0};H.saveFile=function(e){if(!Cesium.defined(H._saverTaskProcessor))return H._getSaverTaskProcessor(),!1;let t=`save_${e.keyName}`;if(H.indexDbCache.contains(t))return H.indexDbCache.get(t).push(e),!0;let r=H._saverTaskProcessor.scheduleTask({taskData:{keyName:e.keyName,data:e.data,workerType:Xt.FILE}});if(H.indexDbCache.set(t,[e]),Cesium.defined(r))H._saverTaskProcessor._worker.onmessage.name!=="onSaveMessage"&&(H._saverTaskProcessor._worker.onmessage=Oo);else return!1;return!0};H.loadFile=function(e){if(!Cesium.defined(H._loadTaskProcessor))return H._getLoadTaskProcessor(),!1;if(H.indexDbCache.contains(e.keyName))return H.indexDbCache.get(e.keyName).push(e),!0;let t=H._loadTaskProcessor.scheduleTask({taskData:{keyName:e.keyName,workerType:Xt.FILE,data:void 0}});if(Cesium.defined(t))H.indexDbCache.set(e.keyName,[e]),this._loadTaskProcessor._worker.onmessage.name!=="onLoadMessage"&&(this._loadTaskProcessor._worker.onmessage=Ro);else return!1;return!0};H.saveImage=function(e){if(!Cesium.defined(H._saverTaskProcessor))return H._getSaverTaskProcessor(),!1;let t=`save_${e.keyName}`;if(H.indexDbCache.contains(t))return H.indexDbCache.get(t).push(e),!0;let r=H._saverTaskProcessor.scheduleTask({taskData:{keyName:e.keyName,data:e.data,workerType:Xt.IMAGE}});if(H.indexDbCache.set(t,[e]),Cesium.defined(r))H._saverTaskProcessor._worker.onmessage.name!=="onSaveMessage"&&(H._saverTaskProcessor._worker.onmessage=Oo);else return!1;return!0};H.loadImage=function(e){if(!Cesium.defined(H._loadTaskProcessor))return H._getLoadTaskProcessor(),!1;if(H.indexDbCache.contains(e.keyName))return H.indexDbCache.get(e.keyName).push(e),!0;let t=H._loadTaskProcessor.scheduleTask({taskData:{keyName:e.keyName,workerType:Xt.IMAGE,data:void 0}});if(Cesium.defined(t))H.indexDbCache.set(e.keyName,[e]),this._loadTaskProcessor._worker.onmessage.name!=="onLoadMessage"&&(this._loadTaskProcessor._worker.onmessage=Ro);else return!1;return!0};function Yg(e,t){if(--e._activeTasks,!Cesium.defined(t))return;let r=e._deferreds,n=r[t];Cesium.defined(n)&&delete r[t]}var Ts=H;function Xg(e,t,r){this.primitive=e,this._modelMatrix=Cesium.Matrix4.clone(t),this._instanceId=r}Object.defineProperties(Xg.prototype,{instanceId:{get:function(){return this._instanceId}},model:{get:function(){return this.primitive._model}},modelMatrix:{get:function(){return Cesium.Matrix4.clone(this._modelMatrix)},set:function(e){Cesium.Matrix4.clone(e,this._modelMatrix),this.primitive.expandBoundingSphere(this._modelMatrix),this.primitive._dirty=!0}}});var Xh=Xg;var qa={NEEDS_LOAD:0,LOADING:1,LOADED:2,FAILED:3};function Fo(e){e=Cesium.defaultValue(e,Cesium.defaultValue.EMPTY_OBJECT),this.show=Cesium.defaultValue(e.show,!0),this._instancingSupported=!1,this._dynamic=Cesium.defaultValue(e.dynamic,!1),this._allowPicking=Cesium.defaultValue(e.allowPicking,!0),this._ready=!1,this._readyPromise=Ne.defer(),this._state=qa.NEEDS_LOAD,this._dirty=!1,this._cull=Cesium.defaultValue(e.cull,!0),this._opaquePass=Cesium.defaultValue(e.opaquePass,Cesium.Pass.OPAQUE),this._instances=cw(this,e.instances),this._batchTable=e.batchTable,this._model=void 0,this._vertexBufferTypedArray=void 0,this._vertexBuffer=void 0,this._batchIdBuffer=void 0,this._instancedUniformsByProgram=void 0,this._drawCommands=[],this._modelCommands=void 0,this._boundingSphere=hw(this),this._center=Cesium.Cartesian3.clone(this._boundingSphere.center),this._rtcTransform=new Cesium.Matrix4,this._rtcModelView=new Cesium.Matrix4,this._mode=void 0,this.modelMatrix=Cesium.Matrix4.clone(Cesium.Matrix4.IDENTITY),this._modelMatrix=Cesium.Matrix4.clone(this.modelMatrix),this._url=Cesium.Resource.createIfNeeded(e.url),this._requestType=e.requestType,this._gltf=e.gltf,this._basePath=Cesium.Resource.createIfNeeded(e.basePath),this._asynchronous=e.asynchronous,this._incrementallyLoadTextures=e.incrementallyLoadTextures,this._upAxis=e.upAxis,this._forwardAxis=e.forwardAxis,this.shadows=Cesium.defaultValue(e.shadows,Cesium.ShadowMode.ENABLED),this._shadows=this.shadows,this._pickIdLoaded=e.pickIdLoaded,this.debugShowBoundingVolume=Cesium.defaultValue(e.debugShowBoundingVolume,!1),this._debugShowBoundingVolume=!1,this.debugWireframe=Cesium.defaultValue(e.debugWireframe,!1),this._debugWireframe=!1,this._imageBasedLightingFactor=new Cesium.Cartesian2(1,1),Cesium.Cartesian2.clone(e.imageBasedLightingFactor,this._imageBasedLightingFactor),this.lightColor=e.lightColor,this.luminanceAtZenith=e.luminanceAtZenith,this.sphericalHarmonicCoefficients=e.sphericalHarmonicCoefficients,this.specularEnvironmentMaps=e.specularEnvironmentMaps,this.modelMeshPrimitives=[],this.content=Cesium.defaultValue(e.content,void 0),this.specular=e.specular,this.rollerRegion=e.rollerRegion}Object.defineProperties(Fo.prototype,{allowPicking:{get:function(){return this._allowPicking}},length:{get:function(){return this._instances.length}},activeAnimations:{get:function(){return this._model.activeAnimations}},ready:{get:function(){return this._ready}},readyPromise:{get:function(){return this._readyPromise.promise}},imageBasedLightingFactor:{get:function(){return this._imageBasedLightingFactor},set:function(e){Cesium.Cartesian2.clone(e,this._imageBasedLightingFactor)}}});function cw(e,t){t=Cesium.defaultValue(t,[]);for(var r=t.length,n=new Array(r),i=0;i<r;++i){var s=t[i],a=s.modelMatrix,o=Cesium.defaultValue(s.batchId,i);n[i]=new Xh(e,a,o)}return n}function hw(e){for(var t=e.length,r=new Array(t),n=0;n<t;++n)r[n]=Cesium.Matrix4.getTranslation(e._instances[n]._modelMatrix,new Cesium.Cartesian3);return Cesium.BoundingSphere.fromPoints(r)}var dw=new Cesium.Cartesian3,jh=new Cesium.Matrix4;Fo.prototype.expandBoundingSphere=function(e){var t=Cesium.Matrix4.getTranslation(e,dw);Cesium.BoundingSphere.expand(this._boundingSphere,t,this._boundingSphere)};function mw(e,t,r,n){return function(i,s){var a=i.semantic;if(Cesium.defined(a)&&e.indexOf(a)>-1)if(t.indexOf(a)>-1)n[s]=a;else throw new Cesium.RuntimeError('Shader program cannot be optimized for instancing. Uniform "'+s+'" in program "'+r+'" uses unsupported semantic "'+a+'"')}}function Kg(e,t){if(Cesium.defined(e._instancedUniformsByProgram))return e._instancedUniformsByProgram[t];var r={};e._instancedUniformsByProgram=r;var n=["MODEL","MODELVIEW","CESIUM_RTC_MODELVIEW","MODELVIEWPROJECTION","MODELINVERSE","MODELVIEWINVERSE","MODELVIEWPROJECTIONINVERSE","MODELINVERSETRANSPOSE","MODELVIEWINVERSETRANSPOSE"],i=["MODELVIEW","CESIUM_RTC_MODELVIEW","MODELVIEWPROJECTION","MODELVIEWINVERSETRANSPOSE"],s=e._model._sourceTechniques;for(var a in s)if(s.hasOwnProperty(a)){var o=s[a],u=o.program;if(!Cesium.defined(r[u])){var f={};r[u]=f,Cesium.ForEach.techniqueUniform(o,mw(n,i,t,f))}}return r[t]}function pw(e){return function(t,r){var n=Kg(e,r),i=Cesium.defined(e._batchTable),s=Cesium.ShaderSource.replaceMain(t,"czm_instancing_main"),a="",o="";for(var u in n)if(n.hasOwnProperty(u)){var f=n[u],l;f==="MODELVIEW"||f==="CESIUM_RTC_MODELVIEW"?l="czm_instanced_modelView":f==="MODELVIEWPROJECTION"?(l="czm_instanced_modelViewProjection",a+=`mat4 czm_instanced_modelViewProjection;
`,o+=`czm_instanced_modelViewProjection = czm_projection * czm_instanced_modelView;
`):f==="MODELVIEWINVERSETRANSPOSE"&&(l="czm_instanced_modelViewInverseTranspose",a+=`mat3 czm_instanced_modelViewInverseTranspose;
`,o+=`czm_instanced_modelViewInverseTranspose = mat3(czm_instanced_modelView);
`);var c=new RegExp("uniform.*"+u+".*");s=s.replace(c,""),c=new RegExp(u+"\\b","g"),s=s.replace(c,l)}var h=`uniform mat4 czm_instanced_modifiedModelView;
uniform mat4 czm_instanced_nodeTransform;
uniform mat4 czm_instanced_modelMatrix;
uniform mat4 czm_instanced_inverseModelMatrix;
`,d,m,g;i?(d=`attribute float a_batchId;
`,m="",g=""):(d="",m=`attribute vec4 pickColor;
varying vec4 v_pickColor;
`,g=`    v_pickColor = pickColor;
`);var p=h+a+`mat4 czm_instanced_modelView;
attribute vec4 czm_modelMatrixRow0;
attribute vec4 czm_modelMatrixRow1;
attribute vec4 czm_modelMatrixRow2;
`+d+m+s+`void main()
{
    mat4 czm_instanced_model = mat4(czm_modelMatrixRow0.x, czm_modelMatrixRow1.x, czm_modelMatrixRow2.x, 0.0, czm_modelMatrixRow0.y, czm_modelMatrixRow1.y, czm_modelMatrixRow2.y, 0.0, czm_modelMatrixRow0.z, czm_modelMatrixRow1.z, czm_modelMatrixRow2.z, 0.0, czm_modelMatrixRow0.w, czm_modelMatrixRow1.w, czm_modelMatrixRow2.w, 1.0);
    czm_instanced_modelView = czm_instanced_modifiedModelView * czm_instanced_model * czm_instanced_nodeTransform;
`+o+`    czm_instancing_main();
`+g+`}
`;if(i){var v=e._model.gltf,_=ee.getDiffuseAttributeOrUniform(v,r);p=e._batchTable.getVertexShaderCallback(!0,"a_batchId",_)(p)}return p}}function gw(e){return function(t,r){var n=e._batchTable;if(Cesium.defined(n)){var i=e._model.gltf,s=ee.getDiffuseAttributeOrUniform(i,r);t=n.getFragmentShaderCallback(!0,s)(t)}else t=`varying vec4 v_pickColor;
`+t;return t}}function vw(e,t){return function(){return Cesium.Matrix4.multiply(t.uniformState.view,e._rtcTransform,e._rtcModelView)}}function _w(e){return function(){return e.computedMatrix}}function Cw(e){return function(){return e._rtcTransform}}function yw(e){return function(){return Cesium.Matrix4.inverse(e._rtcTransform,new Cesium.Matrix4)}}function xw(e,t){return function(r,n,i){r=Cesium.clone(r),r.czm_instanced_modifiedModelView=vw(e,t),r.czm_instanced_nodeTransform=_w(i),r.czm_instanced_modelMatrix=Cw(e),r.czm_instanced_inverseModelMatrix=yw(e);var s=Kg(e,n);for(var a in s)s.hasOwnProperty(a)&&delete r[a];return Cesium.defined(e._batchTable)&&(r=e._batchTable.getUniformMapCallback()(r)),r}}function Ew(e){return function(t,r){if(Cesium.defined(e._batchTable)){var n=e._model.gltf,i=ee.getDiffuseAttributeOrUniform(n,r);t=e._batchTable.getVertexShaderCallback(!0,"a_batchId",i)(t),t=`uniform float a_batchId
;`+t}return t}}function bw(e){return function(t,r){var n=e._batchTable;if(Cesium.defined(n)){var i=e._model.gltf,s=ee.getDiffuseAttributeOrUniform(i,r);t=n.getFragmentShaderCallback(!0,s)(t)}else t=`uniform vec4 czm_pickColor;
`+t;return t}}function ww(e){return function(t){return Cesium.defined(e._batchTable)&&(t=e._batchTable.getUniformMapCallback()(t)),t}}function Qg(e){var t=e._instances,r=e.length,n=e._center,i=12,s=e._vertexBufferTypedArray;Cesium.defined(s)||(s=new Float32Array(r*i)),e._dynamic&&(e._vertexBufferTypedArray=s);for(var a=0;a<r;++a){var o=t[a]._modelMatrix,u=Cesium.Matrix4.clone(o,jh);u[12]-=n.x,u[13]-=n.y,u[14]-=n.z;var f=a*i;s[f+0]=u[0],s[f+1]=u[4],s[f+2]=u[8],s[f+3]=u[12],s[f+4]=u[1],s[f+5]=u[5],s[f+6]=u[9],s[f+7]=u[13],s[f+8]=u[2],s[f+9]=u[6],s[f+10]=u[10],s[f+11]=u[14]}return s}function Sw(e,t){var r,n=e._instances,i=e.length,s=e._dynamic,a=Cesium.defined(e._batchTable);if(a){var o=new Uint16Array(i);for(r=0;r<i;++r)o[r]=n[r]._instanceId;e._batchIdBuffer=Cesium.Buffer.createVertexBuffer({context:t,typedArray:o,usage:Cesium.BufferUsage.STATIC_DRAW})}if(!a){var u=new Uint8Array(i*4);for(r=0;r<i;++r){var f=e._pickIds[r],l=f.color,c=r*4;u[c]=Cesium.Color.floatToByte(l.red),u[c+1]=Cesium.Color.floatToByte(l.green),u[c+2]=Cesium.Color.floatToByte(l.blue),u[c+3]=Cesium.Color.floatToByte(l.alpha)}e._pickIdBuffer=Cesium.Buffer.createVertexBuffer({context:t,typedArray:u,usage:Cesium.BufferUsage.STATIC_DRAW})}var h=Qg(e);e._vertexBuffer=Cesium.Buffer.createVertexBuffer({context:t,typedArray:h,usage:s?Cesium.BufferUsage.STREAM_DRAW:Cesium.BufferUsage.STATIC_DRAW})}function Tw(e){var t=Qg(e);e._vertexBuffer.copyFromArrayView(t)}function Iw(e,t){for(var r=e._instances,n=r.length,i=new Array(n),s=0;s<n;++s)i[s]=t.createPickId(r[s]);return i}function Lw(e,t){var r=e._instancingSupported,n=Cesium.defined(e._batchTable),i=e._allowPicking,s={url:e._url,requestType:e._requestType,gltf:e._gltf,basePath:e._basePath,shadows:e._shadows,cacheKey:void 0,asynchronous:e._asynchronous,allowPicking:i,incrementallyLoadTextures:e._incrementallyLoadTextures,upAxis:e._upAxis,forwardAxis:e._forwardAxis,precreatedAttributes:void 0,vertexShaderLoaded:void 0,fragmentShaderLoaded:void 0,uniformMapLoaded:void 0,pickIdLoaded:e._pickIdLoaded,ignoreCommands:!0,opaquePass:e._opaquePass,imageBasedLightingFactor:e.imageBasedLightingFactor,lightColor:e.lightColor,luminanceAtZenith:e.luminanceAtZenith,sphericalHarmonicCoefficients:e.sphericalHarmonicCoefficients,specularEnvironmentMaps:e.specularEnvironmentMaps,content:e.content,sharedResources:{instancedPrograms:{name:e.sharedResources.instancedPrograms.name,shadredData:e.sharedResources.instancedPrograms.shadredData},ktxs:e.sharedResources.ktxs},specular:e.specular,rollerRegion:e.rollerRegion};if(n||(e._pickIds=Iw(e,t)),r){Sw(e,t);var a=12,o=Cesium.ComponentDatatype.getSizeInBytes(Cesium.ComponentDatatype.FLOAT),u={czm_modelMatrixRow0:{index:0,vertexBuffer:e._vertexBuffer,componentsPerAttribute:4,componentDatatype:Cesium.ComponentDatatype.FLOAT,normalize:!1,offsetInBytes:0,strideInBytes:o*a,instanceDivisor:1},czm_modelMatrixRow1:{index:0,vertexBuffer:e._vertexBuffer,componentsPerAttribute:4,componentDatatype:Cesium.ComponentDatatype.FLOAT,normalize:!1,offsetInBytes:o*4,strideInBytes:o*a,instanceDivisor:1},czm_modelMatrixRow2:{index:0,vertexBuffer:e._vertexBuffer,componentsPerAttribute:4,componentDatatype:Cesium.ComponentDatatype.FLOAT,normalize:!1,offsetInBytes:o*8,strideInBytes:o*a,instanceDivisor:1}};n&&(u.a_batchId={index:0,vertexBuffer:e._batchIdBuffer,componentsPerAttribute:1,componentDatatype:Cesium.ComponentDatatype.UNSIGNED_SHORT,normalize:!1,offsetInBytes:0,strideInBytes:0,instanceDivisor:1}),n||(u.pickColor={index:0,vertexBuffer:e._pickIdBuffer,componentsPerAttribute:4,componentDatatype:Cesium.ComponentDatatype.UNSIGNED_BYTE,normalize:!0,offsetInBytes:0,strideInBytes:0,instanceDivisor:1}),s.precreatedAttributes=u,s.vertexShaderLoaded=pw(e),s.fragmentShaderLoaded=gw(e),s.uniformMapLoaded=xw(e,t),Cesium.defined(e._url)&&(s.cacheKey=e._url.getUrlComponent()+"#instanced")}else s.vertexShaderLoaded=Ew(e),s.fragmentShaderLoaded=bw(e),s.uniformMapLoaded=ww(e,t);Cesium.defined(e._url)?e._model=No.fromGltf(s):e._model=new No(s)}function Pw(e){if(e._debugWireframe!==e.debugWireframe){e._debugWireframe=e.debugWireframe;for(var t=e.debugWireframe?Cesium.PrimitiveType.LINES:Cesium.PrimitiveType.TRIANGLES,r=e._drawCommands,n=r.length,i=0;i<n;++i)r[i].primitiveType=t}}function Mw(e){if(e.debugShowBoundingVolume!==e._debugShowBoundingVolume){e._debugShowBoundingVolume=e.debugShowBoundingVolume;for(var t=e._drawCommands,r=t.length,n=0;n<r;++n)t[n].debugShowBoundingVolume=e.debugShowBoundingVolume}}function Aw(e,t){for(var r=t.length,n=e.length,i=e._boundingSphere,s=e._cull,a=0;a<r;++a){var o=Cesium.DrawCommand.shallowClone(t[a]);o.instanceCount=n,o.boundingVolume=i,o.cull=s,Cesium.defined(e._batchTable)?o.pickId=e._batchTable.getPickId():o.pickId="v_pickColor",e._drawCommands.push(o)}}function Dw(e){return function(){return e}}function Rw(e){return function(){return e}}function Ow(e,t){for(var r=e._instances,n=t.length,i=e.length,s=e._batchTable,a=Cesium.defined(s),o=e._cull,u=0;u<n;++u)for(var f=0;f<i;++f){var l=Cesium.DrawCommand.shallowClone(t[u]);if(l.modelMatrix=new Cesium.Matrix4,l.boundingVolume=new Cesium.BoundingSphere,l.cull=o,l.uniformMap=Cesium.clone(l.uniformMap),a)l.uniformMap.a_batchId=Dw(r[f]._instanceId);else{var c=e._pickIds[f];l.uniformMap.czm_pickColor=Rw(c.color)}e._drawCommands.push(l)}}function Zg(e){for(var t=e._modelCommands,r=t.length,n=e.length,i=e._rtcTransform,s=e._center,a=0;a<r;++a)for(var o=t[a],u=0;u<n;++u){var f=a*n+u,l=e._drawCommands[f],c=Cesium.Matrix4.clone(e._instances[u]._modelMatrix,jh);c[12]-=s.x,c[13]-=s.y,c[14]-=s.z,c=Cesium.Matrix4.multiply(i,c,jh);var h=o.modelMatrix,d=l.modelMatrix;Cesium.Matrix4.multiply(c,h,d);var m=o.boundingVolume,g=l.boundingVolume;Cesium.BoundingSphere.transform(m,c,g)}}function Jg(e){for(var t=e._nodeCommands,r=t.length,n=[],i=0;i<r;++i){var s=t[i];s.show&&n.push(s.command)}return n}function Nw(e){for(var t=e._nodeCommands,r=t.length,n=0;n<r;n++){var i=t[n];if(i.command.dirty)return!0}return!1}function jg(e,t){e._drawCommands=[];var r=Jg(e._model);t?Aw(e,r):(Ow(e,r),Zg(e))}function Fw(e){if(e.shadows!==e._shadows){e._shadows=e.shadows;for(var t=Cesium.ShadowMode.castShadows(e.shadows),r=Cesium.ShadowMode.receiveShadows(e.shadows),n=e._drawCommands,i=n.length,s=0;s<i;++s){var a=n[s];a.castShadows=t,a.receiveShadows=r}}}Fo.prototype.update=function(e){if(e.mode!==Cesium.SceneMode.MORPHING&&this.show&&this.length!==0){var t=e.context;if(this._state===qa.NEEDS_LOAD){this._state=qa.LOADING,this._instancingSupported=t.instancedArrays,Lw(this,t),this._model._meshPrimitives=this.modelMeshPrimitives;var r=this;this._model.readyPromise.otherwise(function(g){r._state=qa.FAILED,r._readyPromise.reject(g)})}var n=this._instancingSupported,i=this._model;if(i.imageBasedLightingFactor=this.imageBasedLightingFactor,i.lightColor=this.lightColor,i.luminanceAtZenith=this.luminanceAtZenith,i.sphericalHarmonicCoefficients=this.sphericalHarmonicCoefficients,i.specularEnvironmentMaps=this.specularEnvironmentMaps,i.ktxs=this.ktxs,i.gltfShader=this.gltfShader,i._tilesetFlat=this._tilesetFlat,i.update(e),i.ready&&this._state===qa.LOADING){this._state=qa.LOADED,this._ready=!0;var s=i.boundingSphere.radius+Cesium.Cartesian3.magnitude(i.boundingSphere.center);this._boundingSphere.radius+=s,this._modelCommands=Jg(i),jg(this,n),this._readyPromise.resolve(this);return}if(this._state===qa.LOADED){var a=e.mode!==this._mode,o=this.modelMatrix,u=!Cesium.Matrix4.equals(this._modelMatrix,o);if(a||u){this._mode=e.mode,Cesium.Matrix4.clone(o,this._modelMatrix);var f=Cesium.Matrix4.multiplyByTranslation(this._modelMatrix,this._center,this._rtcTransform);this._mode!==Cesium.SceneMode.SCENE3D&&(f=Cesium.Transforms.basisTo2D(e.mapProjection,f,f)),Cesium.Matrix4.getTranslation(f,this._boundingSphere.center)}n&&this._dirty&&(this._dynamic=!0,this._dirty=!1,Tw(this)),Nw(i)&&jg(this,n),!n&&(i.dirty||this._dirty||a||u)&&Zg(this),Fw(this),Pw(this),Mw(this);var l=e.passes;if(!(!l.render&&!l.pick))for(var c=e.commandList,h=this._drawCommands,d=h.length,m=0;m<d;++m)c.push(h[m])}}};Fo.prototype.isDestroyed=function(){return!1};Fo.prototype.destroy=function(){this._model=this._model&&this._model.destroy(),this.sharedResources.instancedPrograms=void 0,this.sharedResources.ktxs=void 0,this.gltfShader=void 0,this._gltf=void 0,this._instances.length=0;var e=this._pickIds;if(Cesium.defined(e))for(var t=e.length,r=0;r<t;++r)e[r].destroy();return Cesium.destroyObject(this)};var Kh=Fo;function ci(e,t,r,n,i){this._tileset=e,this._tile=t,this._resource=r,this._modelInstanceCollection=void 0,this._batchTable=void 0,this._features=void 0,this.featurePropertiesDirty=!1,Vw(this,n,i)}ci._deprecationWarning=Cesium.deprecationWarning;Object.defineProperties(ci.prototype,{featuresLength:{get:function(){return this._batchTable.featuresLength}},pointsLength:{get:function(){return 0}},trianglesLength:{get:function(){var e=this._modelInstanceCollection._model;return Cesium.defined(e)?e.trianglesLength:0}},geometryByteLength:{get:function(){var e=this._modelInstanceCollection._model;return Cesium.defined(e)?e.geometryByteLength:0}},texturesByteLength:{get:function(){var e=this._modelInstanceCollection._model;return Cesium.defined(e)?e.texturesByteLength:0}},batchTableByteLength:{get:function(){return this._batchTable.memorySizeInBytes}},innerContents:{get:function(){}},readyPromise:{get:function(){return this._modelInstanceCollection.readyPromise}},tileset:{get:function(){return this._tileset}},tile:{get:function(){return this._tile}},url:{get:function(){return this._resource.getUrlComponent(!0)}},batchTable:{get:function(){return this._batchTable}}});function Bw(e){return function(){return e._batchTable.getPickId()}}var ra=Uint32Array.BYTES_PER_ELEMENT,Vu=new Array(4),$g=new Array(4);function Vw(e,t,r){var n=Cesium.defaultValue(r,0);r=n;var i=new Uint8Array(t),s=new DataView(t);r+=ra;var a=s.getUint32(r,!0);if(a!==1)throw new Cesium.RuntimeError("Only Instanced 3D Model version 1 is supported. Version "+a+" is not.");r+=ra;var o=s.getUint32(r,!0);r+=ra;var u=s.getUint32(r,!0);if(u===0)throw new Cesium.RuntimeError("featureTableJsonByteLength is zero, the feature table must be defined.");r+=ra;var f=s.getUint32(r,!0);r+=ra;var l=s.getUint32(r,!0);r+=ra;var c=s.getUint32(r,!0);r+=ra;var h=s.getUint32(r,!0);if(h!==1&&h!==0)throw new Cesium.RuntimeError("Only glTF format 0 (uri) or 1 (embedded) are supported. Format "+h+" is not.");r+=ra;var d=Cesium.getStringFromTypedArray(i,r,u),m=JSON.parse(d);r+=u;var g=new Uint8Array(t,r,f);r+=f;var p=new ws(m,g),v=p.getGlobalProperty("INSTANCES_LENGTH");if(p.featuresLength=v,!Cesium.defined(v))throw new Cesium.RuntimeError("Feature table global property: INSTANCES_LENGTH must be defined");var _,y;if(l>0){var x=Cesium.getStringFromTypedArray(i,r,l);_=JSON.parse(x),r+=l,c>0&&(y=new Uint8Array(t,r,c),y=new Uint8Array(y),r+=c)}if(e._batchTable=new zr(e,v,_,y),Cesium.defined(e._tile._header.EVID))for(var E=e._batchTable.featuresLength,S=0;S<E;S++)e._batchTable.setProperty(S,"EVID",e._tile._header.EVID);var I=n+o-r;if(I===0)throw new Cesium.RuntimeError("glTF byte length is zero, i3dm must have a glTF to instance.");var P;r%4===0?P=new Uint8Array(t,r,I):(ci._deprecationWarning("i3dm-glb-unaligned","The embedded glb is not aligned to a 4-byte boundary."),P=new Uint8Array(i.subarray(r,r+I)));var w=e._tileset,N={instances:new Array(v),batchTable:e._batchTable,cull:!1,url:void 0,requestType:Cesium.RequestType.TILES3D,gltf:void 0,basePath:void 0,incrementallyLoadTextures:!1,upAxis:w._gltfUpAxis,forwardAxis:Cesium.Axis.X,opaquePass:Cesium.Pass.CESIUM_3D_TILE,pickIdLoaded:Bw(e),imageBasedLightingFactor:w.imageBasedLightingFactor,lightColor:w.lightColor,luminanceAtZenith:w.luminanceAtZenith,sphericalHarmonicCoefficients:w.sphericalHarmonicCoefficients,specularEnvironmentMaps:w.specularEnvironmentMaps,content:e,specular:w.specular,rollerRegion:w.rollerRegion};if(h===0){var B=Cesium.getStringFromTypedArray(P);B=B.replace(/[\s\0]+$/,""),N.url=e._resource.getDerivedResource({url:B})}else N.gltf=P,N.basePath=e._resource.clone();var C=p.getGlobalProperty("EAST_NORTH_UP"),b,T=p.getGlobalProperty("RTC_CENTER",Cesium.ComponentDatatype.FLOAT,3);Cesium.defined(T)&&(b=Cesium.Cartesian3.unpack(T));for(var A=N.instances,R=new Cesium.Cartesian3,F=new Array(3),D=new Cesium.Cartesian3,O=new Cesium.Cartesian3,U=new Cesium.Cartesian3,q=new Cesium.Matrix3,Y=new Cesium.Quaternion,W=new Cesium.Cartesian3,K=new Cesium.TranslationRotationScale,re=new Cesium.Matrix4,S=0;S<v;S++){var ce=p.getProperty("POSITION",Cesium.ComponentDatatype.FLOAT,3,S,Vu);if(!Cesium.defined(ce)){ce=F;var Se=p.getProperty("POSITION_QUANTIZED",Cesium.ComponentDatatype.UNSIGNED_SHORT,3,S,Vu);if(!Cesium.defined(Se))throw new Cesium.RuntimeError("Either POSITION or POSITION_QUANTIZED must be defined for each instance.");var de=p.getGlobalProperty("QUANTIZED_VOLUME_OFFSET",Cesium.ComponentDatatype.FLOAT,3);if(!Cesium.defined(de))throw new Cesium.RuntimeError("Global property: QUANTIZED_VOLUME_OFFSET must be defined for quantized positions.");var Ae=p.getGlobalProperty("QUANTIZED_VOLUME_SCALE",Cesium.ComponentDatatype.FLOAT,3);if(!Cesium.defined(Ae))throw new Cesium.RuntimeError("Global property: QUANTIZED_VOLUME_SCALE must be defined for quantized positions.");for(var ye=0;ye<3;ye++)ce[ye]=Se[ye]/65535*Ae[ye]+de[ye]}Cesium.Cartesian3.unpack(ce,0,R),Cesium.defined(b)&&Cesium.Cartesian3.add(R,b,R),K.translation=R;var Ie=p.getProperty("NORMAL_UP",Cesium.ComponentDatatype.FLOAT,3,S,Vu),$=p.getProperty("NORMAL_RIGHT",Cesium.ComponentDatatype.FLOAT,3,S,$g),De=!1;if(Cesium.defined(Ie)){if(!Cesium.defined($))throw new Cesium.RuntimeError("To define a custom orientation, both NORMAL_UP and NORMAL_RIGHT must be defined.");Cesium.Cartesian3.unpack(Ie,0,O),Cesium.Cartesian3.unpack($,0,D),De=!0}else{var se=p.getProperty("NORMAL_UP_OCT32P",Cesium.ComponentDatatype.UNSIGNED_SHORT,2,S,Vu),be=p.getProperty("NORMAL_RIGHT_OCT32P",Cesium.ComponentDatatype.UNSIGNED_SHORT,2,S,$g);if(Cesium.defined(se)){if(!Cesium.defined(be))throw new Cesium.RuntimeError("To define a custom orientation with oct-encoded vectors, both NORMAL_UP_OCT32P and NORMAL_RIGHT_OCT32P must be defined.");Cesium.AttributeCompression.octDecodeInRange(se[0],se[1],65535,O),Cesium.AttributeCompression.octDecodeInRange(be[0],be[1],65535,D),De=!0}else C?(Cesium.Transforms.eastNorthUpToFixedFrame(R,Cesium.Ellipsoid.WGS84,re),Cesium.Matrix4.getMatrix3(re,q)):Cesium.Matrix3.clone(Cesium.Matrix3.IDENTITY,q)}De&&(Cesium.Cartesian3.cross(D,O,U),Cesium.Cartesian3.normalize(U,U),Cesium.Matrix3.setColumn(q,0,D,q),Cesium.Matrix3.setColumn(q,1,O,q),Cesium.Matrix3.setColumn(q,2,U,q)),Cesium.Quaternion.fromRotationMatrix(q,Y),K.rotation=Y,W=Cesium.Cartesian3.fromElements(1,1,1,W);var lr=p.getProperty("SCALE",Cesium.ComponentDatatype.FLOAT,1,S);Cesium.defined(lr)&&Cesium.Cartesian3.multiplyByScalar(W,lr,W);var kt=p.getProperty("SCALE_NON_UNIFORM",Cesium.ComponentDatatype.FLOAT,3,S,Vu);Cesium.defined(kt)&&(W.x*=kt[0],W.y*=kt[1],W.z*=kt[2]),K.scale=W;var Br=p.getProperty("BATCH_ID",Cesium.ComponentDatatype.UNSIGNED_SHORT,1,S);Cesium.defined(Br)||(Br=S),Cesium.Matrix4.fromTranslationRotationScale(K,re);var fn=re.clone();A[S]={modelMatrix:fn,batchId:Br}}var en=N.gltf;if(Cesium.defined(en)&&(en instanceof ArrayBuffer&&(en=new Uint8Array(en)),en instanceof Uint8Array&&(N.gltf=Cesium.parseGlb(en)),Cesium.defined(N.gltf.asset)&&N.gltf.asset.version=="2.0")){var fi=e._batchTable,$i=!1,li={EVID:[],id:[],name:[]},xt=N.gltf.nodes;if(xt.length>0&&Cesium.defined(xt[0].instanceIndex)&&($i=!0),$i){for(var At=new Array(N.instances.length*xt.length),yn=0;yn<N.instances.length;yn++)for(var St=0;St<xt.length;St++)if(Cesium.defined(xt[St].matrix)&&Cesium.defined(xt[St].instanceIndex)){var Vr=Cesium.Matrix4.clone(xt[St].matrix,new Cesium.Matrix4);Vr[1]=-xt[St].matrix[2],Vr[2]=xt[St].matrix[1],Vr[4]=-xt[St].matrix[8],Vr[5]=xt[St].matrix[10],Vr[6]=-xt[St].matrix[9],Vr[8]=xt[St].matrix[4],Vr[9]=-xt[St].matrix[6],Vr[10]=xt[St].matrix[5],Vr[13]=-xt[St].matrix[14],Vr[14]=xt[St].matrix[13];var Js=Cesium.Matrix4.multiplyTransformation(N.instances[yn].modelMatrix,Vr,new Cesium.Matrix4);At[yn*xt.length+St]={modelMatrix:Js,batchId:yn*xt.length+St},Cesium.defined(fi._properties.EVID)?li.EVID.push(fi._properties.EVID[yn]):li.EVID.push(0),li.id.push(xt[St].instanceIndex),li.name.push(fi._properties.name[yn])}else throw new Cesium.DeveloperError("Instanced3DModel3DTileContent: nodes["+St+"].instanceIndex is empty");N.instances.length=0,N.instances=At;var v=N.instances.length;e._batchTable=new zr(e,v,li),N.batchTable=e._batchTable}}e._modelInstanceCollection=new Kh(N)}function zw(e){var t=e.featuresLength;if(!Cesium.defined(e._features)&&t>0){for(var r=new Array(t),n=0;n<t;++n)r[n]=new Rn(e,n);e._features=r}}ci.prototype.hasProperty=function(e,t){return this._batchTable.hasProperty(e,t)};ci.prototype.getFeature=function(e){var t=this.featuresLength;return zw(this),this._features[e]};ci.prototype.applyDebugSettings=function(e,t){t=e?t:Cesium.Color.WHITE,this._batchTable.setAllColor(t)};ci.prototype.applyStyle=function(e){this._batchTable.applyStyle(e)};ci.prototype.update=function(e,t){var r=t.commandList.length;this._batchTable.update(e,t),this._modelInstanceCollection.modelMatrix=this._tile.computedTransform,this._modelInstanceCollection.shadows=this._tileset.shadows,this._modelInstanceCollection.lightColor=this._tileset.lightColor,this._modelInstanceCollection.luminanceAtZenith=this._tileset.luminanceAtZenith,this._modelInstanceCollection.sphericalHarmonicCoefficients=this._tileset.sphericalHarmonicCoefficients,this._modelInstanceCollection.specularEnvironmentMaps=this._tileset.specularEnvironmentMaps,this._modelInstanceCollection.debugWireframe=this._tileset.debugWireframe,this._modelInstanceCollection._tilesetFlat=this._tileset._tilesetFlat,this._modelInstanceCollection.sharedResources={instancedPrograms:{name:this.tile.sharedResources.instancedPrograms.name,shadredData:this.tile.sharedResources.instancedPrograms.shadredData},ktxs:this.tile.sharedResources.ktxs},this._modelInstanceCollection.gltfShader=this._tileset.gltfShader;var n=this._modelInstanceCollection._model;if(Cesium.defined(n)){n.useIndexedDBCache=this._tileset.useIndexedDBCache;var i=this._tileset.clippingPlanes;n.clippingPlanesOriginMatrix=this._tileset.clippingPlanesOriginMatrix,Cesium.defined(i)&&this._tile.clippingPlanesDirty&&(n._clippingPlanes=i.enabled&&this._tile._isClipped?i:void 0),Cesium.defined(i)&&Cesium.defined(n._clippingPlanes)&&n._clippingPlanes!==i&&(n._clippingPlanes=i)}this._modelInstanceCollection.update(t);var s=t.commandList.length;r<s&&(t.passes.render||t.passes.pick)&&this._batchTable.addDerivedCommands(t,r,!1)};ci.prototype.isDestroyed=function(){return!1};ci.prototype.destroy=function(){return this._modelInstanceCollection=this._modelInstanceCollection&&this._modelInstanceCollection.destroy(),this._batchTable=this._batchTable&&this._batchTable.destroy(),Cesium.destroyObject(this)};ci.prototype.instanced3DModel3DTileContent=!0;var zu=ci;var kw=new Cesium.Cartesian3,na=ee.ModelState,Uw="model/gltf-binary,model/gltf+json;q=0.8,application/json;q=0.2,*/*;q=0.01",Gw=Cesium.Math.EPSILON16;function rd(e,t){e._cachedGltf=t}function Uu(e){this._gltf=e.gltf,this.ready=e.ready,this.modelsToLoad=[],this.count=0}Object.defineProperties(Uu.prototype,{gltf:{set:function(e){this._gltf=e},get:function(){return this._gltf}}});Uu.prototype.makeReady=function(e){this.gltf=e;for(var t=this.modelsToLoad,r=t.length,n=0;n<r;++n){var i=t[n];i.isDestroyed()||rd(i,this)}this.modelsToLoad=void 0,this.ready=!0};var sa={},ev={};function Ur(e){e=Cesium.defaultValue(e,Cesium.defaultValue.EMPTY_OBJECT);var t=e.cacheKey;this._cacheKey=t,this._cachedGltf=void 0,this._releaseGltfJson=Cesium.defaultValue(e.releaseGltfJson,!1);var r;if(Cesium.defined(t)&&Cesium.defined(sa[t])&&sa[t].ready)r=sa[t],++r.count;else{var n=e.gltf;if(Cesium.defined(n)){if(n instanceof ArrayBuffer&&(n=new Uint8Array(n)),n instanceof Uint8Array){var i=Cesium.parseGlb(n);Cesium.defined(e.imagesSourceBuf)&&(i=bT(i,e.imagesSourceBuf)),r=new Uu({gltf:i,ready:!0})}else r=new Uu({gltf:e.gltf,ready:!0});r.count=1,Cesium.defined(t)&&(sa[t]=r)}}rd(this,r);var s=Cesium.defaultValue(e.basePath,"");this._resource=Cesium.Resource.createIfNeeded(s);var a=e.credit;typeof a=="string"&&(a=new Cesium.Credit(a)),this._credit=a,this._resourceCredits=[],this.show=Cesium.defaultValue(e.show,!0),this.silhouetteColor=Cesium.defaultValue(e.silhouetteColor,Cesium.Color.RED),this._silhouetteColor=new Cesium.Color,this._silhouetteColorPreviousAlpha=1,this._normalAttributeName=void 0,this.silhouetteSize=Cesium.defaultValue(e.silhouetteSize,0),this.modelMatrix=Cesium.Matrix4.clone(Cesium.defaultValue(e.modelMatrix,Cesium.Matrix4.IDENTITY)),this._modelMatrix=Cesium.Matrix4.clone(this.modelMatrix),this._clampedModelMatrix=void 0,this.scale=Cesium.defaultValue(e.scale,1),this._scale=this.scale,this.minimumPixelSize=Cesium.defaultValue(e.minimumPixelSize,0),this._minimumPixelSize=this.minimumPixelSize,this.maximumScale=e.maximumScale,this._maximumScale=this.maximumScale,this.id=e.id,this._id=e.id,this.heightReference=Cesium.defaultValue(e.heightReference,Cesium.HeightReference.NONE),this._heightReference=this.heightReference,this._heightChanged=!1,this._removeUpdateHeightCallback=void 0;var o=e.scene;this._scene=o,Cesium.defined(o)&&Cesium.defined(o.terrainProviderChanged)&&(this._terrainProviderChangedCallback=o.terrainProviderChanged.addEventListener(function(){this._heightChanged=!0},this)),this._pickObject=e.pickObject,this._allowPicking=Cesium.defaultValue(e.allowPicking,!0),this._ready=!1,this._readyPromise=Ne.defer(),this.activeAnimations=new Cesium.ModelAnimationCollection(this),this.clampAnimations=Cesium.defaultValue(e.clampAnimations,!0),this._defaultTexture=void 0,this._incrementallyLoadTextures=Cesium.defaultValue(e.incrementallyLoadTextures,!0),this._asynchronous=Cesium.defaultValue(e.asynchronous,!0),this.shadows=Cesium.defaultValue(e.shadows,Cesium.ShadowMode.ENABLED),this._shadows=this.shadows,this.color=Cesium.Color.clone(Cesium.defaultValue(e.color,Cesium.Color.WHITE)),this._colorPreviousAlpha=1,this.colorBlendMode=Cesium.defaultValue(e.colorBlendMode,Cesium.ColorBlendMode.HIGHLIGHT),this.colorBlendAmount=Cesium.defaultValue(e.colorBlendAmount,.5),this._colorShadingEnabled=!1,this._clippingPlanes=void 0,this.clippingPlanes=e.clippingPlanes,this._clippingPlanesState=0,this.clippingPlanesOriginMatrix=void 0,this.debugShowBoundingVolume=Cesium.defaultValue(e.debugShowBoundingVolume,!1),this._debugShowBoundingVolume=!1,this.debugWireframe=Cesium.defaultValue(e.debugWireframe,!1),this._debugWireframe=!1,this._distanceDisplayCondition=e.distanceDisplayCondition,this._addBatchIdToGeneratedShaders=e.addBatchIdToGeneratedShaders,this._precreatedAttributes=e.precreatedAttributes,this._vertexShaderLoaded=e.vertexShaderLoaded,this._fragmentShaderLoaded=e.fragmentShaderLoaded,this._uniformMapLoaded=e.uniformMapLoaded,this._pickIdLoaded=e.pickIdLoaded,this._ignoreCommands=Cesium.defaultValue(e.ignoreCommands,!1),this._requestType=e.requestType,this._upAxis=Cesium.defaultValue(e.upAxis,Cesium.Axis.Y),this._gltfForwardAxis=Cesium.Axis.Z,this._forwardAxis=e.forwardAxis,this._gradual=e.gradual,this._update=!1,this.cull=Cesium.defaultValue(e.cull,!0),this.opaquePass=Cesium.defaultValue(e.opaquePass,Cesium.Pass.OPAQUE),this._computedModelMatrix=new Cesium.Matrix4,this._clippingPlaneModelViewMatrix=Cesium.Matrix4.clone(Cesium.Matrix4.IDENTITY),this._initialRadius=void 0,this._boundingSphere=void 0,this._scaledBoundingSphere=new Cesium.BoundingSphere,this._state=na.NEEDS_LOAD,this._loadResources=void 0,this._mode=void 0,this._perNodeShowDirty=!1,this._cesiumAnimationsDirty=!1,this._dirty=!1,this._maxDirtyNumber=0,this._runtime={animations:void 0,articulationsByName:void 0,articulationsByStageKey:void 0,stagesByKey:void 0,rootNodes:void 0,nodes:void 0,nodesByName:void 0,skinnedNodes:void 0,meshesByName:void 0,materialsByName:void 0,materialsById:void 0},this._uniformMaps={},this._extensionsUsed=void 0,this._extensionsRequired=void 0,this._quantizedUniforms={},this._programPrimitives={},this._rendererResources={buffers:{},vertexArrays:{},programs:{},sourceShaders:{},silhouettePrograms:{},textures:{},samplers:{},renderStates:{}},this._cachedRendererResources=void 0,this._loadRendererResourcesFromCache=!1,this._dequantizeInShader=Cesium.defaultValue(e.dequantizeInShader,!0),this._decodedData={},this._cachedGeometryByteLength=0,this._cachedTexturesByteLength=0,this._geometryByteLength=0,this._texturesByteLength=0,this._trianglesLength=0,this._sourceTechniques={},this._sourcePrograms={},this._quantizedVertexShaders={},this._nodeCommands=[],this._pickIds=[],this._rtcCenter=void 0,this._rtcCenterEye=void 0,this._rtcCenter3D=void 0,this._rtcCenter2D=void 0,this._sourceVersion=void 0,this._sourceKHRTechniquesWebGL=void 0,this._imageBasedLightingFactor=new Cesium.Cartesian2(1,1),Cesium.Cartesian2.clone(e.imageBasedLightingFactor,this._imageBasedLightingFactor),this._lightColor=Cesium.Cartesian3.clone(e.lightColor),this._luminanceAtZenith=void 0,this.luminanceAtZenith=Cesium.defaultValue(e.luminanceAtZenith,.2),this._sphericalHarmonicCoefficients=e.sphericalHarmonicCoefficients,this._specularEnvironmentMaps=e.specularEnvironmentMaps,this._shouldUpdateSpecularMapAtlas=!0,this._specularEnvironmentMapAtlas=void 0,this._useDefaultSphericalHarmonics=!1,this._useDefaultSpecularMaps=!1,this._shouldRegenerateShaders=!1,this._enableFog=!1,this.meshPrimitives=[],Cesium.defined(e.sharedResources)?(this.childrenTilesetUri=e.sharedResources.ktxs.name,this.ktxs=e.sharedResources.ktxs,this.instancedPrograms=e.sharedResources.instancedPrograms.shadredData):(this.childrenTilesetUri="",this.ktxs={},this.instancedPrograms={}),this.content=Cesium.defaultValue(e.content,void 0),this.ev_E3MInternalInstance=Cesium.defined(this.content)?new Oh({model:this}):void 0,this.modelSpecular=Cesium.defaultValue(e.specular,.5),this.rollerRegion=Cesium.defaultValue(e.rollerRegion,new Cesium.Cartesian4(0,0,1,1)),this._update=!1}Object.defineProperties(Ur.prototype,{gltf:{get:function(){return Cesium.defined(this._cachedGltf)?this._cachedGltf.gltf:void 0}},gltfInternal:{get:function(){return this.gltf}},releaseGltfJson:{get:function(){return this._releaseGltfJson}},cacheKey:{get:function(){return this._cacheKey}},basePath:{get:function(){return this._resource.url}},boundingSphere:{get:function(){var e=this.modelMatrix;this.heightReference!==Cesium.HeightReference.NONE&&this._clampedModelMatrix&&(e=this._clampedModelMatrix);var t=Cesium.Matrix4.getScale(e,kw),r=Cesium.defined(this.maximumScale)?Math.min(this.maximumScale,this.scale):this.scale;Cesium.Cartesian3.multiplyByScalar(t,r,t);var n=this._scaledBoundingSphere;return n.center=Cesium.Cartesian3.multiplyComponents(this._boundingSphere.center,t,n.center),n.radius=Cesium.Cartesian3.maximumComponent(t)*this._initialRadius,Cesium.defined(this._rtcCenter)&&Cesium.Cartesian3.add(this._rtcCenter,n.center,n.center),n}},ready:{get:function(){return this._ready}},readyPromise:{get:function(){return this._readyPromise.promise}},asynchronous:{get:function(){return this._asynchronous}},allowPicking:{get:function(){return this._allowPicking}},incrementallyLoadTextures:{get:function(){return this._incrementallyLoadTextures}},pendingTextureLoads:{get:function(){return Cesium.defined(this._loadResources)?this._loadResources.pendingTextureLoads:0}},dirty:{get:function(){return this._dirty}},distanceDisplayCondition:{get:function(){return this._distanceDisplayCondition},set:function(e){this._distanceDisplayCondition=Cesium.DistanceDisplayCondition.clone(e,this._distanceDisplayCondition)}},extensionsUsed:{get:function(){return Cesium.defined(this._extensionsUsed)||(this._extensionsUsed=ee.getUsedExtensions(this.gltf)),this._extensionsUsed}},extensionsRequired:{get:function(){return Cesium.defined(this._extensionsRequired)||(this._extensionsRequired=ee.getRequiredExtensions(this.gltf)),this._extensionsRequired}},upAxis:{get:function(){return this._upAxis}},forwardAxis:{get:function(){return Cesium.defined(this._forwardAxis)?this._forwardAxis:this._gltfForwardAxis}},trianglesLength:{get:function(){return this._trianglesLength}},geometryByteLength:{get:function(){return this._geometryByteLength}},texturesByteLength:{get:function(){return this._texturesByteLength}},cachedGeometryByteLength:{get:function(){return this._cachedGeometryByteLength}},cachedTexturesByteLength:{get:function(){return this._cachedTexturesByteLength}},clippingPlanes:{get:function(){return this._clippingPlanes},set:function(e){e!==this._clippingPlanes&&Cesium.ClippingPlaneCollection.setOwner(e,this,"_clippingPlanes")}},pickIds:{get:function(){return this._pickIds}},imageBasedLightingFactor:{get:function(){return this._imageBasedLightingFactor},set:function(e){var t=this._imageBasedLightingFactor;e===t||Cesium.Cartesian2.equals(e,t)||(this._shouldRegenerateShaders=this._shouldRegenerateShaders||this._imageBasedLightingFactor.x>0&&e.x===0||this._imageBasedLightingFactor.x===0&&e.x>0,this._shouldRegenerateShaders=this._shouldRegenerateShaders||this._imageBasedLightingFactor.y>0&&e.y===0||this._imageBasedLightingFactor.y===0&&e.y>0,Cesium.Cartesian2.clone(e,this._imageBasedLightingFactor))}},lightColor:{get:function(){return this._lightColor},set:function(e){var t=this._lightColor;e===t||Cesium.Cartesian3.equals(e,t)||(this._shouldRegenerateShaders=this._shouldRegenerateShaders||Cesium.defined(t)&&!Cesium.defined(e)||Cesium.defined(e)&&!Cesium.defined(t),this._lightColor=Cesium.Cartesian3.clone(e,t))}},luminanceAtZenith:{get:function(){return this._luminanceAtZenith},set:function(e){var t=this._luminanceAtZenith;e!==t&&(this._shouldRegenerateShaders=this._shouldRegenerateShaders||Cesium.defined(t)&&!Cesium.defined(e)||Cesium.defined(e)&&!Cesium.defined(t),this._luminanceAtZenith=e)}},sphericalHarmonicCoefficients:{get:function(){return this._sphericalHarmonicCoefficients},set:function(e){e!==this._sphericalHarmonicCoefficients&&(this._sphericalHarmonicCoefficients=e,this._shouldRegenerateShaders=!0)}},specularEnvironmentMaps:{get:function(){return this._specularEnvironmentMaps},set:function(e){this._shouldUpdateSpecularMapAtlas=this._shouldUpdateSpecularMapAtlas||e!==this._specularEnvironmentMaps,this._specularEnvironmentMaps=e}},credit:{get:function(){return this._credit}}});function hv(e){return e.stencilBuffer}function nd(e){return!Cesium.Color.equals(e.color,Cesium.Color.WHITE)||e.colorBlendMode!==Cesium.ColorBlendMode.HIGHLIGHT}function dv(e){var t=e._clippingPlanes;return Cesium.defined(t)&&t.enabled&&t.length!==0}Ur.silhouetteSupported=function(e){return hv(e.context)};function qw(e){var t=Cesium.getMagic(e);return t==="glTF"}Ur.fromGltf=function(e){var t=e.url;e=Cesium.clone(e);var r=Cesium.Resource.createIfNeeded(t),n=Cesium.defaultValue(e.basePath,r.clone()),i=Cesium.Resource.createIfNeeded(n),s=Cesium.defaultValue(e.cacheKey,ev[Cesium.getAbsoluteUri(r.url)]);Cesium.defined(s)||(s=Cesium.createGuid(),ev[Cesium.getAbsoluteUri(r.url)]=s),Cesium.defined(e.basePath)&&!Cesium.defined(e.cacheKey)&&(s+=i.url),e.cacheKey=s,e.basePath=i;var a=new Ur(e),o=sa[s];return Cesium.defined(o)?o.ready||(++o.count,o.modelsToLoad.push(a)):(o=new Uu({ready:!1}),o.count=1,o.modelsToLoad.push(a),rd(a,o),sa[s]=o,Cesium.defined(r.headers.Accept)||(r.headers.Accept=Uw),r.fetchArrayBuffer().then(function(u){var f=new Uint8Array(u);if(qw(f)){var l=Cesium.parseGlb(f);o.makeReady(l)}else{var c=Cesium.getStringFromTypedArray(f);o.makeReady(JSON.parse(c))}var h=a._resourceCredits,d=r.credits;if(Cesium.defined(d))for(var m=d.length,g=0;g<m;g++)h.push(d[g])}).catch(ee.getFailedLoadFunction(a,"model",r.url))),a};Ur._gltfCache=sa;function Gu(e,t,r){return e._runtime[t][r]}Ur.prototype.getNode=function(e){var t=Gu(this,"nodesByName",e);return Cesium.defined(t)?t.publicNode:void 0};Ur.prototype.getMesh=function(e){return Gu(this,"meshesByName",e)};Ur.prototype.getMaterial=function(e){return Gu(this,"materialsByName",e)};Ur.prototype.setArticulationStage=function(e,t){var r=Gu(this,"stagesByKey",e),n=Gu(this,"articulationsByStageKey",e);Cesium.defined(r)&&Cesium.defined(n)&&(t=Cesium.Math.clamp(t,r.minimumValue,r.maximumValue),Cesium.Math.equalsEpsilon(r.currentValue,t,Gw)||(r.currentValue=t,n.isDirty=!0))};var Hw=new Cesium.Cartesian3,Qh=new Cesium.Matrix3;function mv(e,t){var r=e.currentValue,n=Hw,i;switch(e.type){case"xRotate":i=Cesium.Matrix3.fromRotationX(Cesium.Math.toRadians(r),Qh),Cesium.Matrix4.multiplyByMatrix3(t,i,t);break;case"yRotate":i=Cesium.Matrix3.fromRotationY(Cesium.Math.toRadians(r),Qh),Cesium.Matrix4.multiplyByMatrix3(t,i,t);break;case"zRotate":i=Cesium.Matrix3.fromRotationZ(Cesium.Math.toRadians(r),Qh),Cesium.Matrix4.multiplyByMatrix3(t,i,t);break;case"xTranslate":n.x=r,n.y=0,n.z=0,Cesium.Matrix4.multiplyByTranslation(t,n,t);break;case"yTranslate":n.x=0,n.y=r,n.z=0,Cesium.Matrix4.multiplyByTranslation(t,n,t);break;case"zTranslate":n.x=0,n.y=0,n.z=r,Cesium.Matrix4.multiplyByTranslation(t,n,t);break;case"xScale":n.x=r,n.y=1,n.z=1,Cesium.Matrix4.multiplyByScale(t,n,t);break;case"yScale":n.x=1,n.y=r,n.z=1,Cesium.Matrix4.multiplyByScale(t,n,t);break;case"zScale":n.x=1,n.y=1,n.z=r,Cesium.Matrix4.multiplyByScale(t,n,t);break;case"uniformScale":Cesium.Matrix4.multiplyByUniformScale(t,r,t);break;default:break}return t}var Ww=new Cesium.Matrix4;Ur.prototype.applyArticulations=function(){var e=this._runtime.articulationsByName;for(var t in e)if(e.hasOwnProperty(t)){var r=e[t];if(r.isDirty){r.isDirty=!1;for(var n=r.nodes.length,i=0;i<n;++i){for(var s=r.nodes[i],a=Cesium.Matrix4.clone(s.originalMatrix,Ww),o=r.stages.length,u=0;u<o;++u){var f=r.stages[u];a=mv(f,a)}s.matrix=a}}}};function Yw(e){var t=e.gltf,r=e._loadResources;Cesium.ForEach.buffer(t,function(n,i){r.buffers[i]=n.extras._pipeline.source})}function Xw(e,t){return function(r){var n=e._loadResources,i=new Uint8Array(r);--n.pendingBufferLoads,e.gltf.buffers[t].extras._pipeline.source=i}}function jw(e){var t=e.gltf.bufferViews,r=e._loadResources.vertexBuffersToCreate;Cesium.ForEach.bufferView(e.gltf,function(s,a){s.target===Cesium.WebGLConstants.ARRAY_BUFFER&&r.enqueue(a)});var n=e._loadResources.indexBuffersToCreate,i={};Cesium.ForEach.accessor(e.gltf,function(s){var a=s.bufferView;if(Cesium.defined(a)){var o=t[a];o.target===Cesium.WebGLConstants.ELEMENT_ARRAY_BUFFER&&!Cesium.defined(i[a])&&(i[a]=!0,n.enqueue({id:a,componentType:s.componentType}))}})}function Kw(e){var t=e.gltf;if(ka(t,"KHR_techniques_webgl")){var r=e._sourcePrograms,n=e._sourceTechniques,i=t.extensions.KHR_techniques_webgl.programs;Cesium.ForEach.technique(t,function(s,a){n[a]=Cesium.clone(s);var o=s.program;Cesium.defined(r[o])||(r[o]=Cesium.clone(i[o]))})}}function pv(e,t,r,n){return function(i){var s=e.gltfShader,a=e._loadResources;a.shaders[r]={source:i,type:t,bufferView:void 0},--a.pendingShaderLoads,e._rendererResources.sourceShaders[r]=i,e.useIndexedDBCache&&Ts.saveFile({keyName:n,data:i})}}function Qw(e,t,r,n){var i=e._loadResources;n=n.replace("material.shininess = 1.0;","material.shininess = 2.0;"),i.shaders[r]={source:n,type:t,bufferView:void 0},--i.pendingShaderLoads,e._rendererResources.sourceShaders[r]=n}function Zw(e){var t=e.gltf,r=t.buffers,n=t.bufferViews,i=e._rendererResources.sourceShaders;Cesium.ForEach.shader(t,function(s,a){if(Cesium.defined(s.bufferView)){var o=s.bufferView,u=n[o],f=u.buffer,l=r[f],c=Cesium.getStringFromTypedArray(l.extras._pipeline.source,u.byteOffset,u.byteLength);i[a]=c}else if(Cesium.defined(s.extras._pipeline.source))i[a]=s.extras._pipeline.source;else{++e._loadResources.pendingShaderLoads;var h=e._resource._url.substring(0,e._resource._url.lastIndexOf("/")+1)+s.uri;if(e.useIndexedDBCache)$w(e,s,a);else{var d=e._resource.getDerivedResource({url:s.uri,queryParameters:e._resource.queryParameters}),m=d.fetchText();Cesium.defined(e.gltfShader)&&(e.gltfShader[h]=m),m.then(pv(e,s.type,a,d._url)).catch(ee.getFailedLoadFunction(e,"shader",d.url))}}})}function Jw(e){var t=e._sourceTechniques;for(var r in t)if(t.hasOwnProperty(r)){var n=t[r];e._loadResources.programsToCreate.enqueue({programId:n.program,techniqueId:r})}}function $w(e,t,r){function n(o){Qw(e,t.type,r,o)}function i(){var o=e._resource.getDerivedResource({url:t.uri,queryParameters:e._resource.queryParameters}),u=o.fetchText();u.then(pv(e,t.type,r,o._url)).catch(ee.getFailedLoadFunction(e,"shader",o.url))}var s=e._resource._url.substring(0,e._resource._url.lastIndexOf("/")+1)+t.uri,a={keyName:s,downloadSuccessFun:n,downloadErrorFun:i};Ts.loadFile(a)||i()}function eS(e){var t={},r={},n={};e._runtime.articulationsByName=t,e._runtime.articulationsByStageKey=r,e._runtime.stagesByKey=n;var i=e.gltf;if(!(!ka(i,"AGI_articulations")||!Cesium.defined(i.extensions)||!Cesium.defined(i.extensions.AGI_articulations))){var s=i.extensions.AGI_articulations.articulations;if(Cesium.defined(s))for(var a=s.length,o=0;o<a;++o){var u=Cesium.clone(s[o]);u.nodes=[],u.isDirty=!0,t[u.name]=u;for(var f=u.stages.length,l=0;l<f;++l){var c=u.stages[l];c.currentValue=c.initialValue;var h=u.name+" "+c.name;r[h]=u,n[h]=c}}}}function tS(e,t,r,n){return function(i){n.data=i,i.constructor.name!="HTMLImageElement"&&Ts.saveImage(n);var s=e._loadResources;--s.pendingTextureLoads,s.texturesToCreate.enqueue({id:t,image:i,bufferView:i.bufferView,width:i.width,height:i.height,internalFormat:i.internalFormat})}}function Ha(e,t,r){return function(n){Cesium.defined(r)&&Cesium.defined(e.ktxs)&&(Cesium.defined(e.ktxs[r])&&typeof e.ktxs[r].then=="function"||!Cesium.defined(e.ktxs[r]))&&(e.ktxs[r]=n);var i=e._loadResources;--i.pendingTextureLoads;let s;Array.isArray(n)&&(s=n.slice(1,n.length).map(function(a){return a.bufferView}),n=n[0]),i.texturesToCreate.enqueue({id:t,image:n,bufferView:n.bufferView,width:n.width,height:n.height,internalFormat:n.internalFormat})}}function gv(e,t,r){var n=e._loadResources;--n.pendingTextureLoads,n.texturesToCreate.enqueue({id:t,image:r,bufferView:r.bufferView,width:r.width,height:r.height,internalFormat:r.internalFormat})}var Il=/(^data:image\/ktx)|(data:image\/ktx)|(\.ktx$)|(\.ktx.gz$)/i,Ll=/(^data:image\/crn)|(\.crn$)/i,id=/(^data:image\/pkm)|(\.pkm$)|(\.pkm.gz$)/i;function rS(e,t,r){if(e.useIndexedDBCache){nS(e,t,r);return}var n=e.gltf,i=n.images,s;Cesium.ForEach.texture(n,function(a,o){var u=a.source;Cesium.defined(a.extensions)&&Cesium.defined(a.extensions.EXT_texture_webp)&&r&&(u=a.extensions.EXT_texture_webp.source);var f=i[u],l=f.extras,c=f.bufferView,h=f.mimeType;if(s=f.uri,Cesium.defined(l)&&Cesium.defined(l.compressedImage3DTiles)){var d=l.compressedImage3DTiles.crunch,m=l.compressedImage3DTiles.s3tc,g=l.compressedImage3DTiles.pvrtc1,p=l.compressedImage3DTiles.etc1;t.s3tc&&Cesium.defined(d)?(h=d.mimeType,Cesium.defined(d.bufferView)?c=d.bufferView:s=d.uri):t.s3tc&&Cesium.defined(m)?(h=m.mimeType,Cesium.defined(m.bufferView)?c=m.bufferView:s=m.uri):t.pvrtc&&Cesium.defined(g)?(h=g.mimeType,Cesium.defined(g.bufferView)?c=g.bufferView:s=g.uri):t.etc1&&Cesium.defined(p)&&(h=p.mimeType,Cesium.defined(p.bufferView)?c=p.bufferView:s=p.uri)}if(Cesium.defined(c))e._loadResources.texturesToCreateFromBufferView.enqueue({id:o,image:void 0,bufferView:c,mimeType:h});else{++e._loadResources.pendingTextureLoads;var v=e._resource.getDerivedResource({url:s}),_=e.ktxs;if(Cesium.defined(_)&&s.indexOf("data:image/")===-1){var y=_[v._url];if(Cesium.defined(y))typeof y.then=="function"?y.then(Ha(e,o,v._url)).catch(ee.getFailedLoadFunction(e,"image",v.url)):(Cesium.defined(y.arrayBufferView)&&delete y.arrayBufferView,gv(e,o,y));else{var x;Il.test(s)?x=za(v):Ll.test(s)?x=Va(v):id.test(s)?x=Cesium.EV_LoadETC(v):x=v.fetchImage(),_[v._url]=x,x.then(Ha(e,o,v._url)).catch(ee.getFailedLoadFunction(e,"image",v.url))}}else{var x;Il.test(s)?x=za(v):Ll.test(s)?x=Va(v):x=v.fetchImage(),x.then(Ha(e,o)).catch(ee.getFailedLoadFunction(e,"image",v.url))}}})}function nS(e,t,r){var n=e.gltf,i=n.images,s=e.childrenTilesetUri,a;Cesium.ForEach.texture(n,function(o,u){var f=o.source;Cesium.defined(o.extensions)&&Cesium.defined(o.extensions.EXT_texture_webp)&&r&&(f=o.extensions.EXT_texture_webp.source);var l=i[f];if(Cesium.defined(l)){var c=l.extras,h=l.bufferView,d=l.mimeType;if(a=l.uri,Cesium.defined(c)&&Cesium.defined(c.compressedImage3DTiles)){var m=c.compressedImage3DTiles.crunch,g=c.compressedImage3DTiles.s3tc,p=c.compressedImage3DTiles.pvrtc1,v=c.compressedImage3DTiles.etc1;t.s3tc&&Cesium.defined(m)?(d=m.mimeType,Cesium.defined(m.bufferView)?h=m.bufferView:a=m.uri):t.s3tc&&Cesium.defined(g)?(d=g.mimeType,Cesium.defined(g.bufferView)?h=g.bufferView:a=g.uri):t.pvrtc&&Cesium.defined(p)?(d=p.mimeType,Cesium.defined(p.bufferView)?h=p.bufferView:a=p.uri):t.etc1&&Cesium.defined(v)&&(d=v.mimeType,Cesium.defined(v.bufferView)?h=v.bufferView:a=v.uri)}if(Cesium.defined(h))e._loadResources.texturesToCreateFromBufferView.enqueue({id:u,image:void 0,bufferView:h,mimeType:d});else{++e._loadResources.pendingTextureLoads;var _=e._resource.getDerivedResource({url:a});if(e.useIndexedDBCache&&a.indexOf("data:image/")===-1){var y={keyName:_._url,model:e,imageResource:_,uri:a,id:u,data:void 0,downloadSuccessFun:sS,downloadErrorFun:iS};Ts.loadImage(y)}else{var x;Il.test(a)?x=za(_):Ll.test(a)?x=Va(_):id.test(a)?x=Cesium.EV_LoadETC(_):x=_.fetchImage(),x.then(Ha(e,u)).catch(ee.getFailedLoadFunction(e,"image",_.url))}}}})}function iS(e){if(Cesium.defined(e)){var t=e.model,r=e.imageResource,n=e.keyName,i=e.id,s;Il.test(n)?s=za(r):Ll.test(n)?s=Va(r):id.test(n)?s=Cesium.EV_LoadETC(r):s=r.fetchImage(),s.then(tS(t,i,n,e)).catch(ee.getFailedLoadFunction(t,"image",r.url))}}function sS(e,t){if(Cesium.defined(e)){var r=e.model,n=e.keyName,i=e.id,s;if(t.length>0){for(var a=new Array(t.length),o=0;o<t.length;o++)a[o]=new ea(t[o]._format,t[o]._width,t[o]._height,t[o]._buffer);s=a}Cesium.defined(t._buffer)&&(s=new ea(t._format,t._width,t._height,t._buffer)),Cesium.defined(s)&&gv(r,i,s)}}var aS=new Cesium.Matrix4;function oS(e){var t={},r={},n=[],i=e._loadResources.skinnedNodesIds,s=e._runtime.articulationsByName;Cesium.ForEach.node(e.gltf,function(a,o){var u={matrix:void 0,translation:void 0,rotation:void 0,scale:void 0,computedShow:!0,transformToRoot:new Cesium.Matrix4,computedMatrix:new Cesium.Matrix4,dirtyNumber:0,commands:[],inverseBindMatrices:void 0,bindShapeMatrix:void 0,joints:[],computedJointMatrices:[],jointName:a.jointName,weights:[],children:[],parents:[],publicNode:void 0};if(u.publicNode=new Cesium.ModelNode(e,a,u,o,ee.getTransform(a)),t[o]=u,r[a.name]=u,Cesium.defined(a.skin)&&(i.push(o),n.push(u)),Cesium.defined(a.extensions)&&Cesium.defined(a.extensions.AGI_articulations)){var f=a.extensions.AGI_articulations.articulationName;if(Cesium.defined(f)){var l=Cesium.Matrix4.clone(u.publicNode.originalMatrix,aS),c=s[f];c.nodes.push(u.publicNode);for(var h=c.stages.length,d=0;d<h;++d){var m=c.stages[d];l=mv(m,l)}u.publicNode.matrix=l}}}),e._runtime.nodes=t,e._runtime.nodesByName=r,e._runtime.skinnedNodes=n}function uS(e){var t=e.gltf,r=e._sourceTechniques,n={},i={},s=e._uniformMaps;Cesium.ForEach.material(t,function(a,o){s[o]={uniformMap:void 0,values:void 0,jointMatrixUniformName:void 0,morphWeightsUniformName:void 0};var u=new zh(e,a,o);if(Cesium.defined(a.extensions)&&Cesium.defined(a.extensions.KHR_techniques_webgl)){var f=a.extensions.KHR_techniques_webgl.technique;u._technique=f,u._program=r[f].program,Cesium.ForEach.materialValue(a,function(l,c){Cesium.defined(u._values)||(u._values={}),u._values[c]=Cesium.clone(l),c=="u_specular"&&(u._values[c][0]=e.modelSpecular)})}n[a.name]=u,i[o]=u}),e._runtime.materialsByName=n,e._runtime.materialsById=i}function fS(e){var t={},r=e._runtime.materialsById;Cesium.ForEach.mesh(e.gltf,function(n,i){t[n.name]=new kh(n,r,i),(Cesium.defined(e.extensionsUsed.WEB3D_quantized_attributes)||e._dequantizeInShader)&&Cesium.ForEach.meshPrimitive(n,function(s,a){var o=od(e,s),u=e._programPrimitives[o];Cesium.defined(u)||(u={},e._programPrimitives[o]=u),u[i+".primitive."+a]=s})}),e._runtime.meshesByName=t}var sd=function(){this.id=void 0,this.model=void 0,this.context=void 0};sd.prototype.set=function(e,t,r){this.id=e,this.model=t,this.context=r};sd.prototype.execute=function(){vv(this.id,this.model,this.context)};function vv(e,t,r){var n=t._loadResources,i=t.gltf.bufferViews,s=i[e];Cesium.defined(s)||(s=n.createdBufferViews[e]);var a=Cesium.Buffer.createVertexBuffer({context:r,typedArray:n.getBuffer(s),usage:Cesium.BufferUsage.STATIC_DRAW});a.vertexArrayDestroyable=!1,t._rendererResources.buffers[e]=a,t._geometryByteLength+=a.sizeInBytes}var ad=function(){this.id=void 0,this.componentType=void 0,this.model=void 0,this.context=void 0};ad.prototype.set=function(e,t,r,n){this.id=e,this.componentType=t,this.model=r,this.context=n};ad.prototype.execute=function(){_v(this.id,this.componentType,this.model,this.context)};function _v(e,t,r,n){var i=r._loadResources,s=r.gltf.bufferViews,a=s[e];Cesium.defined(a)||(a=i.createdBufferViews[e]);var o=Cesium.Buffer.createIndexBuffer({context:n,typedArray:i.getBuffer(a),usage:Cesium.BufferUsage.STATIC_DRAW,indexDatatype:t});o.vertexArrayDestroyable=!1,r._rendererResources.buffers[e]=o,r._geometryByteLength+=o.sizeInBytes}var tv=new sd,rv=new ad;function lS(e,t){var r=e._loadResources;if(r.pendingBufferLoads===0){var n=t.context,i=r.vertexBuffersToCreate,s=r.indexBuffersToCreate,a;if(e.asynchronous){for(;i.length>0&&(tv.set(i.peek(),e,n),!!t.jobScheduler.execute(tv,Cesium.JobType.BUFFER));)i.dequeue();for(;s.length>0&&(a=s.peek(),rv.set(a.id,a.componentType,e,n),!!t.jobScheduler.execute(rv,Cesium.JobType.BUFFER));)s.dequeue()}else{for(;i.length>0;)vv(i.dequeue(),e,n);for(;s.length>0;)a=s.dequeue(),_v(a.id,a.componentType,e,n)}}}function od(e,t){var r=e._runtime.materialsById[t.material];if(Cesium.defined(r))return r._program}function Cv(e,t,r){var n,i=r._programPrimitives[t];if(!Cesium.defined(i))return e;var s;for(s in i)if(i.hasOwnProperty(s)&&(n=i[s],od(r,n)===t))break;r._programPrimitives[t]=void 0;var a;if(r.extensionsUsed.WEB3D_quantized_attributes)a=ee.modifyShaderForQuantizedAttributes(r.gltf,n,e),r._quantizedUniforms[t]=a.uniforms;else{var o=r._decodedData[s];if(Cesium.defined(o))a=ee.modifyShaderForDracoQuantizedAttributes(r.gltf,n,e,o.attributes);else return e}return a.shader}function cS(e){return e=Cesium.ShaderSource.replaceMain(e,"gltf_blend_main"),e+=`uniform vec4 gltf_color; 
uniform float gltf_colorBlend; 
void main() 
{ 
    gltf_blend_main(); 
    gl_FragColor.rgb = mix(gl_FragColor.rgb, gltf_color.rgb, gltf_colorBlend); 
    float highlight = ceil(gltf_colorBlend); 
    gl_FragColor.rgb *= mix(gltf_color.rgb, vec3(1.0), highlight); 
    gl_FragColor.a *= gltf_color.a; 
} 
`,e}function qu(e,t,r){return Cesium.defined(r)&&(e=r(e,t)),e}var ud=function(){this.programToCreate=void 0,this.model=void 0,this.context=void 0};ud.prototype.set=function(e,t,r){this.programToCreate=e,this.model=t,this.context=r};ud.prototype.execute=function(){yv(this.programToCreate,this.model,this.context)};function yv(e,t,r){var n=e.programId,i=e.techniqueId,s=t._sourcePrograms[n],a=t._rendererResources.sourceShaders,o=a[s.vertexShader],u=a[s.fragmentShader];u+="uniform vec4 u_rollerRegion;";var f=t._quantizedVertexShaders,l=t._toClipCoordinatesGLSL[n];if(t.extensionsUsed.WEB3D_quantized_attributes||t._dequantizeInShader){var c=f[n];Cesium.defined(c)||(c=Cv(o,n,t),f[n]=c),o=c}var h=qu(o,n,t._vertexShaderLoaded),d=qu(u,n,t._fragmentShaderLoaded);if(t._tilesetFlat&&(h=t._tilesetFlat._updateVertexShader(h)),Cesium.FeatureDetection.isInternetExplorer()||(h=ee.modifyVertexShaderForLogDepth(h,l),t.rollerRegion.equals(xv)?d=ee.modifyFragmentShaderForLogDepth(d):d=ee.modifyFragmentShaderForLogDepthAddRoller(d)),Cesium.defined(t._uniformMapLoaded)||(d=`uniform vec4 czm_pickColor;
`+d),Cesium.defined(t._scene)&&Cesium.defined(t._scene.ev_Fog)&&t._scene.ev_Fog.enabled){if(h.indexOf("u_modelViewMatrix")>-1){h=`
 varying vec4 v_viewPosition; 
`+h;var m=`v_viewPosition = u_modelViewMatrix * vec4(a_position.xyz, 1.0); 
`;h.indexOf("gltf_a_dec_position")!=-1&&(m=`v_viewPosition = u_modelViewMatrix * vec4(gltf_a_dec_position.xyz, 1.0); 
`);var g=h.lastIndexOf("}");g&&(h=h.slice(0,g)+m+h.slice(g)),d=`
varying vec4 v_viewPosition; 
#if defined(FOG) && (defined(ENABLE_VERTEX_LIGHTING) || defined(ENABLE_DAYNIGHT_SHADING)) || defined(GROUND_ATMOSPHERE) 
uniform float u_minimumBrightness ;
#endif 
vec3 colorCorrect(vec3 rgb) {
#ifdef COLOR_CORRECT
    // Convert rgb color to hsb
    vec3 hsb = czm_RGBToHSB(rgb);
    // Perform hsb shift
    hsb.x += u_hsbShift.x; // hue
    hsb.y = clamp(hsb.y + u_hsbShift.y, 0.0, 1.0); // saturation
    hsb.z = hsb.z > czm_epsilon7 ? hsb.z + u_hsbShift.z : 0.0; // brightness
    // Convert shifted hsb back to rgb
    rgb = czm_HSBToRGB(hsb);
#endif
    return rgb;
} 
`+Cesium._shadersGroundAtmosphereOld+`
`+d,t._scene.fog.enabled&&(d=`#define FOG 

`+d)}else if(h.indexOf("u_modelViewProj")>-1&&h.indexOf("u_projectionMatrix")>-1){h=`
 varying vec4 v_viewPosition; 
`+h;var m=`v_viewPosition = u_modelViewProj *u_projectionMatrix* vec4(a_position.xyz, 1.0); 
`;h.indexOf("gltf_a_dec_position")!=-1&&(m=`v_viewPosition = u_modelViewProj *u_projectionMatrix*vec4(gltf_a_dec_position.xyz, 1.0); 
`);var g=h.lastIndexOf("}");g&&(h=h.slice(0,g)+m+h.slice(g)),d=`
varying vec4 v_viewPosition; 
#if defined(FOG) && (defined(ENABLE_VERTEX_LIGHTING) || defined(ENABLE_DAYNIGHT_SHADING)) || defined(GROUND_ATMOSPHERE) 
uniform float u_minimumBrightness ;
#endif 
vec3 colorCorrect(vec3 rgb) {
#ifdef COLOR_CORRECT
    // Convert rgb color to hsb
    vec3 hsb = czm_RGBToHSB(rgb);
    // Perform hsb shift
    hsb.x += u_hsbShift.x; // hue
    hsb.y = clamp(hsb.y + u_hsbShift.y, 0.0, 1.0); // saturation
    hsb.z = hsb.z > czm_epsilon7 ? hsb.z + u_hsbShift.z : 0.0; // brightness
    // Convert shifted hsb back to rgb
    rgb = czm_HSBToRGB(hsb);
#endif
    return rgb;
} 
`+Cesium._shadersGroundAtmosphereOld+`
`+d,t._scene.fog.enabled&&(d=`#define FOG 

`+d)}}var p=t._imageBasedLightingFactor.x>0||t._imageBasedLightingFactor.y>0;if(p&&(d=`#define USE_IBL_LIGHTING 

`+d),Cesium.defined(t._lightColor)&&(d=`#define USE_CUSTOM_LIGHT_COLOR 

`+d),(t._sourceVersion!=="2.0"||t._sourceKHRTechniquesWebGL)&&(d=Cesium.ShaderSource.replaceMain(d,"non_gamma_corrected_main"),d=d+`
void main() { 
    non_gamma_corrected_main(); 
    gl_FragColor = czm_gammaCorrect(gl_FragColor); 
} 
`),Cesium.defined(t._scene)&&Cesium.defined(t._scene.ev_Fog)&&t._scene.ev_Fog.enabled){var v=`
#if defined(FOG)
  vec4 finalColor =  gl_FragColor; 
  float vDistance =  length(v_viewPosition.xyz); 
  vec4 worldPosition = czm_inverseView3D * v_viewPosition; 
  AtmosphereColor atmosFogColor = computeGroundAtmosphereFromSpace(vec3(worldPosition.x, worldPosition.y, worldPosition.z), false, vec3(0.0));
  vec3 fogColor = colorCorrect(atmosFogColor.mie) + finalColor.rgb * colorCorrect(atmosFogColor.rayleigh);
 #ifndef HDR
  const float fExposure = 4.0;
  fogColor = vec3(1.0) - exp(-fExposure * fogColor);
 #endif
 #ifdef FOG
   #if defined(ENABLE_VERTEX_LIGHTING) || defined(ENABLE_DAYNIGHT_SHADING)
      float darken = clamp(dot(normalize(czm_viewerPositionWC), normalize(czm_sunPositionWC)), u_minimumBrightness, 1.0);
      fogColor *= darken;
   #endif
   #ifdef HDR
       const float modifier = 0.15;
      finalColor = vec4(czm_fog(vDistance, finalColor.rgb, fogColor, modifier), finalColor.a);
    #else
      finalColor = vec4(czm_fog(vDistance, finalColor.rgb, fogColor), finalColor.a);
    #endif
 #endif
 gl_FragColor = finalColor;
#endif
`,_=d.lastIndexOf("}");_&&(d=d.slice(0,_)+v+d.slice(_))}if(Cesium.OctahedralProjectedCubeMap.isSupported(r)){var y=Cesium.defined(t._sphericalHarmonicCoefficients)||t._useDefaultSphericalHarmonics,x=Cesium.defined(t._specularEnvironmentMapAtlas)&&t._specularEnvironmentMapAtlas.ready||t._useDefaultSpecularMaps,E=y||x||p;E&&(d=`uniform mat4 gltf_clippingPlanesMatrix; 
`+d),Cesium.defined(t._sphericalHarmonicCoefficients)?d=`#define DIFFUSE_IBL 
#define CUSTOM_SPHERICAL_HARMONICS 
uniform vec3 gltf_sphericalHarmonicCoefficients[9]; 
`+d:t._useDefaultSphericalHarmonics&&(d=`#define DIFFUSE_IBL 
`+d),Cesium.defined(t._specularEnvironmentMapAtlas)&&t._specularEnvironmentMapAtlas.ready?d=`#define SPECULAR_IBL 
#define CUSTOM_SPECULAR_IBL 
uniform sampler2D gltf_specularMap; 
uniform vec2 gltf_specularMapSize; 
uniform float gltf_maxSpecularLOD; 
`+d:t._useDefaultSpecularMaps&&(d=`#define SPECULAR_IBL 
`+d)}Cesium.defined(t._luminanceAtZenith)&&(d=`#define USE_SUN_LUMINANCE 
uniform float gltf_luminanceAtZenith;
`+d),Ev(n,i,d,h,t,r)}var xv=new Cesium.Cartesian4(0,0,1,1);function hS(e,t,r){var n=e.programId,i=e.techniqueId,s=t._sourcePrograms[n],a=t._rendererResources.sourceShaders,o=t._quantizedVertexShaders,u=t._toClipCoordinatesGLSL[n],f=t.clippingPlanes,l=dv(t),c=a[s.vertexShader],h=a[s.fragmentShader];h+="uniform vec4 u_rollerRegion;",(t.extensionsUsed.WEB3D_quantized_attributes||t._dequantizeInShader)&&(c=o[n]);var d=h;nd(t)&&(d=Ur._modifyShaderForColor(d)),l&&(d=dT(d,f,r));var m=qu(c,n,t._vertexShaderLoaded),g=qu(d,n,t._fragmentShaderLoaded);if(t._tilesetFlat&&(m=t._tilesetFlat._updateVertexShader(m)),Cesium.FeatureDetection.isInternetExplorer()||(m=ee.modifyVertexShaderForLogDepth(m,u),t.rollerRegion.equals(xv)?g=ee.modifyFragmentShaderForLogDepth(g):g=ee.modifyFragmentShaderForLogDepthAddRoller(g)),Cesium.defined(t._uniformMapLoaded)||(g=`uniform vec4 czm_pickColor;
`+g),Cesium.defined(t._scene)&&Cesium.defined(t._scene.ev_Fog)&&t._scene.ev_Fog.enabled){if(m.indexOf("u_modelViewMatrix")>-1){m=`
 varying vec4 v_viewPosition; 
`+m;var p=`v_viewPosition = u_modelViewMatrix * vec4(a_position.xyz, 1.0); 
`;m.indexOf("gltf_a_dec_position")!=-1&&(p=`v_viewPosition = u_modelViewMatrix * vec4(gltf_a_dec_position.xyz, 1.0); 
`);var v=m.lastIndexOf("}");v&&(m=m.slice(0,v)+p+m.slice(v)),g=`
varying vec4 v_viewPosition; 
#if defined(FOG) && (defined(ENABLE_VERTEX_LIGHTING) || defined(ENABLE_DAYNIGHT_SHADING)) || defined(GROUND_ATMOSPHERE) 
uniform float u_minimumBrightness ;
#endif 
vec3 colorCorrect(vec3 rgb) {
#ifdef COLOR_CORRECT
    // Convert rgb color to hsb
    vec3 hsb = czm_RGBToHSB(rgb);
    // Perform hsb shift
    hsb.x += u_hsbShift.x; // hue
    hsb.y = clamp(hsb.y + u_hsbShift.y, 0.0, 1.0); // saturation
    hsb.z = hsb.z > czm_epsilon7 ? hsb.z + u_hsbShift.z : 0.0; // brightness
    // Convert shifted hsb back to rgb
    rgb = czm_HSBToRGB(hsb);
#endif
    return rgb;
} 
`+Cesium._shadersGroundAtmosphereOld+`
`+g,t._scene.fog.enabled&&(g=`#define FOG 

`+g)}else if(m.indexOf("u_modelViewProj")>-1&&m.indexOf("u_projectionMatrix")>-1){m=`
 varying vec4 v_viewPosition; 
`+m;var p=`v_viewPosition = u_projectionMatrix*u_modelViewProj * vec4(a_position.xyz, 1.0); 
`;m.indexOf("gltf_a_dec_position")!=-1&&(p=`v_viewPosition = u_projectionMatrix*u_modelViewProj * vec4(gltf_a_dec_position.xyz, 1.0); 
`);var v=m.lastIndexOf("}");v&&(m=m.slice(0,v)+p+m.slice(v)),g=`
varying vec4 v_viewPosition; 
#if defined(FOG) && (defined(ENABLE_VERTEX_LIGHTING) || defined(ENABLE_DAYNIGHT_SHADING)) || defined(GROUND_ATMOSPHERE) 
uniform float u_minimumBrightness ;
#endif 
vec3 colorCorrect(vec3 rgb) {
#ifdef COLOR_CORRECT
    // Convert rgb color to hsb
    vec3 hsb = czm_RGBToHSB(rgb);
    // Perform hsb shift
    hsb.x += u_hsbShift.x; // hue
    hsb.y = clamp(hsb.y + u_hsbShift.y, 0.0, 1.0); // saturation
    hsb.z = hsb.z > czm_epsilon7 ? hsb.z + u_hsbShift.z : 0.0; // brightness
    // Convert shifted hsb back to rgb
    rgb = czm_HSBToRGB(hsb);
#endif
    return rgb;
} 
`+Cesium._shadersGroundAtmosphereOld+`
`+g,t._scene.fog.enabled&&(g=`#define FOG 

`+g)}}var _=t._imageBasedLightingFactor.x>0||t._imageBasedLightingFactor.y>0;if(_&&(g=`#define USE_IBL_LIGHTING 

`+g),Cesium.defined(t._lightColor)&&(g=`#define USE_CUSTOM_LIGHT_COLOR 

`+g),(t._sourceVersion!=="2.0"||t._sourceKHRTechniquesWebGL)&&(g=Cesium.ShaderSource.replaceMain(g,"non_gamma_corrected_main"),g=g+`
void main() { 
    non_gamma_corrected_main(); 
    gl_FragColor = czm_gammaCorrect(gl_FragColor); 
} 
`),Cesium.defined(t._scene)&&Cesium.defined(t._scene.ev_Fog)&&t._scene.ev_Fog.enabled){var y=`
#if defined(FOG)
  vec4 finalColor =  gl_FragColor; 
  float vDistance =  length(v_viewPosition.xyz); 
  vec4 worldPosition = czm_inverseView3D * v_viewPosition;  AtmosphereColor atmosFogColor = computeGroundAtmosphereFromSpace(vec3(worldPosition.x, worldPosition.y, worldPosition.z), false, vec3(0.0));
  vec3 fogColor = colorCorrect(atmosFogColor.mie) + finalColor.rgb * colorCorrect(atmosFogColor.rayleigh);
 #ifndef HDR
  const float fExposure = 4.0;
  fogColor = vec3(1.0) - exp(-fExposure * fogColor);
 #endif
 #ifdef FOG
   #if defined(ENABLE_VERTEX_LIGHTING) || defined(ENABLE_DAYNIGHT_SHADING)
      float darken = clamp(dot(normalize(czm_viewerPositionWC), normalize(czm_sunPositionWC)), u_minimumBrightness, 1.0);
      fogColor *= darken;
   #endif
   #ifdef HDR
       const float modifier = 0.15;
      finalColor = vec4(czm_fog(vDistance, finalColor.rgb, fogColor, modifier), finalColor.a);
    #else
      finalColor = vec4(czm_fog(vDistance, finalColor.rgb, fogColor), finalColor.a);
    #endif
 #endif
 gl_FragColor = finalColor;
#endif
`,x=g.lastIndexOf("}");x&&(g=g.slice(0,x)+y+g.slice(x))}if(Cesium.OctahedralProjectedCubeMap.isSupported(r)){var E=Cesium.defined(t._sphericalHarmonicCoefficients)||t._useDefaultSphericalHarmonics,S=Cesium.defined(t._specularEnvironmentMapAtlas)&&t._specularEnvironmentMapAtlas.ready||t._useDefaultSpecularMaps,I=!l&&(E||S||_);I&&(g=`uniform mat4 gltf_clippingPlanesMatrix; 
`+g),Cesium.defined(t._sphericalHarmonicCoefficients)?g=`#define DIFFUSE_IBL 
#define CUSTOM_SPHERICAL_HARMONICS 
uniform vec3 gltf_sphericalHarmonicCoefficients[9]; 
`+g:t._useDefaultSphericalHarmonics&&(g=`#define DIFFUSE_IBL 
`+g),Cesium.defined(t._specularEnvironmentMapAtlas)&&t._specularEnvironmentMapAtlas.ready?g=`#define SPECULAR_IBL 
#define CUSTOM_SPECULAR_IBL 
uniform sampler2D gltf_specularMap; 
uniform vec2 gltf_specularMapSize; 
uniform float gltf_maxSpecularLOD; 
`+g:t._useDefaultSpecularMaps&&(g=`#define SPECULAR_IBL 
`+g)}Cesium.defined(t._luminanceAtZenith)&&(g=`#define USE_SUN_LUMINANCE 
uniform float gltf_luminanceAtZenith;
`+g),Ev(n,i,g,m,t,r)}function Ev(e,t,r,n,i,s){var a=i._sourceTechniques[t],o=ee.createAttributeLocations(a,i._precreatedAttributes);typeof r=="string"&&(r=r.replace(/czm_phong\(normalize\(positionToEyeEC\)\, material\)/g,"czm_phong(normalize(positionToEyeEC), material,czm_lightDirectionEC)")),i.isExternal=!0,i._rendererResources.programs[e]=Cesium.ShaderProgram.fromCache({context:s,vertexShaderSource:n,fragmentShaderSource:r,attributeLocations:o,isExternal:!0})}var nv=new ud;function dS(e,t){var r=e._loadResources,n=r.programsToCreate;if(r.pendingShaderLoads===0&&r.pendingBufferLoads===0){var i=t.context;if(e.asynchronous)for(;n.length>0&&(nv.set(n.peek(),e,i),!!t.jobScheduler.execute(nv,Cesium.JobType.PROGRAM));)n.dequeue();else for(;n.length>0;)yv(n.dequeue(),e,i)}}function mS(e,t){return function(r){e.texturesToCreate.enqueue({id:t.id,image:r,bufferView:void 0}),--e.pendingBufferViewToImage}}function pS(e){var t=e._loadResources;if(t.pendingBufferLoads===0)for(;t.texturesToCreateFromBufferView.length>0;){var r=t.texturesToCreateFromBufferView.dequeue(),n=e.gltf,i=n.bufferViews[r.bufferView],s=n.textures[r.id].source,a=ee.getFailedLoadFunction(e,"image","id: "+r.id+", bufferView: "+r.bufferView);if(r.mimeType==="image/ktx")za(t.getBuffer(i)).then(Ha(e,r.id,s)).otherwise(a),++e._loadResources.pendingTextureLoads;else if(r.mimeType==="image/crn")Va(t.getBuffer(i)).then(Ha(e,r.id,s)).otherwise(a),++e._loadResources.pendingTextureLoads;else if(r.mimeType==="image/pkm")Cesium.EV_LoadETC(t.getBuffer(i)).then(Ha(e,r.id,s)).otherwise(a),++e._loadResources.pendingTextureLoads;else{var o=mS(t,r);Cesium.loadImageFromTypedArray({uint8Array:t.getBuffer(i),format:r.mimeType,flipY:!1}).then(o).catch(a),++t.pendingBufferViewToImage}}}function gS(e){var t=e._loadResources;if(t.createSamplers){t.createSamplers=!1;var r=e._rendererResources.samplers;Cesium.ForEach.sampler(e.gltf,function(n,i){r[i]=new Cesium.Sampler({wrapS:n.wrapS,wrapT:n.wrapT,minificationFilter:n.minFilter,magnificationFilter:n.magFilter})})}}var fd=function(){this.gltfTexture=void 0,this.model=void 0,this.context=void 0};fd.prototype.set=function(e,t,r){this.gltfTexture=e,this.model=t,this.context=r};fd.prototype.execute=function(){bv(this.gltfTexture,this.model,this.context)};function bv(e,t,r){var n=t.gltf.textures,i=n[e.id],s=t._rendererResources.samplers,a=s[i.sampler];Cesium.defined(a)||(a=new Cesium.Sampler({wrapS:Cesium.TextureWrap.REPEAT,wrapT:Cesium.TextureWrap.REPEAT}));for(var o=!1,u=t.gltf.materials,f=u.length,l=0;l<f;++l){var c=u[l];if(Cesium.defined(c.extensions)&&Cesium.defined(c.extensions.KHR_techniques_webgl)){var h=c.extensions.KHR_techniques_webgl.values;for(var d in h)if(h.hasOwnProperty(d)&&d.indexOf("Texture")!==-1){var m=h[d];if(m.index===e.id&&Cesium.defined(m.extensions)&&Cesium.defined(m.extensions.KHR_texture_transform)){o=!0;break}}}if(o)break}var g=a.wrapS,p=a.wrapT,v=a.minificationFilter;o&&v!==Cesium.TextureMinificationFilter.LINEAR&&v!==Cesium.TextureMinificationFilter.NEAREST&&(v===Cesium.TextureMinificationFilter.NEAREST_MIPMAP_NEAREST||v===Cesium.TextureMinificationFilter.NEAREST_MIPMAP_LINEAR?v=Cesium.TextureMinificationFilter.NEAREST:v=Cesium.TextureMinificationFilter.LINEAR,a=new Cesium.Sampler({wrapS:a.wrapS,wrapT:a.wrapT,textureMinificationFilter:v,textureMagnificationFilter:a.magnificationFilter}));var _=e.internalFormat,y=!(Cesium.defined(_)&&Cesium.PixelFormat.isCompressedFormat(_))&&(v===Cesium.TextureMinificationFilter.NEAREST_MIPMAP_NEAREST||v===Cesium.TextureMinificationFilter.NEAREST_MIPMAP_LINEAR||v===Cesium.TextureMinificationFilter.LINEAR_MIPMAP_NEAREST||v===Cesium.TextureMinificationFilter.LINEAR_MIPMAP_LINEAR),x=y||g===Cesium.TextureWrap.REPEAT||g===Cesium.TextureWrap.MIRRORED_REPEAT||p===Cesium.TextureWrap.REPEAT||p===Cesium.TextureWrap.MIRRORED_REPEAT,E,S;if(Cesium.defined(e.image.length)?S=Cesium.clone(e.image,!1):S=e.image,Cesium.defined(_)){I=!Cesium.Math.isPowerOfTwo(e.width)||!Cesium.Math.isPowerOfTwo(e.height),!r.webgl2&&Cesium.PixelFormat.isCompressedFormat(_)&&I&&x&&console.warn("Compressed texture uses REPEAT or MIRRORED_REPEAT texture wrap mode and dimensions are not powers of two. The texture may be rendered incorrectly. See the Model.js constructor documentation for more information.");let B=a.minificationFilter;!Cesium.defined(e.mipLevels)&&(v===Cesium.TextureMinificationFilter.NEAREST_MIPMAP_NEAREST||v===Cesium.TextureMinificationFilter.NEAREST_MIPMAP_LINEAR)?B=Cesium.TextureMinificationFilter.NEAREST:!Cesium.defined(e.mipLevels)&&(v===Cesium.TextureMinificationFilter.LINEAR_MIPMAP_NEAREST||v===Cesium.TextureMinificationFilter.LINEAR_MIPMAP_LINEAR)&&(B=Cesium.TextureMinificationFilter.LINEAR),a=new Cesium.Sampler({wrapS:a.wrapS,wrapT:a.wrapT,minificationFilter:B,magnificationFilter:a.magnificationFilter}),E=new Ir({context:r,source:{arrayBufferView:e.bufferView},width:e.width,height:e.height,pixelFormat:_,sampler:a})}else if(Cesium.defined(S)){if(Cesium.defined(S.width)&&Cesium.defined(S.height)){var I=!Cesium.Math.isPowerOfTwo(S.width)||!Cesium.Math.isPowerOfTwo(S.height);if(x&&I){var P=document.createElement("canvas");P.width=Cesium.Math.nextPowerOfTwo(S.width),P.height=Cesium.Math.nextPowerOfTwo(S.height);var w=P.getContext("2d",{willReadFrequently:!0});w.drawImage(S,0,0,S.width,S.height,0,0,P.width,P.height),S=P}E=new Ir({context:r,source:S,pixelFormat:i.internalFormat,sampler:a,flipY:!1}),y&&E.generateMipmap()}else if(Cesium.defined(S.length)&&S.length>0){var N=S[0];E=new Ir({context:r,source:S,width:N.width,height:N.height,pixelFormat:N.internalFormat,sampler:a})}}Cesium.defined(E)&&(t._rendererResources.textures[e.id]=E,t._texturesByteLength+=E.sizeInBytes)}var iv=new fd;function vS(e,t){var r=t.context,n=e._loadResources.texturesToCreate;if(e.asynchronous)for(;n.length>0&&(iv.set(n.peek(),e,r),!!t.jobScheduler.execute(iv,Cesium.JobType.TEXTURE));)n.dequeue();else for(;n.length>0;)bv(n.dequeue(),e,r)}function _S(e,t){var r=e._sourceTechniques,n={},i,s,a=e._runtime.materialsById[t.material];if(!Cesium.defined(a))return n;var o=r[a._technique];if(!Cesium.defined(o))return n;var u=o.attributes,f=e._rendererResources.programs[o.program],l=f.vertexAttributes,c=f._attributeLocations;for(i in l)if(l.hasOwnProperty(i)){var h=u[i];Cesium.defined(h)&&(s=c[i],n[h.semantic]=s)}var d=e._precreatedAttributes;if(Cesium.defined(d))for(i in d)d.hasOwnProperty(i)&&(s=c[i],n[i]=s);return n}function CS(e,t){for(var r=e.gltf,n=r.skins,i=r.nodes,s=e._runtime.nodes,a=e._loadResources.skinnedNodesIds,o=a.length,u=0;u<o;++u){var f=a[u],l=s[f],c=i[f],h=t[c.skin];l.inverseBindMatrices=h.inverseBindMatrices,l.bindShapeMatrix=h.bindShapeMatrix;for(var d=n[c.skin].joints,m=d.length,g=0;g<m;++g){var p=d[g],v=s[p];l.joints.push(v)}}}function yS(e){var t=e._loadResources;if(t.pendingBufferLoads===0&&t.createSkins){t.createSkins=!1;var r=e.gltf,n=r.accessors,i={};Cesium.ForEach.skin(r,function(s,a){var o=n[s.inverseBindMatrices],u;Cesium.Matrix4.equals(s.bindShapeMatrix,Cesium.Matrix4.IDENTITY)||(u=Cesium.Matrix4.clone(s.bindShapeMatrix)),i[a]={inverseBindMatrices:Cesium.ModelAnimationCache.getSkinInverseBindMatrices(e,o),bindShapeMatrix:u}}),CS(e,i)}}function xS(e,t,r,n){return function(i){Cesium.defined(n)&&(i=e.clampAnimations?n.clampTime(i):n.wrapTime(i),t[r]=n.evaluate(i,t[r]),t.dirtyNumber=e._maxDirtyNumber)}}function ES(e){var t=e._loadResources;if(t.finishedPendingBufferLoads()&&t.createRuntimeAnimations){t.createRuntimeAnimations=!1,e._runtime.animations=[];var r=e._runtime.nodes,n=e.gltf.accessors;Cesium.ForEach.animation(e.gltf,function(i,s){for(var a=i.channels,o=i.samplers,u=Number.MAX_VALUE,f=-Number.MAX_VALUE,l=a.length,c=new Array(l),h=0;h<l;++h){var d=a[h],m=d.target,g=m.path,p=o[d.sampler],v=Cesium.ModelAnimationCache.getAnimationParameterValues(e,n[p.input]),_=Cesium.ModelAnimationCache.getAnimationParameterValues(e,n[p.output]);u=Math.min(u,v[0]),f=Math.max(f,v[v.length-1]);var y=Cesium.ModelAnimationCache.getAnimationSpline(e,s,i,d.sampler,p,v,g,_);c[h]=xS(e,r[m.node],m.path,y)}e._runtime.animations[s]={name:i.name,startTime:u,stopTime:f,channelEvaluators:c}})}}function sv(e,t){var r=e._loadResources;if(!(!r.finishedBuffersCreation()||!r.finishedProgramCreation()||!r.createVertexArrays)){r.createVertexArrays=!1;var n=e._rendererResources.buffers,i=e._rendererResources.vertexArrays,s=e.gltf,a=s.accessors;Cesium.ForEach.mesh(s,function(o,u){Cesium.ForEach.meshPrimitive(o,function(f,l){var c=[],h,d=_S(e,f),m=e._decodedData[u+".primitive."+l];Cesium.ForEach.meshPrimitiveAttribute(f,function(E,S){if(h=d[S],Cesium.defined(h)){if(Cesium.defined(m)){var I=m.attributes;if(I.hasOwnProperty(S)){var P=I[S];c.push({index:h,vertexBuffer:n[P.bufferView],componentsPerAttribute:P.componentsPerAttribute,componentDatatype:P.componentDatatype,normalize:P.normalized,offsetInBytes:P.byteOffset,strideInBytes:P.byteStride});return}}var w=a[E],N=Cesium.defined(w.normalized)&&w.normalized;c.push({index:h,vertexBuffer:n[w.bufferView],componentsPerAttribute:Cesium.numberOfComponentsForType(w.type),componentDatatype:w.componentType,normalize:N,offsetInBytes:w.byteOffset,strideInBytes:Cesium.getAccessorByteStride(s,w)})}});var g,p,v=e._precreatedAttributes;if(Cesium.defined(v))for(p in v)v.hasOwnProperty(p)&&(h=d[p],Cesium.defined(h)&&(g=v[p],g.index=h,c.push(g)));var _;if(Cesium.defined(f.indices)){var y=a[f.indices],x=y.bufferView;Cesium.defined(m)&&(x=m.bufferView),_=n[x]}i[u+".primitive."+l]=new Cesium.VertexArray({context:t,attributes:c,indexBuffer:_})})})}}function bS(e){var t=e._loadResources;t.createRenderStates&&(t.createRenderStates=!1,Cesium.ForEach.material(e.gltf,function(r,n){wS(e,r,n)}))}function wS(e,t,r){var n=e._rendererResources.renderStates,i=[Cesium.WebGLConstants.FUNC_ADD,Cesium.WebGLConstants.FUNC_ADD],s=[Cesium.WebGLConstants.ONE,Cesium.WebGLConstants.ONE_MINUS_SRC_ALPHA,Cesium.WebGLConstants.ONE,Cesium.WebGLConstants.ONE_MINUS_SRC_ALPHA];Cesium.defined(t.extensions)&&Cesium.defined(t.extensions.KHR_blend)&&(i=t.extensions.KHR_blend.blendEquation,s=t.extensions.KHR_blend.blendFactors);var a=!t.doubleSided,o=t.alphaMode==="BLEND";n[r]=Cesium.RenderState.fromCache({cull:{enabled:a},depthTest:{enabled:!0,func:Cesium.DepthFunction.LESS_OR_EQUAL},depthMask:!o,blending:{enabled:o,equationRgb:i[0],equationAlpha:i[1],functionSourceRgb:s[0],functionDestinationRgb:s[1],functionSourceAlpha:s[2],functionDestinationAlpha:s[3]}})}var SS={MODEL:function(e,t,r){return function(){return r.computedMatrix}},VIEW:function(e,t,r){return function(){return e.view}},PROJECTION:function(e,t,r){return function(){return e.projection}},MODELVIEW:function(e,t,r){var n=new Cesium.Matrix4;return function(){return Cesium.Matrix4.multiplyTransformation(e.view,r.computedMatrix,n)}},CESIUM_RTC_MODELVIEW:function(e,t,r){var n=new Cesium.Matrix4;return function(){return Cesium.Matrix4.multiplyTransformation(e.view,r.computedMatrix,n),Cesium.Matrix4.setTranslation(n,t._rtcCenterEye,n)}},MODELVIEWPROJECTION:function(e,t,r){var n=new Cesium.Matrix4;return function(){return Cesium.Matrix4.multiplyTransformation(e.view,r.computedMatrix,n),Cesium.Matrix4.multiply(e._projection,n,n)}},MODELINVERSE:function(e,t,r){var n=new Cesium.Matrix4;return function(){return Cesium.Matrix4.inverse(r.computedMatrix,n)}},VIEWINVERSE:function(e,t){return function(){return e.inverseView}},PROJECTIONINVERSE:function(e,t,r){return function(){return e.inverseProjection}},MODELVIEWINVERSE:function(e,t,r){var n=new Cesium.Matrix4,i=new Cesium.Matrix4;return function(){return Cesium.Matrix4.multiplyTransformation(e.view,r.computedMatrix,n),Cesium.Matrix4.inverse(n,i)}},MODELVIEWPROJECTIONINVERSE:function(e,t,r){var n=new Cesium.Matrix4,i=new Cesium.Matrix4;return function(){return Cesium.Matrix4.multiplyTransformation(e.view,r.computedMatrix,n),Cesium.Matrix4.multiply(e._projection,n,n),Cesium.Matrix4.inverse(n,i)}},MODELINVERSETRANSPOSE:function(e,t,r){var n=new Cesium.Matrix4,i=new Cesium.Matrix3;return function(){return Cesium.Matrix4.inverse(r.computedMatrix,n),Cesium.Matrix4.getMatrix3(n,i),Cesium.Matrix3.transpose(i,i)}},MODELVIEWINVERSETRANSPOSE:function(e,t,r){var n=new Cesium.Matrix4,i=new Cesium.Matrix4,s=new Cesium.Matrix3;return function(){return Cesium.Matrix4.multiplyTransformation(e.view,r.computedMatrix,n),Cesium.Matrix4.inverse(n,i),Cesium.Matrix4.getMatrix3(i,s),Cesium.Matrix3.transpose(s,s)}},VIEWPORT:function(e,t,r){return function(){return e.viewportCartesian4}}};function TS(e,t,r,n){var i=t._runtime.nodes[e];return SS[r](n,t,i)}function IS(e,t,r,n,i,s,a){var o={},u={},f,l;return Cesium.ForEach.techniqueUniform(r,function(c,h){var d;if(Cesium.defined(n)&&Cesium.defined(n[h]))d=ee.createUniformFunction(c.type,n[h],s,a),o[h]=d.func,u[h]=d;else if(Cesium.defined(c.node))o[h]=TS(c.node,e,c.semantic,i.uniformState);else if(Cesium.defined(c.semantic))if(c.semantic==="JOINTMATRIX")f=h;else if(c.semantic==="MORPHWEIGHTS")l=h;else if(c.semantic==="ALPHACUTOFF"){var m=t.alphaMode;if(Cesium.defined(m)&&m==="MASK"){var g=Cesium.defaultValue(t.alphaCutoff,.5);d=ee.createUniformFunction(c.type,g,s,a),o[h]=d.func,u[h]=d}}else o[h]=ee.getGltfSemanticUniforms()[c.semantic](i.uniformState,e);else if(Cesium.defined(c.value)){var p=ee.createUniformFunction(c.type,c.value,s,a);o[h]=p.func,u[h]=p}}),{map:o,values:u,jointMatrixUniformName:f,morphWeightsUniformName:l}}function LS(e,t){var r=e._loadResources;if(r.finishedProgramCreation()&&r.createUniformMaps){r.createUniformMaps=!1;var n=e.gltf,i=e._sourceTechniques,s=e._uniformMaps,a=e._rendererResources.textures,o=e._defaultTexture;Cesium.ForEach.material(n,function(u,f){var l=e._runtime.materialsById[f],c=i[l._technique],h=l._values,d=IS(e,u,c,h,t,a,o);d.map.u_rollerRegion=function(){return e.rollerRegion};var m=s[f];if(m.uniformMap=d.map,m.values=d.values,m.jointMatrixUniformName=d.jointMatrixUniformName,m.morphWeightsUniformName=d.morphWeightsUniformName,Cesium.defined(c.attributes.a_outlineCoordinates)){var g=Sl.createTexture(e,t);m.uniformMap.u_outlineTexture=function(){return g}}})}}function PS(e){return ee.createUniformsForDracoQuantizedAttributes(e.attributes)}function MS(e,t){var r=od(e,t),n=e._quantizedUniforms[r];return ee.createUniformsForQuantizedAttributes(e.gltf,t,n)}function AS(e){return function(){return e}}function DS(e){return function(){return e.computedJointMatrices}}function RS(e){return function(){return e.weights}}function OS(e){return function(){return e.silhouetteColor}}function NS(e){return function(){return e.silhouetteSize}}function FS(e){return function(){return e.color}}var BS=new Cesium.Matrix4;function VS(e){return function(){var t=e.clippingPlanes;if(!Cesium.defined(t)&&!Cesium.defined(e._sphericalHarmonicCoefficients)&&!Cesium.defined(e._specularEnvironmentMaps))return Cesium.Matrix4.IDENTITY;var r=Cesium.defined(t)?t.modelMatrix:Cesium.Matrix4.IDENTITY;return Cesium.Matrix4.multiply(e._clippingPlaneModelViewMatrix,r,BS)}}function zS(e){return function(){var t=e.clippingPlanes;return!Cesium.defined(t)||!t.enabled?e._defaultTexture:t.texture}}function kS(e){return function(){var t=e.clippingPlanes;if(!Cesium.defined(t))return Cesium.Color.WHITE.withAlpha(0);var r=Cesium.Color.clone(t.edgeColor);return r.alpha=t.edgeWidth,r}}function US(e){return function(){return Cesium.ColorBlendMode.getColorBlend(e.colorBlendMode,e.colorBlendAmount)}}function GS(e){return function(){return e._imageBasedLightingFactor}}function qS(e){return function(){return e._lightColor}}function HS(e){return function(){return e.luminanceAtZenith}}function WS(e){return function(){return e._sphericalHarmonicCoefficients}}function YS(e){return function(){return e._specularEnvironmentMapAtlas.texture}}function XS(e){return function(){return e._specularEnvironmentMapAtlas.texture.dimensions}}function jS(e){return function(){return e._specularEnvironmentMapAtlas.maximumMipmapLevel}}function KS(e,t){switch(e.mode){case Cesium.PrimitiveType.TRIANGLES:return t/3;case Cesium.PrimitiveType.TRIANGLE_STRIP:case Cesium.PrimitiveType.TRIANGLE_FAN:return Math.max(t-2,0);default:return 0}}function av(e,t,r,n,i){for(var s=e._nodeCommands,a=e._pickIds,o=e.allowPicking,u=e._runtime.meshesByName,f=e._rendererResources,l=f.vertexArrays,c=f.programs,h=f.renderStates,d=e._uniformMaps,m=e.gltf,g=m.accessors,p=m.meshes,v=t.mesh,_=p[v],y=_.primitives,x=y.length,E=0;E<x;++E){var S=y[E],I=g[S.indices],P=e._runtime.materialsById[S.material],w=P._program,N=e._decodedData[v+".primitive."+E],B,C=S.attributes.POSITION;if(Cesium.defined(C)){var b=ee.getAccessorMinMax(m,C);B=Cesium.BoundingSphere.fromCornerPoints(Cesium.Cartesian3.fromArray(b.min),Cesium.Cartesian3.fromArray(b.max))}var T=l[v+".primitive."+E],A,R;if(Cesium.defined(N))R=N.numberOfIndices,A=0;else if(Cesium.defined(I))R=I.count,A=I.byteOffset/Cesium.IndexDatatype.getSizeInBytes(I.componentType);else{var F=g[S.attributes.POSITION];R=F.count,A=0}e._trianglesLength+=KS(S,R);var D=d[S.material],O=D.uniformMap;if(Cesium.defined(D.jointMatrixUniformName)){var U={};U[D.jointMatrixUniformName]=DS(r),O=Cesium.combine(O,U)}if(e._tilesetFlat&&(O=Cesium.combine(O,e._tilesetFlat._updateModelUniformMap())),Cesium.defined(D.morphWeightsUniformName)){var q={};q[D.morphWeightsUniformName]=RS(r),O=Cesium.combine(O,q)}O=Cesium.combine(O,{gltf_color:FS(e),gltf_colorBlend:US(e),gltf_clippingPlanes:zS(e),gltf_clippingPlanesEdgeStyle:kS(e),gltf_clippingPlanesMatrix:VS(e),gltf_iblFactor:GS(e),gltf_lightColor:qS(e),gltf_sphericalHarmonicCoefficients:WS(e),gltf_specularMap:YS(e),gltf_specularMapSize:XS(e),gltf_maxSpecularLOD:jS(e),gltf_luminanceAtZenith:HS(e)}),Cesium.defined(e._uniformMapLoaded)&&(O=e._uniformMapLoaded(O,w,r));var Y={};e.extensionsUsed.WEB3D_quantized_attributes?Y=MS(e,S):e._dequantizeInShader&&Cesium.defined(N)&&(Y=PS(N)),O=Cesium.combine(O,Y);var W=h[S.material],K=W.blending.enabled,re=e._pickObject;Cesium.defined(re)||(re={primitive:e,id:e.id,node:r.publicNode,mesh:u[_.name]});var ce=Cesium.ShadowMode.castShadows(e._shadows),Se=Cesium.ShadowMode.receiveShadows(e._shadows),de;if(o&&!Cesium.defined(e._uniformMapLoaded)){de=n.createPickId(re),a.push(de);var Ae={czm_pickColor:AS(de.color)};O=Cesium.combine(O,Ae)}o&&(Cesium.defined(e._pickIdLoaded)&&Cesium.defined(e._uniformMapLoaded)?de=e._pickIdLoaded():de="czm_pickColor");var ye=new Cesium.DrawCommand({boundingVolume:new Cesium.BoundingSphere,cull:e.cull,modelMatrix:new Cesium.Matrix4,primitiveType:S.mode,vertexArray:T,count:R,offset:A,shaderProgram:c[w],castShadows:ce,receiveShadows:Se,uniformMap:O,renderState:W,owner:re,pass:K?Cesium.Pass.TRANSLUCENT:e.opaquePass,pickId:de}),Ie;i||(Ie=Cesium.DrawCommand.shallowClone(ye),Ie.boundingVolume=new Cesium.BoundingSphere,Ie.modelMatrix=new Cesium.Matrix4);var $={show:!0,boundingSphere:B,command:ye,command2D:Ie,silhouetteModelCommand:void 0,silhouetteModelCommand2D:void 0,silhouetteColorCommand:void 0,silhouetteColorCommand2D:void 0,translucentCommand:void 0,translucentCommand2D:void 0,programId:w};r.commands.push($),s.push($)}}function QS(e,t,r){var n=e._loadResources;if(n.finishedEverythingButTextureCreation()&&n.createRuntimeNodes){n.createRuntimeNodes=!1;for(var i=[],s=e._runtime.nodes,a=e.gltf,o=a.nodes,u=a.scenes[a.scene],f=u.nodes,l=f.length,c=[],h={},d=new Cesium.AssociativeArray,m=!1,g=a.asset.version,p=0;p<l;++p)for(c.push({parentRuntimeNode:void 0,gltfNode:o[f[p]],id:f[p]});c.length>0;){var v=c.pop();h[v.id]=!0;var _=v.parentRuntimeNode,y=v.gltfNode,x=s[v.id];if(x.parents.length===0)if(Cesium.defined(y.matrix))x.matrix=Cesium.Matrix4.fromColumnMajorArray(y.matrix);else{var E=y.rotation;x.translation=Cesium.Cartesian3.fromArray(y.translation),x.rotation=Cesium.Quaternion.unpack(E),x.scale=Cesium.Cartesian3.fromArray(y.scale)}if(Cesium.defined(_)?(_.children.push(x),x.parents.push(_)):i.push(x),Cesium.defined(y.instanceIndex)&&Cesium.defined(e.content)&&g=="2.0"){var S=y.mesh;if(e.content instanceof aa)if(Cesium.defined(y.matrix)){var I=Cesium.Matrix4.clone(y.matrix,new Cesium.Matrix4);I[1]=-y.matrix[2],I[2]=y.matrix[1],I[4]=-y.matrix[8],I[5]=y.matrix[10],I[6]=-y.matrix[9],I[8]=y.matrix[4],I[9]=-y.matrix[6],I[10]=y.matrix[5],I[13]=-y.matrix[14],I[14]=y.matrix[13],d.contains(S)?d.get(S).push({_modelMatrix:I,_nodeId:v.id,_instanceId:y.instanceIndex}):d.set(S,[{_modelMatrix:I,_nodeId:v.id,_instanceId:y.instanceIndex}])}else console.log("node.matrix is empty");m=!0}else Cesium.defined(y.mesh)&&av(e,y,x,t,r.scene3DOnly);var P=y.children;if(Cesium.defined(P))for(var w=P.length,N=0;N<w;N++){var B=P[N];h[B]||c.push({parentRuntimeNode:x,gltfNode:o[B],id:P[N]})}}e.ev_E3MInternalInstance&&(m&&d.length>0&&e.content instanceof aa?(e._releaseGltfJson=!1,e.ev_E3MInternalInstance.generateInstanceCommandByGltf(e,t,d,r)):m&&e.content instanceof zu&&(o[0].matrix=Cesium.Matrix4.clone(Cesium.Matrix4.IDENTITY),s[0].matrix=Cesium.Matrix4.clone(Cesium.Matrix4.IDENTITY),av(e,o[0],s[0],t,r.scene3DOnly))),e._runtime.rootNodes=i,e._runtime.nodes=s}}function ZS(e){var t=0;for(var r in e)e.hasOwnProperty(r)&&(t+=e[r].sizeInBytes);return t}function JS(e){var t=0;for(var r in e)e.hasOwnProperty(r)&&(t+=e[r].sizeInBytes);return t}function ov(e,t){var r=t.context,n=t.scene3DOnly,i=e._quantizedVertexShaders,s=e._toClipCoordinatesGLSL={},a=e._sourceTechniques,o=e._sourcePrograms,u=e._rendererResources,f=u.sourceShaders;e._loadRendererResourcesFromCache&&(f=u.sourceShaders=e._cachedRendererResources.sourceShaders);for(var l in a)if(a.hasOwnProperty(l)){var c=a[l].program,h=o[c],d=f[h.vertexShader];if(ee.checkSupportedGlExtensions(h.glExtensions,r),e.extensionsUsed.WEB3D_quantized_attributes||e._dequantizeInShader){var m=i[c];Cesium.defined(m)||(m=Cv(d,c,e),i[c]=m),d=m}d=qu(d,c,e._vertexShaderLoaded),s[c]=ee.toClipCoordinatesGLSL(e.gltf,d)}if(e._loadRendererResourcesFromCache){var g=e._cachedRendererResources;u.buffers=g.buffers,u.vertexArrays=g.vertexArrays,u.programs=g.programs,u.silhouettePrograms=g.silhouettePrograms,u.textures=g.textures,u.samplers=g.samplers,u.renderStates=g.renderStates,Cesium.defined(e._precreatedAttributes)&&sv(e,r),e._cachedGeometryByteLength+=ZS(g.buffers),e._cachedTexturesByteLength+=JS(g.textures)}else lS(e,t),dS(e,t),gS(e,r),pS(e),vS(e,t);yS(e),ES(e),e._loadRendererResourcesFromCache||(sv(e,r),bS(e)),LS(e,r),QS(e,r,t)}function uv(e,t){var r=e.publicNode,n=r.matrix;r.useMatrix&&Cesium.defined(n)?Cesium.Matrix4.clone(n,t):Cesium.defined(e.matrix)?Cesium.Matrix4.clone(e.matrix,t):(Cesium.Matrix4.fromTranslationQuaternionRotationScale(e.translation,e.rotation,e.scale,t),r.matrix=t)}var wv=[],$S=new Cesium.Cartesian4,Zh=new Cesium.Matrix4;function eT(e,t,r,n){var i=e._maxDirtyNumber,s=e._runtime.rootNodes,a=s.length,o=wv,u=e._computedModelMatrix;if(e._mode!==Cesium.SceneMode.SCENE3D&&!e._ignoreCommands){var f=Cesium.Matrix4.getColumn(u,3,$S);if(!Cesium.Cartesian4.equals(f,Cesium.Cartesian4.UNIT_W))u=Cesium.Transforms.basisTo2D(n,u,Zh),e._rtcCenter=e._rtcCenter3D;else{var l=e.boundingSphere.center,c=Cesium.Transforms.wgs84To2DModelMatrix(n,l,Zh);u=Cesium.Matrix4.multiply(c,u,Zh),Cesium.defined(e._rtcCenter)&&(Cesium.Matrix4.setTranslation(u,Cesium.Cartesian4.UNIT_W,u),e._rtcCenter=e._rtcCenter2D)}}var h=Cesium.Matrix4.clone(Cesium.Matrix4.IDENTITY);e._upAxis===Cesium.Axis.Y?Cesium.Matrix4.multiplyTransformation(h,Cesium.Axis.Y_UP_TO_Z_UP,h):e._upAxis===Cesium.Axis.X&&Cesium.Matrix4.multiplyTransformation(h,Cesium.Axis.X_UP_TO_Z_UP,h),e.forwardAxis===Cesium.Axis.Z&&Cesium.Matrix4.multiplyTransformation(h,Cesium.Axis.Z_UP_TO_X_UP,h);for(var d=0;d<a;++d){var m=s[d];for(uv(m,m.transformToRoot),o.push(m);o.length>0;){m=o.pop();var g=m.transformToRoot,p=m.commands;if(m.dirtyNumber===i||t||r){var v=Cesium.Matrix4.clone(Cesium.Matrix4.IDENTITY);!Cesium.defined(m.gltfInstaced)||!m.gltfInstaced?v=Cesium.Matrix4.multiplyTransformation(u,g,m.computedMatrix):v=Cesium.Matrix4.multiplyTransformation(h,g,m.computedMatrix);var _=p.length;if(_>0)for(var y=0;y<_;++y){var x=p[y],E=x.command;Cesium.Matrix4.clone(v,E.modelMatrix),(!Cesium.defined(m.gltfInstaced)||!m.gltfInstaced)&&Cesium.BoundingSphere.transform(x.boundingSphere,E.modelMatrix,E.boundingVolume),Cesium.defined(e._rtcCenter)&&Cesium.Cartesian3.add(e._rtcCenter,E.boundingVolume.center,E.boundingVolume.center),E=x.command2D,Cesium.defined(E)&&e._mode===Cesium.SceneMode.SCENE2D&&(Cesium.Matrix4.clone(v,E.modelMatrix),E.modelMatrix[13]-=Cesium.Math.sign(E.modelMatrix[13])*2*Cesium.Math.PI*n.ellipsoid.maximumRadius,Cesium.BoundingSphere.transform(x.boundingSphere,E.modelMatrix,E.boundingVolume))}}var S=m.children;if(Cesium.defined(S))for(var I=S.length,P=0;P<I;++P){var w=S[P];w.dirtyNumber=Math.max(w.dirtyNumber,m.dirtyNumber),(w.dirtyNumber===i||r)&&(uv(w,w.transformToRoot),Cesium.Matrix4.multiplyTransformation(g,w.transformToRoot,w.transformToRoot)),o.push(w)}}}++e._maxDirtyNumber}var Jh=new Cesium.Matrix4;function tT(e){for(var t=e._runtime.skinnedNodes,r=t.length,n=0;n<r;++n){var i=t[n];Jh=Cesium.Matrix4.inverseTransformation(i.transformToRoot,Jh);for(var s=i.computedJointMatrices,a=i.joints,o=i.bindShapeMatrix,u=i.inverseBindMatrices,f=u.length,l=0;l<f;++l)Cesium.defined(s[l])||(s[l]=new Cesium.Matrix4),s[l]=Cesium.Matrix4.multiplyTransformation(Jh,a[l].transformToRoot,s[l]),s[l]=Cesium.Matrix4.multiplyTransformation(s[l],u[l],s[l]),Cesium.defined(o)&&(s[l]=Cesium.Matrix4.multiplyTransformation(s[l],o,s[l]))}}function rT(e){for(var t=e._runtime.rootNodes,r=t.length,n=wv,i=0;i<r;++i){var s=t[i];for(s.computedShow=s.publicNode.show,n.push(s);n.length>0;){s=n.pop();for(var a=s.computedShow,o=s.commands,u=o.length,f=0;f<u;++f)o[f].show=a;var l=s.children;if(Cesium.defined(l))for(var c=l.length,h=0;h<c;++h){var d=l[h];d.computedShow=a&&d.publicNode.show,n.push(d)}}}}function nT(e,t){var r=e.id;if(e._id!==r){e._id=r;for(var n=e._pickIds,i=n.length,s=0;s<i;++s)n[s].object.id=r}}function iT(e){if(e._debugWireframe!==e.debugWireframe){e._debugWireframe=e.debugWireframe;for(var t=e.debugWireframe?Cesium.PrimitiveType.LINES:Cesium.PrimitiveType.TRIANGLES,r=e._nodeCommands,n=r.length,i=0;i<n;++i)r[i].command.primitiveType=t}}function sT(e){if(e.debugShowBoundingVolume!==e._debugShowBoundingVolume){e._debugShowBoundingVolume=e.debugShowBoundingVolume;for(var t=e.debugShowBoundingVolume,r=e._nodeCommands,n=r.length,i=0;i<n;++i)r[i].command.debugShowBoundingVolume=t}}function aT(e){if(e.shadows!==e._shadows){e._shadows=e.shadows;for(var t=Cesium.ShadowMode.castShadows(e.shadows),r=Cesium.ShadowMode.receiveShadows(e.shadows),n=e._nodeCommands,i=n.length,s=0;s<i;s++){var a=n[s];a.command.castShadows=t,a.command.receiveShadows=r}}}function oT(e){var t=Cesium.clone(e,!0);return t.cull.enabled=!1,t.depthTest.enabled=!0,t.depthMask=!1,t.blending=Cesium.BlendingState.ALPHA_BLEND,Cesium.RenderState.fromCache(t)}function fv(e){var t=Cesium.DrawCommand.shallowClone(e);return t.pass=Cesium.Pass.TRANSLUCENT,t.renderState=oT(e.renderState),t}function Sv(e,t,r){var n=t.scene3DOnly,i=e.color.alpha;if(i>0&&i<1){var s=e._nodeCommands,a=s.length;if(a>0&&!Cesium.defined(s[0].translucentCommand)||r)for(var o=0;o<a;++o){var u=s[o],f=u.command;if(u.translucentCommand=fv(f),!n){var l=u.command2D;u.translucentCommand2D=fv(l)}}}}function uT(e,t){var r=e._rendererResources.programs;for(var n in r)if(r.hasOwnProperty(n)&&r[n]===t)return n}function fT(e,t,r){var n=t.vertexShaderSource.sources[0],i=t._attributeLocations,s=e._normalAttributeName;n=Cesium.ShaderSource.replaceMain(n,"gltf_silhouette_main"),n+=`uniform float gltf_silhouetteSize; 
void main() 
{ 
    gltf_silhouette_main(); 
    vec3 n = normalize(czm_normal3D * `+s+`); 
    n.x *= czm_projection[0][0]; 
    n.y *= czm_projection[1][1]; 
    vec4 clip = gl_Position; 
    clip.xy += n.xy * clip.w * gltf_silhouetteSize * czm_pixelRatio / czm_viewport.z; 
    gl_Position = clip; 
}`;var a=`uniform vec4 gltf_silhouetteColor; 
void main() 
{ 
    gl_FragColor = czm_gammaCorrect(gltf_silhouetteColor); 
}`;return Cesium.ShaderProgram.fromCache({context:r.context,vertexShaderSource:n,fragmentShaderSource:a,attributeLocations:i})}function Tv(e,t){return hv(t.context)&&e.silhouetteSize>0&&e.silhouetteColor.alpha>0&&Cesium.defined(e._normalAttributeName)}function lT(e){for(var t=e._nodeCommands,r=t.length,n=0;n<r;++n){var i=t[n],s=i.command;if(s.pass===Cesium.Pass.TRANSLUCENT)return!0}return!1}function ed(e){return e.color.alpha>0&&e.color.alpha<1}function Iv(e){return e.color.alpha===0}function lv(e,t){return Math.floor(e)!==Math.floor(t)||Math.ceil(e)!==Math.ceil(t)}var cT=0;function hT(e,t){for(var r=++cT%255,n=lT(e)||ed(e)||e.silhouetteColor.alpha<1,i=e._rendererResources.silhouettePrograms,s=t.scene3DOnly,a=e._nodeCommands,o=a.length,u=0;u<o;++u){var f=a[u],l=f.command,c=ed(e)?f.translucentCommand:l,h=Cesium.DrawCommand.shallowClone(c),d=Cesium.clone(c.renderState);d.stencilTest={enabled:!0,frontFunction:Cesium.WebGLConstants.ALWAYS,backFunction:Cesium.WebGLConstants.ALWAYS,reference:r,mask:-1,frontOperation:{fail:Cesium.WebGLConstants.KEEP,zFail:Cesium.WebGLConstants.KEEP,zPass:Cesium.WebGLConstants.REPLACE},backOperation:{fail:Cesium.WebGLConstants.KEEP,zFail:Cesium.WebGLConstants.KEEP,zPass:Cesium.WebGLConstants.REPLACE}},Iv(e)&&(d.colorMask={red:!1,green:!1,blue:!1,alpha:!1},d.depthMask=!1),d=Cesium.RenderState.fromCache(d),h.renderState=d,f.silhouetteModelCommand=h;var m=Cesium.DrawCommand.shallowClone(l);d=Cesium.clone(l.renderState,!0),d.depthTest.enabled=!0,d.cull.enabled=!1,n&&(m.pass=Cesium.Pass.TRANSLUCENT,d.depthMask=!1,d.blending=Cesium.BlendingState.ALPHA_BLEND),d.stencilTest={enabled:!0,frontFunction:Cesium.WebGLConstants.NOTEQUAL,backFunction:Cesium.WebGLConstants.NOTEQUAL,reference:r,mask:-1,frontOperation:{fail:Cesium.WebGLConstants.KEEP,zFail:Cesium.WebGLConstants.KEEP,zPass:Cesium.WebGLConstants.KEEP},backOperation:{fail:Cesium.WebGLConstants.KEEP,zFail:Cesium.WebGLConstants.KEEP,zPass:Cesium.WebGLConstants.KEEP}},d=Cesium.RenderState.fromCache(d);var g=l.shaderProgram,p=uT(e,g),v=i[p];Cesium.defined(v)||(v=fT(e,g,t),i[p]=v);var _=Cesium.combine(l.uniformMap,{gltf_silhouetteColor:OS(e),gltf_silhouetteSize:NS(e)});if(m.renderState=d,m.shaderProgram=v,m.uniformMap=_,m.castShadows=!1,m.receiveShadows=!1,f.silhouetteColorCommand=m,!s){var y=f.command2D,x=Cesium.DrawCommand.shallowClone(h);x.boundingVolume=y.boundingVolume,x.modelMatrix=y.modelMatrix,f.silhouetteModelCommand2D=x;var E=Cesium.DrawCommand.shallowClone(m);x.boundingVolume=y.boundingVolume,x.modelMatrix=y.modelMatrix,f.silhouetteColorCommand2D=E}}}function dT(e,t,r){return e=Cesium.ShaderSource.replaceMain(e,"gltf_clip_main"),e+=Ur._getClippingFunction(t,r)+`
`,e+=`uniform sampler2D gltf_clippingPlanes; 
uniform mat4 gltf_clippingPlanesMatrix; 
uniform vec4 gltf_clippingPlanesEdgeStyle; 
void main() 
{ 
    gltf_clip_main(); 
`+Cesium.getClipAndStyleCode("gltf_clippingPlanes","gltf_clippingPlanesMatrix","gltf_clippingPlanesEdgeStyle")+`} 
`,e=e.replace("czm_transformPlane(","czm_transformPlaneOld("),e}function Lv(e,t,r){if(Tv(e,t)){var n=e._nodeCommands,i=lv(e.color.alpha,e._colorPreviousAlpha)||lv(e.silhouetteColor.alpha,e._silhouetteColorPreviousAlpha)||!Cesium.defined(n[0].silhouetteModelCommand);e._colorPreviousAlpha=e.color.alpha,e._silhouetteColorPreviousAlpha=e.silhouetteColor.alpha,(i||r)&&hT(e,t)}}function mT(e,t){var r=e._clippingPlanes;Cesium.defined(r)&&r.owner===e&&r.enabled&&r.update(t)}var $h=new Cesium.BoundingSphere;function pT(e,t,r){return $h.center=e,$h.radius=t,r.camera.getPixelSize($h,r.context.drawingBufferWidth,r.context.drawingBufferHeight)}var kr=new Cesium.Cartesian3,ku=new Cesium.Cartographic;function gT(e,t){var r=e.scale;if(e.minimumPixelSize!==0){var n=t.context,i=Math.max(n.drawingBufferWidth,n.drawingBufferHeight),s=Cesium.defined(e._clampedModelMatrix)?e._clampedModelMatrix:e.modelMatrix;if(kr.x=s[12],kr.y=s[13],kr.z=s[14],Cesium.defined(e._rtcCenter)&&Cesium.Cartesian3.add(e._rtcCenter,kr,kr),e._mode!==Cesium.SceneMode.SCENE3D){var a=t.mapProjection,o=a.ellipsoid.cartesianToCartographic(kr,ku);a.project(o,kr),Cesium.Cartesian3.fromElements(kr.z,kr.x,kr.y,kr)}var u=e.boundingSphere.radius,f=pT(kr,u,t),l=1/f,c=Math.min(l*(2*u),i);c<e.minimumPixelSize&&(r=e.minimumPixelSize*f/(2*e._initialRadius))}return Cesium.defined(e.maximumScale)?Math.min(e.maximumScale,r):r}function Pv(e){Cesium.defined(e._cacheKey)&&Cesium.defined(e._cachedGltf)&&--e._cachedGltf.count===0&&delete sa[e._cacheKey],e._cachedGltf=void 0}function td(e,t){this.buffers=void 0,this.vertexArrays=void 0,this.programs=void 0,this.sourceShaders=void 0,this.silhouettePrograms=void 0,this.textures=void 0,this.samplers=void 0,this.renderStates=void 0,this.ready=!1,this.context=e,this.cacheKey=t,this.count=0}function ia(e){for(var t in e)e.hasOwnProperty(t)&&(e[t].isDestroyed()||e[t].destroy())}function vT(e){ia(e.buffers),ia(e.vertexArrays),ia(e.programs),ia(e.silhouettePrograms),ia(e.textures)}td.prototype.release=function(){if(--this.count===0)return Cesium.defined(this.cacheKey)&&delete this.context.cache.modelRendererResourceCache[this.cacheKey],vT(this),Cesium.destroyObject(this)};function cv(e,t,r){return function(n){if(e.heightReference===Cesium.HeightReference.RELATIVE_TO_GROUND){var i=t.cartesianToCartographic(n,ku);i.height+=r.height,t.cartographicToCartesian(i,n)}var s=e._clampedModelMatrix;Cesium.Matrix4.clone(e.modelMatrix,s),s[12]=n.x,s[13]=n.y,s[14]=n.z,e._heightChanged=!0}}function _T(e){Cesium.defined(e._removeUpdateHeightCallback)&&(e._removeUpdateHeightCallback(),e._removeUpdateHeightCallback=void 0);var t=e._scene;if(!Cesium.defined(t)||!Cesium.defined(t.globe)||e.heightReference===Cesium.HeightReference.NONE){e._clampedModelMatrix=void 0;return}var r=t.globe,n=r.ellipsoid,i=e.modelMatrix;kr.x=i[12],kr.y=i[13],kr.z=i[14];var s=n.cartesianToCartographic(kr);Cesium.defined(e._clampedModelMatrix)||(e._clampedModelMatrix=Cesium.Matrix4.clone(i,new Cesium.Matrix4));var a=r._surface;e._removeUpdateHeightCallback=a.updateHeight(s,cv(e,n,s));var o=r.getHeight(s);if(Cesium.defined(o)){var u=cv(e,n,s);Cesium.Cartographic.clone(s,ku),ku.height=o,n.cartographicToCartesian(ku,kr),u(kr)}}var CT=new Cesium.Cartesian3,yT=new Cesium.Cartographic;function xT(e,t){var r,n=e.distanceDisplayCondition,i=n.near*n.near,s=n.far*n.far;if(t.mode===Cesium.SceneMode.SCENE2D){var a=t.camera.frustum.right-t.camera.frustum.left;r=a*.5,r=r*r}else{var o=Cesium.Matrix4.getTranslation(e.modelMatrix,CT);if(t.mode===Cesium.SceneMode.COLUMBUS_VIEW){var u=t.mapProjection,f=u.ellipsoid,l=f.cartesianToCartographic(o,yT);o=u.project(l,o),Cesium.Cartesian3.fromElements(o.z,o.x,o.y,o)}r=Cesium.Cartesian3.distanceSquared(o,t.camera.positionWC)}return r>=i&&r<=s}Ur.prototype.update=function(e){if(Cesium.defined(this._scene)||(this._scene=e.camera._scene),e.mode!==Cesium.SceneMode.MORPHING){if(!Cesium.FeatureDetection.supportsWebP.initialized){Cesium.FeatureDetection.supportsWebP.initialize();return}var t=Cesium.FeatureDetection.supportsWebP(),r=e.context;this._defaultTexture=r.defaultTexture;var n=this._scene,i=n.globe;if(Cesium.defined(i)&&i.enableLighting){if(Cesium.defined(i._surfaceNormal))var s=i._surfaceNormal;else var a=n.camera.positionCartographic,o=i._surface._tileProvider.tilingScheme.ellipsoid,u=Cesium.Cartesian3.fromRadians(a.longitude,a.latitude,0,o),s=o.geodeticSurfaceNormal(u);var f=n.context._us.lightDirectionWC,l=Cesium.Cartesian3.dot(s,f);if((!this.hasDiffuse||!!Math.ceil(this.hasDiffuse)!=!!Math.ceil(l))&&this._runtime&&this._runtime.materialsById){var c=l>0?this.modelSpecular:0,h=this._runtime.materialsById;for(var d in h)Cesium.defined(h[d]._values.u_specular)&&(h[d]._values.u_specular[0]=c),Cesium.defined(h[d]._uniformMap.values)&&Cesium.defined(h[d]._uniformMap.values.u_specular)&&(h[d]._uniformMap.values.u_specular.value.x=c);this.hasDiffuse=l}}if(this._state===na.NEEDS_LOAD&&Cesium.defined(this.gltf)){var m,g=this.cacheKey;if(Cesium.defined(g)){r.cache.modelRendererResourceCache=Cesium.defaultValue(r.cache.modelRendererResourceCache,{});var p=r.cache.modelRendererResourceCache;if(m=p[this.cacheKey],Cesium.defined(m)){if(!m.ready)return;++m.count,this._loadRendererResourcesFromCache=!0}else m=new td(r,g),m.count=1,p[this.cacheKey]=m;this._cachedRendererResources=m}else m=new td(r),m.count=1,this._cachedRendererResources=m;if(this._state=na.LOADING,this._state!==na.FAILED){var v=this.gltf.extensions;if(Cesium.defined(v)&&Cesium.defined(v.CESIUM_RTC)){var _=Cesium.Cartesian3.fromArray(v.CESIUM_RTC.center);if(!Cesium.Cartesian3.equals(_,Cesium.Cartesian3.ZERO)){this._rtcCenter3D=_;var y=e.mapProjection,o=y.ellipsoid,a=o.cartesianToCartographic(this._rtcCenter3D),x=y.project(a);Cesium.Cartesian3.fromElements(x.z,x.x,x.y,x),this._rtcCenter2D=x,this._rtcCenterEye=new Cesium.Cartesian3,this._rtcCenter=this._rtcCenter3D}}Cesium.addPipelineExtras(this.gltf),this._loadResources=new Nh,this._loadRendererResourcesFromCache||ee.parseBuffers(this,Xw)}}var E=this._loadResources,S=this._incrementallyLoadTextures,I=!1;if(this._state===na.LOADING){if(E.pendingBufferLoads===0){if(!E.initialized){if(e.brdfLutGenerator.update(e),ee.checkSupportedExtensions(this.extensionsRequired,t),ee.updateForwardAxis(this),!Cesium.defined(this.gltf.extras.sourceVersion)){var P=this.gltf;P.extras.sourceVersion=ee.getAssetVersion(P),P.extras.sourceKHRTechniquesWebGL=Cesium.defined(ee.getUsedExtensions(P).KHR_techniques_webgl),this._sourceVersion=P.extras.sourceVersion,this._sourceKHRTechniquesWebGL=P.extras.sourceKHRTechniquesWebGL,Yh(P),Hh(P);var w={addBatchIdToGeneratedShaders:this._addBatchIdToGeneratedShaders};Fh(P,w),Vh(P,w)}this._sourceVersion=this.gltf.extras.sourceVersion,this._sourceKHRTechniquesWebGL=this.gltf.extras.sourceKHRTechniquesWebGL,this._dequantizeInShader=this._dequantizeInShader&&es.hasExtension(this),Yw(this),eS(this),Kw(this),this._loadRendererResourcesFromCache||(jw(this),Zw(this),Jw(this),rS(this,r,t)),uS(this),fS(this),oS(this);var N=this.gltf;if(Cesium.defined(N)&&N.meshes.length>0&&this.meshPrimitives.length>0){for(var B=0;B<this.meshPrimitives.length;B++)es.parseDecodedData(this.meshPrimitives[B],this,r);this.meshPrimitives.length=0}else es.parse(this,r);E.initialized=!0}E.finishedDecoding()||es.decodeModel(this,r).otherwise(ee.getFailedLoadFunction(this,"model",this.basePath)),E.finishedDecoding()&&!E.resourcesParsed&&(this._boundingSphere=ee.computeBoundingSphere(this),this._initialRadius=this._boundingSphere.radius,es.cacheDataForModel(this),E.resourcesParsed=!0),E.resourcesParsed&&E.pendingShaderLoads===0&&(Sl.outlinePrimitives(this),ov(this,e))}(E.finished()||S&&E.finishedEverythingButTextureCreation())&&(this._state=na.LOADED,I=!0)}if(Cesium.defined(E)&&this._state===na.LOADED&&(S&&!I&&ov(this,e),E.finished())){this._loadResources=void 0;var C=this._rendererResources,b=this._cachedRendererResources;b.buffers=C.buffers,b.vertexArrays=C.vertexArrays,b.programs=C.programs,b.sourceShaders=C.sourceShaders,b.silhouettePrograms=C.silhouettePrograms,b.textures=C.textures,b.samplers=C.samplers,b.renderStates=C.renderStates,b.ready=!0,this._normalAttributeName=ee.getAttributeOrUniformBySemantic(this.gltf,"NORMAL"),Cesium.defined(this._precreatedAttributes)&&(b.vertexArrays={}),this.releaseGltfJson&&Pv(this)}var T=Cesium.OctahedralProjectedCubeMap.isSupported(r);if(this._shouldUpdateSpecularMapAtlas&&T){if(this._shouldUpdateSpecularMapAtlas=!1,this._specularEnvironmentMapAtlas=this._specularEnvironmentMapAtlas&&this._specularEnvironmentMapAtlas.destroy(),this._specularEnvironmentMapAtlas=void 0,Cesium.defined(this._specularEnvironmentMaps)){this._specularEnvironmentMapAtlas=new Cesium.OctahedralProjectedCubeMap(this._specularEnvironmentMaps);var A=this;this._specularEnvironmentMapAtlas.readyPromise.then(function(){A._shouldRegenerateShaders=!0}).otherwise(function(Wx){console.error("Error loading specularEnvironmentMaps: "+Wx)})}this._shouldRegenerateShaders=!0}Cesium.defined(this._specularEnvironmentMapAtlas)&&this._specularEnvironmentMapAtlas.update(e);var R=!Cesium.defined(this._specularEnvironmentMapAtlas)&&Cesium.defined(e.specularEnvironmentMaps)&&!this._useDefaultSpecularMaps,F=!Cesium.defined(e.specularEnvironmentMaps)&&this._useDefaultSpecularMaps,D=!Cesium.defined(this._sphericalHarmonicCoefficients)&&Cesium.defined(e.sphericalHarmonicCoefficients)&&!this._useDefaultSphericalHarmonics,O=!Cesium.defined(e.sphericalHarmonicCoefficients)&&this._useDefaultSphericalHarmonics;this._shouldRegenerateShaders=this._shouldRegenerateShaders||R||F||D||O,this._useDefaultSpecularMaps=!Cesium.defined(this._specularEnvironmentMapAtlas)&&Cesium.defined(e.specularEnvironmentMaps),this._useDefaultSphericalHarmonics=!Cesium.defined(this._sphericalHarmonicCoefficients)&&Cesium.defined(e.sphericalHarmonicCoefficients);var U=Tv(this,e),q=ed(this),Y=Iv(this),W=Cesium.defined(this.distanceDisplayCondition)?xT(this,e):!0,K=this.show&&W&&this.scale!==0&&(!Y||U);if(K&&this._state===na.LOADED||I){var re=this.activeAnimations.update(e)||this._cesiumAnimationsDirty;this._cesiumAnimationsDirty=!1,this._dirty=!1;var ce=this.modelMatrix,Se=e.mode!==this._mode;this._mode=e.mode;var de=!Cesium.Matrix4.equals(this._modelMatrix,ce)||this._scale!==this.scale||this._minimumPixelSize!==this.minimumPixelSize||this.minimumPixelSize!==0||this._maximumScale!==this.maximumScale||this._heightReference!==this.heightReference||this._heightChanged||Se;if(de||I){Cesium.Matrix4.clone(ce,this._modelMatrix),_T(this),Cesium.defined(this._clampedModelMatrix)&&(ce=this._clampedModelMatrix),this._scale=this.scale,this._minimumPixelSize=this.minimumPixelSize,this._maximumScale=this.maximumScale,this._heightReference=this.heightReference,this._heightChanged=!1;var Ae=gT(this,e),ye=this._computedModelMatrix;Cesium.Matrix4.multiplyByUniformScale(ce,Ae,ye),this._upAxis===Cesium.Axis.Y?Cesium.Matrix4.multiplyTransformation(ye,Cesium.Axis.Y_UP_TO_Z_UP,ye):this._upAxis===Cesium.Axis.X&&Cesium.Matrix4.multiplyTransformation(ye,Cesium.Axis.X_UP_TO_Z_UP,ye),this.forwardAxis===Cesium.Axis.Z&&Cesium.Matrix4.multiplyTransformation(ye,Cesium.Axis.Z_UP_TO_X_UP,ye)}(re||de||I)&&(eT(this,de,I,e.mapProjection),this._dirty=!0,(re||I)&&tT(this)),this._perNodeShowDirty&&(this._perNodeShowDirty=!1,rT(this)),nT(this,r),iT(this),sT(this),aT(this),mT(this,e);var Ie=this._clippingPlanes,$=0,De=Cesium.defined(Ie)&&Ie.enabled&&Ie.length>0,se=Cesium.defined(this._sphericalHarmonicCoefficients)||this._useDefaultSphericalHarmonics,be=Cesium.defined(this._specularEnvironmentMapAtlas)&&this._specularEnvironmentMapAtlas.ready||this._useDefaultSpecularMaps;if(De||se||be){var lr=Cesium.defaultValue(this.clippingPlanesOriginMatrix,ce);Cesium.Matrix4.multiply(r.uniformState.view3D,lr,this._clippingPlaneModelViewMatrix)}De&&($=Ie.clippingPlanesState);var kt=this._shouldRegenerateShaders;kt=kt||this._clippingPlanesState!==$,this._clippingPlanesState=$;var Br=nd(this);Br!==this._colorShadingEnabled&&(this._colorShadingEnabled=Br,kt=!0),this._scene.ev_Fog&&this._enableFog!==this._scene.ev_Fog.enabled&&(kt=!0,this._shouldRegenerateShaders=!0,this._enableFog=this._scene.ev_Fog.enabled),Cesium.defined(this.ev_E3MInternalInstance)&&this.ev_E3MInternalInstance.postUpdate(e,this),this._update===!0&&(kt=!0,this._shouldRegenerateShaders=!0,this._update=!1),kt?ET(this,e):(Sv(this,e,!1),Lv(this,e,!1))}if(I){var fn=this;e.afterRender.push(function(){fn._ready=!0,fn._readyPromise.resolve(fn)});return}if(K&&!this._ignoreCommands){var en=e.commandList,fi=e.passes,$i=this._nodeCommands,li=$i.length,xt,At,yn=e.mapProjection.ellipsoid.maximumRadius*Cesium.Math.PI,St;if(fi.render||fi.pick&&this.allowPicking){for(xt=0;xt<li;++xt)if(At=$i[xt],At.show){var Vr=q?At.translucentCommand:At.command;if(Vr=U?At.silhouetteModelCommand:Vr,en.push(Vr),St=At.command.boundingVolume,e.mode===Cesium.SceneMode.SCENE2D&&(St.center.y+St.radius>yn||St.center.y-St.radius<yn)){var Js=q?At.translucentCommand2D:At.command2D;Js=U?At.silhouetteModelCommand2D:Js,en.push(Js)}}if(U&&!fi.pick)for(xt=0;xt<li;++xt)At=$i[xt],At.show&&(en.push(At.silhouetteColorCommand),St=At.command.boundingVolume,e.mode===Cesium.SceneMode.SCENE2D&&(St.center.y+St.radius>yn||St.center.y-St.radius<yn)&&en.push(At.silhouetteColorCommand2D))}}var Mu=this._credit;Cesium.defined(Mu)&&e.creditDisplay.addCredit(Mu);for(var Wp=this._resourceCredits,Hx=Wp.length,hh=0;hh<Hx;hh++)e.creditDisplay.addCredit(Wp[hh])}};function Mv(e,t){e.programs!==t.programs&&ia(e.programs),e.silhouettePrograms!==t.silhouettePrograms&&ia(e.silhouettePrograms)}function ET(e,t){var r=e._rendererResources,n=e._cachedRendererResources;Mv(r,n);var i;if(dv(e)||nd(e)||e._shouldRegenerateShaders){e._shouldRegenerateShaders=!1,r.programs={},r.silhouettePrograms={},Cesium.defined(e.ev_E3MInternalInstance)&&(e.ev_E3MInternalInstance._instancedUniformsByProgram=void 0);var s={},a=e._sourceTechniques,o;for(var u in a)if(a.hasOwnProperty(u)&&(o=a[u],i=o.program,!s[i])){s[i]=!0;var f=e._sourcePrograms[i].name;Cesium.defined(e.ev_E3MInternalInstance)&&Cesium.defined(e.ev_E3MInternalInstance._tileset)&&Cesium.defined(f)&&e.instancedPrograms[f]?(e.instancedPrograms[f]=void 0,e.ev_E3MInternalInstance.regenerateShaders({programId:i,techniqueId:u},e,t.context)):hS({programId:i,techniqueId:u},e,t.context)}}else r.programs=n.programs,r.silhouettePrograms=n.silhouettePrograms;for(var l=r.programs,c=e._nodeCommands,h=c.length,d=0;d<h;++d){var m=c[d];i=m.programId;var g=l[i];m.command.shaderProgram=g,Cesium.defined(m.command2D)&&(m.command2D.shaderProgram=g)}Sv(e,t,!0),Lv(e,t,!0)}Ur.prototype.isDestroyed=function(){return!1};Ur.prototype.destroy=function(){Cesium.defined(this.ev_E3MInternalInstance)&&this.ev_E3MInternalInstance.destroy(),Cesium.defined(this._precreatedAttributes)&&ia(this._rendererResources.vertexArrays),Cesium.defined(this._removeUpdateHeightCallback)&&(this._removeUpdateHeightCallback(),this._removeUpdateHeightCallback=void 0),Cesium.defined(this._terrainProviderChangedCallback)&&(this._terrainProviderChangedCallback(),this._terrainProviderChangedCallback=void 0),Cesium.defined(this._cachedRendererResources)&&Mv(this._rendererResources,this._cachedRendererResources),this._rendererResources=void 0,this._cachedRendererResources=this._cachedRendererResources&&this._cachedRendererResources.release(),es.destroyCachedDataForModel(this);for(var e=this._pickIds,t=e.length,r=0;r<t;++r)e[r].destroy();Pv(this),this._quantizedVertexShaders=void 0;var n=this._clippingPlanes;return Cesium.defined(n)&&!n.isDestroyed()&&n.owner===this&&n.destroy(),this._clippingPlanes=void 0,this._specularEnvironmentMapAtlas=this._specularEnvironmentMapAtlas&&this._specularEnvironmentMapAtlas.destroy(),this._nodeCommands.length=0,this.meshPrimitives.length=0,this.ktxs=void 0,this.instancedPrograms=void 0,this.gltfShader=void 0,Cesium.destroyObject(this)};function bT(e,t){var r=e.accessors[e.meshes[0].primitives[0].attributes.NORMAL],n=e.bufferViews[r.bufferView],i=e.buffers[n.buffer],s=i.extras._pipeline.source,a=s.slice(n.byteOffset,n.byteOffset+n.byteLength),o=new Float32Array(a.buffer);e.meshes[0].primitives[0].attributes.TEXCOORD_0=e.accessors.length;var u=e.accessors[e.meshes[0].primitives[0].attributes.POSITION].count;e.accessors.push({bufferView:e.bufferViews.length,byteOffset:0,componentType:5126,count:u,max:[1,1],min:[0,0],type:"VEC2"});var f=u*8;e.bufferViews.push({buffer:e.buffers.length,byteLength:f,byteOffset:0,byteStride:8});var l=new Float32Array(u*2),c=[[1,0],[0,0],[1,1],[0,1]],h=0;for(let d=0;d<u;d++)o[3*d]!==0&&o[3*d+1]!==0&&o[3*d+2]!==1?(l[2*d]=c[h%4][0],l[2*d+1]=c[h%4][1],h++):(l[2*d]=0,l[2*d+1]=0,h=0);return e.buffers.push({byteLength:f,extras:{_pipeline:{source:new Uint8Array(l.buffer)}}}),e.materials[0].pbrMetallicRoughness.baseColorTexture={index:0},e.textures=[],e.textures.push({sampler:0,source:0}),e.samplers=[],e.samplers.push({magFilter:Cesium.TextureMinificationFilter.LINEAR,minFilter:Cesium.TextureMinificationFilter.LINEAR_MIPMAP_LINEAR,wrapS:Cesium.TextureWrap.MIRRORED_REPEAT,wrapT:Cesium.TextureWrap.MIRRORED_REPEAT}),e.images=[],e.images.push({bufferView:e.bufferViews.length,mimeType:"image/png",extras:{_pipeline:{}}}),e.bufferViews.push({buffer:e.buffers.length,byteLength:t.length,byteOffset:0}),e.buffers.push({byteLength:t.length,extras:{_pipeline:{source:new Uint8Array(t.buffer)}}}),e}Ur._getClippingFunction=Cesium.getClippingFunction;Ur._modifyShaderForColor=cS;var No=Ur;function ln(e,t,r,n,i){this._tileset=e,this._tile=t,this._resource=r,this._model=void 0,this._batchTable=void 0,this._features=void 0,this._batchIdAttributeName=void 0,this._diffuseAttributeOrUniformName={},this._rtcCenterTransform=void 0,this._contentModelMatrix=void 0,this.featurePropertiesDirty=!1,this.useHdr=!0,LT(this,n,i)}ln._deprecationWarning=Cesium.deprecationWarning;Object.defineProperties(ln.prototype,{featuresLength:{get:function(){return this._batchTable.featuresLength}},pointsLength:{get:function(){return 0}},trianglesLength:{get:function(){return this._model.trianglesLength}},geometryByteLength:{get:function(){return this._model.geometryByteLength}},texturesByteLength:{get:function(){return this._model.texturesByteLength}},batchTableByteLength:{get:function(){return this._batchTable.memorySizeInBytes}},innerContents:{get:function(){}},readyPromise:{get:function(){return this._model.readyPromise}},tileset:{get:function(){return this._tileset}},tile:{get:function(){return this._tile}},url:{get:function(){return this._resource.getUrlComponent(!0)}},batchTable:{get:function(){return this._batchTable}}});var Is=Uint32Array.BYTES_PER_ELEMENT;function wT(e){var t=ee.getAttributeOrUniformBySemantic(e,"_BATCHID");return Cesium.defined(t)||(t=ee.getAttributeOrUniformBySemantic(e,"BATCHID"),Cesium.defined(t)&&ln._deprecationWarning("b3dm-legacy-batchid","The glTF in this b3dm uses the semantic `BATCHID`. Application-specific semantics should be prefixed with an underscore: `_BATCHID`.")),t}function Av(e){return function(t,r){var n=e._batchTable,i=!Cesium.defined(e._tileset.classificationType),s=e._model.gltf;Cesium.defined(s)&&(e._batchIdAttributeName=wT(s),e._diffuseAttributeOrUniformName[r]=ee.getDiffuseAttributeOrUniform(s,r));var a=n.getVertexShaderCallback(i,e._batchIdAttributeName,e._diffuseAttributeOrUniformName[r]);return Cesium.defined(a)?a(t):t}}function ST(e){return function(t,r){var n=e._batchTable,i=!Cesium.defined(e._tileset.classificationType),s=e._model.gltf;Cesium.defined(s)&&(e._diffuseAttributeOrUniformName[r]=ee.getDiffuseAttributeOrUniform(s,r));var a=n.getFragmentShaderCallback(i,e._diffuseAttributeOrUniformName[r]);return Cesium.defined(a)?a(t):t}}function Dv(e){return function(){return e._batchTable.getPickId()}}function TT(e){return function(t){var r=e._batchTable,n=r.getClassificationFragmentShaderCallback();return Cesium.defined(n)?n(t):t}}function IT(e){return function(t,r){e._model.updateCommands(t,r)}}function LT(e,t,r){var n=e._tileset,i=e._tile,s=e._resource,a=Cesium.defaultValue(r,0);r=a;var o=new Uint8Array(t),u=new DataView(t);r+=Is;var f=u.getUint32(r,!0);if(f!==1)throw new Cesium.RuntimeError("Only Batched 3D Model version 1 is supported.  Version "+f+" is not.");r+=Is;var l=u.getUint32(r,!0);r+=Is;var c=u.getUint32(r,!0);r+=Is;var h=u.getUint32(r,!0);r+=Is;var d=u.getUint32(r,!0);r+=Is;var m=u.getUint32(r,!0);r+=Is;var g;d>=570425344?(r-=Is*2,g=c,d=h,m=0,c=0,h=0,ln._deprecationWarning("b3dm-legacy-header","This b3dm header is using the legacy format [batchLength] [batchTableByteLength]. The new format is [featureTableJsonByteLength] [featureTableBinaryByteLength] [batchTableJsonByteLength] [batchTableBinaryByteLength] from https://github.com/CesiumGS/3d-tiles/tree/master/specification/TileFormats/Batched3DModel.")):m>=570425344&&(r-=Is,g=d,d=c,m=h,c=0,h=0,ln._deprecationWarning("b3dm-legacy-header","This b3dm header is using the legacy format [batchTableJsonByteLength] [batchTableBinaryByteLength] [batchLength]. The new format is [featureTableJsonByteLength] [featureTableBinaryByteLength] [batchTableJsonByteLength] [batchTableBinaryByteLength] from https://github.com/CesiumGS/3d-tiles/tree/master/specification/TileFormats/Batched3DModel."));var p;if(c===0)p={BATCH_LENGTH:Cesium.defaultValue(g,0)};else{var v=Cesium.getStringFromTypedArray(o,r,c);p=JSON.parse(v),r+=c}var _=new Uint8Array(t,r,h);r+=h;var y=new ws(p,_);g=y.getGlobalProperty("BATCH_LENGTH"),y.featuresLength=g;var x;if(Cesium.defined(y.json.Radius)&&(e.lineRadius=y.json.Radius,x=y.json.Radius),Cesium.defined(y.json.FLOWLINE)){var E=y.json.FLOWLINE,S=0;for(var I in E){for(var P=[],w=[],N=0;N<E[I].length;N+=3){var B=Cesium.Cartesian3.fromRadians(E[I][N+0],E[I][N+1],E[I][N+2]);P.push(B),x&&(w.push(E[I][N+0]),w.push(E[I][N+1]),w.push(E[I][N+2]+x[S]))}S++,Cesium.defined(e.tileset.flowLines)||(e.tileset.flowLines=[]),e.tileset.flowLines.push(P),Cesium.defined(e.flowLines)||(e.flowLines=[],e.centreLine=[]),e.flowLines.push(P),x&&e.centreLine.push(w)}}var C,b;if(d>0){var T=Cesium.getStringFromTypedArray(o,r,d);C=JSON.parse(T),r+=d,m>0&&(b=new Uint8Array(t,r,m),b=new Uint8Array(b),r+=m)}var A;Cesium.defined(n.classificationType)&&(A=IT(e));var R=new zr(e,g,C,b,A);if(e._batchTable=R,Cesium.defined(e._tile._header.EVID))for(var F=R.featuresLength,N=0;N<F;N++)R.setProperty(N,"EVID",e._tile._header.EVID);var D=a+l-r;if(D===0)throw new Cesium.RuntimeError("glTF byte length must be greater than 0.");var O;r%4===0?O=new Uint8Array(t,r,D):(ln._deprecationWarning("b3dm-glb-unaligned","The embedded glb is not aligned to a 4-byte boundary."),O=new Uint8Array(o.subarray(r,r+D)));var U={content:e,primitive:n};e._rtcCenterTransform=Cesium.Matrix4.IDENTITY;var q=y.getGlobalProperty("RTC_CENTER",Cesium.ComponentDatatype.FLOAT,3);Cesium.defined(q)&&(e._rtcCenterTransform=Cesium.Matrix4.fromTranslation(Cesium.Cartesian3.fromArray(q))),e._contentModelMatrix=Cesium.Matrix4.multiply(i.computedTransform,e._rtcCenterTransform,new Cesium.Matrix4),Cesium.defined(n.classificationType)?e._model=new Cesium.ClassificationModel({gltf:O,cull:!1,basePath:s,requestType:Cesium.RequestType.TILES3D,modelMatrix:e._contentModelMatrix,upAxis:n._gltfUpAxis,forwardAxis:Cesium.Axis.X,debugWireframe:n.debugWireframe,vertexShaderLoaded:Av(e),classificationShaderLoaded:TT(e),uniformMapLoaded:R.getUniformMapCallback(),pickIdLoaded:Dv(e),classificationType:n._classificationType,batchTable:R}):(e._model=new No({gltf:O,cull:!1,releaseGltfJson:!0,opaquePass:Cesium.Pass.CESIUM_3D_TILE,basePath:s,requestType:Cesium.RequestType.TILES3D,modelMatrix:e._contentModelMatrix,upAxis:n._gltfUpAxis,forwardAxis:Cesium.Axis.X,shadows:n.shadows,debugWireframe:n.debugWireframe,incrementallyLoadTextures:!1,vertexShaderLoaded:Av(e),fragmentShaderLoaded:ST(e),uniformMapLoaded:R.getUniformMapCallback(),pickIdLoaded:Dv(e),addBatchIdToGeneratedShaders:g>0,pickObject:U,imageBasedLightingFactor:n.imageBasedLightingFactor,lightColor:n.lightColor,luminanceAtZenith:n.luminanceAtZenith,sphericalHarmonicCoefficients:n.sphericalHarmonicCoefficients,specularEnvironmentMaps:n.specularEnvironmentMaps,content:e,sharedResources:{instancedPrograms:{name:i.sharedResources.instancedPrograms.name,shadredData:i.sharedResources.instancedPrograms.shadredData},ktxs:i.sharedResources.ktxs},specular:n.specular,rollerRegion:n.rollerRegion,imagesSourceBuf:n.imagesSourceBuf}),e._model._tilesetFlat=n._tilesetFlat,e._model.readyPromise.then(function(Y){Y.activeAnimations.addAll({loop:Cesium.ModelAnimationLoop.REPEAT})}))}function PT(e){var t=e.featuresLength;if(!Cesium.defined(e._features)&&t>0){for(var r=new Array(t),n=0;n<t;++n)r[n]=new Rn(e,n);e._features=r}}ln.prototype.hasProperty=function(e,t){return this._batchTable.hasProperty(e,t)};ln.prototype.getFeature=function(e){return PT(this),this._features[e]};ln.prototype.applyDebugSettings=function(e,t){t=e?t:Cesium.Color.WHITE,this.featuresLength===0?this._model.color=t:this._batchTable.setAllColor(t)};ln.prototype.applyStyle=function(e){if(this.featuresLength===0){var t=Cesium.defined(e)&&Cesium.defined(e.color),r=Cesium.defined(e)&&Cesium.defined(e.show);this._model.color=t?e.color.evaluateColor(void 0,this._model.color):Cesium.Color.clone(Cesium.Color.WHITE,this._model.color),this._model.show=r?e.show.evaluate(void 0):!0}else this._batchTable.applyStyle(e);Cesium.defined(this._model.ev_E3MInternalInstance)&&this._model.ev_E3MInternalInstance.applyStyle(e)};ln.prototype.update=function(e,t){var r=t.commandList.length;this._batchTable.update(e,t),Cesium.defined(this._model.ev_E3MInternalInstance)&&this._model.ev_E3MInternalInstance.cesium3DTileBatchTableUpdate(e,t),this._contentModelMatrix=Cesium.Matrix4.multiply(this._tile.computedTransform,this._rtcCenterTransform,this._contentModelMatrix),this._model.modelMatrix=this._contentModelMatrix,this._model.shadows=this._tileset.shadows,this._model.imageBasedLightingFactor=this._tileset.imageBasedLightingFactor,this._model.lightColor=this._tileset.lightColor,this._model.luminanceAtZenith=this._tileset.luminanceAtZenith,this._model.sphericalHarmonicCoefficients=this._tileset.sphericalHarmonicCoefficients,this._model.specularEnvironmentMaps=this._tileset.specularEnvironmentMaps,this._model.debugWireframe=this._tileset.debugWireframe,this._model.gltfShader=this._tileset.gltfShader,this._model.useIndexedDBCache=this._tileset.useIndexedDBCache;var n=this._tileset.clippingPlanes;this._model.clippingPlanesOriginMatrix=this._tileset.clippingPlanesOriginMatrix,Cesium.defined(n)&&this._tile.clippingPlanesDirty&&(this._model._clippingPlanes=n.enabled&&this._tile._isClipped?n:void 0),Cesium.defined(n)&&Cesium.defined(this._model._clippingPlanes)&&this._model._clippingPlanes!==n&&(this._model._clippingPlanes=n),this._model._update=this._tileset._update,this._model.update(t);var i=t.commandList.length;r<i&&(t.passes.render||t.passes.pick)&&!Cesium.defined(e.classificationType)&&this._batchTable.addDerivedCommands(t,r);for(var s=0;s<t.commandList.length;++s){var a=t.commandList[s];a.owner.content instanceof ln&&(a.dirty=this.useHdr!==t.camera._scene._hdr)}this.useHdr=t.camera._scene._hdr};ln.prototype.isDestroyed=function(){return!1};ln.prototype.destroy=function(){return this._model=this._model&&this._model.destroy(),this._batchTable=this._batchTable&&this._batchTable.destroy(),Cesium.destroyObject(this)};ln.prototype.batched3DModel3DTileContent=!0;var aa=ln;function ts(e,t,r,n,i,s){this._tileset=e,this._tile=t,this._resource=r,this._contents=[],this._readyPromise=Ne.defer(),MT(this,n,i,s)}Object.defineProperties(ts.prototype,{featurePropertiesDirty:{get:function(){for(var e=this._contents,t=e.length,r=0;r<t;++r)if(e[r].featurePropertiesDirty)return!0;return!1},set:function(e){for(var t=this._contents,r=t.length,n=0;n<r;++n)t[n].featurePropertiesDirty=e}},featuresLength:{get:function(){return 0}},pointsLength:{get:function(){return 0}},trianglesLength:{get:function(){return 0}},geometryByteLength:{get:function(){return 0}},texturesByteLength:{get:function(){return 0}},batchTableByteLength:{get:function(){return 0}},innerContents:{get:function(){return this._contents}},readyPromise:{get:function(){return this._readyPromise.promise}},tileset:{get:function(){return this._tileset}},tile:{get:function(){return this._tile}},url:{get:function(){return this._resource.getUrlComponent(!0)}},batchTable:{get:function(){}}});var Hu=Uint32Array.BYTES_PER_ELEMENT;function MT(e,t,r,n){r=Cesium.defaultValue(r,0);var i=new Uint8Array(t),s=new DataView(t);r+=Hu;var a=s.getUint32(r,!0);if(a!==1)throw new Cesium.RuntimeError("Only Composite Tile version 1 is supported. Version "+a+" is not.");r+=Hu,r+=Hu;var o=s.getUint32(r,!0);r+=Hu;for(var u=[],f=0;f<o;++f){var l=Cesium.getMagic(i,r),c=s.getUint32(r+Hu*2,!0),h=n[l];if(Cesium.defined(h)){var d=h(e._tileset,e._tile,e._resource,t,r);e._contents.push(d),u.push(d.readyPromise)}else throw new Cesium.RuntimeError("Unknown tile content type, "+l+", inside Composite tile");r+=c}Ne.all(u).then(function(){e._readyPromise.resolve(e)}).otherwise(function(m){e._readyPromise.reject(m)})}ts.prototype.hasProperty=function(e,t){return!1};ts.prototype.composite3DTileContent=!0;ts.prototype.getFeature=function(e){};ts.prototype.applyDebugSettings=function(e,t){for(var r=this._contents,n=r.length,i=0;i<n;++i)r[i].applyDebugSettings(e,t)};ts.prototype.applyStyle=function(e){for(var t=this._contents,r=t.length,n=0;n<r;++n)t[n].applyStyle(e)};ts.prototype.update=function(e,t){for(var r=this._contents,n=r.length,i=0;i<n;++i)r[i].update(e,t)};ts.prototype.isDestroyed=function(){return!1};ts.prototype.destroy=function(){for(var e=this._contents,t=e.length,r=0;r<t;++r)e[r].destroy();return Cesium.destroyObject(this)};var Wu=ts;var Ls={NEEDS_DECODE:0,DECODING:1,READY:2,FAILED:3};function Yu(e){this._parsedContent=void 0,this._drawCommand=void 0,this._isTranslucent=!1,this._styleTranslucent=!1,this._constantColor=Cesium.Color.clone(Cesium.Color.DARKGRAY),this._highlightColor=Cesium.Color.clone(Cesium.Color.WHITE),this._pointSize=2,this._rtcCenter=void 0,this._quantizedVolumeScale=void 0,this._quantizedVolumeOffset=void 0,this._styleableShaderAttributes=void 0,this._isQuantized=!1,this._isOctEncoded16P=!1,this._isRGB565=!1,this._hasColors=!1,this._hasNormals=!1,this._hasBatchIds=!1,this._decodingState=Ls.READY,this._dequantizeInShader=!0,this._isQuantizedDraco=!1,this._isOctEncodedDraco=!1,this._quantizedRange=0,this._octEncodedRange=0,this.backFaceCulling=!1,this._backFaceCulling=!1,this.normalShading=!0,this._normalShading=!0,this._opaqueRenderState=void 0,this._translucentRenderState=void 0,this._mode=void 0,this._ready=!1,this._readyPromise=Ne.defer(),this._pointsLength=0,this._geometryByteLength=0,this._vertexShaderLoaded=e.vertexShaderLoaded,this._fragmentShaderLoaded=e.fragmentShaderLoaded,this._uniformMapLoaded=e.uniformMapLoaded,this._batchTableLoaded=e.batchTableLoaded,this._pickIdLoaded=e.pickIdLoaded,this._opaquePass=Cesium.defaultValue(e.opaquePass,Cesium.Pass.OPAQUE),this._cull=Cesium.defaultValue(e.cull,!0),this.style=void 0,this._style=void 0,this.styleDirty=!1,this.modelMatrix=Cesium.Matrix4.clone(Cesium.Matrix4.IDENTITY),this._modelMatrix=Cesium.Matrix4.clone(Cesium.Matrix4.IDENTITY),this.time=0,this.shadows=Cesium.ShadowMode.ENABLED,this._boundingSphere=void 0,this.clippingPlanes=void 0,this.isClipped=!1,this.clippingPlanesDirty=!1,this.clippingPlanesOriginMatrix=void 0,this.attenuation=!1,this._attenuation=!1,this.geometricError=0,this.geometricErrorScale=1,this.maximumAttenuation=this._pointSize,this.useElevation=Cesium.defaultValue(e.useElevation,!1),this.elevationMap=Cesium.defaultValue(e.elevationMap,void 0),this.meshPrimitives=[],this.useDracoDecoded=!1,this._highQulity=e.highQulity,AT(this,e)}Object.defineProperties(Yu.prototype,{pointsLength:{get:function(){return this._pointsLength}},geometryByteLength:{get:function(){return this._geometryByteLength}},ready:{get:function(){return this._ready}},readyPromise:{get:function(){return this._readyPromise.promise}},color:{get:function(){return Cesium.Color.clone(this._highlightColor)},set:function(e){this._highlightColor=Cesium.Color.clone(e,this._highlightColor)}},boundingSphere:{get:function(){if(Cesium.defined(this._drawCommand))return this._drawCommand.boundingVolume},set:function(e){this._boundingSphere=Cesium.BoundingSphere.clone(e,this._boundingSphere)}}});var Wa=Uint32Array.BYTES_PER_ELEMENT;function AT(e,t){var r=t.arrayBuffer,n=Cesium.defaultValue(t.byteOffset,0),i=new Uint8Array(r),s=new DataView(r);n+=Wa;var a=s.getUint32(n,!0);if(a!==1)throw new Cesium.RuntimeError("Only Point Cloud tile version 1 is supported.  Version "+a+" is not.");n+=Wa,n+=Wa;var o=s.getUint32(n,!0);if(o===0)throw new Cesium.RuntimeError("Feature table must have a byte length greater than zero");n+=Wa;var u=s.getUint32(n,!0);n+=Wa;var f=s.getUint32(n,!0);n+=Wa;var l=s.getUint32(n,!0);n+=Wa;var c=Cesium.getStringFromTypedArray(i,n,o),h=JSON.parse(c);n+=o;var d=new Uint8Array(r,n,u);n+=u;var m,g;if(f>0){var p=Cesium.getStringFromTypedArray(i,n,f);m=JSON.parse(p),n+=f,l>0&&(g=new Uint8Array(r,n,l),n+=l)}var v=new ws(h,d),_=v.getGlobalProperty("POINTS_LENGTH");if(v.featuresLength=_,!Cesium.defined(_))throw new Cesium.RuntimeError("Feature table global property: POINTS_LENGTH must be defined");var y=v.getGlobalProperty("RTC_CENTER",Cesium.ComponentDatatype.FLOAT,3);Cesium.defined(y)&&(e._rtcCenter=Cesium.Cartesian3.unpack(y));var x,E,S,I,P=!1,w=!1,N=!1,B=!1,C=!1,b=!1,T=!1,A=!1,R,F,D,O=Cesium.defined(h.extensions)?h.extensions["3DTILES_draco_point_compression"]:void 0,U=Cesium.defined(m)&&Cesium.defined(m.extensions)?m.extensions["3DTILES_draco_point_compression"]:void 0;if(Cesium.defined(U)&&(D=U.properties),Cesium.defined(O)){F=O.properties;var q=O.byteOffset,Y=O.byteLength;if(!Cesium.defined(F)||!Cesium.defined(q)||!Cesium.defined(Y))throw new Cesium.RuntimeError("Draco properties, byteOffset, and byteLength must be defined");R=xn(d,q,q+Y),P=Cesium.defined(F.POSITION),w=Cesium.defined(F.RGB)||Cesium.defined(F.RGBA),N=Cesium.defined(F.NORMAL),B=Cesium.defined(F.BATCH_ID),b=Cesium.defined(F.RGBA),e._decodingState=Ls.NEEDS_DECODE}var W;if(Cesium.defined(R)&&(W={buffer:R,featureTableProperties:F,batchTableProperties:D,properties:Cesium.combine(F,D),dequantizeInShader:e._dequantizeInShader}),!P){if(Cesium.defined(h.POSITION))x=v.getPropertyArray("POSITION",Cesium.ComponentDatatype.FLOAT,3),P=!0;else if(Cesium.defined(h.POSITION_QUANTIZED)){x=v.getPropertyArray("POSITION_QUANTIZED",Cesium.ComponentDatatype.UNSIGNED_SHORT,3),C=!0,P=!0;var K=v.getGlobalProperty("QUANTIZED_VOLUME_SCALE",Cesium.ComponentDatatype.FLOAT,3);if(!Cesium.defined(K))throw new Cesium.RuntimeError("Global property: QUANTIZED_VOLUME_SCALE must be defined for quantized positions.");e._quantizedVolumeScale=Cesium.Cartesian3.unpack(K),e._quantizedRange=65536-1;var re=v.getGlobalProperty("QUANTIZED_VOLUME_OFFSET",Cesium.ComponentDatatype.FLOAT,3);if(!Cesium.defined(re))throw new Cesium.RuntimeError("Global property: QUANTIZED_VOLUME_OFFSET must be defined for quantized positions.");e._quantizedVolumeOffset=Cesium.Cartesian3.unpack(re)}}if(w||(Cesium.defined(h.RGBA)?(E=v.getPropertyArray("RGBA",Cesium.ComponentDatatype.UNSIGNED_BYTE,4),b=!0,w=!0):Cesium.defined(h.RGB)?(E=v.getPropertyArray("RGB",Cesium.ComponentDatatype.UNSIGNED_BYTE,3),w=!0):Cesium.defined(h.RGB565)&&(E=v.getPropertyArray("RGB565",Cesium.ComponentDatatype.UNSIGNED_SHORT,1),T=!0,w=!0)),N||(Cesium.defined(h.NORMAL)?(S=v.getPropertyArray("NORMAL",Cesium.ComponentDatatype.FLOAT,3),N=!0):Cesium.defined(h.NORMAL_OCT16P)&&(S=v.getPropertyArray("NORMAL_OCT16P",Cesium.ComponentDatatype.UNSIGNED_BYTE,2),A=!0,N=!0)),B||Cesium.defined(h.BATCH_ID)&&(I=v.getPropertyArray("BATCH_ID",Cesium.ComponentDatatype.UNSIGNED_SHORT,1),B=!0),!P)throw new Cesium.RuntimeError("Either POSITION or POSITION_QUANTIZED must be defined.");if(Cesium.defined(h.CONSTANT_RGBA)){var ce=v.getGlobalProperty("CONSTANT_RGBA",Cesium.ComponentDatatype.UNSIGNED_BYTE,4);e._constantColor=Cesium.Color.fromBytes(ce[0],ce[1],ce[2],ce[3],e._constantColor)}if(B){var Se=v.getGlobalProperty("BATCH_LENGTH");if(!Cesium.defined(Se))throw new Cesium.RuntimeError("Global property: BATCH_LENGTH must be defined when BATCH_ID is defined.");Cesium.defined(g)&&(g=new Uint8Array(g)),Cesium.defined(e._batchTableLoaded)&&e._batchTableLoaded(Se,m,g)}var de;(!B||e.useElevation)&&Cesium.defined(g)&&(de=zr.getBinaryProperties(_,m,g)),e._parsedContent={positions:x,colors:E,normals:S,batchIds:I,styleableProperties:de,draco:W},e._pointsLength=_,e._isQuantized=C,e._isOctEncoded16P=A,e._isRGB565=T,e._isTranslucent=b,e._hasColors=w,e._hasNormals=N,e._hasBatchIds=B}var DT=new Cesium.Cartesian3,RT=new Cesium.Cartesian3,OT=new Cesium.Cartesian3,Pl;function NT(e){if(!Cesium.defined(Pl)){Cesium.Math.setRandomNumberSeed(0),Pl=new Array(e);for(var t=0;t<e;++t)Pl[t]=Cesium.Math.nextRandomNumber()}return Pl}function FT(e){for(var t=20,r=e.length/3,n=Math.min(r,t),i=NT(t),s=Number.MAX_VALUE,a=-Number.MAX_VALUE,o=Cesium.Cartesian3.fromElements(s,s,s,DT),u=Cesium.Cartesian3.fromElements(a,a,a,RT),f=0;f<n;++f){var l=Math.floor(i[f]*r),c=Cesium.Cartesian3.unpack(e,l*3,OT);Cesium.Cartesian3.minimumByComponent(o,c,o),Cesium.Cartesian3.maximumByComponent(u,c,u)}var h=Cesium.BoundingSphere.fromCornerPoints(o,u);return h.radius+=Cesium.Math.EPSILON2,h}function Rv(e,t){var r=Cesium.ComponentDatatype.fromTypedArray(e);return r===Cesium.ComponentDatatype.INT||r===Cesium.ComponentDatatype.UNSIGNED_INT||r===Cesium.ComponentDatatype.DOUBLE?(Cesium.oneTimeWarning("Cast pnts property to floats",'Point cloud property "'+t+'" will be casted to a float array because INT, UNSIGNED_INT, and DOUBLE are not valid WebGL vertex attribute types. Some precision may be lost.'),new Float32Array(e)):e}var BT=new Cesium.Cartesian4,VT=new Cesium.Cartesian4,zT=new Cesium.Color,Ov=0,Ml=1,md=2,Nv=3,kT=4,ld=new Cesium.Matrix4;function UT(e,t){var r=t.context,n=e._parsedContent,i=e._pointsLength,s=n.positions,a=n.colors,o=n.normals,u=n.batchIds,f=n.styleableProperties,l=Cesium.defined(f),c=e._isQuantized,h=e._isQuantizedDraco,d=e._isOctEncoded16P,m=e._isOctEncodedDraco,g=e._quantizedRange,p=e._octEncodedRange,v=e._isRGB565,_=e._isTranslucent,y=e._hasColors,x=e._hasNormals,E=e._hasBatchIds,S,I,P=[],w={};if(e._styleableShaderAttributes=w,l){var N=kT;for(var B in f)if(f.hasOwnProperty(B)){var C=f[B],b=Rv(C.typedArray,B);S=C.componentCount,I=Cesium.ComponentDatatype.fromTypedArray(b);var T=Cesium.Buffer.createVertexBuffer({context:r,typedArray:b,usage:Cesium.BufferUsage.STATIC_DRAW});e._geometryByteLength+=T.sizeInBytes;var A={index:N,vertexBuffer:T,componentsPerAttribute:S,componentDatatype:I,normalize:!1,offsetInBytes:0,strideInBytes:0};P.push(A),w[B]={location:N,componentCount:S},++N}}var R=Cesium.Buffer.createVertexBuffer({context:r,typedArray:s,usage:Cesium.BufferUsage.STATIC_DRAW});e._geometryByteLength+=R.sizeInBytes;var F;y&&(F=Cesium.Buffer.createVertexBuffer({context:r,typedArray:a,usage:Cesium.BufferUsage.STATIC_DRAW}),e._geometryByteLength+=F.sizeInBytes);var D;x&&(D=Cesium.Buffer.createVertexBuffer({context:r,typedArray:o,usage:Cesium.BufferUsage.STATIC_DRAW}),e._geometryByteLength+=D.sizeInBytes);var O;E&&(u=Rv(u,"batchIds"),O=Cesium.Buffer.createVertexBuffer({context:r,typedArray:u,usage:Cesium.BufferUsage.STATIC_DRAW}),e._geometryByteLength+=O.sizeInBytes);var U=[];if(c?I=Cesium.ComponentDatatype.UNSIGNED_SHORT:h?I=g<=255?Cesium.ComponentDatatype.UNSIGNED_BYTE:Cesium.ComponentDatatype.UNSIGNED_SHORT:I=Cesium.ComponentDatatype.FLOAT,U.push({index:Ov,vertexBuffer:R,componentsPerAttribute:3,componentDatatype:I,normalize:!1,offsetInBytes:0,strideInBytes:0}),e._cull&&(c||h?e._boundingSphere=Cesium.BoundingSphere.fromCornerPoints(Cesium.Cartesian3.ZERO,e._quantizedVolumeScale):e._boundingSphere=FT(s)),y)if(v)U.push({index:Ml,vertexBuffer:F,componentsPerAttribute:1,componentDatatype:Cesium.ComponentDatatype.UNSIGNED_SHORT,normalize:!1,offsetInBytes:0,strideInBytes:0});else{var q=_?4:3;U.push({index:Ml,vertexBuffer:F,componentsPerAttribute:q,componentDatatype:Cesium.ComponentDatatype.UNSIGNED_BYTE,normalize:!0,offsetInBytes:0,strideInBytes:0})}x&&(d?(S=2,I=Cesium.ComponentDatatype.UNSIGNED_BYTE):m?(S=2,I=p<=255?Cesium.ComponentDatatype.UNSIGNED_BYTE:Cesium.ComponentDatatype.UNSIGNED_SHORT):(S=3,I=Cesium.ComponentDatatype.FLOAT),U.push({index:md,vertexBuffer:D,componentsPerAttribute:S,componentDatatype:I,normalize:!1,offsetInBytes:0,strideInBytes:0})),E&&U.push({index:Nv,vertexBuffer:O,componentsPerAttribute:1,componentDatatype:Cesium.ComponentDatatype.fromTypedArray(u),normalize:!1,offsetInBytes:0,strideInBytes:0}),l&&(U=U.concat(P));var Y=new Cesium.VertexArray({context:r,attributes:U}),W={depthTest:{enabled:!0}};e._opaquePass===Cesium.Pass.CESIUM_3D_TILE&&(W.stencilTest=Cesium.StencilConstants.setCesium3DTileBit(),W.stencilMask=Cesium.StencilConstants.CESIUM_3D_TILE_MASK),e._opaqueRenderState=Cesium.RenderState.fromCache(W),e._translucentRenderState=Cesium.RenderState.fromCache({depthTest:{enabled:!0},depthMask:!1,blending:Cesium.BlendingState.ALPHA_BLEND}),e._drawCommand=new Cesium.DrawCommand({boundingVolume:new Cesium.BoundingSphere,cull:e._cull,modelMatrix:new Cesium.Matrix4,primitiveType:Cesium.PrimitiveType.POINTS,vertexArray:Y,count:i,shaderProgram:void 0,uniformMap:void 0,renderState:_?e._translucentRenderState:e._opaqueRenderState,pass:_?Cesium.Pass.TRANSLUCENT:e._opaquePass,owner:e,castShadows:!1,receiveShadows:!1,pickId:e._pickIdLoaded()})}function GT(e,t){var r=t.context,n=e._isQuantized,i=e._isQuantizedDraco,s=e._isOctEncodedDraco,a={u_pointSizeAndTimeAndGeometricErrorAndDepthMultiplier:function(){var o=BT;if(o.x=e._attenuation?e.maximumAttenuation:e._pointSize,o.x*=t.pixelRatio,o.y=e.time,e._attenuation){var u=t.camera.frustum,f;t.mode===Cesium.SceneMode.SCENE2D||u instanceof Cesium.OrthographicFrustum?f=Number.POSITIVE_INFINITY:f=r.drawingBufferHeight/t.camera.frustum.sseDenominator,o.z=e.geometricError*e.geometricErrorScale,o.w=f}return o},u_highlightColor:function(){return e._highlightColor},u_constantColor:function(){return e._constantColor},u_clippingPlanes:function(){var o=e.clippingPlanes,u=e.isClipped;return u?o.texture:r.defaultTexture},u_clippingPlanesEdgeStyle:function(){var o=e.clippingPlanes;if(!Cesium.defined(o))return Cesium.Color.TRANSPARENT;var u=Cesium.Color.clone(o.edgeColor,zT);return u.alpha=o.edgeWidth,u},u_clippingPlanesMatrix:function(){var o=e.clippingPlanes;if(!Cesium.defined(o))return Cesium.Matrix4.IDENTITY;var u=Cesium.defaultValue(e.clippingPlanesOriginMatrix,e._modelMatrix);return Cesium.Matrix4.multiply(r.uniformState.view3D,u,ld),Cesium.Matrix4.multiply(ld,o.modelMatrix,ld)}};e.useElevation&&(a=Cesium.combine(a,{u_maximumHeight:function(){return e.elevationMax},u_minimumHeight:function(){return e.elevationMin},u_image:function(){return WT(r,e.elevationMap)}})),(n||i||s)&&(a=Cesium.combine(a,{u_quantizedVolumeScaleAndOctEncodedRange:function(){var o=VT;if(Cesium.defined(e._quantizedVolumeScale)){var u=Cesium.Cartesian3.clone(e._quantizedVolumeScale,o);Cesium.Cartesian3.divideByScalar(u,e._quantizedRange,o)}return o.w=e._octEncodedRange,o}})),Cesium.defined(e._uniformMapLoaded)&&(a=e._uniformMapLoaded(a)),e._drawCommand.uniformMap=a}var pd=["POSITION","COLOR","NORMAL","POSITION_ABSOLUTE"];function cd(e,t){for(var r=/czm_tiles3d_style_(\w+)/g,n=r.exec(e);n!==null;){var i=n[1];t.indexOf(i)===-1&&t.push(i),n=r.exec(e)}}function hd(e,t){for(var r=e.numberOfAttributes,n=0;n<r;++n){var i=e.getAttribute(n);if(i.index===t)return i}}function dd(e){for(var t=pd.length,r=0;r<t;++r){var n=pd[r],i="czm_tiles3d_style_"+n,s=n.toLowerCase();e=e.replace(new RegExp(i+"(\\W)","g"),s+"$1")}return e.replace("()","(vec3 position, vec3 position_absolute, vec4 color, vec3 normal)")}function qT(){return`vec4 getColorFromElevation()
{
     float scaledHeight = clamp((czm_tiles3d_style_elevation - u_minimumHeight) / (u_maximumHeight - u_minimumHeight), 0.0, 1.0);
     vec4 rampColor = texture2D(u_image, vec2(scaledHeight, 0.5));
     rampColor = czm_gammaCorrect(rampColor);
     return rampColor;
}
`}function HT(e,t,r){var n,i,s,a=t.context,o=Cesium.defined(r),u=e._isQuantized,f=e._isQuantizedDraco,l=e._isOctEncoded16P,c=e._isOctEncodedDraco,h=e._isRGB565,d=e._isTranslucent,m=e._hasColors,g=e._hasNormals,p=e._hasBatchIds,v=e._backFaceCulling,_=e._normalShading,y=e._drawCommand.vertexArray,x=e.clippingPlanes,E=e._attenuation,S,I,P,w=d;if(o){var N={translucent:!1};let be="(vec3 czm_3dtiles_builtin_property_POSITION, vec3 czm_3dtiles_builtin_property_POSITION_ABSOLUTE, vec4 czm_3dtiles_builtin_property_COLOR, vec3 czm_3dtiles_builtin_property_NORMAL)";S=r.getColorShaderFunction("getColorFromStyle","czm_tiles3d_style_",N),I=r.getShowShaderFunction("getShowFromStyle","czm_tiles3d_style_",N),P=r.getPointSizeShaderFunction("getPointSizeFromStyle","czm_tiles3d_style_",N),Cesium.defined(S)&&N.translucent&&(w=!0)}e._styleTranslucent=w;var B=Cesium.defined(S),C=Cesium.defined(I),b=Cesium.defined(P),T=e.isClipped,A=[];B&&(cd(S,A),S=dd(S)),e.useElevation&&!A.includes("elevation")&&A.push("elevation"),C&&(cd(I,A),I=dd(I)),b&&(cd(P,A),P=dd(P));var R=A.indexOf("COLOR")>=0,F=A.indexOf("NORMAL")>=0,D=A.filter(function(be){return pd.indexOf(be)===-1});if(F&&!g)throw new Cesium.RuntimeError("Style references the NORMAL semantic but the point cloud does not have normals");var O=e._styleableShaderAttributes;for(i in O)if(O.hasOwnProperty(i)){s=O[i];var U=D.indexOf(i)>=0,q=hd(y,s.location);q.enabled=U}var Y=m&&(!B||R);if(m){var W=hd(y,Ml);W.enabled=Y}var K=g&&(_||v||F);if(g){var re=hd(y,md);re.enabled=K}var ce={a_position:Ov};Y&&(ce.a_color=Ml),K&&(ce.a_normal=md),p&&(ce.a_batchId=Nv);var Se="",de=D.length;for(n=0;n<de;++n){if(i=D[n],s=O[i],!Cesium.defined(s))throw new Cesium.RuntimeError('Style references a property "'+i+'" that does not exist or is not styleable.');var Ae=s.componentCount,ye="czm_tiles3d_style_"+i,Ie;Ae===1?Ie="float":Ie="vec"+Ae,Se+="attribute "+Ie+" "+ye+`; 
`,ce[ye]=s.location}GT(e,t);var $=`attribute vec3 a_position; 
varying vec4 v_color; 
uniform vec4 u_pointSizeAndTimeAndGeometricErrorAndDepthMultiplier; 
uniform vec4 u_constantColor; 
uniform vec4 u_highlightColor; 
`;$+=`float u_pointSize; 
float u_time; 
`,E&&($+=`float u_geometricError; 
float u_depthMultiplier; 
`),e.useElevation&&($+=`uniform float u_minimumHeight;
uniform float u_maximumHeight; 
uniform sampler2D u_image; 
`),$+=Se,Y&&(d?$+=`attribute vec4 a_color; 
`:h?$+=`attribute float a_color; 
const float SHIFT_RIGHT_11 = 1.0 / 2048.0; 
const float SHIFT_RIGHT_5 = 1.0 / 32.0; 
const float SHIFT_LEFT_11 = 2048.0; 
const float SHIFT_LEFT_5 = 32.0; 
const float NORMALIZE_6 = 1.0 / 64.0; 
const float NORMALIZE_5 = 1.0 / 32.0; 
`:$+=`attribute vec3 a_color; 
`),K&&(l||c?$+=`attribute vec2 a_normal; 
`:$+=`attribute vec3 a_normal; 
`),p&&($+=`attribute float a_batchId; 
`),(u||f||c)&&($+=`uniform vec4 u_quantizedVolumeScaleAndOctEncodedRange; 
`),e.useElevation&&($+=qT()),B&&($+=S),C&&($+=I),b&&($+=P),$+=`void main() 
{ 
    u_pointSize = u_pointSizeAndTimeAndGeometricErrorAndDepthMultiplier.x; 
    u_time = u_pointSizeAndTimeAndGeometricErrorAndDepthMultiplier.y; 
`,E&&($+=`    u_geometricError = u_pointSizeAndTimeAndGeometricErrorAndDepthMultiplier.z; 
    u_depthMultiplier = u_pointSizeAndTimeAndGeometricErrorAndDepthMultiplier.w; 
`),Y?d?$+=`    vec4 color = a_color; 
`:h?$+=`    float compressed = a_color; 
    float r = floor(compressed * SHIFT_RIGHT_11); 
    compressed -= r * SHIFT_LEFT_11; 
    float g = floor(compressed * SHIFT_RIGHT_5); 
    compressed -= g * SHIFT_LEFT_5; 
    float b = compressed; 
    vec3 rgb = vec3(r * NORMALIZE_5, g * NORMALIZE_6, b * NORMALIZE_5); 
    vec4 color = vec4(rgb, 1.0); 
`:$+=`    vec4 color = vec4(a_color, 1.0); 
`:$+=`    vec4 color = u_constantColor; 
`,u||f?$+=`    vec3 position = a_position * u_quantizedVolumeScaleAndOctEncodedRange.xyz; 
`:$+=`    vec3 position = a_position; 
`,$+=`    vec3 position_absolute = vec3(czm_model * vec4(position, 1.0)); 
`,K?(l?$+=`    vec3 normal = czm_octDecode(a_normal); 
`:c?$+=`    vec3 normal = czm_octDecode(a_normal, u_quantizedVolumeScaleAndOctEncodedRange.w).zxy; 
`:$+=`    vec3 normal = a_normal; 
`,$+=`    vec3 normalEC = czm_normal * normal; 
`):$+=`    vec3 normal = vec3(1.0); 
`,e.useElevation&&($+=`    color = getColorFromElevation(); 
`),B&&($+=`    color = getColorFromStyle(position, position_absolute, color, normal); 
`),C&&($+=`    float show = float(getShowFromStyle(position, position_absolute, color, normal)); 
`),b?$+=`    gl_PointSize = getPointSizeFromStyle(position, position_absolute, color, normal) * czm_pixelRatio; 
`:E?$+=`    vec4 positionEC = czm_modelView * vec4(position, 1.0); 
    float depth = -positionEC.z; 
    gl_PointSize = min((u_geometricError / depth) * u_depthMultiplier, u_pointSize); 
`:$+=`    gl_PointSize = u_pointSize; 
`,$+=`    color = color * u_highlightColor; 
`,K&&_&&($+=`    float diffuseStrength = czm_getLambertDiffuse(czm_lightDirectionEC, normalEC); 
    diffuseStrength = max(diffuseStrength, 0.4); 
    color.xyz *= diffuseStrength * czm_lightColor; 
`),$+=`    v_color = color; 
    gl_Position = czm_modelViewProjection * vec4(position, 1.0); 
`,K&&v&&($+=`    float visible = step(-normalEC.z, 0.0); 
    gl_Position *= visible; 
    gl_PointSize *= visible; 
`),C&&($+=`    gl_Position.w *= float(show); 
    gl_PointSize *= float(show); 
`),$+=`} 
`;var De=`varying vec4 v_color; 
`;T&&(De+=`uniform sampler2D u_clippingPlanes; 
uniform mat4 u_clippingPlanesMatrix; 
uniform vec4 u_clippingPlanesEdgeStyle; 
`,De+=`
`,De+=Cesium.getClippingFunction(x,a),De+=`
`),De+=`void main() 
{ 
    gl_FragColor = czm_gammaCorrect(v_color); 
`,e._highQulity&&(De+=`float u = 2.0 * gl_PointCoord.x - 1.0; 
float v = 2.0 * gl_PointCoord.y - 1.0; 
float cc = u*u + v*v;
if(cc > 1.0){
    discard;
  }
`),T&&(De+=Cesium.getClipAndStyleCode("u_clippingPlanes","u_clippingPlanesMatrix","u_clippingPlanesEdgeStyle")),De+=`} 
`,Cesium.defined(e._vertexShaderLoaded)&&($=e._vertexShaderLoaded($)),Cesium.defined(e._fragmentShaderLoaded)&&(De=e._fragmentShaderLoaded(De));var se=e._drawCommand;Cesium.defined(se.shaderProgram)&&se.shaderProgram.destroy(),se.shaderProgram=Cesium.ShaderProgram.fromCache({context:a,vertexShaderSource:$,fragmentShaderSource:De,attributeLocations:ce});try{se.shaderProgram._bind()}catch{throw new Cesium.RuntimeError("Error generating style shader: this may be caused by a type mismatch, index out-of-bounds, or other syntax error.")}}function WT(e,t){if(Cesium.defined(t.elevationTexture))return t.elevationTexture;var r,n;if(Cesium.defined(t.elevationRamp)?r=t.elevationRamp:r=[0,.045,.1,.15,.37,.54,1],!Cesium.defined(t.colorRamp))n=["#000000","#2747E0","#D33B7D","#D33038","#FF9742","#ffd700","#ffffff"];else{n=t.colorRamp;for(var i=0;i<n.length;i++)n[i]=YT(n[i])}var s=document.createElement("canvas");s.width=100,s.height=1;for(var a=s.getContext("2d"),o=a.createLinearGradient(0,0,100,0),u=r.length>n.length?n.length:r.length,i=0;i<u;i++)o.addColorStop(r[i],n[i]);a.fillStyle=o,a.fillRect(0,0,100,1);var f=new Ir({context:e,source:s});return t.elevationTexture=f,f}function YT(e){var t=e.replace(/rgba?\(/,"").replace(/\)/,"").replace(/[\s+]/g,"").split(","),r=parseFloat(t[3]||1),n=Math.floor(r*parseInt(t[0])+(1-r)*255),i=Math.floor(r*parseInt(t[1])+(1-r)*255),s=Math.floor(r*parseInt(t[2])+(1-r)*255),a="#"+((1<<24)+(n<<16)+(i<<8)+s).toString(16).slice(1);return a}function XT(e,t){if(e._decodingState===Ls.READY)return!1;if(e._decodingState===Ls.NEEDS_DECODE){var r=e._parsedContent,n=r.draco,i=es.decodePointCloud(n,t);Cesium.defined(i)&&(e._decodingState=Ls.DECODING,i.then(function(s){e.meshPrimitives.push(s),e.useDracoDecoded=!0,e._decodingState=Ls.READY;var a=Cesium.defined(s.POSITION)?s.POSITION.array:void 0,o=Cesium.defined(s.RGB)?s.RGB.array:void 0,u=Cesium.defined(s.RGBA)?s.RGBA.array:void 0,f=Cesium.defined(s.NORMAL)?s.NORMAL.array:void 0,l=Cesium.defined(s.BATCH_ID)?s.BATCH_ID.array:void 0,c=Cesium.defined(a)&&Cesium.defined(s.POSITION.data.quantization),h=Cesium.defined(f)&&Cesium.defined(s.NORMAL.data.quantization);if(c){var d=s.POSITION.data.quantization,m=d.range;e._quantizedVolumeScale=Cesium.Cartesian3.fromElements(m,m,m),e._quantizedVolumeOffset=Cesium.Cartesian3.unpack(d.minValues),e._quantizedRange=(1<<d.quantizationBits)-1,e._isQuantizedDraco=!0}h&&(e._octEncodedRange=(1<<s.NORMAL.data.quantization.quantizationBits)-1,e._isOctEncodedDraco=!0);var g=r.styleableProperties,p=n.batchTableProperties;for(var v in p)if(p.hasOwnProperty(v)){var _=s[v];Cesium.defined(g)||(g={}),g[v]={typedArray:_.array,componentCount:_.data.componentsPerAttribute}}r.positions=Cesium.defaultValue(a,r.positions),r.colors=Cesium.defaultValue(Cesium.defaultValue(u,o),r.colors),r.normals=Cesium.defaultValue(f,r.normals),r.batchIds=Cesium.defaultValue(l,r.batchIds),r.styleableProperties=g}).catch(function(s){e._decodingState=Ls.FAILED,e._readyPromise.reject(s)}))}return!0}function jT(e,t,r){if(e._decodingState===Ls.READY)return!1;var n=e._parsedContent,i=n.draco;e._decodingState=Ls.READY;var s=Cesium.defined(r.POSITION)?r.POSITION.array:void 0,a=Cesium.defined(r.RGB)?r.RGB.array:void 0,o=Cesium.defined(r.RGBA)?r.RGBA.array:void 0,u=Cesium.defined(r.NORMAL)?r.NORMAL.array:void 0,f=Cesium.defined(r.BATCH_ID)?r.BATCH_ID.array:void 0,l=Cesium.defined(s)&&Cesium.defined(r.POSITION.data.quantization),c=Cesium.defined(u)&&Cesium.defined(r.NORMAL.data.quantization);if(l){var h=r.POSITION.data.quantization,d=h.range;e._quantizedVolumeScale=Cesium.Cartesian3.fromElements(d,d,d),e._quantizedVolumeOffset=Cesium.Cartesian3.unpack(h.minValues),e._quantizedRange=(1<<h.quantizationBits)-1,e._isQuantizedDraco=!0}c&&(e._octEncodedRange=(1<<r.NORMAL.data.quantization.quantizationBits)-1,e._isOctEncodedDraco=!0);var m=n.styleableProperties,g=i.batchTableProperties;for(var p in g)if(g.hasOwnProperty(p)){var v=r[p];Cesium.defined(m)||(m={}),m[p]={typedArray:v.array,componentCount:v.data.componentsPerAttribute}}return n.positions=Cesium.defaultValue(s,n.positions),n.colors=Cesium.defaultValue(Cesium.defaultValue(o,a),n.colors),n.normals=Cesium.defaultValue(u,n.normals),n.batchIds=Cesium.defaultValue(f,n.batchIds),n.styleableProperties=m,!1}var KT=new Cesium.Cartesian4,QT=new Cesium.Cartesian3;Yu.prototype.update=function(e){var t=e.context,r=!1;if(this.meshPrimitives.length>0?(r=jT(this,t,this.meshPrimitives[0]),this.useDracoDecoded||(this.meshPrimitives.length=0)):r=XT(this,t),!r){var n=!1,i=!Cesium.Matrix4.equals(this._modelMatrix,this.modelMatrix);if(this._mode!==e.mode&&(this._mode=e.mode,i=!0),Cesium.defined(this._drawCommand)||(UT(this,e),i=!0,n=!0,this._ready=!0,this._readyPromise.resolve(this),this._parsedContent=void 0),i){Cesium.Matrix4.clone(this.modelMatrix,this._modelMatrix);var s=this._drawCommand.modelMatrix;if(Cesium.Matrix4.clone(this._modelMatrix,s),Cesium.defined(this._rtcCenter)&&Cesium.Matrix4.multiplyByTranslation(s,this._rtcCenter,s),Cesium.defined(this._quantizedVolumeOffset)&&Cesium.Matrix4.multiplyByTranslation(s,this._quantizedVolumeOffset,s),e.mode!==Cesium.SceneMode.SCENE3D){var a=e.mapProjection,o=Cesium.Matrix4.getColumn(s,3,KT);Cesium.Cartesian4.equals(o,Cesium.Cartesian4.UNIT_W)||Cesium.Transforms.basisTo2D(a,s,s)}var u=this._drawCommand.boundingVolume;if(Cesium.BoundingSphere.clone(this._boundingSphere,u),this._cull){var f=u.center;Cesium.Matrix4.multiplyByPoint(s,f,f);var l=Cesium.Matrix4.getScale(s,QT);u.radius*=Cesium.Cartesian3.maximumComponent(l)}}this.clippingPlanesDirty&&(this.clippingPlanesDirty=!1,n=!0),this._attenuation!==this.attenuation&&(this._attenuation=this.attenuation,n=!0),this.backFaceCulling!==this._backFaceCulling&&(this._backFaceCulling=this.backFaceCulling,n=!0),this.normalShading!==this._normalShading&&(this._normalShading=this.normalShading,n=!0),(this._style!==this.style||this.styleDirty)&&(this._style=this.style,this.styleDirty=!1,n=!0),n&&HT(this,e,this._style),this._drawCommand.castShadows=Cesium.ShadowMode.castShadows(this.shadows),this._drawCommand.receiveShadows=Cesium.ShadowMode.receiveShadows(this.shadows);var c=this._highlightColor.alpha<1||this._constantColor.alpha<1||this._styleTranslucent;this._drawCommand.renderState=c?this._translucentRenderState:this._opaqueRenderState,this._drawCommand.pass=c?Cesium.Pass.TRANSLUCENT:this._opaquePass;var h=e.commandList,d=e.passes;(d.render||d.pick)&&h.push(this._drawCommand)}};Yu.prototype.isDestroyed=function(){return!1};Yu.prototype.destroy=function(){var e=this._drawCommand;return Cesium.defined(e)&&(e.vertexArray=e.vertexArray&&e.vertexArray.destroy(),e.shaderProgram=e.shaderProgram&&e.shaderProgram.destroy()),Cesium.destroyObject(this)};var gd=Yu;function rs(e,t,r,n,i){this._tileset=e,this._tile=t,this._resource=r,this._pickId=void 0,this._batchTable=void 0,this._styleDirty=!1,this._features=void 0,this.featurePropertiesDirty=!1,this._pointCloud=new gd({arrayBuffer:n,byteOffset:i,cull:!1,opaquePass:Cesium.Pass.CESIUM_3D_TILE,useElevation:e._useElevation,elevationMap:e._elevationMap,vertexShaderLoaded:ZT(this),fragmentShaderLoaded:JT(this),uniformMapLoaded:$T(this),batchTableLoaded:eI(this),pickIdLoaded:tI(this),highQulity:e.pointCloudShading.highQulity})}Object.defineProperties(rs.prototype,{featuresLength:{get:function(){return Cesium.defined(this._batchTable)?this._batchTable.featuresLength:0}},pointsLength:{get:function(){return this._pointCloud.pointsLength}},trianglesLength:{get:function(){return 0}},geometryByteLength:{get:function(){return this._pointCloud.geometryByteLength}},texturesByteLength:{get:function(){return 0}},batchTableByteLength:{get:function(){return Cesium.defined(this._batchTable)?this._batchTable.memorySizeInBytes:0}},innerContents:{get:function(){}},readyPromise:{get:function(){return this._pointCloud.readyPromise}},tileset:{get:function(){return this._tileset}},tile:{get:function(){return this._tile}},url:{get:function(){return this._resource.getUrlComponent(!0)}},batchTable:{get:function(){return this._batchTable}}});function ZT(e){return function(t){return Cesium.defined(e._batchTable)?e._batchTable.getVertexShaderCallback(!1,"a_batchId",void 0)(t):t}}function JT(e){return function(t){return Cesium.defined(e._batchTable)?e._batchTable.getFragmentShaderCallback(!1,void 0)(t):`uniform vec4 czm_pickColor;
`+t}}function $T(e){return function(t){return Cesium.defined(e._batchTable)?e._batchTable.getUniformMapCallback()(t):Cesium.combine(t,{czm_pickColor:function(){return e._pickId.color}})}}function eI(e){return function(t,r,n){var i=new zr(e,t,r,n);if(e._batchTable=i,Cesium.defined(e._tile._header.EVID))for(var s=i.featuresLength,a=0;a<s;a++)i.setProperty(a,"EVID",e._tile._header.EVID);this._readyPromise.then(function(o){if(o.useElevation){if(Cesium.defined(e.tileset.elevationMax))o.elevationMax=e.tileset.elevationMax,o.elevationMin=e.tileset.elevationMin;else{var g=o._parsedContent.styleableProperties;if(g.hasOwnProperty("elevation")){for(var u=g.elevation,f=u.typedArray,l=f[0],c=f[0],h=f.length,d=1;d<h;d++){var m=f[d];l=l>m?l:m,c=c<m?c:m}o.elevationMax=l,o.elevationMin=c,e.tileset.elevationMax?(e.tileset.elevationMax=e.tileset.elevationMax>l?e.tileset.elevationMax:l,e.tileset.elevationMin=e.tileset.elevationMin<c?e.tileset.elevationMin:c):(e.tileset.elevationMax=l,e.tileset.elevationMin=c)}}var g=o._parsedContent.styleableProperties;if(Cesium.defined(e.tileset.styleableProperties)||(e.tileset.styleableProperties=g),g.hasOwnProperty("intensity")&&!e.tileset.hasOwnProperty("intensityMax")){for(var u=g.intensity,f=u.typedArray,p=f[0],v=f[0],h=f.length,d=1;d<h;d++){var m=f[d];p=p>m?p:m,v=v<m?v:m}o.intensityMax=p,o.intensityMin=v,e.tileset.intensityMax?(e.tileset.intensityMax=e.tileset.intensityMax>p?e.tileset.intensityMax:p,e.tileset.intensityMin=e.tileset.intensityMin<v?e.tileset.intensityMin:v):(e.tileset.intensityMax=p,e.tileset.intensityMin=v)}if(g.hasOwnProperty("return")&&!e.tileset.hasOwnProperty("returnMax")){for(var u=g.return,f=u.typedArray,_=f[0],y=f[0],h=f.length,d=1;d<h;d++){var m=f[d];_=_>m?_:m,y=y<m?y:m}o.returnMax=_,o.returnMin=y,e.tileset.returnMax?(e.tileset.returnMax=e.tileset.returnMax>_?e.tileset.returnMax:_,e.tileset.returnMin=e.tileset.returnMin<y?e.tileset.returnMin:y):(e.tileset.returnMax=_,e.tileset.returnMin=y)}if(g.hasOwnProperty("classification")&&!e.tileset.hasOwnProperty("classificationMax")){var u=g.classification,f=u.typedArray;e.tileset.classification=f[0];for(var x=f[0],E=f[0],h=f.length,d=1;d<h;d++){var m=f[d];x=x>m?x:m,E=E<m?E:m}o.classificationMax=x,o.classificationMin=E,e.tileset.classificationMax?(e.tileset.classificationMax=e.tileset.classificationMax>x?e.tileset.classificationMax:x,e.tileset.classificationMin=e.tileset.classificationMin<E?e.tileset.classificationMin:E):(e.tileset.classificationMax=x,e.tileset.classificationMin=E)}}})}}function tI(e){return function(){return Cesium.defined(e._batchTable)?e._batchTable.getPickId():"czm_pickColor"}}function rI(e){var t=e._tileset.pointCloudShading,r=e._tile.contentBoundingVolume.boundingSphere.volume(),n=Cesium.Math.cbrt(r/e.pointsLength),i=e._tile.geometricError;return i===0&&(Cesium.defined(t)&&Cesium.defined(t.baseResolution)?i=t.baseResolution:i=n),i}function nI(e){var t=e.featuresLength;if(!Cesium.defined(e._features)&&t>0){for(var r=new Array(t),n=0;n<t;++n)r[n]=new Rn(e,n);e._features=r}}rs.prototype.hasProperty=function(e,t){return Cesium.defined(this._batchTable)?this._batchTable.hasProperty(e,t):!1};rs.prototype.getFeature=function(e){if(Cesium.defined(this._batchTable)){var t=this.featuresLength;return nI(this),this._features[e]}};rs.prototype.applyDebugSettings=function(e,t){this._pointCloud.color=e?t:Cesium.Color.WHITE};rs.prototype.applyStyle=function(e){Cesium.defined(this._batchTable)||(this._styleDirty=!0)};var iI=new Cesium.PointCloudShading;rs.prototype.update=function(e,t){var r=this._pointCloud,n=Cesium.defaultValue(e.pointCloudShading,iI),i=this._tile,s=this._batchTable,a=t.mode,o=e.clippingPlanes;!Cesium.defined(this._pickId)&&!Cesium.defined(s)&&(this._pickId=t.context.createPickId({primitive:e,content:this})),Cesium.defined(s)&&s.update(e,t);var u;Cesium.defined(i._contentBoundingVolume)?u=a===Cesium.SceneMode.SCENE3D?i._contentBoundingVolume.boundingSphere:i._contentBoundingVolume2D.boundingSphere:u=a===Cesium.SceneMode.SCENE3D?i._boundingVolume.boundingSphere:i._boundingVolume2D.boundingSphere;var f=this._styleDirty;this._styleDirty=!1,r.clippingPlanesOriginMatrix=e.clippingPlanesOriginMatrix,r.style=e.style,r.styleDirty=f,r.modelMatrix=i.computedTransform,r.time=e.timeSinceLoad,r.shadows=e.shadows,r.boundingSphere=u,r.clippingPlanes=o,r.isClipped=Cesium.defined(o)&&o.enabled&&i._isClipped,r.clippingPlanesDirty=i.clippingPlanesDirty,r.attenuation=n.attenuation,r.backFaceCulling=n.backFaceCulling,r.normalShading=n.normalShading,r.geometricError=rI(this),r.geometricErrorScale=n.geometricErrorScale,Cesium.defined(n)&&Cesium.defined(n.maximumAttenuation)?r.maximumAttenuation=n.maximumAttenuation:i.refine===Cesium.Cesium3DTileRefine.ADD?r.maximumAttenuation=5:r.maximumAttenuation=e.maximumScreenSpaceError,r.elevationMap=e._elevationMap,r.update(t)};rs.prototype.isDestroyed=function(){return!1};rs.prototype.pointCloud3DTileContent=!0;rs.prototype.destroy=function(){return this._pickId=this._pickId&&this._pickId.destroy(),this._pointCloud=this._pointCloud&&this._pointCloud.destroy(),this._batchTable=this._batchTable&&this._batchTable.destroy(),Cesium.destroyObject(this)};var vd=rs;function Ps(e,t,r,n,i){this._tileset=e,this._tile=t,this._resource=r,this._readyPromise=Ne.defer(),this.featurePropertiesDirty=!1,sI(this,n,i)}Object.defineProperties(Ps.prototype,{featuresLength:{get:function(){return 0}},pointsLength:{get:function(){return 0}},trianglesLength:{get:function(){return 0}},geometryByteLength:{get:function(){return 0}},texturesByteLength:{get:function(){return 0}},batchTableByteLength:{get:function(){return 0}},innerContents:{get:function(){}},readyPromise:{get:function(){return this._readyPromise.promise}},tileset:{get:function(){return this._tileset}},tile:{get:function(){return this._tile}},url:{get:function(){return this._resource.getUrlComponent(!0)}},batchTable:{get:function(){}}});function sI(e,t,r){r=Cesium.defaultValue(r,0);var n=new Uint8Array(t),i=Cesium.getStringFromTypedArray(n,r),s;try{s=JSON.parse(i)}catch{e._readyPromise.reject(new Cesium.RuntimeError("Invalid tile content."));return}e._tileset.loadTileset(e._resource,s,e._tile),e._readyPromise.resolve(e)}Ps.prototype.hasProperty=function(e,t){return!1};Ps.prototype.getFeature=function(e){};Ps.prototype.applyDebugSettings=function(e,t){};Ps.prototype.applyStyle=function(e){};Ps.prototype.update=function(e,t){};Ps.prototype.isDestroyed=function(){return!1};Ps.prototype.destroy=function(){return Cesium.destroyObject(this)};var _d=Ps;function aI(e){return e!=null}var Te=aI;function Fv(e,t){return e??t}Fv.EMPTY_OBJECT=Object.freeze({});var Oe=Fv;var oa,sr={requestFullscreen:void 0,exitFullscreen:void 0,fullscreenEnabled:void 0,fullscreenElement:void 0,fullscreenchange:void 0,fullscreenerror:void 0},Nn={};Object.defineProperties(Nn,{element:{get:function(){if(Nn.supportsFullscreen())return document[sr.fullscreenElement]}},changeEventName:{get:function(){if(Nn.supportsFullscreen())return sr.fullscreenchange}},errorEventName:{get:function(){if(Nn.supportsFullscreen())return sr.fullscreenerror}},enabled:{get:function(){if(Nn.supportsFullscreen())return document[sr.fullscreenEnabled]}},fullscreen:{get:function(){if(Nn.supportsFullscreen())return Nn.element!==null}}});Nn.supportsFullscreen=function(){if(Te(oa))return oa;oa=!1;let e=document.body;if(typeof e.requestFullscreen=="function")return sr.requestFullscreen="requestFullscreen",sr.exitFullscreen="exitFullscreen",sr.fullscreenEnabled="fullscreenEnabled",sr.fullscreenElement="fullscreenElement",sr.fullscreenchange="fullscreenchange",sr.fullscreenerror="fullscreenerror",oa=!0,oa;let t=["webkit","moz","o","ms","khtml"],r;for(let n=0,i=t.length;n<i;++n){let s=t[n];r=`${s}RequestFullscreen`,typeof e[r]=="function"?(sr.requestFullscreen=r,oa=!0):(r=`${s}RequestFullScreen`,typeof e[r]=="function"&&(sr.requestFullscreen=r,oa=!0)),r=`${s}ExitFullscreen`,typeof document[r]=="function"?sr.exitFullscreen=r:(r=`${s}CancelFullScreen`,typeof document[r]=="function"&&(sr.exitFullscreen=r)),r=`${s}FullscreenEnabled`,document[r]!==void 0?sr.fullscreenEnabled=r:(r=`${s}FullScreenEnabled`,document[r]!==void 0&&(sr.fullscreenEnabled=r)),r=`${s}FullscreenElement`,document[r]!==void 0?sr.fullscreenElement=r:(r=`${s}FullScreenElement`,document[r]!==void 0&&(sr.fullscreenElement=r)),r=`${s}fullscreenchange`,document[`on${r}`]!==void 0&&(s==="ms"&&(r="MSFullscreenChange"),sr.fullscreenchange=r),r=`${s}fullscreenerror`,document[`on${r}`]!==void 0&&(s==="ms"&&(r="MSFullscreenError"),sr.fullscreenerror=r)}return oa};Nn.requestFullscreen=function(e,t){Nn.supportsFullscreen()&&e[sr.requestFullscreen]({vrDisplay:t})};Nn.exitFullscreen=function(){Nn.supportsFullscreen()&&document[sr.exitFullscreen]()};Nn._names=sr;var Bv=Nn;var cn;typeof navigator<"u"?cn=navigator:cn={};function Ya(e){let t=e.split(".");for(let r=0,n=t.length;r<n;++r)t[r]=parseInt(t[r],10);return t}var Al,Vv;function wd(){if(!Te(Al)&&(Al=!1,!Bl())){let e=/ Chrome\/([\.0-9]+)/.exec(cn.userAgent);e!==null&&(Al=!0,Vv=Ya(e[1]))}return Al}function oI(){return wd()&&Vv}var Dl,zv;function kv(){if(!Te(Dl)&&(Dl=!1,!wd()&&!Bl()&&/ Safari\/[\.0-9]+/.test(cn.userAgent))){let e=/ Version\/([\.0-9]+)/.exec(cn.userAgent);e!==null&&(Dl=!0,zv=Ya(e[1]))}return Dl}function uI(){return kv()&&zv}var Rl,Ed;function Uv(){if(!Te(Rl)){Rl=!1;let e=/ AppleWebKit\/([\.0-9]+)(\+?)/.exec(cn.userAgent);e!==null&&(Rl=!0,Ed=Ya(e[1]),Ed.isNightly=!!e[2])}return Rl}function fI(){return Uv()&&Ed}var Xu,bd;function Gv(){if(!Te(Xu)){Xu=!1;let e;cn.appName==="Microsoft Internet Explorer"?(e=/MSIE ([0-9]{1,}[\.0-9]{0,})/.exec(cn.userAgent),e!==null&&(Xu=!0,bd=Ya(e[1]))):cn.appName==="Netscape"&&(e=/Trident\/.*rv:([0-9]{1,}[\.0-9]{0,})/.exec(cn.userAgent),e!==null&&(Xu=!0,bd=Ya(e[1])))}return Xu}function lI(){return Gv()&&bd}var Ol,qv;function Bl(){if(!Te(Ol)){Ol=!1;let e=/ Edg\/([\.0-9]+)/.exec(cn.userAgent);e!==null&&(Ol=!0,qv=Ya(e[1]))}return Ol}function cI(){return Bl()&&qv}var Nl,Hv;function Sd(){if(!Te(Nl)){Nl=!1;let e=/Firefox\/([\.0-9]+)/.exec(cn.userAgent);e!==null&&(Nl=!0,Hv=Ya(e[1]))}return Nl}var Cd;function hI(){return Te(Cd)||(Cd=/Windows/i.test(cn.appVersion)),Cd}var yd;function dI(){return Te(yd)||(yd=navigator.platform==="iPhone"||navigator.platform==="iPod"||navigator.platform==="iPad"),yd}function mI(){return Sd()&&Hv}var xd;function pI(){return Te(xd)||(xd=!Sd()&&typeof PointerEvent<"u"&&(!Te(cn.pointerEnabled)||cn.pointerEnabled)),xd}var Wv,Fl;function Yv(){if(!Te(Fl)){let e=document.createElement("canvas");e.setAttribute("style","image-rendering: -moz-crisp-edges;image-rendering: pixelated;");let t=e.style.imageRendering;Fl=Te(t)&&t!=="",Fl&&(Wv=t)}return Fl}function gI(){return Yv()?Wv:void 0}function En(){return En._result}En._promise=void 0;En._result=void 0;En.initialize=function(){return Te(En._promise)||(En._promise=new Promise(e=>{let t=new Image;t.onload=function(){En._result=t.width>0&&t.height>0,e(En._result)},t.onerror=function(){En._result=!1,e(En._result)},t.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA"})),En._promise};Object.defineProperties(En,{initialized:{get:function(){return Te(En._result)}}});var Bo=[];typeof ArrayBuffer<"u"&&(Bo.push(Int8Array,Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array),typeof Uint8ClampedArray<"u"&&Bo.push(Uint8ClampedArray),typeof Uint8ClampedArray<"u"&&Bo.push(Uint8ClampedArray),typeof BigInt64Array<"u"&&Bo.push(BigInt64Array),typeof BigUint64Array<"u"&&Bo.push(BigUint64Array));var Oi={isChrome:wd,chromeVersion:oI,isSafari:kv,safariVersion:uI,isWebkit:Uv,webkitVersion:fI,isInternetExplorer:Gv,internetExplorerVersion:lI,isEdge:Bl,edgeVersion:cI,isFirefox:Sd,firefoxVersion:mI,isWindows:hI,isIPadOrIOS:dI,hardwareConcurrency:Oe(cn.hardwareConcurrency,3),supportsPointerEvents:pI,supportsImageRenderingPixelated:Yv,supportsWebP:En,imageRenderingValue:gI,typedArrayTypes:Bo};Oi.supportsBasis=function(e){return Oi.supportsWebAssembly()&&e.context.supportsBasis};Oi.supportsFullscreen=function(){return Bv.supportsFullscreen()};Oi.supportsTypedArrays=function(){return typeof ArrayBuffer<"u"};Oi.supportsBigInt64Array=function(){return typeof BigInt64Array<"u"};Oi.supportsBigUint64Array=function(){return typeof BigUint64Array<"u"};Oi.supportsBigInt=function(){return typeof BigInt<"u"};Oi.supportsWebWorkers=function(){return typeof Worker<"u"};Oi.supportsWebAssembly=function(){return typeof WebAssembly<"u"};Oi.supportsWebgl2=function(e){return e.context.webgl2};var Xv=Oi;var Td=dh(Kv(),1);var X={};X.EPSILON1=.1;X.EPSILON2=.01;X.EPSILON3=.001;X.EPSILON4=1e-4;X.EPSILON5=1e-5;X.EPSILON6=1e-6;X.EPSILON7=1e-7;X.EPSILON8=1e-8;X.EPSILON9=1e-9;X.EPSILON10=1e-10;X.EPSILON11=1e-11;X.EPSILON12=1e-12;X.EPSILON13=1e-13;X.EPSILON14=1e-14;X.EPSILON15=1e-15;X.EPSILON16=1e-16;X.EPSILON17=1e-17;X.EPSILON18=1e-18;X.EPSILON19=1e-19;X.EPSILON20=1e-20;X.EPSILON21=1e-21;X.GRAVITATIONALPARAMETER=3986004418e5;X.SOLAR_RADIUS=6955e5;X.LUNAR_RADIUS=1737400;X.SIXTY_FOUR_KILOBYTES=64*1024;X.FOUR_GIGABYTES=4*1024*1024*1024;X.sign=Oe(Math.sign,function(t){return t=+t,t===0||t!==t?t:t>0?1:-1});X.signNotZero=function(e){return e<0?-1:1};X.toSNorm=function(e,t){return t=Oe(t,255),Math.round((X.clamp(e,-1,1)*.5+.5)*t)};X.fromSNorm=function(e,t){return t=Oe(t,255),X.clamp(e,0,t)/t*2-1};X.normalize=function(e,t,r){return r=Math.max(r-t,0),r===0?0:X.clamp((e-t)/r,0,1)};X.sinh=Oe(Math.sinh,function(t){return(Math.exp(t)-Math.exp(-t))/2});X.cosh=Oe(Math.cosh,function(t){return(Math.exp(t)+Math.exp(-t))/2});X.lerp=function(e,t,r){return(1-r)*e+r*t};X.PI=Math.PI;X.ONE_OVER_PI=1/Math.PI;X.PI_OVER_TWO=Math.PI/2;X.PI_OVER_THREE=Math.PI/3;X.PI_OVER_FOUR=Math.PI/4;X.PI_OVER_SIX=Math.PI/6;X.THREE_PI_OVER_TWO=3*Math.PI/2;X.TWO_PI=2*Math.PI;X.ONE_OVER_TWO_PI=1/(2*Math.PI);X.RADIANS_PER_DEGREE=Math.PI/180;X.DEGREES_PER_RADIAN=180/Math.PI;X.RADIANS_PER_ARCSECOND=X.RADIANS_PER_DEGREE/3600;X.toRadians=function(e){return e*X.RADIANS_PER_DEGREE};X.toDegrees=function(e){return e*X.DEGREES_PER_RADIAN};X.convertLongitudeRange=function(e){let t=X.TWO_PI,r=e-Math.floor(e/t)*t;return r<-Math.PI?r+t:r>=Math.PI?r-t:r};X.clampToLatitudeRange=function(e){return X.clamp(e,-1*X.PI_OVER_TWO,X.PI_OVER_TWO)};X.negativePiToPi=function(e){return e>=-X.PI&&e<=X.PI?e:X.zeroToTwoPi(e+X.PI)-X.PI};X.zeroToTwoPi=function(e){if(e>=0&&e<=X.TWO_PI)return e;let t=X.mod(e,X.TWO_PI);return Math.abs(t)<X.EPSILON14&&Math.abs(e)>X.EPSILON14?X.TWO_PI:t};X.mod=function(e,t){return X.sign(e)===X.sign(t)&&Math.abs(e)<Math.abs(t)?e:(e%t+t)%t};X.equalsEpsilon=function(e,t,r,n){r=Oe(r,0),n=Oe(n,r);let i=Math.abs(e-t);return i<=n||i<=r*Math.max(Math.abs(e),Math.abs(t))};X.lessThan=function(e,t,r){return e-t<-r};X.lessThanOrEquals=function(e,t,r){return e-t<r};X.greaterThan=function(e,t,r){return e-t>r};X.greaterThanOrEquals=function(e,t,r){return e-t>-r};var Vl=[1];X.factorial=function(e){let t=Vl.length;if(e>=t){let r=Vl[t-1];for(let n=t;n<=e;n++){let i=r*n;Vl.push(i),r=i}}return Vl[e]};X.incrementWrap=function(e,t,r){return r=Oe(r,0),++e,e>t&&(e=r),e};X.isPowerOfTwo=function(e){return e!==0&&(e&e-1)===0};X.nextPowerOfTwo=function(e){return--e,e|=e>>1,e|=e>>2,e|=e>>4,e|=e>>8,e|=e>>16,++e,e};X.previousPowerOfTwo=function(e){return e|=e>>1,e|=e>>2,e|=e>>4,e|=e>>8,e|=e>>16,e|=e>>32,e=(e>>>0)-(e>>>1),e};X.clamp=function(e,t,r){return e<t?t:e>r?r:e};var Qv=new Td.default;X.setRandomNumberSeed=function(e){Qv=new Td.default(e)};X.nextRandomNumber=function(){return Qv.random()};X.randomBetween=function(e,t){return X.nextRandomNumber()*(t-e)+e};X.acosClamped=function(e){return Math.acos(X.clamp(e,-1,1))};X.asinClamped=function(e){return Math.asin(X.clamp(e,-1,1))};X.chordLength=function(e,t){return 2*t*Math.sin(e*.5)};X.logBase=function(e,t){return Math.log(e)/Math.log(t)};X.cbrt=Oe(Math.cbrt,function(t){let r=Math.pow(Math.abs(t),.3333333333333333);return t<0?-r:r});X.log2=Oe(Math.log2,function(t){return Math.log(t)*Math.LOG2E});X.fog=function(e,t){let r=e*t;return 1-Math.exp(-(r*r))};X.fastApproximateAtan=function(e){return e*(-.1784*Math.abs(e)-.0663*e*e+1.0301)};X.fastApproximateAtan2=function(e,t){let r,n=Math.abs(e);r=Math.abs(t);let i=Math.max(n,r);r=Math.min(n,r);let s=r/i;return n=X.fastApproximateAtan(s),n=Math.abs(t)>Math.abs(e)?X.PI_OVER_TWO-n:n,n=e<0?X.PI-n:n,n=t<0?-n:n,n};var As=X;function Id(e,t,r){return r<0&&(r+=1),r>1&&(r-=1),r*6<1?e+(t-e)*6*r:r*2<1?t:r*3<2?e+(t-e)*(2/3-r)*6:e}function M(e,t,r,n){this.red=Oe(e,1),this.green=Oe(t,1),this.blue=Oe(r,1),this.alpha=Oe(n,1)}M.fromCartesian4=function(e,t){return Te(t)?(t.red=e.x,t.green=e.y,t.blue=e.z,t.alpha=e.w,t):new M(e.x,e.y,e.z,e.w)};M.fromBytes=function(e,t,r,n,i){return e=M.byteToFloat(Oe(e,255)),t=M.byteToFloat(Oe(t,255)),r=M.byteToFloat(Oe(r,255)),n=M.byteToFloat(Oe(n,255)),Te(i)?(i.red=e,i.green=t,i.blue=r,i.alpha=n,i):new M(e,t,r,n)};M.fromAlpha=function(e,t,r){return Te(r)?(r.red=e.red,r.green=e.green,r.blue=e.blue,r.alpha=t,r):new M(e.red,e.green,e.blue,t)};var Ld,Pd,Ds;Xv.supportsTypedArrays()&&(Ld=new ArrayBuffer(4),Pd=new Uint32Array(Ld),Ds=new Uint8Array(Ld));M.fromRgba=function(e,t){return Pd[0]=e,M.fromBytes(Ds[0],Ds[1],Ds[2],Ds[3],t)};M.fromHsl=function(e,t,r,n,i){e=Oe(e,0)%1,t=Oe(t,0),r=Oe(r,0),n=Oe(n,1);let s=r,a=r,o=r;if(t!==0){let u;r<.5?u=r*(1+t):u=r+t-r*t;let f=2*r-u;s=Id(f,u,e+1/3),a=Id(f,u,e),o=Id(f,u,e-1/3)}return Te(i)?(i.red=s,i.green=a,i.blue=o,i.alpha=n,i):new M(s,a,o,n)};M.fromRandom=function(e,t){e=Oe(e,Oe.EMPTY_OBJECT);let r=e.red;if(!Te(r)){let a=Oe(e.minimumRed,0),o=Oe(e.maximumRed,1);r=a+As.nextRandomNumber()*(o-a)}let n=e.green;if(!Te(n)){let a=Oe(e.minimumGreen,0),o=Oe(e.maximumGreen,1);n=a+As.nextRandomNumber()*(o-a)}let i=e.blue;if(!Te(i)){let a=Oe(e.minimumBlue,0),o=Oe(e.maximumBlue,1);i=a+As.nextRandomNumber()*(o-a)}let s=e.alpha;if(!Te(s)){let a=Oe(e.minimumAlpha,0),o=Oe(e.maximumAlpha,1);s=a+As.nextRandomNumber()*(o-a)}return Te(t)?(t.red=r,t.green=n,t.blue=i,t.alpha=s,t):new M(r,n,i,s)};var vI=/^#([0-9a-f])([0-9a-f])([0-9a-f])([0-9a-f])?$/i,_I=/^#([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})?$/i,CI=/^rgba?\(\s*([0-9.]+%?)\s*,\s*([0-9.]+%?)\s*,\s*([0-9.]+%?)(?:\s*,\s*([0-9.]+))?\s*\)$/i,yI=/^hsla?\(\s*([0-9.]+)\s*,\s*([0-9.]+%)\s*,\s*([0-9.]+%)(?:\s*,\s*([0-9.]+))?\s*\)$/i;M.fromCssColorString=function(e,t){Te(t)||(t=new M),e=e.replace(/\s/g,"");let r=M[e.toUpperCase()];if(Te(r))return M.clone(r,t),t;let n=vI.exec(e);return n!==null?(t.red=parseInt(n[1],16)/15,t.green=parseInt(n[2],16)/15,t.blue=parseInt(n[3],16)/15,t.alpha=parseInt(Oe(n[4],"f"),16)/15,t):(n=_I.exec(e),n!==null?(t.red=parseInt(n[1],16)/255,t.green=parseInt(n[2],16)/255,t.blue=parseInt(n[3],16)/255,t.alpha=parseInt(Oe(n[4],"ff"),16)/255,t):(n=CI.exec(e),n!==null?(t.red=parseFloat(n[1])/(n[1].substr(-1)==="%"?100:255),t.green=parseFloat(n[2])/(n[2].substr(-1)==="%"?100:255),t.blue=parseFloat(n[3])/(n[3].substr(-1)==="%"?100:255),t.alpha=parseFloat(Oe(n[4],"1.0")),t):(n=yI.exec(e),n!==null?M.fromHsl(parseFloat(n[1])/360,parseFloat(n[2])/100,parseFloat(n[3])/100,parseFloat(Oe(n[4],"1.0")),t):(t=void 0,t))))};M.packedLength=4;M.pack=function(e,t,r){return r=Oe(r,0),t[r++]=e.red,t[r++]=e.green,t[r++]=e.blue,t[r]=e.alpha,t};M.unpack=function(e,t,r){return t=Oe(t,0),Te(r)||(r=new M),r.red=e[t++],r.green=e[t++],r.blue=e[t++],r.alpha=e[t],r};M.byteToFloat=function(e){return e/255};M.floatToByte=function(e){return e===1?255:e*256|0};M.clone=function(e,t){if(Te(e))return Te(t)?(t.red=e.red,t.green=e.green,t.blue=e.blue,t.alpha=e.alpha,t):new M(e.red,e.green,e.blue,e.alpha)};M.equals=function(e,t){return e===t||Te(e)&&Te(t)&&e.red===t.red&&e.green===t.green&&e.blue===t.blue&&e.alpha===t.alpha};M.equalsArray=function(e,t,r){return e.red===t[r]&&e.green===t[r+1]&&e.blue===t[r+2]&&e.alpha===t[r+3]};M.prototype.clone=function(e){return M.clone(this,e)};M.prototype.equals=function(e){return M.equals(this,e)};M.prototype.equalsEpsilon=function(e,t){return this===e||Te(e)&&Math.abs(this.red-e.red)<=t&&Math.abs(this.green-e.green)<=t&&Math.abs(this.blue-e.blue)<=t&&Math.abs(this.alpha-e.alpha)<=t};M.prototype.toString=function(){return`(${this.red}, ${this.green}, ${this.blue}, ${this.alpha})`};M.prototype.toCssColorString=function(){let e=M.floatToByte(this.red),t=M.floatToByte(this.green),r=M.floatToByte(this.blue);return this.alpha===1?`rgb(${e},${t},${r})`:`rgba(${e},${t},${r},${this.alpha})`};M.prototype.toCssHexString=function(){let e=M.floatToByte(this.red).toString(16);e.length<2&&(e=`0${e}`);let t=M.floatToByte(this.green).toString(16);t.length<2&&(t=`0${t}`);let r=M.floatToByte(this.blue).toString(16);if(r.length<2&&(r=`0${r}`),this.alpha<1){let n=M.floatToByte(this.alpha).toString(16);return n.length<2&&(n=`0${n}`),`#${e}${t}${r}${n}`}return`#${e}${t}${r}`};M.prototype.toBytes=function(e){let t=M.floatToByte(this.red),r=M.floatToByte(this.green),n=M.floatToByte(this.blue),i=M.floatToByte(this.alpha);return Te(e)?(e[0]=t,e[1]=r,e[2]=n,e[3]=i,e):[t,r,n,i]};M.prototype.toRgba=function(){return Ds[0]=M.floatToByte(this.red),Ds[1]=M.floatToByte(this.green),Ds[2]=M.floatToByte(this.blue),Ds[3]=M.floatToByte(this.alpha),Pd[0]};M.prototype.brighten=function(e,t){return e=1-e,t.red=1-(1-this.red)*e,t.green=1-(1-this.green)*e,t.blue=1-(1-this.blue)*e,t.alpha=this.alpha,t};M.prototype.darken=function(e,t){return e=1-e,t.red=this.red*e,t.green=this.green*e,t.blue=this.blue*e,t.alpha=this.alpha,t};M.prototype.withAlpha=function(e,t){return M.fromAlpha(this,e,t)};M.add=function(e,t,r){return r.red=e.red+t.red,r.green=e.green+t.green,r.blue=e.blue+t.blue,r.alpha=e.alpha+t.alpha,r};M.subtract=function(e,t,r){return r.red=e.red-t.red,r.green=e.green-t.green,r.blue=e.blue-t.blue,r.alpha=e.alpha-t.alpha,r};M.multiply=function(e,t,r){return r.red=e.red*t.red,r.green=e.green*t.green,r.blue=e.blue*t.blue,r.alpha=e.alpha*t.alpha,r};M.divide=function(e,t,r){return r.red=e.red/t.red,r.green=e.green/t.green,r.blue=e.blue/t.blue,r.alpha=e.alpha/t.alpha,r};M.mod=function(e,t,r){return r.red=e.red%t.red,r.green=e.green%t.green,r.blue=e.blue%t.blue,r.alpha=e.alpha%t.alpha,r};M.lerp=function(e,t,r,n){return n.red=As.lerp(e.red,t.red,r),n.green=As.lerp(e.green,t.green,r),n.blue=As.lerp(e.blue,t.blue,r),n.alpha=As.lerp(e.alpha,t.alpha,r),n};M.multiplyByScalar=function(e,t,r){return r.red=e.red*t,r.green=e.green*t,r.blue=e.blue*t,r.alpha=e.alpha*t,r};M.divideByScalar=function(e,t,r){return r.red=e.red/t,r.green=e.green/t,r.blue=e.blue/t,r.alpha=e.alpha/t,r};M.ALICEBLUE=Object.freeze(M.fromCssColorString("#F0F8FF"));M.ANTIQUEWHITE=Object.freeze(M.fromCssColorString("#FAEBD7"));M.AQUA=Object.freeze(M.fromCssColorString("#00FFFF"));M.AQUAMARINE=Object.freeze(M.fromCssColorString("#7FFFD4"));M.AZURE=Object.freeze(M.fromCssColorString("#F0FFFF"));M.BEIGE=Object.freeze(M.fromCssColorString("#F5F5DC"));M.BISQUE=Object.freeze(M.fromCssColorString("#FFE4C4"));M.BLACK=Object.freeze(M.fromCssColorString("#000000"));M.BLANCHEDALMOND=Object.freeze(M.fromCssColorString("#FFEBCD"));M.BLUE=Object.freeze(M.fromCssColorString("#0000FF"));M.BLUEVIOLET=Object.freeze(M.fromCssColorString("#8A2BE2"));M.BROWN=Object.freeze(M.fromCssColorString("#A52A2A"));M.BURLYWOOD=Object.freeze(M.fromCssColorString("#DEB887"));M.CADETBLUE=Object.freeze(M.fromCssColorString("#5F9EA0"));M.CHARTREUSE=Object.freeze(M.fromCssColorString("#7FFF00"));M.CHOCOLATE=Object.freeze(M.fromCssColorString("#D2691E"));M.CORAL=Object.freeze(M.fromCssColorString("#FF7F50"));M.CORNFLOWERBLUE=Object.freeze(M.fromCssColorString("#6495ED"));M.CORNSILK=Object.freeze(M.fromCssColorString("#FFF8DC"));M.CRIMSON=Object.freeze(M.fromCssColorString("#DC143C"));M.CYAN=Object.freeze(M.fromCssColorString("#00FFFF"));M.DARKBLUE=Object.freeze(M.fromCssColorString("#00008B"));M.DARKCYAN=Object.freeze(M.fromCssColorString("#008B8B"));M.DARKGOLDENROD=Object.freeze(M.fromCssColorString("#B8860B"));M.DARKGRAY=Object.freeze(M.fromCssColorString("#A9A9A9"));M.DARKGREEN=Object.freeze(M.fromCssColorString("#006400"));M.DARKGREY=M.DARKGRAY;M.DARKKHAKI=Object.freeze(M.fromCssColorString("#BDB76B"));M.DARKMAGENTA=Object.freeze(M.fromCssColorString("#8B008B"));M.DARKOLIVEGREEN=Object.freeze(M.fromCssColorString("#556B2F"));M.DARKORANGE=Object.freeze(M.fromCssColorString("#FF8C00"));M.DARKORCHID=Object.freeze(M.fromCssColorString("#9932CC"));M.DARKRED=Object.freeze(M.fromCssColorString("#8B0000"));M.DARKSALMON=Object.freeze(M.fromCssColorString("#E9967A"));M.DARKSEAGREEN=Object.freeze(M.fromCssColorString("#8FBC8F"));M.DARKSLATEBLUE=Object.freeze(M.fromCssColorString("#483D8B"));M.DARKSLATEGRAY=Object.freeze(M.fromCssColorString("#2F4F4F"));M.DARKSLATEGREY=M.DARKSLATEGRAY;M.DARKTURQUOISE=Object.freeze(M.fromCssColorString("#00CED1"));M.DARKVIOLET=Object.freeze(M.fromCssColorString("#9400D3"));M.DEEPPINK=Object.freeze(M.fromCssColorString("#FF1493"));M.DEEPSKYBLUE=Object.freeze(M.fromCssColorString("#00BFFF"));M.DIMGRAY=Object.freeze(M.fromCssColorString("#696969"));M.DIMGREY=M.DIMGRAY;M.DODGERBLUE=Object.freeze(M.fromCssColorString("#1E90FF"));M.FIREBRICK=Object.freeze(M.fromCssColorString("#B22222"));M.FLORALWHITE=Object.freeze(M.fromCssColorString("#FFFAF0"));M.FORESTGREEN=Object.freeze(M.fromCssColorString("#228B22"));M.FUCHSIA=Object.freeze(M.fromCssColorString("#FF00FF"));M.GAINSBORO=Object.freeze(M.fromCssColorString("#DCDCDC"));M.GHOSTWHITE=Object.freeze(M.fromCssColorString("#F8F8FF"));M.GOLD=Object.freeze(M.fromCssColorString("#FFD700"));M.GOLDENROD=Object.freeze(M.fromCssColorString("#DAA520"));M.GRAY=Object.freeze(M.fromCssColorString("#808080"));M.GREEN=Object.freeze(M.fromCssColorString("#008000"));M.GREENYELLOW=Object.freeze(M.fromCssColorString("#ADFF2F"));M.GREY=M.GRAY;M.HONEYDEW=Object.freeze(M.fromCssColorString("#F0FFF0"));M.HOTPINK=Object.freeze(M.fromCssColorString("#FF69B4"));M.INDIANRED=Object.freeze(M.fromCssColorString("#CD5C5C"));M.INDIGO=Object.freeze(M.fromCssColorString("#4B0082"));M.IVORY=Object.freeze(M.fromCssColorString("#FFFFF0"));M.KHAKI=Object.freeze(M.fromCssColorString("#F0E68C"));M.LAVENDER=Object.freeze(M.fromCssColorString("#E6E6FA"));M.LAVENDAR_BLUSH=Object.freeze(M.fromCssColorString("#FFF0F5"));M.LAWNGREEN=Object.freeze(M.fromCssColorString("#7CFC00"));M.LEMONCHIFFON=Object.freeze(M.fromCssColorString("#FFFACD"));M.LIGHTBLUE=Object.freeze(M.fromCssColorString("#ADD8E6"));M.LIGHTCORAL=Object.freeze(M.fromCssColorString("#F08080"));M.LIGHTCYAN=Object.freeze(M.fromCssColorString("#E0FFFF"));M.LIGHTGOLDENRODYELLOW=Object.freeze(M.fromCssColorString("#FAFAD2"));M.LIGHTGRAY=Object.freeze(M.fromCssColorString("#D3D3D3"));M.LIGHTGREEN=Object.freeze(M.fromCssColorString("#90EE90"));M.LIGHTGREY=M.LIGHTGRAY;M.LIGHTPINK=Object.freeze(M.fromCssColorString("#FFB6C1"));M.LIGHTSEAGREEN=Object.freeze(M.fromCssColorString("#20B2AA"));M.LIGHTSKYBLUE=Object.freeze(M.fromCssColorString("#87CEFA"));M.LIGHTSLATEGRAY=Object.freeze(M.fromCssColorString("#778899"));M.LIGHTSLATEGREY=M.LIGHTSLATEGRAY;M.LIGHTSTEELBLUE=Object.freeze(M.fromCssColorString("#B0C4DE"));M.LIGHTYELLOW=Object.freeze(M.fromCssColorString("#FFFFE0"));M.LIME=Object.freeze(M.fromCssColorString("#00FF00"));M.LIMEGREEN=Object.freeze(M.fromCssColorString("#32CD32"));M.LINEN=Object.freeze(M.fromCssColorString("#FAF0E6"));M.MAGENTA=Object.freeze(M.fromCssColorString("#FF00FF"));M.MAROON=Object.freeze(M.fromCssColorString("#800000"));M.MEDIUMAQUAMARINE=Object.freeze(M.fromCssColorString("#66CDAA"));M.MEDIUMBLUE=Object.freeze(M.fromCssColorString("#0000CD"));M.MEDIUMORCHID=Object.freeze(M.fromCssColorString("#BA55D3"));M.MEDIUMPURPLE=Object.freeze(M.fromCssColorString("#9370DB"));M.MEDIUMSEAGREEN=Object.freeze(M.fromCssColorString("#3CB371"));M.MEDIUMSLATEBLUE=Object.freeze(M.fromCssColorString("#7B68EE"));M.MEDIUMSPRINGGREEN=Object.freeze(M.fromCssColorString("#00FA9A"));M.MEDIUMTURQUOISE=Object.freeze(M.fromCssColorString("#48D1CC"));M.MEDIUMVIOLETRED=Object.freeze(M.fromCssColorString("#C71585"));M.MIDNIGHTBLUE=Object.freeze(M.fromCssColorString("#191970"));M.MINTCREAM=Object.freeze(M.fromCssColorString("#F5FFFA"));M.MISTYROSE=Object.freeze(M.fromCssColorString("#FFE4E1"));M.MOCCASIN=Object.freeze(M.fromCssColorString("#FFE4B5"));M.NAVAJOWHITE=Object.freeze(M.fromCssColorString("#FFDEAD"));M.NAVY=Object.freeze(M.fromCssColorString("#000080"));M.OLDLACE=Object.freeze(M.fromCssColorString("#FDF5E6"));M.OLIVE=Object.freeze(M.fromCssColorString("#808000"));M.OLIVEDRAB=Object.freeze(M.fromCssColorString("#6B8E23"));M.ORANGE=Object.freeze(M.fromCssColorString("#FFA500"));M.ORANGERED=Object.freeze(M.fromCssColorString("#FF4500"));M.ORCHID=Object.freeze(M.fromCssColorString("#DA70D6"));M.PALEGOLDENROD=Object.freeze(M.fromCssColorString("#EEE8AA"));M.PALEGREEN=Object.freeze(M.fromCssColorString("#98FB98"));M.PALETURQUOISE=Object.freeze(M.fromCssColorString("#AFEEEE"));M.PALEVIOLETRED=Object.freeze(M.fromCssColorString("#DB7093"));M.PAPAYAWHIP=Object.freeze(M.fromCssColorString("#FFEFD5"));M.PEACHPUFF=Object.freeze(M.fromCssColorString("#FFDAB9"));M.PERU=Object.freeze(M.fromCssColorString("#CD853F"));M.PINK=Object.freeze(M.fromCssColorString("#FFC0CB"));M.PLUM=Object.freeze(M.fromCssColorString("#DDA0DD"));M.POWDERBLUE=Object.freeze(M.fromCssColorString("#B0E0E6"));M.PURPLE=Object.freeze(M.fromCssColorString("#800080"));M.RED=Object.freeze(M.fromCssColorString("#FF0000"));M.ROSYBROWN=Object.freeze(M.fromCssColorString("#BC8F8F"));M.ROYALBLUE=Object.freeze(M.fromCssColorString("#4169E1"));M.SADDLEBROWN=Object.freeze(M.fromCssColorString("#8B4513"));M.SALMON=Object.freeze(M.fromCssColorString("#FA8072"));M.SANDYBROWN=Object.freeze(M.fromCssColorString("#F4A460"));M.SEAGREEN=Object.freeze(M.fromCssColorString("#2E8B57"));M.SEASHELL=Object.freeze(M.fromCssColorString("#FFF5EE"));M.SIENNA=Object.freeze(M.fromCssColorString("#A0522D"));M.SILVER=Object.freeze(M.fromCssColorString("#C0C0C0"));M.SKYBLUE=Object.freeze(M.fromCssColorString("#87CEEB"));M.SLATEBLUE=Object.freeze(M.fromCssColorString("#6A5ACD"));M.SLATEGRAY=Object.freeze(M.fromCssColorString("#708090"));M.SLATEGREY=M.SLATEGRAY;M.SNOW=Object.freeze(M.fromCssColorString("#FFFAFA"));M.SPRINGGREEN=Object.freeze(M.fromCssColorString("#00FF7F"));M.STEELBLUE=Object.freeze(M.fromCssColorString("#4682B4"));M.TAN=Object.freeze(M.fromCssColorString("#D2B48C"));M.TEAL=Object.freeze(M.fromCssColorString("#008080"));M.THISTLE=Object.freeze(M.fromCssColorString("#D8BFD8"));M.TOMATO=Object.freeze(M.fromCssColorString("#FF6347"));M.TURQUOISE=Object.freeze(M.fromCssColorString("#40E0D0"));M.VIOLET=Object.freeze(M.fromCssColorString("#EE82EE"));M.WHEAT=Object.freeze(M.fromCssColorString("#F5DEB3"));M.WHITE=Object.freeze(M.fromCssColorString("#FFFFFF"));M.WHITESMOKE=Object.freeze(M.fromCssColorString("#F5F5F5"));M.YELLOW=Object.freeze(M.fromCssColorString("#FFFF00"));M.YELLOWGREEN=Object.freeze(M.fromCssColorString("#9ACD32"));M.TRANSPARENT=Object.freeze(new M(0,0,0,0));var Zv=M;function hi(e,t){this._content=e,this._batchId=t,this._color=void 0}Object.defineProperties(hi.prototype,{show:{get:function(){return this._content.batchTable.getShow(this._batchId)},set:function(e){this._content.batchTable.setShow(this._batchId,e)}},color:{get:function(){return Te(this._color)||(this._color=new Zv),this._content.batchTable.getColor(this._batchId,this._color)},set:function(e){this._content.batchTable.setColor(this._batchId,e)}},polylinePositions:{get:function(){if(Te(this._content.getPolylinePositions))return this._content.getPolylinePositions(this._batchId)}},content:{get:function(){return this._content}},tileset:{get:function(){return this._content.tileset}},primitive:{get:function(){return this._content.tileset}},featureId:{get:function(){return this._batchId}},pickId:{get:function(){if(!this._content.isDestroyed())return this._content.batchTable.getPickColor(this._batchId)}}});hi.prototype.hasProperty=function(e){return this._content.batchTable.hasProperty(this._batchId,e)};hi.prototype.getPropertyIds=function(e){return this._content.batchTable.getPropertyIds(this._batchId,e)};hi.prototype.getProperty=function(e){return this._content.batchTable.getProperty(this._batchId,e)};hi.getPropertyInherited=function(e,t,r){let n=e.batchTable;if(Te(n)){if(n.hasPropertyBySemantic(t,r))return n.getPropertyBySemantic(t,r);if(n.hasProperty(t,r))return n.getProperty(t,r)}let i=e.metadata;if(Te(i)){if(i.hasPropertyBySemantic(r))return i.getPropertyBySemantic(r);if(i.hasProperty(r))return i.getProperty(r)}let s=e.tile,a=s.metadata;if(Te(a)){if(a.hasPropertyBySemantic(r))return a.getPropertyBySemantic(r);if(a.hasProperty(r))return a.getProperty(r)}let o;if(Te(s.implicitSubtree)&&(o=s.implicitSubtree.metadata),Te(o)){if(o.hasPropertyBySemantic(r))return o.getPropertyBySemantic(r);if(o.hasProperty(r))return o.getProperty(r)}let u=Te(e.group)?e.group.metadata:void 0;if(Te(u)){if(u.hasPropertyBySemantic(r))return u.getPropertyBySemantic(r);if(u.hasProperty(r))return u.getProperty(r)}let f=e.tileset.metadata;if(Te(f)){if(f.hasPropertyBySemantic(r))return f.getPropertyBySemantic(r);if(f.hasProperty(r))return f.getProperty(r)}};hi.prototype.getPropertyInherited=function(e){return hi.getPropertyInherited(this._content,this._batchId,e)};hi.prototype.setProperty=function(e,t){this._content.batchTable.setProperty(this._batchId,e,t),this._content.featurePropertiesDirty=!0};hi.prototype.isExactClass=function(e){return this._content.batchTable.isExactClass(this._batchId,e)};hi.prototype.isClass=function(e){return this._content.batchTable.isClass(this._batchId,e)};hi.prototype.getExactClassName=function(){return this._content.batchTable.getExactClassName(this._batchId)};var Jv=hi;function Gr(e,t,r,n,i){this._content=e,this._billboard=r,this._label=n,this._polyline=i,this._batchId=t,this._billboardImage=void 0,this._billboardColor=void 0,this._billboardOutlineColor=void 0,this._billboardOutlineWidth=void 0,this._billboardSize=void 0,this._pointSize=void 0,this._color=void 0,this._pointSize=void 0,this._pointOutlineColor=void 0,this._pointOutlineWidth=void 0,this._heightOffset=void 0,this._exOffset=void 0,this._pickIds=new Array(3),Vo(this)}var xI=new Cesium.Cartographic;Object.defineProperties(Gr.prototype,{show:{get:function(){return this._label.show},set:function(e){this._label.show=e,this._billboard.show=e,this._polyline.show=e}},color:{get:function(){return this._color},set:function(e){this._color=Cesium.Color.clone(e,this._color),Vo(this)}},pointSize:{get:function(){return this._pointSize},set:function(e){this._pointSize=e,Vo(this)}},pointOutlineColor:{get:function(){return this._pointOutlineColor},set:function(e){this._pointOutlineColor=Cesium.Color.clone(e,this._pointOutlineColor),Vo(this)}},pointOutlineWidth:{get:function(){return this._pointOutlineWidth},set:function(e){this._pointOutlineWidth=e,Vo(this)}},labelColor:{get:function(){return this._label.fillColor},set:function(e){this._label.fillColor=e,this._polyline.show=this._label.show&&e.alpha>0}},labelOutlineColor:{get:function(){return this._label.outlineColor},set:function(e){this._label.outlineColor=e}},labelOutlineWidth:{get:function(){return this._label.outlineWidth},set:function(e){this._label.outlineWidth=e}},font:{get:function(){return this._label.font},set:function(e){this._label.font=e}},labelStyle:{get:function(){return this._label.style},set:function(e){this._label.style=e}},labelText:{get:function(){return this._label.text},set:function(e){Cesium.defined(e)||(e=""),this._label.text=e}},backgroundColor:{get:function(){return this._label.backgroundColor},set:function(e){this._label.backgroundColor=e}},backgroundPadding:{get:function(){return this._label.backgroundPadding},set:function(e){this._label.backgroundPadding=e}},backgroundEnabled:{get:function(){return this._label.showBackground},set:function(e){this._label.showBackground=e}},scaleByDistance:{get:function(){return this._label.scaleByDistance},set:function(e){this._label.scaleByDistance=e,this._billboard.scaleByDistance=e}},translucencyByDistance:{get:function(){return this._label.translucencyByDistance},set:function(e){this._label.translucencyByDistance=e,this._billboard.translucencyByDistance=e}},distanceDisplayCondition:{get:function(){return this._label.distanceDisplayCondition},set:function(e){this._label.distanceDisplayCondition=e,this._polyline.distanceDisplayCondition=e,this._billboard.distanceDisplayCondition=e}},heightOffset:{get:function(){return this._heightOffset},set:function(e){var t=Cesium.defaultValue(this._heightOffset,0),r=this._content.tileset.ellipsoid,n=r.cartesianToCartographic(this._billboard.position,xI);n.height=n.height-t+e;var i=r.cartographicToCartesian(n);this._billboard.position=i,this._label.position=this._billboard.position,this._polyline.positions=[this._polyline.positions[0],i],this._heightOffset=e}},exOffset:{get:function(){return this._exOffset},set:function(e){if(e instanceof Cesium.Cartesian3||(e=Cesium.Cartesian3.ZERO),!Cesium.Cartesian3.equals(e,Cesium.Cartesian3.ZERO)){var t=this.getProperty("worldMatrix"),r=Cesium.Matrix4.fromArray(t),n=new Cesium.Cartesian3;Cesium.Matrix4.multiplyByPoint(r,e,n),this._billboard.position=n,this._label.position=this._billboard.position,this._polyline.positions=[this._polyline.positions[0],n]}this._exOffset=e}},anchorLineEnabled:{get:function(){return this._polyline.show},set:function(e){this._polyline.show=e}},anchorLineColor:{get:function(){return this._polyline.material.uniforms.color},set:function(e){this._polyline.material.uniforms.color=Cesium.Color.clone(e,this._polyline.material.uniforms.color)}},image:{get:function(){return this._billboardImage},set:function(e){var t=this._billboardImage!==e;this._billboardImage=e,t&&Vo(this)}},disableDepthTestDistance:{get:function(){return this._label.disableDepthTestDistance},set:function(e){this._label.disableDepthTestDistance=e,this._billboard.disableDepthTestDistance=e}},horizontalOrigin:{get:function(){return this._billboard.horizontalOrigin},set:function(e){this._billboard.horizontalOrigin=e}},verticalOrigin:{get:function(){return this._billboard.verticalOrigin},set:function(e){this._billboard.verticalOrigin=e}},labelHorizontalOrigin:{get:function(){return this._label.horizontalOrigin},set:function(e){this._label.horizontalOrigin=e}},labelVerticalOrigin:{get:function(){return this._label.verticalOrigin},set:function(e){this._label.verticalOrigin=e}},content:{get:function(){return this._content}},tileset:{get:function(){return this._content.tileset}},primitive:{get:function(){return this._content.tileset}},pickIds:{get:function(){var e=this._pickIds;return e[0]=this._billboard.pickId,e[1]=this._label.pickId,e[2]=this._polyline.pickId,e}}});Gr.defaultColor=Cesium.Color.WHITE;Gr.defaultPointOutlineColor=Cesium.Color.BLACK;Gr.defaultPointOutlineWidth=0;Gr.defaultPointSize=8;function Vo(e){var t=e._billboard;if(Cesium.defined(e._billboardImage)&&e._billboardImage!==t.image){t.image=e._billboardImage;return}if(!Cesium.defined(e._billboardImage)){var r=Cesium.defaultValue(e._color,Gr.defaultColor),n=Cesium.defaultValue(e._pointOutlineColor,Gr.defaultPointOutlineColor),i=Cesium.defaultValue(e._pointOutlineWidth,Gr.defaultPointOutlineWidth),s=Cesium.defaultValue(e._pointSize,Gr.defaultPointSize),a=e._billboardColor,o=e._billboardOutlineColor,u=e._billboardOutlineWidth,f=e._billboardSize;if(!(Cesium.Color.equals(r,a)&&Cesium.Color.equals(n,o)&&i===u&&s===f)){e._billboardColor=Cesium.Color.clone(r,e._billboardColor),e._billboardOutlineColor=Cesium.Color.clone(n,e._billboardOutlineColor),e._billboardOutlineWidth=i,e._billboardSize=s;var l=r.alpha,c=r.toCssColorString(),h=n.toCssColorString(),d=JSON.stringify([c,s,h,i]);t.setImage(d,Cesium.createBillboardPointCallback(l,c,h,i,s))}}}Gr.prototype.hasProperty=function(e){return this._content.batchTable.hasProperty(this._batchId,e)};Gr.prototype.getPropertyNames=function(e){return this._content.batchTable.getPropertyNames(this._batchId,e)};Gr.prototype.getProperty=function(e){return this._content.batchTable.getProperty(this._batchId,e)};Gr.prototype.getPropertyInherited=function(e){return Jv.getPropertyInherited(this._content,this._batchId,e)};Gr.prototype.setProperty=function(e,t){this._content.batchTable.setProperty(this._batchId,e,t),this._content.featurePropertiesDirty=!0};Gr.prototype.isExactClass=function(e){return this._content.batchTable.isExactClass(this._batchId,e)};Gr.prototype.isClass=function(e){return this._content.batchTable.isClass(this._batchId,e)};Gr.prototype.getExactClassName=function(){return this._content.batchTable.getExactClassName(this._batchId)};var Md=Gr;function ua(e){this._positions=e.positions,this._batchTable=e.batchTable,this._batchIds=e.batchIds,this._rectangle=e.rectangle,this._minHeight=e.minimumHeight,this._maxHeight=e.maximumHeight,this._billboardCollection=void 0,this._labelCollection=void 0,this._polylineCollection=void 0,this._verticesPromise=void 0,this._packedBuffer=void 0,this._ready=!1,this._readyPromise=Ne.defer(),this._resolvedPromise=!1,this._heightReference=e.heightReference}Object.defineProperties(ua.prototype,{pointsLength:{get:function(){return this._billboardCollection.length}},texturesByteLength:{get:function(){var e=this._billboardCollection.textureAtlas.texture.sizeInBytes,t=this._labelCollection._textureAtlas.texture.sizeInBytes;return e+t}},readyPromise:{get:function(){return this._readyPromise.promise}}});function $v(e,t){var r=e._rectangle,n=e._minHeight,i=e._maxHeight,s=2+Cesium.Rectangle.packedLength+Cesium.Ellipsoid.packedLength,a=new Float64Array(s),o=0;return a[o++]=n,a[o++]=i,Cesium.Rectangle.pack(r,a,o),o+=Cesium.Rectangle.packedLength,Cesium.Ellipsoid.pack(t,a,o),a}var e_=new Cesium.TaskProcessor("createVectorTilePoints"),t_=new Cesium.Cartesian3;function EI(e,t){if(!Cesium.defined(e._billboardCollection)){var r;if(!Cesium.defined(e._verticesPromise)){r=e._positions;var n=e._packedBuffer;Cesium.defined(n)||(r=e._positions=xn(r),e._batchIds=xn(e._batchIds),n=e._packedBuffer=$v(e,t));var i=[r.buffer,n.buffer],s={positions:r.buffer,packedBuffer:n.buffer},a=e._verticesPromise=e_.scheduleTask(s,i);if(!Cesium.defined(a))return;a.then(function(y){e._positions=new Float64Array(y.positions),e._ready=!0})}if(e._ready&&!Cesium.defined(e._billboardCollection)){r=e._positions;var o=e._batchTable,u=e._batchIds,f=e._billboardCollection=new Cesium.BillboardCollection({batchTable:o}),l=e._labelCollection=new Cesium.LabelCollection({batchTable:o}),c=e._polylineCollection=new Cesium.PolylineCollection;c._useHighlightColor=!0;for(var h=r.length/3,d=0;d<h;++d){var m=u[d],g=Cesium.Cartesian3.unpack(r,d*3,t_),p=f.add();p.position=g,p._batchIndex=m;var v=l.add();v.text=" ",v.position=g,v._batchIndex=m;var _=c.add();_.positions=[Cesium.Cartesian3.clone(g),Cesium.Cartesian3.clone(g)]}e._positions=void 0,e._packedBuffer=void 0}}}ua.prototype.createFeatures=function(e,t){for(var r=this._billboardCollection,n=this._labelCollection,i=this._polylineCollection,s=this._batchIds,a=s.length,o=0;o<a;++o){var u=s[o],f=r.get(o),l=n.get(o),c=i.get(o);t[u]=new Md(e,u,f,l,c)}};ua.prototype.applyDebugSettings=function(e,t){e?(Cesium.Color.clone(t,this._billboardCollection._highlightColor),Cesium.Color.clone(t,this._labelCollection._highlightColor),Cesium.Color.clone(t,this._polylineCollection._highlightColor)):(Cesium.Color.clone(Cesium.Color.WHITE,this._billboardCollection._highlightColor),Cesium.Color.clone(Cesium.Color.WHITE,this._labelCollection._highlightColor),Cesium.Color.clone(Cesium.Color.WHITE,this._polylineCollection._highlightColor))};function bI(e,t){for(var r=e._batchIds,n=r.length,i=0;i<n;++i){var s=r[i],a=t[s];a.show=!0,a.pointSize=Cesium.Cesium3DTilePointFeature.defaultPointSize,a.color=Cesium.Cesium3DTilePointFeature.defaultColor,a.pointOutlineColor=Cesium.Cesium3DTilePointFeature.defaultPointOutlineColor,a.pointOutlineWidth=Cesium.Cesium3DTilePointFeature.defaultPointOutlineWidth,a.labelColor=Cesium.Color.WHITE,a.labelOutlineColor=Cesium.Color.WHITE,a.labelOutlineWidth=1,a.font="30px sans-serif",a.labelStyle=Cesium.LabelStyle.FILL,a.labelText=void 0,a.backgroundColor=new Cesium.Color(.165,.165,.165,.8),a.backgroundPadding=new Cesium.Cartesian2(7,5),a.backgroundEnabled=!1,a.scaleByDistance=void 0,a.translucencyByDistance=void 0,a.distanceDisplayCondition=void 0,a.heightOffset=0,a.anchorLineEnabled=!1,a.anchorLineColor=Cesium.Color.WHITE,a.image=void 0,a.disableDepthTestDistance=0,a.horizontalOrigin=Cesium.HorizontalOrigin.CENTER,a.verticalOrigin=Cesium.VerticalOrigin.CENTER,a.labelHorizontalOrigin=Cesium.HorizontalOrigin.RIGHT,a.labelVerticalOrigin=Cesium.VerticalOrigin.BASELINE}}var wI=new Cesium.Color,SI=new Cesium.Color,TI=new Cesium.Color,II=new Cesium.Color,LI=new Cesium.Color,PI=new Cesium.Color,ju=new Cesium.NearFarScalar,Ku=new Cesium.NearFarScalar,Ad=new Cesium.DistanceDisplayCondition;ua.prototype.applyStyle=function(e,t){if(!Cesium.defined(e)){bI(this,t);return}for(var r=this._batchIds,n=r.length,i=0;i<n;++i){var s=r[i],a=t[s];if(Cesium.defined(e.show)&&(a.show=e.show.evaluate(a)),Cesium.defined(e.pointSize)&&(a.pointSize=e.pointSize.evaluate(a)),Cesium.defined(e.color)&&(a.color=e.color.evaluateColor(a,wI)),Cesium.defined(e.pointOutlineColor)&&(a.pointOutlineColor=e.pointOutlineColor.evaluateColor(a,SI)),Cesium.defined(e.pointOutlineWidth)&&(a.pointOutlineWidth=e.pointOutlineWidth.evaluate(a)),Cesium.defined(e.labelColor)&&(a.labelColor=e.labelColor.evaluateColor(a,TI)),Cesium.defined(e.labelOutlineColor)&&(a.labelOutlineColor=e.labelOutlineColor.evaluateColor(a,II)),Cesium.defined(e.labelOutlineWidth)&&(a.labelOutlineWidth=e.labelOutlineWidth.evaluate(a)),Cesium.defined(e.font)&&(a.font=e.font.evaluate(a)),Cesium.defined(e.labelStyle)&&(a.labelStyle=e.labelStyle.evaluate(a)),Cesium.defined(e.labelText)?a.labelText=e.labelText.evaluate(a):a.labelText=void 0,Cesium.defined(e.backgroundColor)&&(a.backgroundColor=e.backgroundColor.evaluateColor(a,LI)),Cesium.defined(e.backgroundPadding)&&(a.backgroundPadding=e.backgroundPadding.evaluate(a)),Cesium.defined(e.backgroundEnabled)&&(a.backgroundEnabled=e.backgroundEnabled.evaluate(a)),Cesium.defined(e.scaleByDistance)){var o=e.scaleByDistance.evaluate(a);ju.near=o.x,ju.nearValue=o.y,ju.far=o.z,ju.farValue=o.w,a.scaleByDistance=ju}else a.scaleByDistance=void 0;if(Cesium.defined(e.translucencyByDistance)){var u=e.translucencyByDistance.evaluate(a);Ku.near=u.x,Ku.nearValue=u.y,Ku.far=u.z,Ku.farValue=u.w,a.translucencyByDistance=Ku}else a.translucencyByDistance=void 0;if(Cesium.defined(e.distanceDisplayCondition)){var f=e.distanceDisplayCondition.evaluate(a);Ad.near=f.x,Ad.far=f.y,a.distanceDisplayCondition=Ad}else a.distanceDisplayCondition=void 0;Cesium.defined(e.heightOffset)&&(a.heightOffset=e.heightOffset.evaluate(a)),Cesium.defined(e.anchorLineEnabled)&&(a.anchorLineEnabled=e.anchorLineEnabled.evaluate(a)),Cesium.defined(e.anchorLineColor)&&(a.anchorLineColor=e.anchorLineColor.evaluateColor(a,PI)),Cesium.defined(e.image)?a.image=e.image.evaluate(a):a.image=void 0,Cesium.defined(e.disableDepthTestDistance)&&(a.disableDepthTestDistance=e.disableDepthTestDistance.evaluate(a)),Cesium.defined(e.horizontalOrigin)&&(a.horizontalOrigin=e.horizontalOrigin.evaluate(a)),Cesium.defined(e.verticalOrigin)&&(a.verticalOrigin=e.verticalOrigin.evaluate(a)),Cesium.defined(e.labelHorizontalOrigin)&&(a.labelHorizontalOrigin=e.labelHorizontalOrigin.evaluate(a)),Cesium.defined(e.labelVerticalOrigin)&&(a.labelVerticalOrigin=e.labelVerticalOrigin.evaluate(a)),Cesium.defined(e.exOffset)&&(a.exOffset=e.exOffset.evaluate(a))}};ua.prototype.update=function(e){this._heightReference===Cesium.HeightReference.CLAMP_TO_GROUND?MI(this,e.mapProjection.ellipsoid,e.camera._scene):EI(this,e.mapProjection.ellipsoid),this._ready&&(this._polylineCollection.update(e),this._billboardCollection.update(e),this._labelCollection.update(e),this._resolvedPromise||(this._readyPromise.resolve(),this._resolvedPromise=!0))};function MI(e,t,r){if(!Cesium.defined(e._billboardCollection)){var n;if(!Cesium.defined(e._verticesPromise)){n=e._positions;var i=e._packedBuffer;Cesium.defined(i)||(n=e._positions=xn(n),e._batchIds=xn(e._batchIds),i=e._packedBuffer=$v(e,t));var s=[n.buffer,i.buffer],a={positions:n.buffer,packedBuffer:i.buffer},o=e._verticesPromise=e_.scheduleTask(a,s);if(!Cesium.defined(o))return;o.then(function(x){e._positions=new Float64Array(x.positions),e._ready=!0})}if(e._ready&&!Cesium.defined(e._billboardCollection)){n=e._positions;var u=e._batchTable,f=e._batchIds,l=e._billboardCollection=new Cesium.BillboardCollection({batchTable:u,scene:r}),c=e._labelCollection=new Cesium.LabelCollection({batchTable:u,scene:r}),h=e._polylineCollection=new Cesium.PolylineCollection;h._useHighlightColor=!0;for(var d=n.length/3,m=0;m<d;++m){var g=f[m],p=Cesium.Cartesian3.unpack(n,m*3,t_),v=l.add({heightReference:Cesium.HeightReference.CLAMP_TO_GROUND});v.position=p,v._batchIndex=g;var _=c.add({heightReference:Cesium.HeightReference.CLAMP_TO_GROUND});_.text=" ",_.position=p,_._batchIndex=g;var y=h.add();y.positions=[Cesium.Cartesian3.clone(p),Cesium.Cartesian3.clone(p)]}e._positions=void 0,e._packedBuffer=void 0}}}ua.prototype.isDestroyed=function(){return!1};ua.prototype.destroy=function(){return this._billboardCollection=this._billboardCollection&&this._billboardCollection.destroy(),this._labelCollection=this._labelCollection&&this._labelCollection.destroy(),this._polylineCollection=this._polylineCollection&&this._polylineCollection.destroy(),Cesium.destroyObject(this)};var Dd=ua;function Rs(e,t,r,n,i){this._tileset=e,this._tile=t,this._resource=r,this._polygons=void 0,this._polylines=void 0,this._points=void 0,this._contentReadyPromise=void 0,this._readyPromise=Ne.defer(),this._batchTable=void 0,this._features=void 0,this.featurePropertiesDirty=!1,RI(this,n,i)}Object.defineProperties(Rs.prototype,{featuresLength:{get:function(){return Cesium.defined(this._batchTable)?this._batchTable.featuresLength:0}},pointsLength:{get:function(){return Cesium.defined(this._points)?this._points.pointsLength:0}},trianglesLength:{get:function(){var e=0;return Cesium.defined(this._polygons)&&(e+=this._polygons.trianglesLength),Cesium.defined(this._polylines)&&(e+=this._polylines.trianglesLength),e}},geometryByteLength:{get:function(){var e=0;return Cesium.defined(this._polygons)&&(e+=this._polygons.geometryByteLength),Cesium.defined(this._polylines)&&(e+=this._polylines.geometryByteLength),e}},texturesByteLength:{get:function(){return Cesium.defined(this._points)?this._points.texturesByteLength:0}},batchTableByteLength:{get:function(){return Cesium.defined(this._batchTable)?this._batchTable.memorySizeInBytes:0}},innerContents:{get:function(){}},readyPromise:{get:function(){return this._readyPromise.promise}},tileset:{get:function(){return this._tileset}},tile:{get:function(){return this._tile}},url:{get:function(){return this._resource.getUrlComponent(!0)}},batchTable:{get:function(){return this._batchTable}}});function AI(e){return function(t,r){Cesium.defined(e._polygons)&&e._polygons.updateCommands(t,r)}}function DI(e,t){var r,n,i,s,a=Cesium.defaultValue(e.POLYGONS_LENGTH,0),o=Cesium.defaultValue(e.POLYLINES_LENGTH,0),u=Cesium.defaultValue(e.POINTS_LENGTH,0);if(a>0&&Cesium.defined(e.POLYGON_BATCH_IDS)){var f=t.byteOffset+e.POLYGON_BATCH_IDS.byteOffset;r=new Uint16Array(t.buffer,f,a)}if(o>0&&Cesium.defined(e.POLYLINE_BATCH_IDS)){var l=t.byteOffset+e.POLYLINE_BATCH_IDS.byteOffset;n=new Uint16Array(t.buffer,l,o)}if(u>0&&Cesium.defined(e.POINT_BATCH_IDS)){var c=t.byteOffset+e.POINT_BATCH_IDS.byteOffset;i=new Uint16Array(t.buffer,c,u)}var h=Cesium.defined(r)||Cesium.defined(n)||Cesium.defined(i),d=a>0&&!Cesium.defined(r)||o>0&&!Cesium.defined(n)||u>0&&!Cesium.defined(i);if(h&&d)throw new Cesium.RuntimeError("If one group of batch ids is defined, then all batch ids must be defined.");var m=!Cesium.defined(r)&&!Cesium.defined(n)&&!Cesium.defined(i);if(m){var g=0;if(!Cesium.defined(r)&&a>0)for(r=new Uint16Array(a),s=0;s<a;++s)r[s]=g++;if(!Cesium.defined(n)&&o>0)for(n=new Uint16Array(o),s=0;s<o;++s)n[s]=g++;if(!Cesium.defined(i)&&u>0)for(i=new Uint16Array(u),s=0;s<u;++s)i[s]=g++}return{polygons:r,polylines:n,points:i}}var Ni=Uint32Array.BYTES_PER_ELEMENT;function RI(e,t,r){r=Cesium.defaultValue(r,0);var n=new Uint8Array(t),i=new DataView(t);r+=Ni;var s=i.getUint32(r,!0);if(s!==1)throw new Cesium.RuntimeError("Only Vector tile version 1 is supported.  Version "+s+" is not.");r+=Ni;var a=i.getUint32(r,!0);if(r+=Ni,a===0){e._readyPromise.resolve(e);return}var o=i.getUint32(r,!0);if(r+=Ni,o===0)throw new Cesium.RuntimeError("Feature table must have a byte length greater than zero");var u=i.getUint32(r,!0);r+=Ni;var f=i.getUint32(r,!0);r+=Ni;var l=i.getUint32(r,!0);r+=Ni;var c=i.getUint32(r,!0);r+=Ni;var h=i.getUint32(r,!0);r+=Ni;var d=i.getUint32(r,!0);r+=Ni;var m=i.getUint32(r,!0);r+=Ni;var g=Cesium.getStringFromTypedArray(n,r,o),p=JSON.parse(g);r+=o;var v=new Uint8Array(t,r,u);r+=u;var _,y;if(f>0){var x=Cesium.getStringFromTypedArray(n,r,f);_=JSON.parse(x),r+=f,l>0&&(y=new Uint8Array(t,r,l),y=new Uint8Array(y),r+=l)}var E=Cesium.defaultValue(p.POLYGONS_LENGTH,0),S=Cesium.defaultValue(p.POLYLINES_LENGTH,0),I=Cesium.defaultValue(p.POINTS_LENGTH,0),P=E+S+I,w=new zr(e,P,_,y,AI(e));if(e._batchTable=w,P!==0){var N=new ws(p,v);if(Cesium.defined(N.json.FLOWLINE)){var B=N.json.FLOWLINE;for(var C in B){for(var b=[],T=0;T<B[C].length;T+=3){var A=Cesium.Cartesian3.fromRadians(B[C][T+0],B[C][T+1],B[C][T+2]);b.push(A)}Cesium.defined(e.tileset.flowLines)||(e.tileset.flowLines=[]),e.tileset.flowLines.push(b)}}var R=N.getGlobalProperty("REGION");if(!Cesium.defined(R))throw new Cesium.RuntimeError("Feature table global property: REGION must be defined");var F=Cesium.Rectangle.unpack(R),D=R[4],O=R[5],U=e._tile.computedTransform,q=N.getGlobalProperty("RTC_CENTER",Cesium.ComponentDatatype.FLOAT,3);Cesium.defined(q)?(q=Cesium.Cartesian3.unpack(q),Cesium.Matrix4.multiplyByPoint(U,q,q)):(q=Cesium.Rectangle.center(F),q.height=Cesium.Math.lerp(D,O,.5),q=Cesium.Ellipsoid.WGS84.cartographicToCartesian(q));var Y=DI(p,v);if(r+=r%4,E>0){N.featuresLength=E;var W=Cesium.defaultValue(N.getPropertyArray("POLYGON_COUNTS",Cesium.ComponentDatatype.UNSIGNED_INT,1),N.getPropertyArray("POLYGON_COUNT",Cesium.ComponentDatatype.UNSIGNED_INT,1));if(!Cesium.defined(W))throw new Cesium.RuntimeError("Feature table property: POLYGON_COUNTS must be defined when POLYGONS_LENGTH is greater than 0");var K=Cesium.defaultValue(N.getPropertyArray("POLYGON_INDEX_COUNTS",Cesium.ComponentDatatype.UNSIGNED_INT,1),N.getPropertyArray("POLYGON_INDEX_COUNT",Cesium.ComponentDatatype.UNSIGNED_INT,1));if(!Cesium.defined(K))throw new Cesium.RuntimeError("Feature table property: POLYGON_INDEX_COUNTS must be defined when POLYGONS_LENGTH is greater than 0");var re=W.reduce(function(Br,fn){return Br+fn*2},0),ce=K.reduce(function(Br,fn){return Br+fn},0),Se=new Uint32Array(t,r,ce);r+=c;var de=new Uint16Array(t,r,re);r+=h;var Ae,ye;Cesium.defined(p.POLYGON_MINIMUM_HEIGHTS)&&Cesium.defined(p.POLYGON_MAXIMUM_HEIGHTS)&&(Ae=N.getPropertyArray("POLYGON_MINIMUM_HEIGHTS",Cesium.ComponentDatatype.FLOAT,1),ye=N.getPropertyArray("POLYGON_MAXIMUM_HEIGHTS",Cesium.ComponentDatatype.FLOAT,1)),e._polygons=new Cesium.Vector3DTilePolygons({positions:de,counts:W,indexCounts:K,indices:Se,minimumHeight:D,maximumHeight:O,polygonMinimumHeights:Ae,polygonMaximumHeights:ye,center:q,rectangle:F,boundingVolume:e.tile.boundingVolume.boundingVolume,batchTable:w,batchIds:Y.polygons,modelMatrix:U})}if(S>0){N.featuresLength=S;var Ie=Cesium.defaultValue(N.getPropertyArray("POLYLINE_COUNTS",Cesium.ComponentDatatype.UNSIGNED_INT,1),N.getPropertyArray("POLYLINE_COUNT",Cesium.ComponentDatatype.UNSIGNED_INT,1));if(!Cesium.defined(Ie))throw new Cesium.RuntimeError("Feature table property: POLYLINE_COUNTS must be defined when POLYLINES_LENGTH is greater than 0");var $=N.getPropertyArray("POLYLINE_WIDTHS",Cesium.ComponentDatatype.UNSIGNED_SHORT,1);if(!Cesium.defined($)){$=new Uint16Array(S);var De=2;Cesium.defined(e._tileset._airWidth)&&(De=e._tileset._airWidth);for(var T=0;T<S;++T)$[T]=De}var se=Ie.reduce(function(Br,fn){return Br+fn*3},0),be=N.getGlobalProperty("HIGHTPRECISION",Cesium.ComponentDatatype.UNSIGNED_INT,1);if(Cesium.defined(be)||(be=e._tileset.highPrecision),Cesium.defined(be)&&be)var lr=new Uint32Array(t,r,se);else var lr=new Uint16Array(t,r,se);r+=d,e._polylines=new Cesium.EV_Vector3DTilePolylines({positions:lr,widths:$,counts:Ie,batchIds:Y.polylines,minimumHeight:D,maximumHeight:O,center:q,rectangle:F,boundingVolume:e.tile.boundingVolume.boundingVolume,batchTable:w,material:e._tileset._material,highPrecision:be,rollerRegion:e._tileset.rollerRegion,disableDepthTestDistance:e._tileset._disableDepthTestDistance})}if(I>0){var kt=new Uint16Array(t,r,I*3);r+=m,e._points=new Dd({positions:kt,batchIds:Y.points,minimumHeight:D,maximumHeight:O,rectangle:F,batchTable:w,heightReference:e._tileset.heightReference})}}}function r_(e){var t=e.featuresLength;if(!Cesium.defined(e._features)&&t>0){var r=new Array(t);Cesium.defined(e._polygons)&&e._polygons.createFeatures(e,r),Cesium.defined(e._polylines)&&e._polylines.createFeatures(e,r),Cesium.defined(e._points)&&e._points.createFeatures(e,r),e._features=r}}Rs.prototype.hasProperty=function(e,t){return this._batchTable.hasProperty(e,t)};Rs.prototype.getFeature=function(e){return r_(this),this._features[e]};Rs.prototype.applyDebugSettings=function(e,t){Cesium.defined(this._polygons)&&this._polygons.applyDebugSettings(e,t),Cesium.defined(this._polylines)&&this._polylines.applyDebugSettings(e,t),Cesium.defined(this._points)&&this._points.applyDebugSettings(e,t)};Rs.prototype.applyStyle=function(e){r_(this),Cesium.defined(this._polygons)&&this._polygons.applyStyle(e,this._features),Cesium.defined(this._polylines)&&this._polylines.applyStyle(e,this._features),Cesium.defined(this._points)&&this._points.applyStyle(e,this._features)};Rs.prototype.update=function(e,t){var r=!0;if(Cesium.defined(this._polygons)&&(this._polygons.classificationType=this._tileset.classificationType,this._polygons.debugWireframe=this._tileset.debugWireframe,this._polygons.update(t),r=r&&this._polygons._ready),Cesium.defined(this._polylines)&&(this._polylines.update(t),r=r&&this._polylines._ready),Cesium.defined(this._points)&&(this._points.update(t),r=r&&this._points._ready),Cesium.defined(this._batchTable)&&r&&this._batchTable.update(e,t),!Cesium.defined(this._contentReadyPromise)){var n=Cesium.defined(this._points)?this._points.readyPromise:void 0,i=Cesium.defined(this._polygons)?this._polygons.readyPromise:void 0,s=Cesium.defined(this._polylines)?this._polylines.readyPromise:void 0,a=this;this._contentReadyPromise=Ne.all([n,i,s]).then(function(){a._readyPromise.resolve(a)})}};Rs.prototype.isDestroyed=function(){return!1};Rs.prototype.destroy=function(){return this._polygons=this._polygons&&this._polygons.destroy(),this._polylines=this._polylines&&this._polylines.destroy(),this._points=this._points&&this._points.destroy(),this._batchTable=this._batchTable&&this._batchTable.destroy(),Cesium.destroyObject(this)};var Qu=Rs;var n_={b3dm:function(e,t,r,n,i){return new aa(e,t,r,n,i)},pnts:function(e,t,r,n,i){return new vd(e,t,r,n,i)},i3dm:function(e,t,r,n,i){return new zu(e,t,r,n,i)},cmpt:function(e,t,r,n,i){return new Wu(e,t,r,n,i,n_)},json:function(e,t,r,n,i){return new _d(e,t,r,n,i)},geom:function(e,t,r,n,i){return new Cesium.Geometry3DTileContent(e,t,r,n,i)},vctr:function(e,t,r,n,i){return new Qu(e,t,r,n,i)}},fa=n_;function jt(e,t,r,n){this._tileset=e,this._header=r;var i=r.content;if(Cesium.defined(r.transform)&&(Cesium.defined(e.position)||Cesium.defined(e.headingPitchRoll)||Cesium.defined(e.scale))){var s=Cesium.Matrix4.unpack(r.transform),a=Cesium.defined(e.position)?Cesium.Cartesian3.fromRadians(e.position.longitude,e.position.latitude,e.position.height):Cesium.Matrix4.getTranslation(s,new Cesium.Cartesian3),o=Cesium.defined(e.headingPitchRoll)?Cesium.Transforms.headingPitchRollQuaternion(a,e.headingPitchRoll):Cesium.Quaternion.fromRotationMatrix(Cesium.Matrix4.getMatrix3(s,new Cesium.Matrix3),new Cesium.Quaternion),u=Cesium.defined(e.scale)?e.scale:Cesium.Matrix4.getScale(s,new Cesium.Cartesian3),f=Cesium.Matrix4.fromTranslationQuaternionRotationScale(a,o,u),l=Cesium.Matrix4.inverse(s,new Cesium.Matrix4),c=Cesium.Matrix4.multiply(f,l,new Cesium.Matrix4);e.modelMatrix=c}this.transform=Cesium.defined(r.transform)?Cesium.Matrix4.unpack(r.transform):Cesium.Matrix4.clone(Cesium.Matrix4.IDENTITY);var h=Cesium.defined(n)?n.computedTransform:e.modelMatrix,d=Cesium.Matrix4.multiply(h,this.transform,new Cesium.Matrix4),m=Cesium.defined(n)?n._initialTransform:Cesium.Matrix4.IDENTITY;this._initialTransform=Cesium.Matrix4.multiply(m,this.transform,new Cesium.Matrix4),this.computedTransform=d,this._boundingVolume=this.createBoundingVolume(r.boundingVolume,d),Cesium.defined(e.position)&&h.equals(Cesium.Matrix4.IDENTITY)&&(this._boundingVolume._boundingSphere.center=Cesium.Cartesian3.fromRadians(e.position.longitude,e.position.latitude,e.position.height)),this._boundingVolume2D=void 0;var g;Cesium.defined(i)&&Cesium.defined(i.boundingVolume)&&(g=this.createBoundingVolume(i.boundingVolume,d)),this._contentBoundingVolume=g,this._contentBoundingVolume2D=void 0;var p;Cesium.defined(r.viewerRequestVolume)&&(p=this.createBoundingVolume(r.viewerRequestVolume,d)),this._viewerRequestVolume=p,this.geometricError=r.geometricError,this._geometricError=r.geometricError,Cesium.defined(this._geometricError)||(this._geometricError=Cesium.defined(n)?n.geometricError:e._geometricError,jt._deprecationWarning("geometricErrorUndefined","Required property geometricError is undefined for this tile. Using parent's geometric error instead.")),this.updateGeometricErrorScale(),this.geometricError*=this._tileset._geoErrorRatio,this._geometricError*=this._tileset._geoErrorRatio;var v;Cesium.defined(r.refine)?((r.refine==="replace"||r.refine==="add")&&jt._deprecationWarning("lowercase-refine",'This tile uses a lowercase refine "'+r.refine+'". Instead use "'+r.refine.toUpperCase()+'".'),v=r.refine.toUpperCase()==="REPLACE"?Cesium.Cesium3DTileRefine.REPLACE:Cesium.Cesium3DTileRefine.ADD):Cesium.defined(n)?v=n.refine:v=Cesium.Cesium3DTileRefine.REPLACE,this.refine=v,this.children=[],this.parent=n;var _,y,x,E,S;t=Cesium.Resource.createIfNeeded(t);function I(C){let b=C;if(/\//.test(b)){let A=C.split("/");b="";let R=0,F=A.length;if(F>1){for(;R<F-1;++R)b+=encodeURIComponent(A[R])+"/";b+=encodeURIComponent(A[R])}}else b=encodeURIComponent(C);return b}if(Cesium.defined(i)){var P=I(i.uri);Cesium.defined(i.url)&&(jt._deprecationWarning("contentUrl",'This tileset JSON uses the "content.url" property which has been deprecated. Use "content.uri" instead.'),P=I(i.url)),y=!1,x=Cesium.Cesium3DTileContentState.UNLOADED,E=t.getDerivedResource({url:P,queryParameters:t.queryParameters}),S=Cesium.RequestScheduler.getServerKey(E.getUrlComponent())}else _=new Cesium.Empty3DTileContent(e,this),y=!0,x=Cesium.Cesium3DTileContentState.READY;this._content=_,this._contentResource=E,this._contentState=x,this._contentReadyToProcessPromise=void 0,this._contentReadyPromise=void 0,this._expiredContent=void 0,this._serverKey=S,this.hasEmptyContent=y,this.hasTilesetContent=!1,this.cacheNode=void 0;var w=r.expire,N,B;Cesium.defined(w)&&(N=w.duration,Cesium.defined(w.date)&&(B=Cesium.JulianDate.fromIso8601(w.date))),this.expireDuration=N,this.expireDate=B,this.lastStyleTime=0,this._optimChildrenWithinParent=Cesium.Cesium3DTileOptimizationHint.NOT_COMPUTED,this.clippingPlanesDirty=!1,this.priorityDeferred=!1,this._distanceToCamera=0,this._centerZDepth=0,this._screenSpaceError=0,this._screenSpaceErrorProgressiveResolution=0,this._visibilityPlaneMask=0,this._visible=!1,this._inRequestVolume=!1,this._finalResolution=!0,this._depth=0,this._stackLength=0,this._selectionDepth=0,this._updatedVisibilityFrame=0,this._touchedFrame=0,this._visitedFrame=0,this._selectedFrame=0,this._requestedFrame=0,this._ancestorWithContent=void 0,this._ancestorWithContentAvailable=void 0,this._refines=!1,this._shouldSelect=!1,this._isClipped=!0,this._clippingPlanesState=0,this._debugBoundingVolume=void 0,this._debugContentBoundingVolume=void 0,this._debugViewerRequestVolume=void 0,this._debugColor=Cesium.Color.fromRandom({alpha:1}),this._debugColorizeTiles=!1,this._priority=0,this._priorityHolder=this,this._priorityProgressiveResolution=!1,this._priorityProgressiveResolutionScreenSpaceErrorLeaf=!1,this._priorityReverseScreenSpaceError=0,this._foveatedFactor=0,this._wasMinPriorityChild=!1,this._loadTimestamp=new Cesium.JulianDate,this._commandsLength=0,this._color=void 0,this._colorDirty=!1,this._request=void 0,this._labels=void 0,this.destroySubtreeFunction=void 0,Cesium.defined(this.parent)&&Cesium.defined(this.parent.sharedResources)&&(this.sharedResources={treeTables:Cesium.defined(this.parent.sharedResources.treeTables)?{name:this.parent.sharedResources.treeTables.name,shadredData:this.parent.sharedResources.treeTables.shadredData}:{},instancedPrograms:{name:this.parent.sharedResources.instancedPrograms.name,shadredData:this.parent.sharedResources.instancedPrograms.shadredData},ktxs:this.parent.sharedResources.ktxs}),Cesium.defined(this._header)&&Cesium.defined(this._header.modeltree)&&zI(this,this._header.modeltree.uri)}jt._deprecationWarning=Cesium.deprecationWarning;Object.defineProperties(jt.prototype,{tileset:{get:function(){return this._tileset}},content:{get:function(){return this._content}},boundingVolume:{get:function(){return this._boundingVolume}},contentBoundingVolume:{get:function(){return Cesium.defaultValue(this._contentBoundingVolume,this._boundingVolume)}},boundingSphere:{get:function(){return this._boundingVolume.boundingSphere}},extras:{get:function(){return this._header.extras}},color:{get:function(){return Cesium.defined(this._color)||(this._color=new Cesium.Color),Cesium.Color.clone(this._color)},set:function(e){this._color=Cesium.Color.clone(e,this._color),this._colorDirty=!0}},contentAvailable:{get:function(){return this.contentReady&&!this.hasEmptyContent&&!this.hasTilesetContent||Cesium.defined(this._expiredContent)&&!this.contentFailed}},contentReady:{get:function(){return this._contentState===Cesium.Cesium3DTileContentState.READY}},contentUnloaded:{get:function(){return this._contentState===Cesium.Cesium3DTileContentState.UNLOADED}},contentExpired:{get:function(){return this._contentState===Cesium.Cesium3DTileContentState.EXPIRED}},contentFailed:{get:function(){return this._contentState===Cesium.Cesium3DTileContentState.FAILED}},contentReadyToProcessPromise:{get:function(){if(Cesium.defined(this._contentReadyToProcessPromise))return this._contentReadyToProcessPromise.promise}},contentReadyPromise:{get:function(){if(Cesium.defined(this._contentReadyPromise))return this._contentReadyPromise.promise}},commandsLength:{get:function(){return this._commandsLength}}});var la=new Cesium.Cartesian3;function OI(e,t){var r=e._tileset,n=t.camera,i=e.boundingSphere,s=i.radius,a=Cesium.Cartesian3.multiplyByScalar(n.directionWC,e._centerZDepth,la),o=Cesium.Cartesian3.add(n.positionWC,a,la),u=Cesium.Cartesian3.subtract(o,i.center,la),f=Cesium.Cartesian3.magnitude(u),l=f>s;if(l){var c=Cesium.Cartesian3.normalize(u,la),h=Cesium.Cartesian3.multiplyByScalar(c,s,la),d=Cesium.Cartesian3.add(i.center,h,la),m=Cesium.Cartesian3.subtract(d,n.positionWC,la),g=Cesium.Cartesian3.normalize(m,la);e._foveatedFactor=1-Math.abs(Cesium.Cartesian3.dot(n.directionWC,g))}else e._foveatedFactor=0;var p=e.refine===Cesium.Cesium3DTileRefine.REPLACE,v=r._skipLevelOfDetail;if(p&&!v||!r.foveatedScreenSpaceError||r.foveatedConeSize===1||e._priorityProgressiveResolution&&p&&v||r._pass===Cesium.Cesium3DTilePass.PRELOAD_FLIGHT||r._pass===Cesium.Cesium3DTilePass.PRELOAD)return!1;var _=1-Math.cos(n.frustum.fov*.5),y=r.foveatedConeSize*_;if(e._foveatedFactor<=y)return!1;var x=_-y,E=Cesium.Math.clamp((e._foveatedFactor-y)/x,0,1),S=r.foveatedInterpolationCallback(r.foveatedMinimumScreenSpaceErrorRelaxation,r.maximumScreenSpaceError,E),I=e._screenSpaceError===0&&Cesium.defined(e.parent)?e.parent._screenSpaceError*.5:e._screenSpaceError;return r.maximumScreenSpaceError-S<=I}var a_=new Cesium.JulianDate;jt.prototype.getScreenSpaceError=function(e,t,r){var n=this._tileset,i=Cesium.defaultValue(r,1),s=Cesium.defined(this.parent)?this.parent.geometricError:n._geometricError,a=t?s:this.geometricError;if(a===0)return 0;var o=e.camera,u=o.frustum,f=e.context,l=f.drawingBufferWidth,c=f.drawingBufferHeight*i,h;if(e.mode===Cesium.SceneMode.SCENE2D||u instanceof Cesium.OrthographicFrustum){Cesium.defined(u._offCenterFrustum)&&(u=u._offCenterFrustum);var d=Math.max(u.top-u.bottom,u.right-u.left)/Math.max(l,c);h=a/d}else{var m=Math.max(this._distanceToCamera,Cesium.Math.EPSILON7);if(this._depth===1&&Cesium.defined(n._maxHeight)&&Cesium.defined(n._minHeight)&&Cesium.defined(n._distanceLimit)){var c=e.camera.positionCartographic.height;return n._maxHeight>=c&&n._minHeight<=c&&n._distance>=m&&n._distanceLimit<=m?n._maximumScreenSpaceError+1:0}if(Cesium.defined(n._distance))Cesium.defined(n._distance)&&Cesium.defined(n._distanceLimit)?n._distance>=m&&n._distanceLimit<=m?h=n._maximumScreenSpaceError*e.pixelRatio+1:h=0:Cesium.defined(n._distance)&&(n._distance>=m?h=n._maximumScreenSpaceError*e.pixelRatio+1:h=0);else{var g=o.frustum.sseDenominator;if(h=a*c/(m*g),n.reduceRequest&&o._positionCartographic.height>0){var p=o._positionCartographic.height/m;p=p>1?1:p,h*=p}if(n.dynamicScreenSpaceError){var v=n._dynamicScreenSpaceErrorComputedDensity,_=n.dynamicScreenSpaceErrorFactor,y=Cesium.Math.fog(m,v)*_;h-=y}}}return h/=e.pixelRatio,h};function NI(e,t){if(e.progressiveResolutionHeightFraction<=0||e.progressiveResolutionHeightFraction>.5)return!1;var r=t._screenSpaceErrorProgressiveResolution>e._maximumScreenSpaceError;t._priorityProgressiveResolutionScreenSpaceErrorLeaf=!1;var n=t.parent,i=e._maximumScreenSpaceError,s=t._screenSpaceErrorProgressiveResolution<=i,a=Cesium.defined(n)&&n._screenSpaceErrorProgressiveResolution>i;return s&&a&&(t._priorityProgressiveResolutionScreenSpaceErrorLeaf=!0,r=!0),r}function FI(e,t){var r=t.parent,n=Cesium.defined(r)&&(!e._skipLevelOfDetail||t._screenSpaceError===0||r.hasTilesetContent),i=n?r._screenSpaceError:t._screenSpaceError;return e.root._screenSpaceError-i}jt.prototype.updateVisibility=function(e){var t=this.parent,r=this._tileset,n=Cesium.defined(t)?t.computedTransform:r.modelMatrix,i=Cesium.defined(t)?t._visibilityPlaneMask:Cesium.CullingVolume.MASK_INDETERMINATE;this.updateTransform(n),this._distanceToCamera=this.distanceToTile(e),this._centerZDepth=this.distanceToTileCenter(e),this._screenSpaceError=this.getScreenSpaceError(e,!1),this._screenSpaceErrorProgressiveResolution=this.getScreenSpaceError(e,!1,r.progressiveResolutionHeightFraction),this._visibilityPlaneMask=this.visibility(e,i),this._visible=this._visibilityPlaneMask!==Cesium.CullingVolume.MASK_OUTSIDE,r._useCulling||(this._visible=!0),this._inRequestVolume=this.insideViewerRequestVolume(e),this._priorityReverseScreenSpaceError=FI(r,this),this._priorityProgressiveResolution=NI(r,this),this.priorityDeferred=OI(this,e)};jt.prototype.updateExpiration=function(){if(Cesium.defined(this.expireDate)&&this.contentReady&&!this.hasEmptyContent){var e=Cesium.JulianDate.now(a_);Cesium.JulianDate.lessThan(this.expireDate,e)&&(this._contentState=Cesium.Cesium3DTileContentState.EXPIRED,this._expiredContent=this._content)}};function Od(e){if(Cesium.defined(e.expireDuration)){var t=Cesium.JulianDate.now(a_);Cesium.JulianDate.addSeconds(t,e.expireDuration,t),Cesium.defined(e.expireDate)?Cesium.JulianDate.lessThan(e.expireDate,t)&&Cesium.JulianDate.clone(t,e.expireDate):e.expireDate=Cesium.JulianDate.clone(t)}}function Nd(e,t){return function(r){e._contentState===Cesium.Cesium3DTileContentState.PROCESSING?--t.statistics.numberOfTilesProcessing:--t.statistics.numberOfPendingRequests,e._contentState=Cesium.Cesium3DTileContentState.FAILED,e._contentReadyPromise.reject(r),e._contentReadyToProcessPromise.reject(r)}}function o_(e){return function(){return e._priority}}jt.prototype.requestContent=function(){var e=this,t=this._tileset;if(this.hasEmptyContent)return!1;var r=this._contentResource.clone(),n=this.contentExpired;n&&r.setQueryParameters({expired:this.expireDate.toString()});var i=new Cesium.Request({throttle:!1,throttleByServer:!1,type:Cesium.RequestType.TILES3D,priorityFunction:o_(this),serverKey:this._serverKey});this._request=i,r.request=i;var s=r.fetchArrayBuffer();if(!Cesium.defined(s))return!1;var a=this._contentState;this._contentState=Cesium.Cesium3DTileContentState.LOADING,this._contentReadyToProcessPromise=Ne.defer(),this._contentReadyPromise=Ne.defer();var o=Nd(this,t);return s.then(function(u){if(e.isDestroyed()){o();return}var f=new Uint8Array(u),l=Cesium.getMagic(f),c=fa[l],h;return t._disableSkipLevelOfDetail=t._disableSkipLevelOfDetail||l==="vctr"||l==="geom",Cesium.defined(c)?h=c(t,e,e._contentResource,u,0):(h=fa.json(t,e,e._contentResource,u,0),e.hasTilesetContent=!0),n&&(e.expireDate=void 0),e._content=h,e._contentState=Cesium.Cesium3DTileContentState.PROCESSING,e._contentReadyToProcessPromise.resolve(h),h.readyPromise.then(function(d){if(e._request&&(e._request.deferred=void 0,e._request.requestFunction=void 0,e._request.cancelFunction=void 0,e._request.priorityFunction=void 0,e._request=void 0),e.isDestroyed()){o();return}Od(e),e._selectedFrame=0,e.lastStyleTime=0,Cesium.JulianDate.now(e._loadTimestamp),e._contentState=Cesium.Cesium3DTileContentState.READY,e._contentReadyPromise.resolve(d)})}).catch(function(u){if(i.state===Cesium.RequestState.CANCELLED){e._contentState=a,--t.statistics.numberOfPendingRequests,++t.statistics.numberOfAttemptedRequests;return}o(u)}),!0};jt.prototype.requestContentByIndexedDB=function(){var e=this;if(this.hasEmptyContent)return!1;var t=this._contentResource.clone(),r=this.contentExpired;r&&t.setQueryParameters({expired:this.expireDate.toString()});var n=new Cesium.Request({throttle:!0,throttleByServer:!0,type:Cesium.RequestType.TILES3D,priorityFunction:o_(this),serverKey:this._serverKey});t.request=n;var i={keyName:e._contentResource._url,resource:t,c3DTile:e,data:void 0,contentState:e._contentState,downloadSuccessFun:VI,downloadErrorFun:BI};return Ts.loadCesium3DTile(i)?(e._contentState=Cesium.Cesium3DTileContentState.LOADING,e._contentReadyToProcessPromise=Ne.defer(),e._contentReadyPromise=Ne.defer(),!0):!1};function BI(e){if(Cesium.defined(e)&&Cesium.defined(e.resource)&&Cesium.defined(e.c3DTile)){var t=e,r=t.c3DTile,n=t.resource,i=t.c3DTile._tileset,s=n.request,a=i._statistics,o=n.fetchArrayBuffer();if(!Cesium.defined(o)){++a.numberOfAttemptedRequests,r._contentState=t.contentState;return}r.contentExpired&&(r.expireDate=void 0);var u=Nd(r,i);o.then(function(l){if(r.isDestroyed()){u();return}t.data=l;var c=new Uint8Array(l),h=Cesium.getMagic(c),d=fa[h],m;return i._disableSkipLevelOfDetail=i._disableSkipLevelOfDetail||h==="vctr"||h==="geom",Cesium.defined(d)?m=d(i,r,r._contentResource,l,0):(m=fa.json(i,r,r._contentResource,l,0),r.hasTilesetContent=!0),r._content=m,r._contentState=Cesium.Cesium3DTileContentState.PROCESSING,r._contentReadyToProcessPromise.resolve(m),m.readyPromise.then(function(g){if(r.isDestroyed()){u();return}var p=[];if(r._content.constructor.name==="Composite3DTileContent")for(var v=0;v<r._content._contents.length;v++){var _=r._content._contents[v];if(_.constructor.name==="Batched3DModel3DTileContent"){if(!Cesium.defined(_._model)){p.push(void 0);continue}p.push(_._model.meshPrimitives)}else if(_.constructor.name==="Instanced3DModel3DTileContent"){if(!Cesium.defined(_._modelInstanceCollection._model)){p.push(void 0);continue}p.push(_._modelInstanceCollection._model.meshPrimitives)}}else r._content.constructor.name==="Batched3DModel3DTileContent"?Cesium.defined(r._content._model)&&p.push(r._content._model.meshPrimitives):r._content.constructor.name==="Instanced3DModel3DTileContent"?Cesium.defined(r._content._modelInstanceCollection._model)&&p.push(r._content._modelInstanceCollection._model.meshPrimitives):r._content.constructor.name==="PointCloud3DTileContent"&&Cesium.defined(r._content._pointCloud)&&p.push(r._content._pointCloud.meshPrimitives);if(t.meshPrimitives=p,Ts.saveCesium3DTile(t),r._content.constructor.name==="Composite3DTileContent")for(var y=0;y<r._content._contents.length;y++){var x=r._content._contents[y];x.constructor.name==="Batched3DModel3DTileContent"?Cesium.defined(x._model)&&(x._model.meshPrimitives.length=0):x.constructor.name==="Instanced3DModel3DTileContent"&&Cesium.defined(x._modelInstanceCollection._model)&&(x._modelInstanceCollection._model.meshPrimitives.length=0)}else r._content.constructor.name==="Batched3DModel3DTileContent"?Cesium.defined(r._content._model)&&(r._content._model.meshPrimitives.length=0):r._content.constructor.name==="Instanced3DModel3DTileContent"?Cesium.defined(r._content._modelInstanceCollection._model)&&(r._content._modelInstanceCollection._model.meshPrimitives.length=0):r._content.constructor.name==="PointCloud3DTileContent"&&Cesium.defined(r._content._pointCloud)&&(r._content._pointCloud.meshPrimitives=0);Od(r),r._selectedFrame=0,r.lastStyleTime=0,r._contentState=Cesium.Cesium3DTileContentState.READY,r._contentReadyPromise.resolve(g)})}).catch(function(l){if(s.state===Cesium.RequestState.CANCELLED){r._contentState=t.contentState,--i.statistics.numberOfPendingRequests,++i.statistics.numberOfAttemptedRequests;return}u(l)});var f=r.contentExpired;f&&(r.hasTilesetContent?r.destroySubtreeFunction(i,r):(a.decrementLoadCounts(r.content),--a.numberOfTilesWithContentReady))}}function VI(e,t){if(Cesium.defined(e)&&Cesium.defined(e.resource)&&Cesium.defined(e.c3DTile)){var r=e,n=r.c3DTile,i=r.c3DTile._tileset,s=i._statistics,a=Nd(n,i);if(n.isDestroyed()){a();return}var o=new Uint8Array(t),u=Cesium.getMagic(o),f=fa[u],l;i._disableSkipLevelOfDetail=i._disableSkipLevelOfDetail||u==="vctr"||u==="geom",Cesium.defined(f)?l=f(i,n,n._contentResource,t,0):(l=fa.json(i,n,n._contentResource,t,0),n.hasTilesetContent=!0);var c=r.meshPrimitives;if(l.constructor.name==="Composite3DTileContent")for(var h=0;h<l._contents.length&&h<c.length;h++){var d=l._contents[h];d.constructor.name==="Batched3DModel3DTileContent"?Cesium.defined(d._model)&&(d._model.meshPrimitives=c[h]):d.constructor.name==="Instanced3DModel3DTileContent"&&Cesium.defined(d._modelInstanceCollection)&&(d._modelInstanceCollection.modelMeshPrimitives=c[h])}else l.constructor.name==="Batched3DModel3DTileContent"?Cesium.defined(l._model)&&c.length>0&&(l._model.meshPrimitives=c[0]):l.constructor.name==="Instanced3DModel3DTileContent"?Cesium.defined(l._modelInstanceCollection._model)&&c.length>0&&(l._modelInstanceCollection.modelMeshPrimitives=c[0]):l.constructor.name==="PointCloud3DTileContent"&&Cesium.defined(l._pointCloud)&&c.length>0&&(l._pointCloud.meshPrimitives=c[0]);return n._content=l,n._contentState=Cesium.Cesium3DTileContentState.PROCESSING,n._contentReadyToProcessPromise.resolve(l),l.readyPromise.then(function(m){if(n.isDestroyed()){a();return}Od(n),n._selectedFrame=0,n.lastStyleTime=0,n._contentState=Cesium.Cesium3DTileContentState.READY,n._contentReadyPromise.resolve(m)})}}function zI(e,t){var r=t.substr(t.lastIndexOf("/")+1),n=e._contentResource._url.substr(e._contentResource._url.lastIndexOf("/")+1),i=e._contentResource._url.split(n);if(t=i[0]+r,Cesium.defined(e._contentResource._queryParameters.role_key)){var s="?role_key="+e._contentResource._queryParameters.role_key;t+=s}Cesium.Resource.fetchJson(Cesium.buildModuleUrl(t)).then(function(a){u_(a),e._tileset.sharedResources.treeTables[e._header.modeltree.uri]=a,e._tileset.tramsformTreeTableMap(a)})}function u_(e){var t=e.children;if(Cesium.defined(t))for(var r=t.length,n=0;n<r;n++)t[n].parentId=e.id,Cesium.defined(t[n].children)&&u_(t[n]);else return}jt.prototype.unloadContent=function(){this.hasEmptyContent||this.hasTilesetContent||(this._content=this._content&&this._content.destroy(),this._contentState=Cesium.Cesium3DTileContentState.UNLOADED,this._contentReadyToProcessPromise=void 0,this._contentReadyPromise=void 0,this.lastStyleTime=0,this.clippingPlanesDirty=this._clippingPlanesState===0,this._clippingPlanesState=0,this._debugColorizeTiles=!1,this._debugBoundingVolume=this._debugBoundingVolume&&this._debugBoundingVolume.destroy(),this._debugContentBoundingVolume=this._debugContentBoundingVolume&&this._debugContentBoundingVolume.destroy(),this._debugViewerRequestVolume=this._debugViewerRequestVolume&&this._debugViewerRequestVolume.destroy())};var f_=new Cesium.BoundingSphere;function Fd(e,t){if(t.mode!==Cesium.SceneMode.SCENE3D&&!Cesium.defined(e._boundingVolume2D)){var r=e._boundingVolume.boundingSphere,n=Cesium.BoundingSphere.projectTo2D(r,t.mapProjection,f_);e._boundingVolume2D=new Cesium.TileBoundingSphere(n.center,n.radius)}return t.mode!==Cesium.SceneMode.SCENE3D?e._boundingVolume2D:e._boundingVolume}function kI(e,t){if(t.mode!==Cesium.SceneMode.SCENE3D&&!Cesium.defined(e._contentBoundingVolume2D)){var r=e._contentBoundingVolume.boundingSphere,n=Cesium.BoundingSphere.projectTo2D(r,t.mapProjection,f_);e._contentBoundingVolume2D=new Cesium.TileBoundingSphere(n.center,n.radius)}return t.mode!==Cesium.SceneMode.SCENE3D?e._contentBoundingVolume2D:e._contentBoundingVolume}jt.prototype.visibility=function(e,t){var r=e.cullingVolume,n=Fd(this,e),i=this._tileset,s=i.clippingPlanes;if(Cesium.defined(s)&&s.enabled){var a=s.computeIntersectionWithBoundingVolume(n,i.clippingPlanesOriginMatrix);if(this._isClipped=a!==Cesium.Intersect.INSIDE,a===Cesium.Intersect.OUTSIDE)return Cesium.CullingVolume.MASK_OUTSIDE}return r.computeVisibilityWithPlaneMask(n,t)};jt.prototype.contentVisibility=function(e){if(!Cesium.defined(this._contentBoundingVolume)||this._visibilityPlaneMask===Cesium.CullingVolume.MASK_INSIDE)return Cesium.Intersect.INSIDE;var t=e.cullingVolume,r=kI(this,e),n=this._tileset,i=n.clippingPlanes;if(Cesium.defined(i)&&i.enabled){var s=i.computeIntersectionWithBoundingVolume(r,n.clippingPlanesOriginMatrix);if(this._isClipped=s!==Cesium.Intersect.INSIDE,s===Cesium.Intersect.OUTSIDE)return Cesium.Intersect.OUTSIDE}return t.computeVisibility(r)};jt.prototype.distanceToTile=function(e){var t=Fd(this,e);return t.distanceToCamera(e)};var UI=new Cesium.Cartesian3;jt.prototype.distanceToTileCenter=function(e){var t=Fd(this,e),r=t.boundingVolume,n=Cesium.Cartesian3.subtract(r.center,e.camera.positionWC,UI);return Cesium.Cartesian3.dot(e.camera.directionWC,n)};jt.prototype.insideViewerRequestVolume=function(e){var t=this._viewerRequestVolume;return!Cesium.defined(t)||t.distanceToCamera(e)===0};var l_=new Cesium.Matrix3,c_=new Cesium.Cartesian3,GI=new Cesium.Matrix3,h_=new Cesium.Cartesian3,d_=new Cesium.Rectangle,qI=new Cesium.OrientedBoundingBox,Rd=new Cesium.Matrix4;function HI(e,t,r){var n=Cesium.Cartesian3.fromElements(e[0],e[1],e[2],h_),i=Cesium.Matrix3.fromArray(e,3,GI);n=Cesium.Matrix4.multiplyByPoint(t,n,n);var s=Cesium.Matrix4.getMatrix3(t,l_);return i=Cesium.Matrix3.multiply(s,i,i),Cesium.defined(r)?(r.update(n,i),r):new Cesium.TileOrientedBoundingBox(n,i)}function WI(e,t,r,n){var i=Cesium.Rectangle.unpack(e,0,d_),s=e[4],a=e[5],o=Cesium.OrientedBoundingBox.fromRectangle(i,s,a,Cesium.Ellipsoid.WGS84,qI),u=o.center,f=o.halfAxes;t=Cesium.Matrix4.multiplyTransformation(t,Cesium.Matrix4.inverse(r,Rd),Rd),u=Cesium.Matrix4.multiplyByPoint(t,u,u);var l=Cesium.Matrix4.getMatrix3(t,l_);return f=Cesium.Matrix3.multiply(l,f,f),Cesium.defined(n)&&n instanceof Cesium.TileOrientedBoundingBox?(n.update(u,f),n):new Cesium.TileOrientedBoundingBox(u,f)}function YI(e,t,r,n){if(!Cesium.Matrix4.equalsEpsilon(t,r,Cesium.Math.EPSILON8))return WI(e,t,r,n);if(Cesium.defined(n))return n;var i=Cesium.Rectangle.unpack(e,0,d_);return new Cesium.TileBoundingRegion({rectangle:i,minimumHeight:e[4],maximumHeight:e[5]})}function XI(e,t,r){var n=Cesium.Cartesian3.fromElements(e[0],e[1],e[2],h_),i=e[3];n=Cesium.Matrix4.multiplyByPoint(t,n,n);var s=Cesium.Matrix4.getScale(t,c_),a=Cesium.Cartesian3.maximumComponent(s);return i*=a,Cesium.defined(r)?(r.update(n,i),r):new Cesium.TileBoundingSphere(n,i)}jt.prototype.createBoundingVolume=function(e,t,r){if(!Cesium.defined(e))throw new Cesium.RuntimeError("boundingVolume must be defined");if(Cesium.defined(e.box))return HI(e.box,t,r);if(Cesium.defined(e.region))return YI(e.region,t,this._initialTransform,r);if(Cesium.defined(e.sphere))return XI(e.sphere,t,r);throw new Cesium.RuntimeError("boundingVolume must contain a sphere, region, or box")};jt.prototype.updateTransform=function(e){e=Cesium.defaultValue(e,Cesium.Matrix4.IDENTITY);var t=Cesium.Matrix4.multiply(e,this.transform,Rd),r=!Cesium.Matrix4.equals(t,this.computedTransform);if(r){Cesium.Matrix4.clone(t,this.computedTransform);var n=this._header,i=this._header.content;this._boundingVolume=this.createBoundingVolume(n.boundingVolume,this.computedTransform,this._boundingVolume),Cesium.defined(this._contentBoundingVolume)&&(this._contentBoundingVolume=this.createBoundingVolume(i.boundingVolume,this.computedTransform,this._contentBoundingVolume)),Cesium.defined(this._viewerRequestVolume)&&(this._viewerRequestVolume=this.createBoundingVolume(n.viewerRequestVolume,this.computedTransform,this._viewerRequestVolume)),this.updateGeometricErrorScale(),this._debugBoundingVolume=this._debugBoundingVolume&&this._debugBoundingVolume.destroy(),this._debugContentBoundingVolume=this._debugContentBoundingVolume&&this._debugContentBoundingVolume.destroy(),this._debugViewerRequestVolume=this._debugViewerRequestVolume&&this._debugViewerRequestVolume.destroy()}};jt.prototype.updateGeometricErrorScale=function(){var e=Cesium.Matrix4.getScale(this.computedTransform,c_),t=Cesium.Cartesian3.maximumComponent(e)};function jI(e,t,r,n){if(n.isRender){var i=Cesium.defined(e._header.content)&&Cesium.defined(e._header.content.boundingVolume),s=e.hasEmptyContent||e.hasTilesetContent,a=t.debugShowBoundingVolume||t.debugShowContentBoundingVolume&&!i;if(a){var o;e._finalResolution?s?o=Cesium.Color.DARKGRAY:o=Cesium.Color.WHITE:o=Cesium.Color.YELLOW,Cesium.defined(e._debugBoundingVolume)||(e._debugBoundingVolume=e._boundingVolume.createDebugVolume(o)),e._debugBoundingVolume.update(r);var u=e._debugBoundingVolume.getGeometryInstanceAttributes("outline");u.color=Cesium.ColorGeometryInstanceAttribute.toValue(o,u.color)}else!a&&Cesium.defined(e._debugBoundingVolume)&&(e._debugBoundingVolume=e._debugBoundingVolume.destroy());t.debugShowContentBoundingVolume&&i?(Cesium.defined(e._debugContentBoundingVolume)||(e._debugContentBoundingVolume=e._contentBoundingVolume.createDebugVolume(Cesium.Color.BLUE)),e._debugContentBoundingVolume.update(r)):!t.debugShowContentBoundingVolume&&Cesium.defined(e._debugContentBoundingVolume)&&(e._debugContentBoundingVolume=e._debugContentBoundingVolume.destroy()),t.debugShowViewerRequestVolume&&Cesium.defined(e._viewerRequestVolume)?(Cesium.defined(e._debugViewerRequestVolume)||(e._debugViewerRequestVolume=e._viewerRequestVolume.createDebugVolume(Cesium.Color.YELLOW)),e._debugViewerRequestVolume.update(r)):!t.debugShowViewerRequestVolume&&Cesium.defined(e._debugViewerRequestVolume)&&(e._debugViewerRequestVolume=e._debugViewerRequestVolume.destroy());var f=t.debugColorizeTiles&&!e._debugColorizeTiles||Cesium.defined(t._heatmap.tilePropertyName),l=!t.debugColorizeTiles&&e._debugColorizeTiles;f?(t._heatmap.colorize(e,r),e._debugColorizeTiles=!0,e.color=e._debugColor):l&&(e._debugColorizeTiles=!1,e.color=Cesium.Color.WHITE),e._colorDirty&&(e._colorDirty=!1,e._content.applyDebugSettings(!0,e._color)),l&&t.makeStyleDirty()}}function KI(e,t,r){var n=e._content,i=e._expiredContent;if(Cesium.defined(i)){if(!e.contentReady){i.update(t,r);return}e._expiredContent.destroy(),e._expiredContent=void 0}n.update(t,r)}function QI(e,t){var r=t.clippingPlanes,n=0;Cesium.defined(r)&&e._isClipped&&r.enabled&&(n=r.clippingPlanesState),n!==e._clippingPlanesState&&(e._clippingPlanesState=n,e.clippingPlanesDirty=!0)}jt.prototype.update=function(e,t,r){var n=t.commandList.length;QI(this,e),jI(this,e,t,r),KI(this,e,t),this._commandsLength=t.commandList.length-n,this._labels&&t.passes.pick&&this._labels.update(t),this.clippingPlanesDirty=!1};var i_=[];jt.prototype.process=function(e,t){var r=t.commandList;t.commandList=i_,this._content.update(e,t),i_.length=0,t.commandList=r};function s_(e,t,r){var n=e*Math.pow(10,t),i=parseInt(n);return i*Math.pow(10,r)}function zl(e,t,r){return Math.max(Cesium.Math.normalize(e,t,r)-Cesium.Math.EPSILON7,0)}jt.prototype.updatePriority=function(){var e=this.tileset,t=e.preferLeaves,r=e._minimumPriority,n=e._maximumPriority,i=4,s=1,a=0,o=i,u=a+o,f=i,l=u+f,c=s,h=Math.pow(10,l),d=l+c,m=s,g=Math.pow(10,d),p=d+m,v=Math.pow(10,p),_=zl(this._depth,r.depth,n.depth);_=t?1-_:_;var y=!e._skipLevelOfDetail&&this.refine===Cesium.Cesium3DTileRefine.REPLACE,x=y?zl(this._priorityHolder._distanceToCamera,r.distance,n.distance):zl(this._priorityReverseScreenSpaceError,r.reverseScreenSpaceError,n.reverseScreenSpaceError),E=s_(x,o,a),S=this._priorityProgressiveResolution?0:h,I=zl(this._priorityHolder._foveatedFactor,r.foveatedFactor,n.foveatedFactor),P=s_(I,f,u),w=this.priorityDeferred?g:0,N=e._pass===Cesium.Cesium3DTilePass.PRELOAD_FLIGHT?0:v;this._priority=_+E+S+P+w+N};jt.prototype.isDestroyed=function(){return!1};jt.prototype.destroy=function(){return this._content=this._content&&this._content.destroy(),this._expiredContent=this._expiredContent&&!this._expiredContent.isDestroyed()&&this._expiredContent.destroy(),this._debugBoundingVolume=this._debugBoundingVolume&&this._debugBoundingVolume.destroy(),this._debugContentBoundingVolume=this._debugContentBoundingVolume&&this._debugContentBoundingVolume.destroy(),this._debugViewerRequestVolume=this._debugViewerRequestVolume&&this._debugViewerRequestVolume.destroy(),this.sharedResources.instancedPrograms=void 0,this.sharedResources.ktxs=void 0,this.sharedResources=void 0,Cesium.destroyObject(this)};var Xa=jt;/**
  @license
  fontmetrics.js - https://github.com/Pomax/fontmetrics.js

  Copyright (C) 2011 by Mike "Pomax" Kamermans

  Permission is hereby granted, free of charge, to any person obtaining a copy
  of this software and associated documentation files (the "Software"), to deal
  in the Software without restriction, including without limitation the rights
  to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
  copies of the Software, and to permit persons to whom the Software is
  furnished to do so, subject to the following conditions:

  The above copyright notice and this permission notice shall be included in
  all copies or substantial portions of the Software.

  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
  IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
  FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
  AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
  LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
  OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
  THE SOFTWARE.
**/var Zu=function(e,t){return document.defaultView.getComputedStyle(e,null).getPropertyValue(t)},ZI=function(e,t,r,n){var i=e.measureText(t),s=Zu(e.canvas,"font-family"),a=Zu(e.canvas,"font-size").replace("px",""),o=Zu(e.canvas,"font-style"),u=Zu(e.canvas,"font-weight"),f=!/\S/.test(t);i.fontsize=a;var l=document.createElement("div");l.style.position="absolute",l.style.opacity=0,l.style.font=o+" "+u+" "+a+"px "+s,l.innerHTML=t+"<br/>"+t,document.body.appendChild(l),i.leading=1.2*a;var c=Zu(l,"height");if(c=c.replace("px",""),c>=a*2&&(i.leading=c/2|0),document.body.removeChild(l),f)i.ascent=0,i.descent=0,i.bounds={minx:0,maxx:i.width,miny:0,maxy:0},i.height=0;else{var h=document.createElement("canvas"),d=100;h.width=i.width+d,h.height=3*a,h.style.opacity=1,h.style.fontFamily=s,h.style.fontSize=a,h.style.fontStyle=o,h.style.fontWeight=u;var m=h.getContext("2d");m.font=o+" "+u+" "+a+"px "+s;var g=h.width,p=h.height,v=p/2;m.fillStyle="white",m.fillRect(-1,-1,g+2,p+2),r&&(m.strokeStyle="black",m.lineWidth=e.lineWidth,m.strokeText(t,d/2,v)),n&&(m.fillStyle="black",m.fillText(t,d/2,v));for(var _=m.getImageData(0,0,g,p).data,y=0,x=g*4,E=_.length;++y<E&&_[y]===255;);var S=y/x|0;for(y=E-1;--y>0&&_[y]===255;);var I=y/x|0;for(y=0;y<E&&_[y]===255;)y+=x,y>=E&&(y=y-E+4);var P=y%x/4|0,w=1;for(y=E-3;y>=0&&_[y]===255;)y-=x,y<0&&(y=E-3-w++*4);var N=y%x/4+1|0;i.ascent=v-S,i.descent=I-v,i.bounds={minx:P-d/2,maxx:N-d/2,miny:0,maxy:I-S},i.height=1+(I-S)}return i},Bd=ZI;function m_(){}function Ka(e){return e._visible&&e._inRequestVolume}var Ju={stack:new Cesium.ManagedArray,stackMaximumLength:0},$u={stack:new Cesium.ManagedArray,stackMaximumLength:0},ef={stack:new Cesium.ManagedArray,stackMaximumLength:0},ns={stack:new Cesium.ManagedArray,stackMaximumLength:0,ancestorStack:new Cesium.ManagedArray,ancestorStackMaximumLength:0},JI=2;m_.selectTiles=function(e,t){if(e._requestedTiles.length=0,e.debugFreezeFrame)return;e._selectedTiles.length=0,e._selectedTilesToStyle.length=0,e._emptyTiles.length=0,e._hasMixedContent=!1;let r=e.root;if(ql(e,r,t),!Ka(r)||r.getScreenSpaceError(t,!0)<=e._maximumScreenSpaceError)return;tf(e)?e.immediatelyLoadDesiredLevelOfDetail?eL(e,r,t):tL(e,r,t):$I(e,r,t),Ju.stack.trim(Ju.stackMaximumLength),$u.stack.trim($u.stackMaximumLength),ef.stack.trim(ef.stackMaximumLength),ns.stack.trim(ns.stackMaximumLength),ns.ancestorStack.trim(ns.ancestorStackMaximumLength);let n=e._requestedTiles,i=n.length;for(let s=0;s<i;++s)n[s].updatePriority()};function $I(e,t,r){let n=e._maximumScreenSpaceError,i=e._maximumScreenSpaceError;zd(e,t,n,i,r)}function eL(e,t,r){let n=Number.MAX_VALUE,i=e._maximumScreenSpaceError;zd(e,t,n,i,r),__(e,t,r)}function tL(e,t,r){let n=Math.max(e.baseScreenSpaceError,e.maximumScreenSpaceError),i=e.maximumScreenSpaceError;zd(e,t,n,i,r),__(e,t,r)}function tf(e){return e._skipLevelOfDetail}function rL(e,t){e._emptyTiles.push(t)}function Ul(e,t,r){if(t.contentVisibility(r)!==Cesium.Intersect.OUTSIDE){let n=t.content;n.featurePropertiesDirty?(n.featurePropertiesDirty=!1,t.lastStyleTime=0,e._selectedTilesToStyle.push(t)):t._selectedFrame<r.frameNumber-1&&e._selectedTilesToStyle.push(t),t._selectedFrame=r.frameNumber,e._selectedTiles.push(t)}}function nL(e,t,r){let n=ef.stack;for(n.push(t);n.length>0;){ef.stackMaximumLength=Math.max(ef.stackMaximumLength,n.length);let s=n.pop().children,a=s.length;for(let o=0;o<a;++o){let u=s[o];Ka(u)&&(u.contentAvailable?(ql(e,u,r),Gl(e,u,r),Ul(e,u,r)):u._depth-t._depth<JI&&n.push(u))}}}function kl(e,t,r){if(!tf(e)){t.contentAvailable&&Ul(e,t,r);return}let n=t.contentAvailable?t:t._ancestorWithContentAvailable;Cesium.defined(n)?n._shouldSelect=!0:nL(e,t,r)}function iL(e,t,r){++e._statistics.visited,t._visitedFrame=r.frameNumber}function Gl(e,t,r){t._touchedFrame!==r.frameNumber&&(e._cache.touch(t),t._touchedFrame=r.frameNumber)}function sL(e,t){e._maximumPriority.distance=Math.max(t._priorityHolder._distanceToCamera,e._maximumPriority.distance),e._minimumPriority.distance=Math.min(t._priorityHolder._distanceToCamera,e._minimumPriority.distance),e._maximumPriority.depth=Math.max(t._depth,e._maximumPriority.depth),e._minimumPriority.depth=Math.min(t._depth,e._minimumPriority.depth),e._maximumPriority.foveatedFactor=Math.max(t._priorityHolder._foveatedFactor,e._maximumPriority.foveatedFactor),e._minimumPriority.foveatedFactor=Math.min(t._priorityHolder._foveatedFactor,e._minimumPriority.foveatedFactor),e._maximumPriority.reverseScreenSpaceError=Math.max(t._priorityReverseScreenSpaceError,e._maximumPriority.reverseScreenSpaceError),e._minimumPriority.reverseScreenSpaceError=Math.min(t._priorityReverseScreenSpaceError,e._minimumPriority.reverseScreenSpaceError)}function aL(e,t,r){if(!e._cullRequestsWhileMoving)return!0;let n=t.boundingSphere,i=Math.max(n.radius*2,1),s=r.camera,a=s.positionWCDeltaMagnitude!==0?s.positionWCDeltaMagnitude:s.positionWCDeltaMagnitudeLastFrame;return e.cullRequestsWhileMovingMultiplier*a/i<1}function ja(e,t,r){if(t._requestedFrame===r.frameNumber||!v_(t)&&!t.contentExpired||!aL(e,t,r))return;let n=r.camera.timeSinceMoved<e.foveatedTimeDelay;t.priorityDeferred&&n||(t._requestedFrame=r.frameNumber,e._requestedTiles.push(t))}function p_(e,t,r){t._updatedVisibilityFrame!==e._updatedVisibilityFrame&&(t.updateVisibility(r),t._updatedVisibilityFrame=e._updatedVisibilityFrame)}function oL(e,t,r){let n=!1,i=t.children,s=i.length;for(let a=0;a<s;++a){let o=i[a];p_(e,o,r),n=n||Ka(o)}return n}function uL(e,t,r){let n=t.parent;return!Cesium.defined(n)||n.hasTilesetContent||n.hasImplicitContent||n.refine!==Cesium.Cesium3DTileRefine.ADD?!1:t.getScreenSpaceError(r,!0)<=e._maximumScreenSpaceError}function g_(e,t,r){if(p_(e,t,r),!Ka(t))return;let n=t.children.length>0;if((t.hasTilesetContent||t.hasImplicitContent)&&n){let a=t.children[0];g_(e,a,r),t._visible=a._visible;return}if(uL(e,t,r)){t._visible=!1;return}let i=t.refine===Cesium.Cesium3DTileRefine.REPLACE,s=t._optimChildrenWithinParent===Cesium.Cesium3DTileOptimizationHint.USE_OPTIMIZATION;if(i&&s&&n&&!oL(e,t,r)){++e._statistics.numberOfTilesCulledWithChildrenUnion,t._visible=!1;return}}function ql(e,t,r){g_(e,t,r),t.updateExpiration(),t._wasMinPriorityChild=!1,t._priorityHolder=t,sL(e,t),t._shouldSelect=!1,t._finalResolution=!0}function fL(e,t){e._ancestorWithContent=void 0,e._ancestorWithContentAvailable=void 0;let r=e.parent;if(Cesium.defined(r)){let n=!v_(r)||r._requestedFrame===t.frameNumber;e._ancestorWithContent=n?r:r._ancestorWithContent,e._ancestorWithContentAvailable=r.contentAvailable?r:r._ancestorWithContentAvailable}}function rf(e){return e.hasEmptyContent||e.hasTilesetContent||e.hasImplicitContent}function v_(e){return!rf(e)&&e.contentUnloaded}function lL(e,t){let r=t._ancestorWithContent;return!e.immediatelyLoadDesiredLevelOfDetail&&(t._priorityProgressiveResolutionScreenSpaceErrorLeaf||Cesium.defined(r)&&t._screenSpaceError<r._screenSpaceError/e.skipScreenSpaceErrorFactor&&t._depth>r._depth+e.skipLevels)}function cL(e,t){return t._distanceToCamera===0&&e._distanceToCamera===0?t._centerZDepth-e._centerZDepth:t._distanceToCamera-e._distanceToCamera}function hL(e,t,r,n){let i,s=t.refine===Cesium.Cesium3DTileRefine.REPLACE,a=t.children,o=a.length;for(i=0;i<o;++i)ql(e,a[i],n);a.sort(cL);let u=!tf(e)&&s&&!rf(t),f=!0,l=!1,c=-1,h=Number.MAX_VALUE,d;for(i=0;i<o;++i)if(d=a[i],Ka(d)?(r.push(d),d._foveatedFactor<h&&(c=i,h=d._foveatedFactor),l=!0):(u||e.loadSiblings)&&(d._foveatedFactor<h&&(c=i,h=d._foveatedFactor),ja(e,d,n),Gl(e,d,n)),u){let m;d._inRequestVolume?rf(d)?m=mL(e,d,n):m=d.contentAvailable:m=!1,f=f&&m}if(l||(f=!1),c!==-1&&!tf(e)&&s){let m=a[c];m._wasMinPriorityChild=!0;let g=(t._wasMinPriorityChild||t===e.root)&&h<=t._priorityHolder._foveatedFactor?t._priorityHolder:t;for(g._foveatedFactor=Math.min(m._foveatedFactor,g._foveatedFactor),g._distanceToCamera=Math.min(m._distanceToCamera,g._distanceToCamera),i=0;i<o;++i)d=a[i],d._priorityHolder=g}return f}function dL(e,t,r){return tf(e)?e.immediatelyLoadDesiredLevelOfDetail?!1:Cesium.defined(t._ancestorWithContent)?t._screenSpaceError===0?t.parent._screenSpaceError>r:t._screenSpaceError>r:!0:!0}function Vd(e,t){return t.children.length===0?!1:t.hasTilesetContent||t.hasImplicitContent?!t.contentExpired:t._screenSpaceError>e._maximumScreenSpaceError}function zd(e,t,r,n,i){let s=Ju.stack;for(s.push(t);s.length>0;){Ju.stackMaximumLength=Math.max(Ju.stackMaximumLength,s.length);let a=s.pop();fL(a,i);let o=dL(e,a,r),u=a.refine===Cesium.Cesium3DTileRefine.ADD,f=a.refine===Cesium.Cesium3DTileRefine.REPLACE,l=a.parent,c=!Cesium.defined(l)||l._refines,h=!1;Vd(e,a)&&(h=hL(e,a,s,i)&&c);let d=!h&&c;rf(a)?(rL(e,a,i),ja(e,a,i),d&&kl(e,a,i)):u?(kl(e,a,i),ja(e,a,i)):f&&(o?(ja(e,a,i),d&&kl(e,a,i)):d?(kl(e,a,i),ja(e,a,i)):lL(e,a)&&ja(e,a,i)),iL(e,a,i),Gl(e,a,i),a._refines=h}}function mL(e,t,r){let n=!0,i=$u.stack;for(i.push(t);i.length>0;){$u.stackMaximumLength=Math.max($u.stackMaximumLength,i.length);let s=i.pop(),a=s.children,o=a.length,u=rf(s),f=u&&Vd(e,s),l=u&&s.children.length===0;if(!f&&!s.contentAvailable&&!l&&(n=!1),ql(e,s,r),Ka(s)||(ja(e,s,r),Gl(e,s,r)),f)for(let c=0;c<o;++c){let h=a[c];i.push(h)}}return n}function __(e,t,r){let n=ns.stack,i=ns.ancestorStack,s;for(n.push(t);n.length>0||i.length>0;){if(ns.stackMaximumLength=Math.max(ns.stackMaximumLength,n.length),ns.ancestorStackMaximumLength=Math.max(ns.ancestorStackMaximumLength,i.length),i.length>0){let h=i.peek();if(h._stackLength===n.length){i.pop(),h!==s&&(h._finalResolution=!1),Ul(e,h,r);continue}}let a=n.pop();if(!Cesium.defined(a))continue;let o=a.refine===Cesium.Cesium3DTileRefine.ADD,u=a._shouldSelect,f=a.children,l=f.length,c=Vd(e,a);if(u&&Ul(e,a,r),c)for(let h=0;h<l;++h){let d=f[h];Ka(d)&&n.push(d)}}}var ca=m_;var Fi={RENDER:0,PICK:1,SHADOW:2,PRELOAD:3,PRELOAD_FLIGHT:4,REQUEST_RENDER_MODE_DEFER_CHECK:5,MOST_DETAILED_PRELOAD:6,MOST_DETAILED_PICK:7,NUMBER_OF_PASSES:8},Os=new Array(Fi.NUMBER_OF_PASSES);Os[Fi.RENDER]=Object.freeze({traversal:ca,isRender:!0,requestTiles:!0,ignoreCommands:!1});Os[Fi.PICK]=Object.freeze({traversal:ca,isRender:!1,requestTiles:!1,ignoreCommands:!1});Os[Fi.SHADOW]=Object.freeze({traversal:ca,isRender:!1,requestTiles:!0,ignoreCommands:!1});Os[Fi.PRELOAD]=Object.freeze({traversal:ca,isRender:!1,requestTiles:!0,ignoreCommands:!0});Os[Fi.PRELOAD_FLIGHT]=Object.freeze({traversal:ca,isRender:!1,requestTiles:!0,ignoreCommands:!0});Os[Fi.REQUEST_RENDER_MODE_DEFER_CHECK]=Object.freeze({traversal:ca,isRender:!1,requestTiles:!0,ignoreCommands:!0});Os[Fi.MOST_DETAILED_PRELOAD]=Object.freeze({traversal:Cesium.Cesium3DTilesetMostDetailedTraversal,isRender:!1,requestTiles:!0,ignoreCommands:!0});Os[Fi.MOST_DETAILED_PICK]=Object.freeze({traversal:Cesium.Cesium3DTilesetMostDetailedTraversal,isRender:!1,requestTiles:!1,ignoreCommands:!1});Fi.getPassOptions=function(e){return Os[e]};var ha=Object.freeze(Fi);var kd=`#extension GL_EXT_frag_depth : enable

uniform sampler2D u_pointCloud_colorGBuffer;
uniform sampler2D u_pointCloud_depthGBuffer;
uniform vec2 u_distanceAndEdlStrength;
varying vec2 v_textureCoordinates;

vec2 neighborContribution(float log2Depth, vec2 offset)
{
    float dist = u_distanceAndEdlStrength.x;
    vec2 texCoordOrig = v_textureCoordinates + offset * dist;
    vec2 texCoord0 = v_textureCoordinates + offset * floor(dist);
    vec2 texCoord1 = v_textureCoordinates + offset * ceil(dist);

    float depthOrLogDepth0 = czm_unpackDepth(texture2D(u_pointCloud_depthGBuffer, texCoord0));
    float depthOrLogDepth1 = czm_unpackDepth(texture2D(u_pointCloud_depthGBuffer, texCoord1));

    // ignore depth values that are the clear depth
    if (depthOrLogDepth0 == 0.0 || depthOrLogDepth1 == 0.0) {
        return vec2(0.0);
    }

    // interpolate the two adjacent depth values
    float depthMix = mix(depthOrLogDepth0, depthOrLogDepth1, fract(dist));
    vec4 eyeCoordinate = czm_windowToEyeCoordinates(texCoordOrig, depthMix);
    return vec2(max(0.0, log2Depth - log2(-eyeCoordinate.z / eyeCoordinate.w)), 1.0);
}

void main()
{
    float depthOrLogDepth = czm_unpackDepth(texture2D(u_pointCloud_depthGBuffer, v_textureCoordinates));

    vec4 eyeCoordinate = czm_windowToEyeCoordinates(gl_FragCoord.xy, depthOrLogDepth);
    eyeCoordinate /= eyeCoordinate.w;

    float log2Depth = log2(-eyeCoordinate.z);

    if (depthOrLogDepth == 0.0) // 0.0 is the clear value for the gbuffer
    {
        discard;
    }

    vec4 color = texture2D(u_pointCloud_colorGBuffer, v_textureCoordinates);

    // sample from neighbors left, right, down, up
    vec2 texelSize = 1.0 / czm_viewport.zw;

    vec2 responseAndCount = vec2(0.0);

    responseAndCount += neighborContribution(log2Depth, vec2(-texelSize.x, 0.0));
    responseAndCount += neighborContribution(log2Depth, vec2(+texelSize.x, 0.0));
    responseAndCount += neighborContribution(log2Depth, vec2(0.0, -texelSize.y));
    responseAndCount += neighborContribution(log2Depth, vec2(0.0, +texelSize.y));

    float response = responseAndCount.x / responseAndCount.y;
    float strength = u_distanceAndEdlStrength.y;
    float shade = exp(-response * 300.0 * strength);
    color.rgb *= shade;
    gl_FragColor = vec4(color);

    // Input and output depth are the same.
    gl_FragDepth = depthOrLogDepth;
}
`;function zo(){this._framebuffer=new Cesium.FramebufferManager({colorAttachmentsLength:2,depth:!0,supportsDepthTexture:!0}),this._drawCommand=void 0,this._clearCommand=void 0,this._strength=1,this._radius=1}Object.defineProperties(zo.prototype,{framebuffer:{get:function(){return this._framebuffer.framebuffer}},colorGBuffer:{get:function(){return this._framebuffer.getColorTexture(0)}},depthGBuffer:{get:function(){return this._framebuffer.getColorTexture(1)}}});function pL(e){e._framebuffer.destroy(),e._drawCommand=void 0,e._clearCommand=void 0}var Ud=new Cesium.Cartesian2;function gL(e,t){let r=new Cesium.ShaderSource({defines:["LOG_DEPTH_WRITE"],sources:[kd]}),n={u_pointCloud_colorGBuffer:function(){return e.colorGBuffer},u_pointCloud_depthGBuffer:function(){return e.depthGBuffer},u_distanceAndEdlStrength:function(){return Ud.x=e._radius,Ud.y=e._strength,Ud}},i=Cesium.RenderState.fromCache({blending:Cesium.BlendingState.ALPHA_BLEND,depthMask:!0,depthTest:{enabled:!0},stencilTest:Cesium.StencilConstants.setCesium3DTileBit(),stencilMask:Cesium.StencilConstants.CESIUM_3D_TILE_MASK});e._drawCommand=t.createViewportQuadCommand(r,{uniformMap:n,renderState:i,pass:Cesium.Pass.CESIUM_3D_TILE,owner:e}),e._clearCommand=new Cesium.ClearCommand({framebuffer:e.framebuffer,color:new Cesium.Color(0,0,0,0),depth:1,renderState:Cesium.RenderState.fromCache(),pass:Cesium.Pass.CESIUM_3D_TILE,owner:e})}function vL(e,t){let r=t.drawingBufferWidth,n=t.drawingBufferHeight;e._framebuffer.update(t,r,n),gL(e,t)}function C_(e){return e.drawBuffers&&e.fragmentDepth}zo.isSupported=C_;function _L(e,t){let r=e.shaderCache.getDerivedShaderProgram(t,"EC");if(!Cesium.defined(r)){let n=t._attributeLocations,i=t.fragmentShaderSource.clone();i.sources=i.sources.map(function(s){return s=Cesium.ShaderSource.replaceMain(s,"czm_point_cloud_post_process_main"),s=s.replace(/gl_FragColor/g,"gl_FragData[0]"),s}),i.sources.unshift(`#extension GL_EXT_draw_buffers : enable 
`),i.sources.push(`void main() 
{ 
    czm_point_cloud_post_process_main(); 
#ifdef LOG_DEPTH
    czm_writeLogDepth();
    gl_FragData[1] = czm_packDepth(gl_FragDepth); 
#else
    gl_FragData[1] = czm_packDepth(gl_FragCoord.z);
#endif
}`),r=e.shaderCache.createDerivedShaderProgram(t,"EC",{vertexShaderSource:t.vertexShaderSource,fragmentShaderSource:i,attributeLocations:n})}return r}zo.prototype.update=function(e,t,r,n){if(!C_(e.context))return;this._strength=r.eyeDomeLightingStrength,this._radius=r.eyeDomeLightingRadius*e.pixelRatio,vL(this,e.context);let i,s=e.commandList,a=s.length;for(i=t;i<a;++i){let f=s[i];if(f.primitiveType!==Cesium.PrimitiveType.POINTS||f.Pass===Cesium.Pass.TRANSLUCENT)continue;let l,c,h=f.derivedCommands.pointCloudProcessor;Cesium.defined(h)&&(l=h.command,c=h.originalShaderProgram),(!Cesium.defined(l)||f.dirty||c!==f.shaderProgram||l.framebuffer!==this.framebuffer)&&(l=Cesium.DrawCommand.shallowClone(f,l),l.framebuffer=this.framebuffer,l.shaderProgram=_L(e.context,f.shaderProgram),l.castShadows=!1,l.receiveShadows=!1,Cesium.defined(h)||(h={command:l,originalShaderProgram:f.shaderProgram},f.derivedCommands.pointCloudProcessor=h),h.originalShaderProgram=f.shaderProgram),s[i]=l}let o=this._clearCommand,u=this._drawCommand;u.boundingVolume=n,s.push(u),s.push(o)};zo.prototype.isDestroyed=function(){return!1};zo.prototype.destroy=function(){return pL(this),Cesium.destroyObject(this)};var Gd=zo;function hn(e){e=Cesium.defaultValue(e,Cesium.defaultValue.EMPTY_OBJECT),this._url=void 0,this._basePath=void 0,this._root=void 0,this._asset=void 0,this._properties=void 0,this._geometricError=void 0,this._extensionsUsed=void 0,this._extensions=void 0,this._gltfUpAxis=void 0,this._cache=new Cesium.Cesium3DTilesetCache,this._processingQueue=[],this._selectedTiles=[],this._emptyTiles=[],this._requestedTiles=[],this._selectedTilesToStyle=[],this._loadTimestamp=void 0,this._timeSinceLoad=0,this._updatedVisibilityFrame=0,this._updatedModelMatrixFrame=0,this._modelMatrixChanged=!1,this._previousModelMatrix=void 0,this._extras=void 0,this._credits=void 0,this._imagesSourceBuf=void 0,this._useCulling=Cesium.defaultValue(e.useCulling,!0),this._cullWithChildrenBounds=Cesium.defaultValue(e.cullWithChildrenBounds,!0),this._allTilesAdditive=!0,this._tilesetFlat=Cesium.defaultValue(e.tilesetFlat,void 0),this._hasMixedContent=!1,this._stencilClearCommand=void 0,this._backfaceCommands=new Cesium.ManagedArray,this._maximumScreenSpaceError=Cesium.defaultValue(e.maximumScreenSpaceError,16),this._maximumMemoryUsage=Cesium.defaultValue(e.maximumMemoryUsage,512),this._useStencilProcess=Cesium.defaultValue(e.useStencilProcess,!1),this._styleEngine=new Cesium.Cesium3DTileStyleEngine,this._modelMatrix=Cesium.defined(e.modelMatrix)?Cesium.Matrix4.clone(e.modelMatrix):Cesium.Matrix4.clone(Cesium.Matrix4.IDENTITY),this._statistics=new Cesium.Cesium3DTilesetStatistics,this._statisticsLast=new Cesium.Cesium3DTilesetStatistics,this._statisticsPerPass=new Array(ha.NUMBER_OF_PASSES);for(var t=0;t<ha.NUMBER_OF_PASSES;++t)this._statisticsPerPass[t]=new Cesium.Cesium3DTilesetStatistics;this._requestedTilesInFlight=[],this._maximumPriority={foveatedFactor:-Number.MAX_VALUE,depth:-Number.MAX_VALUE,distance:-Number.MAX_VALUE,reverseScreenSpaceError:-Number.MAX_VALUE},this._minimumPriority={foveatedFactor:Number.MAX_VALUE,depth:Number.MAX_VALUE,distance:Number.MAX_VALUE,reverseScreenSpaceError:Number.MAX_VALUE},this._heatmap=new Cesium.Cesium3DTilesetHeatmap(e.debugHeatmapTilePropertyName),this.cullRequestsWhileMoving=Cesium.defaultValue(e.cullRequestsWhileMoving,!0),this._cullRequestsWhileMoving=!1,this.cullRequestsWhileMovingMultiplier=Cesium.defaultValue(e.cullRequestsWhileMovingMultiplier,60),this.progressiveResolutionHeightFraction=Cesium.Math.clamp(Cesium.defaultValue(e.progressiveResolutionHeightFraction,.3),0,.5),this.preferLeaves=Cesium.defaultValue(e.preferLeaves,!1),this._tilesLoaded=!1,this._initialTilesLoaded=!1,this._tileDebugLabels=void 0,this._readyPromise=Ne.defer(),this._classificationType=e.classificationType,this._ellipsoid=Cesium.defaultValue(e.ellipsoid,Cesium.Ellipsoid.WGS84),this._initialClippingPlanesOriginMatrix=Cesium.Matrix4.IDENTITY,this._clippingPlanesOriginMatrix=void 0,this._clippingPlanesOriginMatrixDirty=!0,this._geoErrorRatio=Cesium.defaultValue(e.geoErrorRatio,1),this.EVDataSetName=void 0,this._distance=Cesium.defaultValue(e.distance,void 0),this._height=Cesium.defaultValue(e.height,void 0),this.rollerRegion=new Cesium.Cartesian4(0,0,1,1),this._distanceLimit=Cesium.defaultValue(e.distanceLimit,void 0),this._maxHeight=Cesium.defaultValue(e.maxHeight,void 0),this._minHeight=Cesium.defaultValue(e.minHeight,void 0),this._airDataShowNameCount=Cesium.defaultValue(e.airDataShowNameCount,void 0),this._annotationLabel=e.annotationLabel,Cesium.defined(this._annotationLabel)||(this._annotationLabel={font:"30px sans-serif",fillColor:Cesium.Color.WHITE,outlineColor:Cesium.Color.RED,disableDepthTestDistance:Number.POSITIVE_INFINITY,outlineWidth:5,style:Cesium.LabelStyle.FILL_AND_OUTLINE}),this._airWidth=e.airWidth,this._material=e.material,this._disableDepthTestDistance=e.disableDepthTestDistance,this.gltfShader={},this._startListener=void 0,this._stopListener=void 0,this._timer=void 0,this._useElevation=Cesium.defaultValue(e.useElevation,!1);var r={elevationRamp:[0,.045,.1,.15,.37,.54,1],colorRamp:["rgba(0,0,0,1)","rgba(39,71,224,1)","rgba(211,59,125,1)","rgba(211,48,56,1)","rgba(255,151,66,1)","rgba(255,215,0,1)","rgba(255,255,255,1)"]};this._elevationMap=Cesium.defaultValue(e.elevationMap,r),this.reduceRequest=Cesium.defaultValue(e.reduceRequest,!0),this.enableUndergroundDataDistance=Cesium.defaultValue(e.enableUndergroundDataDistance,!1),this.undergroundDataDistance=void 0,this.enableUndergroundDataDistance&&(this.undergroundDataDistance=Cesium.defaultValue(e.undergroundDataDistance,300)),this.specular=Cesium.defaultValue(e.specular,.5),this.gradual=e.gradual,this.preloadWhenHidden=Cesium.defaultValue(e.preloadWhenHidden,!1),this.preloadFlightDestinations=Cesium.defaultValue(e.preloadFlightDestinations,!0),this._pass=void 0,this.dynamicScreenSpaceError=Cesium.defaultValue(e.dynamicScreenSpaceError,!1),this.foveatedScreenSpaceError=Cesium.defaultValue(e.foveatedScreenSpaceError,!0),this._foveatedConeSize=Cesium.defaultValue(e.foveatedConeSize,.1),this._foveatedMinimumScreenSpaceErrorRelaxation=Cesium.defaultValue(e.foveatedMinimumScreenSpaceErrorRelaxation,0),this.foveatedInterpolationCallback=Cesium.defaultValue(e.foveatedInterpolationCallback,Cesium.Math.lerp),this.foveatedTimeDelay=Cesium.defaultValue(e.foveatedTimeDelay,.2),this.dynamicScreenSpaceErrorDensity=.00278,this.dynamicScreenSpaceErrorFactor=4,this.dynamicScreenSpaceErrorHeightFalloff=.25,this._dynamicScreenSpaceErrorComputedDensity=0,this.shadows=Cesium.defaultValue(e.shadows,Cesium.ShadowMode.ENABLED),this.show=Cesium.defaultValue(e.show,!0),this.colorBlendMode=Cesium.Cesium3DTileColorBlendMode.REPLACE,this.colorBlendAmount=.5,this.pointCloudShading=new Cesium.PointCloudShading(e.pointCloudShading),this._pointCloudEyeDomeLighting=new Gd,this.loadProgress=new Cesium.Event,this.loadedTreeTables=new Cesium.Event,this.allTilesLoaded=new Cesium.Event,this.initialTilesLoaded=new Cesium.Event,this.tileLoad=new Cesium.Event,this.tileUnload=new Cesium.Event,this.tileFailed=new Cesium.Event,this.tileVisible=new Cesium.Event,this.skipLevelOfDetail=Cesium.defaultValue(e.skipLevelOfDetail,!0),this._skipLevelOfDetail=this.skipLevelOfDetail,this._disableSkipLevelOfDetail=!1,this.baseScreenSpaceError=Cesium.defaultValue(e.baseScreenSpaceError,1024),this.skipScreenSpaceErrorFactor=Cesium.defaultValue(e.skipScreenSpaceErrorFactor,16),this.skipLevels=Cesium.defaultValue(e.skipLevels,1),this.immediatelyLoadDesiredLevelOfDetail=Cesium.defaultValue(e.immediatelyLoadDesiredLevelOfDetail,!1),this.loadSiblings=Cesium.defaultValue(e.loadSiblings,!1),this._clippingPlanes=void 0,this.clippingPlanes=e.clippingPlanes,this._imageBasedLightingFactor=new Cesium.Cartesian2(1,1),Cesium.Cartesian2.clone(e.imageBasedLightingFactor,this._imageBasedLightingFactor),this.lightColor=e.lightColor,this.luminanceAtZenith=Cesium.defaultValue(e.luminanceAtZenith,.2),this.sphericalHarmonicCoefficients=e.sphericalHarmonicCoefficients,this.specularEnvironmentMaps=e.specularEnvironmentMaps,this.debugFreezeFrame=Cesium.defaultValue(e.debugFreezeFrame,!1),this.debugColorizeTiles=Cesium.defaultValue(e.debugColorizeTiles,!1),this.debugWireframe=Cesium.defaultValue(e.debugWireframe,!1),this.debugShowBoundingVolume=Cesium.defaultValue(e.debugShowBoundingVolume,!1),this.debugShowContentBoundingVolume=Cesium.defaultValue(e.debugShowContentBoundingVolume,!1),this.debugShowViewerRequestVolume=Cesium.defaultValue(e.debugShowViewerRequestVolume,!1),this._tileDebugLabels=void 0,this.debugPickedTileLabelOnly=!1,this.debugPickedTile=void 0,this.debugPickPosition=void 0,this.debugShowGeometricError=Cesium.defaultValue(e.debugShowGeometricError,!1),this.debugShowRenderingStatistics=Cesium.defaultValue(e.debugShowRenderingStatistics,!1),this.debugShowMemoryUsage=Cesium.defaultValue(e.debugShowMemoryUsage,!1),this.debugShowUrl=Cesium.defaultValue(e.debugShowUrl,!1),this.position=Cesium.defaultValue(e.position,void 0),this.headingPitchRoll=Cesium.defaultValue(e.headingPitchRoll,void 0),this.scale=Cesium.defaultValue(e.scale,void 0),this.useIndexedDBCache=Cesium.defaultValue(e.useIndexedDBCache,!1),this.sharedResources={treeTables:{},instancedPrograms:{},ktxs:{}},this.treeTableMaps=[],this.selectedTiles=void 0,this._customTag=e.customTag;var n=this,i;Ne.all([XL(e.imageUrl),e.url]).then(function(s){n._imagesSourceBuf=s[0];var a;return i=Cesium.Resource.createIfNeeded(s[1]),i._queryParameters.fileName&&(i._url+=i._queryParameters.fileName),n._credits=i.credits,i.extension==="json"?a=i.getBaseUri(!0):i.isDataUri&&(a=""),n._url=i.url,n._basePath=a,hn.loadJson(i)}).then(function(s){Cesium.defined(e.versionValue)&&e.versionValue>7e3&&(i.url=e.mongoUrl,n._url=i.url),n._root=n.loadTileset(i,s);var a=Cesium.defined(s.asset.gltfUpAxis)?Cesium.Axis.fromName(s.asset.gltfUpAxis):Cesium.Axis.Y,o=s.asset;n._asset=o,n._properties=s.properties,n._geometricError=s.geometricError,n._geometricError*=n._geoErrorRatio,n._extensionsUsed=s.extensionsUsed,n._extensions=s.extensions,n._gltfUpAxis=a,n._extras=s.extras,n.EVDataSetName=s.EVDataSetName,s.elevationRange&&(n.elevationMin=s.elevationRange[0],n.elevationMax=s.elevationRange[1]);var u=o.extras;if(Cesium.defined(u)&&Cesium.defined(u.cesium)&&Cesium.defined(u.cesium.credits)){var f=u.cesium.credits,l=n._credits;Cesium.defined(l)||(l=[],n._credits=l);for(var c=0;c<f.length;++c){var h=f[c];l.push(new Cesium.Credit(h.html,h.showOnScreen))}}var d=n._root.createBoundingVolume(s.root.boundingVolume,Cesium.Matrix4.IDENTITY),m=d.boundingSphere.center,g=n._ellipsoid.cartesianToCartographic(m);Cesium.defined(g)&&g.height>Cesium.ApproximateTerrainHeights._defaultMinTerrainHeight&&(n._initialClippingPlanesOriginMatrix=Cesium.Transforms.eastNorthUpToFixedFrame(m)),n._clippingPlanesOriginMatrix=Cesium.Matrix4.clone(n._initialClippingPlanesOriginMatrix),n._readyPromise.resolve(n)}).otherwise(function(s){n._readyPromise.reject(s)})}Object.defineProperties(hn.prototype,{isCesium3DTileset:{get:function(){return!0}},imagesSourceBuf:{get:function(){return this._imagesSourceBuf}},asset:{get:function(){return this._asset}},extensions:{get:function(){return this._extensions}},clippingPlanes:{get:function(){return this._clippingPlanes},set:function(e){Cesium.ClippingPlaneCollection.setOwner(e,this,"_clippingPlanes")}},properties:{get:function(){return this._properties}},ready:{get:function(){return Cesium.defined(this._root)}},readyPromise:{get:function(){return this._readyPromise.promise}},tilesLoaded:{get:function(){return this._tilesLoaded}},url:{get:function(){return this._url}},basePath:{get:function(){return Cesium.deprecationWarning("Cesium3DTileset.basePath","Cesium3DTileset.basePath has been deprecated. All tiles are relative to the url of the tileset JSON file that contains them. Use the url property instead."),this._basePath}},style:{get:function(){return this._styleEngine.style},set:function(e){this._styleEngine.style=e}},maximumScreenSpaceError:{get:function(){return this._maximumScreenSpaceError},set:function(e){this._maximumScreenSpaceError=e}},maximumMemoryUsage:{get:function(){return this._maximumMemoryUsage},set:function(e){this._maximumMemoryUsage=e}},root:{get:function(){return this._root}},boundingSphere:{get:function(){return this._root.updateTransform(this._modelMatrix),this._root.boundingSphere}},modelMatrix:{get:function(){return this._modelMatrix},set:function(e){this._modelMatrix=Cesium.Matrix4.clone(e,this._modelMatrix)}},timeSinceLoad:{get:function(){return this._timeSinceLoad}},totalMemoryUsageInBytes:{get:function(){var e=this._statistics;return e.texturesByteLength+e.geometryByteLength+e.batchTableByteLength}},clippingPlanesOriginMatrix:{get:function(){return Cesium.defined(this._clippingPlanesOriginMatrix)?(this._clippingPlanesOriginMatrixDirty&&(Cesium.Matrix4.multiply(this.root.computedTransform,this._initialClippingPlanesOriginMatrix,this._clippingPlanesOriginMatrix),this._clippingPlanesOriginMatrixDirty=!1),this._clippingPlanesOriginMatrix):Cesium.Matrix4.IDENTITY}},styleEngine:{get:function(){return this._styleEngine}},statistics:{get:function(){return this._statistics}},classificationType:{get:function(){return this._classificationType}},ellipsoid:{get:function(){return this._ellipsoid}},foveatedConeSize:{get:function(){return this._foveatedConeSize},set:function(e){this._foveatedConeSize=e}},foveatedMinimumScreenSpaceErrorRelaxation:{get:function(){return this._foveatedMinimumScreenSpaceErrorRelaxation},set:function(e){this._foveatedMinimumScreenSpaceErrorRelaxation=e}},extras:{get:function(){return this._extras}},imageBasedLightingFactor:{get:function(){return this._imageBasedLightingFactor},set:function(e){Cesium.Cartesian2.clone(e,this._imageBasedLightingFactor)}},airWidth:{get:function(){return this._airWidth},set:function(e){this._airWidth=e}},treeTable:{get:function(){return Cesium.defined(this.sharedResources.treeTables)?this.sharedResources.treeTables:void 0}}});hn.loadJson=function(e){var t=Cesium.Resource.createIfNeeded(e);return t.fetchJson()};hn.prototype.makeStyleDirty=function(){this._styleEngine.makeDirty()};hn.prototype.loadTileset=function(e,t,r){var n=t.asset;if(!Cesium.defined(n))throw new Cesium.RuntimeError("Tileset must have an asset property.");if(n.version!=="0.0"&&n.version!=="1.0")throw new Cesium.RuntimeError("The tileset must be 3D Tiles version 0.0 or 1.0.");var i=this._statistics,s=n.tilesetVersion;Cesium.defined(s)&&(this._basePath+="?v="+s,e.setQueryParameters({v:s}));var a=new Xa(this,e,t.root,r);Cesium.defined(r)&&(r.children.push(a),a._depth=r._depth+1);var o=[];for(o.push(a),a.sharedResources=this.sharedResources;o.length>0;){var u=o.pop();++i.numberOfTilesTotal,this._allTilesAdditive=this._allTilesAdditive&&u.refine===Cesium.Cesium3DTileRefine.ADD;var f=u._header.children;if(Cesium.defined(f))for(var l=f.length,c=0;c<l;++c){var h=f[c],d=Cesium.createGuid();Cesium.defined(h.content)&&Cesium.defined(h.content.uri)?d=h.content.uri:Cesium.defined(h.content)&&Cesium.defined(h.content.url)&&(d=h.content.url),Cesium.defined(this.sharedResources.ktxs)||(this.sharedResources.ktxs={}),this.sharedResources.instancedPrograms[d]={},Cesium.defined(h.modeltree)&&(this.sharedResources.treeTables[h.modeltree.uri]={});var m=new Xa(this,e,h,u);u.children.push(m),m._depth=u._depth+1,o.push(m),m.sharedResources={treeTables:Cesium.defined(h.modeltree)?{name:h.modeltree.uri,shadredData:this.sharedResources.treeTables[h.modeltree.uri]}:{},instancedPrograms:{name:d,shadredData:this.sharedResources.instancedPrograms[d]},ktxs:this.sharedResources.ktxs}}this._cullWithChildrenBounds&&Cesium.Cesium3DTileOptimizations.checkChildrenWithinParent(u)}return a};var y_=new Cesium.Cartesian3,CL=new Cesium.Cartographic,yL=new Cesium.Matrix4,xL=new Cesium.Cartesian3,EL=new Cesium.Cartesian3,bL=new Cesium.Cartesian3;function wL(e,t){var r,n,i,s,a,o=t.camera,u=e._root,f=u.contentBoundingVolume;if(f instanceof Cesium.TileBoundingRegion)r=Cesium.Cartesian3.normalize(o.positionWC,y_),n=o.directionWC,i=o.positionCartographic.height,s=f.minimumHeight,a=f.maximumHeight;else{var l=Cesium.Matrix4.inverseTransformation(u.computedTransform,yL),c=t.mapProjection.ellipsoid,h=f.boundingVolume,d=Cesium.Matrix4.multiplyByPoint(l,h.center,xL);if(Cesium.Cartesian3.magnitude(d)>c.minimumRadius){var m=Cesium.Cartographic.fromCartesian(d,c,CL);r=Cesium.Cartesian3.normalize(o.positionWC,y_),n=o.directionWC,i=o.positionCartographic.height,s=0,a=m.height*2}else{var g=Cesium.Matrix4.multiplyByPoint(l,o.positionWC,EL);if(r=Cesium.Cartesian3.UNIT_Z,n=Cesium.Matrix4.multiplyByPointAsVector(l,o.directionWC,bL),n=Cesium.Cartesian3.normalize(n,n),i=g.z,f instanceof Cesium.TileOrientedBoundingBox){var p=u._header.boundingVolume.box[11];s=d.z-p,a=d.z+p}else if(f instanceof Cesium.TileBoundingSphere){var v=h.radius;s=d.z-v,a=d.z+v}}}var _=e.dynamicScreenSpaceErrorHeightFalloff,y=s+(a-s)*_,x=a,E=Cesium.Math.clamp((i-y)/(x-y),0,1),S=Math.abs(Cesium.Cartesian3.dot(n,r)),I=1-S;I=I*(1-E);var P=e.dynamicScreenSpaceErrorDensity;P*=I,e._dynamicScreenSpaceErrorComputedDensity=P}function SL(e,t){if(!t.hasEmptyContent){if(e.useIndexedDBCache){TL(e,t);return}var r=e._statistics,n=t.contentExpired,i=t.requestContent();if(!i){++r.numberOfAttemptedRequests;return}n&&(t.hasTilesetContent?Kd(e,t):(r.decrementLoadCounts(t.content),--r.numberOfTilesWithContentReady)),++r.numberOfPendingRequests,t.contentReadyToProcessPromise.then(w_(e,t)),t.contentReadyPromise.then(T_(e,t)).otherwise(S_(e,t))}}function TL(e,t){if(!t.hasEmptyContent){t.destroySubtreeFunction=Kd;var r=e._statistics,n=t.contentExpired,i=t.requestContentByIndexedDB();if(!i){++r.numberOfAttemptedRequests;return}n&&(t.hasTilesetContent?Kd(e,t):(r.decrementLoadCounts(t.content),--r.numberOfTilesWithContentReady)),++r.numberOfPendingRequests,t.contentReadyToProcessPromise.then(w_(e,t)),t.contentReadyPromise.then(T_(e,t)).otherwise(S_(e,t))}}function IL(e,t){return e._priority-t._priority}hn.prototype.postPassesUpdate=function(e){this.ready&&(LL(this,e),qL(this,e),this._cache.unloadTiles(this,L_))};hn.prototype.prePassesUpdate=function(e){if(this.ready){AL(this,e);var t=this._clippingPlanes;this._clippingPlanesOriginMatrixDirty=!0,Cesium.defined(t)&&t.enabled&&t.update(e),Cesium.defined(this._loadTimestamp)||(this._loadTimestamp=Cesium.JulianDate.clone(e.time)),this._timeSinceLoad=Math.max(Cesium.JulianDate.secondsDifference(e.time,this._loadTimestamp)*1e3,0),this._skipLevelOfDetail=this.skipLevelOfDetail&&!Cesium.defined(this._classificationType)&&!this._disableSkipLevelOfDetail&&!this._allTilesAdditive,this.dynamicScreenSpaceError&&wL(this,e),e.newFrame&&this._cache.reset()}};function LL(e,t){for(var r=e._requestedTilesInFlight,n=0,i=r.length,s=0;s<i;++s){var a=r[s],o=t.frameNumber-a._touchedFrame>=1;if(a._contentState!==Cesium.Cesium3DTileContentState.LOADING){++n;continue}else if(o){a._request.cancel(),++n;continue}n>0&&(r[s-n]=a)}r.length-=n}function PL(e,t){var r=e._requestedTiles,n=r.length;r.sort(IL);for(var i=0;i<n;++i)SL(e,r[i])}function w_(e,t){return function(){e._processingQueue.push(t),--e._statistics.numberOfPendingRequests,++e._statistics.numberOfTilesProcessing}}function S_(e,t){return function(r){var n=t._contentResource.url,i=Cesium.defined(r.message)?r.message:r.toString();e.tileFailed.numberOfListeners>0?e.tileFailed.raiseEvent({url:n,message:i}):(console.log("A 3D tile failed to load: "+n),console.log("Error: "+i))}}function T_(e,t){return function(){--e._statistics.numberOfTilesProcessing,t.hasTilesetContent||(e._statistics.incrementLoadCounts(t.content),++e._statistics.numberOfTilesWithContentReady,++e._statistics.numberOfLoadedTilesTotal,e._cache.add(t)),e.tileLoad.raiseEvent(t)}}function ML(e){for(var t=e._processingQueue,r=t.length,n=0,i=0;i<r;++i){var s=t[i];if(s._contentState!==Cesium.Cesium3DTileContentState.PROCESSING){++n;continue}n>0&&(t[i-n]=s)}t.length-=n}function AL(e,t){ML(e);for(var r=e._processingQueue,n=r.length,i=0;i<n;++i)r[i].process(e,t)}var Hl=new Cesium.Cartesian3,DL={maximumFractionDigits:3};function x_(e){var t=e/1048576;return t<1?t.toLocaleString(void 0,DL):Math.round(t).toLocaleString()}function qd(e){var t=e.boundingVolume.boundingVolume,r=t.halfAxes,n=t.radius,i=Cesium.Cartesian3.clone(t.center,Hl);if(Cesium.defined(r))i.x+=.75*(r[0]+r[3]+r[6]),i.y+=.75*(r[1]+r[4]+r[7]),i.z+=.75*(r[2]+r[5]+r[8]);else if(Cesium.defined(n)){var s=Cesium.Cartesian3.normalize(t.center,Hl);s=Cesium.Cartesian3.multiplyByScalar(s,.75*n,Hl),i=Cesium.Cartesian3.add(s,t.center,Hl)}return i}function Hd(e,t,r){var n="",i=0;if(t.debugShowGeometricError&&(n+=`
Geometric error: `+e.geometricError,i++),t.debugShowRenderingStatistics){n+=`
Commands: `+e.commandsLength,i++;var s=e.content.pointsLength;s>0&&(n+=`
Points: `+e.content.pointsLength,i++);var a=e.content.trianglesLength;a>0&&(n+=`
Triangles: `+e.content.trianglesLength,i++),n+=`
Features: `+e.content.featuresLength,i++}if(t.debugShowMemoryUsage&&(n+=`
Texture Memory: `+x_(e.content.texturesByteLength),n+=`
Geometry Memory: `+x_(e.content.geometryByteLength),i+=2),t.debugShowUrl&&(n+=`
Url: `+e._header.content.uri,i++),n.length!=0){var o={text:n.substring(1),position:r,font:19-i+"px sans-serif",showBackground:!0,disableDepthTestDistance:Number.POSITIVE_INFINITY};return t._tileDebugLabels.add(o)}}var RL=0,Wl=[],jd=0,OL=!0;function NL(e,t,r){if(Cesium.defined(t._airDataShowNameCount)&&t._airDataShowNameCount>0){Cesium.defined(e._labels)||(e._labels=new Cesium.LabelCollection);for(var n=0;n<e._labels.length;n++)e._labels.get(n).changed=!1,e._labels.get(n).show=!1;RL=0;var i=[];jd=0;for(var s=e._content._batchTable,a=s.featuresLength,n=0;n<a;n++){var o=s.getProperty(n,"id"),u=s.getProperty(n,"name");if(!Cesium.defined(u)){t._airDataShowNameCount=0;return}var f;Cesium.defined(o)&&(f={id:o});var l=s.getProperty(n,"Positions");if(!Cesium.defined(l))return;for(var c=l.Longitude,h=l.Latitude,d=l.Height,m=[],g=0;g<c.length;g++){var p=c[g],v=h[g],_=d[g];_<1e-7&&(_=0);var y=Cesium.Cartesian3.fromRadians(p,v,_);zL(y,r.cullingVolume)&&m.push(y)}m.length>0&&FL(t,e,m,u,i,r,f)}return}}function FL(e,t,r,n,i,s,a){var o=s.camera._scene,u=r.length,f=e._airDataShowNameCount,l=t._distanceToCamera;if(l>2e4){var c=parseInt(u/2);Wd(c,r,e,t,n,o,i,a)}else if(l<=2e4)if(u>=f*2)for(var h=parseInt(u/(f*2))+1,d=0;d<f;d++){var c=d+(d+1)*h;c=c>=u?c-u:c,Wd(c,r,e,t,n,o,i,a)}else{var c=parseInt(u/2);Wd(c,r,e,t,n,o,i,a)}}function E_(e,t){for(var r=e.length-1;r>=0;r--){var n=Cesium.BoundingRectangle.intersect(e[r],t);if(n===Cesium.Intersect.INTERSECTING)return!0}return!1}function BL(e,t){for(var r=0;r<e.length;r++)if(e[r].equals(t))return!0;return!1}function Wd(e,t,r,n,i,s,a,o){var u=t.length,f=t[e],l=1,c;if(OL){c=b_(r,i,f,s);var h=parseInt(u/10);for(h=h===0?1:h;E_(Wl,c)&&l<=h;)e=e+h>=u?e+h-u:e+h,f=t[e],c=b_(r,i,f,s),l++}else for(;BL(a,f)&&l<=u;)e=e+1>=u?e+1-u:e+1,f=t[e],l++;E_(Wl,c)||(VL(r,n,f,i,o),a.push(f),Wl.push(c))}var Yd=0,Xd=0;function b_(e,t,r,n){if(Yd===0){var i=e._annotationLabel.font,s=document.createElement("canvas");s.width=1,s.height=1,s.style.font=i;var a=s.getContext("2d",{willReadFrequently:!0});a.font=i,a.lineJoin="round",a.lineWidth=1;var o="imageSmoothingEnabled";a[o]=!1,a.textBaseline="bottom",s.style.visibility="hidden",document.body.appendChild(s);for(var u=0;u<t.length;u++){var f=t[u],l=Bd(a,f,!1,!0);Yd+=l.width,Xd=Math.max(Xd,l.height)}document.body.removeChild(s),s.style.visibility=""}var c=new Cesium.BoundingRectangle,h=new Cesium.Cartesian2;return Cesium.SceneTransforms.wgs84ToWindowCoordinates(n,r,h),c.x=h.x,c.y=h.y,c.width=Yd,c.height=Xd,c}function VL(e,t,r,n,i){if(t._labels.length>jd)for(var s=!0,a=0;a<t._labels.length;a++){var o=t._labels.get(a);if(o.text===n&&(s=!1,o.show=!0,!Cesium.defined(o.changed)||!o.changed)){o.position=r,o.changed=!0;break}}else{var u={text:n,position:r,properties:i};for(var f in e._annotationLabel)u[f]=e._annotationLabel[f];t._labels.add(u)}if(s){var u={text:n,position:r,properties:i};for(var f in e._annotationLabel)u[f]=e._annotationLabel[f];t._labels.add(u)}return jd++,r}function zL(e,t){for(var r=t.planes,n=!1,i=new Cesium.Plane(new Cesium.Cartesian3(1,0,0),0),s=0,a=r.length;s<a;++s){var o=Cesium.Plane.fromCartesian4(r[s],i),u=e,f=o.normal,l=Cesium.Cartesian3.dot(f,u)+o.distance;if(l<=0)return!1;n=!0}return n}function kL(e,t){var r,n,i=e._selectedTiles,s=i.length,a=e._emptyTiles,o=a.length;if(e._tileDebugLabels.removeAll(),e.debugPickedTileLabelOnly){if(Cesium.defined(e.debugPickedTile)){var u=Cesium.defined(e.debugPickPosition)?e.debugPickPosition:qd(e.debugPickedTile),f=Hd(e.debugPickedTile,e,u);f.pixelOffset=new Cesium.Cartesian2(15,-15)}}else{Wl=[];var l=t.camera;for(e._startListener===void 0&&(e._startListener=function(){var c=function(){for(r=0;r<i.length;++r)n=i[r],NL(n,e,t)};e.show&&(e._timer=setInterval(c,800)),e._stopListener&&l._moveEnd.removeEventListener(e._stopListener),e._stopListener=void 0},l._moveStart.addEventListener(e._startListener)),e._stopListener===void 0&&(e._stopListener=function(){Cesium.defined(e._timer)&&(clearInterval(e._timer),e._timer=void 0,e._startListener&&l._moveStart.removeEventListener(e._startListener),e._startListener=void 0)},l._moveEnd.addEventListener(e._stopListener)),r=0;r<s;++r)n=i[r],Hd(n,e,qd(n)),Cesium.defined(n._labels)&&n._labels.update(t);for(r=0;r<o;++r)n=a[r],n.hasTilesetContent&&Hd(n,e,qd(n))}e._tileDebugLabels.update(t)}function UL(e,t,r){e._styleEngine.applyStyle(e,r);var n=r.isRender,i=e._statistics,s=t.commandList,a=s.length,o=e._selectedTiles,o=e.selectedTiles;Cesium.defined(o)||(o=e._selectedTiles);var u=o.length,f=e._emptyTiles,l=f.length,c=e.tileVisible,h,d,m=e._skipLevelOfDetail&&e._hasMixedContent&&t.context.stencilBuffer&&u>0;e._backfaceCommands.length=0,m&&(Cesium.defined(e._stencilClearCommand)||(e._stencilClearCommand=new Cesium.ClearCommand({stencil:0,pass:Cesium.Pass.CESIUM_3D_TILE,renderState:Cesium.RenderState.fromCache({stencilMask:Cesium.StencilConstants.SKIP_LOD_MASK})})),s.push(e._stencilClearCommand));var g=s.length;for(h=0;h<u;++h)d=o[h],n&&c.raiseEvent(d),d.update(e,t,r),i.incrementSelectionCounts(d.content),++i.selected;for(h=0;h<l;++h)d=f[h],d.update(e,t,r);var p=s.length-g;if(e._backfaceCommands.trim(),m){var v=e._backfaceCommands.values,_=v.length;for(s.length+=_,h=p-1;h>=0;--h)s[g+_+h]=s[g+h];for(h=0;h<_;++h)s[g+h]=v[h]}p=s.length-a,i.numberOfCommands=p,n&&e.pointCloudShading.attenuation&&e.pointCloudShading.eyeDomeLighting&&p>0&&e._pointCloudEyeDomeLighting.update(t,a,e.pointCloudShading,e.boundingSphere),n&&(e.debugShowGeometricError||e.debugShowRenderingStatistics||e.debugShowMemoryUsage||e.debugShowUrl||Cesium.defined(e._airDataShowNameCount)?(Cesium.defined(e._tileDebugLabels)||(e._tileDebugLabels=new Cesium.LabelCollection),kL(e,t)):e._tileDebugLabels=e._tileDebugLabels&&e._tileDebugLabels.destroy())}var I_=[];function Kd(e,t){var r=t,n=I_;for(n.push(t);n.length>0;){t=n.pop();for(var i=t.children,s=i.length,a=0;a<s;++a)n.push(i[a]);t!==r&&(GL(e,t),--e._statistics.numberOfTilesTotal)}r.children=[]}function L_(e,t){e.tileUnload.raiseEvent(t),e._statistics.decrementLoadCounts(t.content),--e._statistics.numberOfTilesWithContentReady,t.unloadContent()}function GL(e,t){e._cache.unloadTile(e,t,L_),t.destroy()}hn.prototype.trimLoadedTiles=function(){this._cache.trim()};function qL(e,t){var r=e._statistics,n=e._statisticsLast,i=r.numberOfPendingRequests,s=r.numberOfTilesProcessing,a=n.numberOfPendingRequests,o=n.numberOfTilesProcessing;Cesium.Cesium3DTilesetStatistics.clone(r,n);var u=i!==a||s!==o;u&&t.afterRender.push(function(){e.loadProgress.raiseEvent(i,s)}),e._tilesLoaded=r.numberOfPendingRequests===0&&r.numberOfTilesProcessing===0&&r.numberOfAttemptedRequests===0,u&&e._tilesLoaded&&(t.afterRender.push(function(){e.allTilesLoaded.raiseEvent()}),e._initialTilesLoaded||(e._initialTilesLoaded=!0,t.afterRender.push(function(){e.initialTilesLoaded.raiseEvent()})))}function HL(e){e._heatmap.resetMinimumMaximum(),e._minimumPriority.depth=Number.MAX_VALUE,e._maximumPriority.depth=-Number.MAX_VALUE,e._minimumPriority.foveatedFactor=Number.MAX_VALUE,e._maximumPriority.foveatedFactor=-Number.MAX_VALUE,e._minimumPriority.distance=Number.MAX_VALUE,e._maximumPriority.distance=-Number.MAX_VALUE,e._minimumPriority.reverseScreenSpaceError=Number.MAX_VALUE,e._maximumPriority.reverseScreenSpaceError=-Number.MAX_VALUE}function WL(e,t){(t.frameNumber!==e._updatedModelMatrixFrame||!Cesium.defined(e._previousModelMatrix))&&(e._updatedModelMatrixFrame=t.frameNumber,e._modelMatrixChanged=!Cesium.Matrix4.equals(e.modelMatrix,e._previousModelMatrix),e._previousModelMatrix=Cesium.Matrix4.clone(e.modelMatrix,e._previousModelMatrix))}function YL(e,t,r,n){if(t.mode===Cesium.SceneMode.MORPHING||!e.ready)return!1;var i=e._statistics;i.clear();var s=n.isRender;++e._updatedVisibilityFrame,HL(e),WL(e,t),e._cullRequestsWhileMoving=e.cullRequestsWhileMoving&&!e._modelMatrixChanged;var a=n.traversal.selectTiles(e,t);if(n.requestTiles&&PL(e),t.passes.pick||(e.selectedTiles=e._selectedTiles.slice(0)),UL(e,t,n),Cesium.Cesium3DTilesetStatistics.clone(i,r),s){var o=e._credits;if(Cesium.defined(o)&&i.selected!==0)for(var u=o.length,f=0;f<u;++f)t.creditDisplay.addCredit(o[f])}return a}hn.prototype.update=function(e){this._tilesetFlat&&this._tilesetFlat.update(e,this),this.updateForPass(e,e.tilesetPassState)};hn.prototype.updateForPass=function(e,t){var r=t.pass;if(!(r===ha.PRELOAD&&(!this.preloadWhenHidden||this.show)||r===ha.PRELOAD_FLIGHT&&(!this.preloadFlightDestinations||!this.show&&!this.preloadWhenHidden)||r===ha.REQUEST_RENDER_MODE_DEFER_CHECK&&(!this._cullRequestsWhileMoving&&this.foveatedTimeDelay<=0||!this.show))){var n=e.commandList,i=e.camera,s=e.cullingVolume;t.ready=!1;var a=ha.getPassOptions(r),o=a.ignoreCommands,u=Cesium.defaultValue(t.commandList,n),f=u.length;e.commandList=u,e.camera=Cesium.defaultValue(t.camera,i),e.cullingVolume=Cesium.defaultValue(t.cullingVolume,s);var l=this._statisticsPerPass[r];(this.show||o)&&(this._pass=r,t.ready=YL(this,e,l,a)),o&&(u.length=f),e.commandList=n,e.camera=i,e.cullingVolume=s}};hn.prototype.hasExtension=function(e){return Cesium.defined(this._extensionsUsed)?this._extensionsUsed.indexOf(e)>-1:!1};hn.prototype.isDestroyed=function(){return!1};hn.prototype.destroy=function(){if(this._tileDebugLabels=this._tileDebugLabels&&this._tileDebugLabels.destroy(),this._clippingPlanes=this._clippingPlanes&&this._clippingPlanes.destroy(),Cesium.defined(this._root)){var e=I_;for(e.push(this._root);e.length>0;){var t=e.pop();t.destroy();for(var r=t.children,n=r.length,i=0;i<n;++i)e.push(r[i])}}return this.treeTableMaps=[],this.sharedResources=void 0,this.gltfShader=void 0,this._root=void 0,Cesium.destroyObject(this)};hn.prototype.addNode_ev=function(e,t){if(e&&e.children.length==0){var r=Cesium.Resource.createIfNeeded(this._url);if(Cesium.defined(t)&&t.length>0)for(var n=0;n<t.length;++n){var i=t[n],s=!1;Cesium.defined(i.boundingVolume)||(i.boundingVolume={},i.boundingVolume.sphere=[0,0,0,0],s=!0);var a=new Xa(this,r,i,e);s&&(a._boundingVolume=e._boundingVolume),!Cesium.defined(a._header.EVID)&&Cesium.defined(e._header.EVID)&&(a._header.EVID=e._header.EVID),e.children.push(a),a._depth=e._depth+1,++this._statistics.numberOfTilesTotal}this._cullWithChildrenBounds&&Cesium.Cesium3DTileOptimizations.checkChildrenWithinParent(e)}};hn.prototype.tramsformTreeTableMap=function(e){try{var t=!0;for(var r in this.sharedResources.treeTables)Cesium.defined(this.sharedResources.treeTables[r].elementName)||(t=!1);t&&this.loadedTreeTables.raiseEvent(this.sharedResources.treeTables);var n=new Cesium.AssociativeArray,i=e,s=new Cesium.ManagedArray;for(s.push(i);s.length>0;){var a=s.pop();if(n.get(a.elementName)?n.get(a.elementName).push(a.id):n.set(a.elementName,[a.id]),Cesium.defined(a.children))for(var o=0;o<a.children.length;++o){var u=a.children[o];s.push(u)}}this.treeTableMaps.push(n)}catch(f){return f}};function XL(e){return Cesium.defined(e)?Cesium.Resource.createIfNeeded(e).fetchImage({flipY:!1,preferImageBitmap:!0,preferBlob:!0}).then(function(n){return new Promise((s,a)=>{let o=new FileReader;o.onload=function(){s(new Uint8Array(this.result))},o.onerror=function(u){console.log(u),a(u)},o.readAsArrayBuffer(n.blob)})}).then(function(n){return n}):void 0}var Qd=hn;var Zd=class{add(t,r,n){if(typeof arguments[0]!="string")for(let i in arguments[0])this.add(i,arguments[0][i],arguments[1]);else(Array.isArray(t)?t:[t]).forEach(function(i){this[i]=this[i]||[],r&&this[i][n?"unshift":"push"](r)},this)}run(t,r){this[t]=this[t]||[],this[t].forEach(function(n){n.call(r&&r.context?r.context:r,r)})}},Jd=class{constructor(t){this.jsep=t,this.registered={}}register(...t){t.forEach(r=>{if(typeof r!="object"||!r.name||!r.init)throw new Error("Invalid JSEP plugin format");this.registered[r.name]||(r.init(this.jsep),this.registered[r.name]=r)})}},G=class{static get version(){return"1.3.8"}static toString(){return"JavaScript Expression Parser (JSEP) v"+G.version}static addUnaryOp(t){return G.max_unop_len=Math.max(t.length,G.max_unop_len),G.unary_ops[t]=1,G}static addBinaryOp(t,r,n){return G.max_binop_len=Math.max(t.length,G.max_binop_len),G.binary_ops[t]=r,n?G.right_associative.add(t):G.right_associative.delete(t),G}static addIdentifierChar(t){return G.additional_identifier_chars.add(t),G}static addLiteral(t,r){return G.literals[t]=r,G}static removeUnaryOp(t){return delete G.unary_ops[t],t.length===G.max_unop_len&&(G.max_unop_len=G.getMaxKeyLen(G.unary_ops)),G}static removeAllUnaryOps(){return G.unary_ops={},G.max_unop_len=0,G}static removeIdentifierChar(t){return G.additional_identifier_chars.delete(t),G}static removeBinaryOp(t){return delete G.binary_ops[t],t.length===G.max_binop_len&&(G.max_binop_len=G.getMaxKeyLen(G.binary_ops)),G.right_associative.delete(t),G}static removeAllBinaryOps(){return G.binary_ops={},G.max_binop_len=0,G}static removeLiteral(t){return delete G.literals[t],G}static removeAllLiterals(){return G.literals={},G}get char(){return this.expr.charAt(this.index)}get code(){return this.expr.charCodeAt(this.index)}constructor(t){this.expr=t,this.index=0}static parse(t){return new G(t).parse()}static getMaxKeyLen(t){return Math.max(0,...Object.keys(t).map(r=>r.length))}static isDecimalDigit(t){return t>=48&&t<=57}static binaryPrecedence(t){return G.binary_ops[t]||0}static isIdentifierStart(t){return t>=65&&t<=90||t>=97&&t<=122||t>=128&&!G.binary_ops[String.fromCharCode(t)]||G.additional_identifier_chars.has(String.fromCharCode(t))}static isIdentifierPart(t){return G.isIdentifierStart(t)||G.isDecimalDigit(t)}throwError(t){let r=new Error(t+" at character "+this.index);throw r.index=this.index,r.description=t,r}runHook(t,r){if(G.hooks[t]){let n={context:this,node:r};return G.hooks.run(t,n),n.node}return r}searchHook(t){if(G.hooks[t]){let r={context:this};return G.hooks[t].find(function(n){return n.call(r.context,r),r.node}),r.node}}gobbleSpaces(){let t=this.code;for(;t===G.SPACE_CODE||t===G.TAB_CODE||t===G.LF_CODE||t===G.CR_CODE;)t=this.expr.charCodeAt(++this.index);this.runHook("gobble-spaces")}parse(){this.runHook("before-all");let t=this.gobbleExpressions(),r=t.length===1?t[0]:{type:G.COMPOUND,body:t};return this.runHook("after-all",r)}gobbleExpressions(t){let r=[],n,i;for(;this.index<this.expr.length;)if(n=this.code,n===G.SEMCOL_CODE||n===G.COMMA_CODE)this.index++;else if(i=this.gobbleExpression())r.push(i);else if(this.index<this.expr.length){if(n===t)break;this.throwError('Unexpected "'+this.char+'"')}return r}gobbleExpression(){let t=this.searchHook("gobble-expression")||this.gobbleBinaryExpression();return this.gobbleSpaces(),this.runHook("after-expression",t)}gobbleBinaryOp(){this.gobbleSpaces();let t=this.expr.substr(this.index,G.max_binop_len),r=t.length;for(;r>0;){if(G.binary_ops.hasOwnProperty(t)&&(!G.isIdentifierStart(this.code)||this.index+t.length<this.expr.length&&!G.isIdentifierPart(this.expr.charCodeAt(this.index+t.length))))return this.index+=r,t;t=t.substr(0,--r)}return!1}gobbleBinaryExpression(){let t,r,n,i,s,a,o,u,f;if(a=this.gobbleToken(),!a||(r=this.gobbleBinaryOp(),!r))return a;for(s={value:r,prec:G.binaryPrecedence(r),right_a:G.right_associative.has(r)},o=this.gobbleToken(),o||this.throwError("Expected expression after "+r),i=[a,s,o];r=this.gobbleBinaryOp();){if(n=G.binaryPrecedence(r),n===0){this.index-=r.length;break}s={value:r,prec:n,right_a:G.right_associative.has(r)},f=r;let l=c=>s.right_a&&c.right_a?n>c.prec:n<=c.prec;for(;i.length>2&&l(i[i.length-2]);)o=i.pop(),r=i.pop().value,a=i.pop(),t={type:G.BINARY_EXP,operator:r,left:a,right:o},i.push(t);t=this.gobbleToken(),t||this.throwError("Expected expression after "+f),i.push(s,t)}for(u=i.length-1,t=i[u];u>1;)t={type:G.BINARY_EXP,operator:i[u-1].value,left:i[u-2],right:t},u-=2;return t}gobbleToken(){let t,r,n,i;if(this.gobbleSpaces(),i=this.searchHook("gobble-token"),i)return this.runHook("after-token",i);if(t=this.code,G.isDecimalDigit(t)||t===G.PERIOD_CODE)return this.gobbleNumericLiteral();if(t===G.SQUOTE_CODE||t===G.DQUOTE_CODE)i=this.gobbleStringLiteral();else if(t===G.OBRACK_CODE)i=this.gobbleArray();else{for(r=this.expr.substr(this.index,G.max_unop_len),n=r.length;n>0;){if(G.unary_ops.hasOwnProperty(r)&&(!G.isIdentifierStart(this.code)||this.index+r.length<this.expr.length&&!G.isIdentifierPart(this.expr.charCodeAt(this.index+r.length)))){this.index+=n;let s=this.gobbleToken();return s||this.throwError("missing unaryOp argument"),this.runHook("after-token",{type:G.UNARY_EXP,operator:r,argument:s,prefix:!0})}r=r.substr(0,--n)}G.isIdentifierStart(t)?(i=this.gobbleIdentifier(),G.literals.hasOwnProperty(i.name)?i={type:G.LITERAL,value:G.literals[i.name],raw:i.name}:i.name===G.this_str&&(i={type:G.THIS_EXP})):t===G.OPAREN_CODE&&(i=this.gobbleGroup())}return i?(i=this.gobbleTokenProperty(i),this.runHook("after-token",i)):this.runHook("after-token",!1)}gobbleTokenProperty(t){this.gobbleSpaces();let r=this.code;for(;r===G.PERIOD_CODE||r===G.OBRACK_CODE||r===G.OPAREN_CODE||r===G.QUMARK_CODE;){let n;if(r===G.QUMARK_CODE){if(this.expr.charCodeAt(this.index+1)!==G.PERIOD_CODE)break;n=!0,this.index+=2,this.gobbleSpaces(),r=this.code}this.index++,r===G.OBRACK_CODE?(t={type:G.MEMBER_EXP,computed:!0,object:t,property:this.gobbleExpression()},this.gobbleSpaces(),r=this.code,r!==G.CBRACK_CODE&&this.throwError("Unclosed ["),this.index++):r===G.OPAREN_CODE?t={type:G.CALL_EXP,arguments:this.gobbleArguments(G.CPAREN_CODE),callee:t}:(r===G.PERIOD_CODE||n)&&(n&&this.index--,this.gobbleSpaces(),t={type:G.MEMBER_EXP,computed:!1,object:t,property:this.gobbleIdentifier()}),n&&(t.optional=!0),this.gobbleSpaces(),r=this.code}return t}gobbleNumericLiteral(){let t="",r,n;for(;G.isDecimalDigit(this.code);)t+=this.expr.charAt(this.index++);if(this.code===G.PERIOD_CODE)for(t+=this.expr.charAt(this.index++);G.isDecimalDigit(this.code);)t+=this.expr.charAt(this.index++);if(r=this.char,r==="e"||r==="E"){for(t+=this.expr.charAt(this.index++),r=this.char,(r==="+"||r==="-")&&(t+=this.expr.charAt(this.index++));G.isDecimalDigit(this.code);)t+=this.expr.charAt(this.index++);G.isDecimalDigit(this.expr.charCodeAt(this.index-1))||this.throwError("Expected exponent ("+t+this.char+")")}return n=this.code,G.isIdentifierStart(n)?this.throwError("Variable names cannot start with a number ("+t+this.char+")"):(n===G.PERIOD_CODE||t.length===1&&t.charCodeAt(0)===G.PERIOD_CODE)&&this.throwError("Unexpected period"),{type:G.LITERAL,value:parseFloat(t),raw:t}}gobbleStringLiteral(){let t="",r=this.index,n=this.expr.charAt(this.index++),i=!1;for(;this.index<this.expr.length;){let s=this.expr.charAt(this.index++);if(s===n){i=!0;break}else if(s==="\\")switch(s=this.expr.charAt(this.index++),s){case"n":t+=`
`;break;case"r":t+="\r";break;case"t":t+="	";break;case"b":t+="\b";break;case"f":t+="\f";break;case"v":t+="\v";break;default:t+=s}else t+=s}return i||this.throwError('Unclosed quote after "'+t+'"'),{type:G.LITERAL,value:t,raw:this.expr.substring(r,this.index)}}gobbleIdentifier(){let t=this.code,r=this.index;for(G.isIdentifierStart(t)?this.index++:this.throwError("Unexpected "+this.char);this.index<this.expr.length&&(t=this.code,G.isIdentifierPart(t));)this.index++;return{type:G.IDENTIFIER,name:this.expr.slice(r,this.index)}}gobbleArguments(t){let r=[],n=!1,i=0;for(;this.index<this.expr.length;){this.gobbleSpaces();let s=this.code;if(s===t){n=!0,this.index++,t===G.CPAREN_CODE&&i&&i>=r.length&&this.throwError("Unexpected token "+String.fromCharCode(t));break}else if(s===G.COMMA_CODE){if(this.index++,i++,i!==r.length){if(t===G.CPAREN_CODE)this.throwError("Unexpected token ,");else if(t===G.CBRACK_CODE)for(let a=r.length;a<i;a++)r.push(null)}}else if(r.length!==i&&i!==0)this.throwError("Expected comma");else{let a=this.gobbleExpression();(!a||a.type===G.COMPOUND)&&this.throwError("Expected comma"),r.push(a)}}return n||this.throwError("Expected "+String.fromCharCode(t)),r}gobbleGroup(){this.index++;let t=this.gobbleExpressions(G.CPAREN_CODE);if(this.code===G.CPAREN_CODE)return this.index++,t.length===1?t[0]:t.length?{type:G.SEQUENCE_EXP,expressions:t}:!1;this.throwError("Unclosed (")}gobbleArray(){return this.index++,{type:G.ARRAY_EXP,elements:this.gobbleArguments(G.CBRACK_CODE)}}},jL=new Zd;Object.assign(G,{hooks:jL,plugins:new Jd(G),COMPOUND:"Compound",SEQUENCE_EXP:"SequenceExpression",IDENTIFIER:"Identifier",MEMBER_EXP:"MemberExpression",LITERAL:"Literal",THIS_EXP:"ThisExpression",CALL_EXP:"CallExpression",UNARY_EXP:"UnaryExpression",BINARY_EXP:"BinaryExpression",ARRAY_EXP:"ArrayExpression",TAB_CODE:9,LF_CODE:10,CR_CODE:13,SPACE_CODE:32,PERIOD_CODE:46,COMMA_CODE:44,SQUOTE_CODE:39,DQUOTE_CODE:34,OPAREN_CODE:40,CPAREN_CODE:41,OBRACK_CODE:91,CBRACK_CODE:93,QUMARK_CODE:63,SEMCOL_CODE:59,COLON_CODE:58,unary_ops:{"-":1,"!":1,"~":1,"+":1},binary_ops:{"||":1,"&&":2,"|":3,"^":4,"&":5,"==":6,"!=":6,"===":6,"!==":6,"<":7,">":7,"<=":7,">=":7,"<<":8,">>":8,">>>":8,"+":9,"-":9,"*":10,"/":10,"%":10},right_associative:new Set,additional_identifier_chars:new Set(["$","_"]),literals:{true:!0,false:!1,null:null},this_str:"this"});G.max_unop_len=G.getMaxKeyLen(G.unary_ops);G.max_binop_len=G.getMaxKeyLen(G.binary_ops);var da=e=>new G(e).parse(),KL=Object.getOwnPropertyNames(G);KL.forEach(e=>{da[e]===void 0&&e!=="prototype"&&(da[e]=G[e])});da.Jsep=G;var QL="ConditionalExpression",ZL={name:"ternary",init(e){e.hooks.add("after-expression",function(r){if(r.node&&this.code===e.QUMARK_CODE){this.index++;let n=r.node,i=this.gobbleExpression();if(i||this.throwError("Expected expression"),this.gobbleSpaces(),this.code===e.COLON_CODE){this.index++;let s=this.gobbleExpression();if(s||this.throwError("Expected expression"),r.node={type:QL,test:n,consequent:i,alternate:s},n.operator&&e.binary_ops[n.operator]<=.9){let a=n;for(;a.right.operator&&e.binary_ops[a.right.operator]<=.9;)a=a.right;r.node.test=a.right,a.right=r.node,r.node=n}}else this.throwError("Expected :")}})}};da.plugins.register(ZL);function ko(e,t){this._expression=e,e=lP(e,t),e=hP(cP(e)),da.addBinaryOp("=~",0),da.addBinaryOp("!~",0);let r;try{r=da(e)}catch(n){throw new Cesium.RuntimeError(n)}this._runtimeAst=ht(this,r)}Object.defineProperties(ko.prototype,{expression:{get:function(){return this._expression}}});var _e={arrayIndex:0,arrayArray:[[]],cartesian2Index:0,cartesian3Index:0,cartesian4Index:0,cartesian2Array:[new Cesium.Cartesian2],cartesian3Array:[new Cesium.Cartesian3],cartesian4Array:[new Cesium.Cartesian4],reset:function(){this.arrayIndex=0,this.cartesian2Index=0,this.cartesian3Index=0,this.cartesian4Index=0},getArray:function(){this.arrayIndex>=this.arrayArray.length&&this.arrayArray.push([]);let e=this.arrayArray[this.arrayIndex++];return e.length=0,e},getCartesian2:function(){return this.cartesian2Index>=this.cartesian2Array.length&&this.cartesian2Array.push(new Cesium.Cartesian2),this.cartesian2Array[this.cartesian2Index++]},getCartesian3:function(){return this.cartesian3Index>=this.cartesian3Array.length&&this.cartesian3Array.push(new Cesium.Cartesian3),this.cartesian3Array[this.cartesian3Index++]},getCartesian4:function(){return this.cartesian4Index>=this.cartesian4Array.length&&this.cartesian4Array.push(new Cesium.Cartesian4),this.cartesian4Array[this.cartesian4Index++]}};ko.prototype.evaluate=function(e,t){_e.reset();let r=this._runtimeAst.evaluate(e);return t instanceof Cesium.Color&&r instanceof Cesium.Cartesian4?Cesium.Color.fromCartesian4(r,t):r instanceof Cesium.Cartesian2||r instanceof Cesium.Cartesian3||r instanceof Cesium.Cartesian4?r.clone(t):r};ko.prototype.evaluateColor=function(e,t){_e.reset();let r=this._runtimeAst.evaluate(e);return Cesium.Color.fromCartesian4(r,t)};ko.prototype.getShaderFunction=function(e,t,r,n){let i=this.getShaderExpression(t,r);return e.includes("(")&&e.includes(")")?i=`${n} ${e}{ 
    return ${i}; 
} 
`:i=`${n} ${e}() 
{ 
    return ${i}; 
} 
`,i};ko.prototype.getShaderExpression=function(e,t){return this._runtimeAst.getShaderExpression(e,t)};var JL=["!","-","+"],P_=["+","-","*","/","%","===","!==",">",">=","<","<=","&&","||","!~","=~"],M_=/\${(.*?)}/g,$L=/\\/g,eP="@#%",tP=/@#%/g,jl=new Cesium.Color,nf={abs:Lr(Math.abs),sqrt:Lr(Math.sqrt),cos:Lr(Math.cos),sin:Lr(Math.sin),tan:Lr(Math.tan),acos:Lr(Math.acos),asin:Lr(Math.asin),atan:Lr(Math.atan),radians:Lr(Cesium.Math.toRadians),degrees:Lr(Cesium.Math.toDegrees),sign:Lr(Cesium.Math.sign),floor:Lr(Math.floor),ceil:Lr(Math.ceil),round:Lr(Math.round),exp:Lr(Math.exp),exp2:Lr(nP),log:Lr(Math.log),log2:Lr(iP),fract:Lr(rP),length:sP,normalize:aP},Kl={atan2:Yl(Math.atan2,!1),pow:Yl(Math.pow,!1),min:Yl(Math.min,!0),max:Yl(Math.max,!0),distance:oP,dot:uP,cross:fP},tm={clamp:A_(Cesium.Math.clamp,!0),mix:A_(Cesium.Math.lerp,!0)};function rP(e){return e-Math.floor(e)}function nP(e){return Math.pow(2,e)}function iP(e){return Cesium.Math.log2(e)}function Lr(e){return function(t,r){if(typeof r=="number")return e(r);if(r instanceof Cesium.Cartesian2)return Cesium.Cartesian2.fromElements(e(r.x),e(r.y),_e.getCartesian2());if(r instanceof Cesium.Cartesian3)return Cesium.Cartesian3.fromElements(e(r.x),e(r.y),e(r.z),_e.getCartesian3());if(r instanceof Cesium.Cartesian4)return Cesium.Cartesian4.fromElements(e(r.x),e(r.y),e(r.z),e(r.w),_e.getCartesian4());throw new Cesium.RuntimeError(`Function "${t}" requires a vector or number argument. Argument is ${r}.`)}}function Yl(e,t){return function(r,n,i){if(t&&typeof i=="number"){if(typeof n=="number")return e(n,i);if(n instanceof Cesium.Cartesian2)return Cesium.Cartesian2.fromElements(e(n.x,i),e(n.y,i),_e.getCartesian2());if(n instanceof Cesium.Cartesian3)return Cesium.Cartesian3.fromElements(e(n.x,i),e(n.y,i),e(n.z,i),_e.getCartesian3());if(n instanceof Cesium.Cartesian4)return Cesium.Cartesian4.fromElements(e(n.x,i),e(n.y,i),e(n.z,i),e(n.w,i),_e.getCartesian4())}if(typeof n=="number"&&typeof i=="number")return e(n,i);if(n instanceof Cesium.Cartesian2&&i instanceof Cesium.Cartesian2)return Cesium.Cartesian2.fromElements(e(n.x,i.x),e(n.y,i.y),_e.getCartesian2());if(n instanceof Cesium.Cartesian3&&i instanceof Cesium.Cartesian3)return Cesium.Cartesian3.fromElements(e(n.x,i.x),e(n.y,i.y),e(n.z,i.z),_e.getCartesian3());if(n instanceof Cesium.Cartesian4&&i instanceof Cesium.Cartesian4)return Cesium.Cartesian4.fromElements(e(n.x,i.x),e(n.y,i.y),e(n.z,i.z),e(n.w,i.w),_e.getCartesian4());throw new Cesium.RuntimeError(`Function "${r}" requires vector or number arguments of matching types. Arguments are ${n} and ${i}.`)}}function A_(e,t){return function(r,n,i,s){if(t&&typeof s=="number"){if(typeof n=="number"&&typeof i=="number")return e(n,i,s);if(n instanceof Cesium.Cartesian2&&i instanceof Cesium.Cartesian2)return Cesium.Cartesian2.fromElements(e(n.x,i.x,s),e(n.y,i.y,s),_e.getCartesian2());if(n instanceof Cesium.Cartesian3&&i instanceof Cesium.Cartesian3)return Cesium.Cartesian3.fromElements(e(n.x,i.x,s),e(n.y,i.y,s),e(n.z,i.z,s),_e.getCartesian3());if(n instanceof Cesium.Cartesian4&&i instanceof Cesium.Cartesian4)return Cesium.Cartesian4.fromElements(e(n.x,i.x,s),e(n.y,i.y,s),e(n.z,i.z,s),e(n.w,i.w,s),_e.getCartesian4())}if(typeof n=="number"&&typeof i=="number"&&typeof s=="number")return e(n,i,s);if(n instanceof Cesium.Cartesian2&&i instanceof Cesium.Cartesian2&&s instanceof Cesium.Cartesian2)return Cesium.Cartesian2.fromElements(e(n.x,i.x,s.x),e(n.y,i.y,s.y),_e.getCartesian2());if(n instanceof Cesium.Cartesian3&&i instanceof Cesium.Cartesian3&&s instanceof Cesium.Cartesian3)return Cesium.Cartesian3.fromElements(e(n.x,i.x,s.x),e(n.y,i.y,s.y),e(n.z,i.z,s.z),_e.getCartesian3());if(n instanceof Cesium.Cartesian4&&i instanceof Cesium.Cartesian4&&s instanceof Cesium.Cartesian4)return Cesium.Cartesian4.fromElements(e(n.x,i.x,s.x),e(n.y,i.y,s.y),e(n.z,i.z,s.z),e(n.w,i.w,s.w),_e.getCartesian4());throw new Cesium.RuntimeError(`Function "${r}" requires vector or number arguments of matching types. Arguments are ${n}, ${i}, and ${s}.`)}}function sP(e,t){if(typeof t=="number")return Math.abs(t);if(t instanceof Cesium.Cartesian2)return Cesium.Cartesian2.magnitude(t);if(t instanceof Cesium.Cartesian3)return Cesium.Cartesian3.magnitude(t);if(t instanceof Cesium.Cartesian4)return Cesium.Cartesian4.magnitude(t);throw new Cesium.RuntimeError(`Function "${e}" requires a vector or number argument. Argument is ${t}.`)}function aP(e,t){if(typeof t=="number")return 1;if(t instanceof Cesium.Cartesian2)return Cesium.Cartesian2.normalize(t,_e.getCartesian2());if(t instanceof Cesium.Cartesian3)return Cesium.Cartesian3.normalize(t,_e.getCartesian3());if(t instanceof Cesium.Cartesian4)return Cesium.Cartesian4.normalize(t,_e.getCartesian4());throw new Cesium.RuntimeError(`Function "${e}" requires a vector or number argument. Argument is ${t}.`)}function oP(e,t,r){if(typeof t=="number"&&typeof r=="number")return Math.abs(t-r);if(t instanceof Cesium.Cartesian2&&r instanceof Cesium.Cartesian2)return Cesium.Cartesian2.distance(t,r);if(t instanceof Cesium.Cartesian3&&r instanceof Cesium.Cartesian3)return Cesium.Cartesian3.distance(t,r);if(t instanceof Cesium.Cartesian4&&r instanceof Cesium.Cartesian4)return Cesium.Cartesian4.distance(t,r);throw new Cesium.RuntimeError(`Function "${e}" requires vector or number arguments of matching types. Arguments are ${t} and ${r}.`)}function uP(e,t,r){if(typeof t=="number"&&typeof r=="number")return t*r;if(t instanceof Cesium.Cartesian2&&r instanceof Cesium.Cartesian2)return Cesium.Cartesian2.dot(t,r);if(t instanceof Cesium.Cartesian3&&r instanceof Cesium.Cartesian3)return Cesium.Cartesian3.dot(t,r);if(t instanceof Cesium.Cartesian4&&r instanceof Cesium.Cartesian4)return Cesium.Cartesian4.dot(t,r);throw new Cesium.RuntimeError(`Function "${e}" requires vector or number arguments of matching types. Arguments are ${t} and ${r}.`)}function fP(e,t,r){if(t instanceof Cesium.Cartesian3&&r instanceof Cesium.Cartesian3)return Cesium.Cartesian3.cross(t,r,_e.getCartesian3());throw new Cesium.RuntimeError(`Function "${e}" requires vec3 arguments. Arguments are ${t} and ${r}.`)}function Z(e,t,r,n,i){this._type=e,this._value=t,this._left=r,this._right=n,this._test=i,this.evaluate=void 0,EP(this)}function lP(e,t){if(!Cesium.defined(t))return e;for(let r in t)if(t.hasOwnProperty(r)){let n=new RegExp(`\\$\\{${r}\\}`,"g"),i=`(${t[r]})`;Cesium.defined(i)&&(e=e.replace(n,i))}return e}function cP(e){return e.replace($L,eP)}function em(e){return e.replace(tP,"\\")}function hP(e){let t=e,r="",n=t.indexOf("${");for(;n>=0;){let s=t.indexOf("'"),a=t.indexOf('"');var i;if(s>=0&&s<n)i=t.indexOf("'",s+1),r+=t.substr(0,i+1),t=t.substr(i+1),n=t.indexOf("${");else if(a>=0&&a<n)i=t.indexOf('"',a+1),r+=t.substr(0,i+1),t=t.substr(i+1),n=t.indexOf("${");else{r+=t.substr(0,n);let o=t.indexOf("}");if(o<0)throw new Cesium.RuntimeError("Unmatched {.");r+=`czm_${t.substr(n+2,o-(n+2))}`,t=t.substr(o+1),n=t.indexOf("${")}}return r+=t,r}function dP(e){let t=typeof e.value;if(e.value===null)return new Z(Cesium.ExpressionNodeType.LITERAL_NULL,null);if(t==="boolean")return new Z(Cesium.ExpressionNodeType.LITERAL_BOOLEAN,e.value);if(t==="number")return new Z(Cesium.ExpressionNodeType.LITERAL_NUMBER,e.value);if(t==="string")return e.value.indexOf("${")>=0?new Z(Cesium.ExpressionNodeType.VARIABLE_IN_STRING,e.value):new Z(Cesium.ExpressionNodeType.LITERAL_STRING,em(e.value))}function mP(e,t){let r=t.arguments,n=r.length,i,s,a,o;if(t.callee.type==="MemberExpression"){i=t.callee.property.name;let u=t.callee.object;if(i==="test"||i==="exec"){if(u.callee.name!=="regExp")throw new Cesium.RuntimeError(`${i} is not a function.`);return n===0?i==="test"?new Z(Cesium.ExpressionNodeType.LITERAL_BOOLEAN,!1):new Z(Cesium.ExpressionNodeType.LITERAL_NULL,null):(a=ht(e,u),o=ht(e,r[0]),new Z(Cesium.ExpressionNodeType.FUNCTION_CALL,i,a,o))}else if(i==="toString")return s=ht(e,u),new Z(Cesium.ExpressionNodeType.FUNCTION_CALL,i,s);throw new Cesium.RuntimeError(`Unexpected function call "${i}".`)}if(i=t.callee.name,i==="color"){if(n===0)return new Z(Cesium.ExpressionNodeType.LITERAL_COLOR,i);if(s=ht(e,r[0]),Cesium.defined(r[1])){let u=ht(e,r[1]);return new Z(Cesium.ExpressionNodeType.LITERAL_COLOR,i,[s,u])}return new Z(Cesium.ExpressionNodeType.LITERAL_COLOR,i,[s])}else if(i==="rgb"||i==="hsl"){if(n<3)throw new Cesium.RuntimeError(`${i} requires three arguments.`);return s=[ht(e,r[0]),ht(e,r[1]),ht(e,r[2])],new Z(Cesium.ExpressionNodeType.LITERAL_COLOR,i,s)}else if(i==="rgba"||i==="hsla"){if(n<4)throw new Cesium.RuntimeError(`${i} requires four arguments.`);return s=[ht(e,r[0]),ht(e,r[1]),ht(e,r[2]),ht(e,r[3])],new Z(Cesium.ExpressionNodeType.LITERAL_COLOR,i,s)}else if(i==="vec2"||i==="vec3"||i==="vec4"){s=new Array(n);for(let u=0;u<n;++u)s[u]=ht(e,r[u]);return new Z(Cesium.ExpressionNodeType.LITERAL_VECTOR,i,s)}else{if(i==="isNaN"||i==="isFinite")return n===0?i==="isNaN"?new Z(Cesium.ExpressionNodeType.LITERAL_BOOLEAN,!0):new Z(Cesium.ExpressionNodeType.LITERAL_BOOLEAN,!1):(s=ht(e,r[0]),new Z(Cesium.ExpressionNodeType.UNARY,i,s));if(i==="isExactClass"||i==="isClass"){if(n<1||n>1)throw new Cesium.RuntimeError(`${i} requires exactly one argument.`);return s=ht(e,r[0]),new Z(Cesium.ExpressionNodeType.UNARY,i,s)}else if(i==="getExactClassName"){if(n>0)throw new Cesium.RuntimeError(`${i} does not take any argument.`);return new Z(Cesium.ExpressionNodeType.UNARY,i)}else if(Cesium.defined(nf[i])){if(n!==1)throw new Cesium.RuntimeError(`${i} requires exactly one argument.`);return s=ht(e,r[0]),new Z(Cesium.ExpressionNodeType.UNARY,i,s)}else if(Cesium.defined(Kl[i])){if(n!==2)throw new Cesium.RuntimeError(`${i} requires exactly two arguments.`);return a=ht(e,r[0]),o=ht(e,r[1]),new Z(Cesium.ExpressionNodeType.BINARY,i,a,o)}else if(Cesium.defined(tm[i])){if(n!==3)throw new Cesium.RuntimeError(`${i} requires exactly three arguments.`);a=ht(e,r[0]),o=ht(e,r[1]);let u=ht(e,r[2]);return new Z(Cesium.ExpressionNodeType.TERNARY,i,a,o,u)}else{if(i==="Boolean")return n===0?new Z(Cesium.ExpressionNodeType.LITERAL_BOOLEAN,!1):(s=ht(e,r[0]),new Z(Cesium.ExpressionNodeType.UNARY,i,s));if(i==="Number")return n===0?new Z(Cesium.ExpressionNodeType.LITERAL_NUMBER,0):(s=ht(e,r[0]),new Z(Cesium.ExpressionNodeType.UNARY,i,s));if(i==="String")return n===0?new Z(Cesium.ExpressionNodeType.LITERAL_STRING,""):(s=ht(e,r[0]),new Z(Cesium.ExpressionNodeType.UNARY,i,s));if(i==="regExp")return pP(e,t)}}throw new Cesium.RuntimeError(`Unexpected function call "${i}".`)}function pP(e,t){let r=t.arguments;if(r.length===0)return new Z(Cesium.ExpressionNodeType.LITERAL_REGEX,new RegExp);let n=ht(e,r[0]),i;if(r.length>1){let s=ht(e,r[1]);if($d(n)&&$d(s)){try{i=new RegExp(em(String(n._value)),s._value)}catch(a){throw new Cesium.RuntimeError(a)}return new Z(Cesium.ExpressionNodeType.LITERAL_REGEX,i)}return new Z(Cesium.ExpressionNodeType.REGEX,n,s)}if($d(n)){try{i=new RegExp(em(String(n._value)))}catch(s){throw new Cesium.RuntimeError(s)}return new Z(Cesium.ExpressionNodeType.LITERAL_REGEX,i)}return new Z(Cesium.ExpressionNodeType.REGEX,n)}function gP(e){if(yP(e.name)){let t=xP(e.name);return t.substr(0,8)==="tiles3d_"?new Z(Cesium.ExpressionNodeType.BUILTIN_VARIABLE,t):new Z(Cesium.ExpressionNodeType.VARIABLE,t)}else{if(e.name==="NaN")return new Z(Cesium.ExpressionNodeType.LITERAL_NUMBER,NaN);if(e.name==="Infinity")return new Z(Cesium.ExpressionNodeType.LITERAL_NUMBER,1/0);if(e.name==="undefined")return new Z(Cesium.ExpressionNodeType.LITERAL_UNDEFINED,void 0)}throw new Cesium.RuntimeError(`${e.name} is not defined.`)}function vP(e){let t=e.property.name;if(t==="PI")return new Z(Cesium.ExpressionNodeType.LITERAL_NUMBER,Math.PI);if(t==="E")return new Z(Cesium.ExpressionNodeType.LITERAL_NUMBER,Math.E)}function _P(e){if(e.property.name==="POSITIVE_INFINITY")return new Z(Cesium.ExpressionNodeType.LITERAL_NUMBER,Number.POSITIVE_INFINITY)}function CP(e,t){if(t.object.name==="Math")return vP(t);if(t.object.name==="Number")return _P(t);let r,n=ht(e,t.object);return t.computed?(r=ht(e,t.property),new Z(Cesium.ExpressionNodeType.MEMBER,"brackets",n,r)):(r=new Z(Cesium.ExpressionNodeType.LITERAL_STRING,t.property.name),new Z(Cesium.ExpressionNodeType.MEMBER,"dot",n,r))}function $d(e){return e._type>=Cesium.ExpressionNodeType.LITERAL_NULL}function yP(e){return e.substr(0,4)==="czm_"}function xP(e){return e.substr(4)}function ht(e,t){let r,n,i,s;if(t.type==="Literal")r=dP(t);else if(t.type==="CallExpression")r=mP(e,t);else if(t.type==="Identifier")r=gP(t);else if(t.type==="UnaryExpression"){n=t.operator;let a=ht(e,t.argument);if(JL.indexOf(n)>-1)r=new Z(Cesium.ExpressionNodeType.UNARY,n,a);else throw new Cesium.RuntimeError(`Unexpected operator "${n}".`)}else if(t.type==="BinaryExpression")if(n=t.operator,i=ht(e,t.left),s=ht(e,t.right),P_.indexOf(n)>-1)r=new Z(Cesium.ExpressionNodeType.BINARY,n,i,s);else throw new Cesium.RuntimeError(`Unexpected operator "${n}".`);else if(t.type==="LogicalExpression")n=t.operator,i=ht(e,t.left),s=ht(e,t.right),P_.indexOf(n)>-1&&(r=new Z(Cesium.ExpressionNodeType.BINARY,n,i,s));else if(t.type==="ConditionalExpression"){let a=ht(e,t.test);i=ht(e,t.consequent),s=ht(e,t.alternate),r=new Z(Cesium.ExpressionNodeType.CONDITIONAL,"?",i,s,a)}else if(t.type==="MemberExpression")r=CP(e,t);else if(t.type==="ArrayExpression"){let a=[];for(let o=0;o<t.elements.length;o++)a[o]=ht(e,t.elements[o]);r=new Z(Cesium.ExpressionNodeType.ARRAY,a)}else throw t.type==="Compound"?new Cesium.RuntimeError("Provide exactly one expression."):new Cesium.RuntimeError("Cannot parse expression.");return r}function EP(e){e._type===Cesium.ExpressionNodeType.CONDITIONAL?e.evaluate=e._evaluateConditional:e._type===Cesium.ExpressionNodeType.FUNCTION_CALL?e._value==="test"?e.evaluate=e._evaluateRegExpTest:e._value==="exec"?e.evaluate=e._evaluateRegExpExec:e._value==="toString"&&(e.evaluate=e._evaluateToString):e._type===Cesium.ExpressionNodeType.UNARY?e._value==="!"?e.evaluate=e._evaluateNot:e._value==="-"?e.evaluate=e._evaluateNegative:e._value==="+"?e.evaluate=e._evaluatePositive:e._value==="isNaN"?e.evaluate=e._evaluateNaN:e._value==="isFinite"?e.evaluate=e._evaluateIsFinite:e._value==="isExactClass"?e.evaluate=e._evaluateIsExactClass:e._value==="isClass"?e.evaluate=e._evaluateIsClass:e._value==="getExactClassName"?e.evaluate=e._evaluateGetExactClassName:e._value==="Boolean"?e.evaluate=e._evaluateBooleanConversion:e._value==="Number"?e.evaluate=e._evaluateNumberConversion:e._value==="String"?e.evaluate=e._evaluateStringConversion:Cesium.defined(nf[e._value])&&(e.evaluate=wP(e._value)):e._type===Cesium.ExpressionNodeType.BINARY?e._value==="+"?e.evaluate=e._evaluatePlus:e._value==="-"?e.evaluate=e._evaluateMinus:e._value==="*"?e.evaluate=e._evaluateTimes:e._value==="/"?e.evaluate=e._evaluateDivide:e._value==="%"?e.evaluate=e._evaluateMod:e._value==="==="?e.evaluate=e._evaluateEqualsStrict:e._value==="!=="?e.evaluate=e._evaluateNotEqualsStrict:e._value==="<"?e.evaluate=e._evaluateLessThan:e._value==="<="?e.evaluate=e._evaluateLessThanOrEquals:e._value===">"?e.evaluate=e._evaluateGreaterThan:e._value===">="?e.evaluate=e._evaluateGreaterThanOrEquals:e._value==="&&"?e.evaluate=e._evaluateAnd:e._value==="||"?e.evaluate=e._evaluateOr:e._value==="=~"?e.evaluate=e._evaluateRegExpMatch:e._value==="!~"?e.evaluate=e._evaluateRegExpNotMatch:Cesium.defined(Kl[e._value])&&(e.evaluate=SP(e._value)):e._type===Cesium.ExpressionNodeType.TERNARY?e.evaluate=TP(e._value):e._type===Cesium.ExpressionNodeType.MEMBER?e._value==="brackets"?e.evaluate=e._evaluateMemberBrackets:e.evaluate=e._evaluateMemberDot:e._type===Cesium.ExpressionNodeType.ARRAY?e.evaluate=e._evaluateArray:e._type===Cesium.ExpressionNodeType.VARIABLE?e.evaluate=e._evaluateVariable:e._type===Cesium.ExpressionNodeType.VARIABLE_IN_STRING?e.evaluate=e._evaluateVariableString:e._type===Cesium.ExpressionNodeType.LITERAL_COLOR?e.evaluate=e._evaluateLiteralColor:e._type===Cesium.ExpressionNodeType.LITERAL_VECTOR?e.evaluate=e._evaluateLiteralVector:e._type===Cesium.ExpressionNodeType.LITERAL_STRING?e.evaluate=e._evaluateLiteralString:e._type===Cesium.ExpressionNodeType.REGEX?e.evaluate=e._evaluateRegExp:e._type===Cesium.ExpressionNodeType.BUILTIN_VARIABLE?e._value==="tiles3d_tileset_time"&&(e.evaluate=bP):e.evaluate=e._evaluateLiteral}function bP(e){return Cesium.defined(e)?e.content.tileset.timeSinceLoad:0}function wP(e){let t=nf[e];return function(r){let n=this._left.evaluate(r);return t(e,n)}}function SP(e){let t=Kl[e];return function(r){let n=this._left.evaluate(r),i=this._right.evaluate(r);return t(e,n,i)}}function TP(e){let t=tm[e];return function(r){let n=this._left.evaluate(r),i=this._right.evaluate(r),s=this._test.evaluate(r);return t(e,n,i,s)}}function Ql(e,t){if(Cesium.defined(e))return e.getProperty(t)}Z.prototype._evaluateLiteral=function(){return this._value};Z.prototype._evaluateLiteralColor=function(e){let t=jl,r=this._left;if(this._value==="color")Cesium.defined(r)?r.length>1?(Cesium.Color.fromCssColorString(r[0].evaluate(e),t),t.alpha=r[1].evaluate(e)):Cesium.Color.fromCssColorString(r[0].evaluate(e),t):Cesium.Color.fromBytes(255,255,255,255,t);else if(this._value==="rgb")Cesium.Color.fromBytes(r[0].evaluate(e),r[1].evaluate(e),r[2].evaluate(e),255,t);else if(this._value==="rgba"){let n=r[3].evaluate(e)*255;Cesium.Color.fromBytes(r[0].evaluate(e),r[1].evaluate(e),r[2].evaluate(e),n,t)}else this._value==="hsl"?Cesium.Color.fromHsl(r[0].evaluate(e),r[1].evaluate(e),r[2].evaluate(e),1,t):this._value==="hsla"&&Cesium.Color.fromHsl(r[0].evaluate(e),r[1].evaluate(e),r[2].evaluate(e),r[3].evaluate(e),t);return Cesium.Cartesian4.fromColor(t,_e.getCartesian4())};Z.prototype._evaluateLiteralVector=function(e){let t=_e.getArray(),r=this._value,n=this._left,i=n.length;for(let o=0;o<i;++o){let u=n[o].evaluate(e);if(typeof u=="number")t.push(u);else if(u instanceof Cesium.Cartesian2)t.push(u.x,u.y);else if(u instanceof Cesium.Cartesian3)t.push(u.x,u.y,u.z);else if(u instanceof Cesium.Cartesian4)t.push(u.x,u.y,u.z,u.w);else throw new Cesium.RuntimeError(`${r} argument must be a vector or number. Argument is ${u}.`)}let s=t.length,a=parseInt(r.charAt(3));if(s===0)throw new Cesium.RuntimeError(`Invalid ${r} constructor. No valid arguments.`);if(s<a&&s>1)throw new Cesium.RuntimeError(`Invalid ${r} constructor. Not enough arguments.`);if(s>a&&i>1)throw new Cesium.RuntimeError(`Invalid ${r} constructor. Too many arguments.`);if(s===1){let o=t[0];t.push(o,o,o)}if(r==="vec2")return Cesium.Cartesian2.fromArray(t,0,_e.getCartesian2());if(r==="vec3")return Cesium.Cartesian3.fromArray(t,0,_e.getCartesian3());if(r==="vec4")return Cesium.Cartesian4.fromArray(t,0,_e.getCartesian4())};Z.prototype._evaluateLiteralString=function(){return this._value};Z.prototype._evaluateVariableString=function(e){let t=this._value,r=M_.exec(t);for(;r!==null;){let n=r[0],i=r[1],s=Ql(e,i);Cesium.defined(s)||(s=""),t=t.replace(n,s),r=M_.exec(t)}return t};Z.prototype._evaluateVariable=function(e){return Ql(e,this._value)};function F_(e){return e._value==="feature"}Z.prototype._evaluateMemberDot=function(e){if(F_(this._left))return Ql(e,this._right.evaluate(e));let t=this._left.evaluate(e);if(!Cesium.defined(t))return;let r=this._right.evaluate(e);if(t instanceof Cesium.Cartesian2||t instanceof Cesium.Cartesian3||t instanceof Cesium.Cartesian4){if(r==="r")return t.x;if(r==="g")return t.y;if(r==="b")return t.z;if(r==="a")return t.w}return t[r]};Z.prototype._evaluateMemberBrackets=function(e){if(F_(this._left))return Ql(e,this._right.evaluate(e));let t=this._left.evaluate(e);if(!Cesium.defined(t))return;let r=this._right.evaluate(e);if(t instanceof Cesium.Cartesian2||t instanceof Cesium.Cartesian3||t instanceof Cesium.Cartesian4){if(r===0||r==="r")return t.x;if(r===1||r==="g")return t.y;if(r===2||r==="b")return t.z;if(r===3||r==="a")return t.w}return t[r]};Z.prototype._evaluateArray=function(e){let t=[];for(let r=0;r<this._value.length;r++)t[r]=this._value[r].evaluate(e);return t};Z.prototype._evaluateNot=function(e){let t=this._left.evaluate(e);if(typeof t!="boolean")throw new Cesium.RuntimeError(`Operator "!" requires a boolean argument. Argument is ${t}.`);return!t};Z.prototype._evaluateNegative=function(e){let t=this._left.evaluate(e);if(t instanceof Cesium.Cartesian2)return Cesium.Cartesian2.negate(t,_e.getCartesian2());if(t instanceof Cesium.Cartesian3)return Cesium.Cartesian3.negate(t,_e.getCartesian3());if(t instanceof Cesium.Cartesian4)return Cesium.Cartesian4.negate(t,_e.getCartesian4());if(typeof t=="number")return-t;throw new Cesium.RuntimeError(`Operator "-" requires a vector or number argument. Argument is ${t}.`)};Z.prototype._evaluatePositive=function(e){let t=this._left.evaluate(e);if(!(t instanceof Cesium.Cartesian2||t instanceof Cesium.Cartesian3||t instanceof Cesium.Cartesian4||typeof t=="number"))throw new Cesium.RuntimeError(`Operator "+" requires a vector or number argument. Argument is ${t}.`);return t};Z.prototype._evaluateLessThan=function(e){let t=this._left.evaluate(e),r=this._right.evaluate(e);if(typeof t!="number"||typeof r!="number")throw new Cesium.RuntimeError(`Operator "<" requires number arguments. Arguments are ${t} and ${r}.`);return t<r};Z.prototype._evaluateLessThanOrEquals=function(e){let t=this._left.evaluate(e),r=this._right.evaluate(e);if(typeof t!="number"||typeof r!="number")throw new Cesium.RuntimeError(`Operator "<=" requires number arguments. Arguments are ${t} and ${r}.`);return t<=r};Z.prototype._evaluateGreaterThan=function(e){let t=this._left.evaluate(e),r=this._right.evaluate(e);if(typeof t!="number"||typeof r!="number")throw new Cesium.RuntimeError(`Operator ">" requires number arguments. Arguments are ${t} and ${r}.`);return t>r};Z.prototype._evaluateGreaterThanOrEquals=function(e){let t=this._left.evaluate(e),r=this._right.evaluate(e);if(typeof t!="number"&&typeof r!="number")throw new Cesium.RuntimeError(`Operator ">=" requires number arguments. Arguments are ${t} and ${r}.`);return t>=r};Z.prototype._evaluateOr=function(e){let t=this._left.evaluate(e);if(typeof t!="boolean")throw new Cesium.RuntimeError(`Operator "||" requires boolean arguments. First argument is ${t}.`);if(t)return!0;let r=this._right.evaluate(e);if(typeof r!="boolean")throw new Cesium.RuntimeError(`Operator "||" requires boolean arguments. Second argument is ${r}.`);return t||r};Z.prototype._evaluateAnd=function(e){let t=this._left.evaluate(e);if(typeof t!="boolean")throw new Cesium.RuntimeError(`Operator "&&" requires boolean arguments. First argument is ${t}.`);if(!t)return!1;let r=this._right.evaluate(e);if(typeof r!="boolean")throw new Cesium.RuntimeError(`Operator "&&" requires boolean arguments. Second argument is ${r}.`);return t&&r};Z.prototype._evaluatePlus=function(e){let t=this._left.evaluate(e),r=this._right.evaluate(e);if(r instanceof Cesium.Cartesian2&&t instanceof Cesium.Cartesian2)return Cesium.Cartesian2.add(t,r,_e.getCartesian2());if(r instanceof Cesium.Cartesian3&&t instanceof Cesium.Cartesian3)return Cesium.Cartesian3.add(t,r,_e.getCartesian3());if(r instanceof Cesium.Cartesian4&&t instanceof Cesium.Cartesian4)return Cesium.Cartesian4.add(t,r,_e.getCartesian4());if(typeof t=="string"||typeof r=="string")return t+r;if(typeof t=="number"&&typeof r=="number")return t+r;throw new Cesium.RuntimeError(`Operator "+" requires vector or number arguments of matching types, or at least one string argument. Arguments are ${t} and ${r}.`)};Z.prototype._evaluateMinus=function(e){let t=this._left.evaluate(e),r=this._right.evaluate(e);if(r instanceof Cesium.Cartesian2&&t instanceof Cesium.Cartesian2)return Cesium.Cartesian2.subtract(t,r,_e.getCartesian2());if(r instanceof Cesium.Cartesian3&&t instanceof Cesium.Cartesian3)return Cesium.Cartesian3.subtract(t,r,_e.getCartesian3());if(r instanceof Cesium.Cartesian4&&t instanceof Cesium.Cartesian4)return Cesium.Cartesian4.subtract(t,r,_e.getCartesian4());if(typeof t=="number"&&typeof r=="number")return t-r;throw new Cesium.RuntimeError(`Operator "-" requires vector or number arguments of matching types. Arguments are ${t} and ${r}.`)};Z.prototype._evaluateTimes=function(e){let t=this._left.evaluate(e),r=this._right.evaluate(e);if(r instanceof Cesium.Cartesian2&&t instanceof Cesium.Cartesian2)return Cesium.Cartesian2.multiplyComponents(t,r,_e.getCartesian2());if(r instanceof Cesium.Cartesian2&&typeof t=="number")return Cesium.Cartesian2.multiplyByScalar(r,t,_e.getCartesian2());if(t instanceof Cesium.Cartesian2&&typeof r=="number")return Cesium.Cartesian2.multiplyByScalar(t,r,_e.getCartesian2());if(r instanceof Cesium.Cartesian3&&t instanceof Cesium.Cartesian3)return Cesium.Cartesian3.multiplyComponents(t,r,_e.getCartesian3());if(r instanceof Cesium.Cartesian3&&typeof t=="number")return Cesium.Cartesian3.multiplyByScalar(r,t,_e.getCartesian3());if(t instanceof Cesium.Cartesian3&&typeof r=="number")return Cesium.Cartesian3.multiplyByScalar(t,r,_e.getCartesian3());if(r instanceof Cesium.Cartesian4&&t instanceof Cesium.Cartesian4)return Cesium.Cartesian4.multiplyComponents(t,r,_e.getCartesian4());if(r instanceof Cesium.Cartesian4&&typeof t=="number")return Cesium.Cartesian4.multiplyByScalar(r,t,_e.getCartesian4());if(t instanceof Cesium.Cartesian4&&typeof r=="number")return Cesium.Cartesian4.multiplyByScalar(t,r,_e.getCartesian4());if(typeof t=="number"&&typeof r=="number")return t*r;throw new Cesium.RuntimeError(`Operator "*" requires vector or number arguments. If both arguments are vectors they must be matching types. Arguments are ${t} and ${r}.`)};Z.prototype._evaluateDivide=function(e){let t=this._left.evaluate(e),r=this._right.evaluate(e);if(r instanceof Cesium.Cartesian2&&t instanceof Cesium.Cartesian2)return Cesium.Cartesian2.divideComponents(t,r,_e.getCartesian2());if(t instanceof Cesium.Cartesian2&&typeof r=="number")return Cesium.Cartesian2.divideByScalar(t,r,_e.getCartesian2());if(r instanceof Cesium.Cartesian3&&t instanceof Cesium.Cartesian3)return Cesium.Cartesian3.divideComponents(t,r,_e.getCartesian3());if(t instanceof Cesium.Cartesian3&&typeof r=="number")return Cesium.Cartesian3.divideByScalar(t,r,_e.getCartesian3());if(r instanceof Cesium.Cartesian4&&t instanceof Cesium.Cartesian4)return Cesium.Cartesian4.divideComponents(t,r,_e.getCartesian4());if(t instanceof Cesium.Cartesian4&&typeof r=="number")return Cesium.Cartesian4.divideByScalar(t,r,_e.getCartesian4());if(typeof t=="number"&&typeof r=="number")return t/r;throw new Cesium.RuntimeError(`Operator "/" requires vector or number arguments of matching types, or a number as the second argument. Arguments are ${t} and ${r}.`)};Z.prototype._evaluateMod=function(e){let t=this._left.evaluate(e),r=this._right.evaluate(e);if(r instanceof Cesium.Cartesian2&&t instanceof Cesium.Cartesian2)return Cesium.Cartesian2.fromElements(t.x%r.x,t.y%r.y,_e.getCartesian2());if(r instanceof Cesium.Cartesian3&&t instanceof Cesium.Cartesian3)return Cesium.Cartesian3.fromElements(t.x%r.x,t.y%r.y,t.z%r.z,_e.getCartesian3());if(r instanceof Cesium.Cartesian4&&t instanceof Cesium.Cartesian4)return Cesium.Cartesian4.fromElements(t.x%r.x,t.y%r.y,t.z%r.z,t.w%r.w,_e.getCartesian4());if(typeof t=="number"&&typeof r=="number")return t%r;throw new Cesium.RuntimeError(`Operator "%" requires vector or number arguments of matching types. Arguments are ${t} and ${r}.`)};Z.prototype._evaluateEqualsStrict=function(e){let t=this._left.evaluate(e),r=this._right.evaluate(e);return r instanceof Cesium.Cartesian2&&t instanceof Cesium.Cartesian2||r instanceof Cesium.Cartesian3&&t instanceof Cesium.Cartesian3||r instanceof Cesium.Cartesian4&&t instanceof Cesium.Cartesian4?t.equals(r):t===r};Z.prototype._evaluateNotEqualsStrict=function(e){let t=this._left.evaluate(e),r=this._right.evaluate(e);return r instanceof Cesium.Cartesian2&&t instanceof Cesium.Cartesian2||r instanceof Cesium.Cartesian3&&t instanceof Cesium.Cartesian3||r instanceof Cesium.Cartesian4&&t instanceof Cesium.Cartesian4?!t.equals(r):t!==r};Z.prototype._evaluateConditional=function(e){let t=this._test.evaluate(e);if(typeof t!="boolean")throw new Cesium.RuntimeError(`Conditional argument of conditional expression must be a boolean. Argument is ${t}.`);return t?this._left.evaluate(e):this._right.evaluate(e)};Z.prototype._evaluateNaN=function(e){return isNaN(this._left.evaluate(e))};Z.prototype._evaluateIsFinite=function(e){return isFinite(this._left.evaluate(e))};Z.prototype._evaluateIsExactClass=function(e){return Cesium.defined(e)?e.isExactClass(this._left.evaluate(e)):!1};Z.prototype._evaluateIsClass=function(e){return Cesium.defined(e)?e.isClass(this._left.evaluate(e)):!1};Z.prototype._evaluateGetExactClassName=function(e){if(Cesium.defined(e))return e.getExactClassName()};Z.prototype._evaluateBooleanConversion=function(e){return!!this._left.evaluate(e)};Z.prototype._evaluateNumberConversion=function(e){return Number(this._left.evaluate(e))};Z.prototype._evaluateStringConversion=function(e){return String(this._left.evaluate(e))};Z.prototype._evaluateRegExp=function(e){let t=this._value.evaluate(e),r="";Cesium.defined(this._left)&&(r=this._left.evaluate(e));let n;try{n=new RegExp(t,r)}catch(i){throw new Cesium.RuntimeError(i)}return n};Z.prototype._evaluateRegExpTest=function(e){let t=this._left.evaluate(e),r=this._right.evaluate(e);if(!(t instanceof RegExp&&typeof r=="string"))throw new Cesium.RuntimeError(`RegExp.test requires the first argument to be a RegExp and the second argument to be a string. Arguments are ${t} and ${r}.`);return t.test(r)};Z.prototype._evaluateRegExpMatch=function(e){let t=this._left.evaluate(e),r=this._right.evaluate(e);if(t instanceof RegExp&&typeof r=="string")return t.test(r);if(r instanceof RegExp&&typeof t=="string")return r.test(t);throw new Cesium.RuntimeError(`Operator "=~" requires one RegExp argument and one string argument. Arguments are ${t} and ${r}.`)};Z.prototype._evaluateRegExpNotMatch=function(e){let t=this._left.evaluate(e),r=this._right.evaluate(e);if(t instanceof RegExp&&typeof r=="string")return!t.test(r);if(r instanceof RegExp&&typeof t=="string")return!r.test(t);throw new Cesium.RuntimeError(`Operator "!~" requires one RegExp argument and one string argument. Arguments are ${t} and ${r}.`)};Z.prototype._evaluateRegExpExec=function(e){let t=this._left.evaluate(e),r=this._right.evaluate(e);if(!(t instanceof RegExp&&typeof r=="string"))throw new Cesium.RuntimeError(`RegExp.exec requires the first argument to be a RegExp and the second argument to be a string. Arguments are ${t} and ${r}.`);let n=t.exec(r);return Cesium.defined(n)?n[1]:null};Z.prototype._evaluateToString=function(e){let t=this._left.evaluate(e);if(t instanceof RegExp||t instanceof Cesium.Cartesian2||t instanceof Cesium.Cartesian3||t instanceof Cesium.Cartesian4)return String(t);throw new Cesium.RuntimeError(`Unexpected function call "${this._value}".`)};function D_(e){let t=e._left,r=t.length;for(let o=0;o<r;++o)if(t[o]._type!==Cesium.ExpressionNodeType.LITERAL_NUMBER)return;let n=t[0]._value,i=t[1]._value,s=t[2]._value,a=r===4?t[3]._value:1;return Cesium.Color.fromHsl(n,i,s,a,jl)}function R_(e){let t=e._left,r=t.length;for(let i=0;i<r;++i)if(t[i]._type!==Cesium.ExpressionNodeType.LITERAL_NUMBER)return;let n=jl;return n.red=t[0]._value/255,n.green=t[1]._value/255,n.blue=t[2]._value/255,n.alpha=r===4?t[3]._value:1,n}function ma(e){return e%1===0?e.toFixed(1):e.toString()}function IP(e){let t=ma(e.red),r=ma(e.green),n=ma(e.blue);return`vec3(${t}, ${r}, ${n})`}function Xl(e){let t=ma(e.red),r=ma(e.green),n=ma(e.blue),i=ma(e.alpha);return`vec4(${t}, ${r}, ${n}, ${i})`}function O_(e,t,r,n){let i=e.length,s=new Array(i);for(let a=0;a<i;++a)s[a]=e[a].getShaderExpression(t,r,n);return s}var N_="czm_infinity";Z.prototype.getShaderExpression=function(e,t,r){let n,i,s,a,o=this._type,u=this._value;switch(Cesium.defined(this._left)&&(Array.isArray(this._left)?i=O_(this._left,e,t,this):i=this._left.getShaderExpression(e,t,this)),Cesium.defined(this._right)&&(s=this._right.getShaderExpression(e,t,this)),Cesium.defined(this._test)&&(a=this._test.getShaderExpression(e,t,this)),Array.isArray(this._value)&&(u=O_(this._value,e,t,this)),o){case Cesium.ExpressionNodeType.VARIABLE:return e+u;case Cesium.ExpressionNodeType.UNARY:if(u==="Boolean")return`bool(${i})`;if(u==="Number")return`float(${i})`;if(u==="round")return`floor(${i} + 0.5)`;if(Cesium.defined(nf[u]))return`${u}(${i})`;if(u==="isNaN")return`(${i} != ${i})`;if(u==="isFinite")return`(abs(${i}) < czm_infinity)`;if(u==="String"||u==="isExactClass"||u==="isClass"||u==="getExactClassName")throw new Cesium.RuntimeError(`Error generating style shader: "${u}" is not supported.`);return Cesium.defined(nf[u])?`${u}(${i})`:u+i;case Cesium.ExpressionNodeType.BINARY:return u==="%"?`mod(${i}, ${s})`:u==="==="?`(${i} == ${s})`:u==="!=="?`(${i} != ${s})`:u==="atan2"?`atan(${i}, ${s})`:Cesium.defined(Kl[u])?`${u}(${i}, ${s})`:`(${i} ${u} ${s})`;case Cesium.ExpressionNodeType.TERNARY:if(Cesium.defined(tm[u]))return`${u}(${i}, ${s}, ${a})`;break;case Cesium.ExpressionNodeType.CONDITIONAL:return`(${a} ? ${i} : ${s})`;case Cesium.ExpressionNodeType.MEMBER:return s==="r"||s==="x"||s==="0.0"?`${i}[0]`:s==="g"||s==="y"||s==="1.0"?`${i}[1]`:s==="b"||s==="z"||s==="2.0"?`${i}[2]`:s==="a"||s==="w"||s==="3.0"?`${i}[3]`:`${i}[int(${s})]`;case Cesium.ExpressionNodeType.FUNCTION_CALL:throw new Cesium.RuntimeError(`Error generating style shader: "${u}" is not supported.`);case Cesium.ExpressionNodeType.ARRAY:if(u.length===4)return`vec4(${u[0]}, ${u[1]}, ${u[2]}, ${u[3]})`;if(u.length===3)return`vec3(${u[0]}, ${u[1]}, ${u[2]})`;if(u.length===2)return`vec2(${u[0]}, ${u[1]})`;throw new Cesium.RuntimeError("Error generating style shader: Invalid array length. Array length should be 2, 3, or 4.");case Cesium.ExpressionNodeType.REGEX:throw new Cesium.RuntimeError("Error generating style shader: Regular expressions are not supported.");case Cesium.ExpressionNodeType.VARIABLE_IN_STRING:throw new Cesium.RuntimeError("Error generating style shader: Converting a variable to a string is not supported.");case Cesium.ExpressionNodeType.LITERAL_NULL:return N_;case Cesium.ExpressionNodeType.LITERAL_BOOLEAN:return u?"true":"false";case Cesium.ExpressionNodeType.LITERAL_NUMBER:return ma(u);case Cesium.ExpressionNodeType.LITERAL_STRING:if(Cesium.defined(r)&&r._type===Cesium.ExpressionNodeType.MEMBER&&(u==="r"||u==="g"||u==="b"||u==="a"||u==="x"||u==="y"||u==="z"||u==="w"))return u;if(n=Cesium.Color.fromCssColorString(u,jl),Cesium.defined(n))return IP(n);throw new Cesium.RuntimeError("Error generating style shader: String literals are not supported.");case Cesium.ExpressionNodeType.LITERAL_COLOR:var f=i;if(u==="color"){if(Cesium.defined(f)){if(f.length>1){let h=f[0],d=f[1];return d!=="1.0"&&(t.translucent=!0),`vec4(${h}, ${d})`}}else return"vec4(1.0)";return`vec4(${f[0]}, 1.0)`}else{if(u==="rgb")return n=R_(this),Cesium.defined(n)?Xl(n):`vec4(${f[0]} / 255.0, ${f[1]} / 255.0, ${f[2]} / 255.0, 1.0)`;if(u==="rgba")return f[3]!=="1.0"&&(t.translucent=!0),n=R_(this),Cesium.defined(n)?Xl(n):`vec4(${f[0]} / 255.0, ${f[1]} / 255.0, ${f[2]} / 255.0, ${f[3]})`;if(u==="hsl")return n=D_(this),Cesium.defined(n)?Xl(n):`vec4(czm_HSLToRGB(vec3(${f[0]}, ${f[1]}, ${f[2]})), 1.0)`;if(u==="hsla")return n=D_(this),Cesium.defined(n)?(n.alpha!==1&&(t.translucent=!0),Xl(n)):(f[3]!=="1.0"&&(t.translucent=!0),`vec4(czm_HSLToRGB(vec3(${f[0]}, ${f[1]}, ${f[2]})), ${f[3]})`)}break;case Cesium.ExpressionNodeType.LITERAL_VECTOR:var l=i.length,c=`${u}(`;for(let h=0;h<l;++h)c+=i[h],h<l-1&&(c+=", ");return c+=")",c;case Cesium.ExpressionNodeType.LITERAL_REGEX:throw new Cesium.RuntimeError("Error generating style shader: Regular expressions are not supported.");case Cesium.ExpressionNodeType.LITERAL_UNDEFINED:return N_;case Cesium.ExpressionNodeType.BUILTIN_VARIABLE:if(u==="tiles3d_tileset_time")return"u_time"}};var pa=ko;function sf(e,t){this._conditionsExpression=Cesium.clone(e,!0),this._conditions=e.conditions,this._runtimeConditions=void 0,PP(this,t)}Object.defineProperties(sf.prototype,{conditionsExpression:{get:function(){return this._conditionsExpression}}});function LP(e,t){this.condition=e,this.expression=t}function PP(e,t){var r=[],n=e._conditions;if(Cesium.defined(n)){for(var i=n.length,s=0;s<i;++s){var a=n[s],o=String(a[0]),u=String(a[1]);r.push(new LP(new pa(o,t),new pa(u,t)))}e._runtimeConditions=r}}sf.prototype.evaluate=function(e,t){var r=this._runtimeConditions;if(Cesium.defined(r))for(var n=r.length,i=0;i<n;++i){var s=r[i];if(s.condition.evaluate(e))return s.expression.evaluate(e,t)}};sf.prototype.evaluateColor=function(e,t){var r=this._runtimeConditions;if(Cesium.defined(r))for(var n=r.length,i=0;i<n;++i){var s=r[i];if(s.condition.evaluate(e))return s.expression.evaluateColor(e,t)}};sf.prototype.getShaderFunction=function(e,t,r,n){var i=this._runtimeConditions;if(!(!Cesium.defined(i)||i.length===0)){for(var s="",a=i.length,o=0;o<a;++o){var u=i[o],f=u.condition.getShaderExpression(t,r),l=u.expression.getShaderExpression(t,r);s+="    "+(o===0?"if":"else if")+" ("+f+`) 
    { 
        return `+l+`; 
    } 
`}return s=n+" "+e+`() 
{ 
`+s+"    return "+n+`(1.0); 
} 
`,s}};var rm=sf;function af(e){this._style={},this._ready=!1,this._show=void 0,this._color=void 0,this._pointSize=void 0,this._pointOutlineColor=void 0,this._pointOutlineWidth=void 0,this._labelColor=void 0,this._labelOutlineColor=void 0,this._labelOutlineWidth=void 0,this._font=void 0,this._labelStyle=void 0,this._labelText=void 0,this._backgroundColor=void 0,this._backgroundPadding=void 0,this._backgroundEnabled=void 0,this._scaleByDistance=void 0,this._translucencyByDistance=void 0,this._distanceDisplayCondition=void 0,this._heightOffset=void 0,this._anchorLineEnabled=void 0,this._anchorLineColor=void 0,this._image=void 0,this._disableDepthTestDistance=void 0,this._horizontalOrigin=void 0,this._verticalOrigin=void 0,this._labelHorizontalOrigin=void 0,this._labelVerticalOrigin=void 0,this._meta=void 0,this._colorShaderFunction=void 0,this._showShaderFunction=void 0,this._pointSizeShaderFunction=void 0,this._colorShaderFunctionReady=!1,this._showShaderFunctionReady=!1,this._pointSizeShaderFunctionReady=!1,this._colorShaderTranslucent=!1,this._exOffset=void 0,this._translation=void 0,this._scale=void 0,this._rotation=void 0;var t;if(typeof e=="string"||e instanceof Cesium.Resource){var r=Cesium.Resource.createIfNeeded(e);t=r.fetchJson(e)}else t=Ne.resolve(e);var n=this;this._readyPromise=t.then(function(i){return MP(n,i),n})}function MP(e,t){t=Cesium.defaultValue(Cesium.clone(t,!0),e._style),e._style=t,e.show=t.show,e.color=t.color,e.pointSize=t.pointSize,e.pointOutlineColor=t.pointOutlineColor,e.pointOutlineWidth=t.pointOutlineWidth,e.labelColor=t.labelColor,e.labelOutlineColor=t.labelOutlineColor,e.labelOutlineWidth=t.labelOutlineWidth,e.labelStyle=t.labelStyle,e.font=t.font,e.labelText=t.labelText,e.backgroundColor=t.backgroundColor,e.backgroundPadding=t.backgroundPadding,e.backgroundEnabled=t.backgroundEnabled,e.scaleByDistance=t.scaleByDistance,e.translucencyByDistance=t.translucencyByDistance,e.distanceDisplayCondition=t.distanceDisplayCondition,e.heightOffset=t.heightOffset,e.anchorLineEnabled=t.anchorLineEnabled,e.anchorLineColor=t.anchorLineColor,e.image=t.image,e.disableDepthTestDistance=t.disableDepthTestDistance,e.horizontalOrigin=t.horizontalOrigin,e.verticalOrigin=t.verticalOrigin,e.labelHorizontalOrigin=t.labelHorizontalOrigin,e.labelVerticalOrigin=t.labelVerticalOrigin,e.exOffset=t.exOffset,e.translation=t.translation,e.scale=t.scale,e.rotation=t.rotation;var r={};if(Cesium.defined(t.meta)){var n=t.defines,i=Cesium.defaultValue(t.meta,Cesium.defaultValue.EMPTY_OBJECT);for(var s in i)i.hasOwnProperty(s)&&(r[s]=new pa(i[s],n))}e._meta=r,e._ready=!0}function Ot(e,t){var r=Cesium.defaultValue(e._style,Cesium.defaultValue.EMPTY_OBJECT).defines;if(Cesium.defined(t)){if(typeof t=="boolean"||typeof t=="number")return new pa(String(t));if(typeof t=="string")return new pa(t,r);if(Cesium.defined(t.conditions))return new rm(t,r)}else return;return t}function Nt(e){if(Cesium.defined(e)){if(Cesium.defined(e.expression))return e.expression;if(Cesium.defined(e.conditionsExpression))return Cesium.clone(e.conditionsExpression,!0)}else return;return e}Object.defineProperties(af.prototype,{style:{get:function(){return this._style}},ready:{get:function(){return this._ready}},readyPromise:{get:function(){return this._readyPromise}},show:{get:function(){return this._show},set:function(e){this._show=Ot(this,e),this._style.show=Nt(this._show),this._showShaderFunctionReady=!1}},color:{get:function(){return this._color},set:function(e){this._color=Ot(this,e),this._style.color=Nt(this._color),this._colorShaderFunctionReady=!1}},pointSize:{get:function(){return this._pointSize},set:function(e){this._pointSize=Ot(this,e),this._style.pointSize=Nt(this._pointSize),this._pointSizeShaderFunctionReady=!1}},pointOutlineColor:{get:function(){return this._pointOutlineColor},set:function(e){this._pointOutlineColor=Ot(this,e),this._style.pointOutlineColor=Nt(this._pointOutlineColor)}},pointOutlineWidth:{get:function(){return this._pointOutlineWidth},set:function(e){this._pointOutlineWidth=Ot(this,e),this._style.pointOutlineWidth=Nt(this._pointOutlineWidth)}},labelColor:{get:function(){return this._labelColor},set:function(e){this._labelColor=Ot(this,e),this._style.labelColor=Nt(this._labelColor)}},labelOutlineColor:{get:function(){return this._labelOutlineColor},set:function(e){this._labelOutlineColor=Ot(this,e),this._style.labelOutlineColor=Nt(this._labelOutlineColor)}},labelOutlineWidth:{get:function(){return this._labelOutlineWidth},set:function(e){this._labelOutlineWidth=Ot(this,e),this._style.labelOutlineWidth=Nt(this._labelOutlineWidth)}},font:{get:function(){return this._font},set:function(e){this._font=Ot(this,e),this._style.font=Nt(this._font)}},labelStyle:{get:function(){return this._labelStyle},set:function(e){this._labelStyle=Ot(this,e),this._style.labelStyle=Nt(this._labelStyle)}},labelText:{get:function(){return this._labelText},set:function(e){this._labelText=Ot(this,e),this._style.labelText=Nt(this._labelText)}},backgroundColor:{get:function(){return this._backgroundColor},set:function(e){this._backgroundColor=Ot(this,e),this._style.backgroundColor=Nt(this._backgroundColor)}},backgroundPadding:{get:function(){return this._backgroundPadding},set:function(e){this._backgroundPadding=Ot(this,e),this._style.backgroundPadding=Nt(this._backgroundPadding)}},backgroundEnabled:{get:function(){return this._backgroundEnabled},set:function(e){this._backgroundEnabled=Ot(this,e),this._style.backgroundEnabled=Nt(this._backgroundEnabled)}},scaleByDistance:{get:function(){return this._scaleByDistance},set:function(e){this._scaleByDistance=Ot(this,e),this._style.scaleByDistance=Nt(this._scaleByDistance)}},translucencyByDistance:{get:function(){return this._translucencyByDistance},set:function(e){this._translucencyByDistance=Ot(this,e),this._style.translucencyByDistance=Nt(this._translucencyByDistance)}},distanceDisplayCondition:{get:function(){return this._distanceDisplayCondition},set:function(e){this._distanceDisplayCondition=Ot(this,e),this._style.distanceDisplayCondition=Nt(this._distanceDisplayCondition)}},heightOffset:{get:function(){return this._heightOffset},set:function(e){this._heightOffset=Ot(this,e),this._style.heightOffset=Nt(this._heightOffset)}},exOffset:{get:function(){return this._exOffset},set:function(e){this._exOffset=Ot(this,e),this._style.exOffset=Nt(this._exOffset)}},translation:{get:function(){return this._translation},set:function(e){this._translation=Ot(this,e),this._style.translation=Nt(this._translation)}},scale:{get:function(){return this._scale},set:function(e){this._scale=Ot(this,e),this._style.scale=Nt(this._scale)}},rotation:{get:function(){return this._rotation},set:function(e){this._rotation=Ot(this,e),this._style.rotation=Nt(this._rotation)}},anchorLineEnabled:{get:function(){return this._anchorLineEnabled},set:function(e){this._anchorLineEnabled=Ot(this,e),this._style.anchorLineEnabled=Nt(this._anchorLineEnabled)}},anchorLineColor:{get:function(){return this._anchorLineColor},set:function(e){this._anchorLineColor=Ot(this,e),this._style.anchorLineColor=Nt(this._anchorLineColor)}},image:{get:function(){return this._image},set:function(e){this._image=Ot(this,e),this._style.image=Nt(this._image)}},disableDepthTestDistance:{get:function(){return this._disableDepthTestDistance},set:function(e){this._disableDepthTestDistance=Ot(this,e),this._style.disableDepthTestDistance=Nt(this._disableDepthTestDistance)}},horizontalOrigin:{get:function(){return this._horizontalOrigin},set:function(e){this._horizontalOrigin=Ot(this,e),this._style.horizontalOrigin=Nt(this._horizontalOrigin)}},verticalOrigin:{get:function(){return this._verticalOrigin},set:function(e){this._verticalOrigin=Ot(this,e),this._style.verticalOrigin=Nt(this._verticalOrigin)}},labelHorizontalOrigin:{get:function(){return this._labelHorizontalOrigin},set:function(e){this._labelHorizontalOrigin=Ot(this,e),this._style.labelHorizontalOrigin=Nt(this._labelHorizontalOrigin)}},labelVerticalOrigin:{get:function(){return this._labelVerticalOrigin},set:function(e){this._labelVerticalOrigin=Ot(this,e),this._style.labelVerticalOrigin=Nt(this._labelVerticalOrigin)}},meta:{get:function(){return this._meta},set:function(e){this._meta=e}}});af.prototype.getColorShaderFunction=function(e,t,r){return this._colorShaderFunctionReady?(r.translucent=this._colorShaderTranslucent,this._colorShaderFunction):(this._colorShaderFunctionReady=!0,this._colorShaderFunction=Cesium.defined(this.color)?this.color.getShaderFunction(e,t,r,"vec4"):void 0,this._colorShaderTranslucent=r.translucent,this._colorShaderFunction)};af.prototype.getShowShaderFunction=function(e,t,r){return this._showShaderFunctionReady?this._showShaderFunction:(this._showShaderFunctionReady=!0,this._showShaderFunction=Cesium.defined(this.show)?this.show.getShaderFunction(e,t,r,"bool"):void 0,this._showShaderFunction)};af.prototype.getPointSizeShaderFunction=function(e,t,r){return this._pointSizeShaderFunctionReady?this._pointSizeShaderFunction:(this._pointSizeShaderFunctionReady=!0,this._pointSizeShaderFunction=Cesium.defined(this.pointSize)?this.pointSize.getShaderFunction(e,t,r,"float"):void 0,this._pointSizeShaderFunction)};var hr=af;var k_=dh(mh(),1);function Ve(e){let t=e.name;if(!Cesium.defined(t))throw new Cesium.DeveloperError("name is required");if(typeof t!="string")throw new Cesium.DeveloperError("name is required to be a string ");let r=e.url;if(!Cesium.defined(r))throw new Cesium.DeveloperError("url is required");this._name=t,this._type=Fa.E3M,this._customTag=e.customTag;let n=Cesium.defaultValue(e.e3mOption,{});this._tilesetOption=n,Cesium.defined(n.customTag)||(n.customTag=e.customTag),this._selectedColor=Cesium.defaultValue(e.selectedColor,Cesium.Color.LIME),this._selectedName=void 0,this._selectedFeature=void 0,this._timer=void 0,this.layerShownOrHidden=new Cesium.Event,this.selectionChanged=new Cesium.Event,this.featureVisibleArray=new Cesium.AssociativeArray,this.flowLineEntities=[],this.modeInfoMap=new Cesium.AssociativeArray;let i=this;this._tilesetPromise=Ne.defer(),this._readyPromise=Ne.defer(),this._serverVersion=Cesium.defaultValue(e.serverVersion,void 0);let s=/\:\d+$/g,a=/\.json$/,o=new k_.default(r);if(a.test(r))um(this,r,n,e);else if(this._serverVersion==="EV-Server6")nm(r,e,t,i,n);else if(this._serverVersion==="EV-Server7"){o=`${r}/earthview/manager/config/getVersionInfo`;var u=Cesium.Resource.createIfNeeded(o);u.fetchJson().then(function(f){let l=f.data.match(/\d+/g),c=0;f&&f.data==="7.0"?c=7e3:c=parseInt(l[0])*1e3+parseInt(l[1])*100+parseInt(l[2]),B_(r,c,e,i,n,t)})}else{o=`${r}/earthview/manager/config/getVersionInfo`;var u=Cesium.Resource.createIfNeeded(o);u.fetchJson().then(function(l){let c=l.data.match(/\d+/g),h=0;l&&l.data==="7.0"?h=7e3:h=parseInt(c[0])*1e3+parseInt(c[1])*100+parseInt(c[2]),l&&h>=7e3?B_(r,h,e,i,n,t):nm(r,e,t,i,n)}).catch(function(){nm(r,e,t,i,n)})}}function nm(e,t,r,n,i){let s="/earthview/services/file/getFileData/";if(t.proxy=="nginx"){let a=new RegExp(/(\w+):\/\/([^/:]+)(:\d*)?/),o=e.match(a);o&&o[0]&&(e=`${o[0]+s+r}/`)}else e+=`${s+r}/`;if(typeof t.queryParam=="object"){let a=Cesium.objectToQuery(t.queryParam);if(a){let o=e.indexOf("?");o===-1?e+=`?${a}`:o<e.length-1?e+=`&${a}`:e+=a}}um(n,e,i,t)}function B_(e,t,r,n,i,s){let a="/earthview/rest/services/fileserver/getFileData/";if(t>7e3){a="/earthview/rest/services/fileserver/getIndexFile";let o="/earthview/rest/services/fileserver/getFileData/",u=e;if(r.proxy==="nginx"){let f=new RegExp(/(\w+):\/\/([^/:]+)(:\d*)?/),l=e.match(f);l&&l[0]&&(e=l[0]+a)}else e+=a,u+=`${o+s}/`;if(r.queryParam=Cesium.defaultValue(r.queryParam,{}),r.queryParam.serviceName=s,typeof r.queryParam=="object"){let f=Cesium.objectToQuery(r.queryParam);if(f){let l=u.indexOf("?");l===-1?u+=`?${f}`:l<u.length-1?u+=`&${f}`:u+=f}}i.mongoUrl=u,i.versionValue=t}else{if(r.proxy==="nginx"){let o=new RegExp(/(\w+):\/\/([^/:]+)(:\d*)?/),u=e.match(o);u&&u[0]&&(e=u[0]+a)}else e+=`${a+s}/`;r.queryParam=Cesium.defaultValue(r.queryParam,{}),r.queryParam.serviceName=s,r.queryParam.fileName=`${s}.json`}if(typeof r.queryParam=="object"){let o=Cesium.objectToQuery(r.queryParam);if(o){let u=e.indexOf("?");u===-1?e+=`?${o}`:u<e.length-1?e+=`&${o}`:e+=o}}um(n,e,i,r)}function um(e,t,r,n){e._url=t,Cesium.defined(r.url)||(r.url=t);let i=new Qd(r);e._cesiumLayer=i,Cesium.defined(n.e3mOption)&&Cesium.defined(n.e3mOption.meshLine)&&n.e3mOption.meshLine&&(i.style=new hr({color:{conditions:[["String(${color}) === 'Y'","rgba(255,255,0,1)"],["String(${color}) === 'G'","rgba(0,255,0,1)"],["String(${color}) === 'R'","rgba(255,0,0,1)"],["String(${color}) === 'B'","rgba(0,0,255,1)"],["true",'color("white")']]}}),i.meshLine=n.e3mOption.meshLine,i.meshLineColor=i.style.color,i.colorBlendMode=Cesium.ColorBlendMode.REPLACE),Cesium.defined(n.e3mOption)&&Cesium.defined(n.e3mOption.highPrecision)&&(i.highPrecision=n.e3mOption.highPrecision),e._tilesetPromise.resolve(i),i.readyPromise.then(function(s){e._readyPromise.resolve(s)})}Object.defineProperties(Ve.prototype,{name:{get:function(){return this._name}},url:{get:function(){return this._url}},type:{get:function(){return this._type}},customTag:{get:function(){return this._customTag},set:function(e){this._customTag=e}},show:{get:function(){return this._cesiumLayer.show},set:function(e){typeof e!="boolean"?console.warn("visible is required to be a boolean"):this._cesiumLayer.show!==e&&(this._cesiumLayer.show=e,this.layerShownOrHidden.raiseEvent(this,0,this._cesiumLayer.show))}},selectedColor:{get:function(){return this._selectedColor},set:function(e){e instanceof Cesium.Color&&!Cesium.Color.equals(this._selectedColor,e)&&(this._selectedColor=e,om(this))}},selectedFeature:{get:function(){return this._selectedFeature},set:function(e){this._selectedFeature&&this._selectedFeature!==e&&(this._selectedFeature,void 0),this._selectedFeature!==e&&(this._selectedFeature=e,om(this)),this.selectionChanged.raiseEvent(this,this._selectedFeature)}},readyPromise:{get:function(){return this._readyPromise.promise}}});Ve.prototype.getCesiumLayer=function(){return this._cesiumLayer};Ve.prototype.setSelectedComponentName=function(e){typeof e=="string"&&this._selectedName!==e&&(this._selectedName=e,om(this)),e||this.clearSelection()};Ve.prototype.getSelectedComponentName=function(){return this._selectedName};function Bi(e){let t=e.toString();return t.indexOf(".")<0&&(t+="."),t}Ve.prototype.setBuildingEffect=function(e){let t=this.getCesiumLayer(),r=new hr({color:"color('white')"}),n=e.buildingOptions.color;Cesium.defined(t.style)&&(r.show=t.style.show),r.color=n,t.style=r;let i=`float _baseHeight = 0.0;
float _heightRange = ${Bi(e.buildingOptions.lightStrength)};
float _glowRange =${Bi(e.buildingOptions.glowRange)};
float _glowStartHeight =${Bi(e.buildingOptions.glowStartHeight)};
float _glowInterval = ${Bi(e.buildingOptions.glowInterval)};
float _glowLineWidth = ${Bi(e.buildingOptions.glowLineWidth)};
float _glowLineRed = ${Bi(e.buildingOptions.glowColor.red)};
float _glowLineGreen = ${Bi(e.buildingOptions.glowColor.green)};
float _glowLineBlue = ${Bi(e.buildingOptions.glowColor.blue)};
float _lightmin= ${Bi(e.buildingOptions.lightMin)};
float _lightmax= ${Bi(e.buildingOptions.lightMax)};
float _BulidingUp= ${Bi(e.buildingOptions.buildingUp)};
bool _isglowshow = ${e.buildingOptions.isGlowShow};
bool _isDownToUp = ${e.buildingOptions.isDownToUp};
float vtxf_height = v_stcVertex.y - _baseHeight;
if(_BulidingUp == 0.0)
{
vtxf_height = v_stcVertex.z - _baseHeight;
}
else if(_BulidingUp == 1.0)
{
vtxf_height = v_stcVertex.y - _baseHeight;
}
else if(_BulidingUp == 2.0)
{
vtxf_height = v_stcVertex.x - _baseHeight;
}
float vtxf_a11 = fract(czm_frameNumber / 360.0) * 3.14159265 * 2.0;
float vtxf_a12 = vtxf_height / _heightRange + sin(vtxf_a11) * 0.1;
vtxf_a12 = clamp(vtxf_a12, _lightmin, _lightmax);
gl_FragColor *= vec4(vtxf_a12,vtxf_a12, vtxf_a12, 1.0);
float vtxf_a13 = fract(czm_frameNumber / _glowInterval);
float vtxf_h = clamp(vtxf_height / _glowRange, 0.1, 1.0);
float vtxf_a14 = vtxf_a13;
if(_isDownToUp)
{
if(vtxf_a13 < 0.5)
{
vtxf_a13 = vtxf_a13 + 0.5;
}
vtxf_a13 = (vtxf_a13 - 0.5) * 2.0;
}
else
{
if(vtxf_a13 > 0.5)
{
vtxf_a13 = vtxf_a13 - 0.5;
}
vtxf_a13 = (-vtxf_a13 + 0.5) * 2.0;
}
float vtxf_diff = step(0.001*_glowLineWidth, abs(vtxf_h-vtxf_a13));
if(_isglowshow&&vtxf_height>_glowStartHeight&&vtxf_a13>0.0)
{
gl_FragColor.rgb +=vec3(_glowLineRed,_glowLineGreen,_glowLineBlue) * (1.0-vtxf_diff);
}
`;ee.modifyFragmentShaderForLogDepth=function(s){return s=Cesium.ShaderSource.replaceMain(s,"czm_depth_main"),s+=`
varying vec3 v_stcVertex;
void main(){
czm_depth_main();
${i}czm_writeLogDepth();
}
`,s},ee.modifyVertexShaderForLogDepth=function(s,a){return s=Cesium.ShaderSource.replaceMain(s,"czm_depth_main"),s+=`
varying vec3 v_stcVertex;
void main() 
{ 
    czm_depth_main(); 
    v_stcVertex = a_position;
    czm_vertexLogDepth(${a}); 
} 
`,s},t._update=!0};Ve.prototype.setAllFeaturesColors=function(e,t,r,n){let i=[];for(let o=0;o<t.length;o++){let u=t[o];typeof u=="string"&&(u=`"${u}"`);let f=[];f.push(`\${${e}} === ${u}`);let l=r[o];Cesium.defined(l)||(l=Cesium.Color.WHITE);let c=l.toCssColorString();f.push(c),i.push(f)}let s=[];s.push("true");let a=n.toCssColorString();s.push(a),i.push(s),Cesium.defined(this._cesiumLayer.style)?(this._cesiumLayer.style.color={conditions:i},this._cesiumLayer._styleEngine._styleDirty=!0):this._cesiumLayer.style=new hr({color:{conditions:i}})};Ve.prototype.clearAllChanged=function(){let e=this.getCesiumLayer(),t=new hr({color:"color('white')"});Cesium.defined(e.style)&&(t.show=e.style.show),e.style=t,ee.modifyFragmentShaderForLogDepth=function(r){return r=Cesium.ShaderSource.replaceMain(r,"czm_old_main"),r+=`
varying vec3 v_stcVertex;
void main(){
czm_old_main();
czm_writeLogDepth();
}
`,r},ee.modifyVertexShaderForLogDepth=function(r,n){return r=Cesium.ShaderSource.replaceMain(r,"czm_old_main"),r+=`
varying vec3 v_stcVertex;
void main() 
{ 
    czm_old_main(); 
    v_stcVertex = a_position;
    czm_vertexLogDepth(${n}); 
} 
`,r},e._update=!0};Ve.prototype.clearSelection=function(){let e=this.getCesiumLayer(),t=new hr({color:"color('white')"});Cesium.defined(e.style)&&(t.show=e.style.show),e.style=t,this._selectedFeature,this._selectedName=void 0,this._selectedFeature=void 0,this.selectionChanged.raiseEvent(this,void 0)};Ve.prototype.raiseHeight=function(e){this.readyPromise.then(function(t){let r=Cesium.Cartographic.fromCartesian(t.boundingSphere.center),n=Cesium.Cartesian3.fromRadians(r.longitude,r.latitude,0),i=Cesium.Cartesian3.fromRadians(r.longitude,r.latitude,e),s=Cesium.Cartesian3.subtract(i,n,new Cesium.Cartesian3);Cesium.Matrix4.multiply(Cesium.Matrix4.fromTranslation(s),t.modelMatrix,t.modelMatrix)})};Ve.prototype.setHeight=function(e){let t=this._cesiumLayer,r=t.boundingSphere.center,n=Cesium.Cartographic.fromCartesian(r);n.height=e;let i=Cesium.Cartographic.toCartesian(n),s=Cesium.Cartesian3.subtract(i,r,i);Cesium.Matrix4.multiply(Cesium.Matrix4.fromTranslation(s),t.modelMatrix,t.modelMatrix)};Ve.prototype.getCenter=function(){let e=this.getCesiumLayer();return Cesium.Cartographic.fromCartesian(e.boundingSphere.center)};Ve.prototype.setFeaturesVisible=function(e,t,r,n){Cesium.defined(n)||(n=!0);let i=[],s;for(var a=0;a<t.length;a++){let f=t[a];typeof f=="string"&&(f=`"${f}"`);var o=[];o.push(f),o.push(r),typeof f=="string"?(Cesium.defined(s)||(s=new Cesium.AssociativeArray),s.set(a,o)):this.featureVisibleArray.set(f,o)}Cesium.defined(s)||(s=AP(this.featureVisibleArray,r,n));for(var a=0;a<s.length;a++){var o=s.values[a];let c=[];if(!Array.isArray(o[0]))c.push(`\${${e}} === ${o[0]}`);else{let h=`\${${e}} >= ${o[0][0]} && \${${e}} <= ${o[0][1]}`;c.push(h)}c.push(o[1]),i.push(c)}let u=[];u.push("true"),u.push(n),i.push(u),Cesium.defined(this._cesiumLayer.style)?(this._cesiumLayer.style.show={conditions:i},this._cesiumLayer._styleEngine._styleDirty=!0):this._cesiumLayer.style=new hr({show:{conditions:i}})};function AP(e,t,r){let n=new Cesium.AssociativeArray,i=[];if(t&&!r||!t&&!r){for(var s=0;s<e.length;s++){var a=e.values[s];a[1]&&(typeof a[0]=="number"?i.push(a[0]):n.set(a[0],a))}return i.length>0&&sm(n,i,!0),n}if(t&&r||!t&&r){for(var s=0;s<e.length;s++){var a=e.values[s];a[1]||(typeof a[0]=="number"?i.push(a[0]):n.set(a[0],a))}return i.length>0&&sm(n,i,!1),n}}function sm(e,t,r){t.sort(function(o,u){return o-u});let n=t[0],i=[];i.push(n),i.push(r),e.set(n,i);for(let a=1;a<t.length;a++){let o=t[a-1];if(t[a]-1===o){var s=[];s.push([n,t[a]]),s.push(r),e.set(n,s)}else{if(!Cesium.defined(e.get(n))){var s=[];s.push(n),s.push(r),e.set(n,s)}n=t[a]}}if(!Cesium.defined(e.get(n))){var s=[];s.push(n),s.push(r),e.set(n,s)}}Ve.prototype.setPartFeaturesVisible=function(e,t,r){Cesium.defined(r)||(r=!0);let n="",i=[],s=[];for(let o=0;o<e.length;o++){n="";let u=e[o];for(let f in u){let l=u[f];if(typeof l=="number")n+=`\${${f}} ===${l} && `;else if(typeof l=="string")n+=`\${${f}} ==="${l}" && `;else{let c=l.length;if(i=[],c>2)for(let h=0;h<c;h+=2){i=[];let d=n;d+=`\${${f}} >=${l[h]} && \${${f}} <= ${l[h+1]}`,i.push(d),i.push(t),s.push(i)}else typeof l[0]=="number"&&(n+=`\${${f}} >=${l[0]} && `),c==2&&typeof l[1]=="number"&&(n+=`\${${f}} <=${l[1]} && `),n=n.substr(0,n.length-4),i.push(n),i.push(t),s.push(i)}}}let a=[];a.push("true"),a.push(r),s.push(a),Cesium.defined(this._cesiumLayer.style)?(this._cesiumLayer.style.show={conditions:s},this._cesiumLayer._styleEngine._styleDirty=!0):this._cesiumLayer.style=new hr({show:{conditions:s}})};var Zl=[],am=[];Ve.prototype.getIdScope=function(e){let t=this._cesiumLayer.sharedResources.treeTables;Zl=[],i=[];let r=fm(t),n=r.filter(function(s){return s.id===e});if(Cesium.defined(n)){!Cesium.defined(n[0].parentId)&&Cesium.defined(n[0].children[0])&&(n[0].parentId=n[0].children[0].parentId);let s=r.filter(function(u){if(Cesium.defined(u.parentId))return u.parentId===n[0].parentId});var i=lm(s);let a=i[0],o=i[0];for(let u=1;u<i.length;u++)i[u]>a&&(a=i[u]),i[u]<o&&(o=i[u]);return i=[],[o,a]}};function fm(e){for(let t in e){let r=e[t];Cesium.defined(r.children)&&fm(r.children),Zl.push(r)}return Zl}function lm(e){for(let t=0;t<e.length;t++)am.push(e[t].id),Cesium.defined(e[t].children)&&lm(e[t].children);return am}Ve.prototype.clearFeaturesVisible=function(){this.featureVisibleArray.removeAll(),this.setFeaturesVisible("id",[],!0)};Ve.prototype.setFeaturesColor=function(e,t,r){let n=[];if(!(r instanceof Cesium.Color))throw new Cesium.DeveloperError("\u5FC5\u987B\u8F93\u5165\u989C\u8272.");let i=r.toCssColorString();for(let a=0;a<t.length;a++){let o=t[a];typeof o=="string"&&(o=`"${o}"`);let u=[];u.push(`\${${e}} === ${o}`),u.push(i),n.push(u)}let s=[];s.push("true"),s.push("color('white')"),n.push(s),Cesium.defined(this._cesiumLayer.style)?(this._cesiumLayer.style.color={conditions:n},this._cesiumLayer._styleEngine._styleDirty=!0):this._cesiumLayer.style=new hr({color:{conditions:n}})};Ve.prototype.setColorById=function(e,t,r){Zl=[],am=[];let n=[],i=[];if(i.push(`\${id} === ${e}`),!(t instanceof Cesium.Color))throw new Cesium.DeveloperError("\u5FC5\u987B\u8F93\u5165\u989C\u8272.");if(Cesium.defined(r)){i=[];let o=this._cesiumLayer.sharedResources.treeTables,u=fm(o),f;for(let c in o){let h=o[c];Cesium.defined(h.id)&&(f=h)}let l=U_(o,function(h){return h.id===e},[]);if(l.pop(),r<=l.length){let c=u.filter(function(g){if(Cesium.defined(g.id))return g.id===l[l.length-r]}),h=lm(c),d=h[0],m=h[0];for(let g=1;g<h.length;g++)h[g]>d&&(d=h[g]),h[g]<m&&(m=h[g]);i.push(`\${id} >= ${m} && \${id} <= ${d}`)}else throw new Cesium.DeveloperError("\u7236\u8282\u70B9\u5C42\u7EA7\u6570\u8D85\u51FA\u8303\u56F4\uFF01")}let s=t.toCssColorString();i.push(s),n.push(i);let a=[];a.push("true"),a.push("color('white')"),n.push(a),Cesium.defined(this._cesiumLayer.style)?(this._cesiumLayer.style.color={conditions:n},this._cesiumLayer._styleEngine._styleDirty=!0):this._cesiumLayer.style=new hr({color:{conditions:n}})};function U_(e,t,r){if(e==null)return[];for(let n in e){if(r.push(e[n].id),t(e[n]))return r;if(e[n].children){let i=U_(e[n].children,t,r);if(i.length)return i}r.pop()}return[]}Ve.prototype.setFeaturesColors=function(e,t,r){let n=[];for(let s=0;s<t.length;s++){let a=t[s];typeof a=="string"&&(a=`"${a}"`);let o=[];o.push(`\${${e}} === ${a}`);let u=r[s];Cesium.defined(u)||(u=Cesium.Color.WHITE);let f=u.toCssColorString();o.push(f),n.push(o)}let i=[];i.push("true"),i.push("color('white')"),n.push(i),Cesium.defined(this._cesiumLayer.style)?(this._cesiumLayer.style.color={conditions:n},this._cesiumLayer._styleEngine._styleDirty=!0):this._cesiumLayer.style=new hr({color:{conditions:n}})};Ve.prototype.getFeatureBoundingBoxInWC=function(e,t){let r,n=this._cesiumLayer.treeTable;if(e==="name"){for(var i in n)if(Object.prototype.hasOwnProperty.call(n,i)){var s=n[i],a=new Cesium.ManagedArray;for(a.push(s);a.length>0;){var o=a.pop();if(o.elementName==t){r={MAX:o.MAX,MIN:o.MIN};break}if(Cesium.defined(o.children))for(var u=0;u<o.children.length;++u){var f=o.children[u];a.push(f)}}if(Cesium.defined(r))break}}else if(e==="id"){for(var i in n)if(Object.prototype.hasOwnProperty.call(n,i)){var s=n[i],a=new Cesium.ManagedArray;for(a.push(s);a.length>0;){var o=a.pop();if(o.id==t){r={MAX:o.MAX,MIN:o.MIN};break}else if(o["id:"]==t){r={MAX:o.MAX,MIN:o.MIN};break}if(Cesium.defined(o.children))for(var u=0;u<o.children.length;++u){var f=o.children[u];a.push(f)}}if(Cesium.defined(r))break}}else return console.log("\u5C5E\u6027\u540D\u4E0D\u7B26\u5408\u8981\u6C42"),r;let l,c=new Cesium.ManagedArray;for(c.push(this._cesiumLayer.root);c.length>0;){let h=c.pop();if(Cesium.defined(h._header)&&Cesium.defined(h._header.transform)){let d=Cesium.Matrix4.unpack(h.computedTransform);l=Cesium.Matrix4.multiplyTransformation(d,Cesium.Axis.Y_UP_TO_Z_UP,new Cesium.Matrix4);break}if(Cesium.defined(h.children))for(let d=0;d<h.children.length;++d){var f=h.children[d];c.push(f)}}return Cesium.defined(r)&&Cesium.defined(l)&&(r.MIN=Cesium.Matrix4.multiplyByPoint(l,Cesium.Cartesian3.unpack(r.MIN),new Cesium.Cartesian3),r.MAX=Cesium.Matrix4.multiplyByPoint(l,Cesium.Cartesian3.unpack(r.MAX),new Cesium.Cartesian3)),r};Ve.prototype.getAllChildNode=function(e,t){let r=this._cesiumLayer.treeTable,n=[];if(e==="id"){for(let s in r)if(Object.prototype.hasOwnProperty.call(r,s)){let a=r[s],o=new Cesium.ManagedArray,u=new Cesium.ManagedArray;for(o.push(a);o.length>0;){var i=o.pop();if(i.id==t){u=i.children;break}if(Cesium.defined(i.children))for(let f=0;f<i.children.length;++f){let l=i.children[f];o.push(l)}}return Cesium.defined(u)?G_(u,n):n.push(i.id),n}}};function G_(e,t){for(let r=0;r<e.length;r++){let n=e[r];Cesium.defined(n.children)?G_(n.children,t):t.push(n.id)}}Ve.prototype.getComponentsInCullingVolume=function(e){let t,r=new Cesium.ManagedArray;for(r.push(this._cesiumLayer.root);r.length>0;){let o=r.pop();if(Cesium.defined(o._header)&&Cesium.defined(o._header.transform)){let u=Cesium.Matrix4.unpack(o.computedTransform);t=Cesium.Matrix4.multiplyTransformation(u,Cesium.Axis.Y_UP_TO_Z_UP,new Cesium.Matrix4);break}if(Cesium.defined(o.children))for(let u=0;u<o.children.length;++u){var n=o.children[u];r.push(n)}}let i=[];if(!Cesium.defined(t))return i;let s=this._cesiumLayer.treeTable,a=void 0;for(let o in s)if(Object.prototype.hasOwnProperty.call(s,o)){let u=s[o],f=new Cesium.ManagedArray;for(f.push(u);f.length>0;){let l=f.pop(),c=Cesium.Matrix4.multiplyByPoint(t,Cesium.Cartesian3.unpack(l.MIN),new Cesium.Cartesian3),h=Cesium.Matrix4.multiplyByPoint(t,Cesium.Cartesian3.unpack(l.MAX),new Cesium.Cartesian3),d=Cesium.BoundingSphere.fromCornerPoints(c,h);if(e.computeVisibility(d)!==Cesium.Intersect.OUTSIDE&&!Cesium.defined(l.children)&&i.push(l),Cesium.defined(l.children))for(let m=0;m<l.children.length;++m){var n=l.children[m];f.push(n)}}if(Cesium.defined(a))break}return i};Ve.prototype.setFeaturesColorsByTreeTableMap=function(e,t,r){let n=[];if(e=="name"){let s=[],a=this._cesiumLayer.treeTableMaps;for(let o=0;o<a.length;o++){let u=a[o];for(let f=0;f<t.length;f++){let l=u.get(t[f]);for(let c=0;c<l.length;c++)s.push({id:l[c],color:r[f]})}}e="id",Cesium.ForEach.object(s,function(o){let u=o.id,f=o.color;typeof u=="string"&&(u=`"${u}"`);let l=[];l.push(`\${${e}} === ${u}`),Cesium.defined(f)||(f=Cesium.Color.WHITE);let c=f.toCssColorString();l.push(c),n.push(l)})}else for(let s=0;s<t.length;s++){let a=t[s];typeof a=="string"&&(a=`"${a}"`);let o=[];o.push(`\${${e}} === ${a}`);let u=r[s];Cesium.defined(u)||(u=Cesium.Color.WHITE);let f=u.toCssColorString();o.push(f),n.push(o)}let i=[];i.push("true"),i.push("color('white')"),n.push(i),Cesium.defined(this._cesiumLayer.style)?(this._cesiumLayer.style.color={conditions:n},this._cesiumLayer._styleEngine._styleDirty=!0):this._cesiumLayer.style=new hr({color:{conditions:n}})};Ve.prototype.setFeaturesAlpha=function(e,t,r){r<0&&(r=0),r>1&&(r=1);let n=[],i=`color("white", ${r})`;if(Array.isArray(e)){if(e.length!=t.length||e.length!=2)return;let l=[];for(var s=0;s<e.length;s++){for(var a=[],o=0;o<t[s].length;o++){var u=t[s][o];typeof u=="string"&&(u=`"${u}"`),a.push(`\${${e[s]}} === ${u}`)}l.push(a)}for(s=0;s<l[0].length;s++){let c=l[0][s];for(o=0;o<l[1].length;o++){let h=l[1][o],d=[];d.push(`${c}&&${h}`),d.push(i),n.push(d)}}}else for(var s=0;s<t.length;s++){var u=t[s];typeof u=="string"&&(u=`"${u}"`);var a=[];a.push(`\${${e}} === ${u}`),a.push(i),n.push(a)}let f=[];f.push("true"),f.push("color('white')"),n.push(f),Cesium.defined(this._cesiumLayer.style)?(this._cesiumLayer.style.color={conditions:n},this._cesiumLayer._styleEngine._styleDirty=!0):this._cesiumLayer.style=new hr({color:{conditions:n}})};Ve.prototype.setLayerAlpha=function(e){e<0&&(e=0),e>1&&(e=1);let t=[],r=`color("white", ${e})`,n=[];n.push("true"),n.push(r),t.push(n),Cesium.defined(this._cesiumLayer.style)?(this._cesiumLayer.style.color={conditions:t},this._cesiumLayer._styleEngine._styleDirty=!0):this._cesiumLayer.style=new hr({color:{conditions:t}})};Ve.prototype.setFeaturesBlink=function(e,t){let r=0;Cesium.defined(this._timer)&&(clearInterval(this._timer),this._timer=void 0);let n=this;this._timer=setInterval(function(){r%2===0?V_(n._cesiumLayer,e,0):V_(n._cesiumLayer,e,1),r++},t*1e3)};function V_(e,t,r){let n=[];for(let a=0;a<t.length;a++){let o=t[a],u=o.property;var i;r===0?i=o.color0:i=o.color1;let f=i.toCssColorString(),l=o[u];for(let c=0;c<l.length;c++){let h=l[c];typeof h=="string"&&(h=`"${h}"`);let d=[];d.push(`\${${u}} === ${h}`),d.push(f),n.push(d)}}let s=[];if(s.push("true"),s.push("color('white')"),n.push(s),Cesium.defined(e.style)){let o=e.style.show,u=new hr({color:{conditions:n}});u.show=o,e.style=u}else e.style=new hr({color:{conditions:n}})}Ve.prototype.clearFeaturesBlink=function(){Cesium.defined(this._timer)&&(clearInterval(this._timer),this._timer=void 0),Cesium.defined(this._cesiumLayer.style)&&Cesium.defined(this._cesiumLayer.style.color)&&(this._cesiumLayer.style.color=void 0,this._cesiumLayer._styleEngine._styleDirty=!0)};Ve.prototype.setFlowLine=function(e,t){let r=this._cesiumLayer,n=e.startTime,i=new Cesium.EV_FlowLineMaterialProperty({centreColor:e.centreColor,duration:e.duration,length:e.length,sideColor:e.sideColor,startTime:n,interval:e.interval}),s=this.flowLineEntities;r.allTilesLoaded.addEventListener(function(){let a=r.flowLines;if(!a)throw new Cesium.DeveloperError("\u6570\u636E\u4E0D\u652F\u6301\u663E\u793A\u7535\u6D41\u6D41\u52A8!");for(let o=0;o<a.length;o++)s.push(t.add({polylineVolume:{positions:a[o],shape:DP(.023),material:i,isOffset:!0}}))})};function DP(e){let t=[];for(let r=0;r<360;r+=36){let n=Cesium.Math.toRadians(r);t.push(new Cesium.Cartesian2(e*Math.cos(n),e*Math.sin(n)))}return t}Ve.prototype.setFlowLineVisible=function(e){if(typeof e!="boolean")return;let t=this.flowLineEntities;for(let r=0;r<t.length;r++)t[r].show=e};Ve.prototype.getModelInfoByEVID=function(e,t){if(!Cesium.defined(e))return;let r=this._cesiumLayer;if(!r.ready)return;let n,i=r._url;if(!Cesium.defined(n)){let o=r.EVDataSetName,u=r._url;if(u.endsWith(".json")){let f=u.lastIndexOf("/");i=u.substr(0,f+1)}n=`${i+o}/DATA/0_0_0/record.json`}let a=Cesium.Resource.createIfNeeded(n).fetchJson();Ne(a,function(o){if(!Cesium.defined(o))return;let u=o.recordInfos,f;for(let l=0;l<u.length;l++){let c=u[l];if(c.EVID==e){f={},f.content={},f.boundingVolume={},f.content.uri=c.modelPath,f.boundingVolume.sphere=c.sphere;let h=Cesium.Cartesian3.fromDegrees(c.longitude,c.latitude,c.altitude),d=Cesium.Transforms.eastNorthUpToFixedFrame(h);f.transform=Cesium.Matrix4.toArray(d);break}}if(Cesium.defined(f)){let l=Cesium.Resource.createIfNeeded(n),c=new Xa(r,l,f,void 0);c.requestContent();let h;c.contentReadyToProcessPromise.then(function(){let d=c.content;if(d instanceof Wu){let m=d._contents;for(let g=0;g<m.length;g++){let p=m[g];if(p instanceof aa){let v=p._model,_=Cesium.clone(v,!1),y=Cesium.clone(c.boundingSphere,!0);h={},h.model=_,h.boundingSphere=y;break}}}c.destroy(),Cesium.defined(t)&&t(h)})}})};var of=new Cesium.Matrix4;Ve.prototype.getModelBoundingSphereByEVID=function(e,t){if(!Cesium.defined(e))return;let r=this._cesiumLayer;if(!r.ready)return;let n,i=r._url;if(!Cesium.defined(n)){let o=r.EVDataSetName,u=r._url;if(u.endsWith(".json")){let f=u.lastIndexOf("/");i=u.substr(0,f+1)}n=`${i+o}/DATA/0_0_0/record.json`}let a=Cesium.Resource.createIfNeeded(n).fetchJson();Ne(a,function(o){if(!Cesium.defined(o))return;let u=o.recordInfos;for(let f=0;f<u.length;f++){let l=u[f];if(l.EVID==e){let c=new Cesium.BoundingSphere(new Cesium.Cartesian3(l.sphere[0],l.sphere[1],l.sphere[2]),l.sphere[3]),h=Cesium.Matrix4.unpack(l.transform);return c=Cesium.BoundingSphere.transform(c,h),Cesium.defined(t)&&t(c),!0}}})};Ve.prototype.getModelVertexByEVID=function(e,t,r){let n=this;new Promise(async function(s,a){let o=n.getCesiumLayer(),u,f,l,c,h=o.selectedTiles;for(let v=0;v<h.length;v++){if(f=h[v],Cesium.defined(f._content)){if(Cesium.defined(f._content._batchTable)){for(var d=f._content._batchTable,m=0;m<d.featuresLength;m++)if(d.getProperty(m,e)===t){Cesium.defined(f._content._modelInstanceCollection)?u=f._content._modelInstanceCollection:Cesium.defined(f._content._model)&&(u=f._content._model),c=l=m,d.featuresLength===1&&(c=-1);break}}else if(Cesium.defined(f._content._contents))for(var m=0;m<f._content._contents.length;m++){var d=f._content._contents[m]._batchTable;for(let x=0;x<d.featuresLength;x++)if(d.getProperty(x,e)===t){Cesium.defined(f._content._contents[m]._modelInstanceCollection)?u=f._content._contents[m]._modelInstanceCollection:Cesium.defined(f._content._contents[m]._model)&&(u=f._content._contents[m]._model);break}if(Cesium.defined(u))break}}if(Cesium.defined(u))break}if(!Cesium.defined(u))return;let g;Cesium.defined(u.gltf)?g=u.gltf:Cesium.defined(u._gltf)?g=u._gltf:g=await NP(u._resource._url);let p;Cesium.defined(u._model)?p=Cesium.DracoLoader.hasExtension(u._model):p=Cesium.DracoLoader.hasExtension(u),RP(g,p).then(function(v){if(v.length===0)return;let _=new Map;for(var y=0;y<v.length;y++){let B=v[y].attributeData.POSITION,C=v[y].indexArray,b=v[y].attributeData._BATCHID;var x=OP(B,C,b,c);_.set(v[y].taskDataMesh,x)}let E=[];if(Cesium.defined(u._drawCommands)){if(typeof l!="number")return;for(var y=0;y<u._drawCommands.length;y++){var S=u._drawCommands[y].owner.meshId,x=_.get(Number(S)),I=u.modelMatrix,P=Cesium.Matrix4.multiply(I,u._instances[l].modelMatrix,of),w=Cesium.Matrix4.multiply(P,u._drawCommands[y]._modelMatrix,of),N=im(w,x);E.push({meshId:S,instanceId:l,faces:N})}}else if(u._nodeCommands)for(var y=0;y<u._nodeCommands.length;y++){var S=u._nodeCommands[y].command.owner.meshId,x=_.get(Number(S));if(Cesium.defined(x))if(u._nodeCommands[y].command._instanceCount!=0){var I=u.modelMatrix,P=u._nodeCommands[y].command._modelMatrix;let R=u._nodeCommands[y].command._instanceCount,F=q_(u.ev_E3MInternalInstance.modelInstanceCollections,u._nodeCommands[y].command._owner.meshId)._instances;if(R!=F.length)continue;for(let D=0;D<R;D++){var w=Cesium.Matrix4.multiply(F[D]._modelMatrix,P,of);w=Cesium.Matrix4.multiply(I,w,of);var N=im(w,x);E.push({meshId:S,instanceId:F[D]._instanceId,faces:N})}}else{var I=u._nodeCommands[y].command.modelMatrix,N=im(I,x);E.push({meshId:S,faces:N})}}s(E)})}).then(function(s){r(s)})};function RP(e,t){return new Promise(function(n,i){let s=[];t?Cesium.DracoLoader.parseGltf(e,!1,s).then(function(){s.length!==0&&n(s)}):(Cesium.ForEach.mesh(e,function(a,o){Cesium.ForEach.meshPrimitive(a,function(u,f){let l=e.accessors[u.attributes.POSITION].bufferView,c=e.accessors[u.attributes.POSITION].byteOffset,h=e.bufferViews[l].buffer,d=e.bufferViews[l].byteLength;c+=e.bufferViews[l].byteOffset;let m={},g=xn(e.buffers[h].extras._pipeline.source,c,c+d);m.POSITION={},m.POSITION.array=new Float32Array(g.buffer),l=e.accessors[u.attributes._BATCHID].bufferView,c=e.accessors[u.attributes._BATCHID].byteOffset,h=e.bufferViews[l].buffer,d=e.bufferViews[l].byteLength,c+=e.bufferViews[l].byteOffset;let p=xn(e.buffers[h].extras._pipeline.source,c,c+d);m._BATCHID={},m._BATCHID.array=new Float32Array(p.buffer),l=e.accessors[u.indices].bufferView,c=e.accessors[u.indices].byteOffset,h=e.bufferViews[l].buffer,d=e.bufferViews[l].byteLength,c+=e.bufferViews[l].byteOffset;let v=xn(e.buffers[h].extras._pipeline.source,c,c+d),_=new Uint32Array(v.buffer);s.push({attributeData:m,indexArray:{typedArray:_,numberOfIndices:_.length},taskDataMesh:o,taskDataPrimitive:f})})}),n(s))})}Ve.prototype.getDistance=function(e,t){return new Cesium.TaskProcessor("computeDistance").scheduleTask({vertexInfo:e,points:t})};function OP(e,t,r,n){let i=[];for(let a=0;a<t.numberOfIndices;a+=3){let o=t.typedArray[a],u=t.typedArray[a+1],f=t.typedArray[a+2];var s;if(Cesium.defined(r)&&(s=r.array[o]),Cesium.defined(s)&&Cesium.defined(n)&&n!==-1&&s!==n)continue;let l=o*3,c=e.array[l],h=e.array[l+1],d=e.array[l+2],m=new Cesium.Cartesian3(c,h,d);l=u*3,c=e.array[l],h=e.array[l+1],d=e.array[l+2];let g=new Cesium.Cartesian3(c,h,d);l=f*3,c=e.array[l],h=e.array[l+1],d=e.array[l+2];let p=new Cesium.Cartesian3(c,h,d);i.push({a:m,b:g,c:p,batchId:s})}return i}function im(e,t){let r,n=[],i=new Cesium.BoundingSphere;for(let s=0;s<t.length;s++){let a=Cesium.Matrix4.multiplyByPoint(e,t[s].a,new Cesium.Cartesian3),o=Cesium.Matrix4.multiplyByPoint(e,t[s].b,new Cesium.Cartesian3),u=Cesium.Matrix4.multiplyByPoint(e,t[s].c,new Cesium.Cartesian3);n.push({a,b:o,c:u,batchId:t[s].batchId}),s===0?(i.radius=0,i.center=a,i=Cesium.BoundingSphere.expand(i,o),i=Cesium.BoundingSphere.expand(i,u)):(i=Cesium.BoundingSphere.expand(i,a),i=Cesium.BoundingSphere.expand(i,o),i=Cesium.BoundingSphere.expand(i,u))}return r={f:n,radius:i.radius,center:i.center},r}function q_(e,t){for(let r=0;r<e.length;r++)if(e[r]._meshId===t)return e[r]}var Pr=Uint32Array.BYTES_PER_ELEMENT;function NP(e){return new Promise(function(r,n){Cesium.Resource.fetchArrayBuffer({url:e}).then(function(i){let s=0,a=new Uint8Array(i),o=new DataView(i),u=Cesium.getStringFromTypedArray(a,s,4);if(u==="b3dm"){s+=Pr;let v=o.getUint32(s,!0);s+=Pr;var f=o.getUint32(s,!0);s+=Pr;var l=o.getUint32(s,!0);s+=Pr;var c=o.getUint32(s,!0);s+=Pr;var h=o.getUint32(s,!0);s+=Pr;var d=o.getUint32(s,!0);s+=Pr,s+=l,s+=c,s+=h,s+=d;var m=f-s;if(m===0)throw new Cesium.RuntimeError("glTF byte length must be greater than 0.");var g=new Uint8Array(i,s,m),p=Cesium.parseGlb(g);r(p)}else if(u==="cmpt"){s+=Pr,s+=Pr,s+=Pr;let v=o.getUint32(s,!0);s+=Pr;for(let _=0;_<1;++_){let y=Cesium.getStringFromTypedArray(a,s,4),x=o.getUint32(s+Pr*2,!0),E=s;if(y==="b3dm"){s+=Pr,s+=Pr;var f=o.getUint32(s,!0);s+=Pr;var l=o.getUint32(s,!0);s+=Pr;var c=o.getUint32(s,!0);s+=Pr;var h=o.getUint32(s,!0);s+=Pr;var d=o.getUint32(s,!0);s+=Pr,s+=l,s+=c,s+=h,s+=d;var m=f-s+E;if(m===0)throw new Cesium.RuntimeError("glTF byte length must be greater than 0.");var g=new Uint8Array(i,s,m),p=Cesium.parseGlb(g);r(p)}s+=x}}})})}Ve.prototype.getJsonInfo=function(e){let t={},r=this.url,n;Cesium.defined(this._tilesetOption.versionValue)&&this._tilesetOption.versionValue>7e3&&(n=this._tilesetOption.mongoUrl),Cesium.Resource.fetchJson({url:r}).then(function(i){t.gltfUpAxis=i.asset.gltfUpAxis,t.boundingVolume=i.root.boundingVolume;let s=r.lastIndexOf("/"),a=r.slice(0,s+1)+i.root.content.uri;Cesium.defined(n)&&(s=n.lastIndexOf("/"),a=n.slice(0,s+1)+i.root.content.uri),Cesium.Resource.fetchJson({url:a}).then(function(o){if(!o.root.children[0].modeltree){e(t);return}let u=o.root.children[0].modeltree.uri;t.transform=o.root.children[0].transform;let f=u.lastIndexOf("../"),l=r.slice(0,s)+u.slice(f+2,u.length);Cesium.defined(n)&&(l=n.slice(0,s)+u.slice(f+2,u.length)),Cesium.Resource.fetchJson({url:l}).then(function(c){t.modeltree=c,e(t)})})})};Ve.prototype.showTowerByPercent=function(e,t){if(this.modeInfoMap.length===0||this.modeInfoMap.length!==e.length){let r=this;FP(this,e).then(function(){z_(r,r.modeInfoMap,e,t)})}else z_(this,this.modeInfoMap,e,t)};function z_(e,t,r,n){if(r.length!==n.length)return;let i=[];for(let a=0;a<r.length;a++)if(t.contains(r[a])){let o=t.get(r[a]),u=[],f=o.heightInfo,l=o.startH+(o.endH-o.startH)*n[a];for(var s=0;s<f.length;s++)f[s].height>l&&u.push(f[s].id);if(u.length>0){let c=new Cesium.AssociativeArray;sm(c,u,!1);let h=[];for(var s=0;s<c.length;s++)h=h.concat(c._array[s][0]);i.push({EVID:r[a],id:h})}}e.setPartFeaturesVisible(i,!1,!0)}function FP(e,t){return new Promise(function(n,i){let s=[];for(var a=0;a<t.length;a++)e.modeInfoMap.contains(t[a])||s.push(t[a]);let o=e.getCesiumLayer(),u=[],f=o.selectedTiles;for(var a=0;a<f.length;a++){let g=f[a];if(Cesium.defined(g._header)&&Cesium.defined(g._header.EVID)&&s.indexOf(g._header.EVID)!=-1){var l,c;let p=g._header.EVID;Cesium.defined(g._content._batchTable)?(c=g._content._batchTable._properties.id,Cesium.defined(g._content._modelInstanceCollection)?l=g._content._modelInstanceCollection:Cesium.defined(g._content._model)&&(l=g._content._model)):Cesium.defined(g._content._contents)&&(c=g._content._contents[0]._batchTable._properties.id,Cesium.defined(g._content._contents[0]._modelInstanceCollection)?l=g._content._contents[0]._modelInstanceCollection:Cesium.defined(g._content._contents[0]._model)&&(l=g._content._contents[0]._model));let v=new Cesium.AssociativeArray;if(!Cesium.defined(l._drawCommands)){if(l._nodeCommands)for(let S=0;S<l._nodeCommands.length;S++)if(l._nodeCommands[S].command._instanceCount!=0){var h=l.modelMatrix;let I=l._nodeCommands[S].command._modelMatrix,P=l._nodeCommands[S].command._instanceCount,w=q_(l.ev_E3MInternalInstance.modelInstanceCollections,l._nodeCommands[S].command._owner.meshId),N=w._instances,B=w._batchTable._properties.id;if(P!=N.length)continue;let C=Cesium.Matrix4.multiply(h,I,of);for(var d=0;d<P;d++)v.set(B[d],{id:B[d],matrix:C})}else for(var h=l._nodeCommands[S].command.modelMatrix,d=0;d<c.length;d++)v.set(c[d],{id:c[d],matrix:h})}let _=g._content._resource._url,y=Cesium.Matrix4.unpack(g.computedTransform);Cesium.Matrix4.multiplyTransformation(y,Cesium.Axis.Y_UP_TO_Z_UP,y);let x=_.lastIndexOf("/"),E=`${_.slice(0,x+1)}ModelNodeTree.json`;u.push(BP(E,y,v,p))}}Ne.all(u).then(function(m){for(let g=0;g<m.length;g++){let p=m[g].EVID;e.modeInfoMap.set(p,m[g])}n(!0)})})}function BP(e,t,r,n){return new Promise(function(s,a){Cesium.Resource.fetchJson({url:e}).then(function(o){let u=Cesium.Matrix4.multiplyByPoint(t,Cesium.Cartesian3.unpack(o.MIN),new Cesium.Cartesian3),f=Cesium.Matrix4.multiplyByPoint(t,Cesium.Cartesian3.unpack(o.MAX),new Cesium.Cartesian3),l=Cesium.Cartesian3.midpoint(u,f,new Cesium.Cartesian3),c=Cesium.Cartesian3.distance(u,f)/2,h=Cesium.Cartographic.fromCartesian(l).height,d=h-c,m=h+c,g=[];H_(o,g,r),g.sort(function(p,v){return p.height-v.height}),s({heightInfo:g,EVID:n,startH:d,endH:m})})})}function H_(e,t,r){for(let n=0;n<e.children.length;n++){let i=e.children[n];if(Cesium.defined(i.children))H_(i,t,r);else{let s=r.get(i.id).matrix;if(Cesium.defined(s)){let a=Cesium.Matrix4.multiplyByPoint(s,Cesium.Cartesian3.unpack(i.MIN),new Cesium.Cartesian3),o=Cesium.Matrix4.multiplyByPoint(s,Cesium.Cartesian3.unpack(i.MAX),new Cesium.Cartesian3),u=Cesium.Cartesian3.midpoint(a,o,new Cesium.Cartesian3),f=Cesium.Cartographic.fromCartesian(u).height;t.push({id:i.id,height:f})}}}}Ve.prototype.changeTilePosition=function(e,t,r,n,i,s,a){let o=this._cesiumLayer;if(!o.ready)return;if(!Cesium.defined(e)||!Cesium.defined(t))throw new Cesium.DeveloperError("\u7ECF\u5EA6\u548C\u7EAC\u5EA6\u9700\u8981\u4F20\u5165\uFF01");if(Cesium.defined(n)&&(!Cesium.defined(i)||!Cesium.defined(s)))throw new Cesium.DeveloperError("\u4FEF\u4EF0\u3001\u504F\u822A\u3001\u7FFB\u6EDA\u89D2\u90FD\u9700\u8981\u4F20\u5165\uFF01");if(Cesium.defined(i)&&(!Cesium.defined(n)||!Cesium.defined(s)))throw new Cesium.DeveloperError("\u4FEF\u4EF0\u3001\u504F\u822A\u3001\u7FFB\u6EDA\u89D2\u90FD\u9700\u8981\u4F20\u5165\uFF01");if(Cesium.defined(s)&&(!Cesium.defined(i)||!Cesium.defined(n)))throw new Cesium.DeveloperError("\u4FEF\u4EF0\u3001\u504F\u822A\u3001\u7FFB\u6EDA\u89D2\u90FD\u9700\u8981\u4F20\u5165\uFF01");let u=Cesium.defined(r)?r:0,f=Cesium.defined(n)?n:0,l=Cesium.defined(i)?i:0,c=Cesium.defined(s)?s:0,h=Cesium.Cartesian3.fromRadians(e,t,u);var d=new Cesium.HeadingPitchRoll(f,l,c);let m=Cesium.Transforms.headingPitchRollToFixedFrame(h,d);if(Cesium.defined(a)){if(Cesium.defined(o.root)){var g=[];for(g.push(o.root);g.length>0;){var p=g.pop();if(Cesium.defined(p._header)&&Cesium.defined(p._header.EVID)&&p._header.EVID==a){p.transform=m;break}for(var v=p.children,_=v.length,y=0;y<_;++y)g.push(v[y])}return}}else if(Cesium.defined(o.root)){var g=[];g.push(o.root);let I;for(;g.length>0;){var p=g.pop();if(Cesium.defined(p._header)&&Cesium.defined(p._header.transform)){I=p._header.transform;break}for(var v=p.children,_=v.length,y=0;y<_;++y)g.push(v[y])}if(Cesium.defined(I)){let P,w;if(!Cesium.defined(n)&&!Cesium.defined(i)&&!Cesium.defined(s)){let B=new Cesium.Cartesian3;Cesium.Matrix4.getTranslation(I,B);let C=Cesium.Transforms.headingPitchRollToFixedFrame(B,new Cesium.HeadingPitchRoll(0,0,0)),b=new Cesium.Matrix4;P=Cesium.Matrix4.inverse(C,b),w=Cesium.Matrix4.multiply(P,I,b);let T=new Cesium.Matrix3;Cesium.Matrix4.getMatrix3(w,T);let A=Cesium.Quaternion.fromRotationMatrix(T);var d=Cesium.HeadingPitchRoll.fromQuaternion(A);m=Cesium.Transforms.headingPitchRollToFixedFrame(h,d)}let N=new Cesium.Matrix4;P=Cesium.Matrix4.inverse(I,N),w=Cesium.Matrix4.multiply(m,P,N),o.modelMatrix=w;return}else{let P=o.root;if(P._header){var x=P._header.boundingVolume.sphere,E=new Cesium.Cartesian3(x[0],x[1],x[2]);let w=Cesium.Transforms.eastNorthUpToFixedFrame(E),N=new Cesium.Matrix4,B=Cesium.Matrix4.inverse(w,N),C=Cesium.Matrix4.multiply(m,B,N);o.modelMatrix=C}}}};function om(e){let t=e.getSelectedComponentName(),r=e.selectedColor;if(e.show&&t){let n=[];n.push(t),e.setFeaturesColor("name",n,r)}}Ve.prototype.setClippingByCartographic=function(e){if(!(e.length<3)&&this._cesiumLayer){let n=this._cesiumLayer.boundingSphere.center,i=Cesium.Transforms.eastNorthUpToFixedFrame(n),s=Cesium.Matrix4.inverse(i,new Cesium.Matrix4),a=[];for(var t=0;t<e.length-1;t++){let o=e[t],u=e[t+1];var r;t+2>=e.length?Cesium.Cartesian3.equals(e[0],u)?r=e[1]:r=e[0]:r=e[t+2];let f=Cesium.Cartographic.toCartesian(o),l=Cesium.Cartographic.toCartesian(u),c=Cesium.Cartographic.toCartesian(r),h=Cesium.Matrix4.multiplyByPoint(s,f,new Cesium.Cartesian3),d=Cesium.Matrix4.multiplyByPoint(s,l,new Cesium.Cartesian3),m=new Cesium.Cartesian3(d.x,d.y,d.z+100),g=Cesium.Matrix4.multiplyByPoint(s,c,new Cesium.Cartesian3),p=Cesium.Matrix4.multiplyByPoint(i,m,new Cesium.Cartesian3),v=(h.y-d.y)*(m.z-d.z)-(h.z-d.z)*(m.y-d.y),_=(h.z-d.z)*(m.x-d.x)-(h.x-d.x)*(m.z-d.z),y=(h.x-d.x)*(m.y-d.y)-(h.y-d.y)*(m.x-d.x),x=Cesium.Cartesian3.normalize(new Cesium.Cartesian3(v,_,y),new Cesium.Cartesian3),S=Cesium.Cartesian3.dot(Cesium.Cartesian3.subtract(g,d,new Cesium.Cartesian3),x)<0?new Cesium.Cartesian3(-x.x,-x.y,-x.z):x,I=Cesium.Cartesian3.dot(new Cesium.Cartesian3(-d.x,-d.y,-d.z),S);a.push({normalize:S.clone(),distance:I})}this._cesiumLayer.clippingPlanes||(this._cesiumLayer.clippingPlanes=new Cesium.ClippingPlaneCollection({unionClippingRegions:!0})),this._cesiumLayer.clippingPlanes.unionClippingRegions=!0;for(var t=0;t<a.length;t++)this._cesiumLayer.clippingPlanes.add(new Cesium.ClippingPlane(a[t].normalize,a[t].distance))}};Ve.prototype.closeClipping=function(){this._cesiumLayer&&this._cesiumLayer.clippingPlanes&&this._cesiumLayer.clippingPlanes.removeAll()};Ve.prototype.getFeatureCenter=function(e,t,r){if(e){let n=Cesium.Matrix4.unpack(e.content.tile.computedTransform);Cesium.Matrix4.multiplyTransformation(n,Cesium.Axis.Y_UP_TO_Z_UP,n);let i=Cesium.Matrix4.multiplyByPoint(n,t,new Cesium.Cartesian3),s=Cesium.Matrix4.multiplyByPoint(n,r,new Cesium.Cartesian3);return Cesium.Cartesian3.midpoint(i,s,new Cesium.Cartesian3)}};var Uo=Ve;function uf(e){this._scene=e,this._primitives=e._primitives,this._e3ms=new Cesium.AssociativeArray,this.layerAddedEvent=new Cesium.Event,this.layerRemovedEvent=new Cesium.Event,this.layerMovedEvent=new Cesium.Event,this.layerShownOrHiddenEvent=new Cesium.Event,this.selectionChanged=new Cesium.Event,this.featureSelectionChanged=new Cesium.Event,this._selectedFeature=void 0,this._scene.logarithmicDepthBuffer=!0,this._scene.postProcessStages._fxaa.enabled=!0,this._scene._context._gl.getExtension("EXT_shader_texture_lod"),this._scene._context._gl.getExtension("OES_texture_float")?window.NO_support_OES_float=!1:window.NO_support_OES_float=!0}Object.defineProperties(uf.prototype,{scene:{get:function(){return this._scene}},selectedFeature:{get:function(){return this._selectedFeature},set:function(e){this._selectedFeature!==e&&(this._selectedFeature=e,this.featureSelectionChanged.raiseEvent(this._selectedFeature))}}});uf.prototype.getLayerCollection=function(){return cm(this)};uf.prototype.getE3mLayer=function(e){return VP(this,e)};uf.prototype.add=function(e){return zP(this,e)};function VP(e,t){let n=cm(e).values;for(let i=0;i<n.length;i++){let s=n[i];if(s.getCesiumLayer()===t)return s}return t}function zP(e,t){let r=t.name,n=t.type,i=t.url;if(!Cesium.defined(r))throw new Cesium.DeveloperError("name is required");if(!Cesium.defined(n))throw new Cesium.DeveloperError("type is required");if(!Cesium.defined(i))throw new Cesium.DeveloperError("url is required");if(t.type===Fa.IMAGE){let s=t.url,a=t.name,o=new Cesium.WebMapTileServiceImageryProvider({url:`${s}/earthview/services/${a}/RasterService/WMTS`,layer:a,style:"default",format:"image/png",tileMatrixSetID:"OGC_WebMercator",tileMatrixLabels:[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20],contextOptions:{requestWebgl2:!0}});return e.scene.imageryLayers.addImageryProvider(o),o}else{if(t.type===Fa.DEM)return new Ch({name:t.name,url:t.url,scene:e.scene});if(t.type===Fa.E3M){let s=new Uo(t);s.readyPromise.then(function(u){e._primitives.add(u)});let a=s.layerShownOrHidden._listeners;return a.length===0&&s.layerShownOrHidden.addEventListener(function(u,f,l){kP(e,u,f,l)}),a=s.selectionChanged._listeners,a.length===0&&s.selectionChanged.addEventListener(function(u,f){UP(e,u,f)}),cm(e).set(r,s),e.layerAddedEvent.raiseEvent(s),s}}}function kP(e,t,r,n){let i=t;e.layerShownOrHiddenEvent.raiseEvent(i,n)}function UP(e,t,r){e.selectionChanged.raiseEvent(t,r)}function cm(e){return e._e3ms}var GP=uf;var _r=63710088e-1,Bc={meters:_r,metres:_r,millimeters:_r*1e3,millimetres:_r*1e3,centimeters:_r*100,centimetres:_r*100,kilometers:_r/1e3,kilometres:_r/1e3,miles:_r/1609.344,nauticalmiles:_r/1852,inches:_r*39.37,yards:_r/1.0936,feet:_r*3.28084,radians:1,degrees:_r/111325},Py={meters:1,metres:1,millimeters:1e3,millimetres:1e3,centimeters:100,centimetres:100,kilometers:1/1e3,kilometres:1/1e3,miles:1/1609.344,nauticalmiles:1/1852,inches:39.37,yards:1/1.0936,feet:3.28084,radians:1/_r,degrees:1/111325},vc={meters:1,metres:1,millimeters:1e6,millimetres:1e6,centimeters:1e4,centimetres:1e4,kilometers:1e-6,kilometres:1e-6,acres:247105e-9,miles:386e-9,yards:1.195990046,feet:10.763910417,inches:1550.003100006};function nr(e,t,r){if(r=r||{},!fe(r))throw new Error("options is invalid");var n=r.bbox,i=r.id;if(e===void 0)throw new Error("geometry is required");if(t&&t.constructor!==Object)throw new Error("properties must be an Object");n&&bu(n),i&&zc(i);var s={type:"Feature"};return i&&(s.id=i),n&&(s.bbox=n),s.properties=t||{},s.geometry=e,s}function My(e,t,r){if(r=r||{},!fe(r))throw new Error("options is invalid");var n=r.bbox;if(!e)throw new Error("type is required");if(!t)throw new Error("coordinates is required");if(!Array.isArray(t))throw new Error("coordinates must be an Array");n&&bu(n);var i;switch(e){case"Point":i=gt(t).geometry;break;case"LineString":i=Pt(t).geometry;break;case"Polygon":i=ze(t).geometry;break;case"MultiPoint":i=Vc(t).geometry;break;case"MultiLineString":i=Ra(t).geometry;break;case"MultiPolygon":i=Eu(t).geometry;break;default:throw new Error(e+" is invalid")}return n&&(i.bbox=n),i}function gt(e,t,r){if(!e)throw new Error("coordinates is required");if(!Array.isArray(e))throw new Error("coordinates must be an Array");if(e.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!bt(e[0])||!bt(e[1]))throw new Error("coordinates must contain numbers");return nr({type:"Point",coordinates:e},t,r)}function Ay(e,t,r){if(!e)throw new Error("coordinates is required");if(!Array.isArray(e))throw new Error("coordinates must be an Array");return ge(e.map(function(n){return gt(n,t)}),r)}function ze(e,t,r){if(!e)throw new Error("coordinates is required");for(var n=0;n<e.length;n++){var i=e[n];if(i.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var s=0;s<i[i.length-1].length;s++){if(n===0&&s===0&&!bt(i[0][0])||!bt(i[0][1]))throw new Error("coordinates must contain numbers");if(i[i.length-1][s]!==i[0][s])throw new Error("First and last Position are not equivalent.")}}return nr({type:"Polygon",coordinates:e},t,r)}function Dy(e,t,r){if(!e)throw new Error("coordinates is required");if(!Array.isArray(e))throw new Error("coordinates must be an Array");return ge(e.map(function(n){return ze(n,t)}),r)}function Pt(e,t,r){if(!e)throw new Error("coordinates is required");if(e.length<2)throw new Error("coordinates must be an array of two or more positions");if(!bt(e[0][1])||!bt(e[0][1]))throw new Error("coordinates must contain numbers");return nr({type:"LineString",coordinates:e},t,r)}function Ry(e,t,r){if(!e)throw new Error("coordinates is required");if(!Array.isArray(e))throw new Error("coordinates must be an Array");return ge(e.map(function(n){return Pt(n,t)}),r)}function ge(e,t){if(t=t||{},!fe(t))throw new Error("options is invalid");var r=t.bbox,n=t.id;if(!e)throw new Error("No features passed");if(!Array.isArray(e))throw new Error("features must be an Array");r&&bu(r),n&&zc(n);var i={type:"FeatureCollection"};return n&&(i.id=n),r&&(i.bbox=r),i.features=e,i}function Ra(e,t,r){if(!e)throw new Error("coordinates is required");return nr({type:"MultiLineString",coordinates:e},t,r)}function Vc(e,t,r){if(!e)throw new Error("coordinates is required");return nr({type:"MultiPoint",coordinates:e},t,r)}function Eu(e,t,r){if(!e)throw new Error("coordinates is required");return nr({type:"MultiPolygon",coordinates:e},t,r)}function Jm(e,t,r){if(!e)throw new Error("geometries is required");if(!Array.isArray(e))throw new Error("geometries must be an Array");return nr({type:"GeometryCollection",geometries:e},t,r)}function Oy(e,t){if(e==null||isNaN(e))throw new Error("num is required");if(t&&!(t>=0))throw new Error("precision must be a positive number");var r=Math.pow(10,t||0);return Math.round(e*r)/r}function Jo(e,t){if(e==null)throw new Error("radians is required");if(t&&typeof t!="string")throw new Error("units must be a string");var r=Bc[t||"kilometers"];if(!r)throw new Error(t+" units is invalid");return e*r}function eo(e,t){if(e==null)throw new Error("distance is required");if(t&&typeof t!="string")throw new Error("units must be a string");var r=Bc[t||"kilometers"];if(!r)throw new Error(t+" units is invalid");return e/r}function _c(e,t){return Ea(eo(e,t))}function va(e){if(e==null)throw new Error("bearing is required");var t=e%360;return t<0&&(t+=360),t}function Ea(e){if(e==null)throw new Error("radians is required");var t=e%(2*Math.PI);return t*180/Math.PI}function dr(e){if(e==null)throw new Error("degrees is required");var t=e%360;return t*Math.PI/180}function to(e,t,r){if(e==null)throw new Error("length is required");if(!(e>=0))throw new Error("length must be a positive number");return Jo(eo(e,t),r||"kilometers")}function Ny(e,t,r){if(e==null)throw new Error("area is required");if(!(e>=0))throw new Error("area must be a positive number");var n=vc[t||"meters"];if(!n)throw new Error("invalid original units");var i=vc[r||"kilometers"];if(!i)throw new Error("invalid final units");return e/n*i}function bt(e){return!isNaN(e)&&e!==null&&!Array.isArray(e)}function fe(e){return!!e&&e.constructor===Object}function bu(e){if(!e)throw new Error("bbox is required");if(!Array.isArray(e))throw new Error("bbox must be an Array");if(e.length!==4&&e.length!==6)throw new Error("bbox must be an Array of 4 or 6 numbers");e.forEach(function(t){if(!bt(t))throw new Error("bbox must only contain numbers")})}function zc(e){if(!e)throw new Error("id is required");if(["string","number"].indexOf(typeof e)===-1)throw new Error("id must be a number or a string")}function qP(){throw new Error("method has been renamed to `radiansToDegrees`")}function HP(){throw new Error("method has been renamed to `degreesToRadians`")}function WP(){throw new Error("method has been renamed to `lengthToDegrees`")}function YP(){throw new Error("method has been renamed to `lengthToRadians`")}function XP(){throw new Error("method has been renamed to `radiansToLength`")}function jP(){throw new Error("method has been renamed to `bearingToAzimuth`")}function KP(){throw new Error("method has been renamed to `convertLength`")}var QP=Object.freeze({earthRadius:_r,factors:Bc,unitsFactors:Py,areaFactors:vc,feature:nr,geometry:My,point:gt,points:Ay,polygon:ze,polygons:Dy,lineString:Pt,lineStrings:Ry,featureCollection:ge,multiLineString:Ra,multiPoint:Vc,multiPolygon:Eu,geometryCollection:Jm,round:Oy,radiansToLength:Jo,lengthToRadians:eo,lengthToDegrees:_c,bearingToAzimuth:va,radiansToDegrees:Ea,degreesToRadians:dr,convertLength:to,convertArea:Ny,isNumber:bt,isObject:fe,validateBBox:bu,validateId:zc,radians2degrees:qP,degrees2radians:HP,distanceToDegrees:WP,distanceToRadians:YP,radiansToDistance:XP,bearingToAngle:jP,convertDistance:KP});function mr(e,t,r){if(e!==null)for(var n,i,s,a,o,u,f,l=0,c=0,h,d=e.type,m=d==="FeatureCollection",g=d==="Feature",p=m?e.features.length:1,v=0;v<p;v++){f=m?e.features[v].geometry:g?e.geometry:e,h=f?f.type==="GeometryCollection":!1,o=h?f.geometries.length:1;for(var _=0;_<o;_++){var y=0,x=0;if(a=h?f.geometries[_]:f,a!==null){u=a.coordinates;var E=a.type;switch(l=r&&(E==="Polygon"||E==="MultiPolygon")?1:0,E){case null:break;case"Point":t(u,c,v,y,x),c++,y++;break;case"LineString":case"MultiPoint":for(n=0;n<u.length;n++)t(u[n],c,v,y,x),c++,E==="MultiPoint"&&y++;E==="LineString"&&y++;break;case"Polygon":case"MultiLineString":for(n=0;n<u.length;n++){for(i=0;i<u[n].length-l;i++)t(u[n][i],c,v,y,x),c++;E==="MultiLineString"&&y++,E==="Polygon"&&x++}E==="Polygon"&&y++;break;case"MultiPolygon":for(n=0;n<u.length;n++){for(E==="MultiPolygon"&&(x=0),i=0;i<u[n].length;i++){for(s=0;s<u[n][i].length-l;s++)t(u[n][i][s],c,v,y,x),c++;x++}y++}break;case"GeometryCollection":for(n=0;n<a.geometries.length;n++)mr(a.geometries[n],t,r);break;default:throw new Error("Unknown Geometry Type")}}}}}function kc(e,t,r,n){var i=r;return mr(e,function(s,a,o,u,f){a===0&&r===void 0?i=s:i=t(i,s,a,o,u,f)},n),i}function $m(e,t){var r;switch(e.type){case"FeatureCollection":for(r=0;r<e.features.length;r++)t(e.features[r].properties,r);break;case"Feature":t(e.properties,0);break}}function Fy(e,t,r){var n=r;return $m(e,function(i,s){s===0&&r===void 0?n=i:n=t(n,i,s)}),n}function wt(e,t){if(e.type==="Feature")t(e,0);else if(e.type==="FeatureCollection")for(var r=0;r<e.features.length;r++)t(e.features[r],r)}function ep(e,t,r){var n=r;return wt(e,function(i,s){s===0&&r===void 0?n=i:n=t(n,i,s)}),n}function ls(e){var t=[];return mr(e,function(r){t.push(r)}),t}function Mi(e,t){var r,n,i,s,a,o,u,f,l,c,h=0,d=e.type==="FeatureCollection",m=e.type==="Feature",g=d?e.features.length:1;for(r=0;r<g;r++){for(o=d?e.features[r].geometry:m?e.geometry:e,f=d?e.features[r].properties:m?e.properties:{},l=d?e.features[r].bbox:m?e.bbox:void 0,c=d?e.features[r].id:m?e.id:void 0,u=o?o.type==="GeometryCollection":!1,a=u?o.geometries.length:1,i=0;i<a;i++){if(s=u?o.geometries[i]:o,s===null){t(null,h,f,l,c);continue}switch(s.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{t(s,h,f,l,c);break}case"GeometryCollection":{for(n=0;n<s.geometries.length;n++)t(s.geometries[n],h,f,l,c);break}default:throw new Error("Unknown Geometry Type")}}h++}}function tp(e,t,r){var n=r;return Mi(e,function(i,s,a,o,u){s===0&&r===void 0?n=i:n=t(n,i,s,a,o,u)}),n}function Jt(e,t){Mi(e,function(r,n,i,s,a){var o=r===null?null:r.type;switch(o){case null:case"Point":case"LineString":case"Polygon":t(nr(r,i,{bbox:s,id:a}),n,0);return}var u;switch(o){case"MultiPoint":u="Point";break;case"MultiLineString":u="LineString";break;case"MultiPolygon":u="Polygon";break}r.coordinates.forEach(function(f,l){var c={type:u,coordinates:f};t(nr(c,i),n,l)})})}function By(e,t,r){var n=r;return Jt(e,function(i,s,a){s===0&&a===0&&r===void 0?n=i:n=t(n,i,s,a)}),n}function Ns(e,t){Jt(e,function(r,n,i){var s=0;if(r.geometry){var a=r.geometry.type;a==="Point"||a==="MultiPoint"||kc(r,function(o,u,f,l,c,h){var d=Pt([o,u],r.properties);return t(d,n,i,h,s),s++,u})}})}function rp(e,t,r){var n=r,i=!1;return Ns(e,function(s,a,o,u,f){i===!1&&r===void 0?n=s:n=t(n,s,a,o,u,f),i=!0}),n}function np(e,t){if(!e)throw new Error("geojson is required");Jt(e,function(r,n,i){if(r.geometry!==null){var s=r.geometry.type,a=r.geometry.coordinates;switch(s){case"LineString":t(r,n,i,0,0);break;case"Polygon":for(var o=0;o<a.length;o++)t(Pt(a[o],r.properties),n,i,o);break}}})}function ip(e,t,r){var n=r;return np(e,function(i,s,a,o){s===0&&r===void 0?n=i:n=t(n,i,s,a,o)}),n}var ZP=Object.freeze({coordEach:mr,coordReduce:kc,propEach:$m,propReduce:Fy,featureEach:wt,featureReduce:ep,coordAll:ls,geomEach:Mi,geomReduce:tp,flattenEach:Jt,flattenReduce:By,segmentEach:Ns,segmentReduce:rp,lineEach:np,lineReduce:ip});function ur(e){var t=[1/0,1/0,-1/0,-1/0];return mr(e,function(r){t[0]>r[0]&&(t[0]=r[0]),t[1]>r[1]&&(t[1]=r[1]),t[2]<r[0]&&(t[2]=r[0]),t[3]<r[1]&&(t[3]=r[1])}),t}function Vt(e){if(!e)throw new Error("obj is required");var t=le(e);if(t.length>1&&bt(t[0])&&bt(t[1]))return t;throw new Error("Coordinate is not a valid Point")}function le(e){if(!e)throw new Error("obj is required");var t;if(e.length?t=e:e.coordinates?t=e.coordinates:e.geometry&&e.geometry.coordinates&&(t=e.geometry.coordinates),t)return Uc(t),t;throw new Error("No valid coordinates")}function Uc(e){if(e.length>1&&bt(e[0])&&bt(e[1]))return!0;if(Array.isArray(e[0])&&e[0].length)return Uc(e[0]);throw new Error("coordinates must only contain numbers")}function Vy(e,t,r){if(!t||!r)throw new Error("type and name required");if(!e||e.type!==t)throw new Error("Invalid input to "+r+": must be a "+t+", given "+e.type)}function wf(e,t,r){if(!e)throw new Error("No feature passed");if(!r)throw new Error(".featureOf() requires a name");if(!e||e.type!=="Feature"||!e.geometry)throw new Error("Invalid input to "+r+", Feature with geometry required");if(!e.geometry||e.geometry.type!==t)throw new Error("Invalid input to "+r+": must be a "+t+", given "+e.geometry.type)}function Qi(e,t,r){if(!e)throw new Error("No featureCollection passed");if(!r)throw new Error(".collectionOf() requires a name");if(!e||e.type!=="FeatureCollection")throw new Error("Invalid input to "+r+", FeatureCollection required");for(var n=0;n<e.features.length;n++){var i=e.features[n];if(!i||i.type!=="Feature"||!i.geometry)throw new Error("Invalid input to "+r+", Feature with geometry required");if(!i.geometry||i.geometry.type!==t)throw new Error("Invalid input to "+r+": must be a "+t+", given "+i.geometry.type)}}function Tn(e){if(!e)throw new Error("geojson is required");if(e.geometry!==void 0)return e.geometry;if(e.coordinates||e.geometries)return e;throw new Error("geojson must be a valid Feature or Geometry Object")}function zy(){throw new Error("invariant.getGeomType has been deprecated in v5.0 in favor of invariant.getType")}function Mt(e,t){if(!e)throw new Error((t||"geojson")+" is required");if(e.geometry&&e.geometry.type)return e.geometry.type;if(e.type)return e.type;throw new Error((t||"geojson")+" is invalid")}var JP=Object.freeze({getCoord:Vt,getCoords:le,containsNumber:Uc,geojsonType:Vy,featureOf:wf,collectionOf:Qi,getGeom:Tn,getGeomType:zy,getType:Mt});/**
 * @license GNU Affero General Public License.
 * Copyright (c) 2015, 2015 Ronny Lorenz <ronny@tbi.univie.ac.at>
 * v. 1.2.0
 * https://github.com/RaumZeit/MarchingSquares.js
 */var W_={successCallback:null,verbose:!1},Jl={};function $P(e,t,r){r=r||{};for(var n=Object.keys(W_),i=0;i<n.length;i++){var s=n[i],a=r[s];a=typeof a<"u"&&a!==null?a:W_[s],Jl[s]=a}Jl.verbose&&console.log("MarchingSquaresJS-isoContours: computing isocontour for "+t);var o=rM(eM(e,t));return typeof Jl.successCallback=="function"&&Jl.successCallback(o),o}function Lt(e,t,r){return(e-t)/(r-t)}function eM(e,t){for(var r=e.length-1,n=e[0].length-1,i={rows:r,cols:n,cells:[]},s=0;s<r;++s){i.cells[s]=[];for(var a=0;a<n;++a){var o=0,u=e[s+1][a],f=e[s+1][a+1],l=e[s][a+1],c=e[s][a];if(!(isNaN(u)||isNaN(f)||isNaN(l)||isNaN(c))){o|=u>=t?8:0,o|=f>=t?4:0,o|=l>=t?2:0,o|=c>=t?1:0;var h=!1;if(o===5||o===10){var d=(u+f+l+c)/4;o===5&&d<t?(o=10,h=!0):o===10&&d<t&&(o=5,h=!0)}if(o!==0&&o!==15){var m,g,p,v;m=g=p=v=.5,o===1?(p=1-Lt(t,u,c),g=1-Lt(t,l,c)):o===2?(g=Lt(t,c,l),v=1-Lt(t,f,l)):o===3?(p=1-Lt(t,u,c),v=1-Lt(t,f,l)):o===4?(m=Lt(t,u,f),v=Lt(t,l,f)):o===5?(m=Lt(t,u,f),v=Lt(t,l,f),g=1-Lt(t,l,c),p=1-Lt(t,u,c)):o===6?(g=Lt(t,c,l),m=Lt(t,u,f)):o===7?(p=1-Lt(t,u,c),m=Lt(t,u,f)):o===8?(p=Lt(t,c,u),m=1-Lt(t,f,u)):o===9?(g=1-Lt(t,l,c),m=1-Lt(t,f,u)):o===10?(m=1-Lt(t,f,u),v=1-Lt(t,f,l),g=Lt(t,c,l),p=Lt(t,c,u)):o===11?(m=1-Lt(t,f,u),v=1-Lt(t,f,l)):o===12?(p=Lt(t,c,u),v=Lt(t,l,f)):o===13?(g=1-Lt(t,l,c),v=Lt(t,l,f)):o===14?(p=Lt(t,c,u),g=Lt(t,c,l)):console.log("MarchingSquaresJS-isoContours: Illegal cval detected: "+o),i.cells[s][a]={cval:o,flipped:h,top:m,right:v,bottom:g,left:p}}}}}return i}function tM(e){return e.cval===5||e.cval===10}function ky(e){return e.cval===0||e.cval===15}function Y_(e){!ky(e)&&e.cval!==5&&e.cval!==10&&(e.cval=15)}function hm(e,t){if(t==="top")return[e.top,1];if(t==="bottom")return[e.bottom,0];if(t==="right")return[1,e.right];if(t==="left")return[0,e.left]}function rM(e){var t=[],r=0,n=e.rows,i=e.cols,s=1e-7;return e.cells.forEach(function(a,o){a.forEach(function(u,f){if(typeof u<"u"&&!tM(u)&&!ky(u)){var l=nM(e.cells,o,f),c=!1;if(l.info==="mergeable"){for(var h=l.path[l.path.length-1][0],d=l.path[l.path.length-1][1],m=r-1;m>=0;m--)if(Math.abs(t[m][0][0]-h)<=s&&Math.abs(t[m][0][1]-d)<=s){for(var g=l.path.length-2;g>=0;--g)t[m].unshift(l.path[g]);c=!0;break}}c||(t[r++]=l.path)}})}),t}function nM(e,t,r){var n=e.length,i=[],s=[0,0,1,1,0,0,0,0,-1,0,1,1,-1,0,-1,0],a=[0,-1,0,0,1,1,1,1,0,-1,0,0,0,-1,0,0],o,u,f=["none","left","bottom","left","right","none","bottom","left","top","top","none","top","right","right","bottom","none"],l=["none","bottom","right","right","top","top","top","top","left","bottom","right","right","left","bottom","left","none"],m,c=e[t][r],h=e[t][r],d=h.cval,m=f[d],g=hm(h,m);i.push([r+g[0],t+g[1]]),m=l[d],g=hm(h,m),i.push([r+g[0],t+g[1]]),Y_(h);for(var p=r+s[d],v=t+a[d],_=d;p>=0&&v>=0&&v<n&&(p!=r||v!=t)&&(h=e[v][p],!(typeof h>"u"));){if(d=h.cval,d===0||d===15)return{path:i,info:"mergeable"};m=l[d],o=s[d],u=a[d],(d===5||d===10)&&(d===5?h.flipped?a[_]===-1?(m="left",o=-1,u=0):(m="right",o=1,u=0):s[_]===-1&&(m="bottom",o=0,u=-1):d===10&&(h.flipped?s[_]===-1?(m="top",o=0,u=1):(m="bottom",o=0,u=-1):a[_]===1&&(m="left",o=-1,u=0))),g=hm(h,m),i.push([p+g[0],v+g[1]]),Y_(h),p+=o,v+=u,_=d}return{path:i,info:"closed"}}function iM(e,t){if(t=t||{},!fe(t))throw new Error("options is invalid");var r=t.zProperty||"elevation",n=t.flip,i=t.flags;Qi(e,"Point","input must contain Points");for(var s=sM(e,n),a=[],o=0;o<s.length;o++){for(var u=s[o],f=[],l=0;l<u.length;l++){var c=u[l];c.properties[r]?f.push(c.properties[r]):f.push(0),i===!0&&(c.properties.matrixPosition=[o,l])}a.push(f)}return a}function sM(e,t){var r={};wt(e,function(s){var a=le(s)[1];r[a]||(r[a]=[]),r[a].push(s)});var n=Object.keys(r).map(function(s){var a=r[s],o=a.sort(function(u,f){return le(u)[0]-le(f)[0]});return o}),i=n.sort(function(s,a){return t?le(s[0])[1]-le(a[0])[1]:le(a[0])[1]-le(s[0])[1]});return i}function aM(e,t,r){if(r=r||{},!fe(r))throw new Error("options is invalid");var n=r.zProperty||"elevation",i=r.commonProperties||{},s=r.breaksProperties||[];if(Qi(e,"Point","Input must contain Points"),!t)throw new Error("breaks is required");if(!Array.isArray(t))throw new Error("breaks must be an Array");if(!fe(i))throw new Error("commonProperties must be an Object");if(!Array.isArray(s))throw new Error("breaksProperties must be an Array");var a=iM(e,{zProperty:n,flip:!0}),o=oM(a,t,n,i,s),u=uM(o,a,e);return ge(u)}function oM(e,t,r,n,i){for(var s=[],a=1;a<t.length;a++){var o=+t[a],u=Object.assign({},n,i[a]);u[r]=o;var f=Ra($P(e,o),u);s.push(f)}return s}function uM(e,t,r){var n=ur(r),i=n[2]-n[0],s=n[3]-n[1],a=n[0],o=n[1],u=t[0].length-1,f=t.length-1,l=i/u,c=s/f,h=function(d){d[0]=d[0]*l+a,d[1]=d[1]*c+o};return e.forEach(function(d){mr(d,h)}),e}var fM=Uy;function Uy(e,t,r,n,i){for(r=r||0,n=n||e.length-1,i=i||lM;n>r;){if(n-r>600){var s=n-r+1,a=t-r+1,o=Math.log(s),u=.5*Math.exp(2*o/3),f=.5*Math.sqrt(o*u*(s-u)/s)*(a-s/2<0?-1:1),l=Math.max(r,Math.floor(t-a*u/s+f)),c=Math.min(n,Math.floor(t+(s-a)*u/s+f));Uy(e,t,l,c,i)}var h=e[t],d=r,m=n;for(ff(e,r,t),i(e[n],h)>0&&ff(e,r,n);d<m;){for(ff(e,d,m),d++,m--;i(e[d],h)<0;)d++;for(;i(e[m],h)>0;)m--}i(e[r],h)===0?ff(e,r,m):(m++,ff(e,m,n)),m<=t&&(r=m+1),t<=m&&(n=m-1)}}function ff(e,t,r){var n=e[t];e[t]=e[r],e[r]=n}function lM(e,t){return e<t?-1:e>t?1:0}var $o=Cc;function Cc(e,t){if(!(this instanceof Cc))return new Cc(e,t);this._maxEntries=Math.max(4,e||9),this._minEntries=Math.max(2,Math.ceil(this._maxEntries*.4)),t&&this._initFormat(t),this.clear()}Cc.prototype={all:function(){return this._all(this.data,[])},search:function(e){var t=this.data,r=[],n=this.toBBox;if(!ec(e,t))return r;for(var i=[],s,a,o,u;t;){for(s=0,a=t.children.length;s<a;s++)o=t.children[s],u=t.leaf?n(o):o,ec(e,u)&&(t.leaf?r.push(o):mm(e,u)?this._all(o,r):i.push(o));t=i.pop()}return r},collides:function(e){var t=this.data,r=this.toBBox;if(!ec(e,t))return!1;for(var n=[],i,s,a,o;t;){for(i=0,s=t.children.length;i<s;i++)if(a=t.children[i],o=t.leaf?r(a):a,ec(e,o)){if(t.leaf||mm(e,o))return!0;n.push(a)}t=n.pop()}return!1},load:function(e){if(!(e&&e.length))return this;if(e.length<this._minEntries){for(var t=0,r=e.length;t<r;t++)this.insert(e[t]);return this}var n=this._build(e.slice(),0,e.length-1,0);if(!this.data.children.length)this.data=n;else if(this.data.height===n.height)this._splitRoot(this.data,n);else{if(this.data.height<n.height){var i=this.data;this.data=n,n=i}this._insert(n,this.data.height-n.height-1,!0)}return this},insert:function(e){return e&&this._insert(e,this.data.height-1),this},clear:function(){return this.data=Ho([]),this},remove:function(e,t){if(!e)return this;for(var r=this.data,n=this.toBBox(e),i=[],s=[],a,o,u,f;r||i.length;){if(r||(r=i.pop(),o=i[i.length-1],a=s.pop(),f=!0),r.leaf&&(u=cM(e,r.children,t),u!==-1))return r.children.splice(u,1),i.push(r),this._condense(i),this;!f&&!r.leaf&&mm(r,n)?(i.push(r),s.push(a),a=0,o=r,r=r.children[0]):o?(a++,r=o.children[a],f=!1):r=null}return this},toBBox:function(e){return e},compareMinX:X_,compareMinY:j_,toJSON:function(){return this.data},fromJSON:function(e){return this.data=e,this},_all:function(e,t){for(var r=[];e;)e.leaf?t.push.apply(t,e.children):r.push.apply(r,e.children),e=r.pop();return t},_build:function(e,t,r,n){var i=r-t+1,s=this._maxEntries,a;if(i<=s)return a=Ho(e.slice(t,r+1)),Go(a,this.toBBox),a;n||(n=Math.ceil(Math.log(i)/Math.log(s)),s=Math.ceil(i/Math.pow(s,n-1))),a=Ho([]),a.leaf=!1,a.height=n;var o=Math.ceil(i/s),u=o*Math.ceil(Math.sqrt(s)),f,l,c,h;for(K_(e,t,r,u,this.compareMinX),f=t;f<=r;f+=u)for(c=Math.min(f+u-1,r),K_(e,f,c,o,this.compareMinY),l=f;l<=c;l+=o)h=Math.min(l+o-1,c),a.children.push(this._build(e,l,h,n-1));return Go(a,this.toBBox),a},_chooseSubtree:function(e,t,r,n){for(var i,s,a,o,u,f,l,c;n.push(t),!(t.leaf||n.length-1===r);){for(l=c=1/0,i=0,s=t.children.length;i<s;i++)a=t.children[i],u=dm(a),f=hM(e,a)-u,f<c?(c=f,l=u<l?u:l,o=a):f===c&&u<l&&(l=u,o=a);t=o||t.children[0]}return t},_insert:function(e,t,r){var n=this.toBBox,i=r?e:n(e),s=[],a=this._chooseSubtree(i,this.data,t,s);for(a.children.push(e),gf(a,i);t>=0&&s[t].children.length>this._maxEntries;)this._split(s,t),t--;this._adjustParentBBoxes(i,s,t)},_split:function(e,t){var r=e[t],n=r.children.length,i=this._minEntries;this._chooseSplitAxis(r,i,n);var s=this._chooseSplitIndex(r,i,n),a=Ho(r.children.splice(s,r.children.length-s));a.height=r.height,a.leaf=r.leaf,Go(r,this.toBBox),Go(a,this.toBBox),t?e[t-1].children.push(a):this._splitRoot(r,a)},_splitRoot:function(e,t){this.data=Ho([e,t]),this.data.height=e.height+1,this.data.leaf=!1,Go(this.data,this.toBBox)},_chooseSplitIndex:function(e,t,r){var n,i,s,a,o,u,f,l;for(u=f=1/0,n=t;n<=r-t;n++)i=pf(e,0,n,this.toBBox),s=pf(e,n,r,this.toBBox),a=dM(i,s),o=dm(i)+dm(s),a<u?(u=a,l=n,f=o<f?o:f):a===u&&o<f&&(f=o,l=n);return l},_chooseSplitAxis:function(e,t,r){var n=e.leaf?this.compareMinX:X_,i=e.leaf?this.compareMinY:j_,s=this._allDistMargin(e,t,r,n),a=this._allDistMargin(e,t,r,i);s<a&&e.children.sort(n)},_allDistMargin:function(e,t,r,n){e.children.sort(n);var i=this.toBBox,s=pf(e,0,t,i),a=pf(e,r-t,r,i),o=$l(s)+$l(a),u,f;for(u=t;u<r-t;u++)f=e.children[u],gf(s,e.leaf?i(f):f),o+=$l(s);for(u=r-t-1;u>=t;u--)f=e.children[u],gf(a,e.leaf?i(f):f),o+=$l(a);return o},_adjustParentBBoxes:function(e,t,r){for(var n=r;n>=0;n--)gf(t[n],e)},_condense:function(e){for(var t=e.length-1,r;t>=0;t--)e[t].children.length===0?t>0?(r=e[t-1].children,r.splice(r.indexOf(e[t]),1)):this.clear():Go(e[t],this.toBBox)},_initFormat:function(e){var t=["return a"," - b",";"];this.compareMinX=new Function("a","b",t.join(e[0])),this.compareMinY=new Function("a","b",t.join(e[1])),this.toBBox=new Function("a","return {minX: a"+e[0]+", minY: a"+e[1]+", maxX: a"+e[2]+", maxY: a"+e[3]+"};")}};function cM(e,t,r){if(!r)return t.indexOf(e);for(var n=0;n<t.length;n++)if(r(e,t[n]))return n;return-1}function Go(e,t){pf(e,0,e.children.length,t,e)}function pf(e,t,r,n,i){i||(i=Ho(null)),i.minX=1/0,i.minY=1/0,i.maxX=-1/0,i.maxY=-1/0;for(var s=t,a;s<r;s++)a=e.children[s],gf(i,e.leaf?n(a):a);return i}function gf(e,t){return e.minX=Math.min(e.minX,t.minX),e.minY=Math.min(e.minY,t.minY),e.maxX=Math.max(e.maxX,t.maxX),e.maxY=Math.max(e.maxY,t.maxY),e}function X_(e,t){return e.minX-t.minX}function j_(e,t){return e.minY-t.minY}function dm(e){return(e.maxX-e.minX)*(e.maxY-e.minY)}function $l(e){return e.maxX-e.minX+(e.maxY-e.minY)}function hM(e,t){return(Math.max(t.maxX,e.maxX)-Math.min(t.minX,e.minX))*(Math.max(t.maxY,e.maxY)-Math.min(t.minY,e.minY))}function dM(e,t){var r=Math.max(e.minX,t.minX),n=Math.max(e.minY,t.minY),i=Math.min(e.maxX,t.maxX),s=Math.min(e.maxY,t.maxY);return Math.max(0,i-r)*Math.max(0,s-n)}function mm(e,t){return e.minX<=t.minX&&e.minY<=t.minY&&t.maxX<=e.maxX&&t.maxY<=e.maxY}function ec(e,t){return t.minX<=e.maxX&&t.minY<=e.maxY&&t.maxX>=e.minX&&t.maxY>=e.minY}function Ho(e){return{children:e,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function K_(e,t,r,n,i){for(var s=[t,r],a;s.length;)r=s.pop(),t=s.pop(),!(r-t<=n)&&(a=t+Math.ceil((r-t)/n/2)*n,fM(e,a,t,r,i),s.push(t,a,a,r))}function Qs(e,t){return t={exports:{}},e(t,t.exports),t.exports}var hc=mM,Q_=+(Math.pow(2,27)+1);function mM(e,t,r){var n=e*t,i=Q_*e,s=i-e,a=i-s,o=e-a,u=Q_*t,f=u-t,l=u-f,c=t-l,h=n-a*l,d=h-o*l,m=d-a*c,g=o*c-m;return r?(r[0]=g,r[1]=n,r):[g,n]}var pM=vM;function gM(e,t){var r=e+t,n=r-e,i=r-n,s=t-n,a=e-i,o=a+s;return o?[o,r]:[r]}function vM(e,t){var r=e.length|0,n=t.length|0;if(r===1&&n===1)return gM(e[0],t[0]);var i=r+n,s=new Array(i),a=0,o=0,u=0,f=Math.abs,l=e[o],c=f(l),h=t[u],d=f(h),m,g;c<d?(g=l,o+=1,o<r&&(l=e[o],c=f(l))):(g=h,u+=1,u<n&&(h=t[u],d=f(h))),o<r&&c<d||u>=n?(m=l,o+=1,o<r&&(l=e[o],c=f(l))):(m=h,u+=1,u<n&&(h=t[u],d=f(h)));for(var p=m+g,v=p-m,_=g-v,y=_,x=p,E,S,I,P,w;o<r&&u<n;)c<d?(m=l,o+=1,o<r&&(l=e[o],c=f(l))):(m=h,u+=1,u<n&&(h=t[u],d=f(h))),g=y,p=m+g,v=p-m,_=g-v,_&&(s[a++]=_),E=x+p,S=E-x,I=E-S,P=p-S,w=x-I,y=w+P,x=E;for(;o<r;)m=l,g=y,p=m+g,v=p-m,_=g-v,_&&(s[a++]=_),E=x+p,S=E-x,I=E-S,P=p-S,w=x-I,y=w+P,x=E,o+=1,o<r&&(l=e[o]);for(;u<n;)m=h,g=y,p=m+g,v=p-m,_=g-v,_&&(s[a++]=_),E=x+p,S=E-x,I=E-S,P=p-S,w=x-I,y=w+P,x=E,u+=1,u<n&&(h=t[u]);return y&&(s[a++]=y),x&&(s[a++]=x),a||(s[a++]=0),s.length=a,s}var _M=CM;function CM(e,t,r){var n=e+t,i=n-e,s=n-i,a=t-i,o=e-s;return r?(r[0]=o+a,r[1]=n,r):[o+a,n]}var yM=xM;function xM(e,t){var r=e.length;if(r===1){var n=hc(e[0],t);return n[0]?n:[n[1]]}var i=new Array(2*r),s=[.1,.1],a=[.1,.1],o=0;hc(e[0],t,s),s[0]&&(i[o++]=s[0]);for(var u=1;u<r;++u){hc(e[u],t,a);var f=s[1];_M(f,a[0],s),s[0]&&(i[o++]=s[0]);var l=a[1],c=s[1],h=l+c,d=h-l,m=c-d;s[1]=h,m&&(i[o++]=m)}return s[1]&&(i[o++]=s[1]),o===0&&(i[o++]=0),i.length=o,i}var EM=wM;function bM(e,t){var r=e+t,n=r-e,i=r-n,s=t-n,a=e-i,o=a+s;return o?[o,r]:[r]}function wM(e,t){var r=e.length|0,n=t.length|0;if(r===1&&n===1)return bM(e[0],-t[0]);var i=r+n,s=new Array(i),a=0,o=0,u=0,f=Math.abs,l=e[o],c=f(l),h=-t[u],d=f(h),m,g;c<d?(g=l,o+=1,o<r&&(l=e[o],c=f(l))):(g=h,u+=1,u<n&&(h=-t[u],d=f(h))),o<r&&c<d||u>=n?(m=l,o+=1,o<r&&(l=e[o],c=f(l))):(m=h,u+=1,u<n&&(h=-t[u],d=f(h)));for(var p=m+g,v=p-m,_=g-v,y=_,x=p,E,S,I,P,w;o<r&&u<n;)c<d?(m=l,o+=1,o<r&&(l=e[o],c=f(l))):(m=h,u+=1,u<n&&(h=-t[u],d=f(h))),g=y,p=m+g,v=p-m,_=g-v,_&&(s[a++]=_),E=x+p,S=E-x,I=E-S,P=p-S,w=x-I,y=w+P,x=E;for(;o<r;)m=l,g=y,p=m+g,v=p-m,_=g-v,_&&(s[a++]=_),E=x+p,S=E-x,I=E-S,P=p-S,w=x-I,y=w+P,x=E,o+=1,o<r&&(l=e[o]);for(;u<n;)m=h,g=y,p=m+g,v=p-m,_=g-v,_&&(s[a++]=_),E=x+p,S=E-x,I=E-S,P=p-S,w=x-I,y=w+P,x=E,u+=1,u<n&&(h=-t[u]);return y&&(s[a++]=y),x&&(s[a++]=x),a||(s[a++]=0),s.length=a,s}var Gy=Qs(function(e){var t=5,r=11102230246251565e-32,n=(3+16*r)*r,i=(7+56*r)*r;function s(p,v){for(var _=new Array(p.length-1),y=1;y<p.length;++y)for(var x=_[y-1]=new Array(p.length-1),E=0,S=0;E<p.length;++E)E!==v&&(x[S++]=p[y][E]);return _}function a(p){for(var v=new Array(p),_=0;_<p;++_){v[_]=new Array(p);for(var y=0;y<p;++y)v[_][y]=["m",y,"[",p-_-1,"]"].join("")}return v}function o(p){return p&1?"-":""}function u(p){if(p.length===1)return p[0];if(p.length===2)return["sum(",p[0],",",p[1],")"].join("");var v=p.length>>1;return["sum(",u(p.slice(0,v)),",",u(p.slice(v)),")"].join("")}function f(p){if(p.length===2)return[["sum(prod(",p[0][0],",",p[1][1],"),prod(-",p[0][1],",",p[1][0],"))"].join("")];for(var v=[],_=0;_<p.length;++_)v.push(["scale(",u(f(s(p,_))),",",o(_),p[0][_],")"].join(""));return v}function l(p){for(var v=[],_=[],y=a(p),x=[],E=0;E<p;++E)E&1?_.push.apply(_,f(s(y,E))):v.push.apply(v,f(s(y,E))),x.push("m"+E);var S=u(v),I=u(_),P="orientation"+p+"Exact",w=["function ",P,"(",x.join(),"){var p=",S,",n=",I,",d=sub(p,n);return d[d.length-1];};return ",P].join(""),N=new Function("sum","prod","scale","sub",w);return N(pM,hc,yM,EM)}var c=l(3),h=l(4),d=[function(){return 0},function(){return 0},function(v,_){return _[0]-v[0]},function(v,_,y){var x=(v[1]-y[1])*(_[0]-y[0]),E=(v[0]-y[0])*(_[1]-y[1]),S=x-E,I;if(x>0){if(E<=0)return S;I=x+E}else if(x<0){if(E>=0)return S;I=-(x+E)}else return S;var P=n*I;return S>=P||S<=-P?S:c(v,_,y)},function(v,_,y,x){var E=v[0]-x[0],S=_[0]-x[0],I=y[0]-x[0],P=v[1]-x[1],w=_[1]-x[1],N=y[1]-x[1],B=v[2]-x[2],C=_[2]-x[2],b=y[2]-x[2],T=S*N,A=I*w,R=I*P,F=E*N,D=E*w,O=S*P,U=B*(T-A)+C*(R-F)+b*(D-O),q=(Math.abs(T)+Math.abs(A))*Math.abs(B)+(Math.abs(R)+Math.abs(F))*Math.abs(C)+(Math.abs(D)+Math.abs(O))*Math.abs(b),Y=i*q;return U>Y||-U>Y?U:h(v,_,y,x)}];function m(p){var v=d[p.length];return v||(v=d[p.length]=l(p.length)),v.apply(void 0,p)}function g(){for(;d.length<=t;)d.push(l(d.length));for(var p=[],v=["slow"],_=0;_<=t;++_)p.push("a"+_),v.push("o"+_);for(var y=["function getOrientation(",p.join(),"){switch(arguments.length){case 0:case 1:return 0;"],_=2;_<=t;++_)y.push("case ",_,":return o",_,"(",p.slice(0,_).join(),");");y.push("}var s=new Array(arguments.length);for(var i=0;i<arguments.length;++i){s[i]=arguments[i]};return slow(s);}return getOrientation"),v.push(y.join(""));var x=Function.apply(void 0,v);e.exports=x.apply(void 0,[m].concat(d));for(var _=0;_<=t;++_)e.exports[_]=d[_]}g()}),SM=TM,Z_=Gy[3];function TM(e){var t=e.length;if(t<3){for(var f=new Array(t),r=0;r<t;++r)f[r]=r;return t===2&&e[0][0]===e[1][0]&&e[0][1]===e[1][1]?[0]:f}for(var n=new Array(t),r=0;r<t;++r)n[r]=r;n.sort(function(d,m){var g=e[d][0]-e[m][0];return g||e[d][1]-e[m][1]});for(var i=[n[0],n[1]],s=[n[0],n[1]],r=2;r<t;++r){for(var a=n[r],o=e[a],u=i.length;u>1&&Z_(e[i[u-2]],e[i[u-1]],o)<=0;)u-=1,i.pop();for(i.push(a),u=s.length;u>1&&Z_(e[s[u-2]],e[s[u-1]],o)>=0;)u-=1,s.pop();s.push(a)}for(var f=new Array(s.length+i.length-2),l=0,r=0,c=i.length;r<c;++r)f[l++]=i[r];for(var h=s.length-2;h>0;--h)f[l++]=s[h];return f}var qy=Sf,IM=Sf;function Sf(e,t){if(!(this instanceof Sf))return new Sf(e,t);if(this.data=e||[],this.length=this.data.length,this.compare=t||LM,this.length>0)for(var r=(this.length>>1)-1;r>=0;r--)this._down(r)}function LM(e,t){return e<t?-1:e>t?1:0}Sf.prototype={push:function(e){this.data.push(e),this.length++,this._up(this.length-1)},pop:function(){if(this.length!==0){var e=this.data[0];return this.length--,this.length>0&&(this.data[0]=this.data[this.length],this._down(0)),this.data.pop(),e}},peek:function(){return this.data[0]},_up:function(e){for(var t=this.data,r=this.compare,n=t[e];e>0;){var i=e-1>>1,s=t[i];if(r(n,s)>=0)break;t[e]=s,e=i}t[e]=n},_down:function(e){for(var t=this.data,r=this.compare,n=this.length>>1,i=t[e];e<n;){var s=(e<<1)+1,a=s+1,o=t[s];if(a<this.length&&r(t[a],o)<0&&(s=a,o=t[a]),r(o,i)>=0)break;t[e]=o,e=s}t[e]=i}};qy.default=IM;var PM=function(e,t){for(var r=e[0],n=e[1],i=!1,s=0,a=t.length-1;s<t.length;a=s++){var o=t[s][0],u=t[s][1],f=t[a][0],l=t[a][1],c=u>n!=l>n&&r<(f-o)*(n-u)/(l-u)+o;c&&(i=!i)}return i},tc=Gy[3],Hy=Wy,MM=Wy;function Wy(e,t,r){t=Math.max(0,t===void 0?2:t),r=r||0;for(var n=NM(e),i=$o(16,["[0]","[1]","[0]","[1]"]).load(e),s=[],a=0,o;a<n.length;a++){var u=n[a];i.remove(u),o=eC(u,o),s.push(o)}var f=$o(16);for(a=0;a<s.length;a++)f.insert(pm(s[a]));for(var l=t*t,c=r*r;s.length;){var h=s.shift(),d=h.p,m=h.next.p,g=gm(d,m);if(!(g<c)){var p=g/l;u=AM(i,h.prev.p,d,m,h.next.next.p,p,f),u&&Math.min(gm(u,d),gm(u,m))<=p&&(s.push(h),s.push(eC(u,h)),i.remove(u),f.remove(h),f.insert(pm(h)),f.insert(pm(h.next)))}}h=o;var v=[];do v.push(h.p),h=h.next;while(h!==o);return v.push(h.p),v}function AM(e,t,r,n,i,s,a){for(var o=new qy(null,DM),u=e.data;u;){for(var f=0;f<u.children.length;f++){var l=u.children[f],c=u.leaf?vm(l,r,n):RM(r,n,l);c>s||o.push({node:l,dist:c})}for(;o.length&&!o.peek().node.children;){var h=o.pop(),d=h.node,m=vm(d,t,r),g=vm(d,n,i);if(h.dist<m&&h.dist<g&&$_(r,d,a)&&$_(n,d,a))return d}u=o.pop(),u&&(u=u.node)}return null}function DM(e,t){return e.dist-t.dist}function RM(e,t,r){if(J_(e,r)||J_(t,r))return 0;var n=rc(e[0],e[1],t[0],t[1],r.minX,r.minY,r.maxX,r.minY);if(n===0)return 0;var i=rc(e[0],e[1],t[0],t[1],r.minX,r.minY,r.minX,r.maxY);if(i===0)return 0;var s=rc(e[0],e[1],t[0],t[1],r.maxX,r.minY,r.maxX,r.maxY);if(s===0)return 0;var a=rc(e[0],e[1],t[0],t[1],r.minX,r.maxY,r.maxX,r.maxY);return a===0?0:Math.min(n,i,s,a)}function J_(e,t){return e[0]>=t.minX&&e[0]<=t.maxX&&e[1]>=t.minY&&e[1]<=t.maxY}function $_(e,t,r){for(var n=Math.min(e[0],t[0]),i=Math.min(e[1],t[1]),s=Math.max(e[0],t[0]),a=Math.max(e[1],t[1]),o=r.search({minX:n,minY:i,maxX:s,maxY:a}),u=0;u<o.length;u++)if(OM(o[u].p,o[u].next.p,e,t))return!1;return!0}function OM(e,t,r,n){return e!==n&&t!==r&&tc(e,t,r)>0!=tc(e,t,n)>0&&tc(r,n,e)>0!=tc(r,n,t)>0}function pm(e){var t=e.p,r=e.next.p;return e.minX=Math.min(t[0],r[0]),e.minY=Math.min(t[1],r[1]),e.maxX=Math.max(t[0],r[0]),e.maxY=Math.max(t[1],r[1]),e}function NM(e){for(var t=e[0],r=e[0],n=e[0],i=e[0],s=0;s<e.length;s++){var a=e[s];a[0]<t[0]&&(t=a),a[0]>n[0]&&(n=a),a[1]<r[1]&&(r=a),a[1]>i[1]&&(i=a)}var o=[t,r,n,i],u=o.slice();for(s=0;s<e.length;s++)PM(e[s],o)||u.push(e[s]);var f=SM(u),l=[];for(s=0;s<f.length;s++)l.push(u[f[s]]);return l}function eC(e,t){var r={p:e,prev:null,next:null,minX:0,minY:0,maxX:0,maxY:0};return t?(r.next=t.next,r.prev=t,t.next.prev=r,t.next=r):(r.prev=r,r.next=r),r}function gm(e,t){var r=e[0]-t[0],n=e[1]-t[1];return r*r+n*n}function vm(e,t,r){var n=t[0],i=t[1],s=r[0]-n,a=r[1]-i;if(s!==0||a!==0){var o=((e[0]-n)*s+(e[1]-i)*a)/(s*s+a*a);o>1?(n=r[0],i=r[1]):o>0&&(n+=s*o,i+=a*o)}return s=e[0]-n,a=e[1]-i,s*s+a*a}function rc(e,t,r,n,i,s,a,o){var u=r-e,f=n-t,l=a-i,c=o-s,h=e-i,d=t-s,m=u*u+f*f,g=u*l+f*c,p=l*l+c*c,v=u*h+f*d,_=l*h+c*d,y=m*p-g*g,x,E,S,I,P=y,w=y;y===0?(E=0,P=1,I=_,w=p):(E=g*_-p*v,I=m*_-g*v,E<0?(E=0,I=_,w=p):E>P&&(E=P,I=_+g,w=p)),I<0?(I=0,-v<0?E=0:-v>m?E=P:(E=-v,P=m)):I>w&&(I=w,-v+g<0?E=0:-v+g>m?E=P:(E=-v+g,P=m)),x=E===0?0:E/P,S=I===0?0:I/w;var N=(1-x)*e+x*r,B=(1-x)*t+x*n,C=(1-S)*i+S*a,b=(1-S)*s+S*o,T=C-N,A=b-B;return T*T+A*A}Hy.default=MM;function Yy(e,t){if(t=t||{},!fe(t))throw new Error("options is invalid");var r=t.concavity||1/0,n=[];if(mr(e,function(s){n.push([s[0],s[1]])}),!n.length)return null;var i=Hy(n,r);return i.length>3?ze([i]):null}function Ut(e,t,r){if(r=r||{},typeof r!="object")throw new Error("options is invalid");var n=r.ignoreBoundary;if(!e)throw new Error("point is required");if(!t)throw new Error("polygon is required");var i=Vt(e),s=le(t),a=t.geometry?t.geometry.type:t.type,o=t.bbox;if(o&&FM(i,o)===!1)return!1;a==="Polygon"&&(s=[s]);for(var u=0,f=!1;u<s.length&&!f;u++)if(tC(i,s[u][0],n)){for(var l=!1,c=1;c<s[u].length&&!l;)tC(i,s[u][c],!n)&&(l=!0),c++;l||(f=!0)}return f}function tC(e,t,r){var n=!1;t[0][0]===t[t.length-1][0]&&t[0][1]===t[t.length-1][1]&&(t=t.slice(0,t.length-1));for(var i=0,s=t.length-1;i<t.length;s=i++){var a=t[i][0],o=t[i][1],u=t[s][0],f=t[s][1],l=e[1]*(a-u)+o*(u-e[0])+f*(e[0]-a)===0&&(a-e[0])*(u-e[0])<=0&&(o-e[1])*(f-e[1])<=0;if(l)return!r;var c=o>e[1]!=f>e[1]&&e[0]<(u-a)*(e[1]-o)/(f-o)+a;c&&(n=!n)}return n}function FM(e,t){return t[0]<=e[0]&&t[1]<=e[1]&&t[2]>=e[0]&&t[3]>=e[1]}function Dm(e,t){var r=[];return Mi(t,function(n){wt(e,function(i){Ut(i,n)&&r.push(i)})}),ge(r)}function Xy(e,t){if(e.type!=="FeatureCollection")throw new Error("points must be a FeatureCollection");var r=!1;return ge(zM(e.features.map(function(n){var i={x:n.geometry.coordinates[0],y:n.geometry.coordinates[1]};return t?i.z=n.properties[t]:n.geometry.coordinates.length===3&&(r=!0,i.z=n.geometry.coordinates[2]),i})).map(function(n){var i=[n.a.x,n.a.y],s=[n.b.x,n.b.y],a=[n.c.x,n.c.y],o={};return r?(i.push(n.a.z),s.push(n.b.z),a.push(n.c.z)):o={a:n.a.z,b:n.b.z,c:n.c.z},ze([[i,s,a,i]],o)}))}function rC(e,t,r){this.a=e,this.b=t,this.c=r;var n=t.x-e.x,i=t.y-e.y,s=r.x-e.x,a=r.y-e.y,o=n*(e.x+t.x)+i*(e.y+t.y),u=s*(e.x+r.x)+a*(e.y+r.y),f=2*(n*(r.y-t.y)-i*(r.x-t.x)),l,c;this.x=(a*o-i*u)/f,this.y=(n*u-s*o)/f,l=this.x-e.x,c=this.y-e.y,this.r=l*l+c*c}function BM(e,t){return t.x-e.x}function VM(e){var t=e.length,r,n,i,s,a;e:for(;t;)for(n=e[--t],r=e[--t],i=t;i;)if(a=e[--i],s=e[--i],r===s&&n===a||r===a&&n===s){e.splice(t,2),e.splice(i,2),t-=2;continue e}}function zM(e){if(e.length<3)return[];e.sort(BM);for(var t=e.length-1,r=e[t].x,n=e[0].x,i=e[t].y,s=i,a=1e-12,o,u,f,l,c,h;t--;)e[t].y<i&&(i=e[t].y),e[t].y>s&&(s=e[t].y);var d=n-r,m=s-i,g=d>m?d:m,p=(n+r)*.5,v=(s+i)*.5,_=[new rC({x:p-20*g,y:v-g,__sentinel:!0},{x:p,y:v+20*g,__sentinel:!0},{x:p+20*g,y:v-g,__sentinel:!0})],y=[],x=[],E;for(t=e.length;t--;){for(x.length=0,E=_.length;E--;){if(d=e[t].x-_[E].x,d>0&&d*d>_[E].r){y.push(_[E]),_.splice(E,1);continue}m=e[t].y-_[E].y,!(d*d+m*m>_[E].r)&&(x.push(_[E].a,_[E].b,_[E].b,_[E].c,_[E].c,_[E].a),_.splice(E,1))}for(VM(x),E=x.length;E;)u=x[--E],o=x[--E],f=e[t],l=u.x-o.x,c=u.y-o.y,h=2*(l*(f.y-u.y)-c*(f.x-u.x)),Math.abs(h)>a&&_.push(new rC(o,u,f))}for(Array.prototype.push.apply(y,_),t=y.length;t--;)(y[t].a.__sentinel||y[t].b.__sentinel||y[t].c.__sentinel)&&y.splice(t,1);return y}function Et(e,t,r){if(r=r||{},!fe(r))throw new Error("options is invalid");var n=r.units,i=Vt(e),s=Vt(t),a=dr(s[1]-i[1]),o=dr(s[0]-i[0]),u=dr(i[1]),f=dr(s[1]),l=Math.pow(Math.sin(a/2),2)+Math.pow(Math.sin(o/2),2)*Math.cos(u)*Math.cos(f);return Jo(2*Math.atan2(Math.sqrt(l),Math.sqrt(1-l)),n)}function Kr(e){if(!e)throw new Error("geojson is required");switch(e.type){case"Feature":return jy(e);case"FeatureCollection":return kM(e);case"Point":case"LineString":case"Polygon":case"MultiPoint":case"MultiLineString":case"MultiPolygon":case"GeometryCollection":return sp(e);default:throw new Error("unknown GeoJSON type")}}function jy(e){var t={type:"Feature"};return Object.keys(e).forEach(function(r){switch(r){case"type":case"properties":case"geometry":return;default:t[r]=e[r]}}),t.properties=Ky(e.properties),t.geometry=sp(e.geometry),t}function Ky(e){var t={};return e&&Object.keys(e).forEach(function(r){var n=e[r];typeof n=="object"?n===null?t[r]=null:n.length?t[r]=n.map(function(i){return i}):t[r]=Ky(n):t[r]=n}),t}function kM(e){var t={type:"FeatureCollection"};return Object.keys(e).forEach(function(r){switch(r){case"type":case"features":return;default:t[r]=e[r]}}),t.features=e.features.map(function(r){return jy(r)}),t}function sp(e){var t={type:e.type};return e.bbox&&(t.bbox=e.bbox),e.type==="GeometryCollection"?(t.geometries=e.geometries.map(function(r){return sp(r)}),t):(t.coordinates=Qy(e.coordinates),t)}function Qy(e){return typeof e[0]!="object"?e.slice():e.map(function(t){return Qy(t)})}var UM=function(e){return e},GM=function(e){if(e==null)return UM;var t,r,n=e.scale[0],i=e.scale[1],s=e.translate[0],a=e.translate[1];return function(o,u){u||(t=r=0);var f=2,l=o.length,c=new Array(l);for(c[0]=(t+=o[0])*n+s,c[1]=(r+=o[1])*i+a;f<l;)c[f]=o[f],++f;return c}},qM=function(e,t){for(var r,n=e.length,i=n-t;i<--n;)r=e[i],e[i++]=e[n],e[n]=r};function Zy(e,t){var r=GM(e.transform),n=e.arcs;function i(l,c){c.length&&c.pop();for(var h=n[l<0?~l:l],d=0,m=h.length;d<m;++d)c.push(r(h[d],d));l<0&&qM(c,m)}function s(l){return r(l)}function a(l){for(var c=[],h=0,d=l.length;h<d;++h)i(l[h],c);return c.length<2&&c.push(c[0]),c}function o(l){for(var c=a(l);c.length<4;)c.push(c[0]);return c}function u(l){return l.map(o)}function f(l){var c=l.type,h;switch(c){case"GeometryCollection":return{type:c,geometries:l.geometries.map(f)};case"Point":h=s(l.coordinates);break;case"MultiPoint":h=l.coordinates.map(s);break;case"LineString":h=a(l.arcs);break;case"MultiLineString":h=l.arcs.map(a);break;case"Polygon":h=u(l.arcs);break;case"MultiPolygon":h=l.arcs.map(u);break;default:return null}return{type:c,coordinates:h}}return f(t)}var HM=function(e,t){var r={},n={},i={},s=[],a=-1;t.forEach(function(f,l){var c=e.arcs[f<0?~f:f],h;c.length<3&&!c[1][0]&&!c[1][1]&&(h=t[++a],t[a]=f,t[l]=h)}),t.forEach(function(f){var l=o(f),c=l[0],h=l[1],d,m;if(d=i[c])if(delete i[d.end],d.push(f),d.end=h,m=n[h]){delete n[m.start];var g=m===d?d:d.concat(m);n[g.start=d.start]=i[g.end=m.end]=g}else n[d.start]=i[d.end]=d;else if(d=n[h])if(delete n[d.start],d.unshift(f),d.start=c,m=i[c]){delete i[m.end];var p=m===d?d:m.concat(d);n[p.start=m.start]=i[p.end=d.end]=p}else n[d.start]=i[d.end]=d;else d=[f],n[d.start=c]=i[d.end=h]=d});function o(f){var l=e.arcs[f<0?~f:f],c=l[0],h;return e.transform?(h=[0,0],l.forEach(function(d){h[0]+=d[0],h[1]+=d[1]})):h=l[l.length-1],f<0?[h,c]:[c,h]}function u(f,l){for(var c in f){var h=f[c];delete l[h.start],delete h.start,delete h.end,h.forEach(function(d){r[d<0?~d:d]=1}),s.push(h)}}return u(i,n),u(n,i),t.forEach(function(f){r[f<0?~f:f]||s.push([f])}),s};function WM(e){for(var t=-1,r=e.length,n,i=e[r-1],s=0;++t<r;)n=i,i=e[t],s+=n[0]*i[1]-n[1]*i[0];return Math.abs(s)}var YM=function(e){return Zy(e,XM.apply(this,arguments))};function XM(e,t){var r={},n=[],i=[];t.forEach(s);function s(u){switch(u.type){case"GeometryCollection":u.geometries.forEach(s);break;case"Polygon":a(u.arcs);break;case"MultiPolygon":u.arcs.forEach(a);break}}function a(u){u.forEach(function(f){f.forEach(function(l){(r[l=l<0?~l:l]||(r[l]=[])).push(u)})}),n.push(u)}function o(u){return WM(Zy(e,{type:"Polygon",arcs:[u]}).coordinates[0])}return n.forEach(function(u){if(!u._){var f=[],l=[u];for(u._=1,i.push(f);u=l.pop();)f.push(u),u.forEach(function(c){c.forEach(function(h){r[h<0?~h:h].forEach(function(d){d._||(d._=1,l.push(d))})})})}}),n.forEach(function(u){delete u._}),{type:"MultiPolygon",arcs:i.map(function(u){var f=[],l;if(u.forEach(function(g){g.forEach(function(p){p.forEach(function(v){r[v<0?~v:v].length<2&&f.push(v)})})}),f=HM(e,f),(l=f.length)>1)for(var c=1,h=o(f[0]),d,m;c<l;++c)(d=o(f[c]))>h&&(m=f[0],f[0]=f[c],f[c]=m,h=d);return f})}}var jM=function(e){var t=1/0,r=1/0,n=-1/0,i=-1/0;function s(c){c!=null&&a.hasOwnProperty(c.type)&&a[c.type](c)}var a={GeometryCollection:function(c){c.geometries.forEach(s)},Point:function(c){o(c.coordinates)},MultiPoint:function(c){c.coordinates.forEach(o)},LineString:function(c){u(c.arcs)},MultiLineString:function(c){c.arcs.forEach(u)},Polygon:function(c){c.arcs.forEach(u)},MultiPolygon:function(c){c.arcs.forEach(f)}};function o(c){var h=c[0],d=c[1];h<t&&(t=h),h>n&&(n=h),d<r&&(r=d),d>i&&(i=d)}function u(c){c.forEach(o)}function f(c){c.forEach(u)}for(var l in e)s(e[l]);return n>=t&&i>=r?[t,r,n,i]:void 0},KM=function(e,t,r,n,i){arguments.length===3&&(n=Array,i=null);for(var s=new n(e=1<<Math.max(4,Math.ceil(Math.log(e)/Math.LN2))),a=e-1,o=0;o<e;++o)s[o]=i;function u(c){for(var h=t(c)&a,d=s[h],m=0;d!=i;){if(r(d,c))return!0;if(++m>=e)throw new Error("full hashset");d=s[h=h+1&a]}return s[h]=c,!0}function f(c){for(var h=t(c)&a,d=s[h],m=0;d!=i;){if(r(d,c))return!0;if(++m>=e)break;d=s[h=h+1&a]}return!1}function l(){for(var c=[],h=0,d=s.length;h<d;++h){var m=s[h];m!=i&&c.push(m)}return c}return{add:u,has:f,values:l}},ap=function(e,t,r,n,i,s){arguments.length===3&&(n=s=Array,i=null);for(var a=new n(e=1<<Math.max(4,Math.ceil(Math.log(e)/Math.LN2))),o=new s(e),u=e-1,f=0;f<e;++f)a[f]=i;function l(m,g){for(var p=t(m)&u,v=a[p],_=0;v!=i;){if(r(v,m))return o[p]=g;if(++_>=e)throw new Error("full hashmap");v=a[p=p+1&u]}return a[p]=m,o[p]=g,g}function c(m,g){for(var p=t(m)&u,v=a[p],_=0;v!=i;){if(r(v,m))return o[p];if(++_>=e)throw new Error("full hashmap");v=a[p=p+1&u]}return a[p]=m,o[p]=g,g}function h(m,g){for(var p=t(m)&u,v=a[p],_=0;v!=i;){if(r(v,m))return o[p];if(++_>=e)break;v=a[p=p+1&u]}return g}function d(){for(var m=[],g=0,p=a.length;g<p;++g){var v=a[g];v!=i&&m.push(v)}return m}return{set:l,maybeSet:c,get:h,keys:d}},Za=function(e,t){return e[0]===t[0]&&e[1]===t[1]},Jy=new ArrayBuffer(16),nC=new Float64Array(Jy),nc=new Uint32Array(Jy),Rm=function(e){nC[0]=e[0],nC[1]=e[1];var t=nc[0]^nc[1];return t=t<<5^t>>7^nc[2]^nc[3],t&2147483647},QM=function(e){var t=e.coordinates,r=e.lines,n=e.rings,i=S(),s=new Int32Array(t.length),a=new Int32Array(t.length),o=new Int32Array(t.length),u=new Int8Array(t.length),f=0,l,c,h,d,m;for(l=0,c=t.length;l<c;++l)s[l]=a[l]=o[l]=-1;for(l=0,c=r.length;l<c;++l){var g=r[l],p=g[0],v=g[1];for(d=i[p],m=i[++p],++f,u[d]=1;++p<=v;)E(l,h=d,d=m,m=i[p]);++f,u[m]=1}for(l=0,c=t.length;l<c;++l)s[l]=-1;for(l=0,c=n.length;l<c;++l){var _=n[l],y=_[0]+1,x=_[1];for(h=i[x-1],d=i[y-1],m=i[y],E(l,h,d,m);++y<=x;)E(l,h=d,d=m,m=i[y])}function E(B,C,b,T){if(s[b]!==B){s[b]=B;var A=a[b];if(A>=0){var R=o[b];(A!==C||R!==T)&&(A!==T||R!==C)&&(++f,u[b]=1)}else a[b]=C,o[b]=T}}function S(){for(var B=ap(t.length*1.4,I,P,Int32Array,-1,Int32Array),C=new Int32Array(t.length),b=0,T=t.length;b<T;++b)C[b]=B.maybeSet(b,b);return C}function I(B){return Rm(t[B])}function P(B,C){return Za(t[B],t[C])}s=a=o=null;var w=KM(f*1.4,Rm,Za),N;for(l=0,c=t.length;l<c;++l)u[N=i[l]]&&w.add(t[N]);return w},ZM=function(e){var t=QM(e),r=e.coordinates,n=e.lines,i=e.rings,s,a,o;for(a=0,o=n.length;a<o;++a)for(var u=n[a],f=u[0],l=u[1];++f<l;)t.has(r[f])&&(s={0:f,1:u[1]},u[1]=f,u=u.next=s);for(a=0,o=i.length;a<o;++a)for(var c=i[a],h=c[0],d=h,m=c[1],g=t.has(r[h]);++d<m;)t.has(r[d])&&(g?(s={0:d,1:c[1]},c[1]=d,c=c.next=s):(JM(r,h,m,m-d),r[m]=r[h],g=!0,d=h));return e};function JM(e,t,r,n){_m(e,t,r),_m(e,t,t+n),_m(e,t+n,r)}function _m(e,t,r){for(var n=t+(r---t>>1),i;t<n;++t,--r)i=e[t],e[t]=e[r],e[r]=i}var $M=function(e){var t=e.coordinates,r=e.lines,n,i=e.rings,s,a=r.length+i.length,o,u;for(delete e.lines,delete e.rings,o=0,u=r.length;o<u;++o)for(n=r[o];n=n.next;)++a;for(o=0,u=i.length;o<u;++o)for(s=i[o];s=s.next;)++a;var f=ap(a*2*1.4,Rm,Za),l=e.arcs=[];for(o=0,u=r.length;o<u;++o){n=r[o];do c(n);while(n=n.next)}for(o=0,u=i.length;o<u;++o)if(s=i[o],s.next)do c(s);while(s=s.next);else h(s);function c(_){var y,x,E,S,I,P,w,N;if(E=f.get(y=t[_[0]])){for(w=0,N=E.length;w<N;++w)if(S=E[w],d(S,_)){_[0]=S[0],_[1]=S[1];return}}if(I=f.get(x=t[_[1]])){for(w=0,N=I.length;w<N;++w)if(P=I[w],m(P,_)){_[1]=P[0],_[0]=P[1];return}}E?E.push(_):f.set(y,[_]),I?I.push(_):f.set(x,[_]),l.push(_)}function h(_){var y,x,E,S,I;if(x=f.get(y=t[_[0]]))for(S=0,I=x.length;S<I;++S){if(E=x[S],g(E,_)){_[0]=E[0],_[1]=E[1];return}if(p(E,_)){_[0]=E[1],_[1]=E[0];return}}if(x=f.get(y=t[_[0]+v(_)]))for(S=0,I=x.length;S<I;++S){if(E=x[S],g(E,_)){_[0]=E[0],_[1]=E[1];return}if(p(E,_)){_[0]=E[1],_[1]=E[0];return}}x?x.push(_):f.set(y,[_]),l.push(_)}function d(_,y){var x=_[0],E=y[0],S=_[1],I=y[1];if(x-S!==E-I)return!1;for(;x<=S;++x,++E)if(!Za(t[x],t[E]))return!1;return!0}function m(_,y){var x=_[0],E=y[0],S=_[1],I=y[1];if(x-S!==E-I)return!1;for(;x<=S;++x,--I)if(!Za(t[x],t[I]))return!1;return!0}function g(_,y){var x=_[0],E=y[0],S=_[1],I=y[1],P=S-x;if(P!==I-E)return!1;for(var w=v(_),N=v(y),B=0;B<P;++B)if(!Za(t[x+(B+w)%P],t[E+(B+N)%P]))return!1;return!0}function p(_,y){var x=_[0],E=y[0],S=_[1],I=y[1],P=S-x;if(P!==I-E)return!1;for(var w=v(_),N=P-v(y),B=0;B<P;++B)if(!Za(t[x+(B+w)%P],t[I-(B+N)%P]))return!1;return!0}function v(_){for(var y=_[0],x=_[1],E=y,S=E,I=t[E];++E<x;){var P=t[E];(P[0]<I[0]||P[0]===I[0]&&P[1]<I[1])&&(S=E,I=P)}return S-y}return e},eA=function(e){for(var t=-1,r=e.length;++t<r;){for(var n=e[t],i=0,s=1,a=n.length,o=n[0],u=o[0],f=o[1],l,c;++i<a;)o=n[i],l=o[0],c=o[1],(l!==u||c!==f)&&(n[s++]=[l-u,c-f],u=l,f=c);s===1&&(n[s++]=[0,0]),n.length=s}return e},tA=function(e){var t=-1,r=[],n=[],i=[];function s(c){c&&a.hasOwnProperty(c.type)&&a[c.type](c)}var a={GeometryCollection:function(c){c.geometries.forEach(s)},LineString:function(c){c.arcs=o(c.arcs)},MultiLineString:function(c){c.arcs=c.arcs.map(o)},Polygon:function(c){c.arcs=c.arcs.map(u)},MultiPolygon:function(c){c.arcs=c.arcs.map(f)}};function o(c){for(var h=0,d=c.length;h<d;++h)i[++t]=c[h];var m={0:t-d+1,1:t};return r.push(m),m}function u(c){for(var h=0,d=c.length;h<d;++h)i[++t]=c[h];var m={0:t-d+1,1:t};return n.push(m),m}function f(c){return c.map(u)}for(var l in e)s(e[l]);return{type:"Topology",coordinates:i,lines:r,rings:n,objects:e}},rA=function(e){var t={},r;for(r in e)t[r]=nA(e[r]);return t};function nA(e){return e==null?{type:null}:(e.type==="FeatureCollection"?iA:e.type==="Feature"?$y:op)(e)}function iA(e){var t={type:"GeometryCollection",geometries:e.features.map($y)};return e.bbox!=null&&(t.bbox=e.bbox),t}function $y(e){var t=op(e.geometry),r;e.id!=null&&(t.id=e.id),e.bbox!=null&&(t.bbox=e.bbox);for(r in e.properties){t.properties=e.properties;break}return t}function op(e){if(e==null)return{type:null};var t=e.type==="GeometryCollection"?{type:"GeometryCollection",geometries:e.geometries.map(op)}:e.type==="Point"||e.type==="MultiPoint"?{type:e.type,coordinates:e.coordinates}:{type:e.type,arcs:e.coordinates};return e.bbox!=null&&(t.bbox=e.bbox),t}var sA=function(e,t,r){var n=t[0],i=t[1],s=t[2],a=t[3],o=s-n?(r-1)/(s-n):1,u=a-i?(r-1)/(a-i):1;function f(v){return[Math.round((v[0]-n)*o),Math.round((v[1]-i)*u)]}function l(v,_){for(var y=-1,x=0,E=v.length,S=new Array(E),I,P,w,N,B;++y<E;)I=v[y],N=Math.round((I[0]-n)*o),B=Math.round((I[1]-i)*u),(N!==P||B!==w)&&(S[x++]=[P=N,w=B]);for(S.length=x;x<_;)x=S.push([S[0][0],S[0][1]]);return S}function c(v){return l(v,2)}function h(v){return l(v,4)}function d(v){return v.map(h)}function m(v){v!=null&&g.hasOwnProperty(v.type)&&g[v.type](v)}var g={GeometryCollection:function(v){v.geometries.forEach(m)},Point:function(v){v.coordinates=f(v.coordinates)},MultiPoint:function(v){v.coordinates=v.coordinates.map(f)},LineString:function(v){v.arcs=c(v.arcs)},MultiLineString:function(v){v.arcs=v.arcs.map(c)},Polygon:function(v){v.arcs=d(v.arcs)},MultiPolygon:function(v){v.arcs=v.arcs.map(d)}};for(var p in e)m(e[p]);return{scale:[1/o,1/u],translate:[n,i]}},aA=function(e,t){var r=jM(e=rA(e)),n=t>0&&r&&sA(e,r,t),i=$M(ZM(tA(e))),s=i.coordinates,a=ap(i.arcs.length*1.4,oA,uA);e=i.objects,i.bbox=r,i.arcs=i.arcs.map(function(h,d){return a.set(h,d),s.slice(h[0],h[1]+1)}),delete i.coordinates,s=null;function o(h){h&&u.hasOwnProperty(h.type)&&u[h.type](h)}var u={GeometryCollection:function(h){h.geometries.forEach(o)},LineString:function(h){h.arcs=f(h.arcs)},MultiLineString:function(h){h.arcs=h.arcs.map(f)},Polygon:function(h){h.arcs=h.arcs.map(f)},MultiPolygon:function(h){h.arcs=h.arcs.map(l)}};function f(h){var d=[];do{var m=a.get(h);d.push(h[0]<h[1]?m:~m)}while(h=h.next);return d}function l(h){return h.map(f)}for(var c in e)o(e[c]);return n&&(i.transform=n,i.arcs=eA(i.arcs)),i};function oA(e){var t=e[0],r=e[1],n;return r<t&&(n=t,t=r,r=n),t+31*r}function uA(e,t){var r=e[0],n=e[1],i=t[0],s=t[1],a;return n<r&&(a=r,r=n,n=a),s<i&&(a=i,i=s,s=a),r===i&&n===s}function fA(e,t){if(t=t||{},!fe(t))throw new Error("options is invalid");var r=t.mutate;if(Mt(e)!=="FeatureCollection")throw new Error("geojson must be a FeatureCollection");if(!e.features.length)throw new Error("geojson is empty");(r===!1||r===void 0)&&(e=Kr(e));var n=[],i=ip(e,function(s,a){var o=lA(s,a);return o||(n.push(s),a)});return i&&n.push(i),n.length?n.length===1?n[0]:Ra(n.map(function(s){return s.coordinates})):null}function ic(e){return e[0].toString()+","+e[1].toString()}function lA(e,t){var r=e.geometry.coordinates,n=t.geometry.coordinates,i=ic(r[0]),s=ic(r[r.length-1]),a=ic(n[0]),o=ic(n[n.length-1]),u;if(i===o)u=n.concat(r.slice(1));else if(a===s)u=r.concat(n.slice(1));else if(i===a)u=r.slice(1).reverse().concat(n);else if(s===o)u=r.concat(n.reverse().slice(1));else return null;return Pt(u)}function cA(e,t){if(t=t||{},!fe(t))throw new Error("options is invalid");var r=t.mutate;if(Mt(e)!=="FeatureCollection")throw new Error("geojson must be a FeatureCollection");if(!e.features.length)throw new Error("geojson is empty");(r===!1||r===void 0)&&(e=Kr(e));var n=[];Jt(e,function(s){n.push(s.geometry)});var i=aA({geoms:Jm(n).geometry});return YM(i,i.objects.geoms.geometries)}function hA(e,t){if(t=t||{},!fe(t))throw new Error("options is invalid");var r=t.mutate;if(Mt(e)!=="FeatureCollection")throw new Error("geojson must be a FeatureCollection");if(!e.features.length)throw new Error("geojson is empty");(r===!1||r===void 0)&&(e=Kr(e));var n=dA(e);if(!n)throw new Error("geojson must be homogenous");switch(n){case"LineString":return fA(e,t);case"Polygon":return cA(e,t);default:throw new Error(n+" is not supported")}}function dA(e){var t={};Jt(e,function(n){t[n.geometry.type]=!0});var r=Object.keys(t);return r.length===1?r[0]:null}function mA(e,t){if(t=t||{},!fe(t))throw new Error("options is invalid");if(!e)throw new Error("points is required");var r=t.maxEdge||1/0;if(!bt(r))throw new Error("maxEdge is invalid");var n=pA(e),i=Xy(n);if(i.features=i.features.filter(function(a){var o=a.geometry.coordinates[0][0],u=a.geometry.coordinates[0][1],f=a.geometry.coordinates[0][2],l=Et(o,u,t),c=Et(u,f,t),h=Et(o,f,t);return l<=r&&c<=r&&h<=r}),i.features.length<1)return null;var s=hA(i,t);return s.coordinates.length===1&&(s.coordinates=s.coordinates[0],s.type="Polygon"),nr(s)}function pA(e){var t=[],r={};return wt(e,function(n){if(n.geometry){var i=n.geometry.coordinates.join("-");r.hasOwnProperty(i)||(t.push(n),r[i]=!0)}}),ge(t)}function gA(e,t,r,n){var i=$o(6),s=t.features.map(function(a){return{minX:a.geometry.coordinates[0],minY:a.geometry.coordinates[1],maxX:a.geometry.coordinates[0],maxY:a.geometry.coordinates[1],property:a.properties[r]}});return i.load(s),e.features.forEach(function(a){a.properties||(a.properties={});var o=ur(a),u=i.search({minX:o[0],minY:o[1],maxX:o[2],maxY:o[3]}),f=[];u.forEach(function(l){Ut([l.minX,l.minY],a)&&f.push(l.property)}),a.properties[n]=f}),e}function vA(e,t){if(t=t||{},!fe(t))throw new Error("options is invalid");var r=t.mutate;if(!e)throw new Error("geojson is required");return(r===!1||r===void 0)&&(e=Kr(e)),mr(e,function(n){var i=n[0],s=n[1];n[0]=s,n[1]=i}),e}function ks(e,t){var r=typeof t=="object"?t.mutate:t;if(!e)throw new Error("geojson is required");var n=Mt(e),i=[];switch(n){case"LineString":i=Cm(e);break;case"MultiLineString":case"Polygon":le(e).forEach(function(a){i.push(Cm(a))});break;case"MultiPolygon":le(e).forEach(function(a){var o=[];a.forEach(function(u){o.push(Cm(u))}),i.push(o)});break;case"Point":return e;case"MultiPoint":var s={};le(e).forEach(function(a){var o=a.join("-");s.hasOwnProperty(o)||(i.push(a),s[o]=!0)});break;default:throw new Error(n+" geometry not supported")}return e.coordinates?r===!0?(e.coordinates=i,e):{type:n,coordinates:i}:r===!0?(e.geometry.coordinates=i,e):nr({type:n,coordinates:i},e.properties,e.bbox,e.id)}function Cm(e){var t=le(e);if(t.length===2&&!_A(t[0],t[1]))return t;var r,n,i,s=[],a=t.length-1;s.push(t[0]);for(var o=1;o<a;o++)r=t[o-1],n=t[o],i=t[o+1],CA(r,i,n)||s.push(n);return s.push(i),s}function _A(e,t){return e[0]===t[0]&&e[1]===t[1]}function CA(e,t,r){var n=r[0],i=r[1],s=e[0],a=e[1],o=t[0],u=t[1],f=n-s,l=i-a,c=o-s,h=u-a,d=f*h-l*c;return d!==0?!1:Math.abs(c)>=Math.abs(h)?c>0?s<=n&&n<=o:o<=n&&n<=s:h>0?a<=i&&i<=u:u<=i&&i<=a}function yA(e,t){var r=e.x-t.x,n=e.y-t.y;return r*r+n*n}function xA(e,t,r){var n=t.x,i=t.y,s=r.x-n,a=r.y-i;if(s!==0||a!==0){var o=((e.x-n)*s+(e.y-i)*a)/(s*s+a*a);o>1?(n=r.x,i=r.y):o>0&&(n+=s*o,i+=a*o)}return s=e.x-n,a=e.y-i,s*s+a*a}function EA(e,t){for(var r=e[0],n=[r],i,s=1,a=e.length;s<a;s++)i=e[s],yA(i,r)>t&&(n.push(i),r=i);return r!==i&&n.push(i),n}function Om(e,t,r,n,i){for(var s=n,a,o=t+1;o<r;o++){var u=xA(e[o],e[t],e[r]);u>s&&(a=o,s=u)}s>n&&(a-t>1&&Om(e,t,a,n,i),i.push(e[a]),r-a>1&&Om(e,a,r,n,i))}function bA(e,t){var r=e.length-1,n=[e[0]];return Om(e,0,r,t,n),n.push(e[r]),n}function Nm(e,t,r){if(e.length<=2)return e;var n=t!==void 0?t*t:1;return e=r?e:EA(e,n),e=bA(e,n),e}function wA(e,t){if(t=t||{},!fe(t))throw new Error("options is invalid");var r=t.tolerance!==void 0?t.tolerance:1,n=t.highQuality||!1,i=t.mutate||!1;if(!e)throw new Error("geojson is required");if(r&&r<0)throw new Error("invalid tolerance");return i!==!0&&(e=Kr(e)),Mi(e,function(s){SA(s,r,n)}),e}function SA(e,t,r){var n=e.type;if(n==="Point"||n==="MultiPoint")return e;ks(e,!0);var i=e.coordinates;switch(n){case"LineString":e.coordinates=iC(i,t,r);break;case"MultiLineString":e.coordinates=i.map(function(s){return iC(s,t,r)});break;case"Polygon":e.coordinates=sC(i,t,r);break;case"MultiPolygon":e.coordinates=i.map(function(s){return sC(s,t,r)})}return e}function iC(e,t,r){return Nm(e.map(function(n){return{x:n[0],y:n[1],z:n[2]}}),t,r).map(function(n){return n.z?[n.x,n.y,n.z]:[n.x,n.y]})}function sC(e,t,r){return e.map(function(n){var i=n.map(function(a){return{x:a[0],y:a[1]}});if(i.length<4)throw new Error("invalid polygon");for(var s=Nm(i,t,r).map(function(a){return[a.x,a.y]});!TA(s);)t-=t*.01,s=Nm(i,t,r).map(function(a){return[a.x,a.y]});return(s[s.length-1][0]!==s[0][0]||s[s.length-1][1]!==s[0][1])&&s.push(s[0]),s})}function TA(e){return e.length<3?!1:!(e.length===3&&e[2][0]===e[0][0]&&e[2][1]===e[0][1])}var Gc=function(e){this.points=e.points||[],this.duration=e.duration||1e4,this.sharpness=e.sharpness||.85,this.centers=[],this.controls=[],this.stepLength=e.stepLength||60,this.length=this.points.length,this.delay=0;for(var t=0;t<this.length;t++)this.points[t].z=this.points[t].z||0;for(var t=0;t<this.length-1;t++){var r=this.points[t],n=this.points[t+1];this.centers.push({x:(r.x+n.x)/2,y:(r.y+n.y)/2,z:(r.z+n.z)/2})}this.controls.push([this.points[0],this.points[0]]);for(var t=0;t<this.centers.length-1;t++){var r=this.centers[t],n=this.centers[t+1],i=this.points[t+1].x-(this.centers[t].x+this.centers[t+1].x)/2,s=this.points[t+1].y-(this.centers[t].y+this.centers[t+1].y)/2,a=this.points[t+1].z-(this.centers[t].y+this.centers[t+1].z)/2;this.controls.push([{x:(1-this.sharpness)*this.points[t+1].x+this.sharpness*(this.centers[t].x+i),y:(1-this.sharpness)*this.points[t+1].y+this.sharpness*(this.centers[t].y+s),z:(1-this.sharpness)*this.points[t+1].z+this.sharpness*(this.centers[t].z+a)},{x:(1-this.sharpness)*this.points[t+1].x+this.sharpness*(this.centers[t+1].x+i),y:(1-this.sharpness)*this.points[t+1].y+this.sharpness*(this.centers[t+1].y+s),z:(1-this.sharpness)*this.points[t+1].z+this.sharpness*(this.centers[t+1].z+a)}])}return this.controls.push([this.points[this.length-1],this.points[this.length-1]]),this.steps=this.cacheSteps(this.stepLength),this};Gc.prototype.cacheSteps=function(e){var t=[],r=this.pos(0);t.push(0);for(var n=0;n<this.duration;n+=10){var i=this.pos(n),s=Math.sqrt((i.x-r.x)*(i.x-r.x)+(i.y-r.y)*(i.y-r.y)+(i.z-r.z)*(i.z-r.z));s>e&&(t.push(n),r=i)}return t};Gc.prototype.vector=function(e){var t=this.pos(e+10),r=this.pos(e-10);return{angle:180*Math.atan2(t.y-r.y,t.x-r.x)/3.14,speed:Math.sqrt((r.x-t.x)*(r.x-t.x)+(r.y-t.y)*(r.y-t.y)+(r.z-t.z)*(r.z-t.z))}};Gc.prototype.pos=function(e){function t(a,o,u,f,l){var c=function(m){var g=m*m,p=g*m;return[p,3*g*(1-m),3*m*(1-m)*(1-m),(1-m)*(1-m)*(1-m)]},h=c(a),d={x:l.x*h[0]+f.x*h[1]+u.x*h[2]+o.x*h[3],y:l.y*h[0]+f.y*h[1]+u.y*h[2]+o.y*h[3],z:l.z*h[0]+f.z*h[1]+u.z*h[2]+o.z*h[3]};return d}var r=e-this.delay;r<0&&(r=0),r>this.duration&&(r=this.duration-1);var n=r/this.duration;if(n>=1)return this.points[this.length-1];var i=Math.floor((this.points.length-1)*n),s=(this.length-1)*n-i;return t(s,this.points[i],this.controls[i][1],this.controls[i+1][0],this.points[i+1])};function aC(e,t){if(t=t||{},!fe(t))throw new Error("options is invalid");var r=t.resolution||1e4,n=t.sharpness||.85;if(!e)throw new Error("line is required");if(!bt(r))throw new Error("resolution must be an number");if(!bt(n))throw new Error("sharpness must be an number");for(var i=[],s=new Gc({points:Tn(e).coordinates.map(function(u){return{x:u[0],y:u[1]}}),duration:r,sharpness:n}),a=0;a<s.duration;a+=10){var o=s.pos(a);Math.floor(a/100)%2===0&&i.push([o.x,o.y])}return Pt(i,e.properties)}function IA(e,t,r,n){return e=Kr(e),t=Kr(t),wt(e,function(i){i.properties||(i.properties={}),wt(t,function(s){i.properties[n]===void 0&&Ut(i,s)&&(i.properties[n]=s.properties[r])})}),e}function LA(e,t){if(!e)throw new Error("featurecollection is required");if(t==null)throw new Error("num is required");if(typeof t!="number")throw new Error("num must be a number");var r=ge(PA(e.features,t));return r}function PA(e,t){for(var r=e.slice(0),n=e.length,i=n-t,s,a;n-- >i;)a=Math.floor((n+1)*Math.random()),s=r[a],r[a]=r[n],r[n]=s;return r.slice(i)}function up(e){bu(e);var t=Number(e[0]),r=Number(e[1]),n=Number(e[2]),i=Number(e[3]);if(e.length===6)throw new Error("@turf/bbox-polygon does not support BBox with 6 positions");var s=[t,r],a=[t,i],o=[n,i],u=[n,r];return ze([[s,u,o,a,s]])}function e0(e){return up(ur(e))}function t0(e){var t=e[0],r=e[1],n=e[2],i=e[3],s=Et(e.slice(0,2),[n,r]),a=Et(e.slice(0,2),[t,i]);if(s>=a){var o=(r+i)/2;return[t,o-(n-t)/2,n,o+(n-t)/2]}else{var u=(t+n)/2;return[u-(i-r)/2,r,u+(i-r)/2,i]}}function cs(e,t,r,n){if(n=n||{},!fe(n))throw new Error("options is invalid");var i=n.units,s=n.properties,a=Vt(e),o=dr(a[0]),u=dr(a[1]),f=dr(r),l=eo(t,i),c=Math.asin(Math.sin(u)*Math.cos(l)+Math.cos(u)*Math.sin(l)*Math.cos(f)),h=o+Math.atan2(Math.sin(f)*Math.sin(l)*Math.cos(u),Math.cos(l)-Math.sin(u)*Math.sin(c)),d=Ea(h),m=Ea(c);return gt([d,m],s)}function fp(e,t,r){r=r||{};var n=r.steps||64,i=r.properties;if(!e)throw new Error("center is required");if(!t)throw new Error("radius is required");if(typeof r!="object")throw new Error("options must be an object");if(typeof n!="number")throw new Error("steps must be a number");n=n||64,i=i||e.properties||{};for(var s=[],a=0;a<n;a++)s.push(cs(e,t,a*-360/n,r).geometry.coordinates);return s.push(s[0]),ze([s],i)}function us(e,t,r){if(r=r||{},!fe(r))throw new Error("options is invalid");var n=r.final;if(n===!0)return MA(e,t);var i=Vt(e),s=Vt(t),a=dr(i[0]),o=dr(s[0]),u=dr(i[1]),f=dr(s[1]),l=Math.sin(o-a)*Math.cos(f),c=Math.cos(u)*Math.sin(f)-Math.sin(u)*Math.cos(f)*Math.cos(o-a);return Ea(Math.atan2(l,c))}function MA(e,t){var r=us(t,e);return r=(r+180)%360,r}function AA(e,t){var r=Et(e,t),n=us(e,t),i=cs(e,r/2,n);return i}function qc(e,t){if(t=t||{},!fe(t))throw new Error("options is invalid");var r=t.properties;if(!e)throw new Error("geojson is required");var n=ur(e),i=(n[0]+n[2])/2,s=(n[1]+n[3])/2;return gt([i,s],r)}function ro(e,t){var r=0,n=0,i=0;return mr(e,function(s){r+=s[0],n+=s[1],i++},!0),gt([r/i,n/i],t)}function r0(e,t){switch(Mt(e)){case"Point":return e;case"Polygon":var r=[];mr(e,function(x){r.push(x)});var n=ro(e,t),i=n.geometry.coordinates,s=0,a=0,o=0,u,f,l,c,h,d,m,g,p=r.map(function(x){return[x[0]-i[0],x[1]-i[1]]});for(u=0;u<r.length-1;u++)f=p[u],c=f[0],d=f[1],l=p[u+1],h=l[0],m=l[1],g=c*m-h*d,o+=g,s+=(c+h)*g,a+=(d+m)*g;if(o===0)return n;var v=o*.5,_=1/(6*v);return gt([i[0]+_*s,i[1]+_*a],t);default:var y=Yy(e);return y?r0(y,t):ro(e,t)}}function DA(e){var t={MultiPoint:{coordinates:[],properties:[]},MultiLineString:{coordinates:[],properties:[]},MultiPolygon:{coordinates:[],properties:[]}},r=Object.keys(t).reduce(function(i,s){return i[s.replace("Multi","")]=s,i},{});function n(i,s,a){a?t[s].coordinates=t[s].coordinates.concat(i.geometry.coordinates):t[s].coordinates.push(i.geometry.coordinates),t[s].properties.push(i.properties)}return wt(e,function(i){i.geometry&&(t[i.geometry.type]?n(i,i.geometry.type,!0):r[i.geometry.type]&&n(i,r[i.geometry.type],!1))}),ge(Object.keys(t).filter(function(i){return t[i].coordinates.length}).sort().map(function(i){var s={type:i,coordinates:t[i].coordinates},a={collectedProperties:t[i].properties};return nr(s,a)}))}function lp(e){var t=[];return e.type==="FeatureCollection"?wt(e,function(r){mr(r,function(n){t.push(gt(n,r.properties))})}):mr(e,function(r){t.push(gt(r,e.properties))}),ge(t)}var n0=Hc,RA=Hc;function Hc(e,t,r){r=r||2;var n=t&&t.length,i=n?t[0]*r:e.length,s=i0(e,0,i,r,!0),a=[];if(!s)return a;var o,u,f,l,c,h,d;if(n&&(s=VA(e,t,s,r)),e.length>80*r){o=f=e[0],u=l=e[1];for(var m=r;m<i;m+=r)c=e[m],h=e[m+1],c<o&&(o=c),h<u&&(u=h),c>f&&(f=c),h>l&&(l=h);d=Math.max(f-o,l-u),d=d!==0?1/d:0}return If(s,a,r,o,u,d),a}function i0(e,t,r,n,i){var s,a;if(i===Vm(e,t,r,n)>0)for(s=t;s<r;s+=n)a=oC(s,e[s],e[s+1],a);else for(s=r-n;s>=t;s-=n)a=oC(s,e[s],e[s+1],a);return a&&Ja(a,a.next)&&(Pf(a),a=a.next),a}function Tf(e,t){if(!e)return e;t||(t=e);var r=e,n;do if(n=!1,!r.steiner&&(Ja(r,r.next)||wn(r.prev,r,r.next)===0)){if(Pf(r),r=t=r.prev,r===r.next)break;n=!0}else r=r.next;while(n||r!==t);return t}function If(e,t,r,n,i,s,a){if(e){!a&&s&&GA(e,n,i,s);for(var o=e,u,f;e.prev!==e.next;){if(u=e.prev,f=e.next,s?NA(e,n,i,s):OA(e)){t.push(u.i/r),t.push(e.i/r),t.push(f.i/r),Pf(e),e=f.next,o=f.next;continue}if(e=f,e===o){a?a===1?(e=FA(e,t,r),If(e,t,r,n,i,s,2)):a===2&&BA(e,t,r,n,i,s):If(Tf(e),t,r,n,i,s,1);break}}}}function OA(e){var t=e.prev,r=e,n=e.next;if(wn(t,r,n)>=0)return!1;for(var i=e.next.next;i!==e.prev;){if(yc(t.x,t.y,r.x,r.y,n.x,n.y,i.x,i.y)&&wn(i.prev,i,i.next)>=0)return!1;i=i.next}return!0}function NA(e,t,r,n){var i=e.prev,s=e,a=e.next;if(wn(i,s,a)>=0)return!1;for(var o=i.x<s.x?i.x<a.x?i.x:a.x:s.x<a.x?s.x:a.x,u=i.y<s.y?i.y<a.y?i.y:a.y:s.y<a.y?s.y:a.y,f=i.x>s.x?i.x>a.x?i.x:a.x:s.x>a.x?s.x:a.x,l=i.y>s.y?i.y>a.y?i.y:a.y:s.y>a.y?s.y:a.y,c=Fm(o,u,t,r,n),h=Fm(f,l,t,r,n),d=e.nextZ;d&&d.z<=h;){if(d!==e.prev&&d!==e.next&&yc(i.x,i.y,s.x,s.y,a.x,a.y,d.x,d.y)&&wn(d.prev,d,d.next)>=0)return!1;d=d.nextZ}for(d=e.prevZ;d&&d.z>=c;){if(d!==e.prev&&d!==e.next&&yc(i.x,i.y,s.x,s.y,a.x,a.y,d.x,d.y)&&wn(d.prev,d,d.next)>=0)return!1;d=d.prevZ}return!0}function FA(e,t,r){var n=e;do{var i=n.prev,s=n.next.next;!Ja(i,s)&&s0(i,n,n.next,s)&&Lf(i,s)&&Lf(s,i)&&(t.push(i.i/r),t.push(n.i/r),t.push(s.i/r),Pf(n),Pf(n.next),n=e=s),n=n.next}while(n!==e);return n}function BA(e,t,r,n,i,s){var a=e;do{for(var o=a.next.next;o!==a.prev;){if(a.i!==o.i&&WA(a,o)){var u=a0(a,o);a=Tf(a,a.next),u=Tf(u,u.next),If(a,t,r,n,i,s),If(u,t,r,n,i,s);return}o=o.next}a=a.next}while(a!==e)}function VA(e,t,r,n){var i=[],s,a,o,u,f;for(s=0,a=t.length;s<a;s++)o=t[s]*n,u=s<a-1?t[s+1]*n:e.length,f=i0(e,o,u,n,!1),f===f.next&&(f.steiner=!0),i.push(HA(f));for(i.sort(zA),s=0;s<i.length;s++)kA(i[s],r),r=Tf(r,r.next);return r}function zA(e,t){return e.x-t.x}function kA(e,t){if(t=UA(e,t),t){var r=a0(t,e);Tf(r,r.next)}}function UA(e,t){var r=t,n=e.x,i=e.y,s=-1/0,a;do{if(i<=r.y&&i>=r.next.y&&r.next.y!==r.y){var o=r.x+(i-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(o<=n&&o>s){if(s=o,o===n){if(i===r.y)return r;if(i===r.next.y)return r.next}a=r.x<r.next.x?r:r.next}}r=r.next}while(r!==t);if(!a)return null;if(n===s)return a.prev;var u=a,f=a.x,l=a.y,c=1/0,h;for(r=a.next;r!==u;)n>=r.x&&r.x>=f&&n!==r.x&&yc(i<l?n:s,i,f,l,i<l?s:n,i,r.x,r.y)&&(h=Math.abs(i-r.y)/(n-r.x),(h<c||h===c&&r.x>a.x)&&Lf(r,e)&&(a=r,c=h)),r=r.next;return a}function GA(e,t,r,n){var i=e;do i.z===null&&(i.z=Fm(i.x,i.y,t,r,n)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next;while(i!==e);i.prevZ.nextZ=null,i.prevZ=null,qA(i)}function qA(e){var t,r,n,i,s,a,o,u,f=1;do{for(r=e,e=null,s=null,a=0;r;){for(a++,n=r,o=0,t=0;t<f&&(o++,n=n.nextZ,!!n);t++);for(u=f;o>0||u>0&&n;)o!==0&&(u===0||!n||r.z<=n.z)?(i=r,r=r.nextZ,o--):(i=n,n=n.nextZ,u--),s?s.nextZ=i:e=i,i.prevZ=s,s=i;r=n}s.nextZ=null,f*=2}while(a>1);return e}function Fm(e,t,r,n,i){return e=32767*(e-r)*i,t=32767*(t-n)*i,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,t=(t|t<<8)&16711935,t=(t|t<<4)&252645135,t=(t|t<<2)&858993459,t=(t|t<<1)&1431655765,e|t<<1}function HA(e){var t=e,r=e;do t.x<r.x&&(r=t),t=t.next;while(t!==e);return r}function yc(e,t,r,n,i,s,a,o){return(i-a)*(t-o)-(e-a)*(s-o)>=0&&(e-a)*(n-o)-(r-a)*(t-o)>=0&&(r-a)*(s-o)-(i-a)*(n-o)>=0}function WA(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!YA(e,t)&&Lf(e,t)&&Lf(t,e)&&XA(e,t)}function wn(e,t,r){return(t.y-e.y)*(r.x-t.x)-(t.x-e.x)*(r.y-t.y)}function Ja(e,t){return e.x===t.x&&e.y===t.y}function s0(e,t,r,n){return Ja(e,t)&&Ja(r,n)||Ja(e,n)&&Ja(r,t)?!0:wn(e,t,r)>0!=wn(e,t,n)>0&&wn(r,n,e)>0!=wn(r,n,t)>0}function YA(e,t){var r=e;do{if(r.i!==e.i&&r.next.i!==e.i&&r.i!==t.i&&r.next.i!==t.i&&s0(r,r.next,e,t))return!0;r=r.next}while(r!==e);return!1}function Lf(e,t){return wn(e.prev,e,e.next)<0?wn(e,t,e.next)>=0&&wn(e,e.prev,t)>=0:wn(e,t,e.prev)<0||wn(e,e.next,t)<0}function XA(e,t){var r=e,n=!1,i=(e.x+t.x)/2,s=(e.y+t.y)/2;do r.y>s!=r.next.y>s&&r.next.y!==r.y&&i<(r.next.x-r.x)*(s-r.y)/(r.next.y-r.y)+r.x&&(n=!n),r=r.next;while(r!==e);return n}function a0(e,t){var r=new Bm(e.i,e.x,e.y),n=new Bm(t.i,t.x,t.y),i=e.next,s=t.prev;return e.next=t,t.prev=e,r.next=i,i.prev=r,n.next=r,r.prev=n,s.next=n,n.prev=s,n}function oC(e,t,r,n){var i=new Bm(e,t,r);return n?(i.next=n.next,i.prev=n,n.next.prev=i,n.next=i):(i.prev=i,i.next=i),i}function Pf(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function Bm(e,t,r){this.i=e,this.x=t,this.y=r,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}Hc.deviation=function(e,t,r,n){var i=t&&t.length,s=i?t[0]*r:e.length,a=Math.abs(Vm(e,0,s,r));if(i)for(var o=0,u=t.length;o<u;o++){var f=t[o]*r,l=o<u-1?t[o+1]*r:e.length;a-=Math.abs(Vm(e,f,l,r))}var c=0;for(o=0;o<n.length;o+=3){var h=n[o]*r,d=n[o+1]*r,m=n[o+2]*r;c+=Math.abs((e[h]-e[m])*(e[d+1]-e[h+1])-(e[h]-e[d])*(e[m+1]-e[h+1]))}return a===0&&c===0?0:Math.abs((c-a)/a)};function Vm(e,t,r,n){for(var i=0,s=t,a=r-n;s<r;s+=n)i+=(e[a]-e[s])*(e[s+1]+e[a+1]),a=s;return i}Hc.flatten=function(e){for(var t=e[0][0].length,r={vertices:[],holes:[],dimensions:t},n=0,i=0;i<e.length;i++){for(var s=0;s<e[i].length;s++)for(var a=0;a<t;a++)r.vertices.push(e[i][s][a]);i>0&&(n+=e[i-1].length,r.holes.push(n))}return r};n0.default=RA;function jA(e){if(!e.geometry||e.geometry.type!=="Polygon"&&e.geometry.type!=="MultiPolygon")throw new Error("input must be a Polygon or MultiPolygon");var t={type:"FeatureCollection",features:[]};return e.geometry.type==="Polygon"?t.features=uC(e.geometry.coordinates):e.geometry.coordinates.forEach(function(r){t.features=t.features.concat(uC(r))}),t}function uC(e){var t=KA(e),r=2,n=n0(t.vertices,t.holes,r),i=[],s=[];n.forEach(function(u,f){var l=n[f];s.push([t.vertices[l*r],t.vertices[l*r+1]])});for(var a=0;a<s.length;a+=3){var o=s.slice(a,a+3);o.push(s[a]),i.push(ze([o]))}return i}function KA(e){for(var t=e[0][0].length,r={vertices:[],holes:[],dimensions:t},n=0,i=0;i<e.length;i++){for(var s=0;s<e[i].length;s++)for(var a=0;a<t;a++)r.vertices.push(e[i][s][a]);i>0&&(n+=e[i-1].length,r.holes.push(n))}return r}function zm(e,t){if(!e)throw new Error("targetPoint is required");if(!t)throw new Error("points is required");var r,n=1/0;return wt(t,function(i,s){var a=Et(e,i);a<n&&(r=Kr(i),r.properties.featureIndex=s,r.properties.distanceToPoint=a,n=a)}),r}function QA(e,t,r,n,i){o0(e,t,r||0,n||e.length-1,i||ZA)}function o0(e,t,r,n,i){for(;n>r;){if(n-r>600){var s=n-r+1,a=t-r+1,o=Math.log(s),u=.5*Math.exp(2*o/3),f=.5*Math.sqrt(o*u*(s-u)/s)*(a-s/2<0?-1:1),l=Math.max(r,Math.floor(t-a*u/s+f)),c=Math.min(n,Math.floor(t+(s-a)*u/s+f));o0(e,t,l,c,i)}var h=e[t],d=r,m=n;for(lf(e,r,t),i(e[n],h)>0&&lf(e,r,n);d<m;){for(lf(e,d,m),d++,m--;i(e[d],h)<0;)d++;for(;i(e[m],h)>0;)m--}i(e[r],h)===0?lf(e,r,m):(m++,lf(e,m,n)),m<=t&&(r=m+1),t<=m&&(n=m-1)}}function lf(e,t,r){var n=e[t];e[t]=e[r],e[r]=n}function ZA(e,t){return e<t?-1:e>t?1:0}function jn(e,t){if(!(this instanceof jn))return new jn(e,t);this._maxEntries=Math.max(4,e||9),this._minEntries=Math.max(2,Math.ceil(this._maxEntries*.4)),t&&this._initFormat(t),this.clear()}jn.prototype={all:function(){return this._all(this.data,[])},search:function(e){var t=this.data,r=[],n=this.toBBox;if(!ac(e,t))return r;for(var i=[],s,a,o,u;t;){for(s=0,a=t.children.length;s<a;s++)o=t.children[s],u=t.leaf?n(o):o,ac(e,u)&&(t.leaf?r.push(o):xm(e,u)?this._all(o,r):i.push(o));t=i.pop()}return r},collides:function(e){var t=this.data,r=this.toBBox;if(!ac(e,t))return!1;for(var n=[],i,s,a,o;t;){for(i=0,s=t.children.length;i<s;i++)if(a=t.children[i],o=t.leaf?r(a):a,ac(e,o)){if(t.leaf||xm(e,o))return!0;n.push(a)}t=n.pop()}return!1},load:function(e){if(!(e&&e.length))return this;if(e.length<this._minEntries){for(var t=0,r=e.length;t<r;t++)this.insert(e[t]);return this}var n=this._build(e.slice(),0,e.length-1,0);if(!this.data.children.length)this.data=n;else if(this.data.height===n.height)this._splitRoot(this.data,n);else{if(this.data.height<n.height){var i=this.data;this.data=n,n=i}this._insert(n,this.data.height-n.height-1,!0)}return this},insert:function(e){return e&&this._insert(e,this.data.height-1),this},clear:function(){return this.data=Wo([]),this},remove:function(e,t){if(!e)return this;for(var r=this.data,n=this.toBBox(e),i=[],s=[],a,o,u,f;r||i.length;){if(r||(r=i.pop(),o=i[i.length-1],a=s.pop(),f=!0),r.leaf&&(u=JA(e,r.children,t),u!==-1))return r.children.splice(u,1),i.push(r),this._condense(i),this;!f&&!r.leaf&&xm(r,n)?(i.push(r),s.push(a),a=0,o=r,r=r.children[0]):o?(a++,r=o.children[a],f=!1):r=null}return this},toBBox:function(e){return e},compareMinX:fC,compareMinY:lC,toJSON:function(){return this.data},fromJSON:function(e){return this.data=e,this},_all:function(e,t){for(var r=[];e;)e.leaf?t.push.apply(t,e.children):r.push.apply(r,e.children),e=r.pop();return t},_build:function(e,t,r,n){var i=r-t+1,s=this._maxEntries,a;if(i<=s)return a=Wo(e.slice(t,r+1)),qo(a,this.toBBox),a;n||(n=Math.ceil(Math.log(i)/Math.log(s)),s=Math.ceil(i/Math.pow(s,n-1))),a=Wo([]),a.leaf=!1,a.height=n;var o=Math.ceil(i/s),u=o*Math.ceil(Math.sqrt(s)),f,l,c,h;for(cC(e,t,r,u,this.compareMinX),f=t;f<=r;f+=u)for(c=Math.min(f+u-1,r),cC(e,f,c,o,this.compareMinY),l=f;l<=c;l+=o)h=Math.min(l+o-1,c),a.children.push(this._build(e,l,h,n-1));return qo(a,this.toBBox),a},_chooseSubtree:function(e,t,r,n){for(var i,s,a,o,u,f,l,c;n.push(t),!(t.leaf||n.length-1===r);){for(l=c=1/0,i=0,s=t.children.length;i<s;i++)a=t.children[i],u=ym(a),f=$A(e,a)-u,f<c?(c=f,l=u<l?u:l,o=a):f===c&&u<l&&(l=u,o=a);t=o||t.children[0]}return t},_insert:function(e,t,r){var n=this.toBBox,i=r?e:n(e),s=[],a=this._chooseSubtree(i,this.data,t,s);for(a.children.push(e),_f(a,i);t>=0&&s[t].children.length>this._maxEntries;)this._split(s,t),t--;this._adjustParentBBoxes(i,s,t)},_split:function(e,t){var r=e[t],n=r.children.length,i=this._minEntries;this._chooseSplitAxis(r,i,n);var s=this._chooseSplitIndex(r,i,n),a=Wo(r.children.splice(s,r.children.length-s));a.height=r.height,a.leaf=r.leaf,qo(r,this.toBBox),qo(a,this.toBBox),t?e[t-1].children.push(a):this._splitRoot(r,a)},_splitRoot:function(e,t){this.data=Wo([e,t]),this.data.height=e.height+1,this.data.leaf=!1,qo(this.data,this.toBBox)},_chooseSplitIndex:function(e,t,r){var n,i,s,a,o,u,f,l;for(u=f=1/0,n=t;n<=r-t;n++)i=vf(e,0,n,this.toBBox),s=vf(e,n,r,this.toBBox),a=eD(i,s),o=ym(i)+ym(s),a<u?(u=a,l=n,f=o<f?o:f):a===u&&o<f&&(f=o,l=n);return l},_chooseSplitAxis:function(e,t,r){var n=e.leaf?this.compareMinX:fC,i=e.leaf?this.compareMinY:lC,s=this._allDistMargin(e,t,r,n),a=this._allDistMargin(e,t,r,i);s<a&&e.children.sort(n)},_allDistMargin:function(e,t,r,n){e.children.sort(n);var i=this.toBBox,s=vf(e,0,t,i),a=vf(e,r-t,r,i),o=sc(s)+sc(a),u,f;for(u=t;u<r-t;u++)f=e.children[u],_f(s,e.leaf?i(f):f),o+=sc(s);for(u=r-t-1;u>=t;u--)f=e.children[u],_f(a,e.leaf?i(f):f),o+=sc(a);return o},_adjustParentBBoxes:function(e,t,r){for(var n=r;n>=0;n--)_f(t[n],e)},_condense:function(e){for(var t=e.length-1,r;t>=0;t--)e[t].children.length===0?t>0?(r=e[t-1].children,r.splice(r.indexOf(e[t]),1)):this.clear():qo(e[t],this.toBBox)},_initFormat:function(e){var t=["return a"," - b",";"];this.compareMinX=new Function("a","b",t.join(e[0])),this.compareMinY=new Function("a","b",t.join(e[1])),this.toBBox=new Function("a","return {minX: a"+e[0]+", minY: a"+e[1]+", maxX: a"+e[2]+", maxY: a"+e[3]+"};")}};function JA(e,t,r){if(!r)return t.indexOf(e);for(var n=0;n<t.length;n++)if(r(e,t[n]))return n;return-1}function qo(e,t){vf(e,0,e.children.length,t,e)}function vf(e,t,r,n,i){i||(i=Wo(null)),i.minX=1/0,i.minY=1/0,i.maxX=-1/0,i.maxY=-1/0;for(var s=t,a;s<r;s++)a=e.children[s],_f(i,e.leaf?n(a):a);return i}function _f(e,t){return e.minX=Math.min(e.minX,t.minX),e.minY=Math.min(e.minY,t.minY),e.maxX=Math.max(e.maxX,t.maxX),e.maxY=Math.max(e.maxY,t.maxY),e}function fC(e,t){return e.minX-t.minX}function lC(e,t){return e.minY-t.minY}function ym(e){return(e.maxX-e.minX)*(e.maxY-e.minY)}function sc(e){return e.maxX-e.minX+(e.maxY-e.minY)}function $A(e,t){return(Math.max(t.maxX,e.maxX)-Math.min(t.minX,e.minX))*(Math.max(t.maxY,e.maxY)-Math.min(t.minY,e.minY))}function eD(e,t){var r=Math.max(e.minX,t.minX),n=Math.max(e.minY,t.minY),i=Math.min(e.maxX,t.maxX),s=Math.min(e.maxY,t.maxY);return Math.max(0,i-r)*Math.max(0,s-n)}function xm(e,t){return e.minX<=t.minX&&e.minY<=t.minY&&t.maxX<=e.maxX&&t.maxY<=e.maxY}function ac(e,t){return t.minX<=e.maxX&&t.minY<=e.maxY&&t.maxX>=e.minX&&t.maxY>=e.minY}function Wo(e){return{children:e,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function cC(e,t,r,n,i){for(var s=[t,r],a;s.length;)r=s.pop(),t=s.pop(),!(r-t<=n)&&(a=t+Math.ceil((r-t)/n/2)*n,QA(e,a,t,r,i),s.push(t,a,a,r))}function Zf(e){var t=jn(e);return t.insert=function(r){if(Array.isArray(r)){var n=r;r=Em(n),r.bbox=n}else r.bbox=r.bbox?r.bbox:bm(r);return jn.prototype.insert.call(this,r)},t.load=function(r){var n=[];return Array.isArray(r)?r.forEach(function(i){var s=Em(i);s.bbox=i,n.push(s)}):wt(r,function(i){i.bbox=i.bbox?i.bbox:bm(i),n.push(i)}),jn.prototype.load.call(this,n)},t.remove=function(r){if(Array.isArray(r)){var n=r;r=Em(n),r.bbox=n}return jn.prototype.remove.call(this,r)},t.clear=function(){return jn.prototype.clear.call(this)},t.search=function(r){var n=jn.prototype.search.call(this,this.toBBox(r));return{type:"FeatureCollection",features:n}},t.collides=function(r){return jn.prototype.collides.call(this,this.toBBox(r))},t.all=function(){var r=jn.prototype.all.call(this);return{type:"FeatureCollection",features:r}},t.toJSON=function(){return jn.prototype.toJSON.call(this)},t.fromJSON=function(r){return jn.prototype.fromJSON.call(this,r)},t.toBBox=function(r){var n;return r.bbox?n=r.bbox:Array.isArray(r)&&r.length===4?n=r:n=bm(r),{minX:n[0],minY:n[1],maxX:n[2],maxY:n[3]}},t}function Em(e){var t=[e[0],e[1]],r=[e[0],e[3]],n=[e[2],e[3]],i=[e[2],e[1]],s=[[t,i,n,r,t]];return{type:"Feature",bbox:e,properties:{},geometry:{type:"Polygon",coordinates:s}}}function bm(e){var t=[1/0,1/0,-1/0,-1/0];return mr(e,function(r){t[0]>r[0]&&(t[0]=r[0]),t[1]>r[1]&&(t[1]=r[1]),t[2]<r[0]&&(t[2]=r[0]),t[3]<r[1]&&(t[3]=r[1])}),t}function no(e){if(!e)throw new Error("geojson is required");var t=[];return Jt(e,function(r){tD(r,t)}),ge(t)}function tD(e,t){var r=[],n=e.geometry;switch(n.type){case"Polygon":r=le(n);break;case"LineString":r=[le(n)]}r.forEach(function(i){var s=rD(i,e.properties);s.forEach(function(a){a.id=t.length,t.push(a)})})}function rD(e,t){var r=[];return e.reduce(function(n,i){var s=Pt([n,i],t);return s.bbox=nD(n,i),r.push(s),i}),r}function nD(e,t){var r=e[0],n=e[1],i=t[0],s=t[1],a=r<i?r:i,o=n<s?n:s,u=r>i?r:i,f=n>s?n:s;return[a,o,u,f]}function Zs(e,t){var r={},n=[];if(e.type==="LineString"&&(e=nr(e)),t.type==="LineString"&&(t=nr(t)),e.type==="Feature"&&t.type==="Feature"&&e.geometry.type==="LineString"&&t.geometry.type==="LineString"&&e.geometry.coordinates.length===2&&t.geometry.coordinates.length===2){var i=hC(e,t);return i&&n.push(i),ge(n)}var s=Zf();return s.load(no(t)),wt(no(e),function(a){wt(s.search(a),function(o){var u=hC(a,o);if(u){var f=le(u).join(",");r[f]||(r[f]=!0,n.push(u))}})}),ge(n)}function hC(e,t){var r=le(e),n=le(t);if(r.length!==2)throw new Error("<intersects> line1 must only contain 2 coordinates");if(n.length!==2)throw new Error("<intersects> line2 must only contain 2 coordinates");var i=r[0][0],s=r[0][1],a=r[1][0],o=r[1][1],u=n[0][0],f=n[0][1],l=n[1][0],c=n[1][1],h=(c-f)*(a-i)-(l-u)*(o-s),d=(l-u)*(s-f)-(c-f)*(i-u),m=(a-i)*(s-f)-(o-s)*(i-u);if(h===0)return null;var g=d/h,p=m/h;if(g>=0&&g<=1&&p>=0&&p<=1){var v=i+g*(a-i),_=s+g*(o-s);return gt([v,_])}return null}function Fs(e,t,r){if(r=r||{},!fe(r))throw new Error("options is invalid");var n=e.geometry?e.geometry.type:e.type;if(n!=="LineString"&&n!=="MultiLineString")throw new Error("lines must be LineString or MultiLineString");var i=gt([1/0,1/0],{dist:1/0}),s=0;return Jt(e,function(a){for(var o=le(a),u=0;u<o.length-1;u++){var f=gt(o[u]);f.properties.dist=Et(t,f,r);var l=gt(o[u+1]);l.properties.dist=Et(t,l,r);var c=Et(f,l,r),h=Math.max(f.properties.dist,l.properties.dist),d=us(f,l),m=cs(t,h,d+90,r),g=cs(t,h,d-90,r),p=Zs(Pt([m.geometry.coordinates,g.geometry.coordinates]),Pt([f.geometry.coordinates,l.geometry.coordinates])),v=null;p.features.length>0&&(v=p.features[0],v.properties.dist=Et(t,v,r),v.properties.location=s+Et(f,v,r)),f.properties.dist<i.properties.dist&&(i=f,i.properties.index=u,i.properties.location=s),l.properties.dist<i.properties.dist&&(i=l,i.properties.index=u+1,i.properties.location=s+c),v&&v.properties.dist<i.properties.dist&&(i=v,i.properties.index=u),s+=c}}),i}function _a(e,t,r){if(r=r||{},!fe(r))throw new Error("options is invalid");var n=r.final;if(!e)throw new Error("start point is required");if(!t)throw new Error("end point is required");var i;n?i=dC(Vt(t),Vt(e)):i=dC(Vt(e),Vt(t));var s=i>180?-(360-i):i;return s}function dC(e,t){var r=dr(e[1]),n=dr(t[1]),i=dr(t[0]-e[0]);i>Math.PI&&(i-=2*Math.PI),i<-Math.PI&&(i+=2*Math.PI);var s=Math.log(Math.tan(n/2+Math.PI/4)/Math.tan(r/2+Math.PI/4)),a=Math.atan2(i,s);return(Ea(a)+360)%360}function Wc(e,t,r){if(r=r||{},!fe(r))throw new Error("options is invalid");var n=r.units;if(!e)throw new Error("from point is required");if(!t)throw new Error("to point is required");var i=Vt(e),s=Vt(t);s[0]+=s[0]-i[0]>180?-360:i[0]-s[0]>180?360:0;var a=iD(i,s),o=to(a,"meters",n);return o}function iD(e,t,r){r=r===void 0?_r:Number(r);var n=r,i=e[1]*Math.PI/180,s=t[1]*Math.PI/180,a=s-i,o=Math.abs(t[0]-e[0])*Math.PI/180;o>Math.PI&&(o-=2*Math.PI);var u=Math.log(Math.tan(s/2+Math.PI/4)/Math.tan(i/2+Math.PI/4)),f=Math.abs(u)>1e-11?a/u:Math.cos(i),l=Math.sqrt(a*a+f*f*o*o),c=l*n;return c}function Ca(e,t){return u0(e,"mercator",t)}function Yc(e,t){return u0(e,"wgs84",t)}function u0(e,t,r){if(r=r||{},!fe(r))throw new Error("options is invalid");var n=r.mutate;if(!e)throw new Error("geojson is required");return Array.isArray(e)&&bt(e[0])?e=t==="mercator"?mC(e):pC(e):(n!==!0&&(e=Kr(e)),mr(e,function(i){var s=t==="mercator"?mC(i):pC(i);i[0]=s[0],i[1]=s[1]})),e}function mC(e){var t=Math.PI/180,r=6378137,n=20037508342789244e-9,i=Math.abs(e[0])<=180?e[0]:e[0]-sD(e[0])*360,s=[r*i*t,r*Math.log(Math.tan(Math.PI*.25+.5*e[1]*t))];return s[0]>n&&(s[0]=n),s[0]<-n&&(s[0]=-n),s[1]>n&&(s[1]=n),s[1]<-n&&(s[1]=-n),s}function pC(e){var t=180/Math.PI,r=6378137;return[e[0]*t/r,(Math.PI*.5-2*Math.atan(Math.exp(-e[1]/r)))*t]}function sD(e){return e<0?-1:e>0?1:0}var aD=Object.freeze({toMercator:Ca,toWgs84:Yc});function f0(e,t,r){if(r=r||{},!fe(r))throw new Error("options is invalid");if(!e)throw new Error("pt is required");if(Array.isArray(e)?e=gt(e):e.type==="Point"?e=nr(e):wf(e,"Point","point"),!t)throw new Error("line is required");Array.isArray(t)?t=Pt(t):t.type==="LineString"?t=nr(t):wf(t,"LineString","line");var n=1/0,i=e.geometry.coordinates;return Ns(t,function(s){var a=s.geometry.coordinates[0],o=s.geometry.coordinates[1],u=oD(i,a,o,r);n>u&&(n=u)}),n}function oD(e,t,r,n){var i=n.mercator,s=i!==!0?Et(t,e,n):gC(t,e,n),a=va(i!==!0?us(t,e):_a(t,e)),o=va(i!==!0?us(t,r):_a(t,r)),u=Math.abs(a-o);if(u>90)return s;var f=(o+180)%360,l=va(i!==!0?us(r,e):_a(r,e)),c=Math.abs(l-f);return c>180&&(c=Math.abs(c-360)),c>90?i!==!0?Et(e,r,n):gC(e,r,n):i!==!0?s*Math.sin(dr(u)):uD(t,r,e,n)}function uD(e,t,r,n){var i=0;(Math.abs(e[0])>=180||Math.abs(t[0])>=180||Math.abs(r[0])>=180)&&(i=e[0]>0||t[0]>0||r[0]>0?-180:180);var s=gt(r),a=Ca([e[0]+i,e[1]]),o=Ca([t[0]+i,t[1]]),u=Ca([r[0]+i,r[1]]),f=Yc(fD(a,o,u));i!==0&&(f[0]-=i);var l=Wc(s,f,n);return l}function fD(e,t,r){var n=e[0],i=e[1],s=t[0],a=t[1],o=r[0],u=r[1],f=s-n,l=a-i,c=f*f+l*l,h=((o-n)*f+(u-i)*l)/c,d=n+h*f,m=i+h*l;return[d,m]}function gC(e,t,r){var n=r.units,i=0;Math.abs(e[0])>=180&&(i=e[0]>0?-180:180),Math.abs(t[0])>=180&&(i=t[0]>0?-180:180);var s=Ca([e[0]+i,e[1]]),a=Ca([t[0]+i,t[1]]),o=function(l){return l*l},u=o(s[0]-a[0])+o(s[1]-a[1]),f=Math.sqrt(u);return to(f,"meters",n)}function lD(e,t,r){if(r=r||{},!fe(r))throw new Error("options is invalid");var n=r.units,i=r.properties||{};if(!e)throw new Error("points is required");if(e=cD(e),!e.features.length)throw new Error("points must contain features");if(!t)throw new Error("line is required");if(Mt(t)!=="LineString")throw new Error("line must be a LineString");var s=1/0,a=null;return wt(e,function(o){var u=f0(o,t,{units:n});u<s&&(s=u,a=o)}),a&&(a.properties=Object.assign({dist:s},a.properties,i)),a}function cD(e){var t=[],r=e.geometry?e.geometry.type:e.type;switch(r){case"GeometryCollection":return Mi(e,function(n){n.type==="Point"&&t.push({type:"Feature",properties:{},geometry:n})}),{type:"FeatureCollection",features:t};case"FeatureCollection":return e.features=e.features.filter(function(n){return n.geometry.type==="Point"}),e;default:throw new Error("points must be a Point Collection")}}function hD(e,t){var r=Vt(e),n=Tn(t),i=n.coordinates,s=i[0];if(s.length<4)throw new Error("OuterRing of a Polygon must have 4 or more Positions.");var a=t.properties||{},o=a.a,u=a.b,f=a.c,l=r[0],c=r[1],h=s[0][0],d=s[0][1],m=o!==void 0?o:s[0][2],g=s[1][0],p=s[1][1],v=u!==void 0?u:s[1][2],_=s[2][0],y=s[2][1],x=f!==void 0?f:s[2][2],E=(x*(l-h)*(c-p)+m*(l-g)*(c-y)+v*(l-_)*(c-d)-v*(l-h)*(c-y)-x*(l-g)*(c-d)-m*(l-_)*(c-p))/((l-h)*(c-p)+(l-g)*(c-y)+(l-_)*(c-d)-(l-h)*(c-y)-(l-g)*(c-d)-(l-_)*(c-p));return E}function dD(e){var t,r,n={type:"FeatureCollection",features:[]};if(e.type==="Feature"?r=e.geometry:r=e,r.type==="LineString")t=[r.coordinates];else if(r.type==="MultiLineString")t=r.coordinates;else if(r.type==="MultiPolygon")t=[].concat.apply([],r.coordinates);else if(r.type==="Polygon")t=r.coordinates;else throw new Error("Input must be a LineString, MultiLineString, Polygon, or MultiPolygon Feature or Geometry");return t.forEach(function(i){t.forEach(function(s){for(var a=0;a<i.length-1;a++)for(var o=a;o<s.length-1;o++)if(!(i===s&&(Math.abs(a-o)===1||a===0&&o===i.length-2&&i[a][0]===i[i.length-1][0]&&i[a][1]===i[i.length-1][1]))){var u=mD(i[a][0],i[a][1],i[a+1][0],i[a+1][1],s[o][0],s[o][1],s[o+1][0],s[o+1][1]);u&&n.features.push(gt([u[0],u[1]]))}})}),n}function mD(e,t,r,n,i,s,a,o){var u,f,l,c,h,d={x:null,y:null,onLine1:!1,onLine2:!1};return u=(o-s)*(r-e)-(a-i)*(n-t),u===0?d.x!==null&&d.y!==null?d:!1:(f=t-s,l=e-i,c=(a-i)*f-(o-s)*l,h=(r-e)*f-(n-t)*l,f=c/u,l=h/u,d.x=e+f*(r-e),d.y=t+f*(n-t),f>=0&&f<=1&&(d.onLine1=!0),l>=0&&l<=1&&(d.onLine2=!0),d.onLine1&&d.onLine2?[d.x,d.y]:!1)}function vC(e){for(var t=pD(e),r=qc(t),n=!1,i=0;!n&&i<t.features.length;){var s=t.features[i].geometry,a,o,u,f,l,c,h,d=!1;if(s.type==="Point")r.geometry.coordinates[0]===s.coordinates[0]&&r.geometry.coordinates[1]===s.coordinates[1]&&(n=!0);else if(s.type==="MultiPoint"){var m=!1;for(h=0;!m&&h<s.coordinates.length;)r.geometry.coordinates[0]===s.coordinates[h][0]&&r.geometry.coordinates[1]===s.coordinates[h][1]&&(n=!0,m=!0),h++}else if(s.type==="LineString")for(h=0;!d&&h<s.coordinates.length-1;)a=r.geometry.coordinates[0],o=r.geometry.coordinates[1],u=s.coordinates[h][0],f=s.coordinates[h][1],l=s.coordinates[h+1][0],c=s.coordinates[h+1][1],_C(a,o,u,f,l,c)&&(d=!0,n=!0),h++;else if(s.type==="MultiLineString")for(var g=0;g<s.coordinates.length;){d=!1,h=0;for(var p=s.coordinates[g];!d&&h<p.length-1;)a=r.geometry.coordinates[0],o=r.geometry.coordinates[1],u=p[h][0],f=p[h][1],l=p[h+1][0],c=p[h+1][1],_C(a,o,u,f,l,c)&&(d=!0,n=!0),h++;g++}else(s.type==="Polygon"||s.type==="MultiPolygon")&&Ut(r,s)&&(n=!0);i++}if(n)return r;var v=ge([]);for(i=0;i<t.features.length;i++)v.features=v.features.concat(lp(t.features[i]).features);return gt(zm(r,v).geometry.coordinates)}function pD(e){return e.type!=="FeatureCollection"?e.type!=="Feature"?ge([nr(e)]):ge([e]):e}function _C(e,t,r,n,i,s){var a=Math.sqrt((i-r)*(i-r)+(s-n)*(s-n)),o=Math.sqrt((e-r)*(e-r)+(t-n)*(t-n)),u=Math.sqrt((i-e)*(i-e)+(s-t)*(s-t));return a===o+u}function Mf(e){return tp(e,function(t,r){return t+l0(r)},0)}var CC=6378137;function l0(e){var t=0,r;switch(e.type){case"Polygon":return yC(e.coordinates);case"MultiPolygon":for(r=0;r<e.coordinates.length;r++)t+=yC(e.coordinates[r]);return t;case"Point":case"MultiPoint":case"LineString":case"MultiLineString":return 0;case"GeometryCollection":for(r=0;r<e.geometries.length;r++)t+=l0(e.geometries[r]);return t}}function yC(e){var t=0;if(e&&e.length>0){t+=Math.abs(xC(e[0]));for(var r=1;r<e.length;r++)t-=Math.abs(xC(e[r]))}return t}function xC(e){var t,r,n,i,s,a,o,u=0,f=e.length;if(f>2){for(o=0;o<f;o++)o===f-2?(i=f-2,s=f-1,a=0):o===f-1?(i=f-1,s=0,a=1):(i=o,s=o+1,a=o+2),t=e[i],r=e[s],n=e[a],u+=(wm(n[0])-wm(t[0]))*Math.sin(wm(r[1]));u=u*CC*CC/2}return u}function wm(e){return e*Math.PI/180}function gD(e,t,r){if(r=r||{},!fe(r))throw new Error("options is invalid");var n;if(e.type==="Feature")n=e.geometry.coordinates;else if(e.type==="LineString")n=e.coordinates;else throw new Error("input must be a LineString Feature or Geometry");if(!bt(t))throw new Error("distance must be a number");for(var i=0,s=0;s<n.length&&!(t>=i&&s===n.length-1);s++)if(i>=t){var a=t-i;if(a){var o=us(n[s],n[s-1])-180,u=cs(n[s],a,o,r);return u}else return gt(n[s])}else i+=Et(n[s],n[s+1],r);return gt(n[n.length-1])}function km(e,t){if(t=t||{},!fe(t))throw new Error("options is invalid");if(!e)throw new Error("geojson is required");return rp(e,function(r,n){var i=n.geometry.coordinates;return r+Et(i[0],i[1],t)},0)}function vD(e,t,r){var n=le(r);if(Mt(r)!=="LineString")throw new Error("line must be a LineString");var i=Fs(r,e),s=Fs(r,t),a;i.properties.index<=s.properties.index?a=[i,s]:a=[s,i];for(var o=[a[0].geometry.coordinates],u=a[0].properties.index+1;u<a[1].properties.index+1;u++)o.push(n[u]);return o.push(a[1].geometry.coordinates),Pt(o,r.properties)}function c0(e,t,r,n){if(n=n||{},!fe(n))throw new Error("options is invalid");var i,s=[];if(e.type==="Feature")i=e.geometry.coordinates;else if(e.type==="LineString")i=e.coordinates;else throw new Error("input must be a LineString Feature or Geometry");for(var a=0,o,u,f,l=0;l<i.length&&!(t>=a&&l===i.length-1);l++){if(a>t&&s.length===0){if(o=t-a,!o)return s.push(i[l]),Pt(s);u=us(i[l],i[l-1])-180,f=cs(i[l],o,u,n),s.push(f.geometry.coordinates)}if(a>=r)return o=r-a,o?(u=us(i[l],i[l-1])-180,f=cs(i[l],o,u,n),s.push(f.geometry.coordinates),Pt(s)):(s.push(i[l]),Pt(s));if(a>=t&&s.push(i[l]),l===i.length-1)return Pt(s);a+=Et(i[l],i[l+1],n)}return Pt(i[i.length-1])}function Fn(e,t,r){r=r||{};var n=r.ignoreEndVertices;if(!fe(r))throw new Error("invalid options");if(!e)throw new Error("pt is required");if(!t)throw new Error("line is required");for(var i=Vt(e),s=le(t),a=0;a<s.length-1;a++){var o=!1;if(n&&(a===0&&(o="start"),a===s.length-2&&(o="end"),a===0&&a+1===s.length-1&&(o="both")),_D(s[a],s[a+1],i,o))return!0}return!1}function _D(e,t,r,n){var i=r[0],s=r[1],a=e[0],o=e[1],u=t[0],f=t[1],l=r[0]-a,c=r[1]-o,h=u-a,d=f-o,m=l*d-c*h;if(m!==0)return!1;if(n){if(n==="start")return Math.abs(h)>=Math.abs(d)?h>0?a<i&&i<=u:u<=i&&i<a:d>0?o<s&&s<=f:f<=s&&s<o;if(n==="end")return Math.abs(h)>=Math.abs(d)?h>0?a<=i&&i<u:u<i&&i<=a:d>0?o<=s&&s<f:f<s&&s<=o;if(n==="both")return Math.abs(h)>=Math.abs(d)?h>0?a<i&&i<u:u<i&&i<a:d>0?o<s&&s<f:f<s&&s<o}else return Math.abs(h)>=Math.abs(d)?h>0?a<=i&&i<=u:u<=i&&i<=a:d>0?o<=s&&s<=f:f<=s&&s<=o}function h0(e,t){var r=Mt(e),n=Mt(t),i=Tn(e),s=Tn(t);switch(r){case"Point":switch(n){case"MultiPoint":return CD(i,s);case"LineString":return Fn(i,s,{ignoreEndVertices:!0});case"Polygon":return Ut(i,s,{ignoreBoundary:!0});default:throw new Error("feature2 "+n+" geometry not supported")}case"MultiPoint":switch(n){case"MultiPoint":return yD(i,s);case"LineString":return xD(i,s);case"Polygon":return ED(i,s);default:throw new Error("feature2 "+n+" geometry not supported")}case"LineString":switch(n){case"LineString":return bD(i,s);case"Polygon":return wD(i,s);default:throw new Error("feature2 "+n+" geometry not supported")}case"Polygon":switch(n){case"Polygon":return SD(i,s);default:throw new Error("feature2 "+n+" geometry not supported")}default:throw new Error("feature1 "+r+" geometry not supported")}}function CD(e,t){var r,n=!1;for(r=0;r<t.coordinates.length;r++)if(m0(t.coordinates[r],e.coordinates)){n=!0;break}return n}function yD(e,t){for(var r=0;r<e.coordinates.length;r++){for(var n=!1,i=0;i<t.coordinates.length;i++)m0(e.coordinates[r],t.coordinates[i])&&(n=!0);if(!n)return!1}return!0}function xD(e,t){for(var r=!1,n=0;n<e.coordinates.length;n++){if(!Fn(e.coordinates[n],t))return!1;r||(r=Fn(e.coordinates[n],t,{ignoreEndVertices:!0}))}return r}function ED(e,t){for(var r=!0,n=!1,i=0;i<e.coordinates.length;i++){var s=Ut(e.coordinates[1],t);if(!s){r=!1;break}n||(s=Ut(e.coordinates[1],t,{ignoreBoundary:!0}))}return r&&s}function bD(e,t){for(var r=0;r<e.coordinates.length;r++)if(!Fn(e.coordinates[r],t))return!1;return!0}function wD(e,t){var r=ur(t),n=ur(e);if(!d0(r,n))return!1;for(var i=!1,s=0;s<e.coordinates.length-1;s++){if(!Ut(e.coordinates[s],t))return!1;if(i||(i=Ut(e.coordinates[s],t,{ignoreBoundary:!0})),!i){var a=TD(e.coordinates[s],e.coordinates[s+1]);i=Ut(a,t,{ignoreBoundary:!0})}}return i}function SD(e,t){var r=ur(e),n=ur(t);if(!d0(n,r))return!1;for(var i=0;i<e.coordinates[0].length;i++)if(!Ut(e.coordinates[0][i],t))return!1;return!0}function d0(e,t){return!(e[0]>t[0]||e[2]<t[2]||e[1]>t[1]||e[3]<t[3])}function m0(e,t){return e[0]===t[0]&&e[1]===t[1]}function TD(e,t){return[(e[0]+t[0])/2,(e[1]+t[1])/2]}function p0(e,t,r){if(r=r||{},!fe(r))throw new Error("options is invalid");var n=r.mask,i=r.properties,s=[];if(t==null)throw new Error("cellSide is required");if(!bt(t))throw new Error("cellSide is invalid");if(!e)throw new Error("bbox is required");if(!Array.isArray(e))throw new Error("bbox must be array");if(e.length!==4)throw new Error("bbox must contain 4 numbers");if(n&&["Polygon","MultiPolygon"].indexOf(Mt(n))===-1)throw new Error("options.mask must be a (Multi)Polygon");for(var a=e[0],o=e[1],u=e[2],f=e[3],l=t/Et([a,o],[u,o],r),c=l*(u-a),h=t/Et([a,o],[a,f],r),d=h*(f-o),m=u-a,g=f-o,p=Math.floor(m/c),v=Math.floor(g/d),_=(m-p*c)/2,y=(g-v*d)/2,x=a+_;x<=u;){for(var E=o+y;E<=f;){var S=gt([x,E],i);n?h0(S,n)&&s.push(S):s.push(S),E+=d}x+=c}return ge(s)}function Yo(e,t){if(t=t||{},!fe(t))throw new Error("options is invalid");var r=t.precision,n=t.coordinates,i=t.mutate;if(r=r==null||isNaN(r)?6:r,n=n==null||isNaN(n)?3:n,!e)throw new Error("<geojson> is required");if(typeof r!="number")throw new Error("<precision> must be a number");if(typeof n!="number")throw new Error("<coordinates> must be a number");(i===!1||i===void 0)&&(e=JSON.parse(JSON.stringify(e)));var s=Math.pow(10,r);return mr(e,function(a){ID(a,s,n)}),e}function ID(e,t,r){e.length>r&&e.splice(r,e.length);for(var n=0;n<e.length;n++)e[n]=Math.round(e[n]*t)/t;return e}function LD(e){if(!e)throw new Error("geojson is required");var t=[];return Jt(e,function(r){t.push(r)}),ge(t)}function PD(e,t,r){if(r=r||{},!fe(r))throw new Error("options is invalid");var n=r.units,i=r.reverse;if(!e)throw new Error("geojson is required");if(t<=0)throw new Error("segmentLength must be greater than 0");var s=[];return Jt(e,function(a){i&&(a.geometry.coordinates=a.geometry.coordinates.reverse()),MD(a,t,n,function(o){s.push(o)})}),ge(s)}function MD(e,t,r,n){var i=km(e,{units:r});if(i<=t)return n(e);var s=i/t;Number.isInteger(s)||(s=Math.floor(s)+1);for(var a=0;a<s;a++){var o=c0(e,t*a,t*(a+1),{units:r});n(o,a)}}var AD=function(e,t,r){if(e.geometry.type!=="Polygon")throw new Error("The input feature must be a Polygon");r===void 0&&(r=1);var n=e.geometry.coordinates,i=[],s={};if(r){for(var a=[],o=0;o<n.length;o++)for(var u=0;u<n[o].length-1;u++)a.push(p(o,u));var f=$o();f.load(a)}for(var l=0;l<n.length;l++)for(var c=0;c<n[l].length-1;c++)if(r){var h=f.search(p(l,c));h.forEach(function(v){var _=v.ring,y=v.edge;g(l,c,_,y)})}else for(var d=0;d<n.length;d++)for(var m=0;m<n[d].length-1;m++)g(l,c,d,m);return t||(i={type:"Feature",geometry:{type:"MultiPoint",coordinates:i}}),i;function g(v,_,y,x){var E=n[v][_],S=n[v][_+1],I=n[y][x],P=n[y][x+1],w=DD(E,S,I,P);if(w!==null){var N,B;if(S[0]!==E[0]?N=(w[0]-E[0])/(S[0]-E[0]):N=(w[1]-E[1])/(S[1]-E[1]),P[0]!==I[0]?B=(w[0]-I[0])/(P[0]-I[0]):B=(w[1]-I[1])/(P[1]-I[1]),!(N>=1||N<=0||B>=1||B<=0)){var C=w,b=!s[C];b&&(s[C]=!0),t?i.push(t(w,v,_,E,S,N,y,x,I,P,B,b)):i.push(w)}}}function p(v,_){var y=n[v][_],x=n[v][_+1],E,S,I,P;return y[0]<x[0]?(E=y[0],S=x[0]):(E=x[0],S=y[0]),y[1]<x[1]?(I=y[1],P=x[1]):(I=x[1],P=y[1]),{minX:E,minY:I,maxX:S,maxY:P,ring:v,edge:_}}};function DD(e,t,r,n){if(Cf(e,r)||Cf(e,n)||Cf(t,r)||Cf(n,r))return null;var i=e[0],s=e[1],a=t[0],o=t[1],u=r[0],f=r[1],l=n[0],c=n[1],h=(i-a)*(f-c)-(s-o)*(u-l);if(h===0)return null;var d=((i*o-s*a)*(u-l)-(i-a)*(u*c-f*l))/h,m=((i*o-s*a)*(f-c)-(s-o)*(u*c-f*l))/h;return[d,m]}function Cf(e,t){if(!e||!t||e.length!==t.length)return!1;for(var r=0,n=e.length;r<n;r++)if(e[r]instanceof Array&&t[r]instanceof Array){if(!Cf(e[r],t[r]))return!1}else if(e[r]!==t[r])return!1;return!0}var RD=function(e){if(e.type!="Feature")throw new Error("The input must a geojson object of type Feature");if(e.geometry===void 0||e.geometry==null)throw new Error("The input must a geojson object with a non-empty geometry");if(e.geometry.type!="Polygon")throw new Error("The input must be a geojson Polygon");for(var t=e.geometry.coordinates.length,r=[],_=0;_<t;_++){var n=e.geometry.coordinates[_];yf(n[0],n[n.length-1])||n.push(n[0]),r.push.apply(r,n.slice(0,n.length-1))}if(!ND(r))throw new Error("The input polygon may not have duplicate vertices (except for the first and last vertex of each ring)");var i=r.length,s=AD(e,function(K,re,ce,Se,de,Ae,ye,Ie,$,De,se,be){return[K,re,ce,Se,de,Ae,ye,Ie,$,De,se,be]}),a=s.length;if(a==0){for(var I=[],_=0;_<t;_++)I.push(ze([e.geometry.coordinates[_]],{parent:-1,winding:OD(e.geometry.coordinates[_])}));var O=ge(I);return U(),q(),O}for(var o=[],u=[],_=0;_<t;_++){o.push([]);for(var f=0;f<e.geometry.coordinates[_].length-1;f++)o[_].push([new EC(e.geometry.coordinates[_][(f+1).modulo(e.geometry.coordinates[_].length-1)],1,[_,f],[_,(f+1).modulo(e.geometry.coordinates[_].length-1)],void 0)]),u.push(new bC(e.geometry.coordinates[_][f],[_,(f-1).modulo(e.geometry.coordinates[_].length-1)],[_,f],void 0,void 0,!1,!0))}for(var _=0;_<a;_++)o[s[_][1]][s[_][2]].push(new EC(s[_][0],s[_][5],[s[_][1],s[_][2]],[s[_][6],s[_][7]],void 0)),s[_][11]&&u.push(new bC(s[_][0],[s[_][1],s[_][2]],[s[_][6],s[_][7]],void 0,void 0,!0,!0));for(var l=u.length,_=0;_<o.length;_++)for(var f=0;f<o[_].length;f++)o[_][f].sort(function(re,ce){return re.param<ce.param?-1:1});for(var c=[],_=0;_<l;_++)c.push({minX:u[_].coord[0],minY:u[_].coord[1],maxX:u[_].coord[0],maxY:u[_].coord[1],index:_});var h=$o();h.load(c);for(var _=0;_<o.length;_++)for(var f=0;f<o[_].length;f++)for(var d=0;d<o[_][f].length;d++){var m;d==o[_][f].length-1?m=o[_][(f+1).modulo(e.geometry.coordinates[_].length-1)][0].coord:m=o[_][f][d+1].coord;var g=h.search({minX:m[0],minY:m[1],maxX:m[0],maxY:m[1]})[0];o[_][f][d].nxtIsectAlongEdgeIn=g.index}for(var _=0;_<o.length;_++)for(var f=0;f<o[_].length;f++)for(var d=0;d<o[_][f].length;d++){var m=o[_][f][d].coord,g=h.search({minX:m[0],minY:m[1],maxX:m[0],maxY:m[1]})[0],p=g.index;p<i?u[p].nxtIsectAlongRingAndEdge2=o[_][f][d].nxtIsectAlongEdgeIn:yf(u[p].ringAndEdge1,o[_][f][d].ringAndEdgeIn)?u[p].nxtIsectAlongRingAndEdge1=o[_][f][d].nxtIsectAlongEdgeIn:u[p].nxtIsectAlongRingAndEdge2=o[_][f][d].nxtIsectAlongEdgeIn}for(var v=[],_=0,f=0;f<t;f++){for(var y=_,d=0;d<e.geometry.coordinates[f].length-1;d++)u[_].coord[0]<u[y].coord[0]&&(y=_),_++;for(var x=u[y].nxtIsectAlongRingAndEdge2,d=0;d<u.length;d++)if(u[d].nxtIsectAlongRingAndEdge1==y||u[d].nxtIsectAlongRingAndEdge2==y){var E=d;break}var S=dc([u[E].coord,u[y].coord,u[x].coord],!0)?1:-1;v.push({isect:y,parent:-1,winding:S})}v.sort(function(W,K){return u[W.isect].coord>u[K.isect].coord?-1:1});for(var I=[];v.length>0;){var P=v.pop(),w=P.isect,N=P.parent,B=P.winding,C=I.length,b=[u[w].coord],T=w;if(u[w].ringAndEdge1Walkable)var A=u[w].ringAndEdge1,R=u[w].nxtIsectAlongRingAndEdge1;else var A=u[w].ringAndEdge2,R=u[w].nxtIsectAlongRingAndEdge2;for(;!yf(u[w].coord,u[R].coord);){b.push(u[R].coord);for(var F=void 0,_=0;_<v.length;_++)if(v[_].isect==R){F=_;break}if(F!=null&&v.splice(F,1),yf(A,u[R].ringAndEdge1)){if(A=u[R].ringAndEdge2,u[R].ringAndEdge2Walkable=!1,u[R].ringAndEdge1Walkable){var D={isect:R};dc([u[T].coord,u[R].coord,u[u[R].nxtIsectAlongRingAndEdge2].coord],B==1)?(D.parent=N,D.winding=-B):(D.parent=C,D.winding=B),v.push(D)}T=R,R=u[R].nxtIsectAlongRingAndEdge2}else{if(A=u[R].ringAndEdge1,u[R].ringAndEdge1Walkable=!1,u[R].ringAndEdge2Walkable){var D={isect:R};dc([u[T].coord,u[R].coord,u[u[R].nxtIsectAlongRingAndEdge1].coord],B==1)?(D.parent=N,D.winding=-B):(D.parent=C,D.winding=B),v.push(D)}T=R,R=u[R].nxtIsectAlongRingAndEdge1}}b.push(u[R].coord),I.push(ze([b],{index:C,parent:N,winding:B,netWinding:void 0}))}var O=ge(I);U(),q();function U(){for(var W=[],K=0;K<O.features.length;K++)O.features[K].properties.parent==-1&&W.push(K);if(W.length>1)for(var K=0;K<W.length;K++){for(var re=-1,ce=1/0,Se=0;Se<O.features.length;Se++)W[K]!=Se&&Ut(O.features[W[K]].geometry.coordinates[0][0],O.features[Se],{ignoreBoundary:!0})&&Mf(O.features[Se])<ce&&(re=Se);O.features[W[K]].properties.parent=re}}function q(){for(var W=0;W<O.features.length;W++)if(O.features[W].properties.parent==-1){var K=O.features[W].properties.winding;O.features[W].properties.netWinding=K,Y(W,K)}}function Y(W,K){for(var re=0;re<O.features.length;re++)if(O.features[re].properties.parent==W){var ce=K+O.features[re].properties.winding;O.features[re].properties.netWinding=ce,Y(re,ce)}}return O},EC=function(e,t,r,n,i){this.coord=e,this.param=t,this.ringAndEdgeIn=r,this.ringAndEdgeOut=n,this.nxtIsectAlongEdgeIn=i},bC=function(e,t,r,n,i,s,a){this.coord=e,this.ringAndEdge1=t,this.ringAndEdge2=r,this.nxtIsectAlongRingAndEdge1=n,this.nxtIsectAlongRingAndEdge2=i,this.ringAndEdge1Walkable=s,this.ringAndEdge2Walkable=a};function dc(e,t){if(typeof t>"u"&&(t=!0),e.length!=3)throw new Error("This function requires an array of three points [x,y]");var r=(e[1][0]-e[0][0])*(e[2][1]-e[0][1])-(e[1][1]-e[0][1])*(e[2][0]-e[0][0]);return r>=0==t}function OD(e){for(var t=0,r=0;r<e.length-1;r++)e[r][0]<e[t][0]&&(t=r);if(dc([e[(t-1).modulo(e.length-1)],e[t],e[(t+1).modulo(e.length-1)]],!0))var n=1;else var n=-1;return n}function yf(e,t){if(!e||!t||e.length!=t.length)return!1;for(var r=0,n=e.length;r<n;r++)if(e[r]instanceof Array&&t[r]instanceof Array){if(!yf(e[r],t[r]))return!1}else if(e[r]!=t[r])return!1;return!0}Number.prototype.modulo=function(e){return(this%e+e)%e};function ND(e){for(var t={},r=1,n=0,i=e.length;n<i;++n){if(t.hasOwnProperty(e[n])){r=0;break}t[e[n]]=1}return r}function FD(e){var t=[];return Jt(e,function(r){r.geometry.type==="Polygon"&&wt(RD(r),function(n){t.push(ze(n.geometry.coordinates,r.properties))})}),ge(t)}var wC=Math.PI/180,SC=180/Math.PI,Af=function(e,t){this.lon=e,this.lat=t,this.x=wC*e,this.y=wC*t};Af.prototype.view=function(){return String(this.lon).slice(0,4)+","+String(this.lat).slice(0,4)};Af.prototype.antipode=function(){var e=-1*this.lat,t=this.lon<0?180+this.lon:(180-this.lon)*-1;return new Af(t,e)};var g0=function(){this.coords=[],this.length=0};g0.prototype.move_to=function(e){this.length++,this.coords.push(e)};var cp=function(e){this.properties=e||{},this.geometries=[]};cp.prototype.json=function(){if(this.geometries.length<=0)return{geometry:{type:"LineString",coordinates:null},type:"Feature",properties:this.properties};if(this.geometries.length===1)return{geometry:{type:"LineString",coordinates:this.geometries[0].coords},type:"Feature",properties:this.properties};for(var e=[],t=0;t<this.geometries.length;t++)e.push(this.geometries[t].coords);return{geometry:{type:"MultiLineString",coordinates:e},type:"Feature",properties:this.properties}};cp.prototype.wkt=function(){for(var e="",t="LINESTRING(",r=function(s){t+=s[0]+" "+s[1]+","},n=0;n<this.geometries.length;n++){if(this.geometries[n].coords.length===0)return"LINESTRING(empty)";var i=this.geometries[n].coords;i.forEach(r),e+=t.substring(0,t.length-1)+")"}return e};var hp=function(e,t,r){if(!e||e.x===void 0||e.y===void 0)throw new Error("GreatCircle constructor expects two args: start and end objects with x and y properties");if(!t||t.x===void 0||t.y===void 0)throw new Error("GreatCircle constructor expects two args: start and end objects with x and y properties");this.start=new Af(e.x,e.y),this.end=new Af(t.x,t.y),this.properties=r||{};var n=this.start.x-this.end.x,i=this.start.y-this.end.y,s=Math.pow(Math.sin(i/2),2)+Math.cos(this.start.y)*Math.cos(this.end.y)*Math.pow(Math.sin(n/2),2);if(this.g=2*Math.asin(Math.sqrt(s)),this.g===Math.PI)throw new Error("it appears "+e.view()+" and "+t.view()+" are 'antipodal', e.g diametrically opposite, thus there is no single route but rather infinite");if(isNaN(this.g))throw new Error("could not calculate great circle between "+e+" and "+t)};hp.prototype.interpolate=function(e){var t=Math.sin((1-e)*this.g)/Math.sin(this.g),r=Math.sin(e*this.g)/Math.sin(this.g),n=t*Math.cos(this.start.y)*Math.cos(this.start.x)+r*Math.cos(this.end.y)*Math.cos(this.end.x),i=t*Math.cos(this.start.y)*Math.sin(this.start.x)+r*Math.cos(this.end.y)*Math.sin(this.end.x),s=t*Math.sin(this.start.y)+r*Math.sin(this.end.y),a=SC*Math.atan2(s,Math.sqrt(Math.pow(n,2)+Math.pow(i,2))),o=SC*Math.atan2(i,n);return[o,a]};hp.prototype.Arc=function(e,t){var r=[];if(!e||e<=2)r.push([this.start.lon,this.start.lat]),r.push([this.end.lon,this.end.lat]);else for(var n=1/(e-1),i=0;i<e;++i){var s=n*i,a=this.interpolate(s);r.push(a)}for(var o=!1,u=0,f=t&&t.offset?t.offset:10,l=180-f,c=-180+f,h=360-f,d=1;d<r.length;++d){var m=r[d-1][0],g=r[d][0],p=Math.abs(g-m);p>h&&(g>l&&m<c||m>l&&g<c)?o=!0:p>u&&(u=p)}var v=[];if(o&&u<f){var _=[];v.push(_);for(var y=0;y<r.length;++y){var x=parseFloat(r[y][0]);if(y>0&&Math.abs(x-r[y-1][0])>h){var E=parseFloat(r[y-1][0]),S=parseFloat(r[y-1][1]),I=parseFloat(r[y][0]),P=parseFloat(r[y][1]);if(E>-180&&E<c&&I===180&&y+1<r.length&&r[y-1][0]>-180&&r[y-1][0]<c){_.push([-180,r[y][1]]),y++,_.push([r[y][0],r[y][1]]);continue}else if(E>l&&E<180&&I===-180&&y+1<r.length&&r[y-1][0]>l&&r[y-1][0]<180){_.push([180,r[y][1]]),y++,_.push([r[y][0],r[y][1]]);continue}if(E<c&&I>l){var w=E;E=I,I=w;var N=S;S=P,P=N}if(E>l&&I<c&&(I+=360),E<=180&&I>=180&&E<I){var B=(180-E)/(I-E),C=B*P+(1-B)*S;_.push([r[y-1][0]>l?180:-180,C]),_=[],_.push([r[y-1][0]>l?-180:180,C]),v.push(_)}else _=[],v.push(_);_.push([x,r[y][1]])}else _.push([r[y][0],r[y][1]])}}else{var b=[];v.push(b);for(var T=0;T<r.length;++T)b.push([r[T][0],r[T][1]])}for(var A=new cp(this.properties),R=0;R<v.length;++R){var F=new g0;A.geometries.push(F);for(var D=v[R],O=0;O<D.length;++O)F.move_to(D[O])}return A};function BD(e,t,r){if(r=r||{},typeof r!="object")throw new Error("options is invalid");var n=r.properties,i=r.npoints,s=r.offset;e=Vt(e),t=Vt(t),n=n||{},i=i||100,s=s||10;var a=new hp({x:e[0],y:e[1]},{x:t[0],y:t[1]},n),o=a.Arc(i,{offset:s});return o.json()}function VD(e,t){if(!e)throw new Error("line is required");if(!t)throw new Error("splitter is required");var r=Mt(e),n=Mt(t);if(r!=="LineString")throw new Error("line must be LineString");if(n==="FeatureCollection")throw new Error("splitter cannot be a FeatureCollection");if(n==="GeometryCollection")throw new Error("splitter cannot be a GeometryCollection");var i=Yo(t,{precision:7});switch(n){case"Point":return Um(e,i);case"MultiPoint":return TC(e,i);case"LineString":case"MultiLineString":case"Polygon":case"MultiPolygon":return TC(e,Zs(e,i))}}function TC(e,t){var r=[],n=Zf();return Jt(t,function(i){if(r.forEach(function(o,u){o.id=u}),!r.length)r=Um(e,i).features,r.forEach(function(o){o.bbox||(o.bbox=t0(ur(o)))}),n.load(ge(r));else{var s=n.search(i);if(s.features.length){var a=v0(i,s);r=r.filter(function(o){return o.id!==a.id}),n.remove(a),wt(Um(a,i),function(o){r.push(o),n.insert(o)})}}}),ge(r)}function Um(e,t){var r=[],n=le(e)[0],i=le(e)[e.geometry.coordinates.length-1];if(Sm(n,Vt(t))||Sm(i,Vt(t)))return ge([e]);var s=Zf(),a=no(e);s.load(a);var o=s.search(t);if(!o.features.length)return ge([e]);var u=v0(t,o),f=[n],l=ep(a,function(c,h,d){var m=le(h)[1],g=Vt(t);return d===u.id?(c.push(g),r.push(Pt(c)),Sm(g,m)?[g]:[g,m]):(c.push(m),c)},f);return l.length>1&&r.push(Pt(l)),ge(r)}function v0(e,t){if(!t.features.length)throw new Error("lines must contain features");if(t.features.length===1)return t.features[0];var r,n=1/0;return wt(t,function(i){var s=Fs(i,e),a=s.properties.dist;a<n&&(r=i,n=a)}),r}function Sm(e,t){return e[0]===t[0]&&e[1]===t[1]}function _0(e,t,r,n,i){if(i=i||{},!fe(i))throw new Error("options is invalid");var s=i.steps,a=i.units;if(!e)throw new Error("center is required");if(!t)throw new Error("radius is required");if(r==null)throw new Error("bearing1 is required");if(n==null)throw new Error("bearing2 is required");if(typeof i!="object")throw new Error("options must be an object");s=s||64;var o=IC(r),u=IC(n),f=e.properties;if(o===u)return Pt(fp(e,t,i).geometry.coordinates[0],f);for(var l=o,c=o<u?u:u+360,h=l,d=[],m=0;h<c;)d.push(cs(e,t,h,a).geometry.coordinates),m++,h=l+m*360/s;return h>c&&d.push(cs(e,t,c,a).geometry.coordinates),Pt(d,f)}function IC(e){var t=e%360;return t<0&&(t+=360),t}function xc(e,t){if(t=t||{},!fe(t))throw new Error("options is invalid");var r=t.properties,n=Mt(e),i=le(e);if(r=r||e.properties||{},!i.length)throw new Error("polygon must contain coordinates");switch(n){case"Polygon":return LC(i,r);case"MultiPolygon":var s=[];return i.forEach(function(a){s.push(LC(a,r))}),ge(s);default:throw new Error("geom "+n+" not supported")}}function LC(e,t){return e.length>1?Ra(e,t):Pt(e[0],t)}function PC(e,t){if(t=t||{},!fe(t))throw new Error("options is invalid");var r=t.properties,n=t.autoComplete,i=t.orderCoords;if(!e)throw new Error("lines is required");n=n!==void 0?n:!0,i=i!==void 0?i:!0;var s=Mt(e);switch(s){case"FeatureCollection":case"GeometryCollection":var a=[],o=e.features?e.features:e.geometries;return o.forEach(function(u){a.push(le(MC(u,{},n,i)))}),Eu(a,r)}return MC(e,r,n,i)}function MC(e,t,r,n){t=t||e.properties||{};var i=le(e),s=Mt(e);if(!i.length)throw new Error("line must contain coordinates");switch(s){case"LineString":return r&&(i=AC(i)),ze([i],t);case"MultiLineString":var a=[],o=0;return i.forEach(function(u){if(r&&(u=AC(u)),n){var f=zD(ur(Pt(u)));f>o?(a.unshift(u),o=f):a.push(u)}else a.push(u)}),ze(a,t);default:throw new Error("geometry type "+s+" is not supported")}}function AC(e){var t=e[0],r=t[0],n=t[1],i=e[e.length-1],s=i[0],a=i[1];return(r!==s||n!==a)&&e.push(t),e}function zD(e){var t=e[0],r=e[1],n=e[2],i=e[3];return Math.abs(t-n)*Math.abs(r-i)}var C0=Ec;Ec.polyline=Ec;Ec.polygon=kD;function Ec(e,t,r){var n=e.length,i=Xo(e[0],t),s=[],a,o,u,f,l;for(r||(r=[]),a=1;a<n;a++){for(o=e[a-1],u=e[a],f=l=Xo(u,t);;)if(i|f){if(i&f)break;i?(o=Gm(o,u,i,t),i=Xo(o,t)):(u=Gm(o,u,f,t),f=Xo(u,t))}else{s.push(o),f!==l?(s.push(u),a<n-1&&(r.push(s),s=[])):a===n-1&&s.push(u);break}i=l}return s.length&&r.push(s),r}function kD(e,t){var r,n,i,s,a,o,u;for(n=1;n<=8;n*=2){for(r=[],i=e[e.length-1],s=!(Xo(i,t)&n),a=0;a<e.length;a++)o=e[a],u=!(Xo(o,t)&n),u!==s&&r.push(Gm(i,o,n,t)),u&&r.push(o),i=o,s=u;if(e=r,!e.length)break}return r}function Gm(e,t,r,n){return r&8?[e[0]+(t[0]-e[0])*(n[3]-e[1])/(t[1]-e[1]),n[3]]:r&4?[e[0]+(t[0]-e[0])*(n[1]-e[1])/(t[1]-e[1]),n[1]]:r&2?[n[2],e[1]+(t[1]-e[1])*(n[2]-e[0])/(t[0]-e[0])]:r&1?[n[0],e[1]+(t[1]-e[1])*(n[0]-e[0])/(t[0]-e[0])]:null}function Xo(e,t){var r=0;return e[0]<t[0]?r|=1:e[0]>t[2]&&(r|=2),e[1]<t[1]?r|=4:e[1]>t[3]&&(r|=8),r}function UD(e,t){var r=GD(e),n=le(e),i=e.properties;switch(r){case"LineString":case"MultiLineString":var s=[];return r==="LineString"&&(n=[n]),n.forEach(function(a){C0(a,t,s)}),s.length===1?Pt(s[0],i):Ra(s,i);case"Polygon":return ze(DC(n,t),i);case"MultiPolygon":return Eu(n.map(function(a){return DC(a,t)}),i);default:throw new Error("geometry "+r+" not supported")}}function DC(e,t){for(var r=[],n=0;n<e.length;n++){var i=C0.polygon(e[n],t);i.length>0&&((i[0][0]!==i[i.length-1][0]||i[0][1]!==i[i.length-1][1])&&i.push(i[0]),i.length>=4&&r.push(i))}return r}function GD(e){return e.geometry?e.geometry.type:e.type}var RC=Array.prototype.slice;function OC(e){return Object.prototype.toString.call(e)==="[object Arguments]"}function $a(e,t,r){return r||(r={}),e===t?!0:e instanceof Date&&t instanceof Date?e.getTime()===t.getTime():!e||!t||typeof e!="object"&&typeof t!="object"?(r.strict,e===t):qD(e,t,r)}function NC(e){return e==null}function FC(e){return!(!e||typeof e!="object"||typeof e.length!="number"||typeof e.copy!="function"||typeof e.slice!="function"||e.length>0&&typeof e[0]!="number")}function qD(e,t,r){var n,i;if(NC(e)||NC(t)||e.prototype!==t.prototype)return!1;if(OC(e))return OC(t)?(e=RC.call(e),t=RC.call(t),$a(e,t,r)):!1;if(FC(e)){if(!FC(t)||e.length!==t.length)return!1;for(n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}try{var s=Object.keys(e),a=Object.keys(t)}catch{return!1}if(s.length!==a.length)return!1;for(s.sort(),a.sort(),n=s.length-1;n>=0;n--)if(s[n]!==a[n])return!1;for(n=s.length-1;n>=0;n--)if(i=s[n],!$a(e[i],t[i],r))return!1;return typeof e==typeof t}function y0(e,t,r){if(r=r||{},!fe(r))throw new Error("options is invalid");var n=r.tolerance||0,i=[],s=Zf();s.load(no(e));var a;return Ns(t,function(o){var u=!1;wt(s.search(o),function(f){if(u===!1){var l=le(o).sort(),c=le(f).sort();$a(l,c)||(n===0?Fn(l[0],f)&&Fn(l[1],f):Fs(f,l[0]).properties.dist<=n&&Fs(f,l[1]).properties.dist<=n)?(u=!0,a?a=Tm(a,o):a=o):(n===0?Fn(c[0],o)&&Fn(c[1],o):Fs(o,c[0]).properties.dist<=n&&Fs(o,c[1]).properties.dist<=n)&&(a?a=Tm(a,f):a=f)}}),u===!1&&a&&(i.push(a),a=void 0)}),a&&i.push(a),ge(i)}function Tm(e,t){var r=le(t),n=le(e),i=n[0],s=n[n.length-1],a=e.geometry.coordinates;return $a(r[0],i)?a.unshift(r[1]):$a(r[0],s)?a.push(r[1]):$a(r[1],i)?a.unshift(r[0]):$a(r[1],s)&&a.push(r[0]),e}function HD(e,t,r,n,i){if(i=i||{},!fe(i))throw new Error("options is invalid");if(!e)throw new Error("center is required");if(r==null)throw new Error("bearing1 is required");if(n==null)throw new Error("bearing2 is required");if(!t)throw new Error("radius is required");if(typeof i!="object")throw new Error("options must be an object");if(BC(r)===BC(n))return fp(e,t,i);var s=le(e),a=_0(e,t,r,n,i),o=[[s]];return mr(a,function(u){o[0].push(u)}),o[0].push(s),ze(o)}function BC(e){var t=e%360;return t<0&&(t+=360),t}function eu(e,t,r,n){if(n=n||{},!fe(n))throw new Error("options is invalid");var i=n.units,s=n.properties;if(!e)throw new Error("origin is required");if(t==null)throw new Error("distance is required");if(r==null)throw new Error("bearing is required");if(!(t>=0))throw new Error("distance must be greater than 0");var a=to(t,i,"meters"),o=Vt(e),u=WD(o,a,r);return u[0]+=u[0]-o[0]>180?-360:o[0]-u[0]>180?360:0,gt(u,s)}function WD(e,t,r,n){n=n===void 0?_r:Number(n);var i=t/n,s=e[0]*Math.PI/180,a=dr(e[1]),o=dr(r),u=i*Math.cos(o),f=a+u;Math.abs(f)>Math.PI/2&&(f=f>0?Math.PI-f:-Math.PI-f);var l=Math.log(Math.tan(f/2+Math.PI/4)/Math.tan(a/2+Math.PI/4)),c=Math.abs(l)>1e-11?u/l:Math.cos(a),h=i*Math.sin(o)/c,d=s+h;return[(d*180/Math.PI+540)%360-180,f*180/Math.PI]}function YD(e,t){var r=le(e),n=le(t),i,s,a,o,u=Mt(t);switch(u){case"Polygon":i=n[0][0],s=n[0][0],o=Df(n[0][0],n[0][n[0].length-1],r);var f=VC(n[0],r,o,a,i,s);i=f[0],s=f[1];break;case"MultiPolygon":i=n[0][0][0],s=n[0][0][0],o=Df(n[0][0][0],n[0][0][n[0][0].length-1],r),n.forEach(function(l){var c=VC(l[0],r,o,a,i,s);i=c[0],s=c[1]});break}return ge([gt(i),gt(s)])}function VC(e,t,r,n,i,s){for(var a=0;a<e.length;a++){var o=e[a],u=e[a+1];a===e.length-1&&(u=e[0]),n=Df(o,u,t),r<=0&&n>0?jD(t,o,i)||(i=o):r>0&&n<=0&&(XD(t,o,s)||(s=o)),r=n}return[i,s]}function XD(e,t,r){return Df(e,t,r)>0}function jD(e,t,r){return Df(e,t,r)<0}function Df(e,t,r){return(t[0]-e[0])*(r[1]-e[1])-(r[0]-e[0])*(t[1]-e[1])}function bc(e){if(!e)throw new Error("line is required");var t=e.geometry?e.geometry.type:e.type;if(!Array.isArray(e)&&t!=="LineString")throw new Error("geometry must be a LineString");for(var r=le(e),n=0,i=1,s,a;i<r.length;)s=a||r[0],a=r[i],n+=(a[0]-s[0])*(a[1]+s[1]),i++;return n>0}function KD(e,t){if(t=t||{},!fe(t))throw new Error("options is invalid");var r=t.reverse||!1,n=t.mutate||!1;if(!e)throw new Error("<geojson> is required");if(typeof r!="boolean")throw new Error("<reverse> must be a boolean");if(typeof n!="boolean")throw new Error("<mutate> must be a boolean");n===!1&&(e=Kr(e));var i=[];switch(e.type){case"GeometryCollection":return Mi(e,function(s){mc(s,r)}),e;case"FeatureCollection":return wt(e,function(s){wt(mc(s,r),function(a){i.push(a)})}),ge(i)}return mc(e,r)}function mc(e,t){var r=e.type==="Feature"?e.geometry.type:e.type;switch(r){case"GeometryCollection":return Mi(e,function(n){mc(n,t)}),e;case"LineString":return zC(le(e),t),e;case"Polygon":return kC(le(e),t),e;case"MultiLineString":return le(e).forEach(function(n){zC(n,t)}),e;case"MultiPolygon":return le(e).forEach(function(n){kC(n,t)}),e;case"Point":case"MultiPoint":return e}}function zC(e,t){bc(e)===t&&e.reverse()}function kC(e,t){bc(e[0])!==t&&e[0].reverse();for(var r=1;r<e.length;r++)bc(e[r])===t&&e[r].reverse()}function QD(e,t){if(t=t||{},!fe(t))throw new Error("options is invalid");var r=t.zProperty||"elevation",n=t.flip,i=t.flags;Qi(e,"Point","input must contain Points");for(var s=ZD(e,n),a=[],o=0;o<s.length;o++){for(var u=s[o],f=[],l=0;l<u.length;l++){var c=u[l];c.properties[r]?f.push(c.properties[r]):f.push(0),i===!0&&(c.properties.matrixPosition=[o,l])}a.push(f)}return a}function ZD(e,t){var r={};wt(e,function(s){var a=le(s)[1];r[a]||(r[a]=[]),r[a].push(s)});var n=Object.keys(r).map(function(s){var a=r[s],o=a.sort(function(u,f){return le(u)[0]-le(f)[0]});return o}),i=n.sort(function(s,a){return t?le(s[0])[1]-le(a[0])[1]:le(a[0])[1]-le(s[0])[1]});return i}/*!
 * @license GNU Affero General Public License.
 * Copyright (c) 2015, 2015 Ronny Lorenz <ronny@tbi.univie.ac.at>
 * v. 1.2.0
 * https://github.com/RaumZeit/MarchingSquares.js
 */var UC={successCallback:null,verbose:!1,polygons:!1},Qa={};function JD(e,t,r,n){n=n||{};for(var i=Object.keys(UC),s=0;s<i.length;s++){var a=i[s],o=n[a];o=typeof o<"u"&&o!==null?o:UC[a],Qa[a]=o}Qa.verbose&&console.log("MarchingSquaresJS-isoBands: computing isobands for ["+t+":"+(t+r)+"]");var u=AR(e,t,r),f;return Qa.polygons?(Qa.verbose&&console.log("MarchingSquaresJS-isoBands: returning single polygons for each grid cell"),f=BR(u)):(Qa.verbose&&console.log("MarchingSquaresJS-isoBands: returning polygon paths for entire data grid"),f=DR(u)),typeof Qa.successCallback=="function"&&Qa.successCallback(f),f}var nn=64,vi=16,Ar=4,qr=1,ke=[],Ue=[],Ge=[],qe=[],He=[],We=[],Ye=[],Xe=[],je=[],Ke=[],Qe=[],Ze=[],Je=[],$e=[],et=[],tt=[],rt=[],nt=[],it=[],st=[],at=[],ot=[],ut=[],ft=[];Ye[85]=Ke[85]=-1;Xe[85]=Qe[85]=0;je[85]=Ze[85]=1;it[85]=ot[85]=1;st[85]=ut[85]=0;at[85]=ft[85]=1;ke[85]=qe[85]=0;Ue[85]=He[85]=-1;Ge[85]=et[85]=0;tt[85]=Je[85]=0;rt[85]=$e[85]=1;We[85]=nt[85]=1;ot[1]=ot[169]=0;ut[1]=ut[169]=-1;ft[1]=ft[169]=0;Je[1]=Je[169]=-1;$e[1]=$e[169]=0;et[1]=et[169]=0;Ke[4]=Ke[166]=0;Qe[4]=Qe[166]=-1;Ze[4]=Ze[166]=1;tt[4]=tt[166]=1;rt[4]=rt[166]=0;nt[4]=nt[166]=0;Ye[16]=Ye[154]=0;Xe[16]=Xe[154]=1;je[16]=je[154]=1;qe[16]=qe[154]=1;He[16]=He[154]=0;We[16]=We[154]=1;it[64]=it[106]=0;st[64]=st[106]=1;at[64]=at[106]=0;ke[64]=ke[106]=-1;Ue[64]=Ue[106]=0;Ge[64]=Ge[106]=1;it[2]=it[168]=0;st[2]=st[168]=-1;at[2]=at[168]=1;ot[2]=ot[168]=0;ut[2]=ut[168]=-1;ft[2]=ft[168]=0;Je[2]=Je[168]=-1;$e[2]=$e[168]=0;et[2]=et[168]=0;tt[2]=tt[168]=-1;rt[2]=rt[168]=0;nt[2]=nt[168]=1;Ye[8]=Ye[162]=0;Xe[8]=Xe[162]=-1;je[8]=je[162]=0;Ke[8]=Ke[162]=0;Qe[8]=Qe[162]=-1;Ze[8]=Ze[162]=1;Je[8]=Je[162]=1;$e[8]=$e[162]=0;et[8]=et[162]=1;tt[8]=tt[162]=1;rt[8]=rt[162]=0;nt[8]=nt[162]=0;Ye[32]=Ye[138]=0;Xe[32]=Xe[138]=1;je[32]=je[138]=1;Ke[32]=Ke[138]=0;Qe[32]=Qe[138]=1;Ze[32]=Ze[138]=0;ke[32]=ke[138]=1;Ue[32]=Ue[138]=0;Ge[32]=Ge[138]=0;qe[32]=qe[138]=1;He[32]=He[138]=0;We[32]=We[138]=1;ot[128]=ot[42]=0;ut[128]=ut[42]=1;ft[128]=ft[42]=1;it[128]=it[42]=0;st[128]=st[42]=1;at[128]=at[42]=0;ke[128]=ke[42]=-1;Ue[128]=Ue[42]=0;Ge[128]=Ge[42]=1;qe[128]=qe[42]=-1;He[128]=He[42]=0;We[128]=We[42]=0;Ke[5]=Ke[165]=-1;Qe[5]=Qe[165]=0;Ze[5]=Ze[165]=0;ot[5]=ot[165]=1;ut[5]=ut[165]=0;ft[5]=ft[165]=0;tt[20]=tt[150]=0;rt[20]=rt[150]=1;nt[20]=nt[150]=1;qe[20]=qe[150]=0;He[20]=He[150]=-1;We[20]=We[150]=1;Ye[80]=Ye[90]=-1;Xe[80]=Xe[90]=0;je[80]=je[90]=1;it[80]=it[90]=1;st[80]=st[90]=0;at[80]=at[90]=1;Je[65]=Je[105]=0;$e[65]=$e[105]=1;et[65]=et[105]=0;ke[65]=ke[105]=0;Ue[65]=Ue[105]=-1;Ge[65]=Ge[105]=0;Ye[160]=Ye[10]=-1;Xe[160]=Xe[10]=0;je[160]=je[10]=1;Ke[160]=Ke[10]=-1;Qe[160]=Qe[10]=0;Ze[160]=Ze[10]=0;ot[160]=ot[10]=1;ut[160]=ut[10]=0;ft[160]=ft[10]=0;it[160]=it[10]=1;st[160]=st[10]=0;at[160]=at[10]=1;tt[130]=tt[40]=0;rt[130]=rt[40]=1;nt[130]=nt[40]=1;Je[130]=Je[40]=0;$e[130]=$e[40]=1;et[130]=et[40]=0;ke[130]=ke[40]=0;Ue[130]=Ue[40]=-1;Ge[130]=Ge[40]=0;qe[130]=qe[40]=0;He[130]=He[40]=-1;We[130]=We[40]=1;Ke[37]=Ke[133]=0;Qe[37]=Qe[133]=1;Ze[37]=Ze[133]=1;ot[37]=ot[133]=0;ut[37]=ut[133]=1;ft[37]=ft[133]=0;ke[37]=ke[133]=-1;Ue[37]=Ue[133]=0;Ge[37]=Ge[133]=0;qe[37]=qe[133]=1;He[37]=He[133]=0;We[37]=We[133]=0;tt[148]=tt[22]=-1;rt[148]=rt[22]=0;nt[148]=nt[22]=0;ot[148]=ot[22]=0;ut[148]=ut[22]=-1;ft[148]=ft[22]=1;it[148]=it[22]=0;st[148]=st[22]=1;at[148]=at[22]=1;qe[148]=qe[22]=-1;He[148]=He[22]=0;We[148]=We[22]=1;Ye[82]=Ye[88]=0;Xe[82]=Xe[88]=-1;je[82]=je[88]=1;tt[82]=tt[88]=1;rt[82]=rt[88]=0;nt[82]=nt[88]=1;Je[82]=Je[88]=-1;$e[82]=$e[88]=0;et[82]=et[88]=1;it[82]=it[88]=0;st[82]=st[88]=-1;at[82]=at[88]=0;Ye[73]=Ye[97]=0;Xe[73]=Xe[97]=1;je[73]=je[97]=0;Ke[73]=Ke[97]=0;Qe[73]=Qe[97]=-1;Ze[73]=Ze[97]=0;Je[73]=Je[97]=1;$e[73]=$e[97]=0;et[73]=et[97]=0;ke[73]=ke[97]=1;Ue[73]=Ue[97]=0;Ge[73]=Ge[97]=1;Ye[145]=Ye[25]=0;Xe[145]=Xe[25]=-1;je[145]=je[25]=0;Je[145]=Je[25]=1;$e[145]=$e[25]=0;et[145]=et[25]=1;ot[145]=ot[25]=0;ut[145]=ut[25]=1;ft[145]=ft[25]=1;qe[145]=qe[25]=-1;He[145]=He[25]=0;We[145]=We[25]=0;Ke[70]=Ke[100]=0;Qe[70]=Qe[100]=1;Ze[70]=Ze[100]=0;tt[70]=tt[100]=-1;rt[70]=rt[100]=0;nt[70]=nt[100]=1;it[70]=it[100]=0;st[70]=st[100]=-1;at[70]=at[100]=1;ke[70]=ke[100]=1;Ue[70]=Ue[100]=0;Ge[70]=Ge[100]=0;Ke[101]=Ke[69]=0;Qe[101]=Qe[69]=1;Ze[101]=Ze[69]=0;ke[101]=ke[69]=1;Ue[101]=Ue[69]=0;Ge[101]=Ge[69]=0;ot[149]=ot[21]=0;ut[149]=ut[21]=1;ft[149]=ft[21]=1;qe[149]=qe[21]=-1;He[149]=He[21]=0;We[149]=We[21]=0;tt[86]=tt[84]=-1;rt[86]=rt[84]=0;nt[86]=nt[84]=1;it[86]=it[84]=0;st[86]=st[84]=-1;at[86]=at[84]=1;Ye[89]=Ye[81]=0;Xe[89]=Xe[81]=-1;je[89]=je[81]=0;Je[89]=Je[81]=1;$e[89]=$e[81]=0;et[89]=et[81]=1;Ye[96]=Ye[74]=0;Xe[96]=Xe[74]=1;je[96]=je[74]=0;Ke[96]=Ke[74]=-1;Qe[96]=Qe[74]=0;Ze[96]=Ze[74]=1;it[96]=it[74]=1;st[96]=st[74]=0;at[96]=at[74]=0;ke[96]=ke[74]=1;Ue[96]=Ue[74]=0;Ge[96]=Ge[74]=1;Ye[24]=Ye[146]=0;Xe[24]=Xe[146]=-1;je[24]=je[146]=1;tt[24]=tt[146]=1;rt[24]=rt[146]=0;nt[24]=nt[146]=1;Je[24]=Je[146]=0;$e[24]=$e[146]=1;et[24]=et[146]=1;qe[24]=qe[146]=0;He[24]=He[146]=-1;We[24]=We[146]=0;Ke[6]=Ke[164]=-1;Qe[6]=Qe[164]=0;Ze[6]=Ze[164]=1;tt[6]=tt[164]=-1;rt[6]=rt[164]=0;nt[6]=nt[164]=0;ot[6]=ot[164]=0;ut[6]=ut[164]=-1;ft[6]=ft[164]=1;it[6]=it[164]=1;st[6]=st[164]=0;at[6]=at[164]=0;Je[129]=Je[41]=0;$e[129]=$e[41]=1;et[129]=et[41]=1;ot[129]=ot[41]=0;ut[129]=ut[41]=1;ft[129]=ft[41]=0;ke[129]=ke[41]=-1;Ue[129]=Ue[41]=0;Ge[129]=Ge[41]=0;qe[129]=qe[41]=0;He[129]=He[41]=-1;We[129]=We[41]=0;tt[66]=tt[104]=0;rt[66]=rt[104]=1;nt[66]=nt[104]=0;Je[66]=Je[104]=-1;$e[66]=$e[104]=0;et[66]=et[104]=1;it[66]=it[104]=0;st[66]=st[104]=-1;at[66]=at[104]=0;ke[66]=ke[104]=0;Ue[66]=Ue[104]=-1;Ge[66]=Ge[104]=1;Ye[144]=Ye[26]=-1;Xe[144]=Xe[26]=0;je[144]=je[26]=0;ot[144]=ot[26]=1;ut[144]=ut[26]=0;ft[144]=ft[26]=1;it[144]=it[26]=0;st[144]=st[26]=1;at[144]=at[26]=1;qe[144]=qe[26]=-1;He[144]=He[26]=0;We[144]=We[26]=1;Ke[36]=Ke[134]=0;Qe[36]=Qe[134]=1;Ze[36]=Ze[134]=1;tt[36]=tt[134]=0;rt[36]=rt[134]=1;nt[36]=nt[134]=0;ke[36]=ke[134]=0;Ue[36]=Ue[134]=-1;Ge[36]=Ge[134]=1;qe[36]=qe[134]=1;He[36]=He[134]=0;We[36]=We[134]=0;Ye[9]=Ye[161]=-1;Xe[9]=Xe[161]=0;je[9]=je[161]=0;Ke[9]=Ke[161]=0;Qe[9]=Qe[161]=-1;Ze[9]=Ze[161]=0;Je[9]=Je[161]=1;$e[9]=$e[161]=0;et[9]=et[161]=0;ot[9]=ot[161]=1;ut[9]=ut[161]=0;ft[9]=ft[161]=1;Ye[136]=0;Xe[136]=1;je[136]=1;Ke[136]=0;Qe[136]=1;Ze[136]=0;tt[136]=-1;rt[136]=0;nt[136]=1;Je[136]=-1;$e[136]=0;et[136]=0;ot[136]=0;ut[136]=-1;ft[136]=0;it[136]=0;st[136]=-1;at[136]=1;ke[136]=1;Ue[136]=0;Ge[136]=0;qe[136]=1;He[136]=0;We[136]=1;Ye[34]=0;Xe[34]=-1;je[34]=0;Ke[34]=0;Qe[34]=-1;Ze[34]=1;tt[34]=1;rt[34]=0;nt[34]=0;Je[34]=1;$e[34]=0;et[34]=1;ot[34]=0;ut[34]=1;ft[34]=1;it[34]=0;st[34]=1;at[34]=0;ke[34]=-1;Ue[34]=0;Ge[34]=1;qe[34]=-1;He[34]=0;We[34]=0;Ye[35]=0;Xe[35]=1;je[35]=1;Ke[35]=0;Qe[35]=-1;Ze[35]=1;tt[35]=1;rt[35]=0;nt[35]=0;Je[35]=-1;$e[35]=0;et[35]=0;ot[35]=0;ut[35]=-1;ft[35]=0;it[35]=0;st[35]=1;at[35]=0;ke[35]=-1;Ue[35]=0;Ge[35]=1;qe[35]=1;He[35]=0;We[35]=1;Ye[153]=0;Xe[153]=1;je[153]=1;Je[153]=-1;$e[153]=0;et[153]=0;ot[153]=0;ut[153]=-1;ft[153]=0;qe[153]=1;He[153]=0;We[153]=1;Ke[102]=0;Qe[102]=-1;Ze[102]=1;tt[102]=1;rt[102]=0;nt[102]=0;it[102]=0;st[102]=1;at[102]=0;ke[102]=-1;Ue[102]=0;Ge[102]=1;Ye[155]=0;Xe[155]=-1;je[155]=0;Je[155]=1;$e[155]=0;et[155]=1;ot[155]=0;ut[155]=1;ft[155]=1;qe[155]=-1;He[155]=0;We[155]=0;Ke[103]=0;Qe[103]=1;Ze[103]=0;tt[103]=-1;rt[103]=0;nt[103]=1;it[103]=0;st[103]=-1;at[103]=1;ke[103]=1;Ue[103]=0;Ge[103]=0;Ye[152]=0;Xe[152]=1;je[152]=1;tt[152]=-1;rt[152]=0;nt[152]=1;Je[152]=-1;$e[152]=0;et[152]=0;ot[152]=0;ut[152]=-1;ft[152]=0;it[152]=0;st[152]=-1;at[152]=1;qe[152]=1;He[152]=0;We[152]=1;Ye[156]=0;Xe[156]=-1;je[156]=1;tt[156]=1;rt[156]=0;nt[156]=1;Je[156]=-1;$e[156]=0;et[156]=0;ot[156]=0;ut[156]=-1;ft[156]=0;it[156]=0;st[156]=1;at[156]=1;qe[156]=-1;He[156]=0;We[156]=1;Ye[137]=0;Xe[137]=1;je[137]=1;Ke[137]=0;Qe[137]=1;Ze[137]=0;Je[137]=-1;$e[137]=0;et[137]=0;ot[137]=0;ut[137]=-1;ft[137]=0;ke[137]=1;Ue[137]=0;Ge[137]=0;qe[137]=1;He[137]=0;We[137]=1;Ye[139]=0;Xe[139]=1;je[139]=1;Ke[139]=0;Qe[139]=-1;Ze[139]=0;Je[139]=1;$e[139]=0;et[139]=0;ot[139]=0;ut[139]=1;ft[139]=0;ke[139]=-1;Ue[139]=0;Ge[139]=0;qe[139]=1;He[139]=0;We[139]=1;Ye[98]=0;Xe[98]=-1;je[98]=0;Ke[98]=0;Qe[98]=-1;Ze[98]=1;tt[98]=1;rt[98]=0;nt[98]=0;Je[98]=1;$e[98]=0;et[98]=1;it[98]=0;st[98]=1;at[98]=0;ke[98]=-1;Ue[98]=0;Ge[98]=1;Ye[99]=0;Xe[99]=1;je[99]=0;Ke[99]=0;Qe[99]=-1;Ze[99]=1;tt[99]=1;rt[99]=0;nt[99]=0;Je[99]=-1;$e[99]=0;et[99]=1;it[99]=0;st[99]=-1;at[99]=0;ke[99]=1;Ue[99]=0;Ge[99]=1;Ke[38]=0;Qe[38]=-1;Ze[38]=1;tt[38]=1;rt[38]=0;nt[38]=0;ot[38]=0;ut[38]=1;ft[38]=1;it[38]=0;st[38]=1;at[38]=0;ke[38]=-1;Ue[38]=0;Ge[38]=1;qe[38]=-1;He[38]=0;We[38]=0;Ke[39]=0;Qe[39]=1;Ze[39]=1;tt[39]=-1;rt[39]=0;nt[39]=0;ot[39]=0;ut[39]=-1;ft[39]=1;it[39]=0;st[39]=1;at[39]=0;ke[39]=-1;Ue[39]=0;Ge[39]=1;qe[39]=1;He[39]=0;We[39]=0;var dp=function(e){return[[e.bottomleft,0],[0,0],[0,e.leftbottom]]},mp=function(e){return[[1,e.rightbottom],[1,0],[e.bottomright,0]]},pp=function(e){return[[e.topright,1],[1,1],[1,e.righttop]]},gp=function(e){return[[0,e.lefttop],[0,1],[e.topleft,1]]},vp=function(e){return[[e.bottomright,0],[e.bottomleft,0],[0,e.leftbottom],[0,e.lefttop]]},_p=function(e){return[[e.bottomright,0],[e.bottomleft,0],[1,e.righttop],[1,e.rightbottom]]},Cp=function(e){return[[1,e.righttop],[1,e.rightbottom],[e.topleft,1],[e.topright,1]]},yp=function(e){return[[0,e.leftbottom],[0,e.lefttop],[e.topleft,1],[e.topright,1]]},$D=function(e){return[[0,0],[0,e.leftbottom],[1,e.rightbottom],[1,0]]},eR=function(e){return[[1,0],[e.bottomright,0],[e.topright,1],[1,1]]},tR=function(e){return[[1,1],[1,e.righttop],[0,e.lefttop],[0,1]]},rR=function(e){return[[e.bottomleft,0],[0,0],[0,1],[e.topleft,1]]},nR=function(e){return[[1,e.righttop],[1,e.rightbottom],[0,e.leftbottom],[0,e.lefttop]]},iR=function(e){return[[e.topleft,1],[e.topright,1],[e.bottomright,0],[e.bottomleft,0]]},sR=function(){return[[0,0],[0,1],[1,1],[1,0]]},aR=function(e){return[[1,e.rightbottom],[1,0],[0,0],[0,1],[e.topleft,1]]},oR=function(e){return[[e.topright,1],[1,1],[1,0],[0,0],[0,e.leftbottom]]},uR=function(e){return[[1,0],[e.bottomright,0],[0,e.lefttop],[0,1],[1,1]]},fR=function(e){return[[1,1],[1,e.righttop],[e.bottomleft,0],[0,0],[0,1]]},lR=function(e){return[[1,e.righttop],[1,e.rightbottom],[0,e.lefttop],[0,1],[e.topleft,1]]},cR=function(e){return[[1,1],[1,e.righttop],[e.bottomright,0],[e.bottomleft,0],[e.topright,1]]},hR=function(e){return[[1,e.rightbottom],[1,0],[e.bottomright,0],[0,e.leftbottom],[0,e.lefttop]]},dR=function(e){return[[e.topright,1],[e.bottomleft,0],[0,0],[0,e.leftbottom],[e.topleft,1]]},mR=function(e){return[[e.bottomright,0],[e.bottomleft,0],[0,e.lefttop],[0,1],[e.topleft,1]]},pR=function(e){return[[1,1],[1,e.righttop],[0,e.leftbottom],[0,e.lefttop],[e.topright,1]]},gR=function(e){return[[1,e.rightbottom],[1,0],[e.bottomright,0],[e.topleft,1],[e.topright,1]]},vR=function(e){return[[1,e.righttop],[1,e.rightbottom],[e.bottomleft,0],[0,0],[0,e.leftbottom]]},_R=function(e){return[[1,e.rightbottom],[1,0],[0,0],[0,e.leftbottom],[e.topleft,1],[e.topright,1]]},CR=function(e){return[[1,1],[1,0],[e.bottomright,0],[0,e.leftbottom],[0,e.lefttop],[e.topright,1]]},yR=function(e){return[[1,1],[1,e.righttop],[e.bottomright,0],[e.bottomleft,0],[0,e.lefttop],[0,1]]},xR=function(e){return[[1,e.righttop],[1,e.rightbottom],[e.bottomleft,0],[0,0],[0,1],[e.topleft,1]]},ER=function(e){return[[1,1],[1,e.righttop],[e.bottomleft,0],[0,0],[0,e.leftbottom],[e.topright,1]]},bR=function(e){return[[1,e.rightbottom],[1,0],[e.bottomright,0],[0,e.lefttop],[0,1],[e.topleft,1]]},wR=function(e){return[[1,e.righttop],[1,e.rightbottom],[e.bottomright,0],[e.bottomleft,0],[0,e.leftbottom],[0,e.lefttop],[e.topleft,1],[e.topright,1]]},SR=function(e){return[[1,1],[1,e.righttop],[e.bottomleft,0],[0,0],[0,e.leftbottom],[e.topright,1]]},TR=function(e){return[[1,e.rightbottom],[1,0],[e.bottomright,0],[0,e.lefttop],[0,1],[e.topleft,1]]},IR=function(e){return[[1,1],[1,e.righttop],[e.bottomright,0],[e.bottomleft,0],[0,e.leftbottom],[0,e.lefttop],[e.topright,1]]},LR=function(e){return[[1,e.righttop],[1,e.rightbottom],[e.bottomleft,0],[0,0],[0,e.leftbottom],[e.topleft,1],[e.topright,1]]},PR=function(e){return[[1,e.righttop],[1,e.rightbottom],[e.bottomright,0],[e.bottomleft,0],[0,e.lefttop],[0,1],[e.topleft,1]]},MR=function(e){return[[1,e.rightbottom],[1,0],[e.bottomright,0],[0,e.leftbottom],[0,e.lefttop],[e.topleft,1],[e.topright,1]]},ie=[],ne=[],he=[],ue=[],Ce=[],ve=[],lt=[],dt=[];ue[1]=Ce[1]=18;ue[169]=Ce[169]=18;he[4]=ne[4]=12;he[166]=ne[166]=12;ie[16]=dt[16]=4;ie[154]=dt[154]=4;ve[64]=lt[64]=22;ve[106]=lt[106]=22;he[2]=ve[2]=17;ue[2]=Ce[2]=18;he[168]=ve[168]=17;ue[168]=Ce[168]=18;ie[8]=ue[8]=9;ne[8]=he[8]=12;ie[162]=ue[162]=9;ne[162]=he[162]=12;ie[32]=dt[32]=4;ne[32]=lt[32]=1;ie[138]=dt[138]=4;ne[138]=lt[138]=1;Ce[128]=dt[128]=21;ve[128]=lt[128]=22;Ce[42]=dt[42]=21;ve[42]=lt[42]=22;ne[5]=Ce[5]=14;ne[165]=Ce[165]=14;he[20]=dt[20]=6;he[150]=dt[150]=6;ie[80]=ve[80]=11;ie[90]=ve[90]=11;ue[65]=lt[65]=3;ue[105]=lt[105]=3;ie[160]=ve[160]=11;ne[160]=Ce[160]=14;ie[10]=ve[10]=11;ne[10]=Ce[10]=14;he[130]=dt[130]=6;ue[130]=lt[130]=3;he[40]=dt[40]=6;ue[40]=lt[40]=3;ne[101]=lt[101]=1;ne[69]=lt[69]=1;Ce[149]=dt[149]=21;Ce[21]=dt[21]=21;he[86]=ve[86]=17;he[84]=ve[84]=17;ie[89]=ue[89]=9;ie[81]=ue[81]=9;ie[96]=lt[96]=0;ne[96]=ve[96]=15;ie[74]=lt[74]=0;ne[74]=ve[74]=15;ie[24]=he[24]=8;ue[24]=dt[24]=7;ie[146]=he[146]=8;ue[146]=dt[146]=7;ne[6]=ve[6]=15;he[6]=Ce[6]=16;ne[164]=ve[164]=15;he[164]=Ce[164]=16;ue[129]=dt[129]=7;Ce[129]=lt[129]=20;ue[41]=dt[41]=7;Ce[41]=lt[41]=20;he[66]=lt[66]=2;ue[66]=ve[66]=19;he[104]=lt[104]=2;ue[104]=ve[104]=19;ie[144]=Ce[144]=10;ve[144]=dt[144]=23;ie[26]=Ce[26]=10;ve[26]=dt[26]=23;ne[36]=dt[36]=5;he[36]=lt[36]=2;ne[134]=dt[134]=5;he[134]=lt[134]=2;ie[9]=Ce[9]=10;ne[9]=ue[9]=13;ie[161]=Ce[161]=10;ne[161]=ue[161]=13;ne[37]=dt[37]=5;Ce[37]=lt[37]=20;ne[133]=dt[133]=5;Ce[133]=lt[133]=20;he[148]=Ce[148]=16;ve[148]=dt[148]=23;he[22]=Ce[22]=16;ve[22]=dt[22]=23;ie[82]=he[82]=8;ue[82]=ve[82]=19;ie[88]=he[88]=8;ue[88]=ve[88]=19;ie[73]=lt[73]=0;ne[73]=ue[73]=13;ie[97]=lt[97]=0;ne[97]=ue[97]=13;ie[145]=ue[145]=9;Ce[145]=dt[145]=21;ie[25]=ue[25]=9;Ce[25]=dt[25]=21;ne[70]=lt[70]=1;he[70]=ve[70]=17;ne[100]=lt[100]=1;he[100]=ve[100]=17;ie[34]=ue[34]=9;ne[34]=he[34]=12;Ce[34]=dt[34]=21;ve[34]=lt[34]=22;ie[136]=dt[136]=4;ne[136]=lt[136]=1;he[136]=ve[136]=17;ue[136]=Ce[136]=18;ie[35]=dt[35]=4;ne[35]=he[35]=12;ue[35]=Ce[35]=18;ve[35]=lt[35]=22;ie[153]=dt[153]=4;ue[153]=Ce[153]=18;ne[102]=he[102]=12;ve[102]=lt[102]=22;ie[155]=ue[155]=9;Ce[155]=dt[155]=23;ne[103]=lt[103]=1;he[103]=ve[103]=17;ie[152]=dt[152]=4;he[152]=ve[152]=17;ue[152]=Ce[152]=18;ie[156]=he[156]=8;ue[156]=Ce[156]=18;ve[156]=dt[156]=23;ie[137]=dt[137]=4;ne[137]=lt[137]=1;ue[137]=Ce[137]=18;ie[139]=dt[139]=4;ne[139]=ue[139]=13;Ce[139]=lt[139]=20;ie[98]=ue[98]=9;ne[98]=he[98]=12;ve[98]=lt[98]=22;ie[99]=lt[99]=0;ne[99]=he[99]=12;ue[99]=ve[99]=19;ne[38]=he[38]=12;Ce[38]=dt[38]=21;ve[38]=lt[38]=22;ne[39]=dt[39]=5;he[39]=Ce[39]=16;ve[39]=lt[39]=22;var te=[];te[1]=te[169]=dp;te[4]=te[166]=mp;te[16]=te[154]=pp;te[64]=te[106]=gp;te[168]=te[2]=vp;te[162]=te[8]=_p;te[138]=te[32]=Cp;te[42]=te[128]=yp;te[5]=te[165]=$D;te[20]=te[150]=eR;te[80]=te[90]=tR;te[65]=te[105]=rR;te[160]=te[10]=nR;te[130]=te[40]=iR;te[85]=sR;te[101]=te[69]=aR;te[149]=te[21]=oR;te[86]=te[84]=uR;te[89]=te[81]=fR;te[96]=te[74]=lR;te[24]=te[146]=cR;te[6]=te[164]=hR;te[129]=te[41]=dR;te[66]=te[104]=mR;te[144]=te[26]=pR;te[36]=te[134]=gR;te[9]=te[161]=vR;te[37]=te[133]=_R;te[148]=te[22]=CR;te[82]=te[88]=yR;te[73]=te[97]=xR;te[145]=te[25]=ER;te[70]=te[100]=bR;te[34]=function(e){return[yp(e),_p(e)]};te[35]=wR;te[136]=function(e){return[Cp(e),vp(e)]};te[153]=function(e){return[pp(e),dp(e)]};te[102]=function(e){return[mp(e),gp(e)]};te[155]=SR;te[103]=TR;te[152]=function(e){return[pp(e),vp(e)]};te[156]=IR;te[137]=function(e){return[Cp(e),dp(e)]};te[139]=LR;te[98]=function(e){return[_p(e),gp(e)]};te[99]=PR;te[38]=function(e){return[mp(e),yp(e)]};te[39]=MR;function L(e,t,r){return(e-t)/(r-t)}function Im(e){return e.constructor.toString().indexOf("Array")>-1}function AR(e,t,r){for(var n=e.length-1,i=e[0].length-1,s={rows:n,cols:i,cells:[]},a=t+Math.abs(r),o=0;o<n;++o){s.cells[o]=[];for(var u=0;u<i;++u){var f=0,l=e[o+1][u],c=e[o+1][u+1],h=e[o][u+1],d=e[o][u];if(!(isNaN(l)||isNaN(c)||isNaN(h)||isNaN(d))){f|=l<t?0:l>a?128:64,f|=c<t?0:c>a?32:16,f|=h<t?0:h>a?8:4,f|=d<t?0:d>a?2:1;var m=+f,g=0;if(f===17||f===18||f===33||f===34||f===38||f===68||f===72||f===98||f===102||f===132||f===136||f===137||f===152||f===153){var p=(l+c+h+d)/4;g=p>a?2:p<t?0:1,f===34?g===1?f=35:g===0&&(f=136):f===136?g===1?(f=35,g=4):g===0&&(f=34):f===17?g===1?(f=155,g=4):g===0&&(f=153):f===68?g===1?(f=103,g=4):g===0&&(f=102):f===153?g===1&&(f=155):f===102?g===1&&(f=103):f===152?g<2&&(f=156,g=1):f===137?g<2&&(f=139,g=1):f===98?g<2&&(f=99,g=1):f===38?g<2&&(f=39,g=1):f===18?g>0?(f=156,g=4):f=152:f===33?g>0?(f=139,g=4):f=137:f===72?g>0?(f=99,g=4):f=98:f===132&&(g>0?(f=39,g=4):f=38)}if(f!=0&&f!=170){var v,_,y,x,E,S,I,P;v=_=y=x=E=S=I=P=.5;var w=[];f===1?(y=1-L(t,h,d),P=1-L(t,l,d),w.push(ue[f])):f===169?(y=L(a,d,h),P=L(a,d,l),w.push(ue[f])):f===4?(S=1-L(t,c,h),x=L(t,d,h),w.push(ne[f])):f===166?(S=L(a,h,c),x=1-L(a,h,d),w.push(ne[f])):f===16?(E=L(t,h,c),_=L(t,l,c),w.push(ie[f])):f===154?(E=1-L(a,c,h),_=1-L(a,c,l),w.push(ie[f])):f===64?(I=L(t,d,l),v=1-L(t,c,l),w.push(ve[f])):f===106?(I=1-L(a,l,d),v=L(a,l,c),w.push(ve[f])):f===168?(x=L(a,d,h),y=L(t,d,h),P=L(t,d,l),I=L(a,d,l),w.push(he[f]),w.push(ue[f])):f===2?(x=1-L(t,h,d),y=1-L(a,h,d),P=1-L(a,l,d),I=1-L(t,l,d),w.push(he[f]),w.push(ue[f])):f===162?(E=L(a,h,c),S=L(t,h,c),x=1-L(t,h,d),y=1-L(a,h,d),w.push(he[f]),w.push(ue[f])):f===8?(E=1-L(t,c,h),S=1-L(a,c,h),x=L(a,d,h),y=L(t,d,h),w.push(ie[f]),w.push(ne[f])):f===138?(E=1-L(t,c,h),S=1-L(a,c,h),v=1-L(a,c,l),_=1-L(t,c,l),w.push(ie[f]),w.push(ne[f])):f===32?(E=L(a,h,c),S=L(t,h,c),v=L(t,l,c),_=L(a,l,c),w.push(ie[f]),w.push(ne[f])):f===42?(P=1-L(a,l,d),I=1-L(t,l,d),v=L(t,l,c),_=L(a,l,c),w.push(Ce[f]),w.push(ve[f])):f===128&&(P=L(t,d,l),I=L(a,d,l),v=1-L(a,c,l),_=1-L(t,c,l),w.push(Ce[f]),w.push(ve[f])),f===5?(S=1-L(t,c,h),P=1-L(t,l,d),w.push(ne[f])):f===165?(S=L(a,h,c),P=L(a,d,l),w.push(ne[f])):f===20?(x=L(t,d,h),_=L(t,l,c),w.push(he[f])):f===150?(x=1-L(a,h,d),_=1-L(a,c,l),w.push(he[f])):f===80?(E=L(t,h,c),I=L(t,d,l),w.push(ie[f])):f===90?(E=1-L(a,c,h),I=1-L(a,l,d),w.push(ie[f])):f===65?(y=1-L(t,h,d),v=1-L(t,c,l),w.push(ue[f])):f===105?(y=L(a,d,h),v=L(a,l,c),w.push(ue[f])):f===160?(E=L(a,h,c),S=L(t,h,c),P=L(t,d,l),I=L(a,d,l),w.push(ie[f]),w.push(ne[f])):f===10?(E=1-L(t,c,h),S=1-L(a,c,h),P=1-L(a,l,d),I=1-L(t,l,d),w.push(ie[f]),w.push(ne[f])):f===130?(x=1-L(t,h,d),y=1-L(a,h,d),v=1-L(a,c,l),_=1-L(t,c,l),w.push(he[f]),w.push(ue[f])):f===40?(x=L(a,d,h),y=L(t,d,h),v=L(t,l,c),_=L(a,l,c),w.push(he[f]),w.push(ue[f])):f===101?(S=L(a,h,c),v=L(a,l,c),w.push(ne[f])):f===69?(S=1-L(t,c,h),v=1-L(t,c,l),w.push(ne[f])):f===149?(P=L(a,d,l),_=1-L(a,c,l),w.push(Ce[f])):f===21?(P=1-L(t,l,d),_=L(t,l,c),w.push(Ce[f])):f===86?(x=1-L(a,h,d),I=1-L(a,l,d),w.push(he[f])):f===84?(x=L(t,d,h),I=L(t,d,l),w.push(he[f])):f===89?(E=1-L(a,c,h),y=L(a,d,h),w.push(ue[f])):f===81?(E=L(t,h,c),y=1-L(t,h,d),w.push(ue[f])):f===96?(E=L(a,h,c),S=L(t,h,c),I=L(t,d,l),v=L(a,l,c),w.push(ie[f]),w.push(ne[f])):f===74?(E=1-L(t,c,h),S=1-L(a,c,h),I=1-L(a,l,d),v=1-L(t,c,l),w.push(ie[f]),w.push(ne[f])):f===24?(E=1-L(a,c,h),x=L(a,d,h),y=L(t,d,h),_=L(t,l,c),w.push(ie[f]),w.push(ue[f])):f===146?(E=L(t,h,c),x=1-L(t,h,d),y=1-L(a,h,d),_=1-L(a,c,l),w.push(ie[f]),w.push(ue[f])):f===6?(S=1-L(t,c,h),x=1-L(a,h,d),P=1-L(a,l,d),I=1-L(t,l,d),w.push(ne[f]),w.push(he[f])):f===164?(S=L(a,h,c),x=L(t,d,h),P=L(t,d,l),I=L(a,d,l),w.push(ne[f]),w.push(he[f])):f===129?(y=1-L(t,h,d),P=L(a,d,l),v=1-L(a,c,l),_=1-L(t,c,l),w.push(ue[f]),w.push(Ce[f])):f===41?(y=L(a,d,h),P=1-L(t,l,d),v=L(t,l,c),_=L(a,l,c),w.push(ue[f]),w.push(Ce[f])):f===66?(x=1-L(t,h,d),y=1-L(a,h,d),I=1-L(a,l,d),v=1-L(t,c,l),w.push(he[f]),w.push(ue[f])):f===104?(x=L(a,d,h),y=L(t,d,h),I=L(t,d,l),v=L(a,l,c),w.push(ue[f]),w.push(lt[f])):f===144?(E=L(t,h,c),P=L(t,d,l),I=L(a,d,l),_=1-L(a,c,l),w.push(ie[f]),w.push(ve[f])):f===26?(E=1-L(a,c,h),P=1-L(a,l,d),I=1-L(t,l,d),_=L(t,l,c),w.push(ie[f]),w.push(ve[f])):f===36?(S=L(a,h,c),x=L(t,d,h),v=L(t,l,c),_=L(a,l,c),w.push(ne[f]),w.push(he[f])):f===134?(S=1-L(t,c,h),x=1-L(a,h,d),v=1-L(a,c,l),_=1-L(t,c,l),w.push(ne[f]),w.push(he[f])):f===9?(E=1-L(t,c,h),S=1-L(a,c,h),y=L(a,d,h),P=1-L(t,l,d),w.push(ie[f]),w.push(ne[f])):f===161?(E=L(a,h,c),S=L(t,h,c),y=1-L(t,h,d),P=L(a,d,l),w.push(ie[f]),w.push(ne[f])):f===37?(S=L(a,h,c),P=1-L(t,l,d),v=L(t,l,c),_=L(a,l,c),w.push(ne[f]),w.push(Ce[f])):f===133?(S=1-L(t,c,h),P=L(a,d,l),v=1-L(a,c,l),_=1-L(t,c,l),w.push(ne[f]),w.push(Ce[f])):f===148?(x=L(t,d,h),P=L(t,d,l),I=L(a,d,l),_=1-L(a,c,l),w.push(he[f]),w.push(ve[f])):f===22?(x=1-L(a,h,d),P=1-L(a,l,d),I=1-L(t,l,d),_=L(t,l,c),w.push(he[f]),w.push(ve[f])):f===82?(E=L(t,h,c),x=1-L(t,h,d),y=1-L(a,h,d),I=1-L(a,l,d),w.push(ie[f]),w.push(ue[f])):f===88?(E=1-L(a,c,h),x=L(a,d,h),y=L(t,d,h),I=L(t,d,l),w.push(ie[f]),w.push(ue[f])):f===73?(E=1-L(t,c,h),S=1-L(a,c,h),y=L(a,d,h),v=1-L(t,c,l),w.push(ie[f]),w.push(ne[f])):f===97?(E=L(a,h,c),S=L(t,h,c),y=1-L(t,h,d),v=L(a,l,c),w.push(ie[f]),w.push(ne[f])):f===145?(E=L(t,h,c),y=1-L(t,h,d),P=L(a,d,l),_=1-L(a,c,l),w.push(ie[f]),w.push(Ce[f])):f===25?(E=1-L(a,c,h),y=L(a,d,h),P=1-L(t,l,d),_=L(t,l,c),w.push(ie[f]),w.push(Ce[f])):f===70?(S=1-L(t,c,h),x=1-L(a,h,d),I=1-L(a,l,d),v=1-L(t,c,l),w.push(ne[f]),w.push(he[f])):f===100?(S=L(a,h,c),x=L(t,d,h),I=L(t,d,l),v=L(a,l,c),w.push(ne[f]),w.push(he[f])):f===34?(g===0?(E=1-L(t,c,h),S=1-L(a,c,h),x=L(a,d,h),y=L(t,d,h),P=L(t,d,l),I=L(a,d,l),v=1-L(a,c,l),_=1-L(t,c,l)):(E=L(a,h,c),S=L(t,h,c),x=1-L(t,h,d),y=1-L(a,h,d),P=1-L(a,l,d),I=1-L(t,l,d),v=L(t,l,c),_=L(a,l,c)),w.push(ie[f]),w.push(ne[f]),w.push(Ce[f]),w.push(ve[f])):f===35?(g===4?(E=1-L(t,c,h),S=1-L(a,c,h),x=L(a,d,h),y=L(t,d,h),P=L(t,d,l),I=L(a,d,l),v=1-L(a,c,l),_=1-L(t,c,l)):(E=L(a,h,c),S=L(t,h,c),x=1-L(t,h,d),y=1-L(a,h,d),P=1-L(a,l,d),I=1-L(t,l,d),v=L(t,l,c),_=L(a,l,c)),w.push(ie[f]),w.push(ne[f]),w.push(ue[f]),w.push(ve[f])):f===136?(g===0?(E=L(a,h,c),S=L(t,h,c),x=1-L(t,h,d),y=1-L(a,h,d),P=1-L(a,l,d),I=1-L(t,l,d),v=L(t,l,c),_=L(a,l,c)):(E=1-L(t,c,h),S=1-L(a,c,h),x=L(a,d,h),y=L(t,d,h),P=L(t,d,l),I=L(a,d,l),v=1-L(a,c,l),_=1-L(t,c,l)),w.push(ie[f]),w.push(ne[f]),w.push(Ce[f]),w.push(ve[f])):f===153?(g===0?(E=L(t,h,c),y=1-L(t,h,d),P=1-L(t,l,d),_=L(t,l,c)):(E=1-L(a,c,h),y=L(a,d,h),P=L(a,d,l),_=1-L(a,c,l)),w.push(ie[f]),w.push(ue[f])):f===102?(g===0?(S=1-L(t,c,h),x=L(t,d,h),I=L(t,d,l),v=1-L(t,c,l)):(S=L(a,h,c),x=1-L(a,h,d),I=1-L(a,l,d),v=L(a,l,c)),w.push(ne[f]),w.push(ve[f])):f===155?(g===4?(E=L(t,h,c),y=1-L(t,h,d),P=1-L(t,l,d),_=L(t,l,c)):(E=1-L(a,c,h),y=L(a,d,h),P=L(a,d,l),_=1-L(a,c,l)),w.push(ie[f]),w.push(Ce[f])):f===103?(g===4?(S=1-L(t,c,h),x=L(t,d,h),I=L(t,d,l),v=1-L(t,c,l)):(S=L(a,h,c),x=1-L(a,h,d),I=1-L(a,l,d),v=L(a,l,c)),w.push(ne[f]),w.push(he[f])):f===152?(g===0?(E=L(t,h,c),x=1-L(t,h,d),y=1-L(a,h,d),P=1-L(a,l,d),I=1-L(t,l,d),_=L(t,l,c)):(E=1-L(a,c,h),x=L(a,d,h),y=L(t,d,h),P=L(t,d,l),I=L(a,d,l),_=1-L(a,c,l)),w.push(ie[f]),w.push(he[f]),w.push(ue[f])):f===156?(g===4?(E=L(t,h,c),x=1-L(t,h,d),y=1-L(a,h,d),P=1-L(a,l,d),I=1-L(t,l,d),_=L(t,l,c)):(E=1-L(a,c,h),x=L(a,d,h),y=L(t,d,h),P=L(t,d,l),I=L(a,d,l),_=1-L(a,c,l)),w.push(ie[f]),w.push(ue[f]),w.push(ve[f])):f===137?(g===0?(E=L(a,h,c),S=L(t,h,c),y=1-L(t,h,d),P=1-L(t,l,d),v=L(t,l,c),_=L(a,l,c)):(E=1-L(t,c,h),S=1-L(a,c,h),y=L(a,d,h),P=L(a,d,l),v=1-L(a,c,l),_=1-L(t,c,l)),w.push(ie[f]),w.push(ne[f]),w.push(ue[f])):f===139?(g===4?(E=L(a,h,c),S=L(t,h,c),y=1-L(t,h,d),P=1-L(t,l,d),v=L(t,l,c),_=L(a,l,c)):(E=1-L(t,c,h),S=1-L(a,c,h),y=L(a,d,h),P=L(a,d,l),v=1-L(a,c,l),_=1-L(t,c,l)),w.push(ie[f]),w.push(ne[f]),w.push(Ce[f])):f===98?(g===0?(E=1-L(t,c,h),S=1-L(a,c,h),x=L(a,d,h),y=L(t,d,h),I=L(t,d,l),v=1-L(t,c,l)):(E=L(a,h,c),S=L(t,h,c),x=1-L(t,h,d),y=1-L(a,h,d),I=1-L(a,l,d),v=L(a,l,c)),w.push(ie[f]),w.push(ne[f]),w.push(ve[f])):f===99?(g===4?(E=1-L(t,c,h),S=1-L(a,c,h),x=L(a,d,h),y=L(t,d,h),I=L(t,d,l),v=1-L(t,c,l)):(E=L(a,h,c),S=L(t,h,c),x=1-L(t,h,d),y=1-L(a,h,d),I=1-L(a,l,d),v=L(a,l,c)),w.push(ie[f]),w.push(ne[f]),w.push(ue[f])):f===38?(g===0?(S=1-L(t,c,h),x=L(t,d,h),P=L(t,d,l),I=L(a,d,l),v=1-L(a,c,l),_=1-L(t,c,l)):(S=L(a,h,c),x=1-L(a,h,d),P=1-L(a,l,d),I=1-L(t,l,d),v=L(t,l,c),_=L(a,l,c)),w.push(ne[f]),w.push(Ce[f]),w.push(ve[f])):f===39?(g===4?(S=1-L(t,c,h),x=L(t,d,h),P=L(t,d,l),I=L(a,d,l),v=1-L(a,c,l),_=1-L(t,c,l)):(S=L(a,h,c),x=1-L(a,h,d),P=1-L(a,l,d),I=1-L(t,l,d),v=L(t,l,c),_=L(a,l,c)),w.push(ne[f]),w.push(he[f]),w.push(ve[f])):f===85&&(E=1,S=0,x=1,y=0,P=0,I=1,v=0,_=1),(v<0||v>1||_<0||_>1||E<0||E>1||x<0||x>1||P<0||P>1||I<0||I>1)&&console.log("MarchingSquaresJS-isoBands: "+f+" "+m+" "+l+","+c+","+h+","+d+" "+g+" "+v+" "+_+" "+E+" "+S+" "+x+" "+y+" "+P+" "+I),s.cells[o][u]={cval:f,cval_real:m,flipped:g,topleft:v,topright:_,righttop:E,rightbottom:S,bottomright:x,bottomleft:y,leftbottom:P,lefttop:I,edges:w}}}}}return s}function DR(e){for(var t=[],r=e.rows,n=e.cols,i=[],s=0;s<r;s++)for(var a=0;a<n;a++)if(typeof e.cells[s][a]<"u"&&e.cells[s][a].edges.length>0){var o=e.cells[s][a],u=NR(o),f=null,l=a,c=s;u!==null&&i.push([u.p[0]+l,u.p[1]+c]);do{if(f=FR(e.cells[c][l],u.x,u.y,u.o),f!==null)i.push([f.p[0]+l,f.p[1]+c]),l+=f.x,c+=f.y,u=f;else break;if(c<0||c>=r||l<0||l>=n||typeof e.cells[c][l]>"u"){l-=f.x,c-=f.y;var h=RR(e,l,c,f.x,f.y,f.o);if(h!==null)h.path.forEach(function(d){i.push(d)}),l=h.i,c=h.j,u=h;else break}}while(typeof e.cells[c][l]<"u"&&e.cells[c][l].edges.length>0);t.push(i),i=[],e.cells[s][a].edges.length>0&&a--}return t}function RR(e,t,r,n,i,s){for(var a=e.cells[r][t],o=a.cval_real,u=t+n,f=r+i,l=[],c=!1;!c;){if(typeof e.cells[f]>"u"||typeof e.cells[f][u]>"u")if(f-=i,u-=n,a=e.cells[f][u],o=a.cval_real,i===-1)if(s===0)if(o&qr)l.push([u,f]),n=-1,i=0,s=0;else if(o&Ar)l.push([u+1,f]),n=1,i=0,s=0;else{l.push([u+a.bottomright,f]),n=0,i=1,s=1,c=!0;break}else if(o&qr)l.push([u,f]),n=-1,i=0,s=0;else if(o&Ar){l.push([u+a.bottomright,f]),n=0,i=1,s=1,c=!0;break}else{l.push([u+a.bottomleft,f]),n=0,i=1,s=0,c=!0;break}else if(i===1)if(s===0)if(o&vi)l.push([u+1,f+1]),n=1,i=0,s=1;else if(o&nn){l.push([u+a.topleft,f+1]),n=0,i=-1,s=0,c=!0;break}else{l.push([u+a.topright,f+1]),n=0,i=-1,s=1,c=!0;break}else o&vi?(l.push([u+1,f+1]),n=1,i=0,s=1):(l.push([u+1,f+1]),n=1,i=0,s=1);else if(n===-1)if(s===0)if(o&nn)l.push([u,f+1]),n=0,i=1,s=0;else if(o&qr){l.push([u,f+a.leftbottom]),n=1,i=0,s=0,c=!0;break}else{l.push([u,f+a.lefttop]),n=1,i=0,s=1,c=!0;break}else if(o&nn)l.push([u,f+1]),n=0,i=1,s=0;else{console.log("MarchingSquaresJS-isoBands: wtf");break}else if(n===1)if(s===0)if(o&Ar)l.push([u+1,f]),n=0,i=-1,s=1;else{l.push([u+1,f+a.rightbottom]),n=-1,i=0,s=0,c=!0;break}else if(o&Ar)l.push([u+1,f]),n=0,i=-1,s=1;else if(o&vi){l.push([u+1,f+a.righttop]),n=-1,i=0,s=1;break}else{l.push([u+1,f+a.rightbottom]),n=-1,i=0,s=0,c=!0;break}else{console.log("MarchingSquaresJS-isoBands: we came from nowhere!");break}else if(a=e.cells[f][u],o=a.cval_real,n===-1)if(s===0)if(typeof e.cells[f-1]<"u"&&typeof e.cells[f-1][u]<"u")n=0,i=-1,s=1;else if(o&qr)l.push([u,f]);else{l.push([u+a.bottomright,f]),n=0,i=1,s=1,c=!0;break}else if(o&nn)console.log("MarchingSquaresJS-isoBands: proceeding in x-direction!");else{console.log("MarchingSquaresJS-isoBands: found entry from top at "+u+","+f);break}else if(n===1)if(s===0){console.log("MarchingSquaresJS-isoBands: wtf");break}else if(typeof e.cells[f+1]<"u"&&typeof e.cells[f+1][u]<"u")n=0,i=1,s=0;else if(o&vi)l.push([u+1,f+1]),n=1,i=0,s=1;else{l.push([u+a.topleft,f+1]),n=0,i=-1,s=0,c=!0;break}else if(i===-1)if(s===1)if(typeof e.cells[f][u+1]<"u")n=1,i=0,s=1;else if(o&Ar)l.push([u+1,f]),n=0,i=-1,s=1;else{l.push([u+1,f+a.righttop]),n=-1,i=0,s=1,c=!0;break}else{console.log("MarchingSquaresJS-isoBands: wtf");break}else if(i===1)if(s===0)if(typeof e.cells[f][u-1]<"u")n=-1,i=0,s=0;else if(o&nn)l.push([u,f+1]),n=0,i=1,s=0;else{l.push([u,f+a.leftbottom]),n=1,i=0,s=0,c=!0;break}else{console.log("MarchingSquaresJS-isoBands: wtf");break}else{console.log("MarchingSquaresJS-isoBands: where did we came from???");break}if(u+=n,f+=i,u===t&&f===r)break}return{path:l,i:u,j:f,x:n,y:i,o:s}}function OR(e,t){delete e.edges[t];for(var r=t+1;r<e.edges.length;r++)e.edges[r-1]=e.edges[r];e.edges.pop()}function NR(e){if(e.edges.length>0){var t=e.edges[e.edges.length-1],r=e.cval_real;switch(t){case 0:return r&vi?{p:[1,e.righttop],x:-1,y:0,o:1}:{p:[e.topleft,1],x:0,y:-1,o:0};case 1:return r&Ar?{p:[e.topleft,1],x:0,y:-1,o:0}:{p:[1,e.rightbottom],x:-1,y:0,o:0};case 2:return r&Ar?{p:[e.bottomright,0],x:0,y:1,o:1}:{p:[e.topleft,1],x:0,y:-1,o:0};case 3:return r&qr?{p:[e.topleft,1],x:0,y:-1,o:0}:{p:[e.bottomleft,0],x:0,y:1,o:0};case 4:return r&vi?{p:[1,e.righttop],x:-1,y:0,o:1}:{p:[e.topright,1],x:0,y:-1,o:1};case 5:return r&Ar?{p:[e.topright,1],x:0,y:-1,o:1}:{p:[1,e.rightbottom],x:-1,y:0,o:0};case 6:return r&Ar?{p:[e.bottomright,0],x:0,y:1,o:1}:{p:[e.topright,1],x:0,y:-1,o:1};case 7:return r&qr?{p:[e.topright,1],x:0,y:-1,o:1}:{p:[e.bottomleft,0],x:0,y:1,o:0};case 8:return r&Ar?{p:[e.bottomright,0],x:0,y:1,o:1}:{p:[1,e.righttop],x:-1,y:0,o:1};case 9:return r&qr?{p:[1,e.righttop],x:-1,y:0,o:1}:{p:[e.bottomleft,0],x:0,y:1,o:0};case 10:return r&qr?{p:[0,e.leftbottom],x:1,y:0,o:0}:{p:[1,e.righttop],x:-1,y:0,o:1};case 11:return r&nn?{p:[1,e.righttop],x:-1,y:0,o:1}:{p:[0,e.lefttop],x:1,y:0,o:1};case 12:return r&Ar?{p:[e.bottomright,0],x:0,y:1,o:1}:{p:[1,e.rightbottom],x:-1,y:0,o:0};case 13:return r&qr?{p:[1,e.rightbottom],x:-1,y:0,o:0}:{p:[e.bottomleft,0],x:0,y:1,o:0};case 14:return r&qr?{p:[0,e.leftbottom],x:1,y:0,o:0}:{p:[1,e.rightbottom],x:-1,y:0,o:0};case 15:return r&nn?{p:[1,e.rightbottom],x:-1,y:0,o:0}:{p:[0,e.lefttop],x:1,y:0,o:1};case 16:return r&Ar?{p:[e.bottomright,0],x:0,y:1,o:1}:{p:[0,e.leftbottom],x:1,y:0,o:0};case 17:return r&nn?{p:[e.bottomright,0],x:0,y:1,o:1}:{p:[0,e.lefttop],x:1,y:0,o:1};case 18:return r&qr?{p:[0,e.leftbottom],x:1,y:0,o:0}:{p:[e.bottomleft,0],x:0,y:1,o:0};case 19:return r&nn?{p:[e.bottomleft,0],x:0,y:1,o:0}:{p:[0,e.lefttop],x:1,y:0,o:1};case 20:return r&nn?{p:[e.topleft,1],x:0,y:-1,o:0}:{p:[0,e.leftbottom],x:1,y:0,o:0};case 21:return r&vi?{p:[0,e.leftbottom],x:1,y:0,o:0}:{p:[e.topright,1],x:0,y:-1,o:1};case 22:return r&nn?{p:[e.topleft,1],x:0,y:-1,o:0}:{p:[0,e.lefttop],x:1,y:0,o:1};case 23:return r&vi?{p:[0,e.lefttop],x:1,y:0,o:1}:{p:[e.topright,1],x:0,y:-1,o:1};default:console.log("MarchingSquaresJS-isoBands: edge index out of range!"),console.log(e);break}}return null}function FR(e,t,r,n){var i,s,a,o,u=e.cval,f;switch(t){case-1:switch(n){case 0:i=ne[u],a=Ke[u],o=Qe[u],f=Ze[u];break;default:i=ie[u],a=Ye[u],o=Xe[u],f=je[u];break}break;case 1:switch(n){case 0:i=Ce[u],a=ot[u],o=ut[u],f=ft[u];break;default:i=ve[u],a=it[u],o=st[u],f=at[u];break}break;default:switch(r){case-1:switch(n){case 0:i=lt[u],a=ke[u],o=Ue[u],f=Ge[u];break;default:i=dt[u],a=qe[u],o=He[u],f=We[u];break}break;case 1:switch(n){case 0:i=ue[u],a=Je[u],o=$e[u],f=et[u];break;default:i=he[u],a=tt[u],o=rt[u],f=nt[u];break}break;default:break}break}if(s=e.edges.indexOf(i),typeof e.edges[s]<"u")OR(e,s);else return null;switch(u=e.cval_real,i){case 0:u&vi?(t=e.topleft,r=1):(t=1,r=e.righttop);break;case 1:u&Ar?(t=1,r=e.rightbottom):(t=e.topleft,r=1);break;case 2:u&Ar?(t=e.topleft,r=1):(t=e.bottomright,r=0);break;case 3:u&qr?(t=e.bottomleft,r=0):(t=e.topleft,r=1);break;case 4:u&vi?(t=e.topright,r=1):(t=1,r=e.righttop);break;case 5:u&Ar?(t=1,r=e.rightbottom):(t=e.topright,r=1);break;case 6:u&Ar?(t=e.topright,r=1):(t=e.bottomright,r=0);break;case 7:u&qr?(t=e.bottomleft,r=0):(t=e.topright,r=1);break;case 8:u&Ar?(t=1,r=e.righttop):(t=e.bottomright,r=0);break;case 9:u&qr?(t=e.bottomleft,r=0):(t=1,r=e.righttop);break;case 10:u&qr?(t=1,r=e.righttop):(t=0,r=e.leftbottom);break;case 11:u&nn?(t=0,r=e.lefttop):(t=1,r=e.righttop);break;case 12:u&Ar?(t=1,r=e.rightbottom):(t=e.bottomright,r=0);break;case 13:u&qr?(t=e.bottomleft,r=0):(t=1,r=e.rightbottom);break;case 14:u&qr?(t=1,r=e.rightbottom):(t=0,r=e.leftbottom);break;case 15:u&nn?(t=0,r=e.lefttop):(t=1,r=e.rightbottom);break;case 16:u&Ar?(t=0,r=e.leftbottom):(t=e.bottomright,r=0);break;case 17:u&nn?(t=0,r=e.lefttop):(t=e.bottomright,r=0);break;case 18:u&qr?(t=e.bottomleft,r=0):(t=0,r=e.leftbottom);break;case 19:u&nn?(t=0,r=e.lefttop):(t=e.bottomleft,r=0);break;case 20:u&nn?(t=0,r=e.leftbottom):(t=e.topleft,r=1);break;case 21:u&vi?(t=e.topright,r=1):(t=0,r=e.leftbottom);break;case 22:u&nn?(t=0,r=e.lefttop):(t=e.topleft,r=1);break;case 23:u&vi?(t=e.topright,r=1):(t=0,r=e.lefttop);break;default:return console.log("MarchingSquaresJS-isoBands: edge index out of range!"),console.log(e),null}return(typeof t>"u"||typeof r>"u"||typeof a>"u"||typeof o>"u"||typeof f>"u")&&(console.log("MarchingSquaresJS-isoBands: undefined value!"),console.log(e),console.log(t+" "+r+" "+a+" "+o+" "+f)),{p:[t,r],x:a,y:o,o:f}}function BR(e){var t=[],r=0;return e.cells.forEach(function(n,i){n.forEach(function(s,a){if(typeof s<"u"){var o=te[s.cval](s);typeof o=="object"&&Im(o)?typeof o[0]=="object"&&Im(o[0])?typeof o[0][0]=="object"&&Im(o[0][0])?o.forEach(function(u){u.forEach(function(f){f[0]+=a,f[1]+=i}),t[r++]=u}):(o.forEach(function(u){u[0]+=a,u[1]+=i}),t[r++]=o):console.log("MarchingSquaresJS-isoBands: bandcell polygon with malformed coordinates"):console.log("MarchingSquaresJS-isoBands: bandcell polygon with null coordinates")}})}),t}function VR(e,t,r){if(r=r||{},!fe(r))throw new Error("options is invalid");var n=r.zProperty||"elevation",i=r.commonProperties||{},s=r.breaksProperties||[];if(Qi(e,"Point","Input must contain Points"),!t)throw new Error("breaks is required");if(!Array.isArray(t))throw new Error("breaks is not an Array");if(!fe(i))throw new Error("commonProperties is not an Object");if(!Array.isArray(s))throw new Error("breaksProperties is not an Array");var a=QD(e,{zProperty:n,flip:!0}),o=zR(a,t,n);o=kR(o,a,e);var u=o.map(function(f,l){if(s[l]&&!fe(s[l]))throw new Error("Each mappedProperty is required to be an Object");var c=Object.assign({},i,s[l]);c[n]=f[n];var h=Eu(f.groupedRings,c);return h});return ge(u)}function zR(e,t,r){for(var n=[],i=1;i<t.length;i++){var s=+t[i-1],a=+t[i],o=JD(e,s,a-s),u=UR(o),f=GR(u),l={};l.groupedRings=f,l[r]=s+"-"+a,n.push(l)}return n}function kR(e,t,r){var n=ur(r),i=n[2]-n[0],s=n[3]-n[1],a=n[0],o=n[1],u=t[0].length-1,f=t.length-1,l=i/u,c=s/f,h=function(d){d[0]=d[0]*l+a,d[1]=d[1]*c+o};return e.forEach(function(d){d.groupedRings.forEach(function(m){m.forEach(function(g){g.forEach(h)})})}),e}function UR(e){var t=[],r=[];e.forEach(function(i){var s=Mf(ze([i]));r.push(s),t.push({ring:i,area:s})}),r.sort(function(i,s){return s-i});var n=[];return r.forEach(function(i){for(var s=0;s<t.length;s++)if(t[s].area===i){n.push(t[s].ring),t.splice(s,1);break}}),n}function GR(e){for(var t=e.map(function(u){return{lrCoordinates:u,grouped:!1}}),r=[];!HR(t);)for(var n=0;n<t.length;n++)if(!t[n].grouped){var i=[];i.push(t[n].lrCoordinates),t[n].grouped=!0;for(var s=ze([t[n].lrCoordinates]),a=n+1;a<t.length;a++)if(!t[a].grouped){var o=ze([t[a].lrCoordinates]);qR(o,s)&&(i.push(t[a].lrCoordinates),t[a].grouped=!0)}r.push(i)}return r}function qR(e,t){for(var r=lp(e),n=0;n<r.features.length;n++)if(!Ut(r.features[n],t))return!1;return!0}function HR(e){for(var t=0;t<e.length;t++)if(e[t].grouped===!1)return!1;return!0}function x0(e,t,r){if(r=r||{},!fe(r))throw new Error("options is invalid");var n=r.pivot,i=r.mutate;if(!e)throw new Error("geojson is required");if(t==null||isNaN(t))throw new Error("angle is required");return t===0||(n||(n=ro(e)),(i===!1||i===void 0)&&(e=Kr(e)),mr(e,function(s){var a=_a(n,s),o=a+t,u=Wc(n,s),f=le(eu(n,u,o));s[0]=f[0],s[1]=f[1]})),e}function E0(e,t,r){if(r=r||{},!fe(r))throw new Error("options is invalid");var n=r.origin,i=r.mutate;if(!e)throw new Error("geojson required");if(typeof t!="number"||t===0)throw new Error("invalid factor");var s=Array.isArray(n)||typeof n=="object";return i!==!0&&(e=Kr(e)),e.type==="FeatureCollection"&&!s?(wt(e,function(a,o){e.features[o]=GC(a,t,n)}),e):GC(e,t,n)}function GC(e,t,r){var n=Mt(e)==="Point";return r=WR(e,r),t===1||n||mr(e,function(i){var s=Wc(r,i),a=_a(r,i),o=s*t,u=le(eu(r,o,a));i[0]=u[0],i[1]=u[1],i.length===3&&(i[2]*=t)}),e}function WR(e,t){if(t==null&&(t="centroid"),Array.isArray(t)||typeof t=="object")return Vt(t);var r=e.bbox?e.bbox:ur(e),n=r[0],i=r[1],s=r[2],a=r[3];switch(t){case"sw":case"southwest":case"westsouth":case"bottomleft":return gt([n,i]);case"se":case"southeast":case"eastsouth":case"bottomright":return gt([s,i]);case"nw":case"northwest":case"westnorth":case"topleft":return gt([n,a]);case"ne":case"northeast":case"eastnorth":case"topright":return gt([s,a]);case"center":return qc(e);case void 0:case null:case"centroid":return ro(e);default:throw new Error("invalid origin")}}function YR(e,t,r,n){if(n=n||{},!fe(n))throw new Error("options is invalid");var i=n.units,s=n.zTranslation,a=n.mutate;if(!e)throw new Error("geojson is required");if(t==null||isNaN(t))throw new Error("distance is required");if(s&&typeof s!="number"&&isNaN(s))throw new Error("zTranslation is not a number");if(s=s!==void 0?s:0,t===0&&s===0)return e;if(r==null||isNaN(r))throw new Error("direction is required");return t<0&&(t=-t,r=-r),(a===!1||a===void 0)&&(e=Kr(e)),mr(e,function(o){var u=le(eu(o,t,r,{units:i}));o[0]=u[0],o[1]=u[1],s&&o.length===3&&(o[2]+=s)}),e}function wc(e){var t=e[0],r=e[1];return[r[0]-t[0],r[1]-t[1]]}function qm(e,t){return e[0]*t[1]-t[0]*e[1]}function XR(e,t){return[e[0]+t[0],e[1]+t[1]]}function jR(e,t){return[e[0]-t[0],e[1]-t[1]]}function KR(e,t){return[e*t[0],e*t[1]]}function QR(e,t){var r=e[0],n=wc(e),i=t[0],s=wc(t),a=qm(n,s),o=jR(i,r),u=qm(o,s),f=u/a,l=XR(r,KR(f,n));return l}function ZR(e,t){var r=wc(e),n=wc(t);return qm(r,n)===0}function JR(e,t){return ZR(e,t)?!1:QR(e,t)}function $R(e,t,r){if(r=r||{},!fe(r))throw new Error("options is invalid");var n=r.units;if(!e)throw new Error("geojson is required");if(t==null||isNaN(t))throw new Error("distance is required");var i=Mt(e),s=e.properties;switch(i){case"LineString":return qC(e,t,n);case"MultiLineString":var a=[];return Jt(e,function(o){a.push(qC(o,t,n).geometry.coordinates)}),Ra(a,s);default:throw new Error("geometry "+i+" is not supported")}}function qC(e,t,r){var n=[],i=_c(t,r),s=le(e),a=[];return s.forEach(function(o,u){if(u!==s.length-1){var f=eO(o,s[u+1],i);if(n.push(f),u>0){var l=n[u-1],c=JR(f,l);c!==!1&&(l[1]=c,f[0]=c),a.push(l[0]),u===s.length-2&&(a.push(f[0]),a.push(f[1]))}s.length===2&&(a.push(f[0]),a.push(f[1]))}}),Pt(a,e.properties)}function eO(e,t,r){var n=Math.sqrt((e[0]-t[0])*(e[0]-t[0])+(e[1]-t[1])*(e[1]-t[1])),i=e[0]+r*(t[1]-e[1])/n,s=t[0]+r*(t[1]-e[1])/n,a=e[1]+r*(e[0]-t[0])/n,o=t[1]+r*(e[0]-t[0])/n;return[[i,a],[s,o]]}function xp(e,t,r){var n=t[0]-e[0],i=t[1]-e[1],s=r[0]-t[0],a=r[1]-t[1];return Math.sign(n*a-s*i)}function tO(e,t){var r=e.geometry.coordinates.map(function(a){return a[0]}),n=e.geometry.coordinates.map(function(a){return a[1]}),i=t.geometry.coordinates.map(function(a){return a[0]}),s=t.geometry.coordinates.map(function(a){return a[1]});return Math.max(null,r)===Math.max(null,i)&&Math.max(null,n)===Math.max(null,s)&&Math.min(null,r)===Math.min(null,i)&&Math.min(null,n)===Math.min(null,s)}function HC(e,t){return t.geometry.coordinates[0].every(function(r){return Ut(gt(r),e)})}function rO(e,t){return e[0]===t[0]&&e[1]===t[1]}var hs=function e(t){this.id=e.buildId(t),this.coordinates=t,this.innerEdges=[],this.outerEdges=[],this.outerEdgesSorted=!1};hs.buildId=function(t){return t.join(",")};hs.prototype.removeInnerEdge=function(t){this.innerEdges=this.innerEdges.filter(function(r){return r.from.id!==t.from.id})};hs.prototype.removeOuterEdge=function(t){this.outerEdges=this.outerEdges.filter(function(r){return r.to.id!==t.to.id})};hs.prototype.addOuterEdge=function(t){this.outerEdges.push(t),this.outerEdgesSorted=!1};hs.prototype.sortOuterEdges=function(){var t=this;this.outerEdgesSorted||(this.outerEdges.sort(function(r,n){var i=r.to,s=n.to;if(i.coordinates[0]-t.coordinates[0]>=0&&s.coordinates[0]-t.coordinates[0]<0)return 1;if(i.coordinates[0]-t.coordinates[0]<0&&s.coordinates[0]-t.coordinates[0]>=0)return-1;if(i.coordinates[0]-t.coordinates[0]===0&&s.coordinates[0]-t.coordinates[0]===0)return i.coordinates[1]-t.coordinates[1]>=0||s.coordinates[1]-t.coordinates[1]>=0?i.coordinates[1]-s.coordinates[1]:s.coordinates[1]-i.coordinates[1];var a=xp(t.coordinates,i.coordinates,s.coordinates);if(a<0)return 1;if(a>0)return-1;var o=Math.pow(i.coordinates[0]-t.coordinates[0],2)+Math.pow(i.coordinates[1]-t.coordinates[1],2),u=Math.pow(s.coordinates[0]-t.coordinates[0],2)+Math.pow(s.coordinates[1]-t.coordinates[1],2);return o-u}),this.outerEdgesSorted=!0)};hs.prototype.getOuterEdges=function(){return this.sortOuterEdges(),this.outerEdges};hs.prototype.getOuterEdge=function(t){return this.sortOuterEdges(),this.outerEdges[t]};hs.prototype.addInnerEdge=function(t){this.innerEdges.push(t)};var ba=function(t,r){this.from=t,this.to=r,this.next=void 0,this.label=void 0,this.symetric=void 0,this.ring=void 0,this.from.addOuterEdge(this),this.to.addInnerEdge(this)};ba.prototype.getSymetric=function(){return this.symetric||(this.symetric=new ba(this.to,this.from),this.symetric.symetric=this),this.symetric};ba.prototype.deleteEdge=function(){this.from.removeOuterEdge(this),this.to.removeInnerEdge(this)};ba.prototype.isEqual=function(t){return this.from.id===t.from.id&&this.to.id===t.to.id};ba.prototype.toString=function(){return"Edge { "+this.from.id+" -> "+this.to.id+" }"};ba.prototype.toLineString=function(){return Pt([this.from.coordinates,this.to.coordinates])};ba.prototype.compareTo=function(t){return xp(t.from.coordinates,t.to.coordinates,this.to.coordinates)};var Dn=function(){this.edges=[],this.polygon=void 0,this.envelope=void 0},b0={length:{configurable:!0}};Dn.prototype.push=function(t){this[this.edges.length]=t,this.edges.push(t),this.polygon=this.envelope=void 0};Dn.prototype.get=function(t){return this.edges[t]};b0.length.get=function(){return this.edges.length};Dn.prototype.forEach=function(t){this.edges.forEach(t)};Dn.prototype.map=function(t){return this.edges.map(t)};Dn.prototype.some=function(t){return this.edges.some(t)};Dn.prototype.isValid=function(){return!0};Dn.prototype.isHole=function(){var t=this,r=this.edges.reduce(function(a,o,u){return o.from.coordinates[1]>t.edges[a].from.coordinates[1]&&(a=u),a},0),n=(r===0?this.length:r)-1,i=(r+1)%this.length,s=xp(this.edges[n].from.coordinates,this.edges[r].from.coordinates,this.edges[i].from.coordinates);return s===0?this.edges[n].from.coordinates[0]>this.edges[i].from.coordinates[0]:s>0};Dn.prototype.toMultiPoint=function(){return Vc(this.edges.map(function(t){return t.from.coordinates}))};Dn.prototype.toPolygon=function(){if(this.polygon)return this.polygon;var t=this.edges.map(function(r){return r.from.coordinates});return t.push(this.edges[0].from.coordinates),this.polygon=ze([t])};Dn.prototype.getEnvelope=function(){return this.envelope?this.envelope:this.envelope=e0(this.toPolygon())};Dn.findEdgeRingContaining=function(t,r){var n=t.getEnvelope(),i,s;return r.forEach(function(a){var o=a.getEnvelope();if(s&&(i=s.getEnvelope()),!tO(o,n)&&HC(o,n)){var u=t.map(function(f){return f.from.coordinates}).find(function(f){return!a.some(function(l){return rO(f,l.from.coordinates)})});u&&a.inside(gt(u))&&(!s||HC(i,o))&&(s=a)}}),s};Dn.prototype.inside=function(t){return Ut(t,this.toPolygon())};Object.defineProperties(Dn.prototype,b0);function nO(e){if(!e)throw new Error("No geojson passed");if(e.type!=="FeatureCollection"&&e.type!=="GeometryCollection"&&e.type!=="MultiLineString"&&e.type!=="LineString"&&e.type!=="Feature")throw new Error("Invalid input type '"+e.type+"'. Geojson must be FeatureCollection, GeometryCollection, LineString, MultiLineString or Feature")}var pn=function(){this.edges=[],this.nodes={}};pn.fromGeoJson=function(t){nO(t);var r=new pn;return Jt(t,function(n){wf(n,"LineString","Graph::fromGeoJson"),kc(n,function(i,s){if(i){var a=r.getNode(i),o=r.getNode(s);r.addEdge(a,o)}return s})}),r};pn.prototype.getNode=function(t){var r=hs.buildId(t),n=this.nodes[r];return n||(n=this.nodes[r]=new hs(t)),n};pn.prototype.addEdge=function(t,r){var n=new ba(t,r),i=n.getSymetric();this.edges.push(n),this.edges.push(i)};pn.prototype.deleteDangles=function(){var t=this;Object.keys(this.nodes).map(function(r){return t.nodes[r]}).forEach(function(r){return t._removeIfDangle(r)})};pn.prototype._removeIfDangle=function(t){var r=this;if(t.innerEdges.length<=1){var n=t.getOuterEdges().map(function(i){return i.to});this.removeNode(t),n.forEach(function(i){return r._removeIfDangle(i)})}};pn.prototype.deleteCutEdges=function(){var t=this;this._computeNextCWEdges(),this._findLabeledEdgeRings(),this.edges.forEach(function(r){r.label===r.symetric.label&&(t.removeEdge(r.symetric),t.removeEdge(r))})};pn.prototype._computeNextCWEdges=function(t){var r=this;typeof t>"u"?Object.keys(this.nodes).forEach(function(n){return r._computeNextCWEdges(r.nodes[n])}):t.getOuterEdges().forEach(function(n,i){t.getOuterEdge((i===0?t.getOuterEdges().length:i)-1).symetric.next=n})};pn.prototype._computeNextCCWEdges=function(t,r){for(var n=t.getOuterEdges(),i,s,a=n.length-1;a>=0;--a){var o=n[a],u=o.symetric,f=void 0,l=void 0;o.label===r&&(f=o),u.label===r&&(l=u),!(!f||!l)&&(l&&(s=l),f&&(s&&(s.next=f,s=void 0),i||(i=f)))}s&&(s.next=i)};pn.prototype._findLabeledEdgeRings=function(){var t=[],r=0;return this.edges.forEach(function(n){if(!(n.label>=0)){t.push(n);var i=n;do i.label=r,i=i.next;while(!n.isEqual(i));r++}}),t};pn.prototype.getEdgeRings=function(){var t=this;this._computeNextCWEdges(),this.edges.forEach(function(n){n.label=void 0}),this._findLabeledEdgeRings().forEach(function(n){t._findIntersectionNodes(n).forEach(function(i){t._computeNextCCWEdges(i,n.label)})});var r=[];return this.edges.forEach(function(n){n.ring||r.push(t._findEdgeRing(n))}),r};pn.prototype._findIntersectionNodes=function(t){var r=[],n=t,i=function(){var s=0;n.from.getOuterEdges().forEach(function(a){a.label===t.label&&++s}),s>1&&r.push(n.from),n=n.next};do i();while(!t.isEqual(n));return r};pn.prototype._findEdgeRing=function(t){var r=t,n=new Dn;do n.push(r),r.ring=n,r=r.next;while(!t.isEqual(r));return n};pn.prototype.removeNode=function(t){var r=this;t.getOuterEdges().forEach(function(n){return r.removeEdge(n)}),t.innerEdges.forEach(function(n){return r.removeEdge(n)}),delete this.nodes[t.id]};pn.prototype.removeEdge=function(t){this.edges=this.edges.filter(function(r){return!r.isEqual(t)}),t.deleteEdge()};function iO(e){var t=pn.fromGeoJson(e);t.deleteDangles(),t.deleteCutEdges();var r=[],n=[];return t.getEdgeRings().filter(function(i){return i.isValid()}).forEach(function(i){i.isHole()?r.push(i):n.push(i)}),r.forEach(function(i){Dn.findEdgeRingContaining(i,n)&&n.push(i)}),ge(n.map(function(i){return i.toPolygon()}))}function w0(e,t){var r;return Jt(e,function(n){Jt(t,function(i){if(r===!1)return!1;r=sO(n.geometry,i.geometry)})}),r}function sO(e,t){switch(e.type){case"Point":switch(t.type){case"Point":return!fO(e.coordinates,t.coordinates);case"LineString":return!WC(t,e);case"Polygon":return!Ut(e,t)}break;case"LineString":switch(t.type){case"Point":return!WC(e,t);case"LineString":return!aO(e,t);case"Polygon":return!YC(t,e)}break;case"Polygon":switch(t.type){case"Point":return!Ut(t,e);case"LineString":return!YC(e,t);case"Polygon":return!oO(t,e)}}}function WC(e,t){for(var r=0;r<e.coordinates.length-1;r++)if(uO(e.coordinates[r],e.coordinates[r+1],t.coordinates))return!0;return!1}function aO(e,t){var r=Zs(e,t);return r.features.length>0}function YC(e,t){var r=Zs(t,xc(e));return r.features.length>0}function oO(e,t){for(var r=0;r<e.coordinates[0].length;r++)if(Ut(e.coordinates[0][r],t))return!0;for(var n=0;n<t.coordinates[0].length;n++)if(Ut(t.coordinates[0][n],e))return!0;return!1}function uO(e,t,r){var n=r[0]-e[0],i=r[1]-e[1],s=t[0]-e[0],a=t[1]-e[1],o=n*a-i*s;return o!==0?!1:Math.abs(s)>=Math.abs(a)?s>0?e[0]<=r[0]&&r[0]<=t[0]:t[0]<=r[0]&&r[0]<=e[0]:a>0?e[1]<=r[1]&&r[1]<=t[1]:t[1]<=r[1]&&r[1]<=e[1]}function fO(e,t){return e[0]===t[0]&&e[1]===t[1]}function lO(e,t){var r=Mt(e),n=Mt(t),i=Tn(e),s=Tn(t),a=le(e),o=le(t);switch(r){case"Point":switch(n){case"Point":return Ep(a,o);default:throw new Error("feature2 "+n+" geometry not supported")}case"MultiPoint":switch(n){case"Point":return cO(i,s);case"MultiPoint":return hO(i,s);default:throw new Error("feature2 "+n+" geometry not supported")}case"LineString":switch(n){case"Point":return Fn(s,i,{ignoreEndVertices:!0});case"LineString":return pO(i,s);case"MultiPoint":return dO(i,s);default:throw new Error("feature2 "+n+" geometry not supported")}case"Polygon":switch(n){case"Point":return Ut(s,i,{ignoreBoundary:!0});case"LineString":return gO(i,s);case"Polygon":return vO(i,s);case"MultiPoint":return mO(i,s);default:throw new Error("feature2 "+n+" geometry not supported")}default:throw new Error("feature1 "+r+" geometry not supported")}}function cO(e,t){var r,n=!1;for(r=0;r<e.coordinates.length;r++)if(Ep(e.coordinates[r],t.coordinates)){n=!0;break}return n}function hO(e,t){for(var r=0;r<t.coordinates.length;r++){for(var n=!1,i=0;i<e.coordinates.length;i++)if(Ep(t.coordinates[r],e.coordinates[i])){n=!0;break}if(!n)return!1}return!0}function dO(e,t){for(var r=!1,n=0;n<t.coordinates.length;n++)if(Fn(t.coordinates[n],e,{ignoreEndVertices:!0})&&(r=!0),!Fn(t.coordinates[n],e))return!1;return!!r}function mO(e,t){for(var r=0;r<t.coordinates.length;r++)if(!Ut(t.coordinates[r],e,{ignoreBoundary:!0}))return!1;return!0}function pO(e,t){for(var r=!1,n=0;n<t.coordinates.length;n++)if(Fn({type:"Point",coordinates:t.coordinates[n]},e,{ignoreEndVertices:!0})&&(r=!0),!Fn({type:"Point",coordinates:t.coordinates[n]},e,{ignoreEndVertices:!1}))return!1;return r}function gO(e,t){var r=!1,n=0,i=ur(e),s=ur(t);if(!S0(i,s))return!1;for(n;n<t.coordinates.length-1;n++){var a=_O(t.coordinates[n],t.coordinates[n+1]);if(Ut({type:"Point",coordinates:a},e,{ignoreBoundary:!0})){r=!0;break}}return r}function vO(e,t){var r=ur(e),n=ur(t);if(!S0(r,n))return!1;for(var i=0;i<t.coordinates[0].length;i++)if(!Ut(t.coordinates[0][i],e))return!1;return!0}function S0(e,t){return!(e[0]>t[0]||e[2]<t[2]||e[1]>t[1]||e[3]<t[3])}function Ep(e,t){return e[0]===t[0]&&e[1]===t[1]}function _O(e,t){return[(e[0]+t[0])/2,(e[1]+t[1])/2]}function CO(e,t){var r=Mt(e),n=Mt(t),i=Tn(e),s=Tn(t);switch(r){case"MultiPoint":switch(n){case"LineString":return XC(i,s);case"Polygon":return KC(i,s);default:throw new Error("feature2 "+n+" geometry not supported")}case"LineString":switch(n){case"MultiPoint":return XC(s,i);case"LineString":return yO(i,s);case"Polygon":return jC(i,s);default:throw new Error("feature2 "+n+" geometry not supported")}case"Polygon":switch(n){case"MultiPoint":return KC(s,i);case"LineString":return jC(s,i);default:throw new Error("feature2 "+n+" geometry not supported")}default:throw new Error("feature1 "+r+" geometry not supported")}}function XC(e,t){for(var r=!1,n=!1,i=e.coordinates.length,s=0;s<i&&!r&&!n;){for(var a=0;a<t.coordinates.length-1;a++){var o=!0;(a===0||a===t.coordinates.length-2)&&(o=!1),T0(t.coordinates[a],t.coordinates[a+1],e.coordinates[s],o)?r=!0:n=!0}s++}return r&&n}function yO(e,t){var r=Zs(e,t);if(r.features.length>0)for(var n=0;n<e.coordinates.length-1;n++)for(var i=0;i<t.coordinates.length-1;i++){var s=!0;if((i===0||i===t.coordinates.length-2)&&(s=!1),T0(e.coordinates[n],e.coordinates[n+1],t.coordinates[i],s))return!0}return!1}function jC(e,t){var r=Zs(e,xc(t));return r.features.length>0}function KC(e,t){for(var r=!1,n=!1,i=e.coordinates[0].length,s=0;s<i&&r&&n;)Ut(gt(e.coordinates[0][s]),t)?r=!0:n=!0,s++;return n&&n}function T0(e,t,r,n){var i=r[0]-e[0],s=r[1]-e[1],a=t[0]-e[0],o=t[1]-e[1],u=i*o-s*a;return u!==0?!1:n?Math.abs(a)>=Math.abs(o)?a>0?e[0]<=r[0]&&r[0]<=t[0]:t[0]<=r[0]&&r[0]<=e[0]:o>0?e[1]<=r[1]&&r[1]<=t[1]:t[1]<=r[1]&&r[1]<=e[1]:Math.abs(a)>=Math.abs(o)?a>0?e[0]<r[0]&&r[0]<t[0]:t[0]<r[0]&&r[0]<e[0]:o>0?e[1]<r[1]&&r[1]<t[1]:t[1]<r[1]&&r[1]<e[1]}var Hm=Qs(function(e,t){t=e.exports=typeof Object.keys=="function"?Object.keys:r,t.shim=r;function r(n){var i=[];for(var s in n)i.push(s);return i}}),J2=Hm.shim,Sc=Qs(function(e,t){var r=function(){return Object.prototype.toString.call(arguments)}()=="[object Arguments]";t=e.exports=r?n:i,t.supported=n;function n(s){return Object.prototype.toString.call(s)=="[object Arguments]"}t.unsupported=i;function i(s){return s&&typeof s=="object"&&typeof s.length=="number"&&Object.prototype.hasOwnProperty.call(s,"callee")&&!Object.prototype.propertyIsEnumerable.call(s,"callee")||!1}}),$2=Sc.supported,eV=Sc.unsupported,xO=Qs(function(e){var t=Array.prototype.slice,r=e.exports=function(a,o,u){return u||(u={}),a===o?!0:a instanceof Date&&o instanceof Date?a.getTime()===o.getTime():!a||!o||typeof a!="object"&&typeof o!="object"?u.strict?a===o:a==o:s(a,o,u)};function n(a){return a==null}function i(a){return!(!a||typeof a!="object"||typeof a.length!="number"||typeof a.copy!="function"||typeof a.slice!="function"||a.length>0&&typeof a[0]!="number")}function s(a,o,u){var f,l;if(n(a)||n(o)||a.prototype!==o.prototype)return!1;if(Sc(a))return Sc(o)?(a=t.call(a),o=t.call(o),r(a,o,u)):!1;if(i(a)){if(!i(o)||a.length!==o.length)return!1;for(f=0;f<a.length;f++)if(a[f]!==o[f])return!1;return!0}try{var c=Hm(a),h=Hm(o)}catch{return!1}if(c.length!=h.length)return!1;for(c.sort(),h.sort(),f=c.length-1;f>=0;f--)if(c[f]!=h[f])return!1;for(f=c.length-1;f>=0;f--)if(l=c[f],!r(a[l],o[l],u))return!1;return typeof a==typeof o}}),Cs=function(e){this.precision=e&&e.precision?e.precision:17,this.direction=e&&e.direction?e.direction:!1,this.pseudoNode=e&&e.pseudoNode?e.pseudoNode:!1,this.objectComparator=e&&e.objectComparator?e.objectComparator:EO};Cs.prototype.compare=function(e,t){if(e.type!==t.type||!I0(e,t))return!1;switch(e.type){case"Point":return this.compareCoord(e.coordinates,t.coordinates);case"LineString":return this.compareLine(e.coordinates,t.coordinates,0,!1);case"Polygon":return this.comparePolygon(e,t);case"Feature":return this.compareFeature(e,t);default:if(e.type.indexOf("Multi")===0){var r=this,n=QC(e),i=QC(t);return n.every(function(s){return this.some(function(a){return r.compare(s,a)})},i)}}return!1};function QC(e){return e.coordinates.map(function(t){return{type:e.type.replace("Multi",""),coordinates:t}})}function I0(e,t){return e.hasOwnProperty("coordinates")?e.coordinates.length===t.coordinates.length:e.length===t.length}Cs.prototype.compareCoord=function(e,t){if(e.length!==t.length)return!1;for(var r=0;r<e.length;r++)if(e[r].toFixed(this.precision)!==t[r].toFixed(this.precision))return!1;return!0};Cs.prototype.compareLine=function(e,t,r,n){if(!I0(e,t))return!1;var i=this.pseudoNode?e:this.removePseudo(e),s=this.pseudoNode?t:this.removePseudo(t);if(!(n&&!this.compareCoord(i[0],s[0])&&(s=this.fixStartIndex(s,i),!s))){var a=this.compareCoord(i[r],s[r]);return this.direction||a?this.comparePath(i,s):this.compareCoord(i[r],s[s.length-(1+r)])?this.comparePath(i.slice().reverse(),s):!1}};Cs.prototype.fixStartIndex=function(e,t){for(var r,n=-1,i=0;i<e.length;i++)if(this.compareCoord(e[i],t[0])){n=i;break}return n>=0&&(r=[].concat(e.slice(n,e.length),e.slice(1,n+1))),r};Cs.prototype.comparePath=function(e,t){var r=this;return e.every(function(n,i){return r.compareCoord(n,this[i])},t)};Cs.prototype.comparePolygon=function(e,t){if(this.compareLine(e.coordinates[0],t.coordinates[0],1,!0)){var r=e.coordinates.slice(1,e.coordinates.length),n=t.coordinates.slice(1,t.coordinates.length),i=this;return r.every(function(s){return this.some(function(a){return i.compareLine(s,a,1,!0)})},n)}else return!1};Cs.prototype.compareFeature=function(e,t){return e.id!==t.id||!this.objectComparator(e.properties,t.properties)||!this.compareBBox(e,t)?!1:this.compare(e.geometry,t.geometry)};Cs.prototype.compareBBox=function(e,t){return!!(!e.bbox&&!t.bbox||e.bbox&&t.bbox&&this.compareCoord(e.bbox,t.bbox))};Cs.prototype.removePseudo=function(e){return e};function EO(e,t){return xO(e,t,{strict:!0})}var L0=Cs;function P0(e,t){if(!e)throw new Error("feature1 is required");if(!t)throw new Error("feature2 is required");var r=Mt(e),n=Mt(t);if(r!==n)throw new Error("features must be of the same type");if(r==="Point")throw new Error("Point geometry not supported");var i=new L0({precision:6});if(i.compare(e,t))return!1;var s=0;switch(r){case"MultiPoint":var a=ls(e),o=ls(t);a.forEach(function(u){o.forEach(function(f){u[0]===f[0]&&u[1]===f[1]&&s++})});break;case"LineString":case"MultiLineString":Ns(e,function(u){Ns(t,function(f){y0(u,f).features.length&&s++})});break;case"Polygon":case"MultiPolygon":Ns(e,function(u){Ns(t,function(f){Zs(u,f).features.length&&s++})});break}return s>0}function bO(e,t){if(!e)throw new Error("feature1 is required");if(!t)throw new Error("feature2 is required");var r=Mt(e),n=Mt(t);if(r!==n)return!1;var i=new L0({precision:6});return i.compare(ks(e),ks(t))}var wO=Qs(function(e){function t(r,n,i,s){this.dataset=[],this.epsilon=1,this.minPts=2,this.distance=this._euclideanDistance,this.clusters=[],this.noise=[],this._visited=[],this._assigned=[],this._datasetLength=0,this._init(r,n,i,s)}t.prototype.run=function(r,n,i,s){this._init(r,n,i,s);for(var a=0;a<this._datasetLength;a++)if(this._visited[a]!==1){this._visited[a]=1;var o=this._regionQuery(a);if(o.length<this.minPts)this.noise.push(a);else{var u=this.clusters.length;this.clusters.push([]),this._addToCluster(a,u),this._expandCluster(u,o)}}return this.clusters},t.prototype._init=function(r,n,i,s){if(r){if(!(r instanceof Array))throw Error("Dataset must be of type array, "+typeof r+" given");this.dataset=r,this.clusters=[],this.noise=[],this._datasetLength=r.length,this._visited=new Array(this._datasetLength),this._assigned=new Array(this._datasetLength)}n&&(this.epsilon=n),i&&(this.minPts=i),s&&(this.distance=s)},t.prototype._expandCluster=function(r,n){for(var i=0;i<n.length;i++){var s=n[i];if(this._visited[s]!==1){this._visited[s]=1;var a=this._regionQuery(s);a.length>=this.minPts&&(n=this._mergeArrays(n,a))}this._assigned[s]!==1&&this._addToCluster(s,r)}},t.prototype._addToCluster=function(r,n){this.clusters[n].push(r),this._assigned[r]=1},t.prototype._regionQuery=function(r){for(var n=[],i=0;i<this._datasetLength;i++){var s=this.distance(this.dataset[r],this.dataset[i]);s<this.epsilon&&n.push(i)}return n},t.prototype._mergeArrays=function(r,n){for(var i=n.length,s=0;s<i;s++){var a=n[s];r.indexOf(a)<0&&r.push(a)}return r},t.prototype._euclideanDistance=function(r,n){for(var i=0,s=Math.min(r.length,n.length);s--;)i+=(r[s]-n[s])*(r[s]-n[s]);return Math.sqrt(i)},e.exports&&(e.exports=t)}),SO=Qs(function(e){function t(r,n,i){this.k=3,this.dataset=[],this.assignments=[],this.centroids=[],this.init(r,n,i)}t.prototype.init=function(r,n,i){this.assignments=[],this.centroids=[],typeof r<"u"&&(this.dataset=r),typeof n<"u"&&(this.k=n),typeof i<"u"&&(this.distance=i)},t.prototype.run=function(r,n){this.init(r,n);for(var i=this.dataset.length,s=0;s<this.k;s++)this.centroids[s]=this.randomCentroid();for(var a=!0;a;){a=this.assign();for(var o=0;o<this.k;o++){for(var u=new Array(h),f=0,l=0;l<h;l++)u[l]=0;for(var c=0;c<i;c++){var h=this.dataset[c].length;if(o===this.assignments[c]){for(var l=0;l<h;l++)u[l]+=this.dataset[c][l];f++}}if(f>0){for(var l=0;l<h;l++)u[l]/=f;this.centroids[o]=u}else this.centroids[o]=this.randomCentroid(),a=!0}}return this.getClusters()},t.prototype.randomCentroid=function(){var r=this.dataset.length-1,n,i;do i=Math.round(Math.random()*r),n=this.dataset[i];while(this.centroids.indexOf(n)>=0);return n},t.prototype.assign=function(){for(var r=!1,n=this.dataset.length,i,s=0;s<n;s++)i=this.argmin(this.dataset[s],this.centroids,this.distance),i!=this.assignments[s]&&(this.assignments[s]=i,r=!0);return r},t.prototype.getClusters=function(){for(var r=new Array(this.k),n,i=0;i<this.assignments.length;i++)n=this.assignments[i],typeof r[n]>"u"&&(r[n]=[]),r[n].push(i);return r},t.prototype.argmin=function(r,n,i){for(var s=Number.MAX_VALUE,a=0,o=n.length,u,f=0;f<o;f++)u=i(r,n[f]),u<s&&(s=u,a=f);return a},t.prototype.distance=function(r,n){for(var i=0,s=Math.min(r.length,n.length);s--;){var a=r[s]-n[s];i+=a*a}return Math.sqrt(i)},e.exports&&(e.exports=t)}),M0=Qs(function(e){function t(r,n,i){this._queue=[],this._priorities=[],this._sorting="desc",this._init(r,n,i)}t.prototype.insert=function(r,n){for(var i=this._queue.length,s=i;s--;){var a=this._priorities[s];this._sorting==="desc"?n>a&&(i=s):n<a&&(i=s)}this._insertAt(r,n,i)},t.prototype.remove=function(r){for(var n=this._queue.length;n--;){var i=this._queue[n];if(r===i){this._queue.splice(n,1),this._priorities.splice(n,1);break}}},t.prototype.forEach=function(r){this._queue.forEach(r)},t.prototype.getElements=function(){return this._queue},t.prototype.getElementPriority=function(r){return this._priorities[r]},t.prototype.getPriorities=function(){return this._priorities},t.prototype.getElementsWithPriorities=function(){for(var r=[],n=0,i=this._queue.length;n<i;n++)r.push([this._queue[n],this._priorities[n]]);return r},t.prototype._init=function(r,n,i){if(r&&n){if(this._queue=[],this._priorities=[],r.length!==n.length)throw new Error("Arrays must have the same length");for(var s=0;s<r.length;s++)this.insert(r[s],n[s])}i&&(this._sorting=i)},t.prototype._insertAt=function(r,n,i){this._queue.length===i?(this._queue.push(r),this._priorities.push(n)):(this._queue.splice(i,0,r),this._priorities.splice(i,0,n))},e.exports&&(e.exports=t)}),TO=Qs(function(e){if(e.exports)var t=M0;function r(n,i,s,a){this.epsilon=1,this.minPts=1,this.distance=this._euclideanDistance,this._reachability=[],this._processed=[],this._coreDistance=0,this._orderedList=[],this._init(n,i,s,a)}r.prototype.run=function(n,i,s,a){this._init(n,i,s,a);for(var o=0,u=this.dataset.length;o<u;o++)if(this._processed[o]!==1){this._processed[o]=1,this.clusters.push([o]);var f=this.clusters.length-1;this._orderedList.push(o);var l=new t(null,null,"asc"),c=this._regionQuery(o);this._distanceToCore(o)!==void 0&&(this._updateQueue(o,c,l),this._expandCluster(f,l))}return this.clusters},r.prototype.getReachabilityPlot=function(){for(var n=[],i=0,s=this._orderedList.length;i<s;i++){var a=this._orderedList[i],o=this._reachability[a];n.push([a,o])}return n},r.prototype._init=function(n,i,s,a){if(n){if(!(n instanceof Array))throw Error("Dataset must be of type array, "+typeof n+" given");this.dataset=n,this.clusters=[],this._reachability=new Array(this.dataset.length),this._processed=new Array(this.dataset.length),this._coreDistance=0,this._orderedList=[]}i&&(this.epsilon=i),s&&(this.minPts=s),a&&(this.distance=a)},r.prototype._updateQueue=function(n,i,s){var a=this;this._coreDistance=this._distanceToCore(n),i.forEach(function(o){if(a._processed[o]===void 0){var u=a.distance(a.dataset[n],a.dataset[o]),f=Math.max(a._coreDistance,u);a._reachability[o]===void 0?(a._reachability[o]=f,s.insert(o,f)):f<a._reachability[o]&&(a._reachability[o]=f,s.remove(o),s.insert(o,f))}})},r.prototype._expandCluster=function(n,i){for(var s=i.getElements(),a=0,o=s.length;a<o;a++){var u=s[a];if(this._processed[u]===void 0){var f=this._regionQuery(u);this._processed[u]=1,this.clusters[n].push(u),this._orderedList.push(u),this._distanceToCore(u)!==void 0&&(this._updateQueue(u,f,i),this._expandCluster(n,i))}}},r.prototype._distanceToCore=function(n){for(var i=this.epsilon,s=0;s<i;s++){var a=this._regionQuery(n,s);if(a.length>=this.minPts)return s}},r.prototype._regionQuery=function(n,i){i=i||this.epsilon;for(var s=[],a=0,o=this.dataset.length;a<o;a++)this.distance(this.dataset[n],this.dataset[a])<i&&s.push(a);return s},r.prototype._euclideanDistance=function(n,i){for(var s=0,a=Math.min(n.length,i.length);a--;)s+=(n[a]-i[a])*(n[a]-i[a]);return Math.sqrt(s)},e.exports&&(e.exports=r)}),Jf=Qs(function(e){e.exports&&(e.exports={DBSCAN:wO,KMEANS:SO,OPTICS:TO,PriorityQueue:M0})}),tV=Jf.DBSCAN,rV=Jf.KMEANS,nV=Jf.OPTICS,iV=Jf.PriorityQueue;function IO(e,t,r){if(r=r||{},typeof r!="object")throw new Error("options is invalid");var n=r.minPoints,i=r.units;if(Qi(e,"Point","Input must contain Points"),t==null)throw new Error("maxDistance is required");if(!(Math.sign(t)>0))throw new Error("Invalid maxDistance");if(!(n==null||Math.sign(n)>0))throw new Error("Invalid minPoints");e=Kr(e,!0),n=n||3;var s=new Jf.DBSCAN,a=s.run(ls(e),to(t,i),n,Et),o=-1;return a.forEach(function(u){o++,u.forEach(function(f){var l=e.features[f];l.properties||(l.properties={}),l.properties.cluster=o,l.properties.dbscan="core"})}),s.noise.forEach(function(u){var f=e.features[u];f.properties||(f.properties={}),f.properties.cluster?f.properties.dbscan="edge":f.properties.dbscan="noise"}),e}var bp={eudist:function(t,r,n){for(var i=t.length,s=0,a=0;a<i;a++){var o=(t[a]||0)-(r[a]||0);s+=o*o}return n?Math.sqrt(s):s},mandist:function(t,r,n){for(var i=t.length,s=0,a=0;a<i;a++)s+=Math.abs((t[a]||0)-(r[a]||0));return n?Math.sqrt(s):s},dist:function(t,r,n){var i=Math.abs(t-r);return n?i:i*i}},LO=bp.eudist,PO=bp.dist,A0={kmrand:function(t,r){for(var n={},i=[],s=r<<2,a=t.length,o=t[0].length>0;i.length<r&&s-- >0;){var u=t[Math.floor(Math.random()*a)],f=o?u.join("_"):""+u;n[f]||(n[f]=!0,i.push(u))}if(i.length<r)throw new Error("Error initializating clusters");return i},kmpp:function(t,r){var n=t[0].length?LO:PO,i=[],s=t.length,a=t[0].length>0,o=t[Math.floor(Math.random()*s)],u=a?o.join("_"):""+o;for(i.push(o);i.length<r;){for(var f=[],l=i.length,c=0,h=[],d=0;d<s;d++){for(var m=1/0,g=0;g<l;g++){var p=n(t[d],i[g]);p<=m&&(m=p)}f[d]=m}for(var v=0;v<s;v++)c+=f[v];for(var _=0;_<s;_++)h[_]={i:_,v:t[_],pr:f[_]/c,cs:0};h.sort(function(S,I){return S.pr-I.pr}),h[0].cs=h[0].pr;for(var y=1;y<s;y++)h[y].cs=h[y-1].cs+h[y].pr;for(var x=Math.random(),E=0;E<s-1&&h[E++].cs<x;);i.push(h[E-1].v)}return i}},MO=bp.eudist,AO=A0.kmrand,DO=A0.kmpp,ZC=1e4;function JC(e,t,r){r=r||[];for(var n=0;n<e;n++)r[n]=t;return r}function RO(e,t,r,n){var i=[],s=[],a=[],o=[],u=!1,f=n||ZC,l=e.length,c=e[0].length,h=c>0,d=[];if(r)r=="kmrand"?i=AO(e,t):r=="kmpp"?i=DO(e,t):i=r;else for(var m={};i.length<t;){var g=Math.floor(Math.random()*l);m[g]||(m[g]=!0,i.push(e[g]))}do{JC(t,0,d);for(var p=0;p<l;p++){for(var v=1/0,_=0,y=0;y<t;y++){var o=h?MO(e[p],i[y]):Math.abs(e[p]-i[y]);o<=v&&(v=o,_=y)}a[p]=_,d[_]++}for(var x=[],s=[],E=0;E<t;E++)x[E]=h?JC(c,0,x[E]):0,s[E]=i[E];if(h){for(var S=0;S<t;S++)i[S]=[];for(var I=0;I<l;I++)for(var P=a[I],w=x[P],N=e[I],B=0;B<c;B++)w[B]+=N[B];u=!0;for(var C=0;C<t;C++){for(var b=i[C],T=x[C],A=s[C],R=d[C],F=0;F<c;F++)b[F]=T[F]/R||0;if(u){for(var D=0;D<c;D++)if(A[D]!=b[D]){u=!1;break}}}}else{for(var O=0;O<l;O++){var U=a[O];x[U]+=e[O]}for(var q=0;q<t;q++)i[q]=x[q]/d[q]||0;u=!0;for(var Y=0;Y<t;Y++)if(s[Y]!=i[Y]){u=!1;break}}u=u||--f<=0}while(!u);return{it:ZC-f,k:t,idxs:a,centroids:i}}var OO=RO;function NO(e,t){if(t=t||{},typeof t!="object")throw new Error("options is invalid");var r=t.numberOfClusters,n=t.mutate;Qi(e,"Point","Input must contain Points");var i=e.features.length;r=r||Math.round(Math.sqrt(i/2)),r>i&&(r=i),(n===!1||n===void 0)&&(e=Kr(e,!0));var s=ls(e),a=s.slice(0,r),o=OO(s,r,a),u={};return o.centroids.forEach(function(f,l){u[l]=f}),wt(e,function(f,l){var c=o.idxs[l];f.properties.cluster=c,f.properties.centroid=u[c]}),e}function FO(e,t){if(!e)throw new Error("line1 is required");if(!t)throw new Error("line2 is required");var r=$C(e,"line1");if(r!=="LineString")throw new Error("line1 must be a LineString");var n=$C(t,"line2");if(n!=="LineString")throw new Error("line2 must be a LineString");for(var i=no(ks(e)).features,s=no(ks(t)).features,a=0;a<i.length;a++){var o=i[a].geometry.coordinates;if(!s[a])break;var u=s[a].geometry.coordinates;if(!VO(o,u))return!1}return!0}function BO(e,t){var r=!1;return Jt(e,function(n){Jt(t,function(i){if(r===!0)return!0;r=!w0(n.geometry,i.geometry)})}),r}function VO(e,t){var r=va(_a(e[0],e[1])),n=va(_a(t[0],t[1]));return r===n}function $C(e,t){if(e.geometry&&e.geometry.type)return e.geometry.type;if(e.type)return e.type;throw new Error("Invalid GeoJSON object for "+t)}function ey(e){for(var t=e,r=[];t.parent;)r.unshift(t),t=t.parent;return r}function zO(){return new D0(function(e){return e.f})}var Xc={search:function(e,t,r,n){e.cleanDirty(),n=n||{};var i=n.heuristic||Xc.heuristics.manhattan,s=n.closest||!1,a=zO(),o=t;for(t.h=i(t,r),a.push(t);a.size()>0;){var u=a.pop();if(u===r)return ey(u);u.closed=!0;for(var f=e.neighbors(u),l=0,c=f.length;l<c;++l){var h=f[l];if(!(h.closed||h.isWall())){var d=u.g+h.getCost(u),m=h.visited;(!m||d<h.g)&&(h.visited=!0,h.parent=u,h.h=h.h||i(h,r),h.g=d,h.f=h.g+h.h,e.markDirty(h),s&&(h.h<o.h||h.h===o.h&&h.g<o.g)&&(o=h),m?a.rescoreElement(h):a.push(h))}}}return s?ey(o):[]},heuristics:{manhattan:function(e,t){var r=Math.abs(t.x-e.x),n=Math.abs(t.y-e.y);return r+n},diagonal:function(e,t){var r=1,n=Math.sqrt(2),i=Math.abs(t.x-e.x),s=Math.abs(t.y-e.y);return r*(i+s)+(n-2*r)*Math.min(i,s)}},cleanNode:function(e){e.f=0,e.g=0,e.h=0,e.visited=!1,e.closed=!1,e.parent=null}};function wu(e,t){t=t||{},this.nodes=[],this.diagonal=!!t.diagonal,this.grid=[];for(var r=0;r<e.length;r++){this.grid[r]=[];for(var n=0,i=e[r];n<i.length;n++){var s=new jc(r,n,i[n]);this.grid[r][n]=s,this.nodes.push(s)}}this.init()}wu.prototype.init=function(){this.dirtyNodes=[];for(var e=0;e<this.nodes.length;e++)Xc.cleanNode(this.nodes[e])};wu.prototype.cleanDirty=function(){for(var e=0;e<this.dirtyNodes.length;e++)Xc.cleanNode(this.dirtyNodes[e]);this.dirtyNodes=[]};wu.prototype.markDirty=function(e){this.dirtyNodes.push(e)};wu.prototype.neighbors=function(e){var t=[],r=e.x,n=e.y,i=this.grid;return i[r-1]&&i[r-1][n]&&t.push(i[r-1][n]),i[r+1]&&i[r+1][n]&&t.push(i[r+1][n]),i[r]&&i[r][n-1]&&t.push(i[r][n-1]),i[r]&&i[r][n+1]&&t.push(i[r][n+1]),this.diagonal&&(i[r-1]&&i[r-1][n-1]&&t.push(i[r-1][n-1]),i[r+1]&&i[r+1][n-1]&&t.push(i[r+1][n-1]),i[r-1]&&i[r-1][n+1]&&t.push(i[r-1][n+1]),i[r+1]&&i[r+1][n+1]&&t.push(i[r+1][n+1])),t};wu.prototype.toString=function(){for(var e=[],t=this.grid,r,n,i,s,a=0,o=t.length;a<o;a++){for(r=[],n=t[a],i=0,s=n.length;i<s;i++)r.push(n[i].weight);e.push(r.join(" "))}return e.join(`
`)};function jc(e,t,r){this.x=e,this.y=t,this.weight=r}jc.prototype.toString=function(){return"["+this.x+" "+this.y+"]"};jc.prototype.getCost=function(e){return e&&e.x!==this.x&&e.y!==this.y?this.weight*1.41421:this.weight};jc.prototype.isWall=function(){return this.weight===0};function D0(e){this.content=[],this.scoreFunction=e}D0.prototype={push:function(e){this.content.push(e),this.sinkDown(this.content.length-1)},pop:function(){var e=this.content[0],t=this.content.pop();return this.content.length>0&&(this.content[0]=t,this.bubbleUp(0)),e},remove:function(e){var t=this.content.indexOf(e),r=this.content.pop();t!==this.content.length-1&&(this.content[t]=r,this.scoreFunction(r)<this.scoreFunction(e)?this.sinkDown(t):this.bubbleUp(t))},size:function(){return this.content.length},rescoreElement:function(e){this.sinkDown(this.content.indexOf(e))},sinkDown:function(e){for(var t=this.content[e];e>0;){var r=(e+1>>1)-1,n=this.content[r];if(this.scoreFunction(t)<this.scoreFunction(n))this.content[r]=t,this.content[e]=n,e=r;else break}},bubbleUp:function(e){for(var t=this.content.length,r=this.content[e],n=this.scoreFunction(r);;){var i=e+1<<1,s=i-1,a=null,o;if(s<t){var u=this.content[s];o=this.scoreFunction(u),o<n&&(a=s)}if(i<t){var f=this.content[i],l=this.scoreFunction(f);l<(a===null?n:o)&&(a=i)}if(a!==null)this.content[e]=this.content[a],this.content[a]=r,e=a;else break}}};function kO(e,t,r){if(r=r||{},!fe(r))throw new Error("options is invalid");var n=r.resolution,i=r.minDistance,s=r.obstacles||ge([]);if(!e)throw new Error("start is required");if(!t)throw new Error("end is required");if(n&&!bt(n)||n<=0)throw new Error("options.resolution must be a number, greater than 0");if(i)throw new Error("options.minDistance is not yet implemented");var a=Vt(e),o=Vt(t);switch(e=gt(a),t=gt(o),Mt(s)){case"FeatureCollection":if(s.features.length===0)return Pt([a,o]);break;case"Polygon":s=ge([nr(Tn(s))]);break;default:throw new Error("invalid obstacles")}var u=s;u.features.push(e),u.features.push(t);var f=ur(E0(up(ur(u)),1.15));if(!n){var l=Et([f[0],f[1]],[f[2],f[1]],r);n=l/100}u.features.pop(),u.features.pop();for(var c=f[0],h=f[1],d=f[2],m=f[3],g=n/Et([c,h],[d,h],r),p=g*(d-c),v=n/Et([c,h],[c,m],r),_=v*(m-h),y=d-c,x=m-h,E=Math.floor(y/p),S=Math.floor(x/_),I=(y-E*p)/2,P=(x-S*_)/2,w=[],N=[],B=[],C=[],b=1/0,T=1/0,A=m-P,R=0;A>=h;){for(var F=[],D=[],O=c+I,U=0;O<=d;){var q=gt([O,A]),Y=UO(q,s);F.push(Y?0:1),D.push(O+"|"+A);var W=Et(q,e);!Y&&W<b&&(b=W,B={x:U,y:R});var K=Et(q,t);!Y&&K<T&&(T=K,C={x:U,y:R}),O+=p,U++}N.push(F),w.push(D),A-=_,R++}var re=new wu(N,{diagonal:!0}),ce=re.grid[B.y][B.x],Se=re.grid[C.y][C.x],de=Xc.search(re,ce,Se),Ae=[a];return de.forEach(function(ye){var Ie=w[ye.x][ye.y].split("|");Ae.push([+Ie[0],+Ie[1]])}),Ae.push(o),ks(Pt(Ae))}function UO(e,t){for(var r=0;r<t.features.length;r++)if(Ut(e,t.features[r]))return!0;return!1}var ty=function(e){return function(){return e}};function GO(e){return e[0]}function qO(e){return e[1]}function Tc(){this._=null}function Kc(e){e.U=e.C=e.L=e.R=e.P=e.N=null}Tc.prototype={constructor:Tc,insert:function(e,t){var r,n,i;if(e){if(t.P=e,t.N=e.N,e.N&&(e.N.P=t),e.N=t,e.R){for(e=e.R;e.L;)e=e.L;e.L=t}else e.R=t;r=e}else this._?(e=ry(this._),t.P=null,t.N=e,e.P=e.L=t,r=e):(t.P=t.N=null,this._=t,r=null);for(t.L=t.R=null,t.U=r,t.C=!0,e=t;r&&r.C;)n=r.U,r===n.L?(i=n.R,i&&i.C?(r.C=i.C=!1,n.C=!0,e=n):(e===r.R&&(cf(this,r),e=r,r=e.U),r.C=!1,n.C=!0,hf(this,n))):(i=n.L,i&&i.C?(r.C=i.C=!1,n.C=!0,e=n):(e===r.L&&(hf(this,r),e=r,r=e.U),r.C=!1,n.C=!0,cf(this,n))),r=e.U;this._.C=!1},remove:function(e){e.N&&(e.N.P=e.P),e.P&&(e.P.N=e.N),e.N=e.P=null;var t=e.U,r,n=e.L,i=e.R,s,a;if(n?i?s=ry(i):s=n:s=i,t?t.L===e?t.L=s:t.R=s:this._=s,n&&i?(a=s.C,s.C=e.C,s.L=n,n.U=s,s!==i?(t=s.U,s.U=e.U,e=s.R,t.L=e,s.R=i,i.U=s):(s.U=t,t=s,e=s.R)):(a=e.C,e=s),e&&(e.U=t),!a){if(e&&e.C){e.C=!1;return}do{if(e===this._)break;if(e===t.L){if(r=t.R,r.C&&(r.C=!1,t.C=!0,cf(this,t),r=t.R),r.L&&r.L.C||r.R&&r.R.C){(!r.R||!r.R.C)&&(r.L.C=!1,r.C=!0,hf(this,r),r=t.R),r.C=t.C,t.C=r.R.C=!1,cf(this,t),e=this._;break}}else if(r=t.L,r.C&&(r.C=!1,t.C=!0,hf(this,t),r=t.L),r.L&&r.L.C||r.R&&r.R.C){(!r.L||!r.L.C)&&(r.R.C=!1,r.C=!0,cf(this,r),r=t.L),r.C=t.C,t.C=r.L.C=!1,hf(this,t),e=this._;break}r.C=!0,e=t,t=t.U}while(!e.C);e&&(e.C=!1)}}};function cf(e,t){var r=t,n=t.R,i=r.U;i?i.L===r?i.L=n:i.R=n:e._=n,n.U=i,r.U=n,r.R=n.L,r.R&&(r.R.U=r),n.L=r}function hf(e,t){var r=t,n=t.L,i=r.U;i?i.L===r?i.L=n:i.R=n:e._=n,n.U=i,r.U=n,r.L=n.R,r.L&&(r.L.U=r),n.R=r}function ry(e){for(;e.L;)e=e.L;return e}function xf(e,t,r,n){var i=[null,null],s=dn.push(i)-1;return i.left=e,i.right=t,r&&Ic(i,e,t,r),n&&Ic(i,t,e,n),Kn[e.index].halfedges.push(s),Kn[t.index].halfedges.push(s),i}function df(e,t,r){var n=[t,r];return n.left=e,n}function Ic(e,t,r,n){!e[0]&&!e[1]?(e[0]=n,e.left=t,e.right=r):e.left===r?e[1]=n:e[0]=n}function HO(e,t,r,n,i){var s=e[0],a=e[1],o=s[0],u=s[1],f=a[0],l=a[1],c=0,h=1,d=f-o,m=l-u,g;if(g=t-o,!(!d&&g>0)){if(g/=d,d<0){if(g<c)return;g<h&&(h=g)}else if(d>0){if(g>h)return;g>c&&(c=g)}if(g=n-o,!(!d&&g<0)){if(g/=d,d<0){if(g>h)return;g>c&&(c=g)}else if(d>0){if(g<c)return;g<h&&(h=g)}if(g=r-u,!(!m&&g>0)){if(g/=m,m<0){if(g<c)return;g<h&&(h=g)}else if(m>0){if(g>h)return;g>c&&(c=g)}if(g=i-u,!(!m&&g<0)){if(g/=m,m<0){if(g>h)return;g>c&&(c=g)}else if(m>0){if(g<c)return;g<h&&(h=g)}return!(c>0)&&!(h<1)||(c>0&&(e[0]=[o+c*d,u+c*m]),h<1&&(e[1]=[o+h*d,u+h*m])),!0}}}}}function WO(e,t,r,n,i){var s=e[1];if(s)return!0;var a=e[0],o=e.left,u=e.right,f=o[0],l=o[1],c=u[0],h=u[1],d=(f+c)/2,m=(l+h)/2,g,p;if(h===l){if(d<t||d>=n)return;if(f>c){if(!a)a=[d,r];else if(a[1]>=i)return;s=[d,i]}else{if(!a)a=[d,i];else if(a[1]<r)return;s=[d,r]}}else if(g=(f-c)/(h-l),p=m-g*d,g<-1||g>1)if(f>c){if(!a)a=[(r-p)/g,r];else if(a[1]>=i)return;s=[(i-p)/g,i]}else{if(!a)a=[(i-p)/g,i];else if(a[1]<r)return;s=[(r-p)/g,r]}else if(l<h){if(!a)a=[t,g*t+p];else if(a[0]>=n)return;s=[n,g*n+p]}else{if(!a)a=[n,g*n+p];else if(a[0]<t)return;s=[t,g*t+p]}return e[0]=a,e[1]=s,!0}function YO(e,t,r,n){for(var i=dn.length,s;i--;)(!WO(s=dn[i],e,t,r,n)||!HO(s,e,t,r,n)||!(Math.abs(s[0][0]-s[1][0])>Bt||Math.abs(s[0][1]-s[1][1])>Bt))&&delete dn[i]}function XO(e){return Kn[e.index]={site:e,halfedges:[]}}function jO(e,t){var r=e.site,n=t.left,i=t.right;return r===i&&(i=n,n=r),i?Math.atan2(i[1]-n[1],i[0]-n[0]):(r===n?(n=t[1],i=t[0]):(n=t[0],i=t[1]),Math.atan2(n[0]-i[0],i[1]-n[1]))}function R0(e,t){return t[+(t.left!==e.site)]}function KO(e,t){return t[+(t.left===e.site)]}function QO(){for(var e=0,t=Kn.length,r,n,i,s;e<t;++e)if((r=Kn[e])&&(s=(n=r.halfedges).length)){var a=new Array(s),o=new Array(s);for(i=0;i<s;++i)a[i]=i,o[i]=jO(r,dn[n[i]]);for(a.sort(function(u,f){return o[f]-o[u]}),i=0;i<s;++i)o[i]=n[a[i]];for(i=0;i<s;++i)n[i]=o[i]}}function ZO(e,t,r,n){var i=Kn.length,s,a,o,u,f,l,c,h,d,m,g,p,v=!0;for(s=0;s<i;++s)if(a=Kn[s]){for(o=a.site,f=a.halfedges,u=f.length;u--;)dn[f[u]]||f.splice(u,1);for(u=0,l=f.length;u<l;)m=KO(a,dn[f[u]]),g=m[0],p=m[1],c=R0(a,dn[f[++u%l]]),h=c[0],d=c[1],(Math.abs(g-h)>Bt||Math.abs(p-d)>Bt)&&(f.splice(u,0,dn.push(df(o,m,Math.abs(g-e)<Bt&&n-p>Bt?[e,Math.abs(h-e)<Bt?d:n]:Math.abs(p-n)<Bt&&r-g>Bt?[Math.abs(d-n)<Bt?h:r,n]:Math.abs(g-r)<Bt&&p-t>Bt?[r,Math.abs(h-r)<Bt?d:t]:Math.abs(p-t)<Bt&&g-e>Bt?[Math.abs(d-t)<Bt?h:e,t]:null))-1),++l);l&&(v=!1)}if(v){var _,y,x,E=1/0;for(s=0,v=null;s<i;++s)(a=Kn[s])&&(o=a.site,_=o[0]-e,y=o[1]-t,x=_*_+y*y,x<E&&(E=x,v=a));if(v){var S=[e,t],I=[e,n],P=[r,n],w=[r,t];v.halfedges.push(dn.push(df(o=v.site,S,I))-1,dn.push(df(o,I,P))-1,dn.push(df(o,P,w))-1,dn.push(df(o,w,S))-1)}}for(s=0;s<i;++s)(a=Kn[s])&&(a.halfedges.length||delete Kn[s])}var O0=[],wp;function JO(){Kc(this),this.x=this.y=this.arc=this.site=this.cy=null}function jo(e){var t=e.P,r=e.N;if(!(!t||!r)){var n=t.site,i=e.site,s=r.site;if(n!==s){var a=i[0],o=i[1],u=n[0]-a,f=n[1]-o,l=s[0]-a,c=s[1]-o,h=2*(u*c-f*l);if(!(h>=-nN)){var d=u*u+f*f,m=l*l+c*c,g=(c*d-f*m)/h,p=(u*m-l*d)/h,v=O0.pop()||new JO;v.arc=e,v.site=i,v.x=g+a,v.y=(v.cy=p+o)+Math.sqrt(g*g+p*p),e.circle=v;for(var _=null,y=Rf._;y;)if(v.y<y.y||v.y===y.y&&v.x<=y.x)if(y.L)y=y.L;else{_=y.P;break}else if(y.R)y=y.R;else{_=y;break}Rf.insert(_,v),_||(wp=v)}}}}function Qo(e){var t=e.circle;t&&(t.P||(wp=t.N),Rf.remove(t),O0.push(t),Kc(t),e.circle=null)}var N0=[];function $O(){Kc(this),this.edge=this.site=this.circle=null}function ny(e){var t=N0.pop()||new $O;return t.site=e,t}function Lm(e){Qo(e),Zo.remove(e),N0.push(e),Kc(e)}function eN(e){var t=e.circle,r=t.x,n=t.cy,i=[r,n],s=e.P,a=e.N,o=[e];Lm(e);for(var u=s;u.circle&&Math.abs(r-u.circle.x)<Bt&&Math.abs(n-u.circle.cy)<Bt;)s=u.P,o.unshift(u),Lm(u),u=s;o.unshift(u),Qo(u);for(var f=a;f.circle&&Math.abs(r-f.circle.x)<Bt&&Math.abs(n-f.circle.cy)<Bt;)a=f.N,o.push(f),Lm(f),f=a;o.push(f),Qo(f);var l=o.length,c;for(c=1;c<l;++c)f=o[c],u=o[c-1],Ic(f.edge,u.site,f.site,i);u=o[0],f=o[l-1],f.edge=xf(u.site,f.site,null,i),jo(u),jo(f)}function tN(e){for(var t=e[0],r=e[1],n,i,s,a,o=Zo._;o;)if(s=F0(o,r)-t,s>Bt)o=o.L;else if(a=t-rN(o,r),a>Bt){if(!o.R){n=o;break}o=o.R}else{s>-Bt?(n=o.P,i=o):a>-Bt?(n=o,i=o.N):n=i=o;break}XO(e);var u=ny(e);if(Zo.insert(n,u),!(!n&&!i)){if(n===i){Qo(n),i=ny(n.site),Zo.insert(u,i),u.edge=i.edge=xf(n.site,u.site),jo(n),jo(i);return}if(!i){u.edge=xf(n.site,u.site);return}Qo(n),Qo(i);var f=n.site,l=f[0],c=f[1],h=e[0]-l,d=e[1]-c,m=i.site,g=m[0]-l,p=m[1]-c,v=2*(h*p-d*g),_=h*h+d*d,y=g*g+p*p,x=[(p*_-d*y)/v+l,(h*y-g*_)/v+c];Ic(i.edge,f,m,x),u.edge=xf(f,e,null,x),i.edge=xf(e,m,null,x),jo(n),jo(i)}}function F0(e,t){var r=e.site,n=r[0],i=r[1],s=i-t;if(!s)return n;var a=e.P;if(!a)return-1/0;r=a.site;var o=r[0],u=r[1],f=u-t;if(!f)return o;var l=o-n,c=1/s-1/f,h=l/f;return c?(-h+Math.sqrt(h*h-2*c*(l*l/(-2*f)-u+f/2+i-s/2)))/c+n:(n+o)/2}function rN(e,t){var r=e.N;if(r)return F0(r,t);var n=e.site;return n[1]===t?n[0]:1/0}var Bt=1e-6,nN=1e-12,Zo,Kn,Rf,dn;function iN(e,t,r){return(e[0]-r[0])*(t[1]-e[1])-(e[0]-t[0])*(r[1]-e[1])}function sN(e,t){return t[1]-e[1]||t[0]-e[0]}function Wm(e,t){var r=e.sort(sN).pop(),n,i,s;for(dn=[],Kn=new Array(e.length),Zo=new Tc,Rf=new Tc;;)if(s=wp,r&&(!s||r[1]<s.y||r[1]===s.y&&r[0]<s.x))(r[0]!==n||r[1]!==i)&&(tN(r),n=r[0],i=r[1]),r=e.pop();else if(s)eN(s.arc);else break;if(QO(),t){var a=+t[0][0],o=+t[0][1],u=+t[1][0],f=+t[1][1];YO(a,o,u,f),ZO(a,o,u,f)}this.edges=dn,this.cells=Kn,Zo=Rf=dn=Kn=null}Wm.prototype={constructor:Wm,polygons:function(){var e=this.edges;return this.cells.map(function(t){var r=t.halfedges.map(function(n){return R0(t,e[n])});return r.data=t.site.data,r})},triangles:function(){var e=[],t=this.edges;return this.cells.forEach(function(r,n){if(o=(s=r.halfedges).length)for(var i=r.site,s,a=-1,o,u,f=t[s[o-1]],l=f.left===i?f.right:f.left;++a<o;)u=l,f=t[s[a]],l=f.left===i?f.right:f.left,u&&l&&n<u.index&&n<l.index&&iN(i,u,l)<0&&e.push([i.data,u.data,l.data])}),e},links:function(){return this.edges.filter(function(e){return e.right}).map(function(e){return{source:e.left.data,target:e.right.data}})},find:function(e,t,r){for(var n=this,i,s=n._found||0,a=n.cells.length,o;!(o=n.cells[s]);)if(++s>=a)return null;var u=e-o.site[0],f=t-o.site[1],l=u*u+f*f;do o=n.cells[i=s],s=null,o.halfedges.forEach(function(c){var h=n.edges[c],d=h.left;if(!((d===o.site||!d)&&!(d=h.right))){var m=e-d[0],g=t-d[1],p=m*m+g*g;p<l&&(l=p,s=d.index)}});while(s!==null);return n._found=i,r==null||l<=r*r?o.site:null}};var aN=function(){var e=GO,t=qO,r=null;function n(i){return new Wm(i.map(function(s,a){var o=[Math.round(e(s,a,i)/Bt)*Bt,Math.round(t(s,a,i)/Bt)*Bt];return o.index=a,o.data=s,o}),r)}return n.polygons=function(i){return n(i).polygons()},n.links=function(i){return n(i).links()},n.triangles=function(i){return n(i).triangles()},n.x=function(i){return arguments.length?(e=typeof i=="function"?i:ty(+i),n):e},n.y=function(i){return arguments.length?(t=typeof i=="function"?i:ty(+i),n):t},n.extent=function(i){return arguments.length?(r=i==null?null:[[+i[0][0],+i[0][1]],[+i[1][0],+i[1][1]]],n):r&&[[r[0][0],r[0][1]],[r[1][0],r[1][1]]]},n.size=function(i){return arguments.length?(r=i==null?null:[[0,0],[+i[0],+i[1]]],n):r&&[r[1][0]-r[0][0],r[1][1]-r[0][1]]},n};function oN(e){return e=e.slice(),e.push(e[0]),ze([e])}function uN(e,t){if(t=t||{},!fe(t))throw new Error("options is invalid");var r=t.bbox||[-180,-85,180,85];if(!e)throw new Error("points is required");if(!Array.isArray(r))throw new Error("bbox is invalid");return Qi(e,"Point","points"),ge(aN().x(function(n){return n.geometry.coordinates[0]}).y(function(n){return n.geometry.coordinates[1]}).extent([[r[0],r[1]],[r[2],r[3]]]).polygons(e.features).map(oN))}function B0(e,t,r,n){n=n||{};var i=n.steps||64,s=n.units||"kilometers",a=n.angle||0,o=n.pivot||e,u=n.properties||e.properties||{};if(!e)throw new Error("center is required");if(!t)throw new Error("xSemiAxis is required");if(!r)throw new Error("ySemiAxis is required");if(!fe(n))throw new Error("options must be an object");if(!bt(i))throw new Error("steps must be a number");if(!bt(a))throw new Error("angle must be a number");var f=Vt(e);if(s==="degrees")var l=dr(a);else t=eu(e,t,90,{units:s}),r=eu(e,r,0,{units:s}),t=Vt(t)[0]-f[0],r=Vt(r)[1]-f[1];for(var c=[],h=0;h<i;h+=1){var d=h*-360/i,m=t*r/Math.sqrt(Math.pow(r,2)+Math.pow(t,2)*Math.pow(iy(d),2)),g=t*r/Math.sqrt(Math.pow(t,2)+Math.pow(r,2)/Math.pow(iy(d),2));if(d<-90&&d>=-270&&(m=-m),d<-180&&d>=-360&&(g=-g),s==="degrees"){var p=m*Math.cos(l)+g*Math.sin(l),v=g*Math.cos(l)-m*Math.sin(l);m=p,g=v}c.push([m+f[0],g+f[1]])}return c.push(c[0]),s==="degrees"?ze([c],u):x0(ze([c],u),a,{pivot:o})}function iy(e){var t=e*Math.PI/180;return Math.tan(t)}function Sp(e,t){if(t=t||{},!fe(t))throw new Error("options is invalid");var r=t.properties,n=t.weight;if(!e)throw new Error("geojson is required");var i=0,s=0,a=0;return Mi(e,function(o,u,f){var l=f[n];if(l=l??1,!bt(l))throw new Error("weight value must be a number for feature index "+u);l=Number(l),l>0&&mr(o,function(c){i+=c[0]*l,s+=c[1]*l,a+=l})}),gt([i/a,s/a],r)}function fN(e,t){if(t=t||{},!fe(t))throw new Error("options is invalid");var r=t.counter||10;if(!bt(r))throw new Error("counter must be a number");var n=t.weight,i=Sp(e,{weight:t.weight}),s=ge([]);return wt(e,function(a){s.features.push(ro(a,{weight:a.properties[n]}))}),s.properties={tolerance:t.tolerance,medianCandidates:[]},V0(i.geometry.coordinates,[0,0],s,r)}function V0(e,t,r,n){var i=r.properties.tolerance||.001,s=0,a=0,o=0,u=0;if(wt(r,function(c){var h=c.properties.weight,d=h??1;if(d=Number(d),!bt(d))throw new Error("weight value must be a number");if(d>0){u+=1;var m=d*Et(c,e);m===0&&(m=1);var g=d/m;s+=c.geometry.coordinates[0]*g,a+=c.geometry.coordinates[1]*g,o+=g}}),u<1)throw new Error("no features to measure");var f=s/o,l=a/o;return u===1||n===0||Math.abs(f-t[0])<i&&Math.abs(l-t[1])<i?gt([f,l],{medianCandidates:r.properties.medianCandidates}):(r.properties.medianCandidates.push([f,l]),V0([f,l],e,r,n-1))}function lN(e,t){if(t=t||{},!fe(t))throw new Error("options is invalid");var r=t.steps||64,n=t.weight,i=t.properties||{};if(!bt(r))throw new Error("steps must be a number");if(!fe(i))throw new Error("properties must be a number");var s=ls(e).length,a=Sp(e,{weight:n}),o=0,u=0,f=0;wt(e,function(I){var P=I.properties[n]||1,w=sy(le(I),le(a));o+=Math.pow(w.x,2)*P,u+=Math.pow(w.y,2)*P,f+=w.x*w.y*P});var l=o-u,c=Math.sqrt(Math.pow(l,2)+4*Math.pow(f,2)),h=2*f,d=Math.atan((l+c)/h),m=d*180/Math.PI,g=0,p=0,v=0;wt(e,function(I){var P=I.properties[n]||1,w=sy(le(I),le(a));g+=Math.pow(w.x*Math.cos(d)-w.y*Math.sin(d),2)*P,p+=Math.pow(w.x*Math.sin(d)+w.y*Math.cos(d),2)*P,v+=P});var _=Math.sqrt(2*g/v),y=Math.sqrt(2*p/v),x=B0(a,_,y,{units:"degrees",angle:m,steps:r,properties:i}),E=Dm(e,ge([x])),S={meanCenterCoordinates:le(a),semiMajorAxis:_,semiMinorAxis:y,numberOfFeatures:s,angle:m,percentageWithinEllipse:100*ls(E).length/s};return x.properties.standardDeviationalEllipse=S,x}function sy(e,t){return{x:e[0]-t[0],y:e[1]-t[1]}}function $f(e){if(fe(e)&&(e=e.bbox),e&&!Array.isArray(e))throw new Error("bbox is invalid");return e?mN(e):[hN(),dN()]}function z0(e,t){if(t=t||{},!fe(t))throw new Error("options is invalid");var r=t.bbox;e==null&&(e=1);for(var n=[],i=0;i<e;i++)n.push(gt($f(r)));return ge(n)}function k0(e,t){if(t=t||{},!fe(t))throw new Error("options is invalid");var r=t.bbox,n=t.num_vertices,i=t.max_radial_length;e==null&&(e=1),bt(n)||(n=10),bt(i)||(i=10);for(var s=[],a=0;a<e;a++){var o=[],u=Array.apply(null,new Array(n+1)).map(Math.random);u.forEach(f),u.forEach(l),o[o.length-1]=o[0],o=o.map(cN($f(r))),s.push(ze([o]))}function f(c,h,d){d[h]=h>0?c+d[h-1]:c}function l(c){c=c*2*Math.PI/u[u.length-1];var h=Math.random();o.push([h*i*Math.sin(c),h*i*Math.cos(c)])}return ge(s)}function U0(e,t){if(t=t||{},!fe(t))throw new Error("options is invalid");var r=t.bbox,n=t.num_vertices,i=t.max_length,s=t.max_rotation;e==null&&(e=1),(!bt(n)||n<2)&&(n=10),bt(i)||(i=1e-4),bt(s)||(s=Math.PI/8);for(var a=[],o=0;o<e;o++){for(var u=$f(r),f=[u],l=0;l<n-1;l++){var c=l===0?Math.random()*2*Math.PI:Math.tan((f[l][1]-f[l-1][1])/(f[l][0]-f[l-1][0])),h=c+(Math.random()-.5)*s*2,d=Math.random()*i;f.push([f[l][0]+d*Math.cos(h),f[l][1]+d*Math.sin(h)])}a.push(Pt(f))}return ge(a)}function cN(e){return function(t){return[t[0]+e[0],t[1]+e[1]]}}function G0(){return Math.random()-.5}function hN(){return G0()*360}function dN(){return G0()*180}function mN(e){return[Math.random()*(e[2]-e[0])+e[0],Math.random()*(e[3]-e[1])+e[1]]}var pN=Object.freeze({randomPosition:$f,randomPoint:z0,randomPolygon:k0,randomLineString:U0});function q0(e,t){if(!e)throw new Error("geojson is required");if(e.type!=="FeatureCollection")throw new Error("geojson must be a FeatureCollection");if(t==null)throw new Error("filter is required");var r=[];return wt(e,function(n){Qc(n.properties,t)&&r.push(n)}),ge(r)}function Tp(e,t,r){if(!e)throw new Error("geojson is required");if(e.type!=="FeatureCollection")throw new Error("geojson must be a FeatureCollection");if(t==null)throw new Error("property is required");for(var n=Ip(e,t),i=Object.keys(n),s=0;s<i.length;s++){for(var a=i[s],o=n[a],u=[],f=0;f<o.length;f++)u.push(e.features[o[f]]);r(ge(u),a,s)}}function H0(e,t,r,n){var i=n;return Tp(e,t,function(s,a,o){o===0&&n===void 0?i=s:i=r(i,s,a,o)}),i}function Ip(e,t){var r={};return wt(e,function(n,i){var s=n.properties||{};if(s.hasOwnProperty(t)){var a=s[t];r.hasOwnProperty(a)?r[a].push(i):r[a]=[i]}}),r}function Qc(e,t){if(e===void 0)return!1;var r=typeof t;if(r==="number"||r==="string")return e.hasOwnProperty(t);if(Array.isArray(t)){for(var n=0;n<t.length;n++)if(!Qc(e,t[n]))return!1;return!0}else return Lp(e,t)}function Lp(e,t){for(var r=Object.keys(t),n=0;n<r.length;n++){var i=r[n];if(e[i]!==t[i])return!1}return!0}function W0(e,t){if(!t)return{};if(!t.length)return{};for(var r={},n=0;n<t.length;n++){var i=t[n];e.hasOwnProperty(i)&&(r[i]=e[i])}return r}var gN=Object.freeze({getCluster:q0,clusterEach:Tp,clusterReduce:H0,createBins:Ip,applyFilter:Qc,propertiesContainsFilter:Lp,filterProperties:W0});"fill"in Array.prototype||Object.defineProperty(Array.prototype,"fill",{configurable:!0,value:function(t){if(this===void 0||this===null)throw new TypeError(this+" is not an object");var r=Object(this),n=Math.max(Math.min(r.length,9007199254740991),0)||0,i=1 in arguments&&parseInt(Number(arguments[1]),10)||0;i=i<0?Math.max(n+i,0):Math.min(i,n);var s=2 in arguments&&arguments[2]!==void 0?parseInt(Number(arguments[2]),10)||0:n;for(s=s<0?Math.max(n+arguments[2],0):Math.min(s,n);i<s;)r[i]=t,++i;return r},writable:!0});Number.isFinite=Number.isFinite||function(e){return typeof e=="number"&&isFinite(e)};Number.isInteger=Number.isInteger||function(e){return typeof e=="number"&&isFinite(e)&&Math.floor(e)===e};Number.parseFloat=Number.parseFloat||parseFloat;Number.isNaN=Number.isNaN||function(e){return e!==e};Math.trunc=Math.trunc||function(e){return e<0?Math.ceil(e):Math.floor(e)};var io=function(){};io.prototype.interfaces_=function(){return[]};io.prototype.getClass=function(){return io};io.prototype.equalsWithTolerance=function(t,r,n){return Math.abs(t-r)<=n};var zt=function(){},Ee=function(){},Y0={MAX_VALUE:{configurable:!0}};Ee.isNaN=function(t){return Number.isNaN(t)};Ee.doubleToLongBits=function(t){return t};Ee.longBitsToDouble=function(t){return t};Ee.isInfinite=function(t){return!Number.isFinite(t)};Y0.MAX_VALUE.get=function(){return Number.MAX_VALUE};Object.defineProperties(Ee,Y0);var Hn=function(){},Zc=function(){},tu=function(){};function Wn(){}var V=function e(){if(this.x=null,this.y=null,this.z=null,arguments.length===0)this.x=0,this.y=0,this.z=e.NULL_ORDINATE;else if(arguments.length===1){var t=arguments[0];this.x=t.x,this.y=t.y,this.z=t.z}else arguments.length===2?(this.x=arguments[0],this.y=arguments[1],this.z=e.NULL_ORDINATE):arguments.length===3&&(this.x=arguments[0],this.y=arguments[1],this.z=arguments[2])},vo={DimensionalComparator:{configurable:!0},serialVersionUID:{configurable:!0},NULL_ORDINATE:{configurable:!0},X:{configurable:!0},Y:{configurable:!0},Z:{configurable:!0}};V.prototype.setOrdinate=function(t,r){switch(t){case V.X:this.x=r;break;case V.Y:this.y=r;break;case V.Z:this.z=r;break;default:throw new zt("Invalid ordinate index: "+t)}};V.prototype.equals2D=function(){if(arguments.length===1){var t=arguments[0];return!(this.x!==t.x||this.y!==t.y)}else if(arguments.length===2){var r=arguments[0],n=arguments[1];return!(!io.equalsWithTolerance(this.x,r.x,n)||!io.equalsWithTolerance(this.y,r.y,n))}};V.prototype.getOrdinate=function(t){switch(t){case V.X:return this.x;case V.Y:return this.y;case V.Z:return this.z;default:}throw new zt("Invalid ordinate index: "+t)};V.prototype.equals3D=function(t){return this.x===t.x&&this.y===t.y&&(this.z===t.z||Ee.isNaN(this.z))&&Ee.isNaN(t.z)};V.prototype.equals=function(t){return t instanceof V?this.equals2D(t):!1};V.prototype.equalInZ=function(t,r){return io.equalsWithTolerance(this.z,t.z,r)};V.prototype.compareTo=function(t){var r=t;return this.x<r.x?-1:this.x>r.x?1:this.y<r.y?-1:this.y>r.y?1:0};V.prototype.clone=function(){};V.prototype.copy=function(){return new V(this)};V.prototype.toString=function(){return"("+this.x+", "+this.y+", "+this.z+")"};V.prototype.distance3D=function(t){var r=this.x-t.x,n=this.y-t.y,i=this.z-t.z;return Math.sqrt(r*r+n*n+i*i)};V.prototype.distance=function(t){var r=this.x-t.x,n=this.y-t.y;return Math.sqrt(r*r+n*n)};V.prototype.hashCode=function(){var t=17;return t=37*t+V.hashCode(this.x),t=37*t+V.hashCode(this.y),t};V.prototype.setCoordinate=function(t){this.x=t.x,this.y=t.y,this.z=t.z};V.prototype.interfaces_=function(){return[Hn,Zc,Wn]};V.prototype.getClass=function(){return V};V.hashCode=function(){if(arguments.length===1){var t=arguments[0],r=Ee.doubleToLongBits(t);return Math.trunc((r^r)>>>32)}};vo.DimensionalComparator.get=function(){return Bs};vo.serialVersionUID.get=function(){return 6683108902428367e3};vo.NULL_ORDINATE.get=function(){return Ee.NaN};vo.X.get=function(){return 0};vo.Y.get=function(){return 1};vo.Z.get=function(){return 2};Object.defineProperties(V,vo);var Bs=function(t){if(this._dimensionsToTest=2,arguments.length!==0){if(arguments.length===1){var r=arguments[0];if(r!==2&&r!==3)throw new zt("only 2 or 3 dimensions may be specified");this._dimensionsToTest=r}}};Bs.prototype.compare=function(t,r){var n=t,i=r,s=Bs.compare(n.x,i.x);if(s!==0)return s;var a=Bs.compare(n.y,i.y);if(a!==0)return a;if(this._dimensionsToTest<=2)return 0;var o=Bs.compare(n.z,i.z);return o};Bs.prototype.interfaces_=function(){return[tu]};Bs.prototype.getClass=function(){return Bs};Bs.compare=function(t,r){return t<r?-1:t>r?1:Ee.isNaN(t)?Ee.isNaN(r)?0:-1:Ee.isNaN(r)?1:0};var ru=function(){};ru.prototype.create=function(){};ru.prototype.interfaces_=function(){return[]};ru.prototype.getClass=function(){return ru};var z=function(){},el={INTERIOR:{configurable:!0},BOUNDARY:{configurable:!0},EXTERIOR:{configurable:!0},NONE:{configurable:!0}};z.prototype.interfaces_=function(){return[]};z.prototype.getClass=function(){return z};z.toLocationSymbol=function(t){switch(t){case z.EXTERIOR:return"e";case z.BOUNDARY:return"b";case z.INTERIOR:return"i";case z.NONE:return"-";default:}throw new zt("Unknown location value: "+t)};el.INTERIOR.get=function(){return 0};el.BOUNDARY.get=function(){return 1};el.EXTERIOR.get=function(){return 2};el.NONE.get=function(){return-1};Object.defineProperties(z,el);var pe=function(e,t){return e.interfaces_&&e.interfaces_().indexOf(t)>-1},In=function(){},X0={LOG_10:{configurable:!0}};In.prototype.interfaces_=function(){return[]};In.prototype.getClass=function(){return In};In.log10=function(t){var r=Math.log(t);return Ee.isInfinite(r)||Ee.isNaN(r)?r:r/In.LOG_10};In.min=function(t,r,n,i){var s=t;return r<s&&(s=r),n<s&&(s=n),i<s&&(s=i),s};In.clamp=function(){if(typeof arguments[2]=="number"&&typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var t=arguments[0],r=arguments[1],n=arguments[2];return t<r?r:t>n?n:t}else if(Number.isInteger(arguments[2])&&Number.isInteger(arguments[0])&&Number.isInteger(arguments[1])){var i=arguments[0],s=arguments[1],a=arguments[2];return i<s?s:i>a?a:i}};In.wrap=function(t,r){return t<0?r- -t%r:t%r};In.max=function(){if(arguments.length===3){var t=arguments[0],r=arguments[1],n=arguments[2],i=t;return r>i&&(i=r),n>i&&(i=n),i}else if(arguments.length===4){var s=arguments[0],a=arguments[1],o=arguments[2],u=arguments[3],f=s;return a>f&&(f=a),o>f&&(f=o),u>f&&(f=u),f}};In.average=function(t,r){return(t+r)/2};X0.LOG_10.get=function(){return Math.log(10)};Object.defineProperties(In,X0);var Ai=function(t){this.str=t};Ai.prototype.append=function(t){this.str+=t};Ai.prototype.setCharAt=function(t,r){this.str=this.str.substr(0,t)+r+this.str.substr(t+1)};Ai.prototype.toString=function(t){return this.str};var yi=function(t){this.value=t};yi.prototype.intValue=function(){return this.value};yi.prototype.compareTo=function(t){return this.value<t?-1:this.value>t?1:0};yi.isNaN=function(t){return Number.isNaN(t)};var Of=function(){};Of.isWhitespace=function(t){return t<=32&&t>=0||t===127};Of.toUpperCase=function(t){return t.toUpperCase()};var k=function e(){if(this._hi=0,this._lo=0,arguments.length===0)this.init(0);else if(arguments.length===1){if(typeof arguments[0]=="number"){var t=arguments[0];this.init(t)}else if(arguments[0]instanceof e){var r=arguments[0];this.init(r)}else if(typeof arguments[0]=="string"){var n=arguments[0];e.call(this,e.parse(n))}}else if(arguments.length===2){var i=arguments[0],s=arguments[1];this.init(i,s)}},si={PI:{configurable:!0},TWO_PI:{configurable:!0},PI_2:{configurable:!0},E:{configurable:!0},NaN:{configurable:!0},EPS:{configurable:!0},SPLIT:{configurable:!0},MAX_PRINT_DIGITS:{configurable:!0},TEN:{configurable:!0},ONE:{configurable:!0},SCI_NOT_EXPONENT_CHAR:{configurable:!0},SCI_NOT_ZERO:{configurable:!0}};k.prototype.le=function(t){return(this._hi<t._hi||this._hi===t._hi)&&this._lo<=t._lo};k.prototype.extractSignificantDigits=function(t,r){var n=this.abs(),i=k.magnitude(n._hi),s=k.TEN.pow(i);n=n.divide(s),n.gt(k.TEN)?(n=n.divide(k.TEN),i+=1):n.lt(k.ONE)&&(n=n.multiply(k.TEN),i-=1);for(var a=i+1,o=new Ai,u=k.MAX_PRINT_DIGITS-1,f=0;f<=u;f++){t&&f===a&&o.append(".");var l=Math.trunc(n._hi);if(l<0)break;var c=!1,h=0;l>9?(c=!0,h="9"):h="0"+l,o.append(h),n=n.subtract(k.valueOf(l)).multiply(k.TEN),c&&n.selfAdd(k.TEN);var d=!0,m=k.magnitude(n._hi);if(m<0&&Math.abs(m)>=u-f&&(d=!1),!d)break}return r[0]=i,o.toString()};k.prototype.sqr=function(){return this.multiply(this)};k.prototype.doubleValue=function(){return this._hi+this._lo};k.prototype.subtract=function(){if(arguments[0]instanceof k){var t=arguments[0];return this.add(t.negate())}else if(typeof arguments[0]=="number"){var r=arguments[0];return this.add(-r)}};k.prototype.equals=function(){if(arguments.length===1){var t=arguments[0];return this._hi===t._hi&&this._lo===t._lo}};k.prototype.isZero=function(){return this._hi===0&&this._lo===0};k.prototype.selfSubtract=function(){if(arguments[0]instanceof k){var t=arguments[0];return this.isNaN()?this:this.selfAdd(-t._hi,-t._lo)}else if(typeof arguments[0]=="number"){var r=arguments[0];return this.isNaN()?this:this.selfAdd(-r,0)}};k.prototype.getSpecialNumberString=function(){return this.isZero()?"0.0":this.isNaN()?"NaN ":null};k.prototype.min=function(t){return this.le(t)?this:t};k.prototype.selfDivide=function(){if(arguments.length===1){if(arguments[0]instanceof k){var t=arguments[0];return this.selfDivide(t._hi,t._lo)}else if(typeof arguments[0]=="number"){var r=arguments[0];return this.selfDivide(r,0)}}else if(arguments.length===2){var n=arguments[0],i=arguments[1],s=null,a=null,o=null,u=null,f=null,l=null,c=null,h=null;return f=this._hi/n,l=k.SPLIT*f,s=l-f,h=k.SPLIT*n,s=l-s,a=f-s,o=h-n,c=f*n,o=h-o,u=n-o,h=s*o-c+s*u+a*o+a*u,l=(this._hi-c-h+this._lo-f*i)/n,h=f+l,this._hi=h,this._lo=f-h+l,this}};k.prototype.dump=function(){return"DD<"+this._hi+", "+this._lo+">"};k.prototype.divide=function(){if(arguments[0]instanceof k){var t=arguments[0],r=null,n=null,i=null,s=null,a=null,o=null,u=null,f=null;a=this._hi/t._hi,o=k.SPLIT*a,r=o-a,f=k.SPLIT*t._hi,r=o-r,n=a-r,i=f-t._hi,u=a*t._hi,i=f-i,s=t._hi-i,f=r*i-u+r*s+n*i+n*s,o=(this._hi-u-f+this._lo-a*t._lo)/t._hi,f=a+o;var l=f,c=a-f+o;return new k(l,c)}else if(typeof arguments[0]=="number"){var h=arguments[0];return Ee.isNaN(h)?k.createNaN():k.copy(this).selfDivide(h,0)}};k.prototype.ge=function(t){return(this._hi>t._hi||this._hi===t._hi)&&this._lo>=t._lo};k.prototype.pow=function(t){if(t===0)return k.valueOf(1);var r=new k(this),n=k.valueOf(1),i=Math.abs(t);if(i>1)for(;i>0;)i%2===1&&n.selfMultiply(r),i/=2,i>0&&(r=r.sqr());else n=r;return t<0?n.reciprocal():n};k.prototype.ceil=function(){if(this.isNaN())return k.NaN;var t=Math.ceil(this._hi),r=0;return t===this._hi&&(r=Math.ceil(this._lo)),new k(t,r)};k.prototype.compareTo=function(t){var r=t;return this._hi<r._hi?-1:this._hi>r._hi?1:this._lo<r._lo?-1:this._lo>r._lo?1:0};k.prototype.rint=function(){if(this.isNaN())return this;var t=this.add(.5);return t.floor()};k.prototype.setValue=function(){if(arguments[0]instanceof k){var t=arguments[0];return this.init(t),this}else if(typeof arguments[0]=="number"){var r=arguments[0];return this.init(r),this}};k.prototype.max=function(t){return this.ge(t)?this:t};k.prototype.sqrt=function(){if(this.isZero())return k.valueOf(0);if(this.isNegative())return k.NaN;var t=1/Math.sqrt(this._hi),r=this._hi*t,n=k.valueOf(r),i=this.subtract(n.sqr()),s=i._hi*(t*.5);return n.add(s)};k.prototype.selfAdd=function(){if(arguments.length===1){if(arguments[0]instanceof k){var t=arguments[0];return this.selfAdd(t._hi,t._lo)}else if(typeof arguments[0]=="number"){var r=arguments[0],n=null,i=null,s=null,a=null,o=null,u=null;return s=this._hi+r,o=s-this._hi,a=s-o,a=r-o+(this._hi-a),u=a+this._lo,n=s+u,i=u+(s-n),this._hi=n+i,this._lo=i+(n-this._hi),this}}else if(arguments.length===2){var f=arguments[0],l=arguments[1],c=null,h=null,d=null,m=null,g=null,p=null,v=null,_=null;g=this._hi+f,d=this._lo+l,v=g-this._hi,_=d-this._lo,p=g-v,m=d-_,p=f-v+(this._hi-p),m=l-_+(this._lo-m),v=p+d,c=g+v,h=v+(g-c),v=m+h;var y=c+v,x=v+(c-y);return this._hi=y,this._lo=x,this}};k.prototype.selfMultiply=function(){if(arguments.length===1){if(arguments[0]instanceof k){var t=arguments[0];return this.selfMultiply(t._hi,t._lo)}else if(typeof arguments[0]=="number"){var r=arguments[0];return this.selfMultiply(r,0)}}else if(arguments.length===2){var n=arguments[0],i=arguments[1],s=null,a=null,o=null,u=null,f=null,l=null;f=k.SPLIT*this._hi,s=f-this._hi,l=k.SPLIT*n,s=f-s,a=this._hi-s,o=l-n,f=this._hi*n,o=l-o,u=n-o,l=s*o-f+s*u+a*o+a*u+(this._hi*i+this._lo*n);var c=f+l;s=f-c;var h=l+s;return this._hi=c,this._lo=h,this}};k.prototype.selfSqr=function(){return this.selfMultiply(this)};k.prototype.floor=function(){if(this.isNaN())return k.NaN;var t=Math.floor(this._hi),r=0;return t===this._hi&&(r=Math.floor(this._lo)),new k(t,r)};k.prototype.negate=function(){return this.isNaN()?this:new k(-this._hi,-this._lo)};k.prototype.clone=function(){};k.prototype.multiply=function(){if(arguments[0]instanceof k){var t=arguments[0];return t.isNaN()?k.createNaN():k.copy(this).selfMultiply(t)}else if(typeof arguments[0]=="number"){var r=arguments[0];return Ee.isNaN(r)?k.createNaN():k.copy(this).selfMultiply(r,0)}};k.prototype.isNaN=function(){return Ee.isNaN(this._hi)};k.prototype.intValue=function(){return Math.trunc(this._hi)};k.prototype.toString=function(){var t=k.magnitude(this._hi);return t>=-3&&t<=20?this.toStandardNotation():this.toSciNotation()};k.prototype.toStandardNotation=function(){var t=this.getSpecialNumberString();if(t!==null)return t;var r=new Array(1).fill(null),n=this.extractSignificantDigits(!0,r),i=r[0]+1,s=n;if(n.charAt(0)===".")s="0"+n;else if(i<0)s="0."+k.stringOfChar("0",-i)+n;else if(n.indexOf(".")===-1){var a=i-n.length,o=k.stringOfChar("0",a);s=n+o+".0"}return this.isNegative()?"-"+s:s};k.prototype.reciprocal=function(){var t=null,r=null,n=null,i=null,s=null,a=null,o=null,u=null;s=1/this._hi,a=k.SPLIT*s,t=a-s,u=k.SPLIT*this._hi,t=a-t,r=s-t,n=u-this._hi,o=s*this._hi,n=u-n,i=this._hi-n,u=t*n-o+t*i+r*n+r*i,a=(1-o-u-s*this._lo)/this._hi;var f=s+a,l=s-f+a;return new k(f,l)};k.prototype.toSciNotation=function(){if(this.isZero())return k.SCI_NOT_ZERO;var t=this.getSpecialNumberString();if(t!==null)return t;var r=new Array(1).fill(null),n=this.extractSignificantDigits(!1,r),i=k.SCI_NOT_EXPONENT_CHAR+r[0];if(n.charAt(0)==="0")throw new Error("Found leading zero: "+n);var s="";n.length>1&&(s=n.substring(1));var a=n.charAt(0)+"."+s;return this.isNegative()?"-"+a+i:a+i};k.prototype.abs=function(){return this.isNaN()?k.NaN:this.isNegative()?this.negate():new k(this)};k.prototype.isPositive=function(){return(this._hi>0||this._hi===0)&&this._lo>0};k.prototype.lt=function(t){return(this._hi<t._hi||this._hi===t._hi)&&this._lo<t._lo};k.prototype.add=function(){if(arguments[0]instanceof k){var t=arguments[0];return k.copy(this).selfAdd(t)}else if(typeof arguments[0]=="number"){var r=arguments[0];return k.copy(this).selfAdd(r)}};k.prototype.init=function(){if(arguments.length===1){if(typeof arguments[0]=="number"){var t=arguments[0];this._hi=t,this._lo=0}else if(arguments[0]instanceof k){var r=arguments[0];this._hi=r._hi,this._lo=r._lo}}else if(arguments.length===2){var n=arguments[0],i=arguments[1];this._hi=n,this._lo=i}};k.prototype.gt=function(t){return(this._hi>t._hi||this._hi===t._hi)&&this._lo>t._lo};k.prototype.isNegative=function(){return(this._hi<0||this._hi===0)&&this._lo<0};k.prototype.trunc=function(){return this.isNaN()?k.NaN:this.isPositive()?this.floor():this.ceil()};k.prototype.signum=function(){return this._hi>0?1:this._hi<0?-1:this._lo>0?1:this._lo<0?-1:0};k.prototype.interfaces_=function(){return[Wn,Hn,Zc]};k.prototype.getClass=function(){return k};k.sqr=function(t){return k.valueOf(t).selfMultiply(t)};k.valueOf=function(){if(typeof arguments[0]=="string"){var t=arguments[0];return k.parse(t)}else if(typeof arguments[0]=="number"){var r=arguments[0];return new k(r)}};k.sqrt=function(t){return k.valueOf(t).sqrt()};k.parse=function(t){for(var r=0,n=t.length;Of.isWhitespace(t.charAt(r));)r++;var i=!1;if(r<n){var s=t.charAt(r);(s==="-"||s==="+")&&(r++,s==="-"&&(i=!0))}for(var a=new k,o=0,u=0,f=0;!(r>=n);){var l=t.charAt(r);if(r++,Of.isDigit(l)){var c=l-"0";a.selfMultiply(k.TEN),a.selfAdd(c),o++;continue}if(l==="."){u=o;continue}if(l==="e"||l==="E"){var h=t.substring(r);try{f=yi.parseInt(h)}catch(v){throw v instanceof Error?new Error("Invalid exponent "+h+" in string "+t):v}finally{}break}throw new Error("Unexpected character '"+l+"' at position "+r+" in string "+t)}var d=a,m=o-u-f;if(m===0)d=a;else if(m>0){var g=k.TEN.pow(m);d=a.divide(g)}else if(m<0){var p=k.TEN.pow(-m);d=a.multiply(p)}return i?d.negate():d};k.createNaN=function(){return new k(Ee.NaN,Ee.NaN)};k.copy=function(t){return new k(t)};k.magnitude=function(t){var r=Math.abs(t),n=Math.log(r)/Math.log(10),i=Math.trunc(Math.floor(n)),s=Math.pow(10,i);return s*10<=r&&(i+=1),i};k.stringOfChar=function(t,r){for(var n=new Ai,i=0;i<r;i++)n.append(t);return n.toString()};si.PI.get=function(){return new k(3.141592653589793,12246467991473532e-32)};si.TWO_PI.get=function(){return new k(6.283185307179586,24492935982947064e-32)};si.PI_2.get=function(){return new k(1.5707963267948966,6123233995736766e-32)};si.E.get=function(){return new k(2.718281828459045,14456468917292502e-32)};si.NaN.get=function(){return new k(Ee.NaN,Ee.NaN)};si.EPS.get=function(){return 123259516440783e-46};si.SPLIT.get=function(){return 134217729};si.MAX_PRINT_DIGITS.get=function(){return 32};si.TEN.get=function(){return k.valueOf(10)};si.ONE.get=function(){return k.valueOf(1)};si.SCI_NOT_EXPONENT_CHAR.get=function(){return"E"};si.SCI_NOT_ZERO.get=function(){return"0.0E0"};Object.defineProperties(k,si);var sn=function(){},j0={DP_SAFE_EPSILON:{configurable:!0}};sn.prototype.interfaces_=function(){return[]};sn.prototype.getClass=function(){return sn};sn.orientationIndex=function(t,r,n){var i=sn.orientationIndexFilter(t,r,n);if(i<=1)return i;var s=k.valueOf(r.x).selfAdd(-t.x),a=k.valueOf(r.y).selfAdd(-t.y),o=k.valueOf(n.x).selfAdd(-r.x),u=k.valueOf(n.y).selfAdd(-r.y);return s.selfMultiply(u).selfSubtract(a.selfMultiply(o)).signum()};sn.signOfDet2x2=function(t,r,n,i){var s=t.multiply(i).selfSubtract(r.multiply(n));return s.signum()};sn.intersection=function(t,r,n,i){var s=k.valueOf(i.y).selfSubtract(n.y).selfMultiply(k.valueOf(r.x).selfSubtract(t.x)),a=k.valueOf(i.x).selfSubtract(n.x).selfMultiply(k.valueOf(r.y).selfSubtract(t.y)),o=s.subtract(a),u=k.valueOf(i.x).selfSubtract(n.x).selfMultiply(k.valueOf(t.y).selfSubtract(n.y)),f=k.valueOf(i.y).selfSubtract(n.y).selfMultiply(k.valueOf(t.x).selfSubtract(n.x)),l=u.subtract(f),c=l.selfDivide(o).doubleValue(),h=k.valueOf(t.x).selfAdd(k.valueOf(r.x).selfSubtract(t.x).selfMultiply(c)).doubleValue(),d=k.valueOf(r.x).selfSubtract(t.x).selfMultiply(k.valueOf(t.y).selfSubtract(n.y)),m=k.valueOf(r.y).selfSubtract(t.y).selfMultiply(k.valueOf(t.x).selfSubtract(n.x)),g=d.subtract(m),p=g.selfDivide(o).doubleValue(),v=k.valueOf(n.y).selfAdd(k.valueOf(i.y).selfSubtract(n.y).selfMultiply(p)).doubleValue();return new V(h,v)};sn.orientationIndexFilter=function(t,r,n){var i=null,s=(t.x-n.x)*(r.y-n.y),a=(t.y-n.y)*(r.x-n.x),o=s-a;if(s>0){if(a<=0)return sn.signum(o);i=s+a}else if(s<0){if(a>=0)return sn.signum(o);i=-s-a}else return sn.signum(o);var u=sn.DP_SAFE_EPSILON*i;return o>=u||-o>=u?sn.signum(o):2};sn.signum=function(t){return t>0?1:t<0?-1:0};j0.DP_SAFE_EPSILON.get=function(){return 1e-15};Object.defineProperties(sn,j0);var Be=function(){},tl={X:{configurable:!0},Y:{configurable:!0},Z:{configurable:!0},M:{configurable:!0}};tl.X.get=function(){return 0};tl.Y.get=function(){return 1};tl.Z.get=function(){return 2};tl.M.get=function(){return 3};Be.prototype.setOrdinate=function(t,r,n){};Be.prototype.size=function(){};Be.prototype.getOrdinate=function(t,r){};Be.prototype.getCoordinate=function(){};Be.prototype.getCoordinateCopy=function(t){};Be.prototype.getDimension=function(){};Be.prototype.getX=function(t){};Be.prototype.clone=function(){};Be.prototype.expandEnvelope=function(t){};Be.prototype.copy=function(){};Be.prototype.getY=function(t){};Be.prototype.toCoordinateArray=function(){};Be.prototype.interfaces_=function(){return[Zc]};Be.prototype.getClass=function(){return Be};Object.defineProperties(Be,tl);var K0=function(){},Su=function(e){function t(){e.call(this,"Projective point not representable on the Cartesian plane.")}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(K0),br=function(){};br.arraycopy=function(t,r,n,i,s){for(var a=0,o=r;o<r+s;o++)n[i+a]=t[o],a++};br.getProperty=function(t){return{"line.separator":`
`}[t]};var Qn=function e(){if(this.x=null,this.y=null,this.w=null,arguments.length===0)this.x=0,this.y=0,this.w=1;else if(arguments.length===1){var t=arguments[0];this.x=t.x,this.y=t.y,this.w=1}else if(arguments.length===2){if(typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var r=arguments[0],n=arguments[1];this.x=r,this.y=n,this.w=1}else if(arguments[0]instanceof e&&arguments[1]instanceof e){var i=arguments[0],s=arguments[1];this.x=i.y*s.w-s.y*i.w,this.y=s.x*i.w-i.x*s.w,this.w=i.x*s.y-s.x*i.y}else if(arguments[0]instanceof V&&arguments[1]instanceof V){var a=arguments[0],o=arguments[1];this.x=a.y-o.y,this.y=o.x-a.x,this.w=a.x*o.y-o.x*a.y}}else if(arguments.length===3){var u=arguments[0],f=arguments[1],l=arguments[2];this.x=u,this.y=f,this.w=l}else if(arguments.length===4){var c=arguments[0],h=arguments[1],d=arguments[2],m=arguments[3],g=c.y-h.y,p=h.x-c.x,v=c.x*h.y-h.x*c.y,_=d.y-m.y,y=m.x-d.x,x=d.x*m.y-m.x*d.y;this.x=p*x-y*v,this.y=_*v-g*x,this.w=g*y-_*p}};Qn.prototype.getY=function(){var t=this.y/this.w;if(Ee.isNaN(t)||Ee.isInfinite(t))throw new Su;return t};Qn.prototype.getX=function(){var t=this.x/this.w;if(Ee.isNaN(t)||Ee.isInfinite(t))throw new Su;return t};Qn.prototype.getCoordinate=function(){var t=new V;return t.x=this.getX(),t.y=this.getY(),t};Qn.prototype.interfaces_=function(){return[]};Qn.prototype.getClass=function(){return Qn};Qn.intersection=function(t,r,n,i){var s=t.y-r.y,a=r.x-t.x,o=t.x*r.y-r.x*t.y,u=n.y-i.y,f=i.x-n.x,l=n.x*i.y-i.x*n.y,c=a*l-f*o,h=u*o-s*l,d=s*f-u*a,m=c/d,g=h/d;if(Ee.isNaN(m)||Ee.isInfinite(m)||Ee.isNaN(g)||Ee.isInfinite(g))throw new Su;return new V(m,g)};var ae=function e(){if(this._minx=null,this._maxx=null,this._miny=null,this._maxy=null,arguments.length===0)this.init();else if(arguments.length===1){if(arguments[0]instanceof V){var t=arguments[0];this.init(t.x,t.x,t.y,t.y)}else if(arguments[0]instanceof e){var r=arguments[0];this.init(r)}}else if(arguments.length===2){var n=arguments[0],i=arguments[1];this.init(n.x,i.x,n.y,i.y)}else if(arguments.length===4){var s=arguments[0],a=arguments[1],o=arguments[2],u=arguments[3];this.init(s,a,o,u)}},Q0={serialVersionUID:{configurable:!0}};ae.prototype.getArea=function(){return this.getWidth()*this.getHeight()};ae.prototype.equals=function(t){if(!(t instanceof ae))return!1;var r=t;return this.isNull()?r.isNull():this._maxx===r.getMaxX()&&this._maxy===r.getMaxY()&&this._minx===r.getMinX()&&this._miny===r.getMinY()};ae.prototype.intersection=function(t){if(this.isNull()||t.isNull()||!this.intersects(t))return new ae;var r=this._minx>t._minx?this._minx:t._minx,n=this._miny>t._miny?this._miny:t._miny,i=this._maxx<t._maxx?this._maxx:t._maxx,s=this._maxy<t._maxy?this._maxy:t._maxy;return new ae(r,i,n,s)};ae.prototype.isNull=function(){return this._maxx<this._minx};ae.prototype.getMaxX=function(){return this._maxx};ae.prototype.covers=function(){if(arguments.length===1){if(arguments[0]instanceof V){var t=arguments[0];return this.covers(t.x,t.y)}else if(arguments[0]instanceof ae){var r=arguments[0];return this.isNull()||r.isNull()?!1:r.getMinX()>=this._minx&&r.getMaxX()<=this._maxx&&r.getMinY()>=this._miny&&r.getMaxY()<=this._maxy}}else if(arguments.length===2){var n=arguments[0],i=arguments[1];return this.isNull()?!1:n>=this._minx&&n<=this._maxx&&i>=this._miny&&i<=this._maxy}};ae.prototype.intersects=function(){if(arguments.length===1){if(arguments[0]instanceof ae){var t=arguments[0];return this.isNull()||t.isNull()?!1:!(t._minx>this._maxx||t._maxx<this._minx||t._miny>this._maxy||t._maxy<this._miny)}else if(arguments[0]instanceof V){var r=arguments[0];return this.intersects(r.x,r.y)}}else if(arguments.length===2){var n=arguments[0],i=arguments[1];return this.isNull()?!1:!(n>this._maxx||n<this._minx||i>this._maxy||i<this._miny)}};ae.prototype.getMinY=function(){return this._miny};ae.prototype.getMinX=function(){return this._minx};ae.prototype.expandToInclude=function(){if(arguments.length===1){if(arguments[0]instanceof V){var t=arguments[0];this.expandToInclude(t.x,t.y)}else if(arguments[0]instanceof ae){var r=arguments[0];if(r.isNull())return null;this.isNull()?(this._minx=r.getMinX(),this._maxx=r.getMaxX(),this._miny=r.getMinY(),this._maxy=r.getMaxY()):(r._minx<this._minx&&(this._minx=r._minx),r._maxx>this._maxx&&(this._maxx=r._maxx),r._miny<this._miny&&(this._miny=r._miny),r._maxy>this._maxy&&(this._maxy=r._maxy))}}else if(arguments.length===2){var n=arguments[0],i=arguments[1];this.isNull()?(this._minx=n,this._maxx=n,this._miny=i,this._maxy=i):(n<this._minx&&(this._minx=n),n>this._maxx&&(this._maxx=n),i<this._miny&&(this._miny=i),i>this._maxy&&(this._maxy=i))}};ae.prototype.minExtent=function(){if(this.isNull())return 0;var t=this.getWidth(),r=this.getHeight();return t<r?t:r};ae.prototype.getWidth=function(){return this.isNull()?0:this._maxx-this._minx};ae.prototype.compareTo=function(t){var r=t;return this.isNull()?r.isNull()?0:-1:r.isNull()?1:this._minx<r._minx?-1:this._minx>r._minx?1:this._miny<r._miny?-1:this._miny>r._miny?1:this._maxx<r._maxx?-1:this._maxx>r._maxx?1:this._maxy<r._maxy?-1:this._maxy>r._maxy?1:0};ae.prototype.translate=function(t,r){if(this.isNull())return null;this.init(this.getMinX()+t,this.getMaxX()+t,this.getMinY()+r,this.getMaxY()+r)};ae.prototype.toString=function(){return"Env["+this._minx+" : "+this._maxx+", "+this._miny+" : "+this._maxy+"]"};ae.prototype.setToNull=function(){this._minx=0,this._maxx=-1,this._miny=0,this._maxy=-1};ae.prototype.getHeight=function(){return this.isNull()?0:this._maxy-this._miny};ae.prototype.maxExtent=function(){if(this.isNull())return 0;var t=this.getWidth(),r=this.getHeight();return t>r?t:r};ae.prototype.expandBy=function(){if(arguments.length===1){var t=arguments[0];this.expandBy(t,t)}else if(arguments.length===2){var r=arguments[0],n=arguments[1];if(this.isNull())return null;this._minx-=r,this._maxx+=r,this._miny-=n,this._maxy+=n,(this._minx>this._maxx||this._miny>this._maxy)&&this.setToNull()}};ae.prototype.contains=function(){if(arguments.length===1){if(arguments[0]instanceof ae){var t=arguments[0];return this.covers(t)}else if(arguments[0]instanceof V){var r=arguments[0];return this.covers(r)}}else if(arguments.length===2){var n=arguments[0],i=arguments[1];return this.covers(n,i)}};ae.prototype.centre=function(){return this.isNull()?null:new V((this.getMinX()+this.getMaxX())/2,(this.getMinY()+this.getMaxY())/2)};ae.prototype.init=function(){if(arguments.length===0)this.setToNull();else if(arguments.length===1){if(arguments[0]instanceof V){var t=arguments[0];this.init(t.x,t.x,t.y,t.y)}else if(arguments[0]instanceof ae){var r=arguments[0];this._minx=r._minx,this._maxx=r._maxx,this._miny=r._miny,this._maxy=r._maxy}}else if(arguments.length===2){var n=arguments[0],i=arguments[1];this.init(n.x,i.x,n.y,i.y)}else if(arguments.length===4){var s=arguments[0],a=arguments[1],o=arguments[2],u=arguments[3];s<a?(this._minx=s,this._maxx=a):(this._minx=a,this._maxx=s),o<u?(this._miny=o,this._maxy=u):(this._miny=u,this._maxy=o)}};ae.prototype.getMaxY=function(){return this._maxy};ae.prototype.distance=function(t){if(this.intersects(t))return 0;var r=0;this._maxx<t._minx?r=t._minx-this._maxx:this._minx>t._maxx&&(r=this._minx-t._maxx);var n=0;return this._maxy<t._miny?n=t._miny-this._maxy:this._miny>t._maxy&&(n=this._miny-t._maxy),r===0?n:n===0?r:Math.sqrt(r*r+n*n)};ae.prototype.hashCode=function(){var t=17;return t=37*t+V.hashCode(this._minx),t=37*t+V.hashCode(this._maxx),t=37*t+V.hashCode(this._miny),t=37*t+V.hashCode(this._maxy),t};ae.prototype.interfaces_=function(){return[Hn,Wn]};ae.prototype.getClass=function(){return ae};ae.intersects=function(){if(arguments.length===3){var t=arguments[0],r=arguments[1],n=arguments[2];return n.x>=(t.x<r.x?t.x:r.x)&&n.x<=(t.x>r.x?t.x:r.x)&&n.y>=(t.y<r.y?t.y:r.y)&&n.y<=(t.y>r.y?t.y:r.y)}else if(arguments.length===4){var i=arguments[0],s=arguments[1],a=arguments[2],o=arguments[3],u=Math.min(a.x,o.x),f=Math.max(a.x,o.x),l=Math.min(i.x,s.x),c=Math.max(i.x,s.x);return!(l>f||c<u||(u=Math.min(a.y,o.y),f=Math.max(a.y,o.y),l=Math.min(i.y,s.y),c=Math.max(i.y,s.y),l>f)||c<u)}};Q0.serialVersionUID.get=function(){return 5873921885273102e3};Object.defineProperties(ae,Q0);var di={typeStr:/^\s*(\w+)\s*\(\s*(.*)\s*\)\s*$/,emptyTypeStr:/^\s*(\w+)\s*EMPTY\s*$/,spaces:/\s+/,parenComma:/\)\s*,\s*\(/,doubleParenComma:/\)\s*\)\s*,\s*\(\s*\(/,trimParens:/^\s*\(?(.*?)\)?\s*$/},Jc=function(t){this.geometryFactory=t||new Pe};Jc.prototype.read=function(t){var r,n,i;t=t.replace(/[\n\r]/g," ");var s=di.typeStr.exec(t);if(t.search("EMPTY")!==-1&&(s=di.emptyTypeStr.exec(t),s[2]=void 0),s&&(n=s[1].toLowerCase(),i=s[2],Ko[n]&&(r=Ko[n].apply(this,[i]))),r===void 0)throw new Error("Could not parse WKT "+t);return r};Jc.prototype.write=function(t){return this.extractGeometry(t)};Jc.prototype.extractGeometry=function(t){var r=t.getGeometryType().toLowerCase();if(!ss[r])return null;var n=r.toUpperCase(),i;return t.isEmpty()?i=n+" EMPTY":i=n+"("+ss[r].apply(this,[t])+")",i};var ss={coordinate:function(t){return t.x+" "+t.y},point:function(t){return ss.coordinate.call(this,t._coordinates._coordinates[0])},multipoint:function(t){for(var r=this,n=[],i=0,s=t._geometries.length;i<s;++i)n.push("("+ss.point.apply(r,[t._geometries[i]])+")");return n.join(",")},linestring:function(t){for(var r=this,n=[],i=0,s=t._points._coordinates.length;i<s;++i)n.push(ss.coordinate.apply(r,[t._points._coordinates[i]]));return n.join(",")},linearring:function(t){for(var r=this,n=[],i=0,s=t._points._coordinates.length;i<s;++i)n.push(ss.coordinate.apply(r,[t._points._coordinates[i]]));return n.join(",")},multilinestring:function(t){for(var r=this,n=[],i=0,s=t._geometries.length;i<s;++i)n.push("("+ss.linestring.apply(r,[t._geometries[i]])+")");return n.join(",")},polygon:function(t){var r=this,n=[];n.push("("+ss.linestring.apply(this,[t._shell])+")");for(var i=0,s=t._holes.length;i<s;++i)n.push("("+ss.linestring.apply(r,[t._holes[i]])+")");return n.join(",")},multipolygon:function(t){for(var r=this,n=[],i=0,s=t._geometries.length;i<s;++i)n.push("("+ss.polygon.apply(r,[t._geometries[i]])+")");return n.join(",")},geometrycollection:function(t){for(var r=this,n=[],i=0,s=t._geometries.length;i<s;++i)n.push(r.extractGeometry(t._geometries[i]));return n.join(",")}},Ko={point:function(t){if(t===void 0)return this.geometryFactory.createPoint();var r=t.trim().split(di.spaces);return this.geometryFactory.createPoint(new V(Number.parseFloat(r[0]),Number.parseFloat(r[1])))},multipoint:function(t){var r=this;if(t===void 0)return this.geometryFactory.createMultiPoint();for(var n,i=t.trim().split(","),s=[],a=0,o=i.length;a<o;++a)n=i[a].replace(di.trimParens,"$1"),s.push(Ko.point.apply(r,[n]));return this.geometryFactory.createMultiPoint(s)},linestring:function(t){if(t===void 0)return this.geometryFactory.createLineString();for(var r=t.trim().split(","),n=[],i,s=0,a=r.length;s<a;++s)i=r[s].trim().split(di.spaces),n.push(new V(Number.parseFloat(i[0]),Number.parseFloat(i[1])));return this.geometryFactory.createLineString(n)},linearring:function(t){if(t===void 0)return this.geometryFactory.createLinearRing();for(var r=t.trim().split(","),n=[],i,s=0,a=r.length;s<a;++s)i=r[s].trim().split(di.spaces),n.push(new V(Number.parseFloat(i[0]),Number.parseFloat(i[1])));return this.geometryFactory.createLinearRing(n)},multilinestring:function(t){var r=this;if(t===void 0)return this.geometryFactory.createMultiLineString();for(var n,i=t.trim().split(di.parenComma),s=[],a=0,o=i.length;a<o;++a)n=i[a].replace(di.trimParens,"$1"),s.push(Ko.linestring.apply(r,[n]));return this.geometryFactory.createMultiLineString(s)},polygon:function(t){var r=this;if(t===void 0)return this.geometryFactory.createPolygon();for(var n,i,s,a=t.trim().split(di.parenComma),o,u=[],f=0,l=a.length;f<l;++f)n=a[f].replace(di.trimParens,"$1"),i=Ko.linestring.apply(r,[n]),s=r.geometryFactory.createLinearRing(i._points),f===0?o=s:u.push(s);return this.geometryFactory.createPolygon(o,u)},multipolygon:function(t){var r=this;if(t===void 0)return this.geometryFactory.createMultiPolygon();for(var n,i=t.trim().split(di.doubleParenComma),s=[],a=0,o=i.length;a<o;++a)n=i[a].replace(di.trimParens,"$1"),s.push(Ko.polygon.apply(r,[n]));return this.geometryFactory.createMultiPolygon(s)},geometrycollection:function(t){var r=this;if(t===void 0)return this.geometryFactory.createGeometryCollection();t=t.replace(/,\s*([A-Za-z])/g,"|$1");for(var n=t.trim().split("|"),i=[],s=0,a=n.length;s<a;++s)i.push(r.read(n[s]));return this.geometryFactory.createGeometryCollection(i)}},Jn=function(t){this.parser=new Jc(t)};Jn.prototype.write=function(t){return this.parser.write(t)};Jn.toLineString=function(t,r){if(arguments.length!==2)throw new Error("Not implemented");return"LINESTRING ( "+t.x+" "+t.y+", "+r.x+" "+r.y+" )"};var ds=function(e){function t(r){e.call(this,r),this.name="RuntimeException",this.message=r,this.stack=new e().stack}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t}(Error),Lc=function(e){function t(){if(e.call(this),arguments.length===0)e.call(this);else if(arguments.length===1){var r=arguments[0];e.call(this,r)}}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(ds),we=function(){};we.prototype.interfaces_=function(){return[]};we.prototype.getClass=function(){return we};we.shouldNeverReachHere=function(){if(arguments.length===0)we.shouldNeverReachHere(null);else if(arguments.length===1){var t=arguments[0];throw new Lc("Should never reach here"+(t!==null?": "+t:""))}};we.isTrue=function(){var t,r;if(arguments.length===1)t=arguments[0],we.isTrue(t,null);else if(arguments.length===2&&(t=arguments[0],r=arguments[1],!t))throw r===null?new Lc:new Lc(r)};we.equals=function(){var t,r,n;if(arguments.length===2)t=arguments[0],r=arguments[1],we.equals(t,r,null);else if(arguments.length===3&&(t=arguments[0],r=arguments[1],n=arguments[2],!r.equals(t)))throw new Lc("Expected "+t+" but encountered "+r+(n!==null?": "+n:""))};var Gt=function(){this._result=null,this._inputLines=Array(2).fill().map(function(){return Array(2)}),this._intPt=new Array(2).fill(null),this._intLineIndex=null,this._isProper=null,this._pa=null,this._pb=null,this._precisionModel=null,this._intPt[0]=new V,this._intPt[1]=new V,this._pa=this._intPt[0],this._pb=this._intPt[1],this._result=0},_o={DONT_INTERSECT:{configurable:!0},DO_INTERSECT:{configurable:!0},COLLINEAR:{configurable:!0},NO_INTERSECTION:{configurable:!0},POINT_INTERSECTION:{configurable:!0},COLLINEAR_INTERSECTION:{configurable:!0}};Gt.prototype.getIndexAlongSegment=function(t,r){return this.computeIntLineIndex(),this._intLineIndex[t][r]};Gt.prototype.getTopologySummary=function(){var t=new Ai;return this.isEndPoint()&&t.append(" endpoint"),this._isProper&&t.append(" proper"),this.isCollinear()&&t.append(" collinear"),t.toString()};Gt.prototype.computeIntersection=function(t,r,n,i){this._inputLines[0][0]=t,this._inputLines[0][1]=r,this._inputLines[1][0]=n,this._inputLines[1][1]=i,this._result=this.computeIntersect(t,r,n,i)};Gt.prototype.getIntersectionNum=function(){return this._result};Gt.prototype.computeIntLineIndex=function(){if(arguments.length===0)this._intLineIndex===null&&(this._intLineIndex=Array(2).fill().map(function(){return Array(2)}),this.computeIntLineIndex(0),this.computeIntLineIndex(1));else if(arguments.length===1){var t=arguments[0],r=this.getEdgeDistance(t,0),n=this.getEdgeDistance(t,1);r>n?(this._intLineIndex[t][0]=0,this._intLineIndex[t][1]=1):(this._intLineIndex[t][0]=1,this._intLineIndex[t][1]=0)}};Gt.prototype.isProper=function(){return this.hasIntersection()&&this._isProper};Gt.prototype.setPrecisionModel=function(t){this._precisionModel=t};Gt.prototype.isInteriorIntersection=function(){var t=this;if(arguments.length===0)return!!(this.isInteriorIntersection(0)||this.isInteriorIntersection(1));if(arguments.length===1){for(var r=arguments[0],n=0;n<this._result;n++)if(!(t._intPt[n].equals2D(t._inputLines[r][0])||t._intPt[n].equals2D(t._inputLines[r][1])))return!0;return!1}};Gt.prototype.getIntersection=function(t){return this._intPt[t]};Gt.prototype.isEndPoint=function(){return this.hasIntersection()&&!this._isProper};Gt.prototype.hasIntersection=function(){return this._result!==Gt.NO_INTERSECTION};Gt.prototype.getEdgeDistance=function(t,r){var n=Gt.computeEdgeDistance(this._intPt[r],this._inputLines[t][0],this._inputLines[t][1]);return n};Gt.prototype.isCollinear=function(){return this._result===Gt.COLLINEAR_INTERSECTION};Gt.prototype.toString=function(){return Jn.toLineString(this._inputLines[0][0],this._inputLines[0][1])+" - "+Jn.toLineString(this._inputLines[1][0],this._inputLines[1][1])+this.getTopologySummary()};Gt.prototype.getEndpoint=function(t,r){return this._inputLines[t][r]};Gt.prototype.isIntersection=function(t){for(var r=this,n=0;n<this._result;n++)if(r._intPt[n].equals2D(t))return!0;return!1};Gt.prototype.getIntersectionAlongSegment=function(t,r){return this.computeIntLineIndex(),this._intPt[this._intLineIndex[t][r]]};Gt.prototype.interfaces_=function(){return[]};Gt.prototype.getClass=function(){return Gt};Gt.computeEdgeDistance=function(t,r,n){var i=Math.abs(n.x-r.x),s=Math.abs(n.y-r.y),a=-1;if(t.equals(r))a=0;else if(t.equals(n))i>s?a=i:a=s;else{var o=Math.abs(t.x-r.x),u=Math.abs(t.y-r.y);i>s?a=o:a=u,a===0&&!t.equals(r)&&(a=Math.max(o,u))}return we.isTrue(!(a===0&&!t.equals(r)),"Bad distance calculation"),a};Gt.nonRobustComputeEdgeDistance=function(t,r,n){var i=t.x-r.x,s=t.y-r.y,a=Math.sqrt(i*i+s*s);return we.isTrue(!(a===0&&!t.equals(r)),"Invalid distance calculation"),a};_o.DONT_INTERSECT.get=function(){return 0};_o.DO_INTERSECT.get=function(){return 1};_o.COLLINEAR.get=function(){return 2};_o.NO_INTERSECTION.get=function(){return 0};_o.POINT_INTERSECTION.get=function(){return 1};_o.COLLINEAR_INTERSECTION.get=function(){return 2};Object.defineProperties(Gt,_o);var Oa=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.isInSegmentEnvelopes=function(n){var i=new ae(this._inputLines[0][0],this._inputLines[0][1]),s=new ae(this._inputLines[1][0],this._inputLines[1][1]);return i.contains(n)&&s.contains(n)},t.prototype.computeIntersection=function(){if(arguments.length===3){var n=arguments[0],i=arguments[1],s=arguments[2];if(this._isProper=!1,ae.intersects(i,s,n)&&J.orientationIndex(i,s,n)===0&&J.orientationIndex(s,i,n)===0)return this._isProper=!0,(n.equals(i)||n.equals(s))&&(this._isProper=!1),this._result=e.POINT_INTERSECTION,null;this._result=e.NO_INTERSECTION}else return e.prototype.computeIntersection.apply(this,arguments)},t.prototype.normalizeToMinimum=function(n,i,s,a,o){o.x=this.smallestInAbsValue(n.x,i.x,s.x,a.x),o.y=this.smallestInAbsValue(n.y,i.y,s.y,a.y),n.x-=o.x,n.y-=o.y,i.x-=o.x,i.y-=o.y,s.x-=o.x,s.y-=o.y,a.x-=o.x,a.y-=o.y},t.prototype.safeHCoordinateIntersection=function(n,i,s,a){var o=null;try{o=Qn.intersection(n,i,s,a)}catch(u){if(u instanceof Su)o=t.nearestEndpoint(n,i,s,a);else throw u}finally{}return o},t.prototype.intersection=function(n,i,s,a){var o=this.intersectionWithNormalization(n,i,s,a);return this.isInSegmentEnvelopes(o)||(o=new V(t.nearestEndpoint(n,i,s,a))),this._precisionModel!==null&&this._precisionModel.makePrecise(o),o},t.prototype.smallestInAbsValue=function(n,i,s,a){var o=n,u=Math.abs(o);return Math.abs(i)<u&&(o=i,u=Math.abs(i)),Math.abs(s)<u&&(o=s,u=Math.abs(s)),Math.abs(a)<u&&(o=a),o},t.prototype.checkDD=function(n,i,s,a,o){var u=sn.intersection(n,i,s,a),f=this.isInSegmentEnvelopes(u);br.out.println("DD in env = "+f+"  --------------------- "+u),o.distance(u)>1e-4&&br.out.println("Distance = "+o.distance(u))},t.prototype.intersectionWithNormalization=function(n,i,s,a){var o=new V(n),u=new V(i),f=new V(s),l=new V(a),c=new V;this.normalizeToEnvCentre(o,u,f,l,c);var h=this.safeHCoordinateIntersection(o,u,f,l);return h.x+=c.x,h.y+=c.y,h},t.prototype.computeCollinearIntersection=function(n,i,s,a){var o=ae.intersects(n,i,s),u=ae.intersects(n,i,a),f=ae.intersects(s,a,n),l=ae.intersects(s,a,i);return o&&u?(this._intPt[0]=s,this._intPt[1]=a,e.COLLINEAR_INTERSECTION):f&&l?(this._intPt[0]=n,this._intPt[1]=i,e.COLLINEAR_INTERSECTION):o&&f?(this._intPt[0]=s,this._intPt[1]=n,s.equals(n)&&!u&&!l?e.POINT_INTERSECTION:e.COLLINEAR_INTERSECTION):o&&l?(this._intPt[0]=s,this._intPt[1]=i,s.equals(i)&&!u&&!f?e.POINT_INTERSECTION:e.COLLINEAR_INTERSECTION):u&&f?(this._intPt[0]=a,this._intPt[1]=n,a.equals(n)&&!o&&!l?e.POINT_INTERSECTION:e.COLLINEAR_INTERSECTION):u&&l?(this._intPt[0]=a,this._intPt[1]=i,a.equals(i)&&!o&&!f?e.POINT_INTERSECTION:e.COLLINEAR_INTERSECTION):e.NO_INTERSECTION},t.prototype.normalizeToEnvCentre=function(n,i,s,a,o){var u=n.x<i.x?n.x:i.x,f=n.y<i.y?n.y:i.y,l=n.x>i.x?n.x:i.x,c=n.y>i.y?n.y:i.y,h=s.x<a.x?s.x:a.x,d=s.y<a.y?s.y:a.y,m=s.x>a.x?s.x:a.x,g=s.y>a.y?s.y:a.y,p=u>h?u:h,v=l<m?l:m,_=f>d?f:d,y=c<g?c:g,x=(p+v)/2,E=(_+y)/2;o.x=x,o.y=E,n.x-=o.x,n.y-=o.y,i.x-=o.x,i.y-=o.y,s.x-=o.x,s.y-=o.y,a.x-=o.x,a.y-=o.y},t.prototype.computeIntersect=function(n,i,s,a){if(this._isProper=!1,!ae.intersects(n,i,s,a))return e.NO_INTERSECTION;var o=J.orientationIndex(n,i,s),u=J.orientationIndex(n,i,a);if(o>0&&u>0||o<0&&u<0)return e.NO_INTERSECTION;var f=J.orientationIndex(s,a,n),l=J.orientationIndex(s,a,i);if(f>0&&l>0||f<0&&l<0)return e.NO_INTERSECTION;var c=o===0&&u===0&&f===0&&l===0;return c?this.computeCollinearIntersection(n,i,s,a):(o===0||u===0||f===0||l===0?(this._isProper=!1,n.equals2D(s)||n.equals2D(a)?this._intPt[0]=n:i.equals2D(s)||i.equals2D(a)?this._intPt[0]=i:o===0?this._intPt[0]=new V(s):u===0?this._intPt[0]=new V(a):f===0?this._intPt[0]=new V(n):l===0&&(this._intPt[0]=new V(i))):(this._isProper=!0,this._intPt[0]=this.intersection(n,i,s,a)),e.POINT_INTERSECTION)},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t.nearestEndpoint=function(n,i,s,a){var o=n,u=J.distancePointLine(n,s,a),f=J.distancePointLine(i,s,a);return f<u&&(u=f,o=i),f=J.distancePointLine(s,n,i),f<u&&(u=f,o=s),f=J.distancePointLine(a,n,i),f<u&&(u=f,o=a),o},t}(Gt),so=function(){};so.prototype.interfaces_=function(){return[]};so.prototype.getClass=function(){return so};so.orientationIndex=function(t,r,n){var i=r.x-t.x,s=r.y-t.y,a=n.x-r.x,o=n.y-r.y;return so.signOfDet2x2(i,s,a,o)};so.signOfDet2x2=function(t,r,n,i){var s=null,a=null,o=null;if(s=1,t===0||i===0)return r===0||n===0?0:r>0?n>0?-s:s:n>0?s:-s;if(r===0||n===0)return i>0?t>0?s:-s:t>0?-s:s;if(r>0?i>0?r<=i||(s=-s,a=t,t=n,n=a,a=r,r=i,i=a):r<=-i?(s=-s,n=-n,i=-i):(a=t,t=-n,n=a,a=r,r=-i,i=a):i>0?-r<=i?(s=-s,t=-t,r=-r):(a=-t,t=n,n=a,a=-r,r=i,i=a):r>=i?(t=-t,r=-r,n=-n,i=-i):(s=-s,a=-t,t=-n,n=a,a=-r,r=-i,i=a),t>0)if(n>0){if(!(t<=n))return s}else return s;else{if(n>0)return-s;if(t>=n)s=-s,t=-t,n=-n;else return-s}for(;;){if(o=Math.floor(n/t),n=n-o*t,i=i-o*r,i<0)return-s;if(i>r)return s;if(t>n+n){if(r<i+i)return s}else{if(r>i+i)return-s;n=t-n,i=r-i,s=-s}if(i===0)return n===0?0:-s;if(n===0||(o=Math.floor(t/n),t=t-o*n,r=r-o*i,r<0))return s;if(r>i)return-s;if(n>t+t){if(i<r+r)return-s}else{if(i>r+r)return s;t=n-t,r=i-r,s=-s}if(r===0)return t===0?0:s;if(t===0)return-s}};var _i=function(){this._p=null,this._crossingCount=0,this._isPointOnSegment=!1;var t=arguments[0];this._p=t};_i.prototype.countSegment=function(t,r){if(t.x<this._p.x&&r.x<this._p.x)return null;if(this._p.x===r.x&&this._p.y===r.y)return this._isPointOnSegment=!0,null;if(t.y===this._p.y&&r.y===this._p.y){var n=t.x,i=r.x;return n>i&&(n=r.x,i=t.x),this._p.x>=n&&this._p.x<=i&&(this._isPointOnSegment=!0),null}if(t.y>this._p.y&&r.y<=this._p.y||r.y>this._p.y&&t.y<=this._p.y){var s=t.x-this._p.x,a=t.y-this._p.y,o=r.x-this._p.x,u=r.y-this._p.y,f=so.signOfDet2x2(s,a,o,u);if(f===0)return this._isPointOnSegment=!0,null;u<a&&(f=-f),f>0&&this._crossingCount++}};_i.prototype.isPointInPolygon=function(){return this.getLocation()!==z.EXTERIOR};_i.prototype.getLocation=function(){return this._isPointOnSegment?z.BOUNDARY:this._crossingCount%2===1?z.INTERIOR:z.EXTERIOR};_i.prototype.isOnSegment=function(){return this._isPointOnSegment};_i.prototype.interfaces_=function(){return[]};_i.prototype.getClass=function(){return _i};_i.locatePointInRing=function(){if(arguments[0]instanceof V&&pe(arguments[1],Be)){for(var t=arguments[0],r=arguments[1],n=new _i(t),i=new V,s=new V,a=1;a<r.size();a++)if(r.getCoordinate(a,i),r.getCoordinate(a-1,s),n.countSegment(i,s),n.isOnSegment())return n.getLocation();return n.getLocation()}else if(arguments[0]instanceof V&&arguments[1]instanceof Array){for(var o=arguments[0],u=arguments[1],f=new _i(o),l=1;l<u.length;l++){var c=u[l],h=u[l-1];if(f.countSegment(c,h),f.isOnSegment())return f.getLocation()}return f.getLocation()}};var J=function(){},Co={CLOCKWISE:{configurable:!0},RIGHT:{configurable:!0},COUNTERCLOCKWISE:{configurable:!0},LEFT:{configurable:!0},COLLINEAR:{configurable:!0},STRAIGHT:{configurable:!0}};J.prototype.interfaces_=function(){return[]};J.prototype.getClass=function(){return J};J.orientationIndex=function(t,r,n){return sn.orientationIndex(t,r,n)};J.signedArea=function(){if(arguments[0]instanceof Array){var t=arguments[0];if(t.length<3)return 0;for(var r=0,n=t[0].x,i=1;i<t.length-1;i++){var s=t[i].x-n,a=t[i+1].y,o=t[i-1].y;r+=s*(o-a)}return r/2}else if(pe(arguments[0],Be)){var u=arguments[0],f=u.size();if(f<3)return 0;var l=new V,c=new V,h=new V;u.getCoordinate(0,c),u.getCoordinate(1,h);var d=c.x;h.x-=d;for(var m=0,g=1;g<f-1;g++)l.y=c.y,c.x=h.x,c.y=h.y,u.getCoordinate(g+1,h),h.x-=d,m+=c.x*(l.y-h.y);return m/2}};J.distanceLineLine=function(t,r,n,i){if(t.equals(r))return J.distancePointLine(t,n,i);if(n.equals(i))return J.distancePointLine(i,t,r);var s=!1;if(!ae.intersects(t,r,n,i))s=!0;else{var a=(r.x-t.x)*(i.y-n.y)-(r.y-t.y)*(i.x-n.x);if(a===0)s=!0;else{var o=(t.y-n.y)*(i.x-n.x)-(t.x-n.x)*(i.y-n.y),u=(t.y-n.y)*(r.x-t.x)-(t.x-n.x)*(r.y-t.y),f=u/a,l=o/a;(l<0||l>1||f<0||f>1)&&(s=!0)}}return s?In.min(J.distancePointLine(t,n,i),J.distancePointLine(r,n,i),J.distancePointLine(n,t,r),J.distancePointLine(i,t,r)):0};J.isPointInRing=function(t,r){return J.locatePointInRing(t,r)!==z.EXTERIOR};J.computeLength=function(t){var r=t.size();if(r<=1)return 0;var n=0,i=new V;t.getCoordinate(0,i);for(var s=i.x,a=i.y,o=1;o<r;o++){t.getCoordinate(o,i);var u=i.x,f=i.y,l=u-s,c=f-a;n+=Math.sqrt(l*l+c*c),s=u,a=f}return n};J.isCCW=function(t){var r=t.length-1;if(r<3)throw new zt("Ring has fewer than 4 points, so orientation cannot be determined");for(var n=t[0],i=0,s=1;s<=r;s++){var a=t[s];a.y>n.y&&(n=a,i=s)}var o=i;do o=o-1,o<0&&(o=r);while(t[o].equals2D(n)&&o!==i);var u=i;do u=(u+1)%r;while(t[u].equals2D(n)&&u!==i);var f=t[o],l=t[u];if(f.equals2D(n)||l.equals2D(n)||f.equals2D(l))return!1;var c=J.computeOrientation(f,n,l),h=!1;return c===0?h=f.x>l.x:h=c>0,h};J.locatePointInRing=function(t,r){return _i.locatePointInRing(t,r)};J.distancePointLinePerpendicular=function(t,r,n){var i=(n.x-r.x)*(n.x-r.x)+(n.y-r.y)*(n.y-r.y),s=((r.y-t.y)*(n.x-r.x)-(r.x-t.x)*(n.y-r.y))/i;return Math.abs(s)*Math.sqrt(i)};J.computeOrientation=function(t,r,n){return J.orientationIndex(t,r,n)};J.distancePointLine=function(){if(arguments.length===2){var t=arguments[0],r=arguments[1];if(r.length===0)throw new zt("Line array must contain at least one vertex");for(var n=t.distance(r[0]),i=0;i<r.length-1;i++){var s=J.distancePointLine(t,r[i],r[i+1]);s<n&&(n=s)}return n}else if(arguments.length===3){var a=arguments[0],o=arguments[1],u=arguments[2];if(o.x===u.x&&o.y===u.y)return a.distance(o);var f=(u.x-o.x)*(u.x-o.x)+(u.y-o.y)*(u.y-o.y),l=((a.x-o.x)*(u.x-o.x)+(a.y-o.y)*(u.y-o.y))/f;if(l<=0)return a.distance(o);if(l>=1)return a.distance(u);var c=((o.y-a.y)*(u.x-o.x)-(o.x-a.x)*(u.y-o.y))/f;return Math.abs(c)*Math.sqrt(f)}};J.isOnLine=function(t,r){for(var n=new Oa,i=1;i<r.length;i++){var s=r[i-1],a=r[i];if(n.computeIntersection(t,s,a),n.hasIntersection())return!0}return!1};Co.CLOCKWISE.get=function(){return-1};Co.RIGHT.get=function(){return J.CLOCKWISE};Co.COUNTERCLOCKWISE.get=function(){return 1};Co.LEFT.get=function(){return J.COUNTERCLOCKWISE};Co.COLLINEAR.get=function(){return 0};Co.STRAIGHT.get=function(){return J.COLLINEAR};Object.defineProperties(J,Co);var ms=function(){};ms.prototype.filter=function(t){};ms.prototype.interfaces_=function(){return[]};ms.prototype.getClass=function(){return ms};var me=function(){var t=arguments[0];this._envelope=null,this._factory=null,this._SRID=null,this._userData=null,this._factory=t,this._SRID=t.getSRID()},Zi={serialVersionUID:{configurable:!0},SORTINDEX_POINT:{configurable:!0},SORTINDEX_MULTIPOINT:{configurable:!0},SORTINDEX_LINESTRING:{configurable:!0},SORTINDEX_LINEARRING:{configurable:!0},SORTINDEX_MULTILINESTRING:{configurable:!0},SORTINDEX_POLYGON:{configurable:!0},SORTINDEX_MULTIPOLYGON:{configurable:!0},SORTINDEX_GEOMETRYCOLLECTION:{configurable:!0},geometryChangedFilter:{configurable:!0}};me.prototype.isGeometryCollection=function(){return this.getSortIndex()===me.SORTINDEX_GEOMETRYCOLLECTION};me.prototype.getFactory=function(){return this._factory};me.prototype.getGeometryN=function(t){return this};me.prototype.getArea=function(){return 0};me.prototype.isRectangle=function(){return!1};me.prototype.equals=function(){if(arguments[0]instanceof me){var t=arguments[0];return t===null?!1:this.equalsTopo(t)}else if(arguments[0]instanceof Object){var r=arguments[0];if(!(r instanceof me))return!1;var n=r;return this.equalsExact(n)}};me.prototype.equalsExact=function(t){return this===t||this.equalsExact(t,0)};me.prototype.geometryChanged=function(){this.apply(me.geometryChangedFilter)};me.prototype.geometryChangedAction=function(){this._envelope=null};me.prototype.equalsNorm=function(t){return t===null?!1:this.norm().equalsExact(t.norm())};me.prototype.getLength=function(){return 0};me.prototype.getNumGeometries=function(){return 1};me.prototype.compareTo=function(){if(arguments.length===1){var t=arguments[0],r=t;return this.getSortIndex()!==r.getSortIndex()?this.getSortIndex()-r.getSortIndex():this.isEmpty()&&r.isEmpty()?0:this.isEmpty()?-1:r.isEmpty()?1:this.compareToSameClass(t)}else if(arguments.length===2){var n=arguments[0],i=arguments[1];return this.getSortIndex()!==n.getSortIndex()?this.getSortIndex()-n.getSortIndex():this.isEmpty()&&n.isEmpty()?0:this.isEmpty()?-1:n.isEmpty()?1:this.compareToSameClass(n,i)}};me.prototype.getUserData=function(){return this._userData};me.prototype.getSRID=function(){return this._SRID};me.prototype.getEnvelope=function(){return this.getFactory().toGeometry(this.getEnvelopeInternal())};me.prototype.checkNotGeometryCollection=function(t){if(t.getSortIndex()===me.SORTINDEX_GEOMETRYCOLLECTION)throw new zt("This method does not support GeometryCollection arguments")};me.prototype.equal=function(t,r,n){return n===0?t.equals(r):t.distance(r)<=n};me.prototype.norm=function(){var t=this.copy();return t.normalize(),t};me.prototype.getPrecisionModel=function(){return this._factory.getPrecisionModel()};me.prototype.getEnvelopeInternal=function(){return this._envelope===null&&(this._envelope=this.computeEnvelopeInternal()),new ae(this._envelope)};me.prototype.setSRID=function(t){this._SRID=t};me.prototype.setUserData=function(t){this._userData=t};me.prototype.compare=function(t,r){for(var n=t.iterator(),i=r.iterator();n.hasNext()&&i.hasNext();){var s=n.next(),a=i.next(),o=s.compareTo(a);if(o!==0)return o}return n.hasNext()?1:i.hasNext()?-1:0};me.prototype.hashCode=function(){return this.getEnvelopeInternal().hashCode()};me.prototype.isGeometryCollectionOrDerived=function(){return this.getSortIndex()===me.SORTINDEX_GEOMETRYCOLLECTION||this.getSortIndex()===me.SORTINDEX_MULTIPOINT||this.getSortIndex()===me.SORTINDEX_MULTILINESTRING||this.getSortIndex()===me.SORTINDEX_MULTIPOLYGON};me.prototype.interfaces_=function(){return[Zc,Hn,Wn]};me.prototype.getClass=function(){return me};me.hasNonEmptyElements=function(t){for(var r=0;r<t.length;r++)if(!t[r].isEmpty())return!0;return!1};me.hasNullElements=function(t){for(var r=0;r<t.length;r++)if(t[r]===null)return!0;return!1};Zi.serialVersionUID.get=function(){return 8763622679187377e3};Zi.SORTINDEX_POINT.get=function(){return 0};Zi.SORTINDEX_MULTIPOINT.get=function(){return 1};Zi.SORTINDEX_LINESTRING.get=function(){return 2};Zi.SORTINDEX_LINEARRING.get=function(){return 3};Zi.SORTINDEX_MULTILINESTRING.get=function(){return 4};Zi.SORTINDEX_POLYGON.get=function(){return 5};Zi.SORTINDEX_MULTIPOLYGON.get=function(){return 6};Zi.SORTINDEX_GEOMETRYCOLLECTION.get=function(){return 7};Zi.geometryChangedFilter.get=function(){return Pp};Object.defineProperties(me,Zi);var Pp=function(){};Pp.interfaces_=function(){return[ms]};Pp.filter=function(t){t.geometryChangedAction()};var Ui=function(){};Ui.prototype.filter=function(t){};Ui.prototype.interfaces_=function(){return[]};Ui.prototype.getClass=function(){return Ui};var Un=function(){},ys={Mod2BoundaryNodeRule:{configurable:!0},EndPointBoundaryNodeRule:{configurable:!0},MultiValentEndPointBoundaryNodeRule:{configurable:!0},MonoValentEndPointBoundaryNodeRule:{configurable:!0},MOD2_BOUNDARY_RULE:{configurable:!0},ENDPOINT_BOUNDARY_RULE:{configurable:!0},MULTIVALENT_ENDPOINT_BOUNDARY_RULE:{configurable:!0},MONOVALENT_ENDPOINT_BOUNDARY_RULE:{configurable:!0},OGC_SFS_BOUNDARY_RULE:{configurable:!0}};Un.prototype.isInBoundary=function(t){};Un.prototype.interfaces_=function(){return[]};Un.prototype.getClass=function(){return Un};ys.Mod2BoundaryNodeRule.get=function(){return nu};ys.EndPointBoundaryNodeRule.get=function(){return iu};ys.MultiValentEndPointBoundaryNodeRule.get=function(){return su};ys.MonoValentEndPointBoundaryNodeRule.get=function(){return au};ys.MOD2_BOUNDARY_RULE.get=function(){return new nu};ys.ENDPOINT_BOUNDARY_RULE.get=function(){return new iu};ys.MULTIVALENT_ENDPOINT_BOUNDARY_RULE.get=function(){return new su};ys.MONOVALENT_ENDPOINT_BOUNDARY_RULE.get=function(){return new au};ys.OGC_SFS_BOUNDARY_RULE.get=function(){return Un.MOD2_BOUNDARY_RULE};Object.defineProperties(Un,ys);var nu=function(){};nu.prototype.isInBoundary=function(t){return t%2===1};nu.prototype.interfaces_=function(){return[Un]};nu.prototype.getClass=function(){return nu};var iu=function(){};iu.prototype.isInBoundary=function(t){return t>0};iu.prototype.interfaces_=function(){return[Un]};iu.prototype.getClass=function(){return iu};var su=function(){};su.prototype.isInBoundary=function(t){return t>1};su.prototype.interfaces_=function(){return[Un]};su.prototype.getClass=function(){return su};var au=function(){};au.prototype.isInBoundary=function(t){return t===1};au.prototype.interfaces_=function(){return[Un]};au.prototype.getClass=function(){return au};var ar=function(){};ar.prototype.add=function(){};ar.prototype.addAll=function(){};ar.prototype.isEmpty=function(){};ar.prototype.iterator=function(){};ar.prototype.size=function(){};ar.prototype.toArray=function(){};ar.prototype.remove=function(){};var vN=function(e){function t(n){e.call(this),this.message=n||""}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var r={name:{configurable:!0}};return r.name.get=function(){return"IndexOutOfBoundsException"},Object.defineProperties(t,r),t}(Error),Tu=function(){};Tu.prototype.hasNext=function(){};Tu.prototype.next=function(){};Tu.prototype.remove=function(){};var Zn=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.get=function(){},t.prototype.set=function(){},t.prototype.isEmpty=function(){},t}(ar);function Iu(e){this.message=e||""}Iu.prototype=new Error;Iu.prototype.name="NoSuchElementException";var Q=function(e){function t(){e.call(this),this.array_=[],arguments[0]instanceof ar&&this.addAll(arguments[0])}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.ensureCapacity=function(){},t.prototype.interfaces_=function(){return[e,ar]},t.prototype.add=function(n){return arguments.length===1?this.array_.push(n):this.array_.splice(arguments[0],arguments[1]),!0},t.prototype.clear=function(){this.array_=[]},t.prototype.addAll=function(n){for(var i=this,s=n.iterator();s.hasNext();)i.add(s.next());return!0},t.prototype.set=function(n,i){var s=this.array_[n];return this.array_[n]=i,s},t.prototype.iterator=function(){return new _N(this)},t.prototype.get=function(n){if(n<0||n>=this.size())throw new vN;return this.array_[n]},t.prototype.isEmpty=function(){return this.array_.length===0},t.prototype.size=function(){return this.array_.length},t.prototype.toArray=function(){for(var n=this,i=[],s=0,a=this.array_.length;s<a;s++)i.push(n.array_[s]);return i},t.prototype.remove=function(n){for(var i=this,s=!1,a=0,o=this.array_.length;a<o;a++)if(i.array_[a]===n){i.array_.splice(a,1),s=!0;break}return s},t}(Zn),_N=function(e){function t(r){e.call(this),this.arrayList_=r,this.position_=0}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.next=function(){if(this.position_===this.arrayList_.size())throw new Iu;return this.arrayList_.get(this.position_++)},t.prototype.hasNext=function(){return this.position_<this.arrayList_.size()},t.prototype.set=function(n){return this.arrayList_.set(this.position_-1,n)},t.prototype.remove=function(){this.arrayList_.remove(this.arrayList_.get(this.position_))},t}(Tu),rl=function(e){function t(){if(e.call(this),arguments.length!==0){if(arguments.length===1){var n=arguments[0];this.ensureCapacity(n.length),this.add(n,!0)}else if(arguments.length===2){var i=arguments[0],s=arguments[1];this.ensureCapacity(i.length),this.add(i,s)}}}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var r={coordArrayType:{configurable:!0}};return r.coordArrayType.get=function(){return new Array(0).fill(null)},t.prototype.getCoordinate=function(i){return this.get(i)},t.prototype.addAll=function(){var i=this;if(arguments.length===2){for(var s=arguments[0],a=arguments[1],o=!1,u=s.iterator();u.hasNext();)i.add(u.next(),a),o=!0;return o}else return e.prototype.addAll.apply(this,arguments)},t.prototype.clone=function(){for(var i=this,s=e.prototype.clone.call(this),a=0;a<this.size();a++)s.add(a,i.get(a).copy());return s},t.prototype.toCoordinateArray=function(){return this.toArray(t.coordArrayType)},t.prototype.add=function(){var i=this;if(arguments.length===1){var s=arguments[0];e.prototype.add.call(this,s)}else if(arguments.length===2){if(arguments[0]instanceof Array&&typeof arguments[1]=="boolean"){var a=arguments[0],o=arguments[1];return this.add(a,o,!0),!0}else if(arguments[0]instanceof V&&typeof arguments[1]=="boolean"){var u=arguments[0],f=arguments[1];if(!f&&this.size()>=1){var l=this.get(this.size()-1);if(l.equals2D(u))return null}e.prototype.add.call(this,u)}else if(arguments[0]instanceof Object&&typeof arguments[1]=="boolean"){var c=arguments[0],h=arguments[1];return this.add(c,h),!0}}else if(arguments.length===3){if(typeof arguments[2]=="boolean"&&arguments[0]instanceof Array&&typeof arguments[1]=="boolean"){var d=arguments[0],m=arguments[1],g=arguments[2];if(g)for(var p=0;p<d.length;p++)i.add(d[p],m);else for(var v=d.length-1;v>=0;v--)i.add(d[v],m);return!0}else if(typeof arguments[2]=="boolean"&&Number.isInteger(arguments[0])&&arguments[1]instanceof V){var _=arguments[0],y=arguments[1],x=arguments[2];if(!x){var E=this.size();if(E>0){if(_>0){var S=this.get(_-1);if(S.equals2D(y))return null}if(_<E){var I=this.get(_);if(I.equals2D(y))return null}}}e.prototype.add.call(this,_,y)}}else if(arguments.length===4){var P=arguments[0],w=arguments[1],N=arguments[2],B=arguments[3],C=1;N>B&&(C=-1);for(var b=N;b!==B;b+=C)i.add(P[b],w);return!0}},t.prototype.closeRing=function(){this.size()>0&&this.add(new V(this.get(0)),!1)},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},Object.defineProperties(t,r),t}(Q),Me=function(){},$c={ForwardComparator:{configurable:!0},BidirectionalComparator:{configurable:!0},coordArrayType:{configurable:!0}};$c.ForwardComparator.get=function(){return Nf};$c.BidirectionalComparator.get=function(){return ou};$c.coordArrayType.get=function(){return new Array(0).fill(null)};Me.prototype.interfaces_=function(){return[]};Me.prototype.getClass=function(){return Me};Me.isRing=function(t){return!(t.length<4||!t[0].equals2D(t[t.length-1]))};Me.ptNotInList=function(t,r){for(var n=0;n<t.length;n++){var i=t[n];if(Me.indexOf(i,r)<0)return i}return null};Me.scroll=function(t,r){var n=Me.indexOf(r,t);if(n<0)return null;var i=new Array(t.length).fill(null);br.arraycopy(t,n,i,0,t.length-n),br.arraycopy(t,0,i,t.length-n,n),br.arraycopy(i,0,t,0,t.length)};Me.equals=function(){if(arguments.length===2){var t=arguments[0],r=arguments[1];if(t===r)return!0;if(t===null||r===null||t.length!==r.length)return!1;for(var n=0;n<t.length;n++)if(!t[n].equals(r[n]))return!1;return!0}else if(arguments.length===3){var i=arguments[0],s=arguments[1],a=arguments[2];if(i===s)return!0;if(i===null||s===null||i.length!==s.length)return!1;for(var o=0;o<i.length;o++)if(a.compare(i[o],s[o])!==0)return!1;return!0}};Me.intersection=function(t,r){for(var n=new rl,i=0;i<t.length;i++)r.intersects(t[i])&&n.add(t[i],!0);return n.toCoordinateArray()};Me.hasRepeatedPoints=function(t){for(var r=1;r<t.length;r++)if(t[r-1].equals(t[r]))return!0;return!1};Me.removeRepeatedPoints=function(t){if(!Me.hasRepeatedPoints(t))return t;var r=new rl(t,!1);return r.toCoordinateArray()};Me.reverse=function(t){for(var r=t.length-1,n=Math.trunc(r/2),i=0;i<=n;i++){var s=t[i];t[i]=t[r-i],t[r-i]=s}};Me.removeNull=function(t){for(var r=0,n=0;n<t.length;n++)t[n]!==null&&r++;var i=new Array(r).fill(null);if(r===0)return i;for(var s=0,a=0;a<t.length;a++)t[a]!==null&&(i[s++]=t[a]);return i};Me.copyDeep=function(){if(arguments.length===1){for(var t=arguments[0],r=new Array(t.length).fill(null),n=0;n<t.length;n++)r[n]=new V(t[n]);return r}else if(arguments.length===5)for(var i=arguments[0],s=arguments[1],a=arguments[2],o=arguments[3],u=arguments[4],f=0;f<u;f++)a[o+f]=new V(i[s+f])};Me.isEqualReversed=function(t,r){for(var n=0;n<t.length;n++){var i=t[n],s=r[t.length-n-1];if(i.compareTo(s)!==0)return!1}return!0};Me.envelope=function(t){for(var r=new ae,n=0;n<t.length;n++)r.expandToInclude(t[n]);return r};Me.toCoordinateArray=function(t){return t.toArray(Me.coordArrayType)};Me.atLeastNCoordinatesOrNothing=function(t,r){return r.length>=t?r:[]};Me.indexOf=function(t,r){for(var n=0;n<r.length;n++)if(t.equals(r[n]))return n;return-1};Me.increasingDirection=function(t){for(var r=0;r<Math.trunc(t.length/2);r++){var n=t.length-1-r,i=t[r].compareTo(t[n]);if(i!==0)return i}return 1};Me.compare=function(t,r){for(var n=0;n<t.length&&n<r.length;){var i=t[n].compareTo(r[n]);if(i!==0)return i;n++}return n<r.length?-1:n<t.length?1:0};Me.minCoordinate=function(t){for(var r=null,n=0;n<t.length;n++)(r===null||r.compareTo(t[n])>0)&&(r=t[n]);return r};Me.extract=function(t,r,n){r=In.clamp(r,0,t.length),n=In.clamp(n,-1,t.length);var i=n-r+1;n<0&&(i=0),r>=t.length&&(i=0),n<r&&(i=0);var s=new Array(i).fill(null);if(i===0)return s;for(var a=0,o=r;o<=n;o++)s[a++]=t[o];return s};Object.defineProperties(Me,$c);var Nf=function(){};Nf.prototype.compare=function(t,r){var n=t,i=r;return Me.compare(n,i)};Nf.prototype.interfaces_=function(){return[tu]};Nf.prototype.getClass=function(){return Nf};var ou=function(){};ou.prototype.compare=function(t,r){var n=t,i=r;if(n.length<i.length)return-1;if(n.length>i.length)return 1;if(n.length===0)return 0;var s=Me.compare(n,i),a=Me.isEqualReversed(n,i);return a?0:s};ou.prototype.OLDcompare=function(t,r){var n=t,i=r;if(n.length<i.length)return-1;if(n.length>i.length)return 1;if(n.length===0)return 0;for(var s=Me.increasingDirection(n),a=Me.increasingDirection(i),o=s>0?0:n.length-1,u=a>0?0:n.length-1,f=0;f<n.length;f++){var l=n[o].compareTo(i[u]);if(l!==0)return l;o+=s,u+=a}return 0};ou.prototype.interfaces_=function(){return[tu]};ou.prototype.getClass=function(){return ou};var yo=function(){};yo.prototype.get=function(){};yo.prototype.put=function(){};yo.prototype.size=function(){};yo.prototype.values=function(){};yo.prototype.entrySet=function(){};var CN=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t}(yo);function nl(e){this.message=e||""}nl.prototype=new Error;nl.prototype.name="OperationNotSupported";function eh(){}eh.prototype=new ar;eh.prototype.contains=function(){};var Mp=function(e){function t(){e.call(this),this.array_=[],arguments[0]instanceof ar&&this.addAll(arguments[0])}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.contains=function(n){for(var i=this,s=0,a=this.array_.length;s<a;s++){var o=i.array_[s];if(o===n)return!0}return!1},t.prototype.add=function(n){return this.contains(n)?!1:(this.array_.push(n),!0)},t.prototype.addAll=function(n){for(var i=this,s=n.iterator();s.hasNext();)i.add(s.next());return!0},t.prototype.remove=function(n){throw new Error},t.prototype.size=function(){return this.array_.length},t.prototype.isEmpty=function(){return this.array_.length===0},t.prototype.toArray=function(){for(var n=this,i=[],s=0,a=this.array_.length;s<a;s++)i.push(n.array_[s]);return i},t.prototype.iterator=function(){return new yN(this)},t}(eh),yN=function(e){function t(r){e.call(this),this.hashSet_=r,this.position_=0}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.next=function(){if(this.position_===this.hashSet_.size())throw new Iu;return this.hashSet_.array_[this.position_++]},t.prototype.hasNext=function(){return this.position_<this.hashSet_.size()},t.prototype.remove=function(){throw new nl},t}(Tu),os=0,ga=1;function ay(e){return e===null?os:e.color}function Dt(e){return e===null?null:e.parent}function is(e,t){e!==null&&(e.color=t)}function Pm(e){return e===null?null:e.left}function oy(e){return e===null?null:e.right}function Or(){this.root_=null,this.size_=0}Or.prototype=new CN;Or.prototype.get=function(e){for(var t=this.root_;t!==null;){var r=e.compareTo(t.key);if(r<0)t=t.left;else if(r>0)t=t.right;else return t.value}return null};Or.prototype.put=function(e,t){if(this.root_===null)return this.root_={key:e,value:t,left:null,right:null,parent:null,color:os,getValue:function(){return this.value},getKey:function(){return this.key}},this.size_=1,null;var r=this.root_,n,i;do if(n=r,i=e.compareTo(r.key),i<0)r=r.left;else if(i>0)r=r.right;else{var s=r.value;return r.value=t,s}while(r!==null);var a={key:e,left:null,right:null,value:t,parent:n,color:os,getValue:function(){return this.value},getKey:function(){return this.key}};return i<0?n.left=a:n.right=a,this.fixAfterInsertion(a),this.size_++,null};Or.prototype.fixAfterInsertion=function(e){var t=this;for(e.color=ga;e!=null&&e!==this.root_&&e.parent.color===ga;)if(Dt(e)===Pm(Dt(Dt(e)))){var r=oy(Dt(Dt(e)));ay(r)===ga?(is(Dt(e),os),is(r,os),is(Dt(Dt(e)),ga),e=Dt(Dt(e))):(e===oy(Dt(e))&&(e=Dt(e),t.rotateLeft(e)),is(Dt(e),os),is(Dt(Dt(e)),ga),t.rotateRight(Dt(Dt(e))))}else{var n=Pm(Dt(Dt(e)));ay(n)===ga?(is(Dt(e),os),is(n,os),is(Dt(Dt(e)),ga),e=Dt(Dt(e))):(e===Pm(Dt(e))&&(e=Dt(e),t.rotateRight(e)),is(Dt(e),os),is(Dt(Dt(e)),ga),t.rotateLeft(Dt(Dt(e))))}this.root_.color=os};Or.prototype.values=function(){var e=new Q,t=this.getFirstEntry();if(t!==null)for(e.add(t.value);(t=Or.successor(t))!==null;)e.add(t.value);return e};Or.prototype.entrySet=function(){var e=new Mp,t=this.getFirstEntry();if(t!==null)for(e.add(t);(t=Or.successor(t))!==null;)e.add(t);return e};Or.prototype.rotateLeft=function(e){if(e!=null){var t=e.right;e.right=t.left,t.left!=null&&(t.left.parent=e),t.parent=e.parent,e.parent===null?this.root_=t:e.parent.left===e?e.parent.left=t:e.parent.right=t,t.left=e,e.parent=t}};Or.prototype.rotateRight=function(e){if(e!=null){var t=e.left;e.left=t.right,t.right!=null&&(t.right.parent=e),t.parent=e.parent,e.parent===null?this.root_=t:e.parent.right===e?e.parent.right=t:e.parent.left=t,t.right=e,e.parent=t}};Or.prototype.getFirstEntry=function(){var e=this.root_;if(e!=null)for(;e.left!=null;)e=e.left;return e};Or.successor=function(e){if(e===null)return null;if(e.right!==null){for(var t=e.right;t.left!==null;)t=t.left;return t}else{for(var r=e.parent,n=e;r!==null&&n===r.right;)n=r,r=r.parent;return r}};Or.prototype.size=function(){return this.size_};var Ff=function(){};Ff.prototype.interfaces_=function(){return[]};Ff.prototype.getClass=function(){return Ff};function Z0(){}Z0.prototype=new eh;function xi(){this.array_=[],arguments[0]instanceof ar&&this.addAll(arguments[0])}xi.prototype=new Z0;xi.prototype.contains=function(e){for(var t=this,r=0,n=this.array_.length;r<n;r++){var i=t.array_[r];if(i.compareTo(e)===0)return!0}return!1};xi.prototype.add=function(e){var t=this;if(this.contains(e))return!1;for(var r=0,n=this.array_.length;r<n;r++){var i=t.array_[r];if(i.compareTo(e)===1)return t.array_.splice(r,0,e),!0}return this.array_.push(e),!0};xi.prototype.addAll=function(e){for(var t=this,r=e.iterator();r.hasNext();)t.add(r.next());return!0};xi.prototype.remove=function(e){throw new nl};xi.prototype.size=function(){return this.array_.length};xi.prototype.isEmpty=function(){return this.array_.length===0};xi.prototype.toArray=function(){for(var e=this,t=[],r=0,n=this.array_.length;r<n;r++)t.push(e.array_[r]);return t};xi.prototype.iterator=function(){return new th(this)};var th=function(e){this.treeSet_=e,this.position_=0};th.prototype.next=function(){if(this.position_===this.treeSet_.size())throw new Iu;return this.treeSet_.array_[this.position_++]};th.prototype.hasNext=function(){return this.position_<this.treeSet_.size()};th.prototype.remove=function(){throw new nl};var ya=function(){};ya.sort=function(){var t=arguments[0],r,n,i,s;if(arguments.length===1)s=function(o,u){return o.compareTo(u)},t.sort(s);else if(arguments.length===2)i=arguments[1],s=function(o,u){return i.compare(o,u)},t.sort(s);else if(arguments.length===3){n=t.slice(arguments[1],arguments[2]),n.sort();var a=t.slice(0,arguments[1]).concat(n,t.slice(arguments[2],t.length));for(t.splice(0,t.length),r=0;r<a.length;r++)t.push(a[r])}else if(arguments.length===4)for(n=t.slice(arguments[1],arguments[2]),i=arguments[3],s=function(o,u){return i.compare(o,u)},n.sort(s),a=t.slice(0,arguments[1]).concat(n,t.slice(arguments[2],t.length)),t.splice(0,t.length),r=0;r<a.length;r++)t.push(a[r])};ya.asList=function(t){for(var r=new Q,n=0,i=t.length;n<i;n++)r.add(t[n]);return r};var mt=function(){},ai={P:{configurable:!0},L:{configurable:!0},A:{configurable:!0},FALSE:{configurable:!0},TRUE:{configurable:!0},DONTCARE:{configurable:!0},SYM_FALSE:{configurable:!0},SYM_TRUE:{configurable:!0},SYM_DONTCARE:{configurable:!0},SYM_P:{configurable:!0},SYM_L:{configurable:!0},SYM_A:{configurable:!0}};ai.P.get=function(){return 0};ai.L.get=function(){return 1};ai.A.get=function(){return 2};ai.FALSE.get=function(){return-1};ai.TRUE.get=function(){return-2};ai.DONTCARE.get=function(){return-3};ai.SYM_FALSE.get=function(){return"F"};ai.SYM_TRUE.get=function(){return"T"};ai.SYM_DONTCARE.get=function(){return"*"};ai.SYM_P.get=function(){return"0"};ai.SYM_L.get=function(){return"1"};ai.SYM_A.get=function(){return"2"};mt.prototype.interfaces_=function(){return[]};mt.prototype.getClass=function(){return mt};mt.toDimensionSymbol=function(t){switch(t){case mt.FALSE:return mt.SYM_FALSE;case mt.TRUE:return mt.SYM_TRUE;case mt.DONTCARE:return mt.SYM_DONTCARE;case mt.P:return mt.SYM_P;case mt.L:return mt.SYM_L;case mt.A:return mt.SYM_A;default:}throw new zt("Unknown dimension value: "+t)};mt.toDimensionValue=function(t){switch(Of.toUpperCase(t)){case mt.SYM_FALSE:return mt.FALSE;case mt.SYM_TRUE:return mt.TRUE;case mt.SYM_DONTCARE:return mt.DONTCARE;case mt.SYM_P:return mt.P;case mt.SYM_L:return mt.L;case mt.SYM_A:return mt.A;default:}throw new zt("Unknown dimension symbol: "+t)};Object.defineProperties(mt,ai);var Ei=function(){};Ei.prototype.filter=function(t){};Ei.prototype.interfaces_=function(){return[]};Ei.prototype.getClass=function(){return Ei};var $n=function(){};$n.prototype.filter=function(t,r){};$n.prototype.isDone=function(){};$n.prototype.isGeometryChanged=function(){};$n.prototype.interfaces_=function(){return[]};$n.prototype.getClass=function(){return $n};var Qr=function(e){function t(n,i){if(e.call(this,i),this._geometries=n||[],e.hasNullElements(this._geometries))throw new zt("geometries must not contain null elements")}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var r={serialVersionUID:{configurable:!0}};return t.prototype.computeEnvelopeInternal=function(){for(var i=this,s=new ae,a=0;a<this._geometries.length;a++)s.expandToInclude(i._geometries[a].getEnvelopeInternal());return s},t.prototype.getGeometryN=function(i){return this._geometries[i]},t.prototype.getSortIndex=function(){return e.SORTINDEX_GEOMETRYCOLLECTION},t.prototype.getCoordinates=function(){for(var i=this,s=new Array(this.getNumPoints()).fill(null),a=-1,o=0;o<this._geometries.length;o++)for(var u=i._geometries[o].getCoordinates(),f=0;f<u.length;f++)a++,s[a]=u[f];return s},t.prototype.getArea=function(){for(var i=this,s=0,a=0;a<this._geometries.length;a++)s+=i._geometries[a].getArea();return s},t.prototype.equalsExact=function(){var i=this;if(arguments.length===2){var s=arguments[0],a=arguments[1];if(!this.isEquivalentClass(s))return!1;var o=s;if(this._geometries.length!==o._geometries.length)return!1;for(var u=0;u<this._geometries.length;u++)if(!i._geometries[u].equalsExact(o._geometries[u],a))return!1;return!0}else return e.prototype.equalsExact.apply(this,arguments)},t.prototype.normalize=function(){for(var i=this,s=0;s<this._geometries.length;s++)i._geometries[s].normalize();ya.sort(this._geometries)},t.prototype.getCoordinate=function(){return this.isEmpty()?null:this._geometries[0].getCoordinate()},t.prototype.getBoundaryDimension=function(){for(var i=this,s=mt.FALSE,a=0;a<this._geometries.length;a++)s=Math.max(s,i._geometries[a].getBoundaryDimension());return s},t.prototype.getDimension=function(){for(var i=this,s=mt.FALSE,a=0;a<this._geometries.length;a++)s=Math.max(s,i._geometries[a].getDimension());return s},t.prototype.getLength=function(){for(var i=this,s=0,a=0;a<this._geometries.length;a++)s+=i._geometries[a].getLength();return s},t.prototype.getNumPoints=function(){for(var i=this,s=0,a=0;a<this._geometries.length;a++)s+=i._geometries[a].getNumPoints();return s},t.prototype.getNumGeometries=function(){return this._geometries.length},t.prototype.reverse=function(){for(var i=this,s=this._geometries.length,a=new Array(s).fill(null),o=0;o<this._geometries.length;o++)a[o]=i._geometries[o].reverse();return this.getFactory().createGeometryCollection(a)},t.prototype.compareToSameClass=function(){var i=this;if(arguments.length===1){var s=arguments[0],a=new xi(ya.asList(this._geometries)),o=new xi(ya.asList(s._geometries));return this.compare(a,o)}else if(arguments.length===2){for(var u=arguments[0],f=arguments[1],l=u,c=this.getNumGeometries(),h=l.getNumGeometries(),d=0;d<c&&d<h;){var m=i.getGeometryN(d),g=l.getGeometryN(d),p=m.compareToSameClass(g,f);if(p!==0)return p;d++}return d<c?1:d<h?-1:0}},t.prototype.apply=function(){var i=this;if(pe(arguments[0],Ui))for(var s=arguments[0],a=0;a<this._geometries.length;a++)i._geometries[a].apply(s);else if(pe(arguments[0],$n)){var o=arguments[0];if(this._geometries.length===0)return null;for(var u=0;u<this._geometries.length&&(i._geometries[u].apply(o),!o.isDone());u++);o.isGeometryChanged()&&this.geometryChanged()}else if(pe(arguments[0],Ei)){var f=arguments[0];f.filter(this);for(var l=0;l<this._geometries.length;l++)i._geometries[l].apply(f)}else if(pe(arguments[0],ms)){var c=arguments[0];c.filter(this);for(var h=0;h<this._geometries.length;h++)i._geometries[h].apply(c)}},t.prototype.getBoundary=function(){return this.checkNotGeometryCollection(this),we.shouldNeverReachHere(),null},t.prototype.clone=function(){var i=this,s=e.prototype.clone.call(this);s._geometries=new Array(this._geometries.length).fill(null);for(var a=0;a<this._geometries.length;a++)s._geometries[a]=i._geometries[a].clone();return s},t.prototype.getGeometryType=function(){return"GeometryCollection"},t.prototype.copy=function(){for(var i=this,s=new Array(this._geometries.length).fill(null),a=0;a<s.length;a++)s[a]=i._geometries[a].copy();return new t(s,this._factory)},t.prototype.isEmpty=function(){for(var i=this,s=0;s<this._geometries.length;s++)if(!i._geometries[s].isEmpty())return!1;return!0},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},r.serialVersionUID.get=function(){return-5694727726395021e3},Object.defineProperties(t,r),t}(me),wa=function(e){function t(){e.apply(this,arguments)}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var r={serialVersionUID:{configurable:!0}};return t.prototype.getSortIndex=function(){return me.SORTINDEX_MULTILINESTRING},t.prototype.equalsExact=function(){if(arguments.length===2){var i=arguments[0],s=arguments[1];return this.isEquivalentClass(i)?e.prototype.equalsExact.call(this,i,s):!1}else return e.prototype.equalsExact.apply(this,arguments)},t.prototype.getBoundaryDimension=function(){return this.isClosed()?mt.FALSE:0},t.prototype.isClosed=function(){var i=this;if(this.isEmpty())return!1;for(var s=0;s<this._geometries.length;s++)if(!i._geometries[s].isClosed())return!1;return!0},t.prototype.getDimension=function(){return 1},t.prototype.reverse=function(){for(var i=this,s=this._geometries.length,a=new Array(s).fill(null),o=0;o<this._geometries.length;o++)a[s-1-o]=i._geometries[o].reverse();return this.getFactory().createMultiLineString(a)},t.prototype.getBoundary=function(){return new Vn(this).getBoundary()},t.prototype.getGeometryType=function(){return"MultiLineString"},t.prototype.copy=function(){for(var i=this,s=new Array(this._geometries.length).fill(null),a=0;a<s.length;a++)s[a]=i._geometries[a].copy();return new t(s,this._factory)},t.prototype.interfaces_=function(){return[Ff]},t.prototype.getClass=function(){return t},r.serialVersionUID.get=function(){return 8166665132445434e3},Object.defineProperties(t,r),t}(Qr),Vn=function(){if(this._geom=null,this._geomFact=null,this._bnRule=null,this._endpointMap=null,arguments.length===1){var t=arguments[0],r=Un.MOD2_BOUNDARY_RULE;this._geom=t,this._geomFact=t.getFactory(),this._bnRule=r}else if(arguments.length===2){var n=arguments[0],i=arguments[1];this._geom=n,this._geomFact=n.getFactory(),this._bnRule=i}};Vn.prototype.boundaryMultiLineString=function(t){if(this._geom.isEmpty())return this.getEmptyMultiPoint();var r=this.computeBoundaryCoordinates(t);return r.length===1?this._geomFact.createPoint(r[0]):this._geomFact.createMultiPointFromCoords(r)};Vn.prototype.getBoundary=function(){return this._geom instanceof Wt?this.boundaryLineString(this._geom):this._geom instanceof wa?this.boundaryMultiLineString(this._geom):this._geom.getBoundary()};Vn.prototype.boundaryLineString=function(t){if(this._geom.isEmpty())return this.getEmptyMultiPoint();if(t.isClosed()){var r=this._bnRule.isInBoundary(2);return r?t.getStartPoint():this._geomFact.createMultiPoint()}return this._geomFact.createMultiPoint([t.getStartPoint(),t.getEndPoint()])};Vn.prototype.getEmptyMultiPoint=function(){return this._geomFact.createMultiPoint()};Vn.prototype.computeBoundaryCoordinates=function(t){var r=this,n=new Q;this._endpointMap=new Or;for(var i=0;i<t.getNumGeometries();i++){var s=t.getGeometryN(i);s.getNumPoints()!==0&&(r.addEndpoint(s.getCoordinateN(0)),r.addEndpoint(s.getCoordinateN(s.getNumPoints()-1)))}for(var a=this._endpointMap.entrySet().iterator();a.hasNext();){var o=a.next(),u=o.getValue(),f=u.count;r._bnRule.isInBoundary(f)&&n.add(o.getKey())}return Me.toCoordinateArray(n)};Vn.prototype.addEndpoint=function(t){var r=this._endpointMap.get(t);r===null&&(r=new Pc,this._endpointMap.put(t,r)),r.count++};Vn.prototype.interfaces_=function(){return[]};Vn.prototype.getClass=function(){return Vn};Vn.getBoundary=function(){if(arguments.length===1){var t=arguments[0],r=new Vn(t);return r.getBoundary()}else if(arguments.length===2){var n=arguments[0],i=arguments[1],s=new Vn(n,i);return s.getBoundary()}};var Pc=function(){this.count=null};Pc.prototype.interfaces_=function(){return[]};Pc.prototype.getClass=function(){return Pc};function xN(){}function EN(){}var bN=function(){};function wN(){}function SN(){}function TN(){}var zn=function(){},Ap={NEWLINE:{configurable:!0},SIMPLE_ORDINATE_FORMAT:{configurable:!0}};zn.prototype.interfaces_=function(){return[]};zn.prototype.getClass=function(){return zn};zn.chars=function(t,r){for(var n=new Array(r).fill(null),i=0;i<r;i++)n[i]=t;return String(n)};zn.getStackTrace=function(){if(arguments.length===1){var t=arguments[0],r=new wN,n=new xN(r);return t.printStackTrace(n),r.toString()}else if(arguments.length===2){for(var i=arguments[0],s=arguments[1],a="",o=new EN(zn.getStackTrace(i)),u=new TN(o),f=0;f<s;f++)try{a+=u.readLine()+zn.NEWLINE}catch(l){if(l instanceof SN)we.shouldNeverReachHere();else throw l}finally{}return a}};zn.split=function(t,r){for(var n=r.length,i=new Q,s=""+t,a=s.indexOf(r);a>=0;){var o=s.substring(0,a);i.add(o),s=s.substring(a+n),a=s.indexOf(r)}s.length>0&&i.add(s);for(var u=new Array(i.size()).fill(null),f=0;f<u.length;f++)u[f]=i.get(f);return u};zn.toString=function(){if(arguments.length===1){var t=arguments[0];return zn.SIMPLE_ORDINATE_FORMAT.format(t)}};zn.spaces=function(t){return zn.chars(" ",t)};Ap.NEWLINE.get=function(){return br.getProperty("line.separator")};Ap.SIMPLE_ORDINATE_FORMAT.get=function(){return new bN("0.#")};Object.defineProperties(zn,Ap);var Zt=function(){};Zt.prototype.interfaces_=function(){return[]};Zt.prototype.getClass=function(){return Zt};Zt.copyCoord=function(t,r,n,i){for(var s=Math.min(t.getDimension(),n.getDimension()),a=0;a<s;a++)n.setOrdinate(i,a,t.getOrdinate(r,a))};Zt.isRing=function(t){var r=t.size();return r===0?!0:r<=3?!1:t.getOrdinate(0,Be.X)===t.getOrdinate(r-1,Be.X)&&t.getOrdinate(0,Be.Y)===t.getOrdinate(r-1,Be.Y)};Zt.isEqual=function(t,r){var n=t.size(),i=r.size();if(n!==i)return!1;for(var s=Math.min(t.getDimension(),r.getDimension()),a=0;a<n;a++)for(var o=0;o<s;o++){var u=t.getOrdinate(a,o),f=r.getOrdinate(a,o);if(t.getOrdinate(a,o)!==r.getOrdinate(a,o)&&!(Ee.isNaN(u)&&Ee.isNaN(f)))return!1}return!0};Zt.extend=function(t,r,n){var i=t.create(n,r.getDimension()),s=r.size();if(Zt.copy(r,0,i,0,s),s>0)for(var a=s;a<n;a++)Zt.copy(r,s-1,i,a,1);return i};Zt.reverse=function(t){for(var r=t.size()-1,n=Math.trunc(r/2),i=0;i<=n;i++)Zt.swap(t,i,r-i)};Zt.swap=function(t,r,n){if(r===n)return null;for(var i=0;i<t.getDimension();i++){var s=t.getOrdinate(r,i);t.setOrdinate(r,i,t.getOrdinate(n,i)),t.setOrdinate(n,i,s)}};Zt.copy=function(t,r,n,i,s){for(var a=0;a<s;a++)Zt.copyCoord(t,r+a,n,i+a)};Zt.toString=function(){if(arguments.length===1){var t=arguments[0],r=t.size();if(r===0)return"()";var n=t.getDimension(),i=new Ai;i.append("(");for(var s=0;s<r;s++){s>0&&i.append(" ");for(var a=0;a<n;a++)a>0&&i.append(","),i.append(zn.toString(t.getOrdinate(s,a)))}return i.append(")"),i.toString()}};Zt.ensureValidRing=function(t,r){var n=r.size();if(n===0)return r;if(n<=3)return Zt.createClosedRing(t,r,4);var i=r.getOrdinate(0,Be.X)===r.getOrdinate(n-1,Be.X)&&r.getOrdinate(0,Be.Y)===r.getOrdinate(n-1,Be.Y);return i?r:Zt.createClosedRing(t,r,n+1)};Zt.createClosedRing=function(t,r,n){var i=t.create(n,r.getDimension()),s=r.size();Zt.copy(r,0,i,0,s);for(var a=s;a<n;a++)Zt.copy(r,0,i,a,1);return i};var Wt=function(e){function t(n,i){e.call(this,i),this._points=null,this.init(n)}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var r={serialVersionUID:{configurable:!0}};return t.prototype.computeEnvelopeInternal=function(){return this.isEmpty()?new ae:this._points.expandEnvelope(new ae)},t.prototype.isRing=function(){return this.isClosed()&&this.isSimple()},t.prototype.getSortIndex=function(){return e.SORTINDEX_LINESTRING},t.prototype.getCoordinates=function(){return this._points.toCoordinateArray()},t.prototype.equalsExact=function(){var i=this;if(arguments.length===2){var s=arguments[0],a=arguments[1];if(!this.isEquivalentClass(s))return!1;var o=s;if(this._points.size()!==o._points.size())return!1;for(var u=0;u<this._points.size();u++)if(!i.equal(i._points.getCoordinate(u),o._points.getCoordinate(u),a))return!1;return!0}else return e.prototype.equalsExact.apply(this,arguments)},t.prototype.normalize=function(){for(var i=this,s=0;s<Math.trunc(this._points.size()/2);s++){var a=i._points.size()-1-s;if(!i._points.getCoordinate(s).equals(i._points.getCoordinate(a)))return i._points.getCoordinate(s).compareTo(i._points.getCoordinate(a))>0&&Zt.reverse(i._points),null}},t.prototype.getCoordinate=function(){return this.isEmpty()?null:this._points.getCoordinate(0)},t.prototype.getBoundaryDimension=function(){return this.isClosed()?mt.FALSE:0},t.prototype.isClosed=function(){return this.isEmpty()?!1:this.getCoordinateN(0).equals2D(this.getCoordinateN(this.getNumPoints()-1))},t.prototype.getEndPoint=function(){return this.isEmpty()?null:this.getPointN(this.getNumPoints()-1)},t.prototype.getDimension=function(){return 1},t.prototype.getLength=function(){return J.computeLength(this._points)},t.prototype.getNumPoints=function(){return this._points.size()},t.prototype.reverse=function(){var i=this._points.copy();Zt.reverse(i);var s=this.getFactory().createLineString(i);return s},t.prototype.compareToSameClass=function(){var i=this;if(arguments.length===1){for(var s=arguments[0],a=s,o=0,u=0;o<this._points.size()&&u<a._points.size();){var f=i._points.getCoordinate(o).compareTo(a._points.getCoordinate(u));if(f!==0)return f;o++,u++}return o<this._points.size()?1:u<a._points.size()?-1:0}else if(arguments.length===2){var l=arguments[0],c=arguments[1],h=l;return c.compare(this._points,h._points)}},t.prototype.apply=function(){var i=this;if(pe(arguments[0],Ui))for(var s=arguments[0],a=0;a<this._points.size();a++)s.filter(i._points.getCoordinate(a));else if(pe(arguments[0],$n)){var o=arguments[0];if(this._points.size()===0)return null;for(var u=0;u<this._points.size()&&(o.filter(i._points,u),!o.isDone());u++);o.isGeometryChanged()&&this.geometryChanged()}else if(pe(arguments[0],Ei)){var f=arguments[0];f.filter(this)}else if(pe(arguments[0],ms)){var l=arguments[0];l.filter(this)}},t.prototype.getBoundary=function(){return new Vn(this).getBoundary()},t.prototype.isEquivalentClass=function(i){return i instanceof t},t.prototype.clone=function(){var i=e.prototype.clone.call(this);return i._points=this._points.clone(),i},t.prototype.getCoordinateN=function(i){return this._points.getCoordinate(i)},t.prototype.getGeometryType=function(){return"LineString"},t.prototype.copy=function(){return new t(this._points.copy(),this._factory)},t.prototype.getCoordinateSequence=function(){return this._points},t.prototype.isEmpty=function(){return this._points.size()===0},t.prototype.init=function(i){if(i===null&&(i=this.getFactory().getCoordinateSequenceFactory().create([])),i.size()===1)throw new zt("Invalid number of points in LineString (found "+i.size()+" - must be 0 or >= 2)");this._points=i},t.prototype.isCoordinate=function(i){for(var s=this,a=0;a<this._points.size();a++)if(s._points.getCoordinate(a).equals(i))return!0;return!1},t.prototype.getStartPoint=function(){return this.isEmpty()?null:this.getPointN(0)},t.prototype.getPointN=function(i){return this.getFactory().createPoint(this._points.getCoordinate(i))},t.prototype.interfaces_=function(){return[Ff]},t.prototype.getClass=function(){return t},r.serialVersionUID.get=function(){return 0x2b2b51ba435c8e00},Object.defineProperties(t,r),t}(me),Bf=function(){};Bf.prototype.interfaces_=function(){return[]};Bf.prototype.getClass=function(){return Bf};var gn=function(e){function t(n,i){e.call(this,i),this._coordinates=n||null,this.init(this._coordinates)}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var r={serialVersionUID:{configurable:!0}};return t.prototype.computeEnvelopeInternal=function(){if(this.isEmpty())return new ae;var i=new ae;return i.expandToInclude(this._coordinates.getX(0),this._coordinates.getY(0)),i},t.prototype.getSortIndex=function(){return e.SORTINDEX_POINT},t.prototype.getCoordinates=function(){return this.isEmpty()?[]:[this.getCoordinate()]},t.prototype.equalsExact=function(){if(arguments.length===2){var i=arguments[0],s=arguments[1];return this.isEquivalentClass(i)?this.isEmpty()&&i.isEmpty()?!0:this.isEmpty()!==i.isEmpty()?!1:this.equal(i.getCoordinate(),this.getCoordinate(),s):!1}else return e.prototype.equalsExact.apply(this,arguments)},t.prototype.normalize=function(){},t.prototype.getCoordinate=function(){return this._coordinates.size()!==0?this._coordinates.getCoordinate(0):null},t.prototype.getBoundaryDimension=function(){return mt.FALSE},t.prototype.getDimension=function(){return 0},t.prototype.getNumPoints=function(){return this.isEmpty()?0:1},t.prototype.reverse=function(){return this.copy()},t.prototype.getX=function(){if(this.getCoordinate()===null)throw new Error("getX called on empty Point");return this.getCoordinate().x},t.prototype.compareToSameClass=function(){if(arguments.length===1){var i=arguments[0],s=i;return this.getCoordinate().compareTo(s.getCoordinate())}else if(arguments.length===2){var a=arguments[0],o=arguments[1],u=a;return o.compare(this._coordinates,u._coordinates)}},t.prototype.apply=function(){if(pe(arguments[0],Ui)){var i=arguments[0];if(this.isEmpty())return null;i.filter(this.getCoordinate())}else if(pe(arguments[0],$n)){var s=arguments[0];if(this.isEmpty())return null;s.filter(this._coordinates,0),s.isGeometryChanged()&&this.geometryChanged()}else if(pe(arguments[0],Ei)){var a=arguments[0];a.filter(this)}else if(pe(arguments[0],ms)){var o=arguments[0];o.filter(this)}},t.prototype.getBoundary=function(){return this.getFactory().createGeometryCollection(null)},t.prototype.clone=function(){var i=e.prototype.clone.call(this);return i._coordinates=this._coordinates.clone(),i},t.prototype.getGeometryType=function(){return"Point"},t.prototype.copy=function(){return new t(this._coordinates.copy(),this._factory)},t.prototype.getCoordinateSequence=function(){return this._coordinates},t.prototype.getY=function(){if(this.getCoordinate()===null)throw new Error("getY called on empty Point");return this.getCoordinate().y},t.prototype.isEmpty=function(){return this._coordinates.size()===0},t.prototype.init=function(i){i===null&&(i=this.getFactory().getCoordinateSequenceFactory().create([])),we.isTrue(i.size()<=1),this._coordinates=i},t.prototype.isSimple=function(){return!0},t.prototype.interfaces_=function(){return[Bf]},t.prototype.getClass=function(){return t},r.serialVersionUID.get=function(){return 4902022702746615e3},Object.defineProperties(t,r),t}(me),Us=function(){};Us.prototype.interfaces_=function(){return[]};Us.prototype.getClass=function(){return Us};var fr=function(e){function t(n,i,s){if(e.call(this,s),this._shell=null,this._holes=null,n===null&&(n=this.getFactory().createLinearRing()),i===null&&(i=[]),e.hasNullElements(i))throw new zt("holes must not contain null elements");if(n.isEmpty()&&e.hasNonEmptyElements(i))throw new zt("shell is empty but holes are not");this._shell=n,this._holes=i}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var r={serialVersionUID:{configurable:!0}};return t.prototype.computeEnvelopeInternal=function(){return this._shell.getEnvelopeInternal()},t.prototype.getSortIndex=function(){return e.SORTINDEX_POLYGON},t.prototype.getCoordinates=function(){var i=this;if(this.isEmpty())return[];for(var s=new Array(this.getNumPoints()).fill(null),a=-1,o=this._shell.getCoordinates(),u=0;u<o.length;u++)a++,s[a]=o[u];for(var f=0;f<this._holes.length;f++)for(var l=i._holes[f].getCoordinates(),c=0;c<l.length;c++)a++,s[a]=l[c];return s},t.prototype.getArea=function(){var i=this,s=0;s+=Math.abs(J.signedArea(this._shell.getCoordinateSequence()));for(var a=0;a<this._holes.length;a++)s-=Math.abs(J.signedArea(i._holes[a].getCoordinateSequence()));return s},t.prototype.isRectangle=function(){if(this.getNumInteriorRing()!==0||this._shell===null||this._shell.getNumPoints()!==5)return!1;for(var i=this._shell.getCoordinateSequence(),s=this.getEnvelopeInternal(),a=0;a<5;a++){var o=i.getX(a);if(!(o===s.getMinX()||o===s.getMaxX()))return!1;var u=i.getY(a);if(!(u===s.getMinY()||u===s.getMaxY()))return!1}for(var f=i.getX(0),l=i.getY(0),c=1;c<=4;c++){var h=i.getX(c),d=i.getY(c),m=h!==f,g=d!==l;if(m===g)return!1;f=h,l=d}return!0},t.prototype.equalsExact=function(){var i=this;if(arguments.length===2){var s=arguments[0],a=arguments[1];if(!this.isEquivalentClass(s))return!1;var o=s,u=this._shell,f=o._shell;if(!u.equalsExact(f,a)||this._holes.length!==o._holes.length)return!1;for(var l=0;l<this._holes.length;l++)if(!i._holes[l].equalsExact(o._holes[l],a))return!1;return!0}else return e.prototype.equalsExact.apply(this,arguments)},t.prototype.normalize=function(){var i=this;if(arguments.length===0){this.normalize(this._shell,!0);for(var s=0;s<this._holes.length;s++)i.normalize(i._holes[s],!1);ya.sort(this._holes)}else if(arguments.length===2){var a=arguments[0],o=arguments[1];if(a.isEmpty())return null;var u=new Array(a.getCoordinates().length-1).fill(null);br.arraycopy(a.getCoordinates(),0,u,0,u.length);var f=Me.minCoordinate(a.getCoordinates());Me.scroll(u,f),br.arraycopy(u,0,a.getCoordinates(),0,u.length),a.getCoordinates()[u.length]=u[0],J.isCCW(a.getCoordinates())===o&&Me.reverse(a.getCoordinates())}},t.prototype.getCoordinate=function(){return this._shell.getCoordinate()},t.prototype.getNumInteriorRing=function(){return this._holes.length},t.prototype.getBoundaryDimension=function(){return 1},t.prototype.getDimension=function(){return 2},t.prototype.getLength=function(){var i=this,s=0;s+=this._shell.getLength();for(var a=0;a<this._holes.length;a++)s+=i._holes[a].getLength();return s},t.prototype.getNumPoints=function(){for(var i=this,s=this._shell.getNumPoints(),a=0;a<this._holes.length;a++)s+=i._holes[a].getNumPoints();return s},t.prototype.reverse=function(){var i=this,s=this.copy();s._shell=this._shell.copy().reverse(),s._holes=new Array(this._holes.length).fill(null);for(var a=0;a<this._holes.length;a++)s._holes[a]=i._holes[a].copy().reverse();return s},t.prototype.convexHull=function(){return this.getExteriorRing().convexHull()},t.prototype.compareToSameClass=function(){var i=this;if(arguments.length===1){var s=arguments[0],a=this._shell,o=s._shell;return a.compareToSameClass(o)}else if(arguments.length===2){var u=arguments[0],f=arguments[1],l=u,c=this._shell,h=l._shell,d=c.compareToSameClass(h,f);if(d!==0)return d;for(var m=this.getNumInteriorRing(),g=l.getNumInteriorRing(),p=0;p<m&&p<g;){var v=i.getInteriorRingN(p),_=l.getInteriorRingN(p),y=v.compareToSameClass(_,f);if(y!==0)return y;p++}return p<m?1:p<g?-1:0}},t.prototype.apply=function(i){var s=this;if(pe(i,Ui)){this._shell.apply(i);for(var a=0;a<this._holes.length;a++)s._holes[a].apply(i)}else if(pe(i,$n)){if(this._shell.apply(i),!i.isDone())for(var o=0;o<this._holes.length&&(s._holes[o].apply(i),!i.isDone());o++);i.isGeometryChanged()&&this.geometryChanged()}else if(pe(i,Ei))i.filter(this);else if(pe(i,ms)){i.filter(this),this._shell.apply(i);for(var u=0;u<this._holes.length;u++)s._holes[u].apply(i)}},t.prototype.getBoundary=function(){var i=this;if(this.isEmpty())return this.getFactory().createMultiLineString();var s=new Array(this._holes.length+1).fill(null);s[0]=this._shell;for(var a=0;a<this._holes.length;a++)s[a+1]=i._holes[a];return s.length<=1?this.getFactory().createLinearRing(s[0].getCoordinateSequence()):this.getFactory().createMultiLineString(s)},t.prototype.clone=function(){var i=this,s=e.prototype.clone.call(this);s._shell=this._shell.clone(),s._holes=new Array(this._holes.length).fill(null);for(var a=0;a<this._holes.length;a++)s._holes[a]=i._holes[a].clone();return s},t.prototype.getGeometryType=function(){return"Polygon"},t.prototype.copy=function(){for(var i=this,s=this._shell.copy(),a=new Array(this._holes.length).fill(null),o=0;o<a.length;o++)a[o]=i._holes[o].copy();return new t(s,a,this._factory)},t.prototype.getExteriorRing=function(){return this._shell},t.prototype.isEmpty=function(){return this._shell.isEmpty()},t.prototype.getInteriorRingN=function(i){return this._holes[i]},t.prototype.interfaces_=function(){return[Us]},t.prototype.getClass=function(){return t},r.serialVersionUID.get=function(){return-0x307ffefd8dc97200},Object.defineProperties(t,r),t}(me),uu=function(e){function t(){e.apply(this,arguments)}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var r={serialVersionUID:{configurable:!0}};return t.prototype.getSortIndex=function(){return me.SORTINDEX_MULTIPOINT},t.prototype.isValid=function(){return!0},t.prototype.equalsExact=function(){if(arguments.length===2){var i=arguments[0],s=arguments[1];return this.isEquivalentClass(i)?e.prototype.equalsExact.call(this,i,s):!1}else return e.prototype.equalsExact.apply(this,arguments)},t.prototype.getCoordinate=function(){if(arguments.length===1){var i=arguments[0];return this._geometries[i].getCoordinate()}else return e.prototype.getCoordinate.apply(this,arguments)},t.prototype.getBoundaryDimension=function(){return mt.FALSE},t.prototype.getDimension=function(){return 0},t.prototype.getBoundary=function(){return this.getFactory().createGeometryCollection(null)},t.prototype.getGeometryType=function(){return"MultiPoint"},t.prototype.copy=function(){for(var i=this,s=new Array(this._geometries.length).fill(null),a=0;a<s.length;a++)s[a]=i._geometries[a].copy();return new t(s,this._factory)},t.prototype.interfaces_=function(){return[Bf]},t.prototype.getClass=function(){return t},r.serialVersionUID.get=function(){return-8048474874175356e3},Object.defineProperties(t,r),t}(Qr),Gi=function(e){function t(n,i){n instanceof V&&i instanceof Pe&&(n=i.getCoordinateSequenceFactory().create(n)),e.call(this,n,i),this.validateConstruction()}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var r={MINIMUM_VALID_SIZE:{configurable:!0},serialVersionUID:{configurable:!0}};return t.prototype.getSortIndex=function(){return me.SORTINDEX_LINEARRING},t.prototype.getBoundaryDimension=function(){return mt.FALSE},t.prototype.isClosed=function(){return this.isEmpty()?!0:e.prototype.isClosed.call(this)},t.prototype.reverse=function(){var i=this._points.copy();Zt.reverse(i);var s=this.getFactory().createLinearRing(i);return s},t.prototype.validateConstruction=function(){if(!this.isEmpty()&&!e.prototype.isClosed.call(this))throw new zt("Points of LinearRing do not form a closed linestring");if(this.getCoordinateSequence().size()>=1&&this.getCoordinateSequence().size()<t.MINIMUM_VALID_SIZE)throw new zt("Invalid number of points in LinearRing (found "+this.getCoordinateSequence().size()+" - must be 0 or >= 4)")},t.prototype.getGeometryType=function(){return"LinearRing"},t.prototype.copy=function(){return new t(this._points.copy(),this._factory)},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},r.MINIMUM_VALID_SIZE.get=function(){return 4},r.serialVersionUID.get=function(){return-0x3b229e262367a600},Object.defineProperties(t,r),t}(Wt),zi=function(e){function t(){e.apply(this,arguments)}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var r={serialVersionUID:{configurable:!0}};return t.prototype.getSortIndex=function(){return me.SORTINDEX_MULTIPOLYGON},t.prototype.equalsExact=function(){if(arguments.length===2){var i=arguments[0],s=arguments[1];return this.isEquivalentClass(i)?e.prototype.equalsExact.call(this,i,s):!1}else return e.prototype.equalsExact.apply(this,arguments)},t.prototype.getBoundaryDimension=function(){return 1},t.prototype.getDimension=function(){return 2},t.prototype.reverse=function(){for(var i=this,s=this._geometries.length,a=new Array(s).fill(null),o=0;o<this._geometries.length;o++)a[o]=i._geometries[o].reverse();return this.getFactory().createMultiPolygon(a)},t.prototype.getBoundary=function(){var i=this;if(this.isEmpty())return this.getFactory().createMultiLineString();for(var s=new Q,a=0;a<this._geometries.length;a++)for(var o=i._geometries[a],u=o.getBoundary(),f=0;f<u.getNumGeometries();f++)s.add(u.getGeometryN(f));var l=new Array(s.size()).fill(null);return this.getFactory().createMultiLineString(s.toArray(l))},t.prototype.getGeometryType=function(){return"MultiPolygon"},t.prototype.copy=function(){for(var i=this,s=new Array(this._geometries.length).fill(null),a=0;a<s.length;a++)s[a]=i._geometries[a].copy();return new t(s,this._factory)},t.prototype.interfaces_=function(){return[Us]},t.prototype.getClass=function(){return t},r.serialVersionUID.get=function(){return-0x7a5aa1369171980},Object.defineProperties(t,r),t}(Qr),Gn=function(t){this._factory=t||null,this._isUserDataCopied=!1},rh={NoOpGeometryOperation:{configurable:!0},CoordinateOperation:{configurable:!0},CoordinateSequenceOperation:{configurable:!0}};Gn.prototype.setCopyUserData=function(t){this._isUserDataCopied=t};Gn.prototype.edit=function(t,r){if(t===null)return null;var n=this.editInternal(t,r);return this._isUserDataCopied&&n.setUserData(t.getUserData()),n};Gn.prototype.editInternal=function(t,r){return this._factory===null&&(this._factory=t.getFactory()),t instanceof Qr?this.editGeometryCollection(t,r):t instanceof fr?this.editPolygon(t,r):t instanceof gn?r.edit(t,this._factory):t instanceof Wt?r.edit(t,this._factory):(we.shouldNeverReachHere("Unsupported Geometry class: "+t.getClass().getName()),null)};Gn.prototype.editGeometryCollection=function(t,r){for(var n=this,i=r.edit(t,this._factory),s=new Q,a=0;a<i.getNumGeometries();a++){var o=n.edit(i.getGeometryN(a),r);o===null||o.isEmpty()||s.add(o)}return i.getClass()===uu?this._factory.createMultiPoint(s.toArray([])):i.getClass()===wa?this._factory.createMultiLineString(s.toArray([])):i.getClass()===zi?this._factory.createMultiPolygon(s.toArray([])):this._factory.createGeometryCollection(s.toArray([]))};Gn.prototype.editPolygon=function(t,r){var n=this,i=r.edit(t,this._factory);if(i===null&&(i=this._factory.createPolygon(null)),i.isEmpty())return i;var s=this.edit(i.getExteriorRing(),r);if(s===null||s.isEmpty())return this._factory.createPolygon();for(var a=new Q,o=0;o<i.getNumInteriorRing();o++){var u=n.edit(i.getInteriorRingN(o),r);u===null||u.isEmpty()||a.add(u)}return this._factory.createPolygon(s,a.toArray([]))};Gn.prototype.interfaces_=function(){return[]};Gn.prototype.getClass=function(){return Gn};Gn.GeometryEditorOperation=function(){};rh.NoOpGeometryOperation.get=function(){return Vf};rh.CoordinateOperation.get=function(){return zf};rh.CoordinateSequenceOperation.get=function(){return kf};Object.defineProperties(Gn,rh);var Vf=function(){};Vf.prototype.edit=function(t,r){return t};Vf.prototype.interfaces_=function(){return[Gn.GeometryEditorOperation]};Vf.prototype.getClass=function(){return Vf};var zf=function(){};zf.prototype.edit=function(t,r){var n=this.editCoordinates(t.getCoordinates(),t);return n===null?t:t instanceof Gi?r.createLinearRing(n):t instanceof Wt?r.createLineString(n):t instanceof gn?n.length>0?r.createPoint(n[0]):r.createPoint():t};zf.prototype.interfaces_=function(){return[Gn.GeometryEditorOperation]};zf.prototype.getClass=function(){return zf};var kf=function(){};kf.prototype.edit=function(t,r){return t instanceof Gi?r.createLinearRing(this.edit(t.getCoordinateSequence(),t)):t instanceof Wt?r.createLineString(this.edit(t.getCoordinateSequence(),t)):t instanceof gn?r.createPoint(this.edit(t.getCoordinateSequence(),t)):t};kf.prototype.interfaces_=function(){return[Gn.GeometryEditorOperation]};kf.prototype.getClass=function(){return kf};var Kt=function(){var t=this;if(this._dimension=3,this._coordinates=null,arguments.length===1){if(arguments[0]instanceof Array)this._coordinates=arguments[0],this._dimension=3;else if(Number.isInteger(arguments[0])){var r=arguments[0];this._coordinates=new Array(r).fill(null);for(var n=0;n<r;n++)t._coordinates[n]=new V}else if(pe(arguments[0],Be)){var i=arguments[0];if(i===null)return this._coordinates=new Array(0).fill(null),null;this._dimension=i.getDimension(),this._coordinates=new Array(i.size()).fill(null);for(var s=0;s<this._coordinates.length;s++)t._coordinates[s]=i.getCoordinateCopy(s)}}else if(arguments.length===2){if(arguments[0]instanceof Array&&Number.isInteger(arguments[1])){var a=arguments[0],o=arguments[1];this._coordinates=a,this._dimension=o,a===null&&(this._coordinates=new Array(0).fill(null))}else if(Number.isInteger(arguments[0])&&Number.isInteger(arguments[1])){var u=arguments[0],f=arguments[1];this._coordinates=new Array(u).fill(null),this._dimension=f;for(var l=0;l<u;l++)t._coordinates[l]=new V}}},J0={serialVersionUID:{configurable:!0}};Kt.prototype.setOrdinate=function(t,r,n){switch(r){case Be.X:this._coordinates[t].x=n;break;case Be.Y:this._coordinates[t].y=n;break;case Be.Z:this._coordinates[t].z=n;break;default:throw new zt("invalid ordinateIndex")}};Kt.prototype.size=function(){return this._coordinates.length};Kt.prototype.getOrdinate=function(t,r){switch(r){case Be.X:return this._coordinates[t].x;case Be.Y:return this._coordinates[t].y;case Be.Z:return this._coordinates[t].z;default:}return Ee.NaN};Kt.prototype.getCoordinate=function(){if(arguments.length===1){var t=arguments[0];return this._coordinates[t]}else if(arguments.length===2){var r=arguments[0],n=arguments[1];n.x=this._coordinates[r].x,n.y=this._coordinates[r].y,n.z=this._coordinates[r].z}};Kt.prototype.getCoordinateCopy=function(t){return new V(this._coordinates[t])};Kt.prototype.getDimension=function(){return this._dimension};Kt.prototype.getX=function(t){return this._coordinates[t].x};Kt.prototype.clone=function(){for(var t=this,r=new Array(this.size()).fill(null),n=0;n<this._coordinates.length;n++)r[n]=t._coordinates[n].clone();return new Kt(r,this._dimension)};Kt.prototype.expandEnvelope=function(t){for(var r=this,n=0;n<this._coordinates.length;n++)t.expandToInclude(r._coordinates[n]);return t};Kt.prototype.copy=function(){for(var t=this,r=new Array(this.size()).fill(null),n=0;n<this._coordinates.length;n++)r[n]=t._coordinates[n].copy();return new Kt(r,this._dimension)};Kt.prototype.toString=function(){var t=this;if(this._coordinates.length>0){var r=new Ai(17*this._coordinates.length);r.append("("),r.append(this._coordinates[0]);for(var n=1;n<this._coordinates.length;n++)r.append(", "),r.append(t._coordinates[n]);return r.append(")"),r.toString()}else return"()"};Kt.prototype.getY=function(t){return this._coordinates[t].y};Kt.prototype.toCoordinateArray=function(){return this._coordinates};Kt.prototype.interfaces_=function(){return[Be,Wn]};Kt.prototype.getClass=function(){return Kt};J0.serialVersionUID.get=function(){return-0xcb44a778db18e00};Object.defineProperties(Kt,J0);var qi=function(){},Dp={serialVersionUID:{configurable:!0},instanceObject:{configurable:!0}};qi.prototype.readResolve=function(){return qi.instance()};qi.prototype.create=function(){if(arguments.length===1){if(arguments[0]instanceof Array){var t=arguments[0];return new Kt(t)}else if(pe(arguments[0],Be)){var r=arguments[0];return new Kt(r)}}else if(arguments.length===2){var n=arguments[0],i=arguments[1];return i>3&&(i=3),i<2?new Kt(n):new Kt(n,i)}};qi.prototype.interfaces_=function(){return[ru,Wn]};qi.prototype.getClass=function(){return qi};qi.instance=function(){return qi.instanceObject};Dp.serialVersionUID.get=function(){return-0x38e49fa6cf6f2e00};Dp.instanceObject.get=function(){return new qi};Object.defineProperties(qi,Dp);var $0=function(e){function t(){e.call(this),this.map_=new Map}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.get=function(n){return this.map_.get(n)||null},t.prototype.put=function(n,i){return this.map_.set(n,i),i},t.prototype.values=function(){for(var n=new Q,i=this.map_.values(),s=i.next();!s.done;)n.add(s.value),s=i.next();return n},t.prototype.entrySet=function(){var n=new Mp;return this.map_.entries().forEach(function(i){return n.add(i)}),n},t.prototype.size=function(){return this.map_.size()},t}(yo),vt=function e(){if(this._modelType=null,this._scale=null,arguments.length===0)this._modelType=e.FLOATING;else if(arguments.length===1){if(arguments[0]instanceof bi){var t=arguments[0];this._modelType=t,t===e.FIXED&&this.setScale(1)}else if(typeof arguments[0]=="number"){var r=arguments[0];this._modelType=e.FIXED,this.setScale(r)}else if(arguments[0]instanceof e){var n=arguments[0];this._modelType=n._modelType,this._scale=n._scale}}},Rp={serialVersionUID:{configurable:!0},maximumPreciseValue:{configurable:!0}};vt.prototype.equals=function(t){if(!(t instanceof vt))return!1;var r=t;return this._modelType===r._modelType&&this._scale===r._scale};vt.prototype.compareTo=function(t){var r=t,n=this.getMaximumSignificantDigits(),i=r.getMaximumSignificantDigits();return new yi(n).compareTo(new yi(i))};vt.prototype.getScale=function(){return this._scale};vt.prototype.isFloating=function(){return this._modelType===vt.FLOATING||this._modelType===vt.FLOATING_SINGLE};vt.prototype.getType=function(){return this._modelType};vt.prototype.toString=function(){var t="UNKNOWN";return this._modelType===vt.FLOATING?t="Floating":this._modelType===vt.FLOATING_SINGLE?t="Floating-Single":this._modelType===vt.FIXED&&(t="Fixed (Scale="+this.getScale()+")"),t};vt.prototype.makePrecise=function(){if(typeof arguments[0]=="number"){var t=arguments[0];if(Ee.isNaN(t))return t;if(this._modelType===vt.FLOATING_SINGLE){var r=t;return r}return this._modelType===vt.FIXED?Math.round(t*this._scale)/this._scale:t}else if(arguments[0]instanceof V){var n=arguments[0];if(this._modelType===vt.FLOATING)return null;n.x=this.makePrecise(n.x),n.y=this.makePrecise(n.y)}};vt.prototype.getMaximumSignificantDigits=function(){var t=16;return this._modelType===vt.FLOATING?t=16:this._modelType===vt.FLOATING_SINGLE?t=6:this._modelType===vt.FIXED&&(t=1+Math.trunc(Math.ceil(Math.log(this.getScale())/Math.log(10)))),t};vt.prototype.setScale=function(t){this._scale=Math.abs(t)};vt.prototype.interfaces_=function(){return[Wn,Hn]};vt.prototype.getClass=function(){return vt};vt.mostPrecise=function(t,r){return t.compareTo(r)>=0?t:r};Rp.serialVersionUID.get=function(){return 7777263578777804e3};Rp.maximumPreciseValue.get=function(){return 9007199254740992};Object.defineProperties(vt,Rp);var bi=function e(t){this._name=t||null,e.nameToTypeMap.put(t,this)},Op={serialVersionUID:{configurable:!0},nameToTypeMap:{configurable:!0}};bi.prototype.readResolve=function(){return bi.nameToTypeMap.get(this._name)};bi.prototype.toString=function(){return this._name};bi.prototype.interfaces_=function(){return[Wn]};bi.prototype.getClass=function(){return bi};Op.serialVersionUID.get=function(){return-552860263173159e4};Op.nameToTypeMap.get=function(){return new $0};Object.defineProperties(bi,Op);vt.Type=bi;vt.FIXED=new bi("FIXED");vt.FLOATING=new bi("FLOATING");vt.FLOATING_SINGLE=new bi("FLOATING SINGLE");var Pe=function e(){this._precisionModel=new vt,this._SRID=0,this._coordinateSequenceFactory=e.getDefaultCoordinateSequenceFactory(),arguments.length===0||(arguments.length===1?pe(arguments[0],ru)?this._coordinateSequenceFactory=arguments[0]:arguments[0]instanceof vt&&(this._precisionModel=arguments[0]):arguments.length===2?(this._precisionModel=arguments[0],this._SRID=arguments[1]):arguments.length===3&&(this._precisionModel=arguments[0],this._SRID=arguments[1],this._coordinateSequenceFactory=arguments[2]))},ex={serialVersionUID:{configurable:!0}};Pe.prototype.toGeometry=function(t){return t.isNull()?this.createPoint(null):t.getMinX()===t.getMaxX()&&t.getMinY()===t.getMaxY()?this.createPoint(new V(t.getMinX(),t.getMinY())):t.getMinX()===t.getMaxX()||t.getMinY()===t.getMaxY()?this.createLineString([new V(t.getMinX(),t.getMinY()),new V(t.getMaxX(),t.getMaxY())]):this.createPolygon(this.createLinearRing([new V(t.getMinX(),t.getMinY()),new V(t.getMinX(),t.getMaxY()),new V(t.getMaxX(),t.getMaxY()),new V(t.getMaxX(),t.getMinY()),new V(t.getMinX(),t.getMinY())]),null)};Pe.prototype.createLineString=function(t){if(t){if(t instanceof Array)return new Wt(this.getCoordinateSequenceFactory().create(t),this);if(pe(t,Be))return new Wt(t,this)}else return new Wt(this.getCoordinateSequenceFactory().create([]),this)};Pe.prototype.createMultiLineString=function(){if(arguments.length===0)return new wa(null,this);if(arguments.length===1){var t=arguments[0];return new wa(t,this)}};Pe.prototype.buildGeometry=function(t){for(var r=null,n=!1,i=!1,s=t.iterator();s.hasNext();){var a=s.next(),o=a.getClass();r===null&&(r=o),o!==r&&(n=!0),a.isGeometryCollectionOrDerived()&&(i=!0)}if(r===null)return this.createGeometryCollection();if(n||i)return this.createGeometryCollection(Pe.toGeometryArray(t));var u=t.iterator().next(),f=t.size()>1;if(f){if(u instanceof fr)return this.createMultiPolygon(Pe.toPolygonArray(t));if(u instanceof Wt)return this.createMultiLineString(Pe.toLineStringArray(t));if(u instanceof gn)return this.createMultiPoint(Pe.toPointArray(t));we.shouldNeverReachHere("Unhandled class: "+u.getClass().getName())}return u};Pe.prototype.createMultiPointFromCoords=function(t){return this.createMultiPoint(t!==null?this.getCoordinateSequenceFactory().create(t):null)};Pe.prototype.createPoint=function(){if(arguments.length===0)return this.createPoint(this.getCoordinateSequenceFactory().create([]));if(arguments.length===1){if(arguments[0]instanceof V){var t=arguments[0];return this.createPoint(t!==null?this.getCoordinateSequenceFactory().create([t]):null)}else if(pe(arguments[0],Be)){var r=arguments[0];return new gn(r,this)}}};Pe.prototype.getCoordinateSequenceFactory=function(){return this._coordinateSequenceFactory};Pe.prototype.createPolygon=function(){if(arguments.length===0)return new fr(null,null,this);if(arguments.length===1){if(pe(arguments[0],Be)){var t=arguments[0];return this.createPolygon(this.createLinearRing(t))}else if(arguments[0]instanceof Array){var r=arguments[0];return this.createPolygon(this.createLinearRing(r))}else if(arguments[0]instanceof Gi){var n=arguments[0];return this.createPolygon(n,null)}}else if(arguments.length===2){var i=arguments[0],s=arguments[1];return new fr(i,s,this)}};Pe.prototype.getSRID=function(){return this._SRID};Pe.prototype.createGeometryCollection=function(){if(arguments.length===0)return new Qr(null,this);if(arguments.length===1){var t=arguments[0];return new Qr(t,this)}};Pe.prototype.createGeometry=function(t){var r=new Gn(this);return r.edit(t,{edit:function(){if(arguments.length===2){var n=arguments[0];return this._coordinateSequenceFactory.create(n)}}})};Pe.prototype.getPrecisionModel=function(){return this._precisionModel};Pe.prototype.createLinearRing=function(){if(arguments.length===0)return this.createLinearRing(this.getCoordinateSequenceFactory().create([]));if(arguments.length===1){if(arguments[0]instanceof Array){var t=arguments[0];return this.createLinearRing(t!==null?this.getCoordinateSequenceFactory().create(t):null)}else if(pe(arguments[0],Be)){var r=arguments[0];return new Gi(r,this)}}};Pe.prototype.createMultiPolygon=function(){if(arguments.length===0)return new zi(null,this);if(arguments.length===1){var t=arguments[0];return new zi(t,this)}};Pe.prototype.createMultiPoint=function(){var t=this;if(arguments.length===0)return new uu(null,this);if(arguments.length===1){if(arguments[0]instanceof Array){var r=arguments[0];return new uu(r,this)}else if(arguments[0]instanceof Array){var n=arguments[0];return this.createMultiPoint(n!==null?this.getCoordinateSequenceFactory().create(n):null)}else if(pe(arguments[0],Be)){var i=arguments[0];if(i===null)return this.createMultiPoint(new Array(0).fill(null));for(var s=new Array(i.size()).fill(null),a=0;a<i.size();a++){var o=t.getCoordinateSequenceFactory().create(1,i.getDimension());Zt.copy(i,a,o,0,1),s[a]=t.createPoint(o)}return this.createMultiPoint(s)}}};Pe.prototype.interfaces_=function(){return[Wn]};Pe.prototype.getClass=function(){return Pe};Pe.toMultiPolygonArray=function(t){var r=new Array(t.size()).fill(null);return t.toArray(r)};Pe.toGeometryArray=function(t){if(t===null)return null;var r=new Array(t.size()).fill(null);return t.toArray(r)};Pe.getDefaultCoordinateSequenceFactory=function(){return qi.instance()};Pe.toMultiLineStringArray=function(t){var r=new Array(t.size()).fill(null);return t.toArray(r)};Pe.toLineStringArray=function(t){var r=new Array(t.size()).fill(null);return t.toArray(r)};Pe.toMultiPointArray=function(t){var r=new Array(t.size()).fill(null);return t.toArray(r)};Pe.toLinearRingArray=function(t){var r=new Array(t.size()).fill(null);return t.toArray(r)};Pe.toPointArray=function(t){var r=new Array(t.size()).fill(null);return t.toArray(r)};Pe.toPolygonArray=function(t){var r=new Array(t.size()).fill(null);return t.toArray(r)};Pe.createPointFromInternalCoord=function(t,r){return r.getPrecisionModel().makePrecise(t),r.getFactory().createPoint(t)};ex.serialVersionUID.get=function(){return-6820524753094096e3};Object.defineProperties(Pe,ex);var IN=["Point","MultiPoint","LineString","MultiLineString","Polygon","MultiPolygon"],nh=function(t){this.geometryFactory=t||new Pe};nh.prototype.read=function(t){var r;typeof t=="string"?r=JSON.parse(t):r=t;var n=r.type;if(!mi[n])throw new Error("Unknown GeoJSON type: "+r.type);return IN.indexOf(n)!==-1?mi[n].apply(this,[r.coordinates]):n==="GeometryCollection"?mi[n].apply(this,[r.geometries]):mi[n].apply(this,[r])};nh.prototype.write=function(t){var r=t.getGeometryType();if(!as[r])throw new Error("Geometry is not supported");return as[r].apply(this,[t])};var mi={Feature:function(e){var t={};for(var r in e)t[r]=e[r];if(e.geometry){var n=e.geometry.type;if(!mi[n])throw new Error("Unknown GeoJSON type: "+e.type);t.geometry=this.read(e.geometry)}return e.bbox&&(t.bbox=mi.bbox.apply(this,[e.bbox])),t},FeatureCollection:function(e){var t=this,r={};if(e.features){r.features=[];for(var n=0;n<e.features.length;++n)r.features.push(t.read(e.features[n]))}return e.bbox&&(r.bbox=this.parse.bbox.apply(this,[e.bbox])),r},coordinates:function(e){for(var t=[],r=0;r<e.length;++r){var n=e[r];t.push(new V(n[0],n[1]))}return t},bbox:function(e){return this.geometryFactory.createLinearRing([new V(e[0],e[1]),new V(e[2],e[1]),new V(e[2],e[3]),new V(e[0],e[3]),new V(e[0],e[1])])},Point:function(e){var t=new V(e[0],e[1]);return this.geometryFactory.createPoint(t)},MultiPoint:function(e){for(var t=this,r=[],n=0;n<e.length;++n)r.push(mi.Point.apply(t,[e[n]]));return this.geometryFactory.createMultiPoint(r)},LineString:function(e){var t=mi.coordinates.apply(this,[e]);return this.geometryFactory.createLineString(t)},MultiLineString:function(e){for(var t=this,r=[],n=0;n<e.length;++n)r.push(mi.LineString.apply(t,[e[n]]));return this.geometryFactory.createMultiLineString(r)},Polygon:function(e){for(var t=this,r=mi.coordinates.apply(this,[e[0]]),n=this.geometryFactory.createLinearRing(r),i=[],s=1;s<e.length;++s){var a=e[s],o=mi.coordinates.apply(t,[a]),u=t.geometryFactory.createLinearRing(o);i.push(u)}return this.geometryFactory.createPolygon(n,i)},MultiPolygon:function(e){for(var t=this,r=[],n=0;n<e.length;++n){var i=e[n];r.push(mi.Polygon.apply(t,[i]))}return this.geometryFactory.createMultiPolygon(r)},GeometryCollection:function(e){for(var t=this,r=[],n=0;n<e.length;++n){var i=e[n];r.push(t.read(i))}return this.geometryFactory.createGeometryCollection(r)}},as={coordinate:function(e){return[e.x,e.y]},Point:function(e){var t=as.coordinate.apply(this,[e.getCoordinate()]);return{type:"Point",coordinates:t}},MultiPoint:function(e){for(var t=this,r=[],n=0;n<e._geometries.length;++n){var i=e._geometries[n],s=as.Point.apply(t,[i]);r.push(s.coordinates)}return{type:"MultiPoint",coordinates:r}},LineString:function(e){for(var t=this,r=[],n=e.getCoordinates(),i=0;i<n.length;++i){var s=n[i];r.push(as.coordinate.apply(t,[s]))}return{type:"LineString",coordinates:r}},MultiLineString:function(e){for(var t=this,r=[],n=0;n<e._geometries.length;++n){var i=e._geometries[n],s=as.LineString.apply(t,[i]);r.push(s.coordinates)}return{type:"MultiLineString",coordinates:r}},Polygon:function(e){var t=this,r=[],n=as.LineString.apply(this,[e._shell]);r.push(n.coordinates);for(var i=0;i<e._holes.length;++i){var s=e._holes[i],a=as.LineString.apply(t,[s]);r.push(a.coordinates)}return{type:"Polygon",coordinates:r}},MultiPolygon:function(e){for(var t=this,r=[],n=0;n<e._geometries.length;++n){var i=e._geometries[n],s=as.Polygon.apply(t,[i]);r.push(s.coordinates)}return{type:"MultiPolygon",coordinates:r}},GeometryCollection:function(e){for(var t=this,r=[],n=0;n<e._geometries.length;++n){var i=e._geometries[n],s=i.getGeometryType();r.push(as[s].apply(t,[i]))}return{type:"GeometryCollection",geometries:r}}},Lu=function(t){this.geometryFactory=t||new Pe,this.precisionModel=this.geometryFactory.getPrecisionModel(),this.parser=new nh(this.geometryFactory)};Lu.prototype.read=function(t){var r=this.parser.read(t);return this.precisionModel.getType()===vt.FIXED&&this.reducePrecision(r),r};Lu.prototype.reducePrecision=function(t){var r=this,n,i;if(t.coordinate)this.precisionModel.makePrecise(t.coordinate);else if(t.points)for(n=0,i=t.points.length;n<i;n++)r.precisionModel.makePrecise(t.points[n]);else if(t.geometries)for(n=0,i=t.geometries.length;n<i;n++)r.reducePrecision(t.geometries[n])};var il=function(){this.parser=new nh(this.geometryFactory)};il.prototype.write=function(t){return this.parser.write(t)};var j=function(){},ih={ON:{configurable:!0},LEFT:{configurable:!0},RIGHT:{configurable:!0}};j.prototype.interfaces_=function(){return[]};j.prototype.getClass=function(){return j};j.opposite=function(t){return t===j.LEFT?j.RIGHT:t===j.RIGHT?j.LEFT:t};ih.ON.get=function(){return 0};ih.LEFT.get=function(){return 1};ih.RIGHT.get=function(){return 2};Object.defineProperties(j,ih);function sh(e){this.message=e||""}sh.prototype=new Error;sh.prototype.name="EmptyStackException";function Di(){this.array_=[]}Di.prototype=new Zn;Di.prototype.add=function(e){return this.array_.push(e),!0};Di.prototype.get=function(e){if(e<0||e>=this.size())throw new Error;return this.array_[e]};Di.prototype.push=function(e){return this.array_.push(e),e};Di.prototype.pop=function(e){if(this.array_.length===0)throw new sh;return this.array_.pop()};Di.prototype.peek=function(){if(this.array_.length===0)throw new sh;return this.array_[this.array_.length-1]};Di.prototype.empty=function(){return this.array_.length===0};Di.prototype.isEmpty=function(){return this.empty()};Di.prototype.search=function(e){return this.array_.indexOf(e)};Di.prototype.size=function(){return this.array_.length};Di.prototype.toArray=function(){for(var e=this,t=[],r=0,n=this.array_.length;r<n;r++)t.push(e.array_[r]);return t};var wi=function(){this._minIndex=-1,this._minCoord=null,this._minDe=null,this._orientedDe=null};wi.prototype.getCoordinate=function(){return this._minCoord};wi.prototype.getRightmostSide=function(t,r){var n=this.getRightmostSideOfSegment(t,r);return n<0&&(n=this.getRightmostSideOfSegment(t,r-1)),n<0&&(this._minCoord=null,this.checkForRightmostCoordinate(t)),n};wi.prototype.findRightmostEdgeAtVertex=function(){var t=this._minDe.getEdge().getCoordinates();we.isTrue(this._minIndex>0&&this._minIndex<t.length,"rightmost point expected to be interior vertex of edge");var r=t[this._minIndex-1],n=t[this._minIndex+1],i=J.computeOrientation(this._minCoord,n,r),s=!1;(r.y<this._minCoord.y&&n.y<this._minCoord.y&&i===J.COUNTERCLOCKWISE||r.y>this._minCoord.y&&n.y>this._minCoord.y&&i===J.CLOCKWISE)&&(s=!0),s&&(this._minIndex=this._minIndex-1)};wi.prototype.getRightmostSideOfSegment=function(t,r){var n=t.getEdge(),i=n.getCoordinates();if(r<0||r+1>=i.length||i[r].y===i[r+1].y)return-1;var s=j.LEFT;return i[r].y<i[r+1].y&&(s=j.RIGHT),s};wi.prototype.getEdge=function(){return this._orientedDe};wi.prototype.checkForRightmostCoordinate=function(t){for(var r=this,n=t.getEdge().getCoordinates(),i=0;i<n.length-1;i++)(r._minCoord===null||n[i].x>r._minCoord.x)&&(r._minDe=t,r._minIndex=i,r._minCoord=n[i])};wi.prototype.findRightmostEdgeAtNode=function(){var t=this._minDe.getNode(),r=t.getEdges();this._minDe=r.getRightmostEdge(),this._minDe.isForward()||(this._minDe=this._minDe.getSym(),this._minIndex=this._minDe.getEdge().getCoordinates().length-1)};wi.prototype.findEdge=function(t){for(var r=this,n=t.iterator();n.hasNext();){var i=n.next();i.isForward()&&r.checkForRightmostCoordinate(i)}we.isTrue(this._minIndex!==0||this._minCoord.equals(this._minDe.getCoordinate()),"inconsistency in rightmost processing"),this._minIndex===0?this.findRightmostEdgeAtNode():this.findRightmostEdgeAtVertex(),this._orientedDe=this._minDe;var s=this.getRightmostSide(this._minDe,this._minIndex);s===j.LEFT&&(this._orientedDe=this._minDe.getSym())};wi.prototype.interfaces_=function(){return[]};wi.prototype.getClass=function(){return wi};var ps=function(e){function t(r,n){e.call(this,t.msgWithCoord(r,n)),this.pt=n?new V(n):null,this.name="TopologyException"}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.getCoordinate=function(){return this.pt},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t.msgWithCoord=function(n,i){return i?n:n+" [ "+i+" ]"},t}(ds),ah=function(){this.array_=[]};ah.prototype.addLast=function(t){this.array_.push(t)};ah.prototype.removeFirst=function(){return this.array_.shift()};ah.prototype.isEmpty=function(){return this.array_.length===0};var Zr=function(){this._finder=null,this._dirEdgeList=new Q,this._nodes=new Q,this._rightMostCoord=null,this._env=null,this._finder=new wi};Zr.prototype.clearVisitedEdges=function(){for(var t=this._dirEdgeList.iterator();t.hasNext();){var r=t.next();r.setVisited(!1)}};Zr.prototype.getRightmostCoordinate=function(){return this._rightMostCoord};Zr.prototype.computeNodeDepth=function(t){for(var r=this,n=null,i=t.getEdges().iterator();i.hasNext();){var s=i.next();if(s.isVisited()||s.getSym().isVisited()){n=s;break}}if(n===null)throw new ps("unable to find edge to compute depths at "+t.getCoordinate());t.getEdges().computeDepths(n);for(var a=t.getEdges().iterator();a.hasNext();){var o=a.next();o.setVisited(!0),r.copySymDepths(o)}};Zr.prototype.computeDepth=function(t){this.clearVisitedEdges();var r=this._finder.getEdge();r.setEdgeDepths(j.RIGHT,t),this.copySymDepths(r),this.computeDepths(r)};Zr.prototype.create=function(t){this.addReachable(t),this._finder.findEdge(this._dirEdgeList),this._rightMostCoord=this._finder.getCoordinate()};Zr.prototype.findResultEdges=function(){for(var t=this._dirEdgeList.iterator();t.hasNext();){var r=t.next();r.getDepth(j.RIGHT)>=1&&r.getDepth(j.LEFT)<=0&&!r.isInteriorAreaEdge()&&r.setInResult(!0)}};Zr.prototype.computeDepths=function(t){var r=this,n=new Mp,i=new ah,s=t.getNode();for(i.addLast(s),n.add(s),t.setVisited(!0);!i.isEmpty();){var a=i.removeFirst();n.add(a),r.computeNodeDepth(a);for(var o=a.getEdges().iterator();o.hasNext();){var u=o.next(),f=u.getSym();if(!f.isVisited()){var l=f.getNode();n.contains(l)||(i.addLast(l),n.add(l))}}}};Zr.prototype.compareTo=function(t){var r=t;return this._rightMostCoord.x<r._rightMostCoord.x?-1:this._rightMostCoord.x>r._rightMostCoord.x?1:0};Zr.prototype.getEnvelope=function(){if(this._env===null){for(var t=new ae,r=this._dirEdgeList.iterator();r.hasNext();)for(var n=r.next(),i=n.getEdge().getCoordinates(),s=0;s<i.length-1;s++)t.expandToInclude(i[s]);this._env=t}return this._env};Zr.prototype.addReachable=function(t){var r=this,n=new Di;for(n.add(t);!n.empty();){var i=n.pop();r.add(i,n)}};Zr.prototype.copySymDepths=function(t){var r=t.getSym();r.setDepth(j.LEFT,t.getDepth(j.RIGHT)),r.setDepth(j.RIGHT,t.getDepth(j.LEFT))};Zr.prototype.add=function(t,r){var n=this;t.setVisited(!0),this._nodes.add(t);for(var i=t.getEdges().iterator();i.hasNext();){var s=i.next();n._dirEdgeList.add(s);var a=s.getSym(),o=a.getNode();o.isVisited()||r.push(o)}};Zr.prototype.getNodes=function(){return this._nodes};Zr.prototype.getDirectedEdges=function(){return this._dirEdgeList};Zr.prototype.interfaces_=function(){return[Hn]};Zr.prototype.getClass=function(){return Zr};var Rt=function e(){var t=this;if(this.location=null,arguments.length===1){if(arguments[0]instanceof Array){var r=arguments[0];this.init(r.length)}else if(Number.isInteger(arguments[0])){var n=arguments[0];this.init(1),this.location[j.ON]=n}else if(arguments[0]instanceof e){var i=arguments[0];if(this.init(i.location.length),i!==null)for(var s=0;s<this.location.length;s++)t.location[s]=i.location[s]}}else if(arguments.length===3){var a=arguments[0],o=arguments[1],u=arguments[2];this.init(3),this.location[j.ON]=a,this.location[j.LEFT]=o,this.location[j.RIGHT]=u}};Rt.prototype.setAllLocations=function(t){for(var r=this,n=0;n<this.location.length;n++)r.location[n]=t};Rt.prototype.isNull=function(){for(var t=this,r=0;r<this.location.length;r++)if(t.location[r]!==z.NONE)return!1;return!0};Rt.prototype.setAllLocationsIfNull=function(t){for(var r=this,n=0;n<this.location.length;n++)r.location[n]===z.NONE&&(r.location[n]=t)};Rt.prototype.isLine=function(){return this.location.length===1};Rt.prototype.merge=function(t){var r=this;if(t.location.length>this.location.length){var n=new Array(3).fill(null);n[j.ON]=this.location[j.ON],n[j.LEFT]=z.NONE,n[j.RIGHT]=z.NONE,this.location=n}for(var i=0;i<this.location.length;i++)r.location[i]===z.NONE&&i<t.location.length&&(r.location[i]=t.location[i])};Rt.prototype.getLocations=function(){return this.location};Rt.prototype.flip=function(){if(this.location.length<=1)return null;var t=this.location[j.LEFT];this.location[j.LEFT]=this.location[j.RIGHT],this.location[j.RIGHT]=t};Rt.prototype.toString=function(){var t=new Ai;return this.location.length>1&&t.append(z.toLocationSymbol(this.location[j.LEFT])),t.append(z.toLocationSymbol(this.location[j.ON])),this.location.length>1&&t.append(z.toLocationSymbol(this.location[j.RIGHT])),t.toString()};Rt.prototype.setLocations=function(t,r,n){this.location[j.ON]=t,this.location[j.LEFT]=r,this.location[j.RIGHT]=n};Rt.prototype.get=function(t){return t<this.location.length?this.location[t]:z.NONE};Rt.prototype.isArea=function(){return this.location.length>1};Rt.prototype.isAnyNull=function(){for(var t=this,r=0;r<this.location.length;r++)if(t.location[r]===z.NONE)return!0;return!1};Rt.prototype.setLocation=function(){if(arguments.length===1){var t=arguments[0];this.setLocation(j.ON,t)}else if(arguments.length===2){var r=arguments[0],n=arguments[1];this.location[r]=n}};Rt.prototype.init=function(t){this.location=new Array(t).fill(null),this.setAllLocations(z.NONE)};Rt.prototype.isEqualOnSide=function(t,r){return this.location[r]===t.location[r]};Rt.prototype.allPositionsEqual=function(t){for(var r=this,n=0;n<this.location.length;n++)if(r.location[n]!==t)return!1;return!0};Rt.prototype.interfaces_=function(){return[]};Rt.prototype.getClass=function(){return Rt};var yt=function e(){if(this.elt=new Array(2).fill(null),arguments.length===1){if(Number.isInteger(arguments[0])){var t=arguments[0];this.elt[0]=new Rt(t),this.elt[1]=new Rt(t)}else if(arguments[0]instanceof e){var r=arguments[0];this.elt[0]=new Rt(r.elt[0]),this.elt[1]=new Rt(r.elt[1])}}else if(arguments.length===2){var n=arguments[0],i=arguments[1];this.elt[0]=new Rt(z.NONE),this.elt[1]=new Rt(z.NONE),this.elt[n].setLocation(i)}else if(arguments.length===3){var s=arguments[0],a=arguments[1],o=arguments[2];this.elt[0]=new Rt(s,a,o),this.elt[1]=new Rt(s,a,o)}else if(arguments.length===4){var u=arguments[0],f=arguments[1],l=arguments[2],c=arguments[3];this.elt[0]=new Rt(z.NONE,z.NONE,z.NONE),this.elt[1]=new Rt(z.NONE,z.NONE,z.NONE),this.elt[u].setLocations(f,l,c)}};yt.prototype.getGeometryCount=function(){var t=0;return this.elt[0].isNull()||t++,this.elt[1].isNull()||t++,t};yt.prototype.setAllLocations=function(t,r){this.elt[t].setAllLocations(r)};yt.prototype.isNull=function(t){return this.elt[t].isNull()};yt.prototype.setAllLocationsIfNull=function(){if(arguments.length===1){var t=arguments[0];this.setAllLocationsIfNull(0,t),this.setAllLocationsIfNull(1,t)}else if(arguments.length===2){var r=arguments[0],n=arguments[1];this.elt[r].setAllLocationsIfNull(n)}};yt.prototype.isLine=function(t){return this.elt[t].isLine()};yt.prototype.merge=function(t){for(var r=this,n=0;n<2;n++)r.elt[n]===null&&t.elt[n]!==null?r.elt[n]=new Rt(t.elt[n]):r.elt[n].merge(t.elt[n])};yt.prototype.flip=function(){this.elt[0].flip(),this.elt[1].flip()};yt.prototype.getLocation=function(){if(arguments.length===1){var t=arguments[0];return this.elt[t].get(j.ON)}else if(arguments.length===2){var r=arguments[0],n=arguments[1];return this.elt[r].get(n)}};yt.prototype.toString=function(){var t=new Ai;return this.elt[0]!==null&&(t.append("A:"),t.append(this.elt[0].toString())),this.elt[1]!==null&&(t.append(" B:"),t.append(this.elt[1].toString())),t.toString()};yt.prototype.isArea=function(){if(arguments.length===0)return this.elt[0].isArea()||this.elt[1].isArea();if(arguments.length===1){var t=arguments[0];return this.elt[t].isArea()}};yt.prototype.isAnyNull=function(t){return this.elt[t].isAnyNull()};yt.prototype.setLocation=function(){if(arguments.length===2){var t=arguments[0],r=arguments[1];this.elt[t].setLocation(j.ON,r)}else if(arguments.length===3){var n=arguments[0],i=arguments[1],s=arguments[2];this.elt[n].setLocation(i,s)}};yt.prototype.isEqualOnSide=function(t,r){return this.elt[0].isEqualOnSide(t.elt[0],r)&&this.elt[1].isEqualOnSide(t.elt[1],r)};yt.prototype.allPositionsEqual=function(t,r){return this.elt[t].allPositionsEqual(r)};yt.prototype.toLine=function(t){this.elt[t].isArea()&&(this.elt[t]=new Rt(this.elt[t].location[0]))};yt.prototype.interfaces_=function(){return[]};yt.prototype.getClass=function(){return yt};yt.toLineLabel=function(t){for(var r=new yt(z.NONE),n=0;n<2;n++)r.setLocation(n,t.getLocation(n));return r};var ir=function(){this._startDe=null,this._maxNodeDegree=-1,this._edges=new Q,this._pts=new Q,this._label=new yt(z.NONE),this._ring=null,this._isHole=null,this._shell=null,this._holes=new Q,this._geometryFactory=null;var t=arguments[0],r=arguments[1];this._geometryFactory=r,this.computePoints(t),this.computeRing()};ir.prototype.computeRing=function(){var t=this;if(this._ring!==null)return null;for(var r=new Array(this._pts.size()).fill(null),n=0;n<this._pts.size();n++)r[n]=t._pts.get(n);this._ring=this._geometryFactory.createLinearRing(r),this._isHole=J.isCCW(this._ring.getCoordinates())};ir.prototype.isIsolated=function(){return this._label.getGeometryCount()===1};ir.prototype.computePoints=function(t){var r=this;this._startDe=t;var n=t,i=!0;do{if(n===null)throw new ps("Found null DirectedEdge");if(n.getEdgeRing()===r)throw new ps("Directed Edge visited twice during ring-building at "+n.getCoordinate());r._edges.add(n);var s=n.getLabel();we.isTrue(s.isArea()),r.mergeLabel(s),r.addPoints(n.getEdge(),n.isForward(),i),i=!1,r.setEdgeRing(n,r),n=r.getNext(n)}while(n!==this._startDe)};ir.prototype.getLinearRing=function(){return this._ring};ir.prototype.getCoordinate=function(t){return this._pts.get(t)};ir.prototype.computeMaxNodeDegree=function(){var t=this;this._maxNodeDegree=0;var r=this._startDe;do{var n=r.getNode(),i=n.getEdges().getOutgoingDegree(t);i>t._maxNodeDegree&&(t._maxNodeDegree=i),r=t.getNext(r)}while(r!==this._startDe);this._maxNodeDegree*=2};ir.prototype.addPoints=function(t,r,n){var i=this,s=t.getCoordinates();if(r){var a=1;n&&(a=0);for(var o=a;o<s.length;o++)i._pts.add(s[o])}else{var u=s.length-2;n&&(u=s.length-1);for(var f=u;f>=0;f--)i._pts.add(s[f])}};ir.prototype.isHole=function(){return this._isHole};ir.prototype.setInResult=function(){var t=this._startDe;do t.getEdge().setInResult(!0),t=t.getNext();while(t!==this._startDe)};ir.prototype.containsPoint=function(t){var r=this.getLinearRing(),n=r.getEnvelopeInternal();if(!n.contains(t)||!J.isPointInRing(t,r.getCoordinates()))return!1;for(var i=this._holes.iterator();i.hasNext();){var s=i.next();if(s.containsPoint(t))return!1}return!0};ir.prototype.addHole=function(t){this._holes.add(t)};ir.prototype.isShell=function(){return this._shell===null};ir.prototype.getLabel=function(){return this._label};ir.prototype.getEdges=function(){return this._edges};ir.prototype.getMaxNodeDegree=function(){return this._maxNodeDegree<0&&this.computeMaxNodeDegree(),this._maxNodeDegree};ir.prototype.getShell=function(){return this._shell};ir.prototype.mergeLabel=function(){if(arguments.length===1){var t=arguments[0];this.mergeLabel(t,0),this.mergeLabel(t,1)}else if(arguments.length===2){var r=arguments[0],n=arguments[1],i=r.getLocation(n,j.RIGHT);if(i===z.NONE)return null;if(this._label.getLocation(n)===z.NONE)return this._label.setLocation(n,i),null}};ir.prototype.setShell=function(t){this._shell=t,t!==null&&t.addHole(this)};ir.prototype.toPolygon=function(t){for(var r=this,n=new Array(this._holes.size()).fill(null),i=0;i<this._holes.size();i++)n[i]=r._holes.get(i).getLinearRing();var s=t.createPolygon(this.getLinearRing(),n);return s};ir.prototype.interfaces_=function(){return[]};ir.prototype.getClass=function(){return ir};var LN=function(e){function t(){var r=arguments[0],n=arguments[1];e.call(this,r,n)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.setEdgeRing=function(n,i){n.setMinEdgeRing(i)},t.prototype.getNext=function(n){return n.getNextMin()},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(ir),PN=function(e){function t(){var r=arguments[0],n=arguments[1];e.call(this,r,n)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.buildMinimalRings=function(){var n=this,i=new Q,s=this._startDe;do{if(s.getMinEdgeRing()===null){var a=new LN(s,n._geometryFactory);i.add(a)}s=s.getNext()}while(s!==this._startDe);return i},t.prototype.setEdgeRing=function(n,i){n.setEdgeRing(i)},t.prototype.linkDirectedEdgesForMinimalEdgeRings=function(){var n=this,i=this._startDe;do{var s=i.getNode();s.getEdges().linkMinimalDirectedEdges(n),i=i.getNext()}while(i!==this._startDe)},t.prototype.getNext=function(n){return n.getNext()},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(ir),Ln=function(){if(this._label=null,this._isInResult=!1,this._isCovered=!1,this._isCoveredSet=!1,this._isVisited=!1,arguments.length!==0){if(arguments.length===1){var t=arguments[0];this._label=t}}};Ln.prototype.setVisited=function(t){this._isVisited=t};Ln.prototype.setInResult=function(t){this._isInResult=t};Ln.prototype.isCovered=function(){return this._isCovered};Ln.prototype.isCoveredSet=function(){return this._isCoveredSet};Ln.prototype.setLabel=function(t){this._label=t};Ln.prototype.getLabel=function(){return this._label};Ln.prototype.setCovered=function(t){this._isCovered=t,this._isCoveredSet=!0};Ln.prototype.updateIM=function(t){we.isTrue(this._label.getGeometryCount()>=2,"found partial label"),this.computeIM(t)};Ln.prototype.isInResult=function(){return this._isInResult};Ln.prototype.isVisited=function(){return this._isVisited};Ln.prototype.interfaces_=function(){return[]};Ln.prototype.getClass=function(){return Ln};var oh=function(e){function t(){e.call(this),this._coord=null,this._edges=null;var r=arguments[0],n=arguments[1];this._coord=r,this._edges=n,this._label=new yt(0,z.NONE)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.isIncidentEdgeInResult=function(){for(var n=this.getEdges().getEdges().iterator();n.hasNext();){var i=n.next();if(i.getEdge().isInResult())return!0}return!1},t.prototype.isIsolated=function(){return this._label.getGeometryCount()===1},t.prototype.getCoordinate=function(){return this._coord},t.prototype.print=function(n){n.println("node "+this._coord+" lbl: "+this._label)},t.prototype.computeIM=function(n){},t.prototype.computeMergedLocation=function(n,i){var s=z.NONE;if(s=this._label.getLocation(i),!n.isNull(i)){var a=n.getLocation(i);s!==z.BOUNDARY&&(s=a)}return s},t.prototype.setLabel=function(){if(arguments.length===2){var n=arguments[0],i=arguments[1];this._label===null?this._label=new yt(n,i):this._label.setLocation(n,i)}else return e.prototype.setLabel.apply(this,arguments)},t.prototype.getEdges=function(){return this._edges},t.prototype.mergeLabel=function(){var n=this;if(arguments[0]instanceof t){var i=arguments[0];this.mergeLabel(i._label)}else if(arguments[0]instanceof yt)for(var s=arguments[0],a=0;a<2;a++){var o=n.computeMergedLocation(s,a),u=n._label.getLocation(a);u===z.NONE&&n._label.setLocation(a,o)}},t.prototype.add=function(n){this._edges.insert(n),n.setNode(this)},t.prototype.setLabelBoundary=function(n){if(this._label===null)return null;var i=z.NONE;this._label!==null&&(i=this._label.getLocation(n));var s=null;switch(i){case z.BOUNDARY:s=z.INTERIOR;break;case z.INTERIOR:s=z.BOUNDARY;break;default:s=z.BOUNDARY;break}this._label.setLocation(n,s)},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(Ln),Si=function(){this.nodeMap=new Or,this.nodeFact=null;var t=arguments[0];this.nodeFact=t};Si.prototype.find=function(t){return this.nodeMap.get(t)};Si.prototype.addNode=function(){if(arguments[0]instanceof V){var t=arguments[0],r=this.nodeMap.get(t);return r===null&&(r=this.nodeFact.createNode(t),this.nodeMap.put(t,r)),r}else if(arguments[0]instanceof oh){var n=arguments[0],i=this.nodeMap.get(n.getCoordinate());return i===null?(this.nodeMap.put(n.getCoordinate(),n),n):(i.mergeLabel(n),i)}};Si.prototype.print=function(t){for(var r=this.iterator();r.hasNext();){var n=r.next();n.print(t)}};Si.prototype.iterator=function(){return this.nodeMap.values().iterator()};Si.prototype.values=function(){return this.nodeMap.values()};Si.prototype.getBoundaryNodes=function(t){for(var r=new Q,n=this.iterator();n.hasNext();){var i=n.next();i.getLabel().getLocation(t)===z.BOUNDARY&&r.add(i)}return r};Si.prototype.add=function(t){var r=t.getCoordinate(),n=this.addNode(r);n.add(t)};Si.prototype.interfaces_=function(){return[]};Si.prototype.getClass=function(){return Si};var Tt=function(){},sl={NE:{configurable:!0},NW:{configurable:!0},SW:{configurable:!0},SE:{configurable:!0}};Tt.prototype.interfaces_=function(){return[]};Tt.prototype.getClass=function(){return Tt};Tt.isNorthern=function(t){return t===Tt.NE||t===Tt.NW};Tt.isOpposite=function(t,r){if(t===r)return!1;var n=(t-r+4)%4;return n===2};Tt.commonHalfPlane=function(t,r){if(t===r)return t;var n=(t-r+4)%4;if(n===2)return-1;var i=t<r?t:r,s=t>r?t:r;return i===0&&s===3?3:i};Tt.isInHalfPlane=function(t,r){return r===Tt.SE?t===Tt.SE||t===Tt.SW:t===r||t===r+1};Tt.quadrant=function(){if(typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var t=arguments[0],r=arguments[1];if(t===0&&r===0)throw new zt("Cannot compute the quadrant for point ( "+t+", "+r+" )");return t>=0?r>=0?Tt.NE:Tt.SE:r>=0?Tt.NW:Tt.SW}else if(arguments[0]instanceof V&&arguments[1]instanceof V){var n=arguments[0],i=arguments[1];if(i.x===n.x&&i.y===n.y)throw new zt("Cannot compute the quadrant for two identical points "+n);return i.x>=n.x?i.y>=n.y?Tt.NE:Tt.SE:i.y>=n.y?Tt.NW:Tt.SW}};sl.NE.get=function(){return 0};sl.NW.get=function(){return 1};sl.SW.get=function(){return 2};sl.SE.get=function(){return 3};Object.defineProperties(Tt,sl);var Nr=function(){if(this._edge=null,this._label=null,this._node=null,this._p0=null,this._p1=null,this._dx=null,this._dy=null,this._quadrant=null,arguments.length===1){var t=arguments[0];this._edge=t}else if(arguments.length===3){var r=arguments[0],n=arguments[1],i=arguments[2],s=null;this._edge=r,this.init(n,i),this._label=s}else if(arguments.length===4){var a=arguments[0],o=arguments[1],u=arguments[2],f=arguments[3];this._edge=a,this.init(o,u),this._label=f}};Nr.prototype.compareDirection=function(t){return this._dx===t._dx&&this._dy===t._dy?0:this._quadrant>t._quadrant?1:this._quadrant<t._quadrant?-1:J.computeOrientation(t._p0,t._p1,this._p1)};Nr.prototype.getDy=function(){return this._dy};Nr.prototype.getCoordinate=function(){return this._p0};Nr.prototype.setNode=function(t){this._node=t};Nr.prototype.print=function(t){var r=Math.atan2(this._dy,this._dx),n=this.getClass().getName(),i=n.lastIndexOf("."),s=n.substring(i+1);t.print("  "+s+": "+this._p0+" - "+this._p1+" "+this._quadrant+":"+r+"   "+this._label)};Nr.prototype.compareTo=function(t){var r=t;return this.compareDirection(r)};Nr.prototype.getDirectedCoordinate=function(){return this._p1};Nr.prototype.getDx=function(){return this._dx};Nr.prototype.getLabel=function(){return this._label};Nr.prototype.getEdge=function(){return this._edge};Nr.prototype.getQuadrant=function(){return this._quadrant};Nr.prototype.getNode=function(){return this._node};Nr.prototype.toString=function(){var t=Math.atan2(this._dy,this._dx),r=this.getClass().getName(),n=r.lastIndexOf("."),i=r.substring(n+1);return"  "+i+": "+this._p0+" - "+this._p1+" "+this._quadrant+":"+t+"   "+this._label};Nr.prototype.computeLabel=function(t){};Nr.prototype.init=function(t,r){this._p0=t,this._p1=r,this._dx=r.x-t.x,this._dy=r.y-t.y,this._quadrant=Tt.quadrant(this._dx,this._dy),we.isTrue(!(this._dx===0&&this._dy===0),"EdgeEnd with identical endpoints found")};Nr.prototype.interfaces_=function(){return[Hn]};Nr.prototype.getClass=function(){return Nr};var Ym=function(e){function t(){var r=arguments[0],n=arguments[1];if(e.call(this,r),this._isForward=null,this._isInResult=!1,this._isVisited=!1,this._sym=null,this._next=null,this._nextMin=null,this._edgeRing=null,this._minEdgeRing=null,this._depth=[0,-999,-999],this._isForward=n,n)this.init(r.getCoordinate(0),r.getCoordinate(1));else{var i=r.getNumPoints()-1;this.init(r.getCoordinate(i),r.getCoordinate(i-1))}this.computeDirectedLabel()}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.getNextMin=function(){return this._nextMin},t.prototype.getDepth=function(n){return this._depth[n]},t.prototype.setVisited=function(n){this._isVisited=n},t.prototype.computeDirectedLabel=function(){this._label=new yt(this._edge.getLabel()),this._isForward||this._label.flip()},t.prototype.getNext=function(){return this._next},t.prototype.setDepth=function(n,i){if(this._depth[n]!==-999&&this._depth[n]!==i)throw new ps("assigned depths do not match",this.getCoordinate());this._depth[n]=i},t.prototype.isInteriorAreaEdge=function(){for(var n=this,i=!0,s=0;s<2;s++)n._label.isArea(s)&&n._label.getLocation(s,j.LEFT)===z.INTERIOR&&n._label.getLocation(s,j.RIGHT)===z.INTERIOR||(i=!1);return i},t.prototype.setNextMin=function(n){this._nextMin=n},t.prototype.print=function(n){e.prototype.print.call(this,n),n.print(" "+this._depth[j.LEFT]+"/"+this._depth[j.RIGHT]),n.print(" ("+this.getDepthDelta()+")"),this._isInResult&&n.print(" inResult")},t.prototype.setMinEdgeRing=function(n){this._minEdgeRing=n},t.prototype.isLineEdge=function(){var n=this._label.isLine(0)||this._label.isLine(1),i=!this._label.isArea(0)||this._label.allPositionsEqual(0,z.EXTERIOR),s=!this._label.isArea(1)||this._label.allPositionsEqual(1,z.EXTERIOR);return n&&i&&s},t.prototype.setEdgeRing=function(n){this._edgeRing=n},t.prototype.getMinEdgeRing=function(){return this._minEdgeRing},t.prototype.getDepthDelta=function(){var n=this._edge.getDepthDelta();return this._isForward||(n=-n),n},t.prototype.setInResult=function(n){this._isInResult=n},t.prototype.getSym=function(){return this._sym},t.prototype.isForward=function(){return this._isForward},t.prototype.getEdge=function(){return this._edge},t.prototype.printEdge=function(n){this.print(n),n.print(" "),this._isForward?this._edge.print(n):this._edge.printReverse(n)},t.prototype.setSym=function(n){this._sym=n},t.prototype.setVisitedEdge=function(n){this.setVisited(n),this._sym.setVisited(n)},t.prototype.setEdgeDepths=function(n,i){var s=this.getEdge().getDepthDelta();this._isForward||(s=-s);var a=1;n===j.LEFT&&(a=-1);var o=j.opposite(n),u=s*a,f=i+u;this.setDepth(n,i),this.setDepth(o,f)},t.prototype.getEdgeRing=function(){return this._edgeRing},t.prototype.isInResult=function(){return this._isInResult},t.prototype.setNext=function(n){this._next=n},t.prototype.isVisited=function(){return this._isVisited},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t.depthFactor=function(n,i){return n===z.EXTERIOR&&i===z.INTERIOR?1:n===z.INTERIOR&&i===z.EXTERIOR?-1:0},t}(Nr),fu=function(){};fu.prototype.createNode=function(t){return new oh(t,null)};fu.prototype.interfaces_=function(){return[]};fu.prototype.getClass=function(){return fu};var qt=function(){if(this._edges=new Q,this._nodes=null,this._edgeEndList=new Q,arguments.length===0)this._nodes=new Si(new fu);else if(arguments.length===1){var t=arguments[0];this._nodes=new Si(t)}};qt.prototype.printEdges=function(t){var r=this;t.println("Edges:");for(var n=0;n<this._edges.size();n++){t.println("edge "+n+":");var i=r._edges.get(n);i.print(t),i.eiList.print(t)}};qt.prototype.find=function(t){return this._nodes.find(t)};qt.prototype.addNode=function(){if(arguments[0]instanceof oh){var t=arguments[0];return this._nodes.addNode(t)}else if(arguments[0]instanceof V){var r=arguments[0];return this._nodes.addNode(r)}};qt.prototype.getNodeIterator=function(){return this._nodes.iterator()};qt.prototype.linkResultDirectedEdges=function(){for(var t=this._nodes.iterator();t.hasNext();){var r=t.next();r.getEdges().linkResultDirectedEdges()}};qt.prototype.debugPrintln=function(t){br.out.println(t)};qt.prototype.isBoundaryNode=function(t,r){var n=this._nodes.find(r);if(n===null)return!1;var i=n.getLabel();return i!==null&&i.getLocation(t)===z.BOUNDARY};qt.prototype.linkAllDirectedEdges=function(){for(var t=this._nodes.iterator();t.hasNext();){var r=t.next();r.getEdges().linkAllDirectedEdges()}};qt.prototype.matchInSameDirection=function(t,r,n,i){return t.equals(n)?J.computeOrientation(t,r,i)===J.COLLINEAR&&Tt.quadrant(t,r)===Tt.quadrant(n,i):!1};qt.prototype.getEdgeEnds=function(){return this._edgeEndList};qt.prototype.debugPrint=function(t){br.out.print(t)};qt.prototype.getEdgeIterator=function(){return this._edges.iterator()};qt.prototype.findEdgeInSameDirection=function(t,r){for(var n=this,i=0;i<this._edges.size();i++){var s=n._edges.get(i),a=s.getCoordinates();if(n.matchInSameDirection(t,r,a[0],a[1])||n.matchInSameDirection(t,r,a[a.length-1],a[a.length-2]))return s}return null};qt.prototype.insertEdge=function(t){this._edges.add(t)};qt.prototype.findEdgeEnd=function(t){for(var r=this.getEdgeEnds().iterator();r.hasNext();){var n=r.next();if(n.getEdge()===t)return n}return null};qt.prototype.addEdges=function(t){for(var r=this,n=t.iterator();n.hasNext();){var i=n.next();r._edges.add(i);var s=new Ym(i,!0),a=new Ym(i,!1);s.setSym(a),a.setSym(s),r.add(s),r.add(a)}};qt.prototype.add=function(t){this._nodes.add(t),this._edgeEndList.add(t)};qt.prototype.getNodes=function(){return this._nodes.values()};qt.prototype.findEdge=function(t,r){for(var n=this,i=0;i<this._edges.size();i++){var s=n._edges.get(i),a=s.getCoordinates();if(t.equals(a[0])&&r.equals(a[1]))return s}return null};qt.prototype.interfaces_=function(){return[]};qt.prototype.getClass=function(){return qt};qt.linkResultDirectedEdges=function(t){for(var r=t.iterator();r.hasNext();){var n=r.next();n.getEdges().linkResultDirectedEdges()}};var vn=function(){this._geometryFactory=null,this._shellList=new Q;var t=arguments[0];this._geometryFactory=t};vn.prototype.sortShellsAndHoles=function(t,r,n){for(var i=t.iterator();i.hasNext();){var s=i.next();s.isHole()?n.add(s):r.add(s)}};vn.prototype.computePolygons=function(t){for(var r=this,n=new Q,i=t.iterator();i.hasNext();){var s=i.next(),a=s.toPolygon(r._geometryFactory);n.add(a)}return n};vn.prototype.placeFreeHoles=function(t,r){for(var n=this,i=r.iterator();i.hasNext();){var s=i.next();if(s.getShell()===null){var a=n.findEdgeRingContaining(s,t);if(a===null)throw new ps("unable to assign hole to a shell",s.getCoordinate(0));s.setShell(a)}}};vn.prototype.buildMinimalEdgeRings=function(t,r,n){for(var i=this,s=new Q,a=t.iterator();a.hasNext();){var o=a.next();if(o.getMaxNodeDegree()>2){o.linkDirectedEdgesForMinimalEdgeRings();var u=o.buildMinimalRings(),f=i.findShell(u);f!==null?(i.placePolygonHoles(f,u),r.add(f)):n.addAll(u)}else s.add(o)}return s};vn.prototype.containsPoint=function(t){for(var r=this._shellList.iterator();r.hasNext();){var n=r.next();if(n.containsPoint(t))return!0}return!1};vn.prototype.buildMaximalEdgeRings=function(t){for(var r=this,n=new Q,i=t.iterator();i.hasNext();){var s=i.next();if(s.isInResult()&&s.getLabel().isArea()&&s.getEdgeRing()===null){var a=new PN(s,r._geometryFactory);n.add(a),a.setInResult()}}return n};vn.prototype.placePolygonHoles=function(t,r){for(var n=r.iterator();n.hasNext();){var i=n.next();i.isHole()&&i.setShell(t)}};vn.prototype.getPolygons=function(){var t=this.computePolygons(this._shellList);return t};vn.prototype.findEdgeRingContaining=function(t,r){for(var n=t.getLinearRing(),i=n.getEnvelopeInternal(),s=n.getCoordinateN(0),a=null,o=null,u=r.iterator();u.hasNext();){var f=u.next(),l=f.getLinearRing(),c=l.getEnvelopeInternal();a!==null&&(o=a.getLinearRing().getEnvelopeInternal());var h=!1;c.contains(i)&&J.isPointInRing(s,l.getCoordinates())&&(h=!0),h&&(a===null||o.contains(c))&&(a=f)}return a};vn.prototype.findShell=function(t){for(var r=0,n=null,i=t.iterator();i.hasNext();){var s=i.next();s.isHole()||(n=s,r++)}return we.isTrue(r<=1,"found two shells in MinimalEdgeRing list"),n};vn.prototype.add=function(){if(arguments.length===1){var t=arguments[0];this.add(t.getEdgeEnds(),t.getNodes())}else if(arguments.length===2){var r=arguments[0],n=arguments[1];qt.linkResultDirectedEdges(n);var i=this.buildMaximalEdgeRings(r),s=new Q,a=this.buildMinimalEdgeRings(i,this._shellList,s);this.sortShellsAndHoles(a,this._shellList,s),this.placeFreeHoles(this._shellList,s)}};vn.prototype.interfaces_=function(){return[]};vn.prototype.getClass=function(){return vn};var lu=function(){};lu.prototype.getBounds=function(){};lu.prototype.interfaces_=function(){return[]};lu.prototype.getClass=function(){return lu};var ei=function(){this._bounds=null,this._item=null;var t=arguments[0],r=arguments[1];this._bounds=t,this._item=r};ei.prototype.getItem=function(){return this._item};ei.prototype.getBounds=function(){return this._bounds};ei.prototype.interfaces_=function(){return[lu,Wn]};ei.prototype.getClass=function(){return ei};var gs=function(){this._size=null,this._items=null,this._size=0,this._items=new Q,this._items.add(null)};gs.prototype.poll=function(){if(this.isEmpty())return null;var t=this._items.get(1);return this._items.set(1,this._items.get(this._size)),this._size-=1,this.reorder(1),t};gs.prototype.size=function(){return this._size};gs.prototype.reorder=function(t){for(var r=this,n=null,i=this._items.get(t);t*2<=this._size&&(n=t*2,n!==r._size&&r._items.get(n+1).compareTo(r._items.get(n))<0&&n++,r._items.get(n).compareTo(i)<0);t=n)r._items.set(t,r._items.get(n));this._items.set(t,i)};gs.prototype.clear=function(){this._size=0,this._items.clear()};gs.prototype.isEmpty=function(){return this._size===0};gs.prototype.add=function(t){var r=this;this._items.add(null),this._size+=1;var n=this._size;for(this._items.set(0,t);t.compareTo(this._items.get(Math.trunc(n/2)))<0;n/=2)r._items.set(n,r._items.get(Math.trunc(n/2)));this._items.set(n,t)};gs.prototype.interfaces_=function(){return[]};gs.prototype.getClass=function(){return gs};var Gs=function(){};Gs.prototype.visitItem=function(t){};Gs.prototype.interfaces_=function(){return[]};Gs.prototype.getClass=function(){return Gs};var ao=function(){};ao.prototype.insert=function(t,r){};ao.prototype.remove=function(t,r){};ao.prototype.query=function(){};ao.prototype.interfaces_=function(){return[]};ao.prototype.getClass=function(){return ao};var or=function(){if(this._childBoundables=new Q,this._bounds=null,this._level=null,arguments.length!==0){if(arguments.length===1){var t=arguments[0];this._level=t}}},tx={serialVersionUID:{configurable:!0}};or.prototype.getLevel=function(){return this._level};or.prototype.size=function(){return this._childBoundables.size()};or.prototype.getChildBoundables=function(){return this._childBoundables};or.prototype.addChildBoundable=function(t){we.isTrue(this._bounds===null),this._childBoundables.add(t)};or.prototype.isEmpty=function(){return this._childBoundables.isEmpty()};or.prototype.getBounds=function(){return this._bounds===null&&(this._bounds=this.computeBounds()),this._bounds};or.prototype.interfaces_=function(){return[lu,Wn]};or.prototype.getClass=function(){return or};tx.serialVersionUID.get=function(){return 6493722185909574e3};Object.defineProperties(or,tx);var ti=function(){};ti.reverseOrder=function(){return{compare:function(r,n){return n.compareTo(r)}}};ti.min=function(t){return ti.sort(t),t.get(0)};ti.sort=function(t,r){var n=t.toArray();r?ya.sort(n,r):ya.sort(n);for(var i=t.iterator(),s=0,a=n.length;s<a;s++)i.next(),i.set(n[s])};ti.singletonList=function(t){var r=new Q;return r.add(t),r};var tr=function(){this._boundable1=null,this._boundable2=null,this._distance=null,this._itemDistance=null;var t=arguments[0],r=arguments[1],n=arguments[2];this._boundable1=t,this._boundable2=r,this._itemDistance=n,this._distance=this.distance()};tr.prototype.expandToQueue=function(t,r){var n=tr.isComposite(this._boundable1),i=tr.isComposite(this._boundable2);if(n&&i)return tr.area(this._boundable1)>tr.area(this._boundable2)?(this.expand(this._boundable1,this._boundable2,t,r),null):(this.expand(this._boundable2,this._boundable1,t,r),null);if(n)return this.expand(this._boundable1,this._boundable2,t,r),null;if(i)return this.expand(this._boundable2,this._boundable1,t,r),null;throw new zt("neither boundable is composite")};tr.prototype.isLeaves=function(){return!(tr.isComposite(this._boundable1)||tr.isComposite(this._boundable2))};tr.prototype.compareTo=function(t){var r=t;return this._distance<r._distance?-1:this._distance>r._distance?1:0};tr.prototype.expand=function(t,r,n,i){for(var s=this,a=t.getChildBoundables(),o=a.iterator();o.hasNext();){var u=o.next(),f=new tr(u,r,s._itemDistance);f.getDistance()<i&&n.add(f)}};tr.prototype.getBoundable=function(t){return t===0?this._boundable1:this._boundable2};tr.prototype.getDistance=function(){return this._distance};tr.prototype.distance=function(){return this.isLeaves()?this._itemDistance.distance(this._boundable1,this._boundable2):this._boundable1.getBounds().distance(this._boundable2.getBounds())};tr.prototype.interfaces_=function(){return[Hn]};tr.prototype.getClass=function(){return tr};tr.area=function(t){return t.getBounds().getArea()};tr.isComposite=function(t){return t instanceof or};var pr=function e(){if(this._root=null,this._built=!1,this._itemBoundables=new Q,this._nodeCapacity=null,arguments.length===0){var t=e.DEFAULT_NODE_CAPACITY;this._nodeCapacity=t}else if(arguments.length===1){var r=arguments[0];we.isTrue(r>1,"Node capacity must be greater than 1"),this._nodeCapacity=r}},uh={IntersectsOp:{configurable:!0},serialVersionUID:{configurable:!0},DEFAULT_NODE_CAPACITY:{configurable:!0}};pr.prototype.getNodeCapacity=function(){return this._nodeCapacity};pr.prototype.lastNode=function(t){return t.get(t.size()-1)};pr.prototype.size=function(){var t=this;if(arguments.length===0)return this.isEmpty()?0:(this.build(),this.size(this._root));if(arguments.length===1){for(var r=arguments[0],n=0,i=r.getChildBoundables().iterator();i.hasNext();){var s=i.next();s instanceof or?n+=t.size(s):s instanceof ei&&(n+=1)}return n}};pr.prototype.removeItem=function(t,r){for(var n=null,i=t.getChildBoundables().iterator();i.hasNext();){var s=i.next();s instanceof ei&&s.getItem()===r&&(n=s)}return n!==null?(t.getChildBoundables().remove(n),!0):!1};pr.prototype.itemsTree=function(){var t=this;if(arguments.length===0){this.build();var r=this.itemsTree(this._root);return r===null?new Q:r}else if(arguments.length===1){for(var n=arguments[0],i=new Q,s=n.getChildBoundables().iterator();s.hasNext();){var a=s.next();if(a instanceof or){var o=t.itemsTree(a);o!==null&&i.add(o)}else a instanceof ei?i.add(a.getItem()):we.shouldNeverReachHere()}return i.size()<=0?null:i}};pr.prototype.insert=function(t,r){we.isTrue(!this._built,"Cannot insert items into an STR packed R-tree after it has been built."),this._itemBoundables.add(new ei(t,r))};pr.prototype.boundablesAtLevel=function(){var t=this;if(arguments.length===1){var r=arguments[0],n=new Q;return this.boundablesAtLevel(r,this._root,n),n}else if(arguments.length===3){var i=arguments[0],s=arguments[1],a=arguments[2];if(we.isTrue(i>-2),s.getLevel()===i)return a.add(s),null;for(var o=s.getChildBoundables().iterator();o.hasNext();){var u=o.next();u instanceof or?t.boundablesAtLevel(i,u,a):(we.isTrue(u instanceof ei),i===-1&&a.add(u))}return null}};pr.prototype.query=function(){var t=this;if(arguments.length===1){var r=arguments[0];this.build();var n=new Q;return this.isEmpty()||this.getIntersectsOp().intersects(this._root.getBounds(),r)&&this.query(r,this._root,n),n}else if(arguments.length===2){var i=arguments[0],s=arguments[1];if(this.build(),this.isEmpty())return null;this.getIntersectsOp().intersects(this._root.getBounds(),i)&&this.query(i,this._root,s)}else if(arguments.length===3){if(pe(arguments[2],Gs)&&arguments[0]instanceof Object&&arguments[1]instanceof or)for(var a=arguments[0],o=arguments[1],u=arguments[2],f=o.getChildBoundables(),l=0;l<f.size();l++){var c=f.get(l);t.getIntersectsOp().intersects(c.getBounds(),a)&&(c instanceof or?t.query(a,c,u):c instanceof ei?u.visitItem(c.getItem()):we.shouldNeverReachHere())}else if(pe(arguments[2],Zn)&&arguments[0]instanceof Object&&arguments[1]instanceof or)for(var h=arguments[0],d=arguments[1],m=arguments[2],g=d.getChildBoundables(),p=0;p<g.size();p++){var v=g.get(p);t.getIntersectsOp().intersects(v.getBounds(),h)&&(v instanceof or?t.query(h,v,m):v instanceof ei?m.add(v.getItem()):we.shouldNeverReachHere())}}};pr.prototype.build=function(){if(this._built)return null;this._root=this._itemBoundables.isEmpty()?this.createNode(0):this.createHigherLevels(this._itemBoundables,-1),this._itemBoundables=null,this._built=!0};pr.prototype.getRoot=function(){return this.build(),this._root};pr.prototype.remove=function(){var t=this;if(arguments.length===2){var r=arguments[0],n=arguments[1];return this.build(),this.getIntersectsOp().intersects(this._root.getBounds(),r)?this.remove(r,this._root,n):!1}else if(arguments.length===3){var i=arguments[0],s=arguments[1],a=arguments[2],o=this.removeItem(s,a);if(o)return!0;for(var u=null,f=s.getChildBoundables().iterator();f.hasNext();){var l=f.next();if(t.getIntersectsOp().intersects(l.getBounds(),i)&&l instanceof or&&(o=t.remove(i,l,a),o)){u=l;break}}return u!==null&&u.getChildBoundables().isEmpty()&&s.getChildBoundables().remove(u),o}};pr.prototype.createHigherLevels=function(t,r){we.isTrue(!t.isEmpty());var n=this.createParentBoundables(t,r+1);return n.size()===1?n.get(0):this.createHigherLevels(n,r+1)};pr.prototype.depth=function(){var t=this;if(arguments.length===0)return this.isEmpty()?0:(this.build(),this.depth(this._root));if(arguments.length===1){for(var r=arguments[0],n=0,i=r.getChildBoundables().iterator();i.hasNext();){var s=i.next();if(s instanceof or){var a=t.depth(s);a>n&&(n=a)}}return n+1}};pr.prototype.createParentBoundables=function(t,r){var n=this;we.isTrue(!t.isEmpty());var i=new Q;i.add(this.createNode(r));var s=new Q(t);ti.sort(s,this.getComparator());for(var a=s.iterator();a.hasNext();){var o=a.next();n.lastNode(i).getChildBoundables().size()===n.getNodeCapacity()&&i.add(n.createNode(r)),n.lastNode(i).addChildBoundable(o)}return i};pr.prototype.isEmpty=function(){return this._built?this._root.isEmpty():this._itemBoundables.isEmpty()};pr.prototype.interfaces_=function(){return[Wn]};pr.prototype.getClass=function(){return pr};pr.compareDoubles=function(t,r){return t>r?1:t<r?-1:0};uh.IntersectsOp.get=function(){return MN};uh.serialVersionUID.get=function(){return-3886435814360241e3};uh.DEFAULT_NODE_CAPACITY.get=function(){return 10};Object.defineProperties(pr,uh);var MN=function(){},cu=function(){};cu.prototype.distance=function(t,r){};cu.prototype.interfaces_=function(){return[]};cu.prototype.getClass=function(){return cu};var rx=function(e){function t(n){n=n||t.DEFAULT_NODE_CAPACITY,e.call(this,n)}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var r={STRtreeNode:{configurable:!0},serialVersionUID:{configurable:!0},xComparator:{configurable:!0},yComparator:{configurable:!0},intersectsOp:{configurable:!0},DEFAULT_NODE_CAPACITY:{configurable:!0}};return t.prototype.createParentBoundablesFromVerticalSlices=function(i,s){var a=this;we.isTrue(i.length>0);for(var o=new Q,u=0;u<i.length;u++)o.addAll(a.createParentBoundablesFromVerticalSlice(i[u],s));return o},t.prototype.createNode=function(i){return new uy(i)},t.prototype.size=function(){return arguments.length===0?e.prototype.size.call(this):e.prototype.size.apply(this,arguments)},t.prototype.insert=function(){if(arguments.length===2){var i=arguments[0],s=arguments[1];if(i.isNull())return null;e.prototype.insert.call(this,i,s)}else return e.prototype.insert.apply(this,arguments)},t.prototype.getIntersectsOp=function(){return t.intersectsOp},t.prototype.verticalSlices=function(i,s){for(var a=Math.trunc(Math.ceil(i.size()/s)),o=new Array(s).fill(null),u=i.iterator(),f=0;f<s;f++){o[f]=new Q;for(var l=0;u.hasNext()&&l<a;){var c=u.next();o[f].add(c),l++}}return o},t.prototype.query=function(){if(arguments.length===1){var i=arguments[0];return e.prototype.query.call(this,i)}else if(arguments.length===2){var s=arguments[0],a=arguments[1];e.prototype.query.call(this,s,a)}else if(arguments.length===3){if(pe(arguments[2],Gs)&&arguments[0]instanceof Object&&arguments[1]instanceof or){var o=arguments[0],u=arguments[1],f=arguments[2];e.prototype.query.call(this,o,u,f)}else if(pe(arguments[2],Zn)&&arguments[0]instanceof Object&&arguments[1]instanceof or){var l=arguments[0],c=arguments[1],h=arguments[2];e.prototype.query.call(this,l,c,h)}}},t.prototype.getComparator=function(){return t.yComparator},t.prototype.createParentBoundablesFromVerticalSlice=function(i,s){return e.prototype.createParentBoundables.call(this,i,s)},t.prototype.remove=function(){if(arguments.length===2){var i=arguments[0],s=arguments[1];return e.prototype.remove.call(this,i,s)}else return e.prototype.remove.apply(this,arguments)},t.prototype.depth=function(){return arguments.length===0?e.prototype.depth.call(this):e.prototype.depth.apply(this,arguments)},t.prototype.createParentBoundables=function(i,s){we.isTrue(!i.isEmpty());var a=Math.trunc(Math.ceil(i.size()/this.getNodeCapacity())),o=new Q(i);ti.sort(o,t.xComparator);var u=this.verticalSlices(o,Math.trunc(Math.ceil(Math.sqrt(a))));return this.createParentBoundablesFromVerticalSlices(u,s)},t.prototype.nearestNeighbour=function(){if(arguments.length===1){if(pe(arguments[0],cu)){var i=arguments[0],s=new tr(this.getRoot(),this.getRoot(),i);return this.nearestNeighbour(s)}else if(arguments[0]instanceof tr){var a=arguments[0];return this.nearestNeighbour(a,Ee.POSITIVE_INFINITY)}}else if(arguments.length===2){if(arguments[0]instanceof t&&pe(arguments[1],cu)){var o=arguments[0],u=arguments[1],f=new tr(this.getRoot(),o.getRoot(),u);return this.nearestNeighbour(f)}else if(arguments[0]instanceof tr&&typeof arguments[1]=="number"){var l=arguments[0],c=arguments[1],h=c,d=null,m=new gs;for(m.add(l);!m.isEmpty()&&h>0;){var g=m.poll(),p=g.getDistance();if(p>=h)break;g.isLeaves()?(h=p,d=g):g.expandToQueue(m,h)}return[d.getBoundable(0).getItem(),d.getBoundable(1).getItem()]}}else if(arguments.length===3){var v=arguments[0],_=arguments[1],y=arguments[2],x=new ei(v,_),E=new tr(this.getRoot(),x,y);return this.nearestNeighbour(E)[0]}},t.prototype.interfaces_=function(){return[ao,Wn]},t.prototype.getClass=function(){return t},t.centreX=function(i){return t.avg(i.getMinX(),i.getMaxX())},t.avg=function(i,s){return(i+s)/2},t.centreY=function(i){return t.avg(i.getMinY(),i.getMaxY())},r.STRtreeNode.get=function(){return uy},r.serialVersionUID.get=function(){return 0x39920f7d5f261e0},r.xComparator.get=function(){return{interfaces_:function(){return[tu]},compare:function(n,i){return e.compareDoubles(t.centreX(n.getBounds()),t.centreX(i.getBounds()))}}},r.yComparator.get=function(){return{interfaces_:function(){return[tu]},compare:function(n,i){return e.compareDoubles(t.centreY(n.getBounds()),t.centreY(i.getBounds()))}}},r.intersectsOp.get=function(){return{interfaces_:function(){return[e.IntersectsOp]},intersects:function(n,i){return n.intersects(i)}}},r.DEFAULT_NODE_CAPACITY.get=function(){return 10},Object.defineProperties(t,r),t}(pr),uy=function(e){function t(){var r=arguments[0];e.call(this,r)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.computeBounds=function(){for(var n=null,i=this.getChildBoundables().iterator();i.hasNext();){var s=i.next();n===null?n=new ae(s.getBounds()):n.expandToInclude(s.getBounds())}return n},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(or),rn=function(){};rn.prototype.interfaces_=function(){return[]};rn.prototype.getClass=function(){return rn};rn.relativeSign=function(t,r){return t<r?-1:t>r?1:0};rn.compare=function(t,r,n){if(r.equals2D(n))return 0;var i=rn.relativeSign(r.x,n.x),s=rn.relativeSign(r.y,n.y);switch(t){case 0:return rn.compareValue(i,s);case 1:return rn.compareValue(s,i);case 2:return rn.compareValue(s,-i);case 3:return rn.compareValue(-i,s);case 4:return rn.compareValue(-i,-s);case 5:return rn.compareValue(-s,-i);case 6:return rn.compareValue(-s,i);case 7:return rn.compareValue(i,-s);default:}return we.shouldNeverReachHere("invalid octant value"),0};rn.compareValue=function(t,r){return t<0?-1:t>0?1:r<0?-1:r>0?1:0};var qs=function(){this._segString=null,this.coord=null,this.segmentIndex=null,this._segmentOctant=null,this._isInterior=null;var t=arguments[0],r=arguments[1],n=arguments[2],i=arguments[3];this._segString=t,this.coord=new V(r),this.segmentIndex=n,this._segmentOctant=i,this._isInterior=!r.equals2D(t.getCoordinate(n))};qs.prototype.getCoordinate=function(){return this.coord};qs.prototype.print=function(t){t.print(this.coord),t.print(" seg # = "+this.segmentIndex)};qs.prototype.compareTo=function(t){var r=t;return this.segmentIndex<r.segmentIndex?-1:this.segmentIndex>r.segmentIndex?1:this.coord.equals2D(r.coord)?0:rn.compare(this._segmentOctant,this.coord,r.coord)};qs.prototype.isEndPoint=function(t){return this.segmentIndex===0&&!this._isInterior||this.segmentIndex===t};qs.prototype.isInterior=function(){return this._isInterior};qs.prototype.interfaces_=function(){return[Hn]};qs.prototype.getClass=function(){return qs};var Jr=function(){this._nodeMap=new Or,this._edge=null;var t=arguments[0];this._edge=t};Jr.prototype.getSplitCoordinates=function(){var t=this,r=new rl;this.addEndpoints();for(var n=this.iterator(),i=n.next();n.hasNext();){var s=n.next();t.addEdgeCoordinates(i,s,r),i=s}return r.toCoordinateArray()};Jr.prototype.addCollapsedNodes=function(){var t=this,r=new Q;this.findCollapsesFromInsertedNodes(r),this.findCollapsesFromExistingVertices(r);for(var n=r.iterator();n.hasNext();){var i=n.next().intValue();t.add(t._edge.getCoordinate(i),i)}};Jr.prototype.print=function(t){t.println("Intersections:");for(var r=this.iterator();r.hasNext();){var n=r.next();n.print(t)}};Jr.prototype.findCollapsesFromExistingVertices=function(t){for(var r=this,n=0;n<this._edge.size()-2;n++){var i=r._edge.getCoordinate(n),s=r._edge.getCoordinate(n+2);i.equals2D(s)&&t.add(new yi(n+1))}};Jr.prototype.addEdgeCoordinates=function(t,r,n){var i=this,s=this._edge.getCoordinate(r.segmentIndex),a=r.isInterior()||!r.coord.equals2D(s);n.add(new V(t.coord),!1);for(var o=t.segmentIndex+1;o<=r.segmentIndex;o++)n.add(i._edge.getCoordinate(o));a&&n.add(new V(r.coord))};Jr.prototype.iterator=function(){return this._nodeMap.values().iterator()};Jr.prototype.addSplitEdges=function(t){var r=this;this.addEndpoints(),this.addCollapsedNodes();for(var n=this.iterator(),i=n.next();n.hasNext();){var s=n.next(),a=r.createSplitEdge(i,s);t.add(a),i=s}};Jr.prototype.findCollapseIndex=function(t,r,n){if(!t.coord.equals2D(r.coord))return!1;var i=r.segmentIndex-t.segmentIndex;return r.isInterior()||i--,i===1?(n[0]=t.segmentIndex+1,!0):!1};Jr.prototype.findCollapsesFromInsertedNodes=function(t){for(var r=this,n=new Array(1).fill(null),i=this.iterator(),s=i.next();i.hasNext();){var a=i.next(),o=r.findCollapseIndex(s,a,n);o&&t.add(new yi(n[0])),s=a}};Jr.prototype.getEdge=function(){return this._edge};Jr.prototype.addEndpoints=function(){var t=this._edge.size()-1;this.add(this._edge.getCoordinate(0),0),this.add(this._edge.getCoordinate(t),t)};Jr.prototype.createSplitEdge=function(t,r){var n=this,i=r.segmentIndex-t.segmentIndex+2,s=this._edge.getCoordinate(r.segmentIndex),a=r.isInterior()||!r.coord.equals2D(s);a||i--;var o=new Array(i).fill(null),u=0;o[u++]=new V(t.coord);for(var f=t.segmentIndex+1;f<=r.segmentIndex;f++)o[u++]=n._edge.getCoordinate(f);return a&&(o[u]=new V(r.coord)),new $t(o,this._edge.getData())};Jr.prototype.add=function(t,r){var n=new qs(this._edge,t,r,this._edge.getSegmentOctant(r)),i=this._nodeMap.get(n);return i!==null?(we.isTrue(i.coord.equals2D(t),"Found equal nodes with different coordinates"),i):(this._nodeMap.put(n,n),n)};Jr.prototype.checkSplitEdgesCorrectness=function(t){var r=this._edge.getCoordinates(),n=t.get(0),i=n.getCoordinate(0);if(!i.equals2D(r[0]))throw new ds("bad split edge start point at "+i);var s=t.get(t.size()-1),a=s.getCoordinates(),o=a[a.length-1];if(!o.equals2D(r[r.length-1]))throw new ds("bad split edge end point at "+o)};Jr.prototype.interfaces_=function(){return[]};Jr.prototype.getClass=function(){return Jr};var oo=function(){};oo.prototype.interfaces_=function(){return[]};oo.prototype.getClass=function(){return oo};oo.octant=function(){if(typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var t=arguments[0],r=arguments[1];if(t===0&&r===0)throw new zt("Cannot compute the octant for point ( "+t+", "+r+" )");var n=Math.abs(t),i=Math.abs(r);return t>=0?r>=0?n>=i?0:1:n>=i?7:6:r>=0?n>=i?3:2:n>=i?4:5}else if(arguments[0]instanceof V&&arguments[1]instanceof V){var s=arguments[0],a=arguments[1],o=a.x-s.x,u=a.y-s.y;if(o===0&&u===0)throw new zt("Cannot compute the octant for two identical points "+s);return oo.octant(o,u)}};var Hi=function(){};Hi.prototype.getCoordinates=function(){};Hi.prototype.size=function(){};Hi.prototype.getCoordinate=function(t){};Hi.prototype.isClosed=function(){};Hi.prototype.setData=function(t){};Hi.prototype.getData=function(){};Hi.prototype.interfaces_=function(){return[]};Hi.prototype.getClass=function(){return Hi};var Uf=function(){};Uf.prototype.addIntersection=function(t,r){};Uf.prototype.interfaces_=function(){return[Hi]};Uf.prototype.getClass=function(){return Uf};var $t=function(){this._nodeList=new Jr(this),this._pts=null,this._data=null;var t=arguments[0],r=arguments[1];this._pts=t,this._data=r};$t.prototype.getCoordinates=function(){return this._pts};$t.prototype.size=function(){return this._pts.length};$t.prototype.getCoordinate=function(t){return this._pts[t]};$t.prototype.isClosed=function(){return this._pts[0].equals(this._pts[this._pts.length-1])};$t.prototype.getSegmentOctant=function(t){return t===this._pts.length-1?-1:this.safeOctant(this.getCoordinate(t),this.getCoordinate(t+1))};$t.prototype.setData=function(t){this._data=t};$t.prototype.safeOctant=function(t,r){return t.equals2D(r)?0:oo.octant(t,r)};$t.prototype.getData=function(){return this._data};$t.prototype.addIntersection=function(){if(arguments.length===2){var t=arguments[0],r=arguments[1];this.addIntersectionNode(t,r)}else if(arguments.length===4){var n=arguments[0],i=arguments[1],s=arguments[3],a=new V(n.getIntersection(s));this.addIntersection(a,i)}};$t.prototype.toString=function(){return Jn.toLineString(new Kt(this._pts))};$t.prototype.getNodeList=function(){return this._nodeList};$t.prototype.addIntersectionNode=function(t,r){var n=r,i=n+1;if(i<this._pts.length){var s=this._pts[i];t.equals2D(s)&&(n=i)}var a=this._nodeList.add(t,n);return a};$t.prototype.addIntersections=function(t,r,n){for(var i=this,s=0;s<t.getIntersectionNum();s++)i.addIntersection(t,r,n,s)};$t.prototype.interfaces_=function(){return[Uf]};$t.prototype.getClass=function(){return $t};$t.getNodedSubstrings=function(){if(arguments.length===1){var t=arguments[0],r=new Q;return $t.getNodedSubstrings(t,r),r}else if(arguments.length===2)for(var n=arguments[0],i=arguments[1],s=n.iterator();s.hasNext();){var a=s.next();a.getNodeList().addSplitEdges(i)}};var oe=function(){if(this.p0=null,this.p1=null,arguments.length===0)this.p0=new V,this.p1=new V;else if(arguments.length===1){var t=arguments[0];this.p0=new V(t.p0),this.p1=new V(t.p1)}else if(arguments.length===2)this.p0=arguments[0],this.p1=arguments[1];else if(arguments.length===4){var r=arguments[0],n=arguments[1],i=arguments[2],s=arguments[3];this.p0=new V(r,n),this.p1=new V(i,s)}},nx={serialVersionUID:{configurable:!0}};oe.prototype.minX=function(){return Math.min(this.p0.x,this.p1.x)};oe.prototype.orientationIndex=function(){if(arguments[0]instanceof oe){var t=arguments[0],r=J.orientationIndex(this.p0,this.p1,t.p0),n=J.orientationIndex(this.p0,this.p1,t.p1);return r>=0&&n>=0||r<=0&&n<=0?Math.max(r,n):0}else if(arguments[0]instanceof V){var i=arguments[0];return J.orientationIndex(this.p0,this.p1,i)}};oe.prototype.toGeometry=function(t){return t.createLineString([this.p0,this.p1])};oe.prototype.isVertical=function(){return this.p0.x===this.p1.x};oe.prototype.equals=function(t){if(!(t instanceof oe))return!1;var r=t;return this.p0.equals(r.p0)&&this.p1.equals(r.p1)};oe.prototype.intersection=function(t){var r=new Oa;return r.computeIntersection(this.p0,this.p1,t.p0,t.p1),r.hasIntersection()?r.getIntersection(0):null};oe.prototype.project=function(){if(arguments[0]instanceof V){var t=arguments[0];if(t.equals(this.p0)||t.equals(this.p1))return new V(t);var r=this.projectionFactor(t),n=new V;return n.x=this.p0.x+r*(this.p1.x-this.p0.x),n.y=this.p0.y+r*(this.p1.y-this.p0.y),n}else if(arguments[0]instanceof oe){var i=arguments[0],s=this.projectionFactor(i.p0),a=this.projectionFactor(i.p1);if(s>=1&&a>=1||s<=0&&a<=0)return null;var o=this.project(i.p0);s<0&&(o=this.p0),s>1&&(o=this.p1);var u=this.project(i.p1);return a<0&&(u=this.p0),a>1&&(u=this.p1),new oe(o,u)}};oe.prototype.normalize=function(){this.p1.compareTo(this.p0)<0&&this.reverse()};oe.prototype.angle=function(){return Math.atan2(this.p1.y-this.p0.y,this.p1.x-this.p0.x)};oe.prototype.getCoordinate=function(t){return t===0?this.p0:this.p1};oe.prototype.distancePerpendicular=function(t){return J.distancePointLinePerpendicular(t,this.p0,this.p1)};oe.prototype.minY=function(){return Math.min(this.p0.y,this.p1.y)};oe.prototype.midPoint=function(){return oe.midPoint(this.p0,this.p1)};oe.prototype.projectionFactor=function(t){if(t.equals(this.p0))return 0;if(t.equals(this.p1))return 1;var r=this.p1.x-this.p0.x,n=this.p1.y-this.p0.y,i=r*r+n*n;if(i<=0)return Ee.NaN;var s=((t.x-this.p0.x)*r+(t.y-this.p0.y)*n)/i;return s};oe.prototype.closestPoints=function(t){var r=this.intersection(t);if(r!==null)return[r,r];var n=new Array(2).fill(null),i=Ee.MAX_VALUE,s=null,a=this.closestPoint(t.p0);i=a.distance(t.p0),n[0]=a,n[1]=t.p0;var o=this.closestPoint(t.p1);s=o.distance(t.p1),s<i&&(i=s,n[0]=o,n[1]=t.p1);var u=t.closestPoint(this.p0);s=u.distance(this.p0),s<i&&(i=s,n[0]=this.p0,n[1]=u);var f=t.closestPoint(this.p1);return s=f.distance(this.p1),s<i&&(i=s,n[0]=this.p1,n[1]=f),n};oe.prototype.closestPoint=function(t){var r=this.projectionFactor(t);if(r>0&&r<1)return this.project(t);var n=this.p0.distance(t),i=this.p1.distance(t);return n<i?this.p0:this.p1};oe.prototype.maxX=function(){return Math.max(this.p0.x,this.p1.x)};oe.prototype.getLength=function(){return this.p0.distance(this.p1)};oe.prototype.compareTo=function(t){var r=t,n=this.p0.compareTo(r.p0);return n!==0?n:this.p1.compareTo(r.p1)};oe.prototype.reverse=function(){var t=this.p0;this.p0=this.p1,this.p1=t};oe.prototype.equalsTopo=function(t){return this.p0.equals(t.p0)&&(this.p1.equals(t.p1)||this.p0.equals(t.p1))&&this.p1.equals(t.p0)};oe.prototype.lineIntersection=function(t){try{var r=Qn.intersection(this.p0,this.p1,t.p0,t.p1);return r}catch(n){if(!(n instanceof Su))throw n}finally{}return null};oe.prototype.maxY=function(){return Math.max(this.p0.y,this.p1.y)};oe.prototype.pointAlongOffset=function(t,r){var n=this.p0.x+t*(this.p1.x-this.p0.x),i=this.p0.y+t*(this.p1.y-this.p0.y),s=this.p1.x-this.p0.x,a=this.p1.y-this.p0.y,o=Math.sqrt(s*s+a*a),u=0,f=0;if(r!==0){if(o<=0)throw new Error("Cannot compute offset from zero-length line segment");u=r*s/o,f=r*a/o}var l=n-f,c=i+u,h=new V(l,c);return h};oe.prototype.setCoordinates=function(){if(arguments.length===1){var t=arguments[0];this.setCoordinates(t.p0,t.p1)}else if(arguments.length===2){var r=arguments[0],n=arguments[1];this.p0.x=r.x,this.p0.y=r.y,this.p1.x=n.x,this.p1.y=n.y}};oe.prototype.segmentFraction=function(t){var r=this.projectionFactor(t);return r<0?r=0:(r>1||Ee.isNaN(r))&&(r=1),r};oe.prototype.toString=function(){return"LINESTRING( "+this.p0.x+" "+this.p0.y+", "+this.p1.x+" "+this.p1.y+")"};oe.prototype.isHorizontal=function(){return this.p0.y===this.p1.y};oe.prototype.distance=function(){if(arguments[0]instanceof oe){var t=arguments[0];return J.distanceLineLine(this.p0,this.p1,t.p0,t.p1)}else if(arguments[0]instanceof V){var r=arguments[0];return J.distancePointLine(r,this.p0,this.p1)}};oe.prototype.pointAlong=function(t){var r=new V;return r.x=this.p0.x+t*(this.p1.x-this.p0.x),r.y=this.p0.y+t*(this.p1.y-this.p0.y),r};oe.prototype.hashCode=function(){var t=Ee.doubleToLongBits(this.p0.x);t^=Ee.doubleToLongBits(this.p0.y)*31;var r=Math.trunc(t)^Math.trunc(t>>32),n=Ee.doubleToLongBits(this.p1.x);n^=Ee.doubleToLongBits(this.p1.y)*31;var i=Math.trunc(n)^Math.trunc(n>>32);return r^i};oe.prototype.interfaces_=function(){return[Hn,Wn]};oe.prototype.getClass=function(){return oe};oe.midPoint=function(t,r){return new V((t.x+r.x)/2,(t.y+r.y)/2)};nx.serialVersionUID.get=function(){return 0x2d2172135f411c00};Object.defineProperties(oe,nx);var Gf=function(){this.tempEnv1=new ae,this.tempEnv2=new ae,this._overlapSeg1=new oe,this._overlapSeg2=new oe};Gf.prototype.overlap=function(){if(arguments.length!==2){if(arguments.length===4){var t=arguments[0],r=arguments[1],n=arguments[2],i=arguments[3];t.getLineSegment(r,this._overlapSeg1),n.getLineSegment(i,this._overlapSeg2),this.overlap(this._overlapSeg1,this._overlapSeg2)}}};Gf.prototype.interfaces_=function(){return[]};Gf.prototype.getClass=function(){return Gf};var _n=function(){this._pts=null,this._start=null,this._end=null,this._env=null,this._context=null,this._id=null;var t=arguments[0],r=arguments[1],n=arguments[2],i=arguments[3];this._pts=t,this._start=r,this._end=n,this._context=i};_n.prototype.getLineSegment=function(t,r){r.p0=this._pts[t],r.p1=this._pts[t+1]};_n.prototype.computeSelect=function(t,r,n,i){var s=this._pts[r],a=this._pts[n];if(i.tempEnv1.init(s,a),n-r===1)return i.select(this,r),null;if(!t.intersects(i.tempEnv1))return null;var o=Math.trunc((r+n)/2);r<o&&this.computeSelect(t,r,o,i),o<n&&this.computeSelect(t,o,n,i)};_n.prototype.getCoordinates=function(){for(var t=this,r=new Array(this._end-this._start+1).fill(null),n=0,i=this._start;i<=this._end;i++)r[n++]=t._pts[i];return r};_n.prototype.computeOverlaps=function(t,r){this.computeOverlapsInternal(this._start,this._end,t,t._start,t._end,r)};_n.prototype.setId=function(t){this._id=t};_n.prototype.select=function(t,r){this.computeSelect(t,this._start,this._end,r)};_n.prototype.getEnvelope=function(){if(this._env===null){var t=this._pts[this._start],r=this._pts[this._end];this._env=new ae(t,r)}return this._env};_n.prototype.getEndIndex=function(){return this._end};_n.prototype.getStartIndex=function(){return this._start};_n.prototype.getContext=function(){return this._context};_n.prototype.getId=function(){return this._id};_n.prototype.computeOverlapsInternal=function(t,r,n,i,s,a){var o=this._pts[t],u=this._pts[r],f=n._pts[i],l=n._pts[s];if(r-t===1&&s-i===1)return a.overlap(this,t,n,i),null;if(a.tempEnv1.init(o,u),a.tempEnv2.init(f,l),!a.tempEnv1.intersects(a.tempEnv2))return null;var c=Math.trunc((t+r)/2),h=Math.trunc((i+s)/2);t<c&&(i<h&&this.computeOverlapsInternal(t,c,n,i,h,a),h<s&&this.computeOverlapsInternal(t,c,n,h,s,a)),c<r&&(i<h&&this.computeOverlapsInternal(c,r,n,i,h,a),h<s&&this.computeOverlapsInternal(c,r,n,h,s,a))};_n.prototype.interfaces_=function(){return[]};_n.prototype.getClass=function(){return _n};var Ci=function(){};Ci.prototype.interfaces_=function(){return[]};Ci.prototype.getClass=function(){return Ci};Ci.getChainStartIndices=function(t){var r=0,n=new Q;n.add(new yi(r));do{var i=Ci.findChainEnd(t,r);n.add(new yi(i)),r=i}while(r<t.length-1);var s=Ci.toIntArray(n);return s};Ci.findChainEnd=function(t,r){for(var n=r;n<t.length-1&&t[n].equals2D(t[n+1]);)n++;if(n>=t.length-1)return t.length-1;for(var i=Tt.quadrant(t[n],t[n+1]),s=r+1;s<t.length;){if(!t[s-1].equals2D(t[s])){var a=Tt.quadrant(t[s-1],t[s]);if(a!==i)break}s++}return s-1};Ci.getChains=function(){if(arguments.length===1){var t=arguments[0];return Ci.getChains(t,null)}else if(arguments.length===2){for(var r=arguments[0],n=arguments[1],i=new Q,s=Ci.getChainStartIndices(r),a=0;a<s.length-1;a++){var o=new _n(r,s[a],s[a+1],n);i.add(o)}return i}};Ci.toIntArray=function(t){for(var r=new Array(t.size()).fill(null),n=0;n<r.length;n++)r[n]=t.get(n).intValue();return r};var Sa=function(){};Sa.prototype.computeNodes=function(t){};Sa.prototype.getNodedSubstrings=function(){};Sa.prototype.interfaces_=function(){return[]};Sa.prototype.getClass=function(){return Sa};var qf=function(){if(this._segInt=null,arguments.length!==0){if(arguments.length===1){var t=arguments[0];this.setSegmentIntersector(t)}}};qf.prototype.setSegmentIntersector=function(t){this._segInt=t};qf.prototype.interfaces_=function(){return[Sa]};qf.prototype.getClass=function(){return qf};var Np=function(e){function t(n){n?e.call(this,n):e.call(this),this._monoChains=new Q,this._index=new rx,this._idCounter=0,this._nodedSegStrings=null,this._nOverlaps=0}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var r={SegmentOverlapAction:{configurable:!0}};return t.prototype.getMonotoneChains=function(){return this._monoChains},t.prototype.getNodedSubstrings=function(){return $t.getNodedSubstrings(this._nodedSegStrings)},t.prototype.getIndex=function(){return this._index},t.prototype.add=function(i){for(var s=this,a=Ci.getChains(i.getCoordinates(),i),o=a.iterator();o.hasNext();){var u=o.next();u.setId(s._idCounter++),s._index.insert(u.getEnvelope(),u),s._monoChains.add(u)}},t.prototype.computeNodes=function(i){var s=this;this._nodedSegStrings=i;for(var a=i.iterator();a.hasNext();)s.add(a.next());this.intersectChains()},t.prototype.intersectChains=function(){for(var i=this,s=new fy(this._segInt),a=this._monoChains.iterator();a.hasNext();)for(var o=a.next(),u=i._index.query(o.getEnvelope()),f=u.iterator();f.hasNext();){var l=f.next();if(l.getId()>o.getId()&&(o.computeOverlaps(l,s),i._nOverlaps++),i._segInt.isDone())return null}},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},r.SegmentOverlapAction.get=function(){return fy},Object.defineProperties(t,r),t}(qf),fy=function(e){function t(){e.call(this),this._si=null;var r=arguments[0];this._si=r}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.overlap=function(){if(arguments.length===4){var n=arguments[0],i=arguments[1],s=arguments[2],a=arguments[3],o=n.getContext(),u=s.getContext();this._si.processIntersections(o,i,u,a)}else return e.prototype.overlap.apply(this,arguments)},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(Gf),pt=function e(){if(this._quadrantSegments=e.DEFAULT_QUADRANT_SEGMENTS,this._endCapStyle=e.CAP_ROUND,this._joinStyle=e.JOIN_ROUND,this._mitreLimit=e.DEFAULT_MITRE_LIMIT,this._isSingleSided=!1,this._simplifyFactor=e.DEFAULT_SIMPLIFY_FACTOR,arguments.length!==0){if(arguments.length===1){var t=arguments[0];this.setQuadrantSegments(t)}else if(arguments.length===2){var r=arguments[0],n=arguments[1];this.setQuadrantSegments(r),this.setEndCapStyle(n)}else if(arguments.length===4){var i=arguments[0],s=arguments[1],a=arguments[2],o=arguments[3];this.setQuadrantSegments(i),this.setEndCapStyle(s),this.setJoinStyle(a),this.setMitreLimit(o)}}},xs={CAP_ROUND:{configurable:!0},CAP_FLAT:{configurable:!0},CAP_SQUARE:{configurable:!0},JOIN_ROUND:{configurable:!0},JOIN_MITRE:{configurable:!0},JOIN_BEVEL:{configurable:!0},DEFAULT_QUADRANT_SEGMENTS:{configurable:!0},DEFAULT_MITRE_LIMIT:{configurable:!0},DEFAULT_SIMPLIFY_FACTOR:{configurable:!0}};pt.prototype.getEndCapStyle=function(){return this._endCapStyle};pt.prototype.isSingleSided=function(){return this._isSingleSided};pt.prototype.setQuadrantSegments=function(t){this._quadrantSegments=t,this._quadrantSegments===0&&(this._joinStyle=pt.JOIN_BEVEL),this._quadrantSegments<0&&(this._joinStyle=pt.JOIN_MITRE,this._mitreLimit=Math.abs(this._quadrantSegments)),t<=0&&(this._quadrantSegments=1),this._joinStyle!==pt.JOIN_ROUND&&(this._quadrantSegments=pt.DEFAULT_QUADRANT_SEGMENTS)};pt.prototype.getJoinStyle=function(){return this._joinStyle};pt.prototype.setJoinStyle=function(t){this._joinStyle=t};pt.prototype.setSimplifyFactor=function(t){this._simplifyFactor=t<0?0:t};pt.prototype.getSimplifyFactor=function(){return this._simplifyFactor};pt.prototype.getQuadrantSegments=function(){return this._quadrantSegments};pt.prototype.setEndCapStyle=function(t){this._endCapStyle=t};pt.prototype.getMitreLimit=function(){return this._mitreLimit};pt.prototype.setMitreLimit=function(t){this._mitreLimit=t};pt.prototype.setSingleSided=function(t){this._isSingleSided=t};pt.prototype.interfaces_=function(){return[]};pt.prototype.getClass=function(){return pt};pt.bufferDistanceError=function(t){var r=Math.PI/2/t;return 1-Math.cos(r/2)};xs.CAP_ROUND.get=function(){return 1};xs.CAP_FLAT.get=function(){return 2};xs.CAP_SQUARE.get=function(){return 3};xs.JOIN_ROUND.get=function(){return 1};xs.JOIN_MITRE.get=function(){return 2};xs.JOIN_BEVEL.get=function(){return 3};xs.DEFAULT_QUADRANT_SEGMENTS.get=function(){return 8};xs.DEFAULT_MITRE_LIMIT.get=function(){return 5};xs.DEFAULT_SIMPLIFY_FACTOR.get=function(){return .01};Object.defineProperties(pt,xs);var Yt=function(t){this._distanceTol=null,this._isDeleted=null,this._angleOrientation=J.COUNTERCLOCKWISE,this._inputLine=t||null},al={INIT:{configurable:!0},DELETE:{configurable:!0},KEEP:{configurable:!0},NUM_PTS_TO_CHECK:{configurable:!0}};Yt.prototype.isDeletable=function(t,r,n,i){var s=this._inputLine[t],a=this._inputLine[r],o=this._inputLine[n];return!this.isConcave(s,a,o)||!this.isShallow(s,a,o,i)?!1:this.isShallowSampled(s,a,t,n,i)};Yt.prototype.deleteShallowConcavities=function(){for(var t=this,r=1,n=this.findNextNonDeletedIndex(r),i=this.findNextNonDeletedIndex(n),s=!1;i<this._inputLine.length;){var a=!1;t.isDeletable(r,n,i,t._distanceTol)&&(t._isDeleted[n]=Yt.DELETE,a=!0,s=!0),a?r=i:r=n,n=t.findNextNonDeletedIndex(r),i=t.findNextNonDeletedIndex(n)}return s};Yt.prototype.isShallowConcavity=function(t,r,n,i){var s=J.computeOrientation(t,r,n),a=s===this._angleOrientation;if(!a)return!1;var o=J.distancePointLine(r,t,n);return o<i};Yt.prototype.isShallowSampled=function(t,r,n,i,s){var a=this,o=Math.trunc((i-n)/Yt.NUM_PTS_TO_CHECK);o<=0&&(o=1);for(var u=n;u<i;u+=o)if(!a.isShallow(t,r,a._inputLine[u],s))return!1;return!0};Yt.prototype.isConcave=function(t,r,n){var i=J.computeOrientation(t,r,n),s=i===this._angleOrientation;return s};Yt.prototype.simplify=function(t){var r=this;this._distanceTol=Math.abs(t),t<0&&(this._angleOrientation=J.CLOCKWISE),this._isDeleted=new Array(this._inputLine.length).fill(null);var n=!1;do n=r.deleteShallowConcavities();while(n);return this.collapseLine()};Yt.prototype.findNextNonDeletedIndex=function(t){for(var r=t+1;r<this._inputLine.length&&this._isDeleted[r]===Yt.DELETE;)r++;return r};Yt.prototype.isShallow=function(t,r,n,i){var s=J.distancePointLine(r,t,n);return s<i};Yt.prototype.collapseLine=function(){for(var t=this,r=new rl,n=0;n<this._inputLine.length;n++)t._isDeleted[n]!==Yt.DELETE&&r.add(t._inputLine[n]);return r.toCoordinateArray()};Yt.prototype.interfaces_=function(){return[]};Yt.prototype.getClass=function(){return Yt};Yt.simplify=function(t,r){var n=new Yt(t);return n.simplify(r)};al.INIT.get=function(){return 0};al.DELETE.get=function(){return 1};al.KEEP.get=function(){return 1};al.NUM_PTS_TO_CHECK.get=function(){return 10};Object.defineProperties(Yt,al);var Pn=function(){this._ptList=null,this._precisionModel=null,this._minimimVertexDistance=0,this._ptList=new Q},ix={COORDINATE_ARRAY_TYPE:{configurable:!0}};Pn.prototype.getCoordinates=function(){var t=this._ptList.toArray(Pn.COORDINATE_ARRAY_TYPE);return t};Pn.prototype.setPrecisionModel=function(t){this._precisionModel=t};Pn.prototype.addPt=function(t){var r=new V(t);if(this._precisionModel.makePrecise(r),this.isRedundant(r))return null;this._ptList.add(r)};Pn.prototype.revere=function(){};Pn.prototype.addPts=function(t,r){var n=this;if(r)for(var i=0;i<t.length;i++)n.addPt(t[i]);else for(var s=t.length-1;s>=0;s--)n.addPt(t[s])};Pn.prototype.isRedundant=function(t){if(this._ptList.size()<1)return!1;var r=this._ptList.get(this._ptList.size()-1),n=t.distance(r);return n<this._minimimVertexDistance};Pn.prototype.toString=function(){var t=new Pe,r=t.createLineString(this.getCoordinates());return r.toString()};Pn.prototype.closeRing=function(){if(this._ptList.size()<1)return null;var t=new V(this._ptList.get(0)),r=this._ptList.get(this._ptList.size()-1);if(t.equals(r))return null;this._ptList.add(t)};Pn.prototype.setMinimumVertexDistance=function(t){this._minimimVertexDistance=t};Pn.prototype.interfaces_=function(){return[]};Pn.prototype.getClass=function(){return Pn};ix.COORDINATE_ARRAY_TYPE.get=function(){return new Array(0).fill(null)};Object.defineProperties(Pn,ix);var Fe=function(){},xo={PI_TIMES_2:{configurable:!0},PI_OVER_2:{configurable:!0},PI_OVER_4:{configurable:!0},COUNTERCLOCKWISE:{configurable:!0},CLOCKWISE:{configurable:!0},NONE:{configurable:!0}};Fe.prototype.interfaces_=function(){return[]};Fe.prototype.getClass=function(){return Fe};Fe.toDegrees=function(t){return t*180/Math.PI};Fe.normalize=function(t){for(;t>Math.PI;)t-=Fe.PI_TIMES_2;for(;t<=-Math.PI;)t+=Fe.PI_TIMES_2;return t};Fe.angle=function(){if(arguments.length===1){var t=arguments[0];return Math.atan2(t.y,t.x)}else if(arguments.length===2){var r=arguments[0],n=arguments[1],i=n.x-r.x,s=n.y-r.y;return Math.atan2(s,i)}};Fe.isAcute=function(t,r,n){var i=t.x-r.x,s=t.y-r.y,a=n.x-r.x,o=n.y-r.y,u=i*a+s*o;return u>0};Fe.isObtuse=function(t,r,n){var i=t.x-r.x,s=t.y-r.y,a=n.x-r.x,o=n.y-r.y,u=i*a+s*o;return u<0};Fe.interiorAngle=function(t,r,n){var i=Fe.angle(r,t),s=Fe.angle(r,n);return Math.abs(s-i)};Fe.normalizePositive=function(t){if(t<0){for(;t<0;)t+=Fe.PI_TIMES_2;t>=Fe.PI_TIMES_2&&(t=0)}else{for(;t>=Fe.PI_TIMES_2;)t-=Fe.PI_TIMES_2;t<0&&(t=0)}return t};Fe.angleBetween=function(t,r,n){var i=Fe.angle(r,t),s=Fe.angle(r,n);return Fe.diff(i,s)};Fe.diff=function(t,r){var n=null;return t<r?n=r-t:n=t-r,n>Math.PI&&(n=2*Math.PI-n),n};Fe.toRadians=function(t){return t*Math.PI/180};Fe.getTurn=function(t,r){var n=Math.sin(r-t);return n>0?Fe.COUNTERCLOCKWISE:n<0?Fe.CLOCKWISE:Fe.NONE};Fe.angleBetweenOriented=function(t,r,n){var i=Fe.angle(r,t),s=Fe.angle(r,n),a=s-i;return a<=-Math.PI?a+Fe.PI_TIMES_2:a>Math.PI?a-Fe.PI_TIMES_2:a};xo.PI_TIMES_2.get=function(){return 2*Math.PI};xo.PI_OVER_2.get=function(){return Math.PI/2};xo.PI_OVER_4.get=function(){return Math.PI/4};xo.COUNTERCLOCKWISE.get=function(){return J.COUNTERCLOCKWISE};xo.CLOCKWISE.get=function(){return J.CLOCKWISE};xo.NONE.get=function(){return J.COLLINEAR};Object.defineProperties(Fe,xo);var Ft=function e(){this._maxCurveSegmentError=0,this._filletAngleQuantum=null,this._closingSegLengthFactor=1,this._segList=null,this._distance=0,this._precisionModel=null,this._bufParams=null,this._li=null,this._s0=null,this._s1=null,this._s2=null,this._seg0=new oe,this._seg1=new oe,this._offset0=new oe,this._offset1=new oe,this._side=0,this._hasNarrowConcaveAngle=!1;var t=arguments[0],r=arguments[1],n=arguments[2];this._precisionModel=t,this._bufParams=r,this._li=new Oa,this._filletAngleQuantum=Math.PI/2/r.getQuadrantSegments(),r.getQuadrantSegments()>=8&&r.getJoinStyle()===pt.JOIN_ROUND&&(this._closingSegLengthFactor=e.MAX_CLOSING_SEG_LEN_FACTOR),this.init(n)},ol={OFFSET_SEGMENT_SEPARATION_FACTOR:{configurable:!0},INSIDE_TURN_VERTEX_SNAP_DISTANCE_FACTOR:{configurable:!0},CURVE_VERTEX_SNAP_DISTANCE_FACTOR:{configurable:!0},MAX_CLOSING_SEG_LEN_FACTOR:{configurable:!0}};Ft.prototype.addNextSegment=function(t,r){if(this._s0=this._s1,this._s1=this._s2,this._s2=t,this._seg0.setCoordinates(this._s0,this._s1),this.computeOffsetSegment(this._seg0,this._side,this._distance,this._offset0),this._seg1.setCoordinates(this._s1,this._s2),this.computeOffsetSegment(this._seg1,this._side,this._distance,this._offset1),this._s1.equals(this._s2))return null;var n=J.computeOrientation(this._s0,this._s1,this._s2),i=n===J.CLOCKWISE&&this._side===j.LEFT||n===J.COUNTERCLOCKWISE&&this._side===j.RIGHT;n===0?this.addCollinear(r):i?this.addOutsideTurn(n,r):this.addInsideTurn(n,r)};Ft.prototype.addLineEndCap=function(t,r){var n=new oe(t,r),i=new oe;this.computeOffsetSegment(n,j.LEFT,this._distance,i);var s=new oe;this.computeOffsetSegment(n,j.RIGHT,this._distance,s);var a=r.x-t.x,o=r.y-t.y,u=Math.atan2(o,a);switch(this._bufParams.getEndCapStyle()){case pt.CAP_ROUND:this._segList.addPt(i.p1),this.addFilletArc(r,u+Math.PI/2,u-Math.PI/2,J.CLOCKWISE,this._distance),this._segList.addPt(s.p1);break;case pt.CAP_FLAT:this._segList.addPt(i.p1),this._segList.addPt(s.p1);break;case pt.CAP_SQUARE:var f=new V;f.x=Math.abs(this._distance)*Math.cos(u),f.y=Math.abs(this._distance)*Math.sin(u);var l=new V(i.p1.x+f.x,i.p1.y+f.y),c=new V(s.p1.x+f.x,s.p1.y+f.y);this._segList.addPt(l),this._segList.addPt(c);break;default:}};Ft.prototype.getCoordinates=function(){var t=this._segList.getCoordinates();return t};Ft.prototype.addMitreJoin=function(t,r,n,i){var s=!0,a=null;try{a=Qn.intersection(r.p0,r.p1,n.p0,n.p1);var o=i<=0?1:a.distance(t)/Math.abs(i);o>this._bufParams.getMitreLimit()&&(s=!1)}catch(u){if(u instanceof Su)a=new V(0,0),s=!1;else throw u}finally{}s?this._segList.addPt(a):this.addLimitedMitreJoin(r,n,i,this._bufParams.getMitreLimit())};Ft.prototype.addFilletCorner=function(t,r,n,i,s){var a=r.x-t.x,o=r.y-t.y,u=Math.atan2(o,a),f=n.x-t.x,l=n.y-t.y,c=Math.atan2(l,f);i===J.CLOCKWISE?u<=c&&(u+=2*Math.PI):u>=c&&(u-=2*Math.PI),this._segList.addPt(r),this.addFilletArc(t,u,c,i,s),this._segList.addPt(n)};Ft.prototype.addOutsideTurn=function(t,r){if(this._offset0.p1.distance(this._offset1.p0)<this._distance*Ft.OFFSET_SEGMENT_SEPARATION_FACTOR)return this._segList.addPt(this._offset0.p1),null;this._bufParams.getJoinStyle()===pt.JOIN_MITRE?this.addMitreJoin(this._s1,this._offset0,this._offset1,this._distance):this._bufParams.getJoinStyle()===pt.JOIN_BEVEL?this.addBevelJoin(this._offset0,this._offset1):(r&&this._segList.addPt(this._offset0.p1),this.addFilletCorner(this._s1,this._offset0.p1,this._offset1.p0,t,this._distance),this._segList.addPt(this._offset1.p0))};Ft.prototype.createSquare=function(t){this._segList.addPt(new V(t.x+this._distance,t.y+this._distance)),this._segList.addPt(new V(t.x+this._distance,t.y-this._distance)),this._segList.addPt(new V(t.x-this._distance,t.y-this._distance)),this._segList.addPt(new V(t.x-this._distance,t.y+this._distance)),this._segList.closeRing()};Ft.prototype.addSegments=function(t,r){this._segList.addPts(t,r)};Ft.prototype.addFirstSegment=function(){this._segList.addPt(this._offset1.p0)};Ft.prototype.addLastSegment=function(){this._segList.addPt(this._offset1.p1)};Ft.prototype.initSideSegments=function(t,r,n){this._s1=t,this._s2=r,this._side=n,this._seg1.setCoordinates(t,r),this.computeOffsetSegment(this._seg1,n,this._distance,this._offset1)};Ft.prototype.addLimitedMitreJoin=function(t,r,n,i){var s=this._seg0.p1,a=Fe.angle(s,this._seg0.p0),o=Fe.angleBetweenOriented(this._seg0.p0,s,this._seg1.p1),u=o/2,f=Fe.normalize(a+u),l=Fe.normalize(f+Math.PI),c=i*n,h=c*Math.abs(Math.sin(u)),d=n-h,m=s.x+c*Math.cos(l),g=s.y+c*Math.sin(l),p=new V(m,g),v=new oe(s,p),_=v.pointAlongOffset(1,d),y=v.pointAlongOffset(1,-d);this._side===j.LEFT?(this._segList.addPt(_),this._segList.addPt(y)):(this._segList.addPt(y),this._segList.addPt(_))};Ft.prototype.computeOffsetSegment=function(t,r,n,i){var s=r===j.LEFT?1:-1,a=t.p1.x-t.p0.x,o=t.p1.y-t.p0.y,u=Math.sqrt(a*a+o*o),f=s*n*a/u,l=s*n*o/u;i.p0.x=t.p0.x-l,i.p0.y=t.p0.y+f,i.p1.x=t.p1.x-l,i.p1.y=t.p1.y+f};Ft.prototype.addFilletArc=function(t,r,n,i,s){var a=this,o=i===J.CLOCKWISE?-1:1,u=Math.abs(r-n),f=Math.trunc(u/this._filletAngleQuantum+.5);if(f<1)return null;for(var l=0,c=u/f,h=l,d=new V;h<u;){var m=r+o*h;d.x=t.x+s*Math.cos(m),d.y=t.y+s*Math.sin(m),a._segList.addPt(d),h+=c}};Ft.prototype.addInsideTurn=function(t,r){if(this._li.computeIntersection(this._offset0.p0,this._offset0.p1,this._offset1.p0,this._offset1.p1),this._li.hasIntersection())this._segList.addPt(this._li.getIntersection(0));else if(this._hasNarrowConcaveAngle=!0,this._offset0.p1.distance(this._offset1.p0)<this._distance*Ft.INSIDE_TURN_VERTEX_SNAP_DISTANCE_FACTOR)this._segList.addPt(this._offset0.p1);else{if(this._segList.addPt(this._offset0.p1),this._closingSegLengthFactor>0){var n=new V((this._closingSegLengthFactor*this._offset0.p1.x+this._s1.x)/(this._closingSegLengthFactor+1),(this._closingSegLengthFactor*this._offset0.p1.y+this._s1.y)/(this._closingSegLengthFactor+1));this._segList.addPt(n);var i=new V((this._closingSegLengthFactor*this._offset1.p0.x+this._s1.x)/(this._closingSegLengthFactor+1),(this._closingSegLengthFactor*this._offset1.p0.y+this._s1.y)/(this._closingSegLengthFactor+1));this._segList.addPt(i)}else this._segList.addPt(this._s1);this._segList.addPt(this._offset1.p0)}};Ft.prototype.createCircle=function(t){var r=new V(t.x+this._distance,t.y);this._segList.addPt(r),this.addFilletArc(t,0,2*Math.PI,-1,this._distance),this._segList.closeRing()};Ft.prototype.addBevelJoin=function(t,r){this._segList.addPt(t.p1),this._segList.addPt(r.p0)};Ft.prototype.init=function(t){this._distance=t,this._maxCurveSegmentError=t*(1-Math.cos(this._filletAngleQuantum/2)),this._segList=new Pn,this._segList.setPrecisionModel(this._precisionModel),this._segList.setMinimumVertexDistance(t*Ft.CURVE_VERTEX_SNAP_DISTANCE_FACTOR)};Ft.prototype.addCollinear=function(t){this._li.computeIntersection(this._s0,this._s1,this._s1,this._s2);var r=this._li.getIntersectionNum();r>=2&&(this._bufParams.getJoinStyle()===pt.JOIN_BEVEL||this._bufParams.getJoinStyle()===pt.JOIN_MITRE?(t&&this._segList.addPt(this._offset0.p1),this._segList.addPt(this._offset1.p0)):this.addFilletCorner(this._s1,this._offset0.p1,this._offset1.p0,J.CLOCKWISE,this._distance))};Ft.prototype.closeRing=function(){this._segList.closeRing()};Ft.prototype.hasNarrowConcaveAngle=function(){return this._hasNarrowConcaveAngle};Ft.prototype.interfaces_=function(){return[]};Ft.prototype.getClass=function(){return Ft};ol.OFFSET_SEGMENT_SEPARATION_FACTOR.get=function(){return .001};ol.INSIDE_TURN_VERTEX_SNAP_DISTANCE_FACTOR.get=function(){return .001};ol.CURVE_VERTEX_SNAP_DISTANCE_FACTOR.get=function(){return 1e-6};ol.MAX_CLOSING_SEG_LEN_FACTOR.get=function(){return 80};Object.defineProperties(Ft,ol);var an=function(){this._distance=0,this._precisionModel=null,this._bufParams=null;var t=arguments[0],r=arguments[1];this._precisionModel=t,this._bufParams=r};an.prototype.getOffsetCurve=function(t,r){if(this._distance=r,r===0)return null;var n=r<0,i=Math.abs(r),s=this.getSegGen(i);t.length<=1?this.computePointCurve(t[0],s):this.computeOffsetCurve(t,n,s);var a=s.getCoordinates();return n&&Me.reverse(a),a};an.prototype.computeSingleSidedBufferCurve=function(t,r,n){var i=this.simplifyTolerance(this._distance);if(r){n.addSegments(t,!0);var s=Yt.simplify(t,-i),a=s.length-1;n.initSideSegments(s[a],s[a-1],j.LEFT),n.addFirstSegment();for(var o=a-2;o>=0;o--)n.addNextSegment(s[o],!0)}else{n.addSegments(t,!1);var u=Yt.simplify(t,i),f=u.length-1;n.initSideSegments(u[0],u[1],j.LEFT),n.addFirstSegment();for(var l=2;l<=f;l++)n.addNextSegment(u[l],!0)}n.addLastSegment(),n.closeRing()};an.prototype.computeRingBufferCurve=function(t,r,n){var i=this.simplifyTolerance(this._distance);r===j.RIGHT&&(i=-i);var s=Yt.simplify(t,i),a=s.length-1;n.initSideSegments(s[a-1],s[0],r);for(var o=1;o<=a;o++){var u=o!==1;n.addNextSegment(s[o],u)}n.closeRing()};an.prototype.computeLineBufferCurve=function(t,r){var n=this.simplifyTolerance(this._distance),i=Yt.simplify(t,n),s=i.length-1;r.initSideSegments(i[0],i[1],j.LEFT);for(var a=2;a<=s;a++)r.addNextSegment(i[a],!0);r.addLastSegment(),r.addLineEndCap(i[s-1],i[s]);var o=Yt.simplify(t,-n),u=o.length-1;r.initSideSegments(o[u],o[u-1],j.LEFT);for(var f=u-2;f>=0;f--)r.addNextSegment(o[f],!0);r.addLastSegment(),r.addLineEndCap(o[1],o[0]),r.closeRing()};an.prototype.computePointCurve=function(t,r){switch(this._bufParams.getEndCapStyle()){case pt.CAP_ROUND:r.createCircle(t);break;case pt.CAP_SQUARE:r.createSquare(t);break;default:}};an.prototype.getLineCurve=function(t,r){if(this._distance=r,r<0&&!this._bufParams.isSingleSided()||r===0)return null;var n=Math.abs(r),i=this.getSegGen(n);if(t.length<=1)this.computePointCurve(t[0],i);else if(this._bufParams.isSingleSided()){var s=r<0;this.computeSingleSidedBufferCurve(t,s,i)}else this.computeLineBufferCurve(t,i);var a=i.getCoordinates();return a};an.prototype.getBufferParameters=function(){return this._bufParams};an.prototype.simplifyTolerance=function(t){return t*this._bufParams.getSimplifyFactor()};an.prototype.getRingCurve=function(t,r,n){if(this._distance=n,t.length<=2)return this.getLineCurve(t,n);if(n===0)return an.copyCoordinates(t);var i=this.getSegGen(n);return this.computeRingBufferCurve(t,r,i),i.getCoordinates()};an.prototype.computeOffsetCurve=function(t,r,n){var i=this.simplifyTolerance(this._distance);if(r){var s=Yt.simplify(t,-i),a=s.length-1;n.initSideSegments(s[a],s[a-1],j.LEFT),n.addFirstSegment();for(var o=a-2;o>=0;o--)n.addNextSegment(s[o],!0)}else{var u=Yt.simplify(t,i),f=u.length-1;n.initSideSegments(u[0],u[1],j.LEFT),n.addFirstSegment();for(var l=2;l<=f;l++)n.addNextSegment(u[l],!0)}n.addLastSegment()};an.prototype.getSegGen=function(t){return new Ft(this._precisionModel,this._bufParams,t)};an.prototype.interfaces_=function(){return[]};an.prototype.getClass=function(){return an};an.copyCoordinates=function(t){for(var r=new Array(t.length).fill(null),n=0;n<r.length;n++)r[n]=new V(t[n]);return r};var uo=function(){this._subgraphs=null,this._seg=new oe,this._cga=new J;var t=arguments[0];this._subgraphs=t},sx={DepthSegment:{configurable:!0}};uo.prototype.findStabbedSegments=function(){var t=this;if(arguments.length===1){for(var r=arguments[0],n=new Q,i=this._subgraphs.iterator();i.hasNext();){var s=i.next(),a=s.getEnvelope();r.y<a.getMinY()||r.y>a.getMaxY()||t.findStabbedSegments(r,s.getDirectedEdges(),n)}return n}else if(arguments.length===3){if(pe(arguments[2],Zn)&&arguments[0]instanceof V&&arguments[1]instanceof Ym)for(var o=arguments[0],u=arguments[1],f=arguments[2],l=u.getEdge().getCoordinates(),c=0;c<l.length-1;c++){t._seg.p0=l[c],t._seg.p1=l[c+1],t._seg.p0.y>t._seg.p1.y&&t._seg.reverse();var h=Math.max(t._seg.p0.x,t._seg.p1.x);if(!(h<o.x)&&!t._seg.isHorizontal()&&!(o.y<t._seg.p0.y||o.y>t._seg.p1.y)&&J.computeOrientation(t._seg.p0,t._seg.p1,o)!==J.RIGHT){var d=u.getDepth(j.LEFT);t._seg.p0.equals(l[c])||(d=u.getDepth(j.RIGHT));var m=new Ta(t._seg,d);f.add(m)}}else if(pe(arguments[2],Zn)&&arguments[0]instanceof V&&pe(arguments[1],Zn))for(var g=arguments[0],p=arguments[1],v=arguments[2],_=p.iterator();_.hasNext();){var y=_.next();y.isForward()&&t.findStabbedSegments(g,y,v)}}};uo.prototype.getDepth=function(t){var r=this.findStabbedSegments(t);if(r.size()===0)return 0;var n=ti.min(r);return n._leftDepth};uo.prototype.interfaces_=function(){return[]};uo.prototype.getClass=function(){return uo};sx.DepthSegment.get=function(){return Ta};Object.defineProperties(uo,sx);var Ta=function(){this._upwardSeg=null,this._leftDepth=null;var t=arguments[0],r=arguments[1];this._upwardSeg=new oe(t),this._leftDepth=r};Ta.prototype.compareTo=function(t){var r=t;if(this._upwardSeg.minX()>=r._upwardSeg.maxX())return 1;if(this._upwardSeg.maxX()<=r._upwardSeg.minX())return-1;var n=this._upwardSeg.orientationIndex(r._upwardSeg);return n!==0||(n=-1*r._upwardSeg.orientationIndex(this._upwardSeg),n!==0)?n:this._upwardSeg.compareTo(r._upwardSeg)};Ta.prototype.compareX=function(t,r){var n=t.p0.compareTo(r.p0);return n!==0?n:t.p1.compareTo(r.p1)};Ta.prototype.toString=function(){return this._upwardSeg.toString()};Ta.prototype.interfaces_=function(){return[Hn]};Ta.prototype.getClass=function(){return Ta};var _t=function(t,r,n){this.p0=t||null,this.p1=r||null,this.p2=n||null};_t.prototype.area=function(){return _t.area(this.p0,this.p1,this.p2)};_t.prototype.signedArea=function(){return _t.signedArea(this.p0,this.p1,this.p2)};_t.prototype.interpolateZ=function(t){if(t===null)throw new zt("Supplied point is null.");return _t.interpolateZ(t,this.p0,this.p1,this.p2)};_t.prototype.longestSideLength=function(){return _t.longestSideLength(this.p0,this.p1,this.p2)};_t.prototype.isAcute=function(){return _t.isAcute(this.p0,this.p1,this.p2)};_t.prototype.circumcentre=function(){return _t.circumcentre(this.p0,this.p1,this.p2)};_t.prototype.area3D=function(){return _t.area3D(this.p0,this.p1,this.p2)};_t.prototype.centroid=function(){return _t.centroid(this.p0,this.p1,this.p2)};_t.prototype.inCentre=function(){return _t.inCentre(this.p0,this.p1,this.p2)};_t.prototype.interfaces_=function(){return[]};_t.prototype.getClass=function(){return _t};_t.area=function(t,r,n){return Math.abs(((n.x-t.x)*(r.y-t.y)-(r.x-t.x)*(n.y-t.y))/2)};_t.signedArea=function(t,r,n){return((n.x-t.x)*(r.y-t.y)-(r.x-t.x)*(n.y-t.y))/2};_t.det=function(t,r,n,i){return t*i-r*n};_t.interpolateZ=function(t,r,n,i){var s=r.x,a=r.y,o=n.x-s,u=i.x-s,f=n.y-a,l=i.y-a,c=o*l-u*f,h=t.x-s,d=t.y-a,m=(l*h-u*d)/c,g=(-f*h+o*d)/c,p=r.z+m*(n.z-r.z)+g*(i.z-r.z);return p};_t.longestSideLength=function(t,r,n){var i=t.distance(r),s=r.distance(n),a=n.distance(t),o=i;return s>o&&(o=s),a>o&&(o=a),o};_t.isAcute=function(t,r,n){return!(!Fe.isAcute(t,r,n)||!Fe.isAcute(r,n,t)||!Fe.isAcute(n,t,r))};_t.circumcentre=function(t,r,n){var i=n.x,s=n.y,a=t.x-i,o=t.y-s,u=r.x-i,f=r.y-s,l=2*_t.det(a,o,u,f),c=_t.det(o,a*a+o*o,f,u*u+f*f),h=_t.det(a,a*a+o*o,u,u*u+f*f),d=i-c/l,m=s+h/l;return new V(d,m)};_t.perpendicularBisector=function(t,r){var n=r.x-t.x,i=r.y-t.y,s=new Qn(t.x+n/2,t.y+i/2,1),a=new Qn(t.x-i+n/2,t.y+n+i/2,1);return new Qn(s,a)};_t.angleBisector=function(t,r,n){var i=r.distance(t),s=r.distance(n),a=i/(i+s),o=n.x-t.x,u=n.y-t.y,f=new V(t.x+a*o,t.y+a*u);return f};_t.area3D=function(t,r,n){var i=r.x-t.x,s=r.y-t.y,a=r.z-t.z,o=n.x-t.x,u=n.y-t.y,f=n.z-t.z,l=s*f-a*u,c=a*o-i*f,h=i*u-s*o,d=l*l+c*c+h*h,m=Math.sqrt(d)/2;return m};_t.centroid=function(t,r,n){var i=(t.x+r.x+n.x)/3,s=(t.y+r.y+n.y)/3;return new V(i,s)};_t.inCentre=function(t,r,n){var i=r.distance(n),s=t.distance(n),a=t.distance(r),o=i+s+a,u=(i*t.x+s*r.x+a*n.x)/o,f=(i*t.y+s*r.y+a*n.y)/o;return new V(u,f)};var qn=function(){this._inputGeom=null,this._distance=null,this._curveBuilder=null,this._curveList=new Q;var t=arguments[0],r=arguments[1],n=arguments[2];this._inputGeom=t,this._distance=r,this._curveBuilder=n};qn.prototype.addPoint=function(t){if(this._distance<=0)return null;var r=t.getCoordinates(),n=this._curveBuilder.getLineCurve(r,this._distance);this.addCurve(n,z.EXTERIOR,z.INTERIOR)};qn.prototype.addPolygon=function(t){var r=this,n=this._distance,i=j.LEFT;this._distance<0&&(n=-this._distance,i=j.RIGHT);var s=t.getExteriorRing(),a=Me.removeRepeatedPoints(s.getCoordinates());if(this._distance<0&&this.isErodedCompletely(s,this._distance)||this._distance<=0&&a.length<3)return null;this.addPolygonRing(a,n,i,z.EXTERIOR,z.INTERIOR);for(var o=0;o<t.getNumInteriorRing();o++){var u=t.getInteriorRingN(o),f=Me.removeRepeatedPoints(u.getCoordinates());r._distance>0&&r.isErodedCompletely(u,-r._distance)||r.addPolygonRing(f,n,j.opposite(i),z.INTERIOR,z.EXTERIOR)}};qn.prototype.isTriangleErodedCompletely=function(t,r){var n=new _t(t[0],t[1],t[2]),i=n.inCentre(),s=J.distancePointLine(i,n.p0,n.p1);return s<Math.abs(r)};qn.prototype.addLineString=function(t){if(this._distance<=0&&!this._curveBuilder.getBufferParameters().isSingleSided())return null;var r=Me.removeRepeatedPoints(t.getCoordinates()),n=this._curveBuilder.getLineCurve(r,this._distance);this.addCurve(n,z.EXTERIOR,z.INTERIOR)};qn.prototype.addCurve=function(t,r,n){if(t===null||t.length<2)return null;var i=new $t(t,new yt(0,z.BOUNDARY,r,n));this._curveList.add(i)};qn.prototype.getCurves=function(){return this.add(this._inputGeom),this._curveList};qn.prototype.addPolygonRing=function(t,r,n,i,s){if(r===0&&t.length<Gi.MINIMUM_VALID_SIZE)return null;var a=i,o=s;t.length>=Gi.MINIMUM_VALID_SIZE&&J.isCCW(t)&&(a=s,o=i,n=j.opposite(n));var u=this._curveBuilder.getRingCurve(t,n,r);this.addCurve(u,a,o)};qn.prototype.add=function(t){if(t.isEmpty())return null;t instanceof fr?this.addPolygon(t):t instanceof Wt?this.addLineString(t):t instanceof gn?this.addPoint(t):t instanceof uu?this.addCollection(t):t instanceof wa?this.addCollection(t):t instanceof zi?this.addCollection(t):t instanceof Qr&&this.addCollection(t)};qn.prototype.isErodedCompletely=function(t,r){var n=t.getCoordinates();if(n.length<4)return r<0;if(n.length===4)return this.isTriangleErodedCompletely(n,r);var i=t.getEnvelopeInternal(),s=Math.min(i.getHeight(),i.getWidth());return r<0&&2*Math.abs(r)>s};qn.prototype.addCollection=function(t){for(var r=this,n=0;n<t.getNumGeometries();n++){var i=t.getGeometryN(n);r.add(i)}};qn.prototype.interfaces_=function(){return[]};qn.prototype.getClass=function(){return qn};var hu=function(){};hu.prototype.locate=function(t){};hu.prototype.interfaces_=function(){return[]};hu.prototype.getClass=function(){return hu};var ki=function(){this._parent=null,this._atStart=null,this._max=null,this._index=null,this._subcollectionIterator=null;var t=arguments[0];this._parent=t,this._atStart=!0,this._index=0,this._max=t.getNumGeometries()};ki.prototype.next=function(){if(this._atStart)return this._atStart=!1,ki.isAtomic(this._parent)&&this._index++,this._parent;if(this._subcollectionIterator!==null){if(this._subcollectionIterator.hasNext())return this._subcollectionIterator.next();this._subcollectionIterator=null}if(this._index>=this._max)throw new Iu;var t=this._parent.getGeometryN(this._index++);return t instanceof Qr?(this._subcollectionIterator=new ki(t),this._subcollectionIterator.next()):t};ki.prototype.remove=function(){throw new Error(this.getClass().getName())};ki.prototype.hasNext=function(){if(this._atStart)return!0;if(this._subcollectionIterator!==null){if(this._subcollectionIterator.hasNext())return!0;this._subcollectionIterator=null}return!(this._index>=this._max)};ki.prototype.interfaces_=function(){return[Tu]};ki.prototype.getClass=function(){return ki};ki.isAtomic=function(t){return!(t instanceof Qr)};var Sn=function(){this._geom=null;var t=arguments[0];this._geom=t};Sn.prototype.locate=function(t){return Sn.locate(t,this._geom)};Sn.prototype.interfaces_=function(){return[hu]};Sn.prototype.getClass=function(){return Sn};Sn.isPointInRing=function(t,r){return r.getEnvelopeInternal().intersects(t)?J.isPointInRing(t,r.getCoordinates()):!1};Sn.containsPointInPolygon=function(t,r){if(r.isEmpty())return!1;var n=r.getExteriorRing();if(!Sn.isPointInRing(t,n))return!1;for(var i=0;i<r.getNumInteriorRing();i++){var s=r.getInteriorRingN(i);if(Sn.isPointInRing(t,s))return!1}return!0};Sn.containsPoint=function(t,r){if(r instanceof fr)return Sn.containsPointInPolygon(t,r);if(r instanceof Qr)for(var n=new ki(r);n.hasNext();){var i=n.next();if(i!==r&&Sn.containsPoint(t,i))return!0}return!1};Sn.locate=function(t,r){return r.isEmpty()?z.EXTERIOR:Sn.containsPoint(t,r)?z.INTERIOR:z.EXTERIOR};var Fr=function(){this._edgeMap=new Or,this._edgeList=null,this._ptInAreaLocation=[z.NONE,z.NONE]};Fr.prototype.getNextCW=function(t){this.getEdges();var r=this._edgeList.indexOf(t),n=r-1;return r===0&&(n=this._edgeList.size()-1),this._edgeList.get(n)};Fr.prototype.propagateSideLabels=function(t){for(var r=z.NONE,n=this.iterator();n.hasNext();){var i=n.next(),s=i.getLabel();s.isArea(t)&&s.getLocation(t,j.LEFT)!==z.NONE&&(r=s.getLocation(t,j.LEFT))}if(r===z.NONE)return null;for(var a=r,o=this.iterator();o.hasNext();){var u=o.next(),f=u.getLabel();if(f.getLocation(t,j.ON)===z.NONE&&f.setLocation(t,j.ON,a),f.isArea(t)){var l=f.getLocation(t,j.LEFT),c=f.getLocation(t,j.RIGHT);if(c!==z.NONE){if(c!==a)throw new ps("side location conflict",u.getCoordinate());l===z.NONE&&we.shouldNeverReachHere("found single null side (at "+u.getCoordinate()+")"),a=l}else we.isTrue(f.getLocation(t,j.LEFT)===z.NONE,"found single null side"),f.setLocation(t,j.RIGHT,a),f.setLocation(t,j.LEFT,a)}}};Fr.prototype.getCoordinate=function(){var t=this.iterator();if(!t.hasNext())return null;var r=t.next();return r.getCoordinate()};Fr.prototype.print=function(t){br.out.println("EdgeEndStar:   "+this.getCoordinate());for(var r=this.iterator();r.hasNext();){var n=r.next();n.print(t)}};Fr.prototype.isAreaLabelsConsistent=function(t){return this.computeEdgeEndLabels(t.getBoundaryNodeRule()),this.checkAreaLabelsConsistent(0)};Fr.prototype.checkAreaLabelsConsistent=function(t){var r=this.getEdges();if(r.size()<=0)return!0;var n=r.size()-1,i=r.get(n).getLabel(),s=i.getLocation(t,j.LEFT);we.isTrue(s!==z.NONE,"Found unlabelled area edge");for(var a=s,o=this.iterator();o.hasNext();){var u=o.next(),f=u.getLabel();we.isTrue(f.isArea(t),"Found non-area edge");var l=f.getLocation(t,j.LEFT),c=f.getLocation(t,j.RIGHT);if(l===c||c!==a)return!1;a=l}return!0};Fr.prototype.findIndex=function(t){var r=this;this.iterator();for(var n=0;n<this._edgeList.size();n++){var i=r._edgeList.get(n);if(i===t)return n}return-1};Fr.prototype.iterator=function(){return this.getEdges().iterator()};Fr.prototype.getEdges=function(){return this._edgeList===null&&(this._edgeList=new Q(this._edgeMap.values())),this._edgeList};Fr.prototype.getLocation=function(t,r,n){return this._ptInAreaLocation[t]===z.NONE&&(this._ptInAreaLocation[t]=Sn.locate(r,n[t].getGeometry())),this._ptInAreaLocation[t]};Fr.prototype.toString=function(){var t=new Ai;t.append("EdgeEndStar:   "+this.getCoordinate()),t.append(`
`);for(var r=this.iterator();r.hasNext();){var n=r.next();t.append(n),t.append(`
`)}return t.toString()};Fr.prototype.computeEdgeEndLabels=function(t){for(var r=this.iterator();r.hasNext();){var n=r.next();n.computeLabel(t)}};Fr.prototype.computeLabelling=function(t){var r=this;this.computeEdgeEndLabels(t[0].getBoundaryNodeRule()),this.propagateSideLabels(0),this.propagateSideLabels(1);for(var n=[!1,!1],i=this.iterator();i.hasNext();)for(var s=i.next(),a=s.getLabel(),o=0;o<2;o++)a.isLine(o)&&a.getLocation(o)===z.BOUNDARY&&(n[o]=!0);for(var u=this.iterator();u.hasNext();)for(var f=u.next(),l=f.getLabel(),c=0;c<2;c++)if(l.isAnyNull(c)){var h=z.NONE;if(n[c])h=z.EXTERIOR;else{var d=f.getCoordinate();h=r.getLocation(c,d,t)}l.setAllLocationsIfNull(c,h)}};Fr.prototype.getDegree=function(){return this._edgeMap.size()};Fr.prototype.insertEdgeEnd=function(t,r){this._edgeMap.put(t,r),this._edgeList=null};Fr.prototype.interfaces_=function(){return[]};Fr.prototype.getClass=function(){return Fr};var AN=function(e){function t(){e.call(this),this._resultAreaEdgeList=null,this._label=null,this._SCANNING_FOR_INCOMING=1,this._LINKING_TO_OUTGOING=2}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.linkResultDirectedEdges=function(){var n=this;this.getResultAreaEdges();for(var i=null,s=null,a=this._SCANNING_FOR_INCOMING,o=0;o<this._resultAreaEdgeList.size();o++){var u=n._resultAreaEdgeList.get(o),f=u.getSym();if(u.getLabel().isArea())switch(i===null&&u.isInResult()&&(i=u),a){case n._SCANNING_FOR_INCOMING:if(!f.isInResult())continue;s=f,a=n._LINKING_TO_OUTGOING;break;case n._LINKING_TO_OUTGOING:if(!u.isInResult())continue;s.setNext(u),a=n._SCANNING_FOR_INCOMING;break;default:}}if(a===this._LINKING_TO_OUTGOING){if(i===null)throw new ps("no outgoing dirEdge found",this.getCoordinate());we.isTrue(i.isInResult(),"unable to link last incoming dirEdge"),s.setNext(i)}},t.prototype.insert=function(n){var i=n;this.insertEdgeEnd(i,i)},t.prototype.getRightmostEdge=function(){var n=this.getEdges(),i=n.size();if(i<1)return null;var s=n.get(0);if(i===1)return s;var a=n.get(i-1),o=s.getQuadrant(),u=a.getQuadrant();return Tt.isNorthern(o)&&Tt.isNorthern(u)?s:!Tt.isNorthern(o)&&!Tt.isNorthern(u)?a:s.getDy()!==0?s:a.getDy()!==0?a:(we.shouldNeverReachHere("found two horizontal edges incident on node"),null)},t.prototype.print=function(n){br.out.println("DirectedEdgeStar: "+this.getCoordinate());for(var i=this.iterator();i.hasNext();){var s=i.next();n.print("out "),s.print(n),n.println(),n.print("in "),s.getSym().print(n),n.println()}},t.prototype.getResultAreaEdges=function(){var n=this;if(this._resultAreaEdgeList!==null)return this._resultAreaEdgeList;this._resultAreaEdgeList=new Q;for(var i=this.iterator();i.hasNext();){var s=i.next();(s.isInResult()||s.getSym().isInResult())&&n._resultAreaEdgeList.add(s)}return this._resultAreaEdgeList},t.prototype.updateLabelling=function(n){for(var i=this.iterator();i.hasNext();){var s=i.next(),a=s.getLabel();a.setAllLocationsIfNull(0,n.getLocation(0)),a.setAllLocationsIfNull(1,n.getLocation(1))}},t.prototype.linkAllDirectedEdges=function(){var n=this;this.getEdges();for(var i=null,s=null,a=this._edgeList.size()-1;a>=0;a--){var o=n._edgeList.get(a),u=o.getSym();s===null&&(s=u),i!==null&&u.setNext(i),i=o}s.setNext(i)},t.prototype.computeDepths=function(){var n=this;if(arguments.length===1){var i=arguments[0],s=this.findIndex(i),a=i.getDepth(j.LEFT),o=i.getDepth(j.RIGHT),u=this.computeDepths(s+1,this._edgeList.size(),a),f=this.computeDepths(0,s,u);if(f!==o)throw new ps("depth mismatch at "+i.getCoordinate())}else if(arguments.length===3){for(var l=arguments[0],c=arguments[1],h=arguments[2],d=h,m=l;m<c;m++){var g=n._edgeList.get(m);g.setEdgeDepths(j.RIGHT,d),d=g.getDepth(j.LEFT)}return d}},t.prototype.mergeSymLabels=function(){for(var n=this.iterator();n.hasNext();){var i=n.next(),s=i.getLabel();s.merge(i.getSym().getLabel())}},t.prototype.linkMinimalDirectedEdges=function(n){for(var i=this,s=null,a=null,o=this._SCANNING_FOR_INCOMING,u=this._resultAreaEdgeList.size()-1;u>=0;u--){var f=i._resultAreaEdgeList.get(u),l=f.getSym();switch(s===null&&f.getEdgeRing()===n&&(s=f),o){case i._SCANNING_FOR_INCOMING:if(l.getEdgeRing()!==n)continue;a=l,o=i._LINKING_TO_OUTGOING;break;case i._LINKING_TO_OUTGOING:if(f.getEdgeRing()!==n)continue;a.setNextMin(f),o=i._SCANNING_FOR_INCOMING;break;default:}}o===this._LINKING_TO_OUTGOING&&(we.isTrue(s!==null,"found null for first outgoing dirEdge"),we.isTrue(s.getEdgeRing()===n,"unable to link last incoming dirEdge"),a.setNextMin(s))},t.prototype.getOutgoingDegree=function(){if(arguments.length===0){for(var n=0,i=this.iterator();i.hasNext();){var s=i.next();s.isInResult()&&n++}return n}else if(arguments.length===1){for(var a=arguments[0],o=0,u=this.iterator();u.hasNext();){var f=u.next();f.getEdgeRing()===a&&o++}return o}},t.prototype.getLabel=function(){return this._label},t.prototype.findCoveredLineEdges=function(){for(var n=z.NONE,i=this.iterator();i.hasNext();){var s=i.next(),a=s.getSym();if(!s.isLineEdge()){if(s.isInResult()){n=z.INTERIOR;break}if(a.isInResult()){n=z.EXTERIOR;break}}}if(n===z.NONE)return null;for(var o=n,u=this.iterator();u.hasNext();){var f=u.next(),l=f.getSym();f.isLineEdge()?f.getEdge().setCovered(o===z.INTERIOR):(f.isInResult()&&(o=z.EXTERIOR),l.isInResult()&&(o=z.INTERIOR))}},t.prototype.computeLabelling=function(n){var i=this;e.prototype.computeLabelling.call(this,n),this._label=new yt(z.NONE);for(var s=this.iterator();s.hasNext();)for(var a=s.next(),o=a.getEdge(),u=o.getLabel(),f=0;f<2;f++){var l=u.getLocation(f);(l===z.INTERIOR||l===z.BOUNDARY)&&i._label.setLocation(f,z.INTERIOR)}},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(Fr),ax=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.createNode=function(n){return new oh(n,new AN)},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(fu),Hs=function e(){this._pts=null,this._orientation=null;var t=arguments[0];this._pts=t,this._orientation=e.orientation(t)};Hs.prototype.compareTo=function(t){var r=t,n=Hs.compareOriented(this._pts,this._orientation,r._pts,r._orientation);return n};Hs.prototype.interfaces_=function(){return[Hn]};Hs.prototype.getClass=function(){return Hs};Hs.orientation=function(t){return Me.increasingDirection(t)===1};Hs.compareOriented=function(t,r,n,i){for(var s=r?1:-1,a=i?1:-1,o=r?t.length:-1,u=i?n.length:-1,f=r?0:t.length-1,l=i?0:n.length-1;;){var c=t[f].compareTo(n[l]);if(c!==0)return c;f+=s,l+=a;var h=f===o,d=l===u;if(h&&!d)return-1;if(!h&&d)return 1;if(h&&d)return 0}};var ri=function(){this._edges=new Q,this._ocaMap=new Or};ri.prototype.print=function(t){var r=this;t.print("MULTILINESTRING ( ");for(var n=0;n<this._edges.size();n++){var i=r._edges.get(n);n>0&&t.print(","),t.print("(");for(var s=i.getCoordinates(),a=0;a<s.length;a++)a>0&&t.print(","),t.print(s[a].x+" "+s[a].y);t.println(")")}t.print(")  ")};ri.prototype.addAll=function(t){for(var r=this,n=t.iterator();n.hasNext();)r.add(n.next())};ri.prototype.findEdgeIndex=function(t){for(var r=this,n=0;n<this._edges.size();n++)if(r._edges.get(n).equals(t))return n;return-1};ri.prototype.iterator=function(){return this._edges.iterator()};ri.prototype.getEdges=function(){return this._edges};ri.prototype.get=function(t){return this._edges.get(t)};ri.prototype.findEqualEdge=function(t){var r=new Hs(t.getCoordinates()),n=this._ocaMap.get(r);return n};ri.prototype.add=function(t){this._edges.add(t);var r=new Hs(t.getCoordinates());this._ocaMap.put(r,t)};ri.prototype.interfaces_=function(){return[]};ri.prototype.getClass=function(){return ri};var Ia=function(){};Ia.prototype.processIntersections=function(t,r,n,i){};Ia.prototype.isDone=function(){};Ia.prototype.interfaces_=function(){return[]};Ia.prototype.getClass=function(){return Ia};var Mn=function(){this._hasIntersection=!1,this._hasProper=!1,this._hasProperInterior=!1,this._hasInterior=!1,this._properIntersectionPoint=null,this._li=null,this._isSelfIntersection=null,this.numIntersections=0,this.numInteriorIntersections=0,this.numProperIntersections=0,this.numTests=0;var t=arguments[0];this._li=t};Mn.prototype.isTrivialIntersection=function(t,r,n,i){if(t===n&&this._li.getIntersectionNum()===1){if(Mn.isAdjacentSegments(r,i))return!0;if(t.isClosed()){var s=t.size()-1;if(r===0&&i===s||i===0&&r===s)return!0}}return!1};Mn.prototype.getProperIntersectionPoint=function(){return this._properIntersectionPoint};Mn.prototype.hasProperInteriorIntersection=function(){return this._hasProperInterior};Mn.prototype.getLineIntersector=function(){return this._li};Mn.prototype.hasProperIntersection=function(){return this._hasProper};Mn.prototype.processIntersections=function(t,r,n,i){if(t===n&&r===i)return null;this.numTests++;var s=t.getCoordinates()[r],a=t.getCoordinates()[r+1],o=n.getCoordinates()[i],u=n.getCoordinates()[i+1];this._li.computeIntersection(s,a,o,u),this._li.hasIntersection()&&(this.numIntersections++,this._li.isInteriorIntersection()&&(this.numInteriorIntersections++,this._hasInterior=!0),this.isTrivialIntersection(t,r,n,i)||(this._hasIntersection=!0,t.addIntersections(this._li,r,0),n.addIntersections(this._li,i,1),this._li.isProper()&&(this.numProperIntersections++,this._hasProper=!0,this._hasProperInterior=!0)))};Mn.prototype.hasIntersection=function(){return this._hasIntersection};Mn.prototype.isDone=function(){return!1};Mn.prototype.hasInteriorIntersection=function(){return this._hasInterior};Mn.prototype.interfaces_=function(){return[Ia]};Mn.prototype.getClass=function(){return Mn};Mn.isAdjacentSegments=function(t,r){return Math.abs(t-r)===1};var Ti=function(){this.coord=null,this.segmentIndex=null,this.dist=null;var t=arguments[0],r=arguments[1],n=arguments[2];this.coord=new V(t),this.segmentIndex=r,this.dist=n};Ti.prototype.getSegmentIndex=function(){return this.segmentIndex};Ti.prototype.getCoordinate=function(){return this.coord};Ti.prototype.print=function(t){t.print(this.coord),t.print(" seg # = "+this.segmentIndex),t.println(" dist = "+this.dist)};Ti.prototype.compareTo=function(t){var r=t;return this.compare(r.segmentIndex,r.dist)};Ti.prototype.isEndPoint=function(t){return this.segmentIndex===0&&this.dist===0||this.segmentIndex===t};Ti.prototype.toString=function(){return this.coord+" seg # = "+this.segmentIndex+" dist = "+this.dist};Ti.prototype.getDistance=function(){return this.dist};Ti.prototype.compare=function(t,r){return this.segmentIndex<t?-1:this.segmentIndex>t?1:this.dist<r?-1:this.dist>r?1:0};Ti.prototype.interfaces_=function(){return[Hn]};Ti.prototype.getClass=function(){return Ti};var Wi=function(){this._nodeMap=new Or,this.edge=null;var t=arguments[0];this.edge=t};Wi.prototype.print=function(t){t.println("Intersections:");for(var r=this.iterator();r.hasNext();){var n=r.next();n.print(t)}};Wi.prototype.iterator=function(){return this._nodeMap.values().iterator()};Wi.prototype.addSplitEdges=function(t){var r=this;this.addEndpoints();for(var n=this.iterator(),i=n.next();n.hasNext();){var s=n.next(),a=r.createSplitEdge(i,s);t.add(a),i=s}};Wi.prototype.addEndpoints=function(){var t=this.edge.pts.length-1;this.add(this.edge.pts[0],0,0),this.add(this.edge.pts[t],t,0)};Wi.prototype.createSplitEdge=function(t,r){var n=this,i=r.segmentIndex-t.segmentIndex+2,s=this.edge.pts[r.segmentIndex],a=r.dist>0||!r.coord.equals2D(s);a||i--;var o=new Array(i).fill(null),u=0;o[u++]=new V(t.coord);for(var f=t.segmentIndex+1;f<=r.segmentIndex;f++)o[u++]=n.edge.pts[f];return a&&(o[u]=r.coord),new Mc(o,new yt(this.edge._label))};Wi.prototype.add=function(t,r,n){var i=new Ti(t,r,n),s=this._nodeMap.get(i);return s!==null?s:(this._nodeMap.put(i,i),i)};Wi.prototype.isIntersection=function(t){for(var r=this.iterator();r.hasNext();){var n=r.next();if(n.coord.equals(t))return!0}return!1};Wi.prototype.interfaces_=function(){return[]};Wi.prototype.getClass=function(){return Wi};var La=function(){};La.prototype.getChainStartIndices=function(t){var r=this,n=0,i=new Q;i.add(new yi(n));do{var s=r.findChainEnd(t,n);i.add(new yi(s)),n=s}while(n<t.length-1);var a=La.toIntArray(i);return a};La.prototype.findChainEnd=function(t,r){for(var n=Tt.quadrant(t[r],t[r+1]),i=r+1;i<t.length;){var s=Tt.quadrant(t[i-1],t[i]);if(s!==n)break;i++}return i-1};La.prototype.interfaces_=function(){return[]};La.prototype.getClass=function(){return La};La.toIntArray=function(t){for(var r=new Array(t.size()).fill(null),n=0;n<r.length;n++)r[n]=t.get(n).intValue();return r};var vs=function(){this.e=null,this.pts=null,this.startIndex=null,this.env1=new ae,this.env2=new ae;var t=arguments[0];this.e=t,this.pts=t.getCoordinates();var r=new La;this.startIndex=r.getChainStartIndices(this.pts)};vs.prototype.getCoordinates=function(){return this.pts};vs.prototype.getMaxX=function(t){var r=this.pts[this.startIndex[t]].x,n=this.pts[this.startIndex[t+1]].x;return r>n?r:n};vs.prototype.getMinX=function(t){var r=this.pts[this.startIndex[t]].x,n=this.pts[this.startIndex[t+1]].x;return r<n?r:n};vs.prototype.computeIntersectsForChain=function(){if(arguments.length===4){var t=arguments[0],r=arguments[1],n=arguments[2],i=arguments[3];this.computeIntersectsForChain(this.startIndex[t],this.startIndex[t+1],r,r.startIndex[n],r.startIndex[n+1],i)}else if(arguments.length===6){var s=arguments[0],a=arguments[1],o=arguments[2],u=arguments[3],f=arguments[4],l=arguments[5],c=this.pts[s],h=this.pts[a],d=o.pts[u],m=o.pts[f];if(a-s===1&&f-u===1)return l.addIntersections(this.e,s,o.e,u),null;if(this.env1.init(c,h),this.env2.init(d,m),!this.env1.intersects(this.env2))return null;var g=Math.trunc((s+a)/2),p=Math.trunc((u+f)/2);s<g&&(u<p&&this.computeIntersectsForChain(s,g,o,u,p,l),p<f&&this.computeIntersectsForChain(s,g,o,p,f,l)),g<a&&(u<p&&this.computeIntersectsForChain(g,a,o,u,p,l),p<f&&this.computeIntersectsForChain(g,a,o,p,f,l))}};vs.prototype.getStartIndexes=function(){return this.startIndex};vs.prototype.computeIntersects=function(t,r){for(var n=this,i=0;i<this.startIndex.length-1;i++)for(var s=0;s<t.startIndex.length-1;s++)n.computeIntersectsForChain(i,t,s,r)};vs.prototype.interfaces_=function(){return[]};vs.prototype.getClass=function(){return vs};var Er=function e(){var t=this;this._depth=Array(2).fill().map(function(){return Array(3)});for(var r=0;r<2;r++)for(var n=0;n<3;n++)t._depth[r][n]=e.NULL_VALUE},ox={NULL_VALUE:{configurable:!0}};Er.prototype.getDepth=function(t,r){return this._depth[t][r]};Er.prototype.setDepth=function(t,r,n){this._depth[t][r]=n};Er.prototype.isNull=function(){var t=this;if(arguments.length===0){for(var r=0;r<2;r++)for(var n=0;n<3;n++)if(t._depth[r][n]!==Er.NULL_VALUE)return!1;return!0}else if(arguments.length===1){var i=arguments[0];return this._depth[i][1]===Er.NULL_VALUE}else if(arguments.length===2){var s=arguments[0],a=arguments[1];return this._depth[s][a]===Er.NULL_VALUE}};Er.prototype.normalize=function(){for(var t=this,r=0;r<2;r++)if(!t.isNull(r)){var n=t._depth[r][1];t._depth[r][2]<n&&(n=t._depth[r][2]),n<0&&(n=0);for(var i=1;i<3;i++){var s=0;t._depth[r][i]>n&&(s=1),t._depth[r][i]=s}}};Er.prototype.getDelta=function(t){return this._depth[t][j.RIGHT]-this._depth[t][j.LEFT]};Er.prototype.getLocation=function(t,r){return this._depth[t][r]<=0?z.EXTERIOR:z.INTERIOR};Er.prototype.toString=function(){return"A: "+this._depth[0][1]+","+this._depth[0][2]+" B: "+this._depth[1][1]+","+this._depth[1][2]};Er.prototype.add=function(){var t=this;if(arguments.length===1)for(var r=arguments[0],n=0;n<2;n++)for(var i=1;i<3;i++){var s=r.getLocation(n,i);(s===z.EXTERIOR||s===z.INTERIOR)&&(t.isNull(n,i)?t._depth[n][i]=Er.depthAtLocation(s):t._depth[n][i]+=Er.depthAtLocation(s))}else if(arguments.length===3){var a=arguments[0],o=arguments[1],u=arguments[2];u===z.INTERIOR&&this._depth[a][o]++}};Er.prototype.interfaces_=function(){return[]};Er.prototype.getClass=function(){return Er};Er.depthAtLocation=function(t){return t===z.EXTERIOR?0:t===z.INTERIOR?1:Er.NULL_VALUE};ox.NULL_VALUE.get=function(){return-1};Object.defineProperties(Er,ox);var Mc=function(e){function t(){if(e.call(this),this.pts=null,this._env=null,this.eiList=new Wi(this),this._name=null,this._mce=null,this._isIsolated=!0,this._depth=new Er,this._depthDelta=0,arguments.length===1){var r=arguments[0];t.call(this,r,null)}else if(arguments.length===2){var n=arguments[0],i=arguments[1];this.pts=n,this._label=i}}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.getDepth=function(){return this._depth},t.prototype.getCollapsedEdge=function(){var n=new Array(2).fill(null);n[0]=this.pts[0],n[1]=this.pts[1];var i=new t(n,yt.toLineLabel(this._label));return i},t.prototype.isIsolated=function(){return this._isIsolated},t.prototype.getCoordinates=function(){return this.pts},t.prototype.setIsolated=function(n){this._isIsolated=n},t.prototype.setName=function(n){this._name=n},t.prototype.equals=function(n){var i=this;if(!(n instanceof t))return!1;var s=n;if(this.pts.length!==s.pts.length)return!1;for(var a=!0,o=!0,u=this.pts.length,f=0;f<this.pts.length;f++)if(i.pts[f].equals2D(s.pts[f])||(a=!1),i.pts[f].equals2D(s.pts[--u])||(o=!1),!a&&!o)return!1;return!0},t.prototype.getCoordinate=function(){if(arguments.length===0)return this.pts.length>0?this.pts[0]:null;if(arguments.length===1){var n=arguments[0];return this.pts[n]}},t.prototype.print=function(n){var i=this;n.print("edge "+this._name+": "),n.print("LINESTRING (");for(var s=0;s<this.pts.length;s++)s>0&&n.print(","),n.print(i.pts[s].x+" "+i.pts[s].y);n.print(")  "+this._label+" "+this._depthDelta)},t.prototype.computeIM=function(n){t.updateIM(this._label,n)},t.prototype.isCollapsed=function(){return!this._label.isArea()||this.pts.length!==3?!1:!!this.pts[0].equals(this.pts[2])},t.prototype.isClosed=function(){return this.pts[0].equals(this.pts[this.pts.length-1])},t.prototype.getMaximumSegmentIndex=function(){return this.pts.length-1},t.prototype.getDepthDelta=function(){return this._depthDelta},t.prototype.getNumPoints=function(){return this.pts.length},t.prototype.printReverse=function(n){var i=this;n.print("edge "+this._name+": ");for(var s=this.pts.length-1;s>=0;s--)n.print(i.pts[s]+" ");n.println("")},t.prototype.getMonotoneChainEdge=function(){return this._mce===null&&(this._mce=new vs(this)),this._mce},t.prototype.getEnvelope=function(){var n=this;if(this._env===null){this._env=new ae;for(var i=0;i<this.pts.length;i++)n._env.expandToInclude(n.pts[i])}return this._env},t.prototype.addIntersection=function(n,i,s,a){var o=new V(n.getIntersection(a)),u=i,f=n.getEdgeDistance(s,a),l=u+1;if(l<this.pts.length){var c=this.pts[l];o.equals2D(c)&&(u=l,f=0)}this.eiList.add(o,u,f)},t.prototype.toString=function(){var n=this,i=new Ai;i.append("edge "+this._name+": "),i.append("LINESTRING (");for(var s=0;s<this.pts.length;s++)s>0&&i.append(","),i.append(n.pts[s].x+" "+n.pts[s].y);return i.append(")  "+this._label+" "+this._depthDelta),i.toString()},t.prototype.isPointwiseEqual=function(n){var i=this;if(this.pts.length!==n.pts.length)return!1;for(var s=0;s<this.pts.length;s++)if(!i.pts[s].equals2D(n.pts[s]))return!1;return!0},t.prototype.setDepthDelta=function(n){this._depthDelta=n},t.prototype.getEdgeIntersectionList=function(){return this.eiList},t.prototype.addIntersections=function(n,i,s){for(var a=this,o=0;o<n.getIntersectionNum();o++)a.addIntersection(n,i,s,o)},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t.updateIM=function(){if(arguments.length===2){var n=arguments[0],i=arguments[1];i.setAtLeastIfValid(n.getLocation(0,j.ON),n.getLocation(1,j.ON),1),n.isArea()&&(i.setAtLeastIfValid(n.getLocation(0,j.LEFT),n.getLocation(1,j.LEFT),2),i.setAtLeastIfValid(n.getLocation(0,j.RIGHT),n.getLocation(1,j.RIGHT),2))}else return e.prototype.updateIM.apply(this,arguments)},t}(Ln),jr=function(t){this._workingPrecisionModel=null,this._workingNoder=null,this._geomFact=null,this._graph=null,this._edgeList=new ri,this._bufParams=t||null};jr.prototype.setWorkingPrecisionModel=function(t){this._workingPrecisionModel=t};jr.prototype.insertUniqueEdge=function(t){var r=this._edgeList.findEqualEdge(t);if(r!==null){var n=r.getLabel(),i=t.getLabel();r.isPointwiseEqual(t)||(i=new yt(t.getLabel()),i.flip()),n.merge(i);var s=jr.depthDelta(i),a=r.getDepthDelta(),o=a+s;r.setDepthDelta(o)}else this._edgeList.add(t),t.setDepthDelta(jr.depthDelta(t.getLabel()))};jr.prototype.buildSubgraphs=function(t,r){for(var n=new Q,i=t.iterator();i.hasNext();){var s=i.next(),a=s.getRightmostCoordinate(),o=new uo(n),u=o.getDepth(a);s.computeDepth(u),s.findResultEdges(),n.add(s),r.add(s.getDirectedEdges(),s.getNodes())}};jr.prototype.createSubgraphs=function(t){for(var r=new Q,n=t.getNodes().iterator();n.hasNext();){var i=n.next();if(!i.isVisited()){var s=new Zr;s.create(i),r.add(s)}}return ti.sort(r,ti.reverseOrder()),r};jr.prototype.createEmptyResultGeometry=function(){var t=this._geomFact.createPolygon();return t};jr.prototype.getNoder=function(t){if(this._workingNoder!==null)return this._workingNoder;var r=new Np,n=new Oa;return n.setPrecisionModel(t),r.setSegmentIntersector(new Mn(n)),r};jr.prototype.buffer=function(t,r){var n=this._workingPrecisionModel;n===null&&(n=t.getPrecisionModel()),this._geomFact=t.getFactory();var i=new an(n,this._bufParams),s=new qn(t,r,i),a=s.getCurves();if(a.size()<=0)return this.createEmptyResultGeometry();this.computeNodedEdges(a,n),this._graph=new qt(new ax),this._graph.addEdges(this._edgeList.getEdges());var o=this.createSubgraphs(this._graph),u=new vn(this._geomFact);this.buildSubgraphs(o,u);var f=u.getPolygons();if(f.size()<=0)return this.createEmptyResultGeometry();var l=this._geomFact.buildGeometry(f);return l};jr.prototype.computeNodedEdges=function(t,r){var n=this,i=this.getNoder(r);i.computeNodes(t);for(var s=i.getNodedSubstrings(),a=s.iterator();a.hasNext();){var o=a.next(),u=o.getCoordinates();if(!(u.length===2&&u[0].equals2D(u[1]))){var f=o.getData(),l=new Mc(o.getCoordinates(),new yt(f));n.insertUniqueEdge(l)}}};jr.prototype.setNoder=function(t){this._workingNoder=t};jr.prototype.interfaces_=function(){return[]};jr.prototype.getClass=function(){return jr};jr.depthDelta=function(t){var r=t.getLocation(0,j.LEFT),n=t.getLocation(0,j.RIGHT);return r===z.INTERIOR&&n===z.EXTERIOR?1:r===z.EXTERIOR&&n===z.INTERIOR?-1:0};jr.convertSegStrings=function(t){for(var r=new Pe,n=new Q;t.hasNext();){var i=t.next(),s=r.createLineString(i.getCoordinates());n.add(s)}return r.buildGeometry(n)};var Ws=function(){if(this._noder=null,this._scaleFactor=null,this._offsetX=null,this._offsetY=null,this._isScaled=!1,arguments.length===2){var t=arguments[0],r=arguments[1];this._noder=t,this._scaleFactor=r,this._offsetX=0,this._offsetY=0,this._isScaled=!this.isIntegerPrecision()}else if(arguments.length===4){var n=arguments[0],i=arguments[1],s=arguments[2],a=arguments[3];this._noder=n,this._scaleFactor=i,this._offsetX=s,this._offsetY=a,this._isScaled=!this.isIntegerPrecision()}};Ws.prototype.rescale=function(){var t=this;if(pe(arguments[0],ar))for(var r=arguments[0],n=r.iterator();n.hasNext();){var i=n.next();t.rescale(i.getCoordinates())}else if(arguments[0]instanceof Array){for(var s=arguments[0],a=0;a<s.length;a++)s[a].x=s[a].x/t._scaleFactor+t._offsetX,s[a].y=s[a].y/t._scaleFactor+t._offsetY;s.length===2&&s[0].equals2D(s[1])&&br.out.println(s)}};Ws.prototype.scale=function(){var t=this;if(pe(arguments[0],ar)){for(var r=arguments[0],n=new Q,i=r.iterator();i.hasNext();){var s=i.next();n.add(new $t(t.scale(s.getCoordinates()),s.getData()))}return n}else if(arguments[0]instanceof Array){for(var a=arguments[0],o=new Array(a.length).fill(null),u=0;u<a.length;u++)o[u]=new V(Math.round((a[u].x-t._offsetX)*t._scaleFactor),Math.round((a[u].y-t._offsetY)*t._scaleFactor),a[u].z);var f=Me.removeRepeatedPoints(o);return f}};Ws.prototype.isIntegerPrecision=function(){return this._scaleFactor===1};Ws.prototype.getNodedSubstrings=function(){var t=this._noder.getNodedSubstrings();return this._isScaled&&this.rescale(t),t};Ws.prototype.computeNodes=function(t){var r=t;this._isScaled&&(r=this.scale(t)),this._noder.computeNodes(r)};Ws.prototype.interfaces_=function(){return[Sa]};Ws.prototype.getClass=function(){return Ws};var Ii=function(){this._li=new Oa,this._segStrings=null;var t=arguments[0];this._segStrings=t},ux={fact:{configurable:!0}};Ii.prototype.checkEndPtVertexIntersections=function(){var t=this;if(arguments.length===0)for(var r=this._segStrings.iterator();r.hasNext();){var n=r.next(),i=n.getCoordinates();t.checkEndPtVertexIntersections(i[0],t._segStrings),t.checkEndPtVertexIntersections(i[i.length-1],t._segStrings)}else if(arguments.length===2){for(var s=arguments[0],a=arguments[1],o=a.iterator();o.hasNext();)for(var u=o.next(),f=u.getCoordinates(),l=1;l<f.length-1;l++)if(f[l].equals(s))throw new ds("found endpt/interior pt intersection at index "+l+" :pt "+s)}};Ii.prototype.checkInteriorIntersections=function(){var t=this;if(arguments.length===0)for(var r=this._segStrings.iterator();r.hasNext();)for(var n=r.next(),i=this._segStrings.iterator();i.hasNext();){var s=i.next();t.checkInteriorIntersections(n,s)}else if(arguments.length===2)for(var a=arguments[0],o=arguments[1],u=a.getCoordinates(),f=o.getCoordinates(),l=0;l<u.length-1;l++)for(var c=0;c<f.length-1;c++)t.checkInteriorIntersections(a,l,o,c);else if(arguments.length===4){var h=arguments[0],d=arguments[1],m=arguments[2],g=arguments[3];if(h===m&&d===g)return null;var p=h.getCoordinates()[d],v=h.getCoordinates()[d+1],_=m.getCoordinates()[g],y=m.getCoordinates()[g+1];if(this._li.computeIntersection(p,v,_,y),this._li.hasIntersection()&&(this._li.isProper()||this.hasInteriorIntersection(this._li,p,v)||this.hasInteriorIntersection(this._li,_,y)))throw new ds("found non-noded intersection at "+p+"-"+v+" and "+_+"-"+y)}};Ii.prototype.checkValid=function(){this.checkEndPtVertexIntersections(),this.checkInteriorIntersections(),this.checkCollapses()};Ii.prototype.checkCollapses=function(){var t=this;if(arguments.length===0)for(var r=this._segStrings.iterator();r.hasNext();){var n=r.next();t.checkCollapses(n)}else if(arguments.length===1)for(var i=arguments[0],s=i.getCoordinates(),a=0;a<s.length-2;a++)t.checkCollapse(s[a],s[a+1],s[a+2])};Ii.prototype.hasInteriorIntersection=function(t,r,n){for(var i=0;i<t.getIntersectionNum();i++){var s=t.getIntersection(i);if(!(s.equals(r)||s.equals(n)))return!0}return!1};Ii.prototype.checkCollapse=function(t,r,n){if(t.equals(n))throw new ds("found non-noded collapse at "+Ii.fact.createLineString([t,r,n]))};Ii.prototype.interfaces_=function(){return[]};Ii.prototype.getClass=function(){return Ii};ux.fact.get=function(){return new Pe};Object.defineProperties(Ii,ux);var on=function(){this._li=null,this._pt=null,this._originalPt=null,this._ptScaled=null,this._p0Scaled=null,this._p1Scaled=null,this._scaleFactor=null,this._minx=null,this._maxx=null,this._miny=null,this._maxy=null,this._corner=new Array(4).fill(null),this._safeEnv=null;var t=arguments[0],r=arguments[1],n=arguments[2];if(this._originalPt=t,this._pt=t,this._scaleFactor=r,this._li=n,r<=0)throw new zt("Scale factor must be non-zero");r!==1&&(this._pt=new V(this.scale(t.x),this.scale(t.y)),this._p0Scaled=new V,this._p1Scaled=new V),this.initCorners(this._pt)},fx={SAFE_ENV_EXPANSION_FACTOR:{configurable:!0}};on.prototype.intersectsScaled=function(t,r){var n=Math.min(t.x,r.x),i=Math.max(t.x,r.x),s=Math.min(t.y,r.y),a=Math.max(t.y,r.y),o=this._maxx<n||this._minx>i||this._maxy<s||this._miny>a;if(o)return!1;var u=this.intersectsToleranceSquare(t,r);return we.isTrue(!(o&&u),"Found bad envelope test"),u};on.prototype.initCorners=function(t){var r=.5;this._minx=t.x-r,this._maxx=t.x+r,this._miny=t.y-r,this._maxy=t.y+r,this._corner[0]=new V(this._maxx,this._maxy),this._corner[1]=new V(this._minx,this._maxy),this._corner[2]=new V(this._minx,this._miny),this._corner[3]=new V(this._maxx,this._miny)};on.prototype.intersects=function(t,r){return this._scaleFactor===1?this.intersectsScaled(t,r):(this.copyScaled(t,this._p0Scaled),this.copyScaled(r,this._p1Scaled),this.intersectsScaled(this._p0Scaled,this._p1Scaled))};on.prototype.scale=function(t){return Math.round(t*this._scaleFactor)};on.prototype.getCoordinate=function(){return this._originalPt};on.prototype.copyScaled=function(t,r){r.x=this.scale(t.x),r.y=this.scale(t.y)};on.prototype.getSafeEnvelope=function(){if(this._safeEnv===null){var t=on.SAFE_ENV_EXPANSION_FACTOR/this._scaleFactor;this._safeEnv=new ae(this._originalPt.x-t,this._originalPt.x+t,this._originalPt.y-t,this._originalPt.y+t)}return this._safeEnv};on.prototype.intersectsPixelClosure=function(t,r){return this._li.computeIntersection(t,r,this._corner[0],this._corner[1]),!!(this._li.hasIntersection()||(this._li.computeIntersection(t,r,this._corner[1],this._corner[2]),this._li.hasIntersection())||(this._li.computeIntersection(t,r,this._corner[2],this._corner[3]),this._li.hasIntersection())||(this._li.computeIntersection(t,r,this._corner[3],this._corner[0]),this._li.hasIntersection()))};on.prototype.intersectsToleranceSquare=function(t,r){var n=!1,i=!1;return this._li.computeIntersection(t,r,this._corner[0],this._corner[1]),!!(this._li.isProper()||(this._li.computeIntersection(t,r,this._corner[1],this._corner[2]),this._li.isProper())||(this._li.hasIntersection()&&(n=!0),this._li.computeIntersection(t,r,this._corner[2],this._corner[3]),this._li.isProper())||(this._li.hasIntersection()&&(i=!0),this._li.computeIntersection(t,r,this._corner[3],this._corner[0]),this._li.isProper())||n&&i||t.equals(this._pt)||r.equals(this._pt))};on.prototype.addSnappedNode=function(t,r){var n=t.getCoordinate(r),i=t.getCoordinate(r+1);return this.intersects(n,i)?(t.addIntersection(this.getCoordinate(),r),!0):!1};on.prototype.interfaces_=function(){return[]};on.prototype.getClass=function(){return on};fx.SAFE_ENV_EXPANSION_FACTOR.get=function(){return .75};Object.defineProperties(on,fx);var Hf=function(){this.tempEnv1=new ae,this.selectedSegment=new oe};Hf.prototype.select=function(){if(arguments.length!==1){if(arguments.length===2){var t=arguments[0],r=arguments[1];t.getLineSegment(r,this.selectedSegment),this.select(this.selectedSegment)}}};Hf.prototype.interfaces_=function(){return[]};Hf.prototype.getClass=function(){return Hf};var du=function(){this._index=null;var t=arguments[0];this._index=t},lx={HotPixelSnapAction:{configurable:!0}};du.prototype.snap=function(){if(arguments.length===1){var t=arguments[0];return this.snap(t,null,-1)}else if(arguments.length===3){var r=arguments[0],n=arguments[1],i=arguments[2],s=r.getSafeEnvelope(),a=new cx(r,n,i);return this._index.query(s,{interfaces_:function(){return[Gs]},visitItem:function(o){var u=o;u.select(s,a)}}),a.isNodeAdded()}};du.prototype.interfaces_=function(){return[]};du.prototype.getClass=function(){return du};lx.HotPixelSnapAction.get=function(){return cx};Object.defineProperties(du,lx);var cx=function(e){function t(){e.call(this),this._hotPixel=null,this._parentEdge=null,this._hotPixelVertexIndex=null,this._isNodeAdded=!1;var r=arguments[0],n=arguments[1],i=arguments[2];this._hotPixel=r,this._parentEdge=n,this._hotPixelVertexIndex=i}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.isNodeAdded=function(){return this._isNodeAdded},t.prototype.select=function(){if(arguments.length===2){var n=arguments[0],i=arguments[1],s=n.getContext();if(this._parentEdge!==null&&s===this._parentEdge&&i===this._hotPixelVertexIndex)return null;this._isNodeAdded=this._hotPixel.addSnappedNode(s,i)}else return e.prototype.select.apply(this,arguments)},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(Hf),fo=function(){this._li=null,this._interiorIntersections=null;var t=arguments[0];this._li=t,this._interiorIntersections=new Q};fo.prototype.processIntersections=function(t,r,n,i){var s=this;if(t===n&&r===i)return null;var a=t.getCoordinates()[r],o=t.getCoordinates()[r+1],u=n.getCoordinates()[i],f=n.getCoordinates()[i+1];if(this._li.computeIntersection(a,o,u,f),this._li.hasIntersection()&&this._li.isInteriorIntersection()){for(var l=0;l<this._li.getIntersectionNum();l++)s._interiorIntersections.add(s._li.getIntersection(l));t.addIntersections(this._li,r,0),n.addIntersections(this._li,i,1)}};fo.prototype.isDone=function(){return!1};fo.prototype.getInteriorIntersections=function(){return this._interiorIntersections};fo.prototype.interfaces_=function(){return[Ia]};fo.prototype.getClass=function(){return fo};var Yi=function(){this._pm=null,this._li=null,this._scaleFactor=null,this._noder=null,this._pointSnapper=null,this._nodedSegStrings=null;var t=arguments[0];this._pm=t,this._li=new Oa,this._li.setPrecisionModel(t),this._scaleFactor=t.getScale()};Yi.prototype.checkCorrectness=function(t){var r=$t.getNodedSubstrings(t),n=new Ii(r);try{n.checkValid()}catch(i){if(i instanceof K0)i.printStackTrace();else throw i}finally{}};Yi.prototype.getNodedSubstrings=function(){return $t.getNodedSubstrings(this._nodedSegStrings)};Yi.prototype.snapRound=function(t,r){var n=this.findInteriorIntersections(t,r);this.computeIntersectionSnaps(n),this.computeVertexSnaps(t)};Yi.prototype.findInteriorIntersections=function(t,r){var n=new fo(r);return this._noder.setSegmentIntersector(n),this._noder.computeNodes(t),n.getInteriorIntersections()};Yi.prototype.computeVertexSnaps=function(){var t=this;if(pe(arguments[0],ar))for(var r=arguments[0],n=r.iterator();n.hasNext();){var i=n.next();t.computeVertexSnaps(i)}else if(arguments[0]instanceof $t)for(var s=arguments[0],a=s.getCoordinates(),o=0;o<a.length;o++){var u=new on(a[o],t._scaleFactor,t._li),f=t._pointSnapper.snap(u,s,o);f&&s.addIntersection(a[o],o)}};Yi.prototype.computeNodes=function(t){this._nodedSegStrings=t,this._noder=new Np,this._pointSnapper=new du(this._noder.getIndex()),this.snapRound(t,this._li)};Yi.prototype.computeIntersectionSnaps=function(t){for(var r=this,n=t.iterator();n.hasNext();){var i=n.next(),s=new on(i,r._scaleFactor,r._li);r._pointSnapper.snap(s)}};Yi.prototype.interfaces_=function(){return[Sa]};Yi.prototype.getClass=function(){return Yi};var xr=function(){if(this._argGeom=null,this._distance=null,this._bufParams=new pt,this._resultGeometry=null,this._saveException=null,arguments.length===1){var t=arguments[0];this._argGeom=t}else if(arguments.length===2){var r=arguments[0],n=arguments[1];this._argGeom=r,this._bufParams=n}},Pu={CAP_ROUND:{configurable:!0},CAP_BUTT:{configurable:!0},CAP_FLAT:{configurable:!0},CAP_SQUARE:{configurable:!0},MAX_PRECISION_DIGITS:{configurable:!0}};xr.prototype.bufferFixedPrecision=function(t){var r=new Ws(new Yi(new vt(1)),t.getScale()),n=new jr(this._bufParams);n.setWorkingPrecisionModel(t),n.setNoder(r),this._resultGeometry=n.buffer(this._argGeom,this._distance)};xr.prototype.bufferReducedPrecision=function(){var t=this;if(arguments.length===0){for(var r=xr.MAX_PRECISION_DIGITS;r>=0;r--){try{t.bufferReducedPrecision(r)}catch(a){if(a instanceof ps)t._saveException=a;else throw a}finally{}if(t._resultGeometry!==null)return null}throw this._saveException}else if(arguments.length===1){var n=arguments[0],i=xr.precisionScaleFactor(this._argGeom,this._distance,n),s=new vt(i);this.bufferFixedPrecision(s)}};xr.prototype.computeGeometry=function(){if(this.bufferOriginalPrecision(),this._resultGeometry!==null)return null;var t=this._argGeom.getFactory().getPrecisionModel();t.getType()===vt.FIXED?this.bufferFixedPrecision(t):this.bufferReducedPrecision()};xr.prototype.setQuadrantSegments=function(t){this._bufParams.setQuadrantSegments(t)};xr.prototype.bufferOriginalPrecision=function(){try{var t=new jr(this._bufParams);this._resultGeometry=t.buffer(this._argGeom,this._distance)}catch(r){if(r instanceof ds)this._saveException=r;else throw r}finally{}};xr.prototype.getResultGeometry=function(t){return this._distance=t,this.computeGeometry(),this._resultGeometry};xr.prototype.setEndCapStyle=function(t){this._bufParams.setEndCapStyle(t)};xr.prototype.interfaces_=function(){return[]};xr.prototype.getClass=function(){return xr};xr.bufferOp=function(){if(arguments.length===2){var t=arguments[0],r=arguments[1],n=new xr(t),i=n.getResultGeometry(r);return i}else if(arguments.length===3){if(Number.isInteger(arguments[2])&&arguments[0]instanceof me&&typeof arguments[1]=="number"){var s=arguments[0],a=arguments[1],o=arguments[2],u=new xr(s);u.setQuadrantSegments(o);var f=u.getResultGeometry(a);return f}else if(arguments[2]instanceof pt&&arguments[0]instanceof me&&typeof arguments[1]=="number"){var l=arguments[0],c=arguments[1],h=arguments[2],d=new xr(l,h),m=d.getResultGeometry(c);return m}}else if(arguments.length===4){var g=arguments[0],p=arguments[1],v=arguments[2],_=arguments[3],y=new xr(g);y.setQuadrantSegments(v),y.setEndCapStyle(_);var x=y.getResultGeometry(p);return x}};xr.precisionScaleFactor=function(t,r,n){var i=t.getEnvelopeInternal(),s=In.max(Math.abs(i.getMaxX()),Math.abs(i.getMaxY()),Math.abs(i.getMinX()),Math.abs(i.getMinY())),a=r>0?r:0,o=s+2*a,u=Math.trunc(Math.log(o)/Math.log(10)+1),f=n-u,l=Math.pow(10,f);return l};Pu.CAP_ROUND.get=function(){return pt.CAP_ROUND};Pu.CAP_BUTT.get=function(){return pt.CAP_FLAT};Pu.CAP_FLAT.get=function(){return pt.CAP_FLAT};Pu.CAP_SQUARE.get=function(){return pt.CAP_SQUARE};Pu.MAX_PRECISION_DIGITS.get=function(){return 12};Object.defineProperties(xr,Pu);var Wr=function(){this._pt=[new V,new V],this._distance=Ee.NaN,this._isNull=!0};Wr.prototype.getCoordinates=function(){return this._pt};Wr.prototype.getCoordinate=function(t){return this._pt[t]};Wr.prototype.setMinimum=function(){if(arguments.length===1){var t=arguments[0];this.setMinimum(t._pt[0],t._pt[1])}else if(arguments.length===2){var r=arguments[0],n=arguments[1];if(this._isNull)return this.initialize(r,n),null;var i=r.distance(n);i<this._distance&&this.initialize(r,n,i)}};Wr.prototype.initialize=function(){if(arguments.length===0)this._isNull=!0;else if(arguments.length===2){var t=arguments[0],r=arguments[1];this._pt[0].setCoordinate(t),this._pt[1].setCoordinate(r),this._distance=t.distance(r),this._isNull=!1}else if(arguments.length===3){var n=arguments[0],i=arguments[1],s=arguments[2];this._pt[0].setCoordinate(n),this._pt[1].setCoordinate(i),this._distance=s,this._isNull=!1}};Wr.prototype.getDistance=function(){return this._distance};Wr.prototype.setMaximum=function(){if(arguments.length===1){var t=arguments[0];this.setMaximum(t._pt[0],t._pt[1])}else if(arguments.length===2){var r=arguments[0],n=arguments[1];if(this._isNull)return this.initialize(r,n),null;var i=r.distance(n);i>this._distance&&this.initialize(r,n,i)}};Wr.prototype.interfaces_=function(){return[]};Wr.prototype.getClass=function(){return Wr};var Vi=function(){};Vi.prototype.interfaces_=function(){return[]};Vi.prototype.getClass=function(){return Vi};Vi.computeDistance=function(){if(arguments[2]instanceof Wr&&arguments[0]instanceof Wt&&arguments[1]instanceof V)for(var t=arguments[0],r=arguments[1],n=arguments[2],i=t.getCoordinates(),s=new oe,a=0;a<i.length-1;a++){s.setCoordinates(i[a],i[a+1]);var o=s.closestPoint(r);n.setMinimum(o,r)}else if(arguments[2]instanceof Wr&&arguments[0]instanceof fr&&arguments[1]instanceof V){var u=arguments[0],f=arguments[1],l=arguments[2];Vi.computeDistance(u.getExteriorRing(),f,l);for(var c=0;c<u.getNumInteriorRing();c++)Vi.computeDistance(u.getInteriorRingN(c),f,l)}else if(arguments[2]instanceof Wr&&arguments[0]instanceof me&&arguments[1]instanceof V){var h=arguments[0],d=arguments[1],m=arguments[2];if(h instanceof Wt)Vi.computeDistance(h,d,m);else if(h instanceof fr)Vi.computeDistance(h,d,m);else if(h instanceof Qr)for(var g=h,p=0;p<g.getNumGeometries();p++){var v=g.getGeometryN(p);Vi.computeDistance(v,d,m)}else m.setMinimum(h.getCoordinate(),d)}else if(arguments[2]instanceof Wr&&arguments[0]instanceof oe&&arguments[1]instanceof V){var _=arguments[0],y=arguments[1],x=arguments[2],E=_.closestPoint(y);x.setMinimum(E,y)}};var Pa=function(t){this._maxPtDist=new Wr,this._inputGeom=t||null},Fp={MaxPointDistanceFilter:{configurable:!0},MaxMidpointDistanceFilter:{configurable:!0}};Pa.prototype.computeMaxMidpointDistance=function(t){var r=new Ys(this._inputGeom);t.apply(r),this._maxPtDist.setMaximum(r.getMaxPointDistance())};Pa.prototype.computeMaxVertexDistance=function(t){var r=new lo(this._inputGeom);t.apply(r),this._maxPtDist.setMaximum(r.getMaxPointDistance())};Pa.prototype.findDistance=function(t){return this.computeMaxVertexDistance(t),this.computeMaxMidpointDistance(t),this._maxPtDist.getDistance()};Pa.prototype.getDistancePoints=function(){return this._maxPtDist};Pa.prototype.interfaces_=function(){return[]};Pa.prototype.getClass=function(){return Pa};Fp.MaxPointDistanceFilter.get=function(){return lo};Fp.MaxMidpointDistanceFilter.get=function(){return Ys};Object.defineProperties(Pa,Fp);var lo=function(t){this._maxPtDist=new Wr,this._minPtDist=new Wr,this._geom=t||null};lo.prototype.filter=function(t){this._minPtDist.initialize(),Vi.computeDistance(this._geom,t,this._minPtDist),this._maxPtDist.setMaximum(this._minPtDist)};lo.prototype.getMaxPointDistance=function(){return this._maxPtDist};lo.prototype.interfaces_=function(){return[Ui]};lo.prototype.getClass=function(){return lo};var Ys=function(t){this._maxPtDist=new Wr,this._minPtDist=new Wr,this._geom=t||null};Ys.prototype.filter=function(t,r){if(r===0)return null;var n=t.getCoordinate(r-1),i=t.getCoordinate(r),s=new V((n.x+i.x)/2,(n.y+i.y)/2);this._minPtDist.initialize(),Vi.computeDistance(this._geom,s,this._minPtDist),this._maxPtDist.setMaximum(this._minPtDist)};Ys.prototype.isDone=function(){return!1};Ys.prototype.isGeometryChanged=function(){return!1};Ys.prototype.getMaxPointDistance=function(){return this._maxPtDist};Ys.prototype.interfaces_=function(){return[$n]};Ys.prototype.getClass=function(){return Ys};var fs=function(t){this._comps=t||null};fs.prototype.filter=function(t){t instanceof fr&&this._comps.add(t)};fs.prototype.interfaces_=function(){return[Ei]};fs.prototype.getClass=function(){return fs};fs.getPolygons=function(){if(arguments.length===1){var t=arguments[0];return fs.getPolygons(t,new Q)}else if(arguments.length===2){var r=arguments[0],n=arguments[1];return r instanceof fr?n.add(r):r instanceof Qr&&r.apply(new fs(n)),n}};var Cr=function(){if(this._lines=null,this._isForcedToLineString=!1,arguments.length===1){var t=arguments[0];this._lines=t}else if(arguments.length===2){var r=arguments[0],n=arguments[1];this._lines=r,this._isForcedToLineString=n}};Cr.prototype.filter=function(t){if(this._isForcedToLineString&&t instanceof Gi){var r=t.getFactory().createLineString(t.getCoordinateSequence());return this._lines.add(r),null}t instanceof Wt&&this._lines.add(t)};Cr.prototype.setForceToLineString=function(t){this._isForcedToLineString=t};Cr.prototype.interfaces_=function(){return[ms]};Cr.prototype.getClass=function(){return Cr};Cr.getGeometry=function(){if(arguments.length===1){var t=arguments[0];return t.getFactory().buildGeometry(Cr.getLines(t))}else if(arguments.length===2){var r=arguments[0],n=arguments[1];return r.getFactory().buildGeometry(Cr.getLines(r,n))}};Cr.getLines=function(){if(arguments.length===1){var t=arguments[0];return Cr.getLines(t,!1)}else if(arguments.length===2){if(pe(arguments[0],ar)&&pe(arguments[1],ar)){for(var r=arguments[0],n=arguments[1],i=r.iterator();i.hasNext();){var s=i.next();Cr.getLines(s,n)}return n}else if(arguments[0]instanceof me&&typeof arguments[1]=="boolean"){var a=arguments[0],o=arguments[1],u=new Q;return a.apply(new Cr(u,o)),u}else if(arguments[0]instanceof me&&pe(arguments[1],ar)){var f=arguments[0],l=arguments[1];return f instanceof Wt?l.add(f):f.apply(new Cr(l)),l}}else if(arguments.length===3){if(typeof arguments[2]=="boolean"&&pe(arguments[0],ar)&&pe(arguments[1],ar)){for(var c=arguments[0],h=arguments[1],d=arguments[2],m=c.iterator();m.hasNext();){var g=m.next();Cr.getLines(g,h,d)}return h}else if(typeof arguments[2]=="boolean"&&arguments[0]instanceof me&&pe(arguments[1],ar)){var p=arguments[0],v=arguments[1],_=arguments[2];return p.apply(new Cr(v,_)),v}}};var ni=function(){if(this._boundaryRule=Un.OGC_SFS_BOUNDARY_RULE,this._isIn=null,this._numBoundaries=null,arguments.length!==0){if(arguments.length===1){var t=arguments[0];if(t===null)throw new zt("Rule must be non-null");this._boundaryRule=t}}};ni.prototype.locateInternal=function(){var t=this;if(arguments[0]instanceof V&&arguments[1]instanceof fr){var r=arguments[0],n=arguments[1];if(n.isEmpty())return z.EXTERIOR;var i=n.getExteriorRing(),s=this.locateInPolygonRing(r,i);if(s===z.EXTERIOR)return z.EXTERIOR;if(s===z.BOUNDARY)return z.BOUNDARY;for(var a=0;a<n.getNumInteriorRing();a++){var o=n.getInteriorRingN(a),u=t.locateInPolygonRing(r,o);if(u===z.INTERIOR)return z.EXTERIOR;if(u===z.BOUNDARY)return z.BOUNDARY}return z.INTERIOR}else if(arguments[0]instanceof V&&arguments[1]instanceof Wt){var f=arguments[0],l=arguments[1];if(!l.getEnvelopeInternal().intersects(f))return z.EXTERIOR;var c=l.getCoordinates();return!l.isClosed()&&(f.equals(c[0])||f.equals(c[c.length-1]))?z.BOUNDARY:J.isOnLine(f,c)?z.INTERIOR:z.EXTERIOR}else if(arguments[0]instanceof V&&arguments[1]instanceof gn){var h=arguments[0],d=arguments[1],m=d.getCoordinate();return m.equals2D(h)?z.INTERIOR:z.EXTERIOR}};ni.prototype.locateInPolygonRing=function(t,r){return r.getEnvelopeInternal().intersects(t)?J.locatePointInRing(t,r.getCoordinates()):z.EXTERIOR};ni.prototype.intersects=function(t,r){return this.locate(t,r)!==z.EXTERIOR};ni.prototype.updateLocationInfo=function(t){t===z.INTERIOR&&(this._isIn=!0),t===z.BOUNDARY&&this._numBoundaries++};ni.prototype.computeLocation=function(t,r){var n=this;if(r instanceof gn&&this.updateLocationInfo(this.locateInternal(t,r)),r instanceof Wt)this.updateLocationInfo(this.locateInternal(t,r));else if(r instanceof fr)this.updateLocationInfo(this.locateInternal(t,r));else if(r instanceof wa)for(var i=r,s=0;s<i.getNumGeometries();s++){var a=i.getGeometryN(s);n.updateLocationInfo(n.locateInternal(t,a))}else if(r instanceof zi)for(var o=r,u=0;u<o.getNumGeometries();u++){var f=o.getGeometryN(u);n.updateLocationInfo(n.locateInternal(t,f))}else if(r instanceof Qr)for(var l=new ki(r);l.hasNext();){var c=l.next();c!==r&&n.computeLocation(t,c)}};ni.prototype.locate=function(t,r){return r.isEmpty()?z.EXTERIOR:r instanceof Wt?this.locateInternal(t,r):r instanceof fr?this.locateInternal(t,r):(this._isIn=!1,this._numBoundaries=0,this.computeLocation(t,r),this._boundaryRule.isInBoundary(this._numBoundaries)?z.BOUNDARY:this._numBoundaries>0||this._isIn?z.INTERIOR:z.EXTERIOR)};ni.prototype.interfaces_=function(){return[]};ni.prototype.getClass=function(){return ni};var Yr=function e(){if(this._component=null,this._segIndex=null,this._pt=null,arguments.length===2){var t=arguments[0],r=arguments[1];e.call(this,t,e.INSIDE_AREA,r)}else if(arguments.length===3){var n=arguments[0],i=arguments[1],s=arguments[2];this._component=n,this._segIndex=i,this._pt=s}},hx={INSIDE_AREA:{configurable:!0}};Yr.prototype.isInsideArea=function(){return this._segIndex===Yr.INSIDE_AREA};Yr.prototype.getCoordinate=function(){return this._pt};Yr.prototype.getGeometryComponent=function(){return this._component};Yr.prototype.getSegmentIndex=function(){return this._segIndex};Yr.prototype.interfaces_=function(){return[]};Yr.prototype.getClass=function(){return Yr};hx.INSIDE_AREA.get=function(){return-1};Object.defineProperties(Yr,hx);var Vs=function(t){this._pts=t||null};Vs.prototype.filter=function(t){t instanceof gn&&this._pts.add(t)};Vs.prototype.interfaces_=function(){return[Ei]};Vs.prototype.getClass=function(){return Vs};Vs.getPoints=function(){if(arguments.length===1){var t=arguments[0];return t instanceof gn?ti.singletonList(t):Vs.getPoints(t,new Q)}else if(arguments.length===2){var r=arguments[0],n=arguments[1];return r instanceof gn?n.add(r):r instanceof Qr&&r.apply(new Vs(n)),n}};var co=function(){this._locations=null;var t=arguments[0];this._locations=t};co.prototype.filter=function(t){(t instanceof gn||t instanceof Wt||t instanceof fr)&&this._locations.add(new Yr(t,0,t.getCoordinate()))};co.prototype.interfaces_=function(){return[Ei]};co.prototype.getClass=function(){return co};co.getLocations=function(t){var r=new Q;return t.apply(new co(r)),r};var wr=function(){if(this._geom=null,this._terminateDistance=0,this._ptLocator=new ni,this._minDistanceLocation=null,this._minDistance=Ee.MAX_VALUE,arguments.length===2){var t=arguments[0],r=arguments[1];this._geom=[t,r],this._terminateDistance=0}else if(arguments.length===3){var n=arguments[0],i=arguments[1],s=arguments[2];this._geom=new Array(2).fill(null),this._geom[0]=n,this._geom[1]=i,this._terminateDistance=s}};wr.prototype.computeContainmentDistance=function(){var t=this;if(arguments.length===0){var r=new Array(2).fill(null);if(this.computeContainmentDistance(0,r),this._minDistance<=this._terminateDistance)return null;this.computeContainmentDistance(1,r)}else if(arguments.length===2){var n=arguments[0],i=arguments[1],s=1-n,a=fs.getPolygons(this._geom[n]);if(a.size()>0){var o=co.getLocations(this._geom[s]);if(this.computeContainmentDistance(o,a,i),this._minDistance<=this._terminateDistance)return this._minDistanceLocation[s]=i[0],this._minDistanceLocation[n]=i[1],null}}else if(arguments.length===3){if(arguments[2]instanceof Array&&pe(arguments[0],Zn)&&pe(arguments[1],Zn)){for(var u=arguments[0],f=arguments[1],l=arguments[2],c=0;c<u.size();c++)for(var h=u.get(c),d=0;d<f.size();d++)if(t.computeContainmentDistance(h,f.get(d),l),t._minDistance<=t._terminateDistance)return null}else if(arguments[2]instanceof Array&&arguments[0]instanceof Yr&&arguments[1]instanceof fr){var m=arguments[0],g=arguments[1],p=arguments[2],v=m.getCoordinate();if(z.EXTERIOR!==this._ptLocator.locate(v,g))return this._minDistance=0,p[0]=m,p[1]=new Yr(g,v),null}}};wr.prototype.computeMinDistanceLinesPoints=function(t,r,n){for(var i=this,s=0;s<t.size();s++)for(var a=t.get(s),o=0;o<r.size();o++){var u=r.get(o);if(i.computeMinDistance(a,u,n),i._minDistance<=i._terminateDistance)return null}};wr.prototype.computeFacetDistance=function(){var t=new Array(2).fill(null),r=Cr.getLines(this._geom[0]),n=Cr.getLines(this._geom[1]),i=Vs.getPoints(this._geom[0]),s=Vs.getPoints(this._geom[1]);if(this.computeMinDistanceLines(r,n,t),this.updateMinDistance(t,!1),this._minDistance<=this._terminateDistance||(t[0]=null,t[1]=null,this.computeMinDistanceLinesPoints(r,s,t),this.updateMinDistance(t,!1),this._minDistance<=this._terminateDistance)||(t[0]=null,t[1]=null,this.computeMinDistanceLinesPoints(n,i,t),this.updateMinDistance(t,!0),this._minDistance<=this._terminateDistance))return null;t[0]=null,t[1]=null,this.computeMinDistancePoints(i,s,t),this.updateMinDistance(t,!1)};wr.prototype.nearestLocations=function(){return this.computeMinDistance(),this._minDistanceLocation};wr.prototype.updateMinDistance=function(t,r){if(t[0]===null)return null;r?(this._minDistanceLocation[0]=t[1],this._minDistanceLocation[1]=t[0]):(this._minDistanceLocation[0]=t[0],this._minDistanceLocation[1]=t[1])};wr.prototype.nearestPoints=function(){this.computeMinDistance();var t=[this._minDistanceLocation[0].getCoordinate(),this._minDistanceLocation[1].getCoordinate()];return t};wr.prototype.computeMinDistance=function(){var t=this;if(arguments.length===0){if(this._minDistanceLocation!==null||(this._minDistanceLocation=new Array(2).fill(null),this.computeContainmentDistance(),this._minDistance<=this._terminateDistance))return null;this.computeFacetDistance()}else if(arguments.length===3){if(arguments[2]instanceof Array&&arguments[0]instanceof Wt&&arguments[1]instanceof gn){var r=arguments[0],n=arguments[1],i=arguments[2];if(r.getEnvelopeInternal().distance(n.getEnvelopeInternal())>this._minDistance)return null;for(var s=r.getCoordinates(),a=n.getCoordinate(),o=0;o<s.length-1;o++){var u=J.distancePointLine(a,s[o],s[o+1]);if(u<t._minDistance){t._minDistance=u;var f=new oe(s[o],s[o+1]),l=f.closestPoint(a);i[0]=new Yr(r,o,l),i[1]=new Yr(n,0,a)}if(t._minDistance<=t._terminateDistance)return null}}else if(arguments[2]instanceof Array&&arguments[0]instanceof Wt&&arguments[1]instanceof Wt){var c=arguments[0],h=arguments[1],d=arguments[2];if(c.getEnvelopeInternal().distance(h.getEnvelopeInternal())>this._minDistance)return null;for(var m=c.getCoordinates(),g=h.getCoordinates(),p=0;p<m.length-1;p++)for(var v=0;v<g.length-1;v++){var _=J.distanceLineLine(m[p],m[p+1],g[v],g[v+1]);if(_<t._minDistance){t._minDistance=_;var y=new oe(m[p],m[p+1]),x=new oe(g[v],g[v+1]),E=y.closestPoints(x);d[0]=new Yr(c,p,E[0]),d[1]=new Yr(h,v,E[1])}if(t._minDistance<=t._terminateDistance)return null}}}};wr.prototype.computeMinDistancePoints=function(t,r,n){for(var i=this,s=0;s<t.size();s++)for(var a=t.get(s),o=0;o<r.size();o++){var u=r.get(o),f=a.getCoordinate().distance(u.getCoordinate());if(f<i._minDistance&&(i._minDistance=f,n[0]=new Yr(a,0,a.getCoordinate()),n[1]=new Yr(u,0,u.getCoordinate())),i._minDistance<=i._terminateDistance)return null}};wr.prototype.distance=function(){if(this._geom[0]===null||this._geom[1]===null)throw new zt("null geometries are not supported");return this._geom[0].isEmpty()||this._geom[1].isEmpty()?0:(this.computeMinDistance(),this._minDistance)};wr.prototype.computeMinDistanceLines=function(t,r,n){for(var i=this,s=0;s<t.size();s++)for(var a=t.get(s),o=0;o<r.size();o++){var u=r.get(o);if(i.computeMinDistance(a,u,n),i._minDistance<=i._terminateDistance)return null}};wr.prototype.interfaces_=function(){return[]};wr.prototype.getClass=function(){return wr};wr.distance=function(t,r){var n=new wr(t,r);return n.distance()};wr.isWithinDistance=function(t,r,n){var i=new wr(t,r,n);return i.distance()<=n};wr.nearestPoints=function(t,r){var n=new wr(t,r);return n.nearestPoints()};var Rr=function(){this._pt=[new V,new V],this._distance=Ee.NaN,this._isNull=!0};Rr.prototype.getCoordinates=function(){return this._pt};Rr.prototype.getCoordinate=function(t){return this._pt[t]};Rr.prototype.setMinimum=function(){if(arguments.length===1){var t=arguments[0];this.setMinimum(t._pt[0],t._pt[1])}else if(arguments.length===2){var r=arguments[0],n=arguments[1];if(this._isNull)return this.initialize(r,n),null;var i=r.distance(n);i<this._distance&&this.initialize(r,n,i)}};Rr.prototype.initialize=function(){if(arguments.length===0)this._isNull=!0;else if(arguments.length===2){var t=arguments[0],r=arguments[1];this._pt[0].setCoordinate(t),this._pt[1].setCoordinate(r),this._distance=t.distance(r),this._isNull=!1}else if(arguments.length===3){var n=arguments[0],i=arguments[1],s=arguments[2];this._pt[0].setCoordinate(n),this._pt[1].setCoordinate(i),this._distance=s,this._isNull=!1}};Rr.prototype.toString=function(){return Jn.toLineString(this._pt[0],this._pt[1])};Rr.prototype.getDistance=function(){return this._distance};Rr.prototype.setMaximum=function(){if(arguments.length===1){var t=arguments[0];this.setMaximum(t._pt[0],t._pt[1])}else if(arguments.length===2){var r=arguments[0],n=arguments[1];if(this._isNull)return this.initialize(r,n),null;var i=r.distance(n);i>this._distance&&this.initialize(r,n,i)}};Rr.prototype.interfaces_=function(){return[]};Rr.prototype.getClass=function(){return Rr};var gi=function(){};gi.prototype.interfaces_=function(){return[]};gi.prototype.getClass=function(){return gi};gi.computeDistance=function(){if(arguments[2]instanceof Rr&&arguments[0]instanceof Wt&&arguments[1]instanceof V)for(var t=arguments[0],r=arguments[1],n=arguments[2],i=new oe,s=t.getCoordinates(),a=0;a<s.length-1;a++){i.setCoordinates(s[a],s[a+1]);var o=i.closestPoint(r);n.setMinimum(o,r)}else if(arguments[2]instanceof Rr&&arguments[0]instanceof fr&&arguments[1]instanceof V){var u=arguments[0],f=arguments[1],l=arguments[2];gi.computeDistance(u.getExteriorRing(),f,l);for(var c=0;c<u.getNumInteriorRing();c++)gi.computeDistance(u.getInteriorRingN(c),f,l)}else if(arguments[2]instanceof Rr&&arguments[0]instanceof me&&arguments[1]instanceof V){var h=arguments[0],d=arguments[1],m=arguments[2];if(h instanceof Wt)gi.computeDistance(h,d,m);else if(h instanceof fr)gi.computeDistance(h,d,m);else if(h instanceof Qr)for(var g=h,p=0;p<g.getNumGeometries();p++){var v=g.getGeometryN(p);gi.computeDistance(v,d,m)}else m.setMinimum(h.getCoordinate(),d)}else if(arguments[2]instanceof Rr&&arguments[0]instanceof oe&&arguments[1]instanceof V){var _=arguments[0],y=arguments[1],x=arguments[2],E=_.closestPoint(y);x.setMinimum(E,y)}};var kn=function(){this._g0=null,this._g1=null,this._ptDist=new Rr,this._densifyFrac=0;var t=arguments[0],r=arguments[1];this._g0=t,this._g1=r},Bp={MaxPointDistanceFilter:{configurable:!0},MaxDensifiedByFractionDistanceFilter:{configurable:!0}};kn.prototype.getCoordinates=function(){return this._ptDist.getCoordinates()};kn.prototype.setDensifyFraction=function(t){if(t>1||t<=0)throw new zt("Fraction is not in range (0.0 - 1.0]");this._densifyFrac=t};kn.prototype.compute=function(t,r){this.computeOrientedDistance(t,r,this._ptDist),this.computeOrientedDistance(r,t,this._ptDist)};kn.prototype.distance=function(){return this.compute(this._g0,this._g1),this._ptDist.getDistance()};kn.prototype.computeOrientedDistance=function(t,r,n){var i=new ho(r);if(t.apply(i),n.setMaximum(i.getMaxPointDistance()),this._densifyFrac>0){var s=new Xs(r,this._densifyFrac);t.apply(s),n.setMaximum(s.getMaxPointDistance())}};kn.prototype.orientedDistance=function(){return this.computeOrientedDistance(this._g0,this._g1,this._ptDist),this._ptDist.getDistance()};kn.prototype.interfaces_=function(){return[]};kn.prototype.getClass=function(){return kn};kn.distance=function(){if(arguments.length===2){var t=arguments[0],r=arguments[1],n=new kn(t,r);return n.distance()}else if(arguments.length===3){var i=arguments[0],s=arguments[1],a=arguments[2],o=new kn(i,s);return o.setDensifyFraction(a),o.distance()}};Bp.MaxPointDistanceFilter.get=function(){return ho};Bp.MaxDensifiedByFractionDistanceFilter.get=function(){return Xs};Object.defineProperties(kn,Bp);var ho=function(){this._maxPtDist=new Rr,this._minPtDist=new Rr,this._euclideanDist=new gi,this._geom=null;var t=arguments[0];this._geom=t};ho.prototype.filter=function(t){this._minPtDist.initialize(),gi.computeDistance(this._geom,t,this._minPtDist),this._maxPtDist.setMaximum(this._minPtDist)};ho.prototype.getMaxPointDistance=function(){return this._maxPtDist};ho.prototype.interfaces_=function(){return[Ui]};ho.prototype.getClass=function(){return ho};var Xs=function(){this._maxPtDist=new Rr,this._minPtDist=new Rr,this._geom=null,this._numSubSegs=0;var t=arguments[0],r=arguments[1];this._geom=t,this._numSubSegs=Math.trunc(Math.round(1/r))};Xs.prototype.filter=function(t,r){var n=this;if(r===0)return null;for(var i=t.getCoordinate(r-1),s=t.getCoordinate(r),a=(s.x-i.x)/this._numSubSegs,o=(s.y-i.y)/this._numSubSegs,u=0;u<this._numSubSegs;u++){var f=i.x+u*a,l=i.y+u*o,c=new V(f,l);n._minPtDist.initialize(),gi.computeDistance(n._geom,c,n._minPtDist),n._maxPtDist.setMaximum(n._minPtDist)}};Xs.prototype.isDone=function(){return!1};Xs.prototype.isGeometryChanged=function(){return!1};Xs.prototype.getMaxPointDistance=function(){return this._maxPtDist};Xs.prototype.interfaces_=function(){return[$n]};Xs.prototype.getClass=function(){return Xs};var mn=function(t,r,n){this._minValidDistance=null,this._maxValidDistance=null,this._minDistanceFound=null,this._maxDistanceFound=null,this._isValid=!0,this._errMsg=null,this._errorLocation=null,this._errorIndicator=null,this._input=t||null,this._bufDistance=r||null,this._result=n||null},Vp={VERBOSE:{configurable:!0},MAX_DISTANCE_DIFF_FRAC:{configurable:!0}};mn.prototype.checkMaximumDistance=function(t,r,n){var i=new kn(r,t);if(i.setDensifyFraction(.25),this._maxDistanceFound=i.orientedDistance(),this._maxDistanceFound>n){this._isValid=!1;var s=i.getCoordinates();this._errorLocation=s[1],this._errorIndicator=t.getFactory().createLineString(s),this._errMsg="Distance between buffer curve and input is too large ("+this._maxDistanceFound+" at "+Jn.toLineString(s[0],s[1])+")"}};mn.prototype.isValid=function(){var t=Math.abs(this._bufDistance),r=mn.MAX_DISTANCE_DIFF_FRAC*t;return this._minValidDistance=t-r,this._maxValidDistance=t+r,this._input.isEmpty()||this._result.isEmpty()?!0:(this._bufDistance>0?this.checkPositiveValid():this.checkNegativeValid(),mn.VERBOSE&&br.out.println("Min Dist= "+this._minDistanceFound+"  err= "+(1-this._minDistanceFound/this._bufDistance)+"  Max Dist= "+this._maxDistanceFound+"  err= "+(this._maxDistanceFound/this._bufDistance-1)),this._isValid)};mn.prototype.checkNegativeValid=function(){if(!(this._input instanceof fr||this._input instanceof zi||this._input instanceof Qr))return null;var t=this.getPolygonLines(this._input);if(this.checkMinimumDistance(t,this._result,this._minValidDistance),!this._isValid)return null;this.checkMaximumDistance(t,this._result,this._maxValidDistance)};mn.prototype.getErrorIndicator=function(){return this._errorIndicator};mn.prototype.checkMinimumDistance=function(t,r,n){var i=new wr(t,r,n);if(this._minDistanceFound=i.distance(),this._minDistanceFound<n){this._isValid=!1;var s=i.nearestPoints();this._errorLocation=i.nearestPoints()[1],this._errorIndicator=t.getFactory().createLineString(s),this._errMsg="Distance between buffer curve and input is too small ("+this._minDistanceFound+" at "+Jn.toLineString(s[0],s[1])+" )"}};mn.prototype.checkPositiveValid=function(){var t=this._result.getBoundary();if(this.checkMinimumDistance(this._input,t,this._minValidDistance),!this._isValid)return null;this.checkMaximumDistance(this._input,t,this._maxValidDistance)};mn.prototype.getErrorLocation=function(){return this._errorLocation};mn.prototype.getPolygonLines=function(t){for(var r=new Q,n=new Cr(r),i=fs.getPolygons(t),s=i.iterator();s.hasNext();){var a=s.next();a.apply(n)}return t.getFactory().buildGeometry(r)};mn.prototype.getErrorMessage=function(){return this._errMsg};mn.prototype.interfaces_=function(){return[]};mn.prototype.getClass=function(){return mn};Vp.VERBOSE.get=function(){return!1};Vp.MAX_DISTANCE_DIFF_FRAC.get=function(){return .012};Object.defineProperties(mn,Vp);var Sr=function(t,r,n){this._isValid=!0,this._errorMsg=null,this._errorLocation=null,this._errorIndicator=null,this._input=t||null,this._distance=r||null,this._result=n||null},zp={VERBOSE:{configurable:!0},MAX_ENV_DIFF_FRAC:{configurable:!0}};Sr.prototype.isValid=function(){return this.checkPolygonal(),this._isValid?(this.checkExpectedEmpty(),this._isValid?(this.checkEnvelope(),this._isValid?(this.checkArea(),this._isValid?(this.checkDistance(),this._isValid):this._isValid):this._isValid):this._isValid):this._isValid};Sr.prototype.checkEnvelope=function(){if(this._distance<0)return null;var t=this._distance*Sr.MAX_ENV_DIFF_FRAC;t===0&&(t=.001);var r=new ae(this._input.getEnvelopeInternal());r.expandBy(this._distance);var n=new ae(this._result.getEnvelopeInternal());n.expandBy(t),n.contains(r)||(this._isValid=!1,this._errorMsg="Buffer envelope is incorrect",this._errorIndicator=this._input.getFactory().toGeometry(n)),this.report("Envelope")};Sr.prototype.checkDistance=function(){var t=new mn(this._input,this._distance,this._result);t.isValid()||(this._isValid=!1,this._errorMsg=t.getErrorMessage(),this._errorLocation=t.getErrorLocation(),this._errorIndicator=t.getErrorIndicator()),this.report("Distance")};Sr.prototype.checkArea=function(){var t=this._input.getArea(),r=this._result.getArea();this._distance>0&&t>r&&(this._isValid=!1,this._errorMsg="Area of positive buffer is smaller than input",this._errorIndicator=this._result),this._distance<0&&t<r&&(this._isValid=!1,this._errorMsg="Area of negative buffer is larger than input",this._errorIndicator=this._result),this.report("Area")};Sr.prototype.checkPolygonal=function(){this._result instanceof fr||this._result instanceof zi||(this._isValid=!1),this._errorMsg="Result is not polygonal",this._errorIndicator=this._result,this.report("Polygonal")};Sr.prototype.getErrorIndicator=function(){return this._errorIndicator};Sr.prototype.getErrorLocation=function(){return this._errorLocation};Sr.prototype.checkExpectedEmpty=function(){if(this._input.getDimension()>=2||this._distance>0)return null;this._result.isEmpty()||(this._isValid=!1,this._errorMsg="Result is non-empty",this._errorIndicator=this._result),this.report("ExpectedEmpty")};Sr.prototype.report=function(t){if(!Sr.VERBOSE)return null;br.out.println("Check "+t+": "+(this._isValid?"passed":"FAILED"))};Sr.prototype.getErrorMessage=function(){return this._errorMsg};Sr.prototype.interfaces_=function(){return[]};Sr.prototype.getClass=function(){return Sr};Sr.isValidMsg=function(t,r,n){var i=new Sr(t,r,n);return i.isValid()?null:i.getErrorMessage()};Sr.isValid=function(t,r,n){var i=new Sr(t,r,n);return!!i.isValid()};zp.VERBOSE.get=function(){return!1};zp.MAX_ENV_DIFF_FRAC.get=function(){return .012};Object.defineProperties(Sr,zp);var Li=function(){this._pts=null,this._data=null;var t=arguments[0],r=arguments[1];this._pts=t,this._data=r};Li.prototype.getCoordinates=function(){return this._pts};Li.prototype.size=function(){return this._pts.length};Li.prototype.getCoordinate=function(t){return this._pts[t]};Li.prototype.isClosed=function(){return this._pts[0].equals(this._pts[this._pts.length-1])};Li.prototype.getSegmentOctant=function(t){return t===this._pts.length-1?-1:oo.octant(this.getCoordinate(t),this.getCoordinate(t+1))};Li.prototype.setData=function(t){this._data=t};Li.prototype.getData=function(){return this._data};Li.prototype.toString=function(){return Jn.toLineString(new Kt(this._pts))};Li.prototype.interfaces_=function(){return[Hi]};Li.prototype.getClass=function(){return Li};var gr=function(){this._findAllIntersections=!1,this._isCheckEndSegmentsOnly=!1,this._li=null,this._interiorIntersection=null,this._intSegments=null,this._intersections=new Q,this._intersectionCount=0,this._keepIntersections=!0;var t=arguments[0];this._li=t,this._interiorIntersection=null};gr.prototype.getInteriorIntersection=function(){return this._interiorIntersection};gr.prototype.setCheckEndSegmentsOnly=function(t){this._isCheckEndSegmentsOnly=t};gr.prototype.getIntersectionSegments=function(){return this._intSegments};gr.prototype.count=function(){return this._intersectionCount};gr.prototype.getIntersections=function(){return this._intersections};gr.prototype.setFindAllIntersections=function(t){this._findAllIntersections=t};gr.prototype.setKeepIntersections=function(t){this._keepIntersections=t};gr.prototype.processIntersections=function(t,r,n,i){if(!this._findAllIntersections&&this.hasIntersection()||t===n&&r===i)return null;if(this._isCheckEndSegmentsOnly){var s=this.isEndSegment(t,r)||this.isEndSegment(n,i);if(!s)return null}var a=t.getCoordinates()[r],o=t.getCoordinates()[r+1],u=n.getCoordinates()[i],f=n.getCoordinates()[i+1];this._li.computeIntersection(a,o,u,f),this._li.hasIntersection()&&this._li.isInteriorIntersection()&&(this._intSegments=new Array(4).fill(null),this._intSegments[0]=a,this._intSegments[1]=o,this._intSegments[2]=u,this._intSegments[3]=f,this._interiorIntersection=this._li.getIntersection(0),this._keepIntersections&&this._intersections.add(this._interiorIntersection),this._intersectionCount++)};gr.prototype.isEndSegment=function(t,r){return r===0||r>=t.size()-2};gr.prototype.hasIntersection=function(){return this._interiorIntersection!==null};gr.prototype.isDone=function(){return this._findAllIntersections?!1:this._interiorIntersection!==null};gr.prototype.interfaces_=function(){return[Ia]};gr.prototype.getClass=function(){return gr};gr.createAllIntersectionsFinder=function(t){var r=new gr(t);return r.setFindAllIntersections(!0),r};gr.createAnyIntersectionFinder=function(t){return new gr(t)};gr.createIntersectionCounter=function(t){var r=new gr(t);return r.setFindAllIntersections(!0),r.setKeepIntersections(!1),r};var ii=function(){this._li=new Oa,this._segStrings=null,this._findAllIntersections=!1,this._segInt=null,this._isValid=!0;var t=arguments[0];this._segStrings=t};ii.prototype.execute=function(){if(this._segInt!==null)return null;this.checkInteriorIntersections()};ii.prototype.getIntersections=function(){return this._segInt.getIntersections()};ii.prototype.isValid=function(){return this.execute(),this._isValid};ii.prototype.setFindAllIntersections=function(t){this._findAllIntersections=t};ii.prototype.checkInteriorIntersections=function(){this._isValid=!0,this._segInt=new gr(this._li),this._segInt.setFindAllIntersections(this._findAllIntersections);var t=new Np;if(t.setSegmentIntersector(this._segInt),t.computeNodes(this._segStrings),this._segInt.hasIntersection())return this._isValid=!1,null};ii.prototype.checkValid=function(){if(this.execute(),!this._isValid)throw new ps(this.getErrorMessage(),this._segInt.getInteriorIntersection())};ii.prototype.getErrorMessage=function(){if(this._isValid)return"no intersections found";var t=this._segInt.getIntersectionSegments();return"found non-noded intersection between "+Jn.toLineString(t[0],t[1])+" and "+Jn.toLineString(t[2],t[3])};ii.prototype.interfaces_=function(){return[]};ii.prototype.getClass=function(){return ii};ii.computeIntersections=function(t){var r=new ii(t);return r.setFindAllIntersections(!0),r.isValid(),r.getIntersections()};var Ma=function e(){this._nv=null;var t=arguments[0];this._nv=new ii(e.toSegmentStrings(t))};Ma.prototype.checkValid=function(){this._nv.checkValid()};Ma.prototype.interfaces_=function(){return[]};Ma.prototype.getClass=function(){return Ma};Ma.toSegmentStrings=function(t){for(var r=new Q,n=t.iterator();n.hasNext();){var i=n.next();r.add(new Li(i.getCoordinates(),i))}return r};Ma.checkValid=function(t){var r=new Ma(t);r.checkValid()};var mo=function(t){this._mapOp=t};mo.prototype.map=function(t){for(var r=this,n=new Q,i=0;i<t.getNumGeometries();i++){var s=r._mapOp.map(t.getGeometryN(i));s.isEmpty()||n.add(s)}return t.getFactory().createGeometryCollection(Pe.toGeometryArray(n))};mo.prototype.interfaces_=function(){return[]};mo.prototype.getClass=function(){return mo};mo.map=function(t,r){var n=new mo(r);return n.map(t)};var Pi=function(){this._op=null,this._geometryFactory=null,this._ptLocator=null,this._lineEdgesList=new Q,this._resultLineList=new Q;var t=arguments[0],r=arguments[1],n=arguments[2];this._op=t,this._geometryFactory=r,this._ptLocator=n};Pi.prototype.collectLines=function(t){for(var r=this,n=this._op.getGraph().getEdgeEnds().iterator();n.hasNext();){var i=n.next();r.collectLineEdge(i,t,r._lineEdgesList),r.collectBoundaryTouchEdge(i,t,r._lineEdgesList)}};Pi.prototype.labelIsolatedLine=function(t,r){var n=this._ptLocator.locate(t.getCoordinate(),this._op.getArgGeometry(r));t.getLabel().setLocation(r,n)};Pi.prototype.build=function(t){return this.findCoveredLineEdges(),this.collectLines(t),this.buildLines(t),this._resultLineList};Pi.prototype.collectLineEdge=function(t,r,n){var i=t.getLabel(),s=t.getEdge();t.isLineEdge()&&!t.isVisited()&&xe.isResultOfOp(i,r)&&!s.isCovered()&&(n.add(s),t.setVisitedEdge(!0))};Pi.prototype.findCoveredLineEdges=function(){for(var t=this,r=this._op.getGraph().getNodes().iterator();r.hasNext();){var n=r.next();n.getEdges().findCoveredLineEdges()}for(var i=this._op.getGraph().getEdgeEnds().iterator();i.hasNext();){var s=i.next(),a=s.getEdge();if(s.isLineEdge()&&!a.isCoveredSet()){var o=t._op.isCoveredByA(s.getCoordinate());a.setCovered(o)}}};Pi.prototype.labelIsolatedLines=function(t){for(var r=this,n=t.iterator();n.hasNext();){var i=n.next(),s=i.getLabel();i.isIsolated()&&(s.isNull(0)?r.labelIsolatedLine(i,0):r.labelIsolatedLine(i,1))}};Pi.prototype.buildLines=function(t){for(var r=this,n=this._lineEdgesList.iterator();n.hasNext();){var i=n.next(),s=r._geometryFactory.createLineString(i.getCoordinates());r._resultLineList.add(s),i.setInResult(!0)}};Pi.prototype.collectBoundaryTouchEdge=function(t,r,n){var i=t.getLabel();if(t.isLineEdge()||t.isVisited()||t.isInteriorAreaEdge()||t.getEdge().isInResult())return null;we.isTrue(!(t.isInResult()||t.getSym().isInResult())||!t.getEdge().isInResult()),xe.isResultOfOp(i,r)&&r===xe.INTERSECTION&&(n.add(t.getEdge()),t.setVisitedEdge(!0))};Pi.prototype.interfaces_=function(){return[]};Pi.prototype.getClass=function(){return Pi};var po=function(){this._op=null,this._geometryFactory=null,this._resultPointList=new Q;var t=arguments[0],r=arguments[1];this._op=t,this._geometryFactory=r};po.prototype.filterCoveredNodeToPoint=function(t){var r=t.getCoordinate();if(!this._op.isCoveredByLA(r)){var n=this._geometryFactory.createPoint(r);this._resultPointList.add(n)}};po.prototype.extractNonCoveredResultNodes=function(t){for(var r=this,n=this._op.getGraph().getNodes().iterator();n.hasNext();){var i=n.next();if(!i.isInResult()&&!i.isIncidentEdgeInResult()&&(i.getEdges().getDegree()===0||t===xe.INTERSECTION)){var s=i.getLabel();xe.isResultOfOp(s,t)&&r.filterCoveredNodeToPoint(i)}}};po.prototype.build=function(t){return this.extractNonCoveredResultNodes(t),this._resultPointList};po.prototype.interfaces_=function(){return[]};po.prototype.getClass=function(){return po};var un=function(){this._inputGeom=null,this._factory=null,this._pruneEmptyGeometry=!0,this._preserveGeometryCollectionType=!0,this._preserveCollections=!1,this._preserveType=!1};un.prototype.transformPoint=function(t,r){return this._factory.createPoint(this.transformCoordinates(t.getCoordinateSequence(),t))};un.prototype.transformPolygon=function(t,r){var n=this,i=!0,s=this.transformLinearRing(t.getExteriorRing(),t);(s===null||!(s instanceof Gi)||s.isEmpty())&&(i=!1);for(var a=new Q,o=0;o<t.getNumInteriorRing();o++){var u=n.transformLinearRing(t.getInteriorRingN(o),t);u===null||u.isEmpty()||(u instanceof Gi||(i=!1),a.add(u))}if(i)return this._factory.createPolygon(s,a.toArray([]));var f=new Q;return s!==null&&f.add(s),f.addAll(a),this._factory.buildGeometry(f)};un.prototype.createCoordinateSequence=function(t){return this._factory.getCoordinateSequenceFactory().create(t)};un.prototype.getInputGeometry=function(){return this._inputGeom};un.prototype.transformMultiLineString=function(t,r){for(var n=this,i=new Q,s=0;s<t.getNumGeometries();s++){var a=n.transformLineString(t.getGeometryN(s),t);a!==null&&(a.isEmpty()||i.add(a))}return this._factory.buildGeometry(i)};un.prototype.transformCoordinates=function(t,r){return this.copy(t)};un.prototype.transformLineString=function(t,r){return this._factory.createLineString(this.transformCoordinates(t.getCoordinateSequence(),t))};un.prototype.transformMultiPoint=function(t,r){for(var n=this,i=new Q,s=0;s<t.getNumGeometries();s++){var a=n.transformPoint(t.getGeometryN(s),t);a!==null&&(a.isEmpty()||i.add(a))}return this._factory.buildGeometry(i)};un.prototype.transformMultiPolygon=function(t,r){for(var n=this,i=new Q,s=0;s<t.getNumGeometries();s++){var a=n.transformPolygon(t.getGeometryN(s),t);a!==null&&(a.isEmpty()||i.add(a))}return this._factory.buildGeometry(i)};un.prototype.copy=function(t){return t.copy()};un.prototype.transformGeometryCollection=function(t,r){for(var n=this,i=new Q,s=0;s<t.getNumGeometries();s++){var a=n.transform(t.getGeometryN(s));a!==null&&(n._pruneEmptyGeometry&&a.isEmpty()||i.add(a))}return this._preserveGeometryCollectionType?this._factory.createGeometryCollection(Pe.toGeometryArray(i)):this._factory.buildGeometry(i)};un.prototype.transform=function(t){if(this._inputGeom=t,this._factory=t.getFactory(),t instanceof gn)return this.transformPoint(t,null);if(t instanceof uu)return this.transformMultiPoint(t,null);if(t instanceof Gi)return this.transformLinearRing(t,null);if(t instanceof Wt)return this.transformLineString(t,null);if(t instanceof wa)return this.transformMultiLineString(t,null);if(t instanceof fr)return this.transformPolygon(t,null);if(t instanceof zi)return this.transformMultiPolygon(t,null);if(t instanceof Qr)return this.transformGeometryCollection(t,null);throw new zt("Unknown Geometry subtype: "+t.getClass().getName())};un.prototype.transformLinearRing=function(t,r){var n=this.transformCoordinates(t.getCoordinateSequence(),t);if(n===null)return this._factory.createLinearRing(null);var i=n.size();return i>0&&i<4&&!this._preserveType?this._factory.createLineString(n):this._factory.createLinearRing(n)};un.prototype.interfaces_=function(){return[]};un.prototype.getClass=function(){return un};var Xi=function e(){if(this._snapTolerance=0,this._srcPts=null,this._seg=new oe,this._allowSnappingToSourceVertices=!1,this._isClosed=!1,arguments[0]instanceof Wt&&typeof arguments[1]=="number"){var t=arguments[0],r=arguments[1];e.call(this,t.getCoordinates(),r)}else if(arguments[0]instanceof Array&&typeof arguments[1]=="number"){var n=arguments[0],i=arguments[1];this._srcPts=n,this._isClosed=e.isClosed(n),this._snapTolerance=i}};Xi.prototype.snapVertices=function(t,r){for(var n=this,i=this._isClosed?t.size()-1:t.size(),s=0;s<i;s++){var a=t.get(s),o=n.findSnapForVertex(a,r);o!==null&&(t.set(s,new V(o)),s===0&&n._isClosed&&t.set(t.size()-1,new V(o)))}};Xi.prototype.findSnapForVertex=function(t,r){for(var n=this,i=0;i<r.length;i++){if(t.equals2D(r[i]))return null;if(t.distance(r[i])<n._snapTolerance)return r[i]}return null};Xi.prototype.snapTo=function(t){var r=new rl(this._srcPts);this.snapVertices(r,t),this.snapSegments(r,t);var n=r.toCoordinateArray();return n};Xi.prototype.snapSegments=function(t,r){var n=this;if(r.length===0)return null;var i=r.length;r[0].equals2D(r[r.length-1])&&(i=r.length-1);for(var s=0;s<i;s++){var a=r[s],o=n.findSegmentIndexToSnap(a,t);o>=0&&t.add(o+1,new V(a),!1)}};Xi.prototype.findSegmentIndexToSnap=function(t,r){for(var n=this,i=Ee.MAX_VALUE,s=-1,a=0;a<r.size()-1;a++){if(n._seg.p0=r.get(a),n._seg.p1=r.get(a+1),n._seg.p0.equals2D(t)||n._seg.p1.equals2D(t)){if(n._allowSnappingToSourceVertices)continue;return-1}var o=n._seg.distance(t);o<n._snapTolerance&&o<i&&(i=o,s=a)}return s};Xi.prototype.setAllowSnappingToSourceVertices=function(t){this._allowSnappingToSourceVertices=t};Xi.prototype.interfaces_=function(){return[]};Xi.prototype.getClass=function(){return Xi};Xi.isClosed=function(t){return t.length<=1?!1:t[0].equals2D(t[t.length-1])};var Qt=function(t){this._srcGeom=t||null},dx={SNAP_PRECISION_FACTOR:{configurable:!0}};Qt.prototype.snapTo=function(t,r){var n=this.extractTargetCoordinates(t),i=new mx(r,n);return i.transform(this._srcGeom)};Qt.prototype.snapToSelf=function(t,r){var n=this.extractTargetCoordinates(this._srcGeom),i=new mx(t,n,!0),s=i.transform(this._srcGeom),a=s;return r&&pe(a,Us)&&(a=s.buffer(0)),a};Qt.prototype.computeSnapTolerance=function(t){var r=this.computeMinimumSegmentLength(t),n=r/10;return n};Qt.prototype.extractTargetCoordinates=function(t){for(var r=new xi,n=t.getCoordinates(),i=0;i<n.length;i++)r.add(n[i]);return r.toArray(new Array(0).fill(null))};Qt.prototype.computeMinimumSegmentLength=function(t){for(var r=Ee.MAX_VALUE,n=0;n<t.length-1;n++){var i=t[n].distance(t[n+1]);i<r&&(r=i)}return r};Qt.prototype.interfaces_=function(){return[]};Qt.prototype.getClass=function(){return Qt};Qt.snap=function(t,r,n){var i=new Array(2).fill(null),s=new Qt(t);i[0]=s.snapTo(r,n);var a=new Qt(r);return i[1]=a.snapTo(i[0],n),i};Qt.computeOverlaySnapTolerance=function(){if(arguments.length===1){var t=arguments[0],r=Qt.computeSizeBasedSnapTolerance(t),n=t.getPrecisionModel();if(n.getType()===vt.FIXED){var i=1/n.getScale()*2/1.415;i>r&&(r=i)}return r}else if(arguments.length===2){var s=arguments[0],a=arguments[1];return Math.min(Qt.computeOverlaySnapTolerance(s),Qt.computeOverlaySnapTolerance(a))}};Qt.computeSizeBasedSnapTolerance=function(t){var r=t.getEnvelopeInternal(),n=Math.min(r.getHeight(),r.getWidth()),i=n*Qt.SNAP_PRECISION_FACTOR;return i};Qt.snapToSelf=function(t,r,n){var i=new Qt(t);return i.snapToSelf(r,n)};dx.SNAP_PRECISION_FACTOR.get=function(){return 1e-9};Object.defineProperties(Qt,dx);var mx=function(e){function t(r,n,i){e.call(this),this._snapTolerance=r||null,this._snapPts=n||null,this._isSelfSnap=i!==void 0?i:!1}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.snapLine=function(n,i){var s=new Xi(n,this._snapTolerance);return s.setAllowSnappingToSourceVertices(this._isSelfSnap),s.snapTo(i)},t.prototype.transformCoordinates=function(n,i){var s=n.toCoordinateArray(),a=this.snapLine(s,this._snapPts);return this._factory.getCoordinateSequenceFactory().create(a)},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(un),Hr=function(){this._isFirst=!0,this._commonMantissaBitsCount=53,this._commonBits=0,this._commonSignExp=null};Hr.prototype.getCommon=function(){return Ee.longBitsToDouble(this._commonBits)};Hr.prototype.add=function(t){var r=Ee.doubleToLongBits(t);if(this._isFirst)return this._commonBits=r,this._commonSignExp=Hr.signExpBits(this._commonBits),this._isFirst=!1,null;var n=Hr.signExpBits(r);if(n!==this._commonSignExp)return this._commonBits=0,null;this._commonMantissaBitsCount=Hr.numCommonMostSigMantissaBits(this._commonBits,r),this._commonBits=Hr.zeroLowerBits(this._commonBits,64-(12+this._commonMantissaBitsCount))};Hr.prototype.toString=function(){if(arguments.length===1){var t=arguments[0],r=Ee.longBitsToDouble(t),n=Ee.toBinaryString(t),i="0000000000000000000000000000000000000000000000000000000000000000"+n,s=i.substring(i.length-64),a=s.substring(0,1)+"  "+s.substring(1,12)+"(exp) "+s.substring(12)+" [ "+r+" ]";return a}};Hr.prototype.interfaces_=function(){return[]};Hr.prototype.getClass=function(){return Hr};Hr.getBit=function(t,r){var n=1<<r;return t&n?1:0};Hr.signExpBits=function(t){return t>>52};Hr.zeroLowerBits=function(t,r){var n=(1<<r)-1,i=~n,s=t&i;return s};Hr.numCommonMostSigMantissaBits=function(t,r){for(var n=0,i=52;i>=0;i--){if(Hr.getBit(t,i)!==Hr.getBit(r,i))return n;n++}return 52};var js=function(){this._commonCoord=null,this._ccFilter=new go},kp={CommonCoordinateFilter:{configurable:!0},Translater:{configurable:!0}};js.prototype.addCommonBits=function(t){var r=new Ks(this._commonCoord);t.apply(r),t.geometryChanged()};js.prototype.removeCommonBits=function(t){if(this._commonCoord.x===0&&this._commonCoord.y===0)return t;var r=new V(this._commonCoord);r.x=-r.x,r.y=-r.y;var n=new Ks(r);return t.apply(n),t.geometryChanged(),t};js.prototype.getCommonCoordinate=function(){return this._commonCoord};js.prototype.add=function(t){t.apply(this._ccFilter),this._commonCoord=this._ccFilter.getCommonCoordinate()};js.prototype.interfaces_=function(){return[]};js.prototype.getClass=function(){return js};kp.CommonCoordinateFilter.get=function(){return go};kp.Translater.get=function(){return Ks};Object.defineProperties(js,kp);var go=function(){this._commonBitsX=new Hr,this._commonBitsY=new Hr};go.prototype.filter=function(t){this._commonBitsX.add(t.x),this._commonBitsY.add(t.y)};go.prototype.getCommonCoordinate=function(){return new V(this._commonBitsX.getCommon(),this._commonBitsY.getCommon())};go.prototype.interfaces_=function(){return[Ui]};go.prototype.getClass=function(){return go};var Ks=function(){this.trans=null;var t=arguments[0];this.trans=t};Ks.prototype.filter=function(t,r){var n=t.getOrdinate(r,0)+this.trans.x,i=t.getOrdinate(r,1)+this.trans.y;t.setOrdinate(r,0,n),t.setOrdinate(r,1,i)};Ks.prototype.isDone=function(){return!1};Ks.prototype.isGeometryChanged=function(){return!0};Ks.prototype.interfaces_=function(){return[$n]};Ks.prototype.getClass=function(){return Ks};var vr=function(t,r){this._geom=new Array(2).fill(null),this._snapTolerance=null,this._cbr=null,this._geom[0]=t,this._geom[1]=r,this.computeSnapTolerance()};vr.prototype.selfSnap=function(t){var r=new Qt(t),n=r.snapTo(t,this._snapTolerance);return n};vr.prototype.removeCommonBits=function(t){this._cbr=new js,this._cbr.add(t[0]),this._cbr.add(t[1]);var r=new Array(2).fill(null);return r[0]=this._cbr.removeCommonBits(t[0].copy()),r[1]=this._cbr.removeCommonBits(t[1].copy()),r};vr.prototype.prepareResult=function(t){return this._cbr.addCommonBits(t),t};vr.prototype.getResultGeometry=function(t){var r=this.snap(this._geom),n=xe.overlayOp(r[0],r[1],t);return this.prepareResult(n)};vr.prototype.checkValid=function(t){t.isValid()||br.out.println("Snapped geometry is invalid")};vr.prototype.computeSnapTolerance=function(){this._snapTolerance=Qt.computeOverlaySnapTolerance(this._geom[0],this._geom[1])};vr.prototype.snap=function(t){var r=this.removeCommonBits(t),n=Qt.snap(r[0],r[1],this._snapTolerance);return n};vr.prototype.interfaces_=function(){return[]};vr.prototype.getClass=function(){return vr};vr.overlayOp=function(t,r,n){var i=new vr(t,r);return i.getResultGeometry(n)};vr.union=function(t,r){return vr.overlayOp(t,r,xe.UNION)};vr.intersection=function(t,r){return vr.overlayOp(t,r,xe.INTERSECTION)};vr.symDifference=function(t,r){return vr.overlayOp(t,r,xe.SYMDIFFERENCE)};vr.difference=function(t,r){return vr.overlayOp(t,r,xe.DIFFERENCE)};var $r=function(t,r){this._geom=new Array(2).fill(null),this._geom[0]=t,this._geom[1]=r};$r.prototype.getResultGeometry=function(t){var r=null,n=!1,i=null;try{r=xe.overlayOp(this._geom[0],this._geom[1],t);var s=!0;s&&(n=!0)}catch(a){if(a instanceof ds)i=a;else throw a}finally{}if(!n)try{r=vr.overlayOp(this._geom[0],this._geom[1],t)}catch(a){throw a instanceof ds?i:a}finally{}return r};$r.prototype.interfaces_=function(){return[]};$r.prototype.getClass=function(){return $r};$r.overlayOp=function(t,r,n){var i=new $r(t,r);return i.getResultGeometry(n)};$r.union=function(t,r){return $r.overlayOp(t,r,xe.UNION)};$r.intersection=function(t,r){return $r.overlayOp(t,r,xe.INTERSECTION)};$r.symDifference=function(t,r){return $r.overlayOp(t,r,xe.SYMDIFFERENCE)};$r.difference=function(t,r){return $r.overlayOp(t,r,xe.DIFFERENCE)};var Wf=function(){this.mce=null,this.chainIndex=null;var t=arguments[0],r=arguments[1];this.mce=t,this.chainIndex=r};Wf.prototype.computeIntersections=function(t,r){this.mce.computeIntersectsForChain(this.chainIndex,t.mce,t.chainIndex,r)};Wf.prototype.interfaces_=function(){return[]};Wf.prototype.getClass=function(){return Wf};var Cn=function e(){if(this._label=null,this._xValue=null,this._eventType=null,this._insertEvent=null,this._deleteEventIndex=null,this._obj=null,arguments.length===2){var t=arguments[0],r=arguments[1];this._eventType=e.DELETE,this._xValue=t,this._insertEvent=r}else if(arguments.length===3){var n=arguments[0],i=arguments[1],s=arguments[2];this._eventType=e.INSERT,this._label=n,this._xValue=i,this._obj=s}},Up={INSERT:{configurable:!0},DELETE:{configurable:!0}};Cn.prototype.isDelete=function(){return this._eventType===Cn.DELETE};Cn.prototype.setDeleteEventIndex=function(t){this._deleteEventIndex=t};Cn.prototype.getObject=function(){return this._obj};Cn.prototype.compareTo=function(t){var r=t;return this._xValue<r._xValue?-1:this._xValue>r._xValue?1:this._eventType<r._eventType?-1:this._eventType>r._eventType?1:0};Cn.prototype.getInsertEvent=function(){return this._insertEvent};Cn.prototype.isInsert=function(){return this._eventType===Cn.INSERT};Cn.prototype.isSameLabel=function(t){return this._label===null?!1:this._label===t._label};Cn.prototype.getDeleteEventIndex=function(){return this._deleteEventIndex};Cn.prototype.interfaces_=function(){return[Hn]};Cn.prototype.getClass=function(){return Cn};Up.INSERT.get=function(){return 1};Up.DELETE.get=function(){return 2};Object.defineProperties(Cn,Up);var Ac=function(){};Ac.prototype.interfaces_=function(){return[]};Ac.prototype.getClass=function(){return Ac};var Tr=function(){this._hasIntersection=!1,this._hasProper=!1,this._hasProperInterior=!1,this._properIntersectionPoint=null,this._li=null,this._includeProper=null,this._recordIsolated=null,this._isSelfIntersection=null,this._numIntersections=0,this.numTests=0,this._bdyNodes=null,this._isDone=!1,this._isDoneWhenProperInt=!1;var t=arguments[0],r=arguments[1],n=arguments[2];this._li=t,this._includeProper=r,this._recordIsolated=n};Tr.prototype.isTrivialIntersection=function(t,r,n,i){if(t===n&&this._li.getIntersectionNum()===1){if(Tr.isAdjacentSegments(r,i))return!0;if(t.isClosed()){var s=t.getNumPoints()-1;if(r===0&&i===s||i===0&&r===s)return!0}}return!1};Tr.prototype.getProperIntersectionPoint=function(){return this._properIntersectionPoint};Tr.prototype.setIsDoneIfProperInt=function(t){this._isDoneWhenProperInt=t};Tr.prototype.hasProperInteriorIntersection=function(){return this._hasProperInterior};Tr.prototype.isBoundaryPointInternal=function(t,r){for(var n=r.iterator();n.hasNext();){var i=n.next(),s=i.getCoordinate();if(t.isIntersection(s))return!0}return!1};Tr.prototype.hasProperIntersection=function(){return this._hasProper};Tr.prototype.hasIntersection=function(){return this._hasIntersection};Tr.prototype.isDone=function(){return this._isDone};Tr.prototype.isBoundaryPoint=function(t,r){return r===null?!1:!!(this.isBoundaryPointInternal(t,r[0])||this.isBoundaryPointInternal(t,r[1]))};Tr.prototype.setBoundaryNodes=function(t,r){this._bdyNodes=new Array(2).fill(null),this._bdyNodes[0]=t,this._bdyNodes[1]=r};Tr.prototype.addIntersections=function(t,r,n,i){if(t===n&&r===i)return null;this.numTests++;var s=t.getCoordinates()[r],a=t.getCoordinates()[r+1],o=n.getCoordinates()[i],u=n.getCoordinates()[i+1];this._li.computeIntersection(s,a,o,u),this._li.hasIntersection()&&(this._recordIsolated&&(t.setIsolated(!1),n.setIsolated(!1)),this._numIntersections++,this.isTrivialIntersection(t,r,n,i)||(this._hasIntersection=!0,(this._includeProper||!this._li.isProper())&&(t.addIntersections(this._li,r,0),n.addIntersections(this._li,i,1)),this._li.isProper()&&(this._properIntersectionPoint=this._li.getIntersection(0).copy(),this._hasProper=!0,this._isDoneWhenProperInt&&(this._isDone=!0),this.isBoundaryPoint(this._li,this._bdyNodes)||(this._hasProperInterior=!0))))};Tr.prototype.interfaces_=function(){return[]};Tr.prototype.getClass=function(){return Tr};Tr.isAdjacentSegments=function(t,r){return Math.abs(t-r)===1};var DN=function(e){function t(){e.call(this),this.events=new Q,this.nOverlaps=null}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.prepareEvents=function(){var n=this;ti.sort(this.events);for(var i=0;i<this.events.size();i++){var s=n.events.get(i);s.isDelete()&&s.getInsertEvent().setDeleteEventIndex(i)}},t.prototype.computeIntersections=function(){var n=this;if(arguments.length===1){var i=arguments[0];this.nOverlaps=0,this.prepareEvents();for(var s=0;s<this.events.size();s++){var a=n.events.get(s);if(a.isInsert()&&n.processOverlaps(s,a.getDeleteEventIndex(),a,i),i.isDone())break}}else if(arguments.length===3){if(arguments[2]instanceof Tr&&pe(arguments[0],Zn)&&pe(arguments[1],Zn)){var o=arguments[0],u=arguments[1],f=arguments[2];this.addEdges(o,o),this.addEdges(u,u),this.computeIntersections(f)}else if(typeof arguments[2]=="boolean"&&pe(arguments[0],Zn)&&arguments[1]instanceof Tr){var l=arguments[0],c=arguments[1],h=arguments[2];h?this.addEdges(l,null):this.addEdges(l),this.computeIntersections(c)}}},t.prototype.addEdge=function(n,i){for(var s=this,a=n.getMonotoneChainEdge(),o=a.getStartIndexes(),u=0;u<o.length-1;u++){var f=new Wf(a,u),l=new Cn(i,a.getMinX(u),f);s.events.add(l),s.events.add(new Cn(a.getMaxX(u),l))}},t.prototype.processOverlaps=function(n,i,s,a){for(var o=this,u=s.getObject(),f=n;f<i;f++){var l=o.events.get(f);if(l.isInsert()){var c=l.getObject();s.isSameLabel(l)||(u.computeIntersections(c,a),o.nOverlaps++)}}},t.prototype.addEdges=function(){var n=this;if(arguments.length===1)for(var i=arguments[0],s=i.iterator();s.hasNext();){var a=s.next();n.addEdge(a,a)}else if(arguments.length===2)for(var o=arguments[0],u=arguments[1],f=o.iterator();f.hasNext();){var l=f.next();n.addEdge(l,u)}},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(Ac),ji=function(){this._min=Ee.POSITIVE_INFINITY,this._max=Ee.NEGATIVE_INFINITY},px={NodeComparator:{configurable:!0}};ji.prototype.getMin=function(){return this._min};ji.prototype.intersects=function(t,r){return!(this._min>r||this._max<t)};ji.prototype.getMax=function(){return this._max};ji.prototype.toString=function(){return Jn.toLineString(new V(this._min,0),new V(this._max,0))};ji.prototype.interfaces_=function(){return[]};ji.prototype.getClass=function(){return ji};px.NodeComparator.get=function(){return Yf};Object.defineProperties(ji,px);var Yf=function(){};Yf.prototype.compare=function(t,r){var n=t,i=r,s=(n._min+n._max)/2,a=(i._min+i._max)/2;return s<a?-1:s>a?1:0};Yf.prototype.interfaces_=function(){return[tu]};Yf.prototype.getClass=function(){return Yf};var RN=function(e){function t(){e.call(this),this._item=null;var r=arguments[0],n=arguments[1],i=arguments[2];this._min=r,this._max=n,this._item=i}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.query=function(n,i,s){if(!this.intersects(n,i))return null;s.visitItem(this._item)},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(ji),ON=function(e){function t(){e.call(this),this._node1=null,this._node2=null;var r=arguments[0],n=arguments[1];this._node1=r,this._node2=n,this.buildExtent(this._node1,this._node2)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.buildExtent=function(n,i){this._min=Math.min(n._min,i._min),this._max=Math.max(n._max,i._max)},t.prototype.query=function(n,i,s){if(!this.intersects(n,i))return null;this._node1!==null&&this._node1.query(n,i,s),this._node2!==null&&this._node2.query(n,i,s)},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(ji),Ki=function(){this._leaves=new Q,this._root=null,this._level=0};Ki.prototype.buildTree=function(){var t=this;ti.sort(this._leaves,new ji.NodeComparator);for(var r=this._leaves,n=null,i=new Q;;){if(t.buildLevel(r,i),i.size()===1)return i.get(0);n=r,r=i,i=n}};Ki.prototype.insert=function(t,r,n){if(this._root!==null)throw new Error("Index cannot be added to once it has been queried");this._leaves.add(new RN(t,r,n))};Ki.prototype.query=function(t,r,n){this.init(),this._root.query(t,r,n)};Ki.prototype.buildRoot=function(){if(this._root!==null)return null;this._root=this.buildTree()};Ki.prototype.printNode=function(t){br.out.println(Jn.toLineString(new V(t._min,this._level),new V(t._max,this._level)))};Ki.prototype.init=function(){if(this._root!==null)return null;this.buildRoot()};Ki.prototype.buildLevel=function(t,r){this._level++,r.clear();for(var n=0;n<t.size();n+=2){var i=t.get(n),s=n+1<t.size()?t.get(n):null;if(s===null)r.add(i);else{var a=new ON(t.get(n),t.get(n+1));r.add(a)}}};Ki.prototype.interfaces_=function(){return[]};Ki.prototype.getClass=function(){return Ki};var mu=function(){this._items=new Q};mu.prototype.visitItem=function(t){this._items.add(t)};mu.prototype.getItems=function(){return this._items};mu.prototype.interfaces_=function(){return[Gs]};mu.prototype.getClass=function(){return mu};var pu=function(){this._index=null;var t=arguments[0];if(!pe(t,Us))throw new zt("Argument must be Polygonal");this._index=new Aa(t)},Gp={SegmentVisitor:{configurable:!0},IntervalIndexedGeometry:{configurable:!0}};pu.prototype.locate=function(t){var r=new _i(t),n=new gu(r);return this._index.query(t.y,t.y,n),r.getLocation()};pu.prototype.interfaces_=function(){return[hu]};pu.prototype.getClass=function(){return pu};Gp.SegmentVisitor.get=function(){return gu};Gp.IntervalIndexedGeometry.get=function(){return Aa};Object.defineProperties(pu,Gp);var gu=function(){this._counter=null;var t=arguments[0];this._counter=t};gu.prototype.visitItem=function(t){var r=t;this._counter.countSegment(r.getCoordinate(0),r.getCoordinate(1))};gu.prototype.interfaces_=function(){return[Gs]};gu.prototype.getClass=function(){return gu};var Aa=function(){this._index=new Ki;var t=arguments[0];this.init(t)};Aa.prototype.init=function(t){for(var r=this,n=Cr.getLines(t),i=n.iterator();i.hasNext();){var s=i.next(),a=s.getCoordinates();r.addLine(a)}};Aa.prototype.addLine=function(t){for(var r=this,n=1;n<t.length;n++){var i=new oe(t[n-1],t[n]),s=Math.min(i.p0.y,i.p1.y),a=Math.max(i.p0.y,i.p1.y);r._index.insert(s,a,i)}};Aa.prototype.query=function(){if(arguments.length===2){var t=arguments[0],r=arguments[1],n=new mu;return this._index.query(t,r,n),n.getItems()}else if(arguments.length===3){var i=arguments[0],s=arguments[1],a=arguments[2];this._index.query(i,s,a)}};Aa.prototype.interfaces_=function(){return[]};Aa.prototype.getClass=function(){return Aa};var mf=function(e){function t(){if(e.call(this),this._parentGeom=null,this._lineEdgeMap=new $0,this._boundaryNodeRule=null,this._useBoundaryDeterminationRule=!0,this._argIndex=null,this._boundaryNodes=null,this._hasTooFewPoints=!1,this._invalidPoint=null,this._areaPtLocator=null,this._ptLocator=new ni,arguments.length===2){var r=arguments[0],n=arguments[1],i=Un.OGC_SFS_BOUNDARY_RULE;this._argIndex=r,this._parentGeom=n,this._boundaryNodeRule=i,n!==null&&this.add(n)}else if(arguments.length===3){var s=arguments[0],a=arguments[1],o=arguments[2];this._argIndex=s,this._parentGeom=a,this._boundaryNodeRule=o,a!==null&&this.add(a)}}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.insertBoundaryPoint=function(n,i){var s=this._nodes.addNode(i),a=s.getLabel(),o=1,u=z.NONE;u=a.getLocation(n,j.ON),u===z.BOUNDARY&&o++;var f=t.determineBoundary(this._boundaryNodeRule,o);a.setLocation(n,f)},t.prototype.computeSelfNodes=function(){if(arguments.length===2){var n=arguments[0],i=arguments[1];return this.computeSelfNodes(n,i,!1)}else if(arguments.length===3){var s=arguments[0],a=arguments[1],o=arguments[2],u=new Tr(s,!0,!1);u.setIsDoneIfProperInt(o);var f=this.createEdgeSetIntersector(),l=this._parentGeom instanceof Gi||this._parentGeom instanceof fr||this._parentGeom instanceof zi,c=a||!l;return f.computeIntersections(this._edges,u,c),this.addSelfIntersectionNodes(this._argIndex),u}},t.prototype.computeSplitEdges=function(n){for(var i=this._edges.iterator();i.hasNext();){var s=i.next();s.eiList.addSplitEdges(n)}},t.prototype.computeEdgeIntersections=function(n,i,s){var a=new Tr(i,s,!0);a.setBoundaryNodes(this.getBoundaryNodes(),n.getBoundaryNodes());var o=this.createEdgeSetIntersector();return o.computeIntersections(this._edges,n._edges,a),a},t.prototype.getGeometry=function(){return this._parentGeom},t.prototype.getBoundaryNodeRule=function(){return this._boundaryNodeRule},t.prototype.hasTooFewPoints=function(){return this._hasTooFewPoints},t.prototype.addPoint=function(){if(arguments[0]instanceof gn){var n=arguments[0],i=n.getCoordinate();this.insertPoint(this._argIndex,i,z.INTERIOR)}else if(arguments[0]instanceof V){var s=arguments[0];this.insertPoint(this._argIndex,s,z.INTERIOR)}},t.prototype.addPolygon=function(n){var i=this;this.addPolygonRing(n.getExteriorRing(),z.EXTERIOR,z.INTERIOR);for(var s=0;s<n.getNumInteriorRing();s++){var a=n.getInteriorRingN(s);i.addPolygonRing(a,z.INTERIOR,z.EXTERIOR)}},t.prototype.addEdge=function(n){this.insertEdge(n);var i=n.getCoordinates();this.insertPoint(this._argIndex,i[0],z.BOUNDARY),this.insertPoint(this._argIndex,i[i.length-1],z.BOUNDARY)},t.prototype.addLineString=function(n){var i=Me.removeRepeatedPoints(n.getCoordinates());if(i.length<2)return this._hasTooFewPoints=!0,this._invalidPoint=i[0],null;var s=new Mc(i,new yt(this._argIndex,z.INTERIOR));this._lineEdgeMap.put(n,s),this.insertEdge(s),we.isTrue(i.length>=2,"found LineString with single point"),this.insertBoundaryPoint(this._argIndex,i[0]),this.insertBoundaryPoint(this._argIndex,i[i.length-1])},t.prototype.getInvalidPoint=function(){return this._invalidPoint},t.prototype.getBoundaryPoints=function(){for(var n=this.getBoundaryNodes(),i=new Array(n.size()).fill(null),s=0,a=n.iterator();a.hasNext();){var o=a.next();i[s++]=o.getCoordinate().copy()}return i},t.prototype.getBoundaryNodes=function(){return this._boundaryNodes===null&&(this._boundaryNodes=this._nodes.getBoundaryNodes(this._argIndex)),this._boundaryNodes},t.prototype.addSelfIntersectionNode=function(n,i,s){if(this.isBoundaryNode(n,i))return null;s===z.BOUNDARY&&this._useBoundaryDeterminationRule?this.insertBoundaryPoint(n,i):this.insertPoint(n,i,s)},t.prototype.addPolygonRing=function(n,i,s){if(n.isEmpty())return null;var a=Me.removeRepeatedPoints(n.getCoordinates());if(a.length<4)return this._hasTooFewPoints=!0,this._invalidPoint=a[0],null;var o=i,u=s;J.isCCW(a)&&(o=s,u=i);var f=new Mc(a,new yt(this._argIndex,z.BOUNDARY,o,u));this._lineEdgeMap.put(n,f),this.insertEdge(f),this.insertPoint(this._argIndex,a[0],z.BOUNDARY)},t.prototype.insertPoint=function(n,i,s){var a=this._nodes.addNode(i),o=a.getLabel();o===null?a._label=new yt(n,s):o.setLocation(n,s)},t.prototype.createEdgeSetIntersector=function(){return new DN},t.prototype.addSelfIntersectionNodes=function(n){for(var i=this,s=this._edges.iterator();s.hasNext();)for(var a=s.next(),o=a.getLabel().getLocation(n),u=a.eiList.iterator();u.hasNext();){var f=u.next();i.addSelfIntersectionNode(n,f.coord,o)}},t.prototype.add=function(){if(arguments.length===1){var n=arguments[0];if(n.isEmpty())return null;if(n instanceof zi&&(this._useBoundaryDeterminationRule=!1),n instanceof fr)this.addPolygon(n);else if(n instanceof Wt)this.addLineString(n);else if(n instanceof gn)this.addPoint(n);else if(n instanceof uu)this.addCollection(n);else if(n instanceof wa)this.addCollection(n);else if(n instanceof zi)this.addCollection(n);else if(n instanceof Qr)this.addCollection(n);else throw new Error(n.getClass().getName())}else return e.prototype.add.apply(this,arguments)},t.prototype.addCollection=function(n){for(var i=this,s=0;s<n.getNumGeometries();s++){var a=n.getGeometryN(s);i.add(a)}},t.prototype.locate=function(n){return pe(this._parentGeom,Us)&&this._parentGeom.getNumGeometries()>50?(this._areaPtLocator===null&&(this._areaPtLocator=new pu(this._parentGeom)),this._areaPtLocator.locate(n)):this._ptLocator.locate(n,this._parentGeom)},t.prototype.findEdge=function(){if(arguments.length===1){var n=arguments[0];return this._lineEdgeMap.get(n)}else return e.prototype.findEdge.apply(this,arguments)},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t.determineBoundary=function(n,i){return n.isInBoundary(i)?z.BOUNDARY:z.INTERIOR},t}(qt),vu=function(){if(this._li=new Oa,this._resultPrecisionModel=null,this._arg=null,arguments.length===1){var t=arguments[0];this.setComputationPrecision(t.getPrecisionModel()),this._arg=new Array(1).fill(null),this._arg[0]=new mf(0,t)}else if(arguments.length===2){var r=arguments[0],n=arguments[1],i=Un.OGC_SFS_BOUNDARY_RULE;r.getPrecisionModel().compareTo(n.getPrecisionModel())>=0?this.setComputationPrecision(r.getPrecisionModel()):this.setComputationPrecision(n.getPrecisionModel()),this._arg=new Array(2).fill(null),this._arg[0]=new mf(0,r,i),this._arg[1]=new mf(1,n,i)}else if(arguments.length===3){var s=arguments[0],a=arguments[1],o=arguments[2];s.getPrecisionModel().compareTo(a.getPrecisionModel())>=0?this.setComputationPrecision(s.getPrecisionModel()):this.setComputationPrecision(a.getPrecisionModel()),this._arg=new Array(2).fill(null),this._arg[0]=new mf(0,s,o),this._arg[1]=new mf(1,a,o)}};vu.prototype.getArgGeometry=function(t){return this._arg[t].getGeometry()};vu.prototype.setComputationPrecision=function(t){this._resultPrecisionModel=t,this._li.setPrecisionModel(this._resultPrecisionModel)};vu.prototype.interfaces_=function(){return[]};vu.prototype.getClass=function(){return vu};var xa=function(){};xa.prototype.interfaces_=function(){return[]};xa.prototype.getClass=function(){return xa};xa.map=function(){if(arguments[0]instanceof me&&pe(arguments[1],xa.MapOp)){for(var t=arguments[0],r=arguments[1],n=new Q,i=0;i<t.getNumGeometries();i++){var s=r.map(t.getGeometryN(i));s!==null&&n.add(s)}return t.getFactory().buildGeometry(n)}else if(pe(arguments[0],ar)&&pe(arguments[1],xa.MapOp)){for(var a=arguments[0],o=arguments[1],u=new Q,f=a.iterator();f.hasNext();){var l=f.next(),c=o.map(l);c!==null&&u.add(c)}return u}};xa.MapOp=function(){};var xe=function(e){function t(){var r=arguments[0],n=arguments[1];e.call(this,r,n),this._ptLocator=new ni,this._geomFact=null,this._resultGeom=null,this._graph=null,this._edgeList=new ri,this._resultPolyList=new Q,this._resultLineList=new Q,this._resultPointList=new Q,this._graph=new qt(new ax),this._geomFact=r.getFactory()}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.insertUniqueEdge=function(n){var i=this._edgeList.findEqualEdge(n);if(i!==null){var s=i.getLabel(),a=n.getLabel();i.isPointwiseEqual(n)||(a=new yt(n.getLabel()),a.flip());var o=i.getDepth();o.isNull()&&o.add(s),o.add(a),s.merge(a)}else this._edgeList.add(n)},t.prototype.getGraph=function(){return this._graph},t.prototype.cancelDuplicateResultEdges=function(){for(var n=this._graph.getEdgeEnds().iterator();n.hasNext();){var i=n.next(),s=i.getSym();i.isInResult()&&s.isInResult()&&(i.setInResult(!1),s.setInResult(!1))}},t.prototype.isCoveredByLA=function(n){return!!(this.isCovered(n,this._resultLineList)||this.isCovered(n,this._resultPolyList))},t.prototype.computeGeometry=function(n,i,s,a){var o=new Q;return o.addAll(n),o.addAll(i),o.addAll(s),o.isEmpty()?t.createEmptyResult(a,this._arg[0].getGeometry(),this._arg[1].getGeometry(),this._geomFact):this._geomFact.buildGeometry(o)},t.prototype.mergeSymLabels=function(){for(var n=this._graph.getNodes().iterator();n.hasNext();){var i=n.next();i.getEdges().mergeSymLabels()}},t.prototype.isCovered=function(n,i){for(var s=this,a=i.iterator();a.hasNext();){var o=a.next(),u=s._ptLocator.locate(n,o);if(u!==z.EXTERIOR)return!0}return!1},t.prototype.replaceCollapsedEdges=function(){for(var n=new Q,i=this._edgeList.iterator();i.hasNext();){var s=i.next();s.isCollapsed()&&(i.remove(),n.add(s.getCollapsedEdge()))}this._edgeList.addAll(n)},t.prototype.updateNodeLabelling=function(){for(var n=this._graph.getNodes().iterator();n.hasNext();){var i=n.next(),s=i.getEdges().getLabel();i.getLabel().merge(s)}},t.prototype.getResultGeometry=function(n){return this.computeOverlay(n),this._resultGeom},t.prototype.insertUniqueEdges=function(n){for(var i=this,s=n.iterator();s.hasNext();){var a=s.next();i.insertUniqueEdge(a)}},t.prototype.computeOverlay=function(n){this.copyPoints(0),this.copyPoints(1),this._arg[0].computeSelfNodes(this._li,!1),this._arg[1].computeSelfNodes(this._li,!1),this._arg[0].computeEdgeIntersections(this._arg[1],this._li,!0);var i=new Q;this._arg[0].computeSplitEdges(i),this._arg[1].computeSplitEdges(i),this.insertUniqueEdges(i),this.computeLabelsFromDepths(),this.replaceCollapsedEdges(),Ma.checkValid(this._edgeList.getEdges()),this._graph.addEdges(this._edgeList.getEdges()),this.computeLabelling(),this.labelIncompleteNodes(),this.findResultAreaEdges(n),this.cancelDuplicateResultEdges();var s=new vn(this._geomFact);s.add(this._graph),this._resultPolyList=s.getPolygons();var a=new Pi(this,this._geomFact,this._ptLocator);this._resultLineList=a.build(n);var o=new po(this,this._geomFact,this._ptLocator);this._resultPointList=o.build(n),this._resultGeom=this.computeGeometry(this._resultPointList,this._resultLineList,this._resultPolyList,n)},t.prototype.labelIncompleteNode=function(n,i){var s=this._ptLocator.locate(n.getCoordinate(),this._arg[i].getGeometry());n.getLabel().setLocation(i,s)},t.prototype.copyPoints=function(n){for(var i=this,s=this._arg[n].getNodeIterator();s.hasNext();){var a=s.next(),o=i._graph.addNode(a.getCoordinate());o.setLabel(n,a.getLabel().getLocation(n))}},t.prototype.findResultAreaEdges=function(n){for(var i=this._graph.getEdgeEnds().iterator();i.hasNext();){var s=i.next(),a=s.getLabel();a.isArea()&&!s.isInteriorAreaEdge()&&t.isResultOfOp(a.getLocation(0,j.RIGHT),a.getLocation(1,j.RIGHT),n)&&s.setInResult(!0)}},t.prototype.computeLabelsFromDepths=function(){for(var n=this._edgeList.iterator();n.hasNext();){var i=n.next(),s=i.getLabel(),a=i.getDepth();if(!a.isNull()){a.normalize();for(var o=0;o<2;o++)!s.isNull(o)&&s.isArea()&&!a.isNull(o)&&(a.getDelta(o)===0?s.toLine(o):(we.isTrue(!a.isNull(o,j.LEFT),"depth of LEFT side has not been initialized"),s.setLocation(o,j.LEFT,a.getLocation(o,j.LEFT)),we.isTrue(!a.isNull(o,j.RIGHT),"depth of RIGHT side has not been initialized"),s.setLocation(o,j.RIGHT,a.getLocation(o,j.RIGHT))))}}},t.prototype.computeLabelling=function(){for(var n=this,i=this._graph.getNodes().iterator();i.hasNext();){var s=i.next();s.getEdges().computeLabelling(n._arg)}this.mergeSymLabels(),this.updateNodeLabelling()},t.prototype.labelIncompleteNodes=function(){for(var n=this,i=this._graph.getNodes().iterator();i.hasNext();){var s=i.next(),a=s.getLabel();s.isIsolated()&&(a.isNull(0)?n.labelIncompleteNode(s,0):n.labelIncompleteNode(s,1)),s.getEdges().updateLabelling(a)}},t.prototype.isCoveredByA=function(n){return!!this.isCovered(n,this._resultPolyList)},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(vu);xe.overlayOp=function(e,t,r){var n=new xe(e,t),i=n.getResultGeometry(r);return i};xe.intersection=function(e,t){if(e.isEmpty()||t.isEmpty())return xe.createEmptyResult(xe.INTERSECTION,e,t,e.getFactory());if(e.isGeometryCollection()){var r=t;return mo.map(e,{interfaces_:function(){return[xa.MapOp]},map:function(n){return n.intersection(r)}})}return e.checkNotGeometryCollection(e),e.checkNotGeometryCollection(t),$r.overlayOp(e,t,xe.INTERSECTION)};xe.symDifference=function(e,t){if(e.isEmpty()||t.isEmpty()){if(e.isEmpty()&&t.isEmpty())return xe.createEmptyResult(xe.SYMDIFFERENCE,e,t,e.getFactory());if(e.isEmpty())return t.copy();if(t.isEmpty())return e.copy()}return e.checkNotGeometryCollection(e),e.checkNotGeometryCollection(t),$r.overlayOp(e,t,xe.SYMDIFFERENCE)};xe.resultDimension=function(e,t,r){var n=t.getDimension(),i=r.getDimension(),s=-1;switch(e){case xe.INTERSECTION:s=Math.min(n,i);break;case xe.UNION:s=Math.max(n,i);break;case xe.DIFFERENCE:s=n;break;case xe.SYMDIFFERENCE:s=Math.max(n,i);break;default:}return s};xe.createEmptyResult=function(e,t,r,n){var i=null;switch(xe.resultDimension(e,t,r)){case-1:i=n.createGeometryCollection(new Array(0).fill(null));break;case 0:i=n.createPoint();break;case 1:i=n.createLineString();break;case 2:i=n.createPolygon();break;default:}return i};xe.difference=function(e,t){return e.isEmpty()?xe.createEmptyResult(xe.DIFFERENCE,e,t,e.getFactory()):t.isEmpty()?e.copy():(e.checkNotGeometryCollection(e),e.checkNotGeometryCollection(t),$r.overlayOp(e,t,xe.DIFFERENCE))};xe.isResultOfOp=function(){if(arguments.length===2){var e=arguments[0],t=arguments[1],r=e.getLocation(0),n=e.getLocation(1);return xe.isResultOfOp(r,n,t)}else if(arguments.length===3){var i=arguments[0],s=arguments[1],a=arguments[2];switch(i===z.BOUNDARY&&(i=z.INTERIOR),s===z.BOUNDARY&&(s=z.INTERIOR),a){case xe.INTERSECTION:return i===z.INTERIOR&&s===z.INTERIOR;case xe.UNION:return i===z.INTERIOR||s===z.INTERIOR;case xe.DIFFERENCE:return i===z.INTERIOR&&s!==z.INTERIOR;case xe.SYMDIFFERENCE:return i===z.INTERIOR&&s!==z.INTERIOR||i!==z.INTERIOR&&s===z.INTERIOR;default:}return!1}};xe.INTERSECTION=1;xe.UNION=2;xe.DIFFERENCE=3;xe.SYMDIFFERENCE=4;var zs=function(){this._g=null,this._boundaryDistanceTolerance=null,this._linework=null,this._ptLocator=new ni,this._seg=new oe;var t=arguments[0],r=arguments[1];this._g=t,this._boundaryDistanceTolerance=r,this._linework=this.extractLinework(t)};zs.prototype.isWithinToleranceOfBoundary=function(t){for(var r=this,n=0;n<this._linework.getNumGeometries();n++)for(var i=r._linework.getGeometryN(n),s=i.getCoordinateSequence(),a=0;a<s.size()-1;a++){s.getCoordinate(a,r._seg.p0),s.getCoordinate(a+1,r._seg.p1);var o=r._seg.distance(t);if(o<=r._boundaryDistanceTolerance)return!0}return!1};zs.prototype.getLocation=function(t){return this.isWithinToleranceOfBoundary(t)?z.BOUNDARY:this._ptLocator.locate(t,this._g)};zs.prototype.extractLinework=function(t){var r=new _u;t.apply(r);var n=r.getLinework(),i=Pe.toLineStringArray(n);return t.getFactory().createMultiLineString(i)};zs.prototype.interfaces_=function(){return[]};zs.prototype.getClass=function(){return zs};var _u=function(){this._linework=null,this._linework=new Q};_u.prototype.getLinework=function(){return this._linework};_u.prototype.filter=function(t){var r=this;if(t instanceof fr){var n=t;this._linework.add(n.getExteriorRing());for(var i=0;i<n.getNumInteriorRing();i++)r._linework.add(n.getInteriorRingN(i))}};_u.prototype.interfaces_=function(){return[Ei]};_u.prototype.getClass=function(){return _u};var Da=function(){this._g=null,this._doLeft=!0,this._doRight=!0;var t=arguments[0];this._g=t};Da.prototype.extractPoints=function(t,r,n){for(var i=this,s=t.getCoordinates(),a=0;a<s.length-1;a++)i.computeOffsetPoints(s[a],s[a+1],r,n)};Da.prototype.setSidesToGenerate=function(t,r){this._doLeft=t,this._doRight=r};Da.prototype.getPoints=function(t){for(var r=this,n=new Q,i=Cr.getLines(this._g),s=i.iterator();s.hasNext();){var a=s.next();r.extractPoints(a,t,n)}return n};Da.prototype.computeOffsetPoints=function(t,r,n,i){var s=r.x-t.x,a=r.y-t.y,o=Math.sqrt(s*s+a*a),u=n*s/o,f=n*a/o,l=(r.x+t.x)/2,c=(r.y+t.y)/2;if(this._doLeft){var h=new V(l-f,c+u);i.add(h)}if(this._doRight){var d=new V(l+f,c-u);i.add(d)}};Da.prototype.interfaces_=function(){return[]};Da.prototype.getClass=function(){return Da};var An=function e(){this._geom=null,this._locFinder=null,this._location=new Array(3).fill(null),this._invalidLocation=null,this._boundaryDistanceTolerance=e.TOLERANCE,this._testCoords=new Q;var t=arguments[0],r=arguments[1],n=arguments[2];this._boundaryDistanceTolerance=e.computeBoundaryDistanceTolerance(t,r),this._geom=[t,r,n],this._locFinder=[new zs(this._geom[0],this._boundaryDistanceTolerance),new zs(this._geom[1],this._boundaryDistanceTolerance),new zs(this._geom[2],this._boundaryDistanceTolerance)]},gx={TOLERANCE:{configurable:!0}};An.prototype.reportResult=function(t,r,n){br.out.println("Overlay result invalid - A:"+z.toLocationSymbol(r[0])+" B:"+z.toLocationSymbol(r[1])+" expected:"+(n?"i":"e")+" actual:"+z.toLocationSymbol(r[2]))};An.prototype.isValid=function(t){this.addTestPts(this._geom[0]),this.addTestPts(this._geom[1]);var r=this.checkValid(t);return r};An.prototype.checkValid=function(){var t=this;if(arguments.length===1){for(var r=arguments[0],n=0;n<this._testCoords.size();n++){var i=t._testCoords.get(n);if(!t.checkValid(r,i))return t._invalidLocation=i,!1}return!0}else if(arguments.length===2){var s=arguments[0],a=arguments[1];return this._location[0]=this._locFinder[0].getLocation(a),this._location[1]=this._locFinder[1].getLocation(a),this._location[2]=this._locFinder[2].getLocation(a),An.hasLocation(this._location,z.BOUNDARY)?!0:this.isValidResult(s,this._location)}};An.prototype.addTestPts=function(t){var r=new Da(t);this._testCoords.addAll(r.getPoints(5*this._boundaryDistanceTolerance))};An.prototype.isValidResult=function(t,r){var n=xe.isResultOfOp(r[0],r[1],t),i=r[2]===z.INTERIOR,s=!(n^i);return s||this.reportResult(t,r,n),s};An.prototype.getInvalidLocation=function(){return this._invalidLocation};An.prototype.interfaces_=function(){return[]};An.prototype.getClass=function(){return An};An.hasLocation=function(t,r){for(var n=0;n<3;n++)if(t[n]===r)return!0;return!1};An.computeBoundaryDistanceTolerance=function(t,r){return Math.min(Qt.computeSizeBasedSnapTolerance(t),Qt.computeSizeBasedSnapTolerance(r))};An.isValid=function(t,r,n,i){var s=new An(t,r,i);return s.isValid(n)};gx.TOLERANCE.get=function(){return 1e-6};Object.defineProperties(An,gx);var bn=function e(t){this._geomFactory=null,this._skipEmpty=!1,this._inputGeoms=null,this._geomFactory=e.extractFactory(t),this._inputGeoms=t};bn.prototype.extractElements=function(t,r){var n=this;if(t===null)return null;for(var i=0;i<t.getNumGeometries();i++){var s=t.getGeometryN(i);n._skipEmpty&&s.isEmpty()||r.add(s)}};bn.prototype.combine=function(){for(var t=this,r=new Q,n=this._inputGeoms.iterator();n.hasNext();){var i=n.next();t.extractElements(i,r)}return r.size()===0?this._geomFactory!==null?this._geomFactory.createGeometryCollection(null):null:this._geomFactory.buildGeometry(r)};bn.prototype.interfaces_=function(){return[]};bn.prototype.getClass=function(){return bn};bn.combine=function(){if(arguments.length===1){var t=arguments[0],r=new bn(t);return r.combine()}else if(arguments.length===2){var n=arguments[0],i=arguments[1],s=new bn(bn.createList(n,i));return s.combine()}else if(arguments.length===3){var a=arguments[0],o=arguments[1],u=arguments[2],f=new bn(bn.createList(a,o,u));return f.combine()}};bn.extractFactory=function(t){return t.isEmpty()?null:t.iterator().next().getFactory()};bn.createList=function(){if(arguments.length===2){var t=arguments[0],r=arguments[1],n=new Q;return n.add(t),n.add(r),n}else if(arguments.length===3){var i=arguments[0],s=arguments[1],a=arguments[2],o=new Q;return o.add(i),o.add(s),o.add(a),o}};var rr=function(){this._inputPolys=null,this._geomFactory=null;var t=arguments[0];this._inputPolys=t,this._inputPolys===null&&(this._inputPolys=new Q)},vx={STRTREE_NODE_CAPACITY:{configurable:!0}};rr.prototype.reduceToGeometries=function(t){for(var r=this,n=new Q,i=t.iterator();i.hasNext();){var s=i.next(),a=null;pe(s,Zn)?a=r.unionTree(s):s instanceof me&&(a=s),n.add(a)}return n};rr.prototype.extractByEnvelope=function(t,r,n){for(var i=new Q,s=0;s<r.getNumGeometries();s++){var a=r.getGeometryN(s);a.getEnvelopeInternal().intersects(t)?i.add(a):n.add(a)}return this._geomFactory.buildGeometry(i)};rr.prototype.unionOptimized=function(t,r){var n=t.getEnvelopeInternal(),i=r.getEnvelopeInternal();if(!n.intersects(i)){var s=bn.combine(t,r);return s}if(t.getNumGeometries()<=1&&r.getNumGeometries()<=1)return this.unionActual(t,r);var a=n.intersection(i);return this.unionUsingEnvelopeIntersection(t,r,a)};rr.prototype.union=function(){if(this._inputPolys===null)throw new Error("union() method cannot be called twice");if(this._inputPolys.isEmpty())return null;this._geomFactory=this._inputPolys.iterator().next().getFactory();for(var t=new rx(rr.STRTREE_NODE_CAPACITY),r=this._inputPolys.iterator();r.hasNext();){var n=r.next();t.insert(n.getEnvelopeInternal(),n)}this._inputPolys=null;var i=t.itemsTree(),s=this.unionTree(i);return s};rr.prototype.binaryUnion=function(){if(arguments.length===1){var t=arguments[0];return this.binaryUnion(t,0,t.size())}else if(arguments.length===3){var r=arguments[0],n=arguments[1],i=arguments[2];if(i-n<=1){var s=rr.getGeometry(r,n);return this.unionSafe(s,null)}else{if(i-n===2)return this.unionSafe(rr.getGeometry(r,n),rr.getGeometry(r,n+1));var a=Math.trunc((i+n)/2),o=this.binaryUnion(r,n,a),u=this.binaryUnion(r,a,i);return this.unionSafe(o,u)}}};rr.prototype.repeatedUnion=function(t){for(var r=null,n=t.iterator();n.hasNext();){var i=n.next();r===null?r=i.copy():r=r.union(i)}return r};rr.prototype.unionSafe=function(t,r){return t===null&&r===null?null:t===null?r.copy():r===null?t.copy():this.unionOptimized(t,r)};rr.prototype.unionActual=function(t,r){return rr.restrictToPolygons(t.union(r))};rr.prototype.unionTree=function(t){var r=this.reduceToGeometries(t),n=this.binaryUnion(r);return n};rr.prototype.unionUsingEnvelopeIntersection=function(t,r,n){var i=new Q,s=this.extractByEnvelope(n,t,i),a=this.extractByEnvelope(n,r,i),o=this.unionActual(s,a);i.add(o);var u=bn.combine(i);return u};rr.prototype.bufferUnion=function(){if(arguments.length===1){var t=arguments[0],r=t.get(0).getFactory(),n=r.buildGeometry(t),i=n.buffer(0);return i}else if(arguments.length===2){var s=arguments[0],a=arguments[1],o=s.getFactory(),u=o.createGeometryCollection([s,a]),f=u.buffer(0);return f}};rr.prototype.interfaces_=function(){return[]};rr.prototype.getClass=function(){return rr};rr.restrictToPolygons=function(t){if(pe(t,Us))return t;var r=fs.getPolygons(t);return r.size()===1?r.get(0):t.getFactory().createMultiPolygon(Pe.toPolygonArray(r))};rr.getGeometry=function(t,r){return r>=t.size()?null:t.get(r)};rr.union=function(t){var r=new rr(t);return r.union()};vx.STRTREE_NODE_CAPACITY.get=function(){return 4};Object.defineProperties(rr,vx);var Xf=function(){};Xf.prototype.interfaces_=function(){return[]};Xf.prototype.getClass=function(){return Xf};Xf.union=function(t,r){if(t.isEmpty()||r.isEmpty()){if(t.isEmpty()&&r.isEmpty())return xe.createEmptyResult(xe.UNION,t,r,t.getFactory());if(t.isEmpty())return r.copy();if(r.isEmpty())return t.copy()}return t.checkNotGeometryCollection(t),t.checkNotGeometryCollection(r),$r.overlayOp(t,r,xe.UNION)};function NN(e,t){var r=Tn(e),n=Tn(t),i=e.properties||{};if(r=ly(r),n=ly(n),!r)return null;if(!n)return nr(r,i);var s=new Lu,a=s.read(r),o=s.read(n),u=xe.difference(a,o);if(u.isEmpty())return null;var f=new il,l=f.write(u);return nr(l,i)}function ly(e){switch(e.type){case"Polygon":return Mf(e)>1?e:null;case"MultiPolygon":var t=[];if(Jt(e,function(r){Mf(r)>1&&t.push(r.geometry.coordinates)}),t.length)return{type:"MultiPolygon",coordinates:t}}}var Na=function(){return new Dc};function Dc(){this.reset()}Dc.prototype={constructor:Dc,reset:function(){this.s=this.t=0},add:function(e){cy(oc,e,this.t),cy(this,oc.s,this.s),this.s?this.t+=oc.t:this.s=oc.t},valueOf:function(){return this.s}};var oc=new Dc;function cy(e,t,r){var n=e.s=t+r,i=n-t,s=n-i;e.t=t-s+(r-i)}var Ht=1e-6,It=Math.PI,Bn=It/2,hy=It/4,_s=It*2,pi=180/It,Mr=It/180,Xr=Math.abs,qp=Math.atan,jf=Math.atan2,yr=Math.cos,_x=Math.exp,Cx=Math.log,Dr=Math.sin,fh=Math.sqrt,yx=Math.tan;function FN(e){return e>1?0:e<-1?It:Math.acos(e)}function Kf(e){return e>1?Bn:e<-1?-Bn:Math.asin(e)}function Ef(){}function Rc(e,t){e&&my.hasOwnProperty(e.type)&&my[e.type](e,t)}var dy={Feature:function(e,t){Rc(e.geometry,t)},FeatureCollection:function(e,t){for(var r=e.features,n=-1,i=r.length;++n<i;)Rc(r[n].geometry,t)}},my={Sphere:function(e,t){t.sphere()},Point:function(e,t){e=e.coordinates,t.point(e[0],e[1],e[2])},MultiPoint:function(e,t){for(var r=e.coordinates,n=-1,i=r.length;++n<i;)e=r[n],t.point(e[0],e[1],e[2])},LineString:function(e,t){Xm(e.coordinates,t,0)},MultiLineString:function(e,t){for(var r=e.coordinates,n=-1,i=r.length;++n<i;)Xm(r[n],t,0)},Polygon:function(e,t){py(e.coordinates,t)},MultiPolygon:function(e,t){for(var r=e.coordinates,n=-1,i=r.length;++n<i;)py(r[n],t)},GeometryCollection:function(e,t){for(var r=e.geometries,n=-1,i=r.length;++n<i;)Rc(r[n],t)}};function Xm(e,t,r){var n=-1,i=e.length-r,s;for(t.lineStart();++n<i;)s=e[n],t.point(s[0],s[1],s[2]);t.lineEnd()}function py(e,t){var r=-1,n=e.length;for(t.polygonStart();++r<n;)Xm(e[r],t,1);t.polygonEnd()}var BN=function(e,t){e&&dy.hasOwnProperty(e.type)?dy[e.type](e,t):Rc(e,t)},sV=Na(),aV=Na();function jm(e){return[jf(e[1],e[0]),Kf(e[2])]}function Cu(e){var t=e[0],r=e[1],n=yr(r);return[n*yr(t),n*Dr(t),Dr(r)]}function uc(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function Oc(e,t){return[e[1]*t[2]-e[2]*t[1],e[2]*t[0]-e[0]*t[2],e[0]*t[1]-e[1]*t[0]]}function Mm(e,t){e[0]+=t[0],e[1]+=t[1],e[2]+=t[2]}function fc(e,t){return[e[0]*t,e[1]*t,e[2]*t]}function Km(e){var t=fh(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);e[0]/=t,e[1]/=t,e[2]/=t}var oV=Na(),xx=function(e,t){function r(n,i){return n=e(n,i),t(n[0],n[1])}return e.invert&&t.invert&&(r.invert=function(n,i){return n=t.invert(n,i),n&&e.invert(n[0],n[1])}),r};function Qm(e,t){return[e>It?e-_s:e<-It?e+_s:e,t]}Qm.invert=Qm;function Ex(e,t,r){return(e%=_s)?t||r?xx(vy(e),_y(t,r)):vy(e):t||r?_y(t,r):Qm}function gy(e){return function(t,r){return t+=e,[t>It?t-_s:t<-It?t+_s:t,r]}}function vy(e){var t=gy(e);return t.invert=gy(-e),t}function _y(e,t){var r=yr(e),n=Dr(e),i=yr(t),s=Dr(t);function a(o,u){var f=yr(u),l=yr(o)*f,c=Dr(o)*f,h=Dr(u),d=h*r+l*n;return[jf(c*i-d*s,l*r-h*n),Kf(d*i+c*s)]}return a.invert=function(o,u){var f=yr(u),l=yr(o)*f,c=Dr(o)*f,h=Dr(u),d=h*i-c*s;return[jf(c*i+h*s,l*r+d*n),Kf(d*r-l*n)]},a}var VN=function(e){e=Ex(e[0]*Mr,e[1]*Mr,e.length>2?e[2]*Mr:0);function t(r){return r=e(r[0]*Mr,r[1]*Mr),r[0]*=pi,r[1]*=pi,r}return t.invert=function(r){return r=e.invert(r[0]*Mr,r[1]*Mr),r[0]*=pi,r[1]*=pi,r},t};function zN(e,t,r,n,i,s){if(r){var a=yr(t),o=Dr(t),u=n*r;i==null?(i=t+n*_s,s=t-u/2):(i=Cy(a,i),s=Cy(a,s),(n>0?i<s:i>s)&&(i+=n*_s));for(var f,l=i;n>0?l>s:l<s;l-=u)f=jm([a,-o*yr(l),-o*Dr(l)]),e.point(f[0],f[1])}}function Cy(e,t){t=Cu(t),t[0]-=e,Km(t);var r=FN(-t[1]);return((-t[2]<0?-r:r)+_s-Ht)%_s}var bx=function(){var e=[],t;return{point:function(r,n){t.push([r,n])},lineStart:function(){e.push(t=[])},lineEnd:Ef,rejoin:function(){e.length>1&&e.push(e.pop().concat(e.shift()))},result:function(){var r=e;return e=[],t=null,r}}},kN=function(e,t,r,n,i,s){var a=e[0],o=e[1],u=t[0],f=t[1],l=0,c=1,h=u-a,d=f-o,m;if(m=r-a,!(!h&&m>0)){if(m/=h,h<0){if(m<l)return;m<c&&(c=m)}else if(h>0){if(m>c)return;m>l&&(l=m)}if(m=i-a,!(!h&&m<0)){if(m/=h,h<0){if(m>c)return;m>l&&(l=m)}else if(h>0){if(m<l)return;m<c&&(c=m)}if(m=n-o,!(!d&&m>0)){if(m/=d,d<0){if(m<l)return;m<c&&(c=m)}else if(d>0){if(m>c)return;m>l&&(l=m)}if(m=s-o,!(!d&&m<0)){if(m/=d,d<0){if(m>c)return;m>l&&(l=m)}else if(d>0){if(m<l)return;m<c&&(c=m)}return l>0&&(e[0]=a+l*h,e[1]=o+l*d),c<1&&(t[0]=a+c*h,t[1]=o+c*d),!0}}}}},pc=function(e,t){return Xr(e[0]-t[0])<Ht&&Xr(e[1]-t[1])<Ht};function lc(e,t,r,n){this.x=e,this.z=t,this.o=r,this.e=n,this.v=!1,this.n=this.p=null}var wx=function(e,t,r,n,i){var s=[],a=[],o,u;if(e.forEach(function(m){if(!((g=m.length-1)<=0)){var g,p=m[0],v=m[g],_;if(pc(p,v)){for(i.lineStart(),o=0;o<g;++o)i.point((p=m[o])[0],p[1]);i.lineEnd();return}s.push(_=new lc(p,m,null,!0)),a.push(_.o=new lc(p,null,_,!1)),s.push(_=new lc(v,m,null,!1)),a.push(_.o=new lc(v,null,_,!0))}}),!!s.length){for(a.sort(t),yy(s),yy(a),o=0,u=a.length;o<u;++o)a[o].e=r=!r;for(var f=s[0],l,c;;){for(var h=f,d=!0;h.v;)if((h=h.n)===f)return;l=h.z,i.lineStart();do{if(h.v=h.o.v=!0,h.e){if(d)for(o=0,u=l.length;o<u;++o)i.point((c=l[o])[0],c[1]);else n(h.x,h.n.x,1,i);h=h.n}else{if(d)for(l=h.p.z,o=l.length-1;o>=0;--o)i.point((c=l[o])[0],c[1]);else n(h.x,h.p.x,-1,i);h=h.p}h=h.o,l=h.z,d=!d}while(!h.v);i.lineEnd()}}};function yy(e){if(t=e.length){for(var t,r=0,n=e[0],i;++r<t;)n.n=i=e[r],i.p=n,n=i;n.n=i=e[0],i.p=n}}var Sx=function(e,t){return e<t?-1:e>t?1:e>=t?0:NaN},UN=function(e){return e.length===1&&(e=GN(e)),{left:function(t,r,n,i){for(n==null&&(n=0),i==null&&(i=t.length);n<i;){var s=n+i>>>1;e(t[s],r)<0?n=s+1:i=s}return n},right:function(t,r,n,i){for(n==null&&(n=0),i==null&&(i=t.length);n<i;){var s=n+i>>>1;e(t[s],r)>0?i=s:n=s+1}return n}}};function GN(e){return function(t,r){return Sx(e(t),r)}}var uV=UN(Sx),Tx=function(e){for(var t=e.length,r,n=-1,i=0,s,a;++n<t;)i+=e[n].length;for(s=new Array(i);--t>=0;)for(a=e[t],r=a.length;--r>=0;)s[--i]=a[r];return s},bf=1e9,cc=-bf;function qN(e,t,r,n){function i(f,l){return e<=f&&f<=r&&t<=l&&l<=n}function s(f,l,c,h){var d=0,m=0;if(f==null||(d=a(f,c))!==(m=a(l,c))||u(f,l)<0^c>0)do h.point(d===0||d===3?e:r,d>1?n:t);while((d=(d+c+4)%4)!==m);else h.point(l[0],l[1])}function a(f,l){return Xr(f[0]-e)<Ht?l>0?0:3:Xr(f[0]-r)<Ht?l>0?2:1:Xr(f[1]-t)<Ht?l>0?1:0:l>0?3:2}function o(f,l){return u(f.x,l.x)}function u(f,l){var c=a(f,1),h=a(l,1);return c!==h?c-h:c===0?l[1]-f[1]:c===1?f[0]-l[0]:c===2?f[1]-l[1]:l[0]-f[0]}return function(f){var l=f,c=bx(),h,d,m,g,p,v,_,y,x,E,S,I={point:P,lineStart:C,lineEnd:b,polygonStart:N,polygonEnd:B};function P(A,R){i(A,R)&&l.point(A,R)}function w(){for(var A=0,R=0,F=d.length;R<F;++R)for(var D=d[R],O=1,U=D.length,q=D[0],Y,W,K=q[0],re=q[1];O<U;++O)Y=K,W=re,q=D[O],K=q[0],re=q[1],W<=n?re>n&&(K-Y)*(n-W)>(re-W)*(e-Y)&&++A:re<=n&&(K-Y)*(n-W)<(re-W)*(e-Y)&&--A;return A}function N(){l=c,h=[],d=[],S=!0}function B(){var A=w(),R=S&&A,F=(h=Tx(h)).length;(R||F)&&(f.polygonStart(),R&&(f.lineStart(),s(null,null,1,f),f.lineEnd()),F&&wx(h,o,A,s,f),f.polygonEnd()),l=f,h=d=m=null}function C(){I.point=T,d&&d.push(m=[]),E=!0,x=!1,_=y=NaN}function b(){h&&(T(g,p),v&&x&&c.rejoin(),h.push(c.result())),I.point=P,x&&l.lineEnd()}function T(A,R){var F=i(A,R);if(d&&m.push([A,R]),E)g=A,p=R,v=F,E=!1,F&&(l.lineStart(),l.point(A,R));else if(F&&x)l.point(A,R);else{var D=[_=Math.max(cc,Math.min(bf,_)),y=Math.max(cc,Math.min(bf,y))],O=[A=Math.max(cc,Math.min(bf,A)),R=Math.max(cc,Math.min(bf,R))];kN(D,O,e,t,r,n)?(x||(l.lineStart(),l.point(D[0],D[1])),l.point(O[0],O[1]),F||l.lineEnd(),S=!1):F&&(l.lineStart(),l.point(A,R),S=!1)}_=A,y=R,x=F}return I}}var Am=Na(),HN=function(e,t){var r=t[0],n=t[1],i=[Dr(r),-yr(r),0],s=0,a=0;Am.reset();for(var o=0,u=e.length;o<u;++o)if(l=(f=e[o]).length)for(var f,l,c=f[l-1],h=c[0],d=c[1]/2+hy,m=Dr(d),g=yr(d),p=0;p<l;++p,h=_,m=x,g=E,c=v){var v=f[p],_=v[0],y=v[1]/2+hy,x=Dr(y),E=yr(y),S=_-h,I=S>=0?1:-1,P=I*S,w=P>It,N=m*x;if(Am.add(jf(N*I*Dr(P),g*E+N*yr(P))),s+=w?S+I*_s:S,w^h>=r^_>=r){var B=Oc(Cu(c),Cu(v));Km(B);var C=Oc(i,B);Km(C);var b=(w^S>=0?-1:1)*Kf(C[2]);(n>b||n===b&&(B[0]||B[1]))&&(a+=w^S>=0?1:-1)}}return(s<-Ht||s<Ht&&Am<-Ht)^a&1},fV=Na(),xy=function(e){return e},lV=Na(),cV=Na(),yu=1/0,Nc=yu,Qf=-yu,Fc=Qf,Ey={point:WN,lineStart:Ef,lineEnd:Ef,polygonStart:Ef,polygonEnd:Ef,result:function(){var e=[[yu,Nc],[Qf,Fc]];return Qf=Fc=-(Nc=yu=1/0),e}};function WN(e,t){e<yu&&(yu=e),e>Qf&&(Qf=e),t<Nc&&(Nc=t),t>Fc&&(Fc=t)}var hV=Na(),Ix=function(e,t,r,n){return function(i,s){var a=t(s),o=i.invert(n[0],n[1]),u=bx(),f=t(u),l=!1,c,h,d,m={point:g,lineStart:v,lineEnd:_,polygonStart:function(){m.point=y,m.lineStart=x,m.lineEnd=E,h=[],c=[]},polygonEnd:function(){m.point=g,m.lineStart=v,m.lineEnd=_,h=Tx(h);var S=HN(c,o);h.length?(l||(s.polygonStart(),l=!0),wx(h,XN,S,r,s)):S&&(l||(s.polygonStart(),l=!0),s.lineStart(),r(null,null,1,s),s.lineEnd()),l&&(s.polygonEnd(),l=!1),h=c=null},sphere:function(){s.polygonStart(),s.lineStart(),r(null,null,1,s),s.lineEnd(),s.polygonEnd()}};function g(S,I){var P=i(S,I);e(S=P[0],I=P[1])&&s.point(S,I)}function p(S,I){var P=i(S,I);a.point(P[0],P[1])}function v(){m.point=p,a.lineStart()}function _(){m.point=g,a.lineEnd()}function y(S,I){d.push([S,I]);var P=i(S,I);f.point(P[0],P[1])}function x(){f.lineStart(),d=[]}function E(){y(d[0][0],d[0][1]),f.lineEnd();var S=f.clean(),I=u.result(),P,w=I.length,N,B,C;if(d.pop(),c.push(d),d=null,!!w){if(S&1){if(B=I[0],(N=B.length-1)>0){for(l||(s.polygonStart(),l=!0),s.lineStart(),P=0;P<N;++P)s.point((C=B[P])[0],C[1]);s.lineEnd()}return}w>1&&S&2&&I.push(I.pop().concat(I.shift())),h.push(I.filter(YN))}}return m}};function YN(e){return e.length>1}function XN(e,t){return((e=e.x)[0]<0?e[1]-Bn-Ht:Bn-e[1])-((t=t.x)[0]<0?t[1]-Bn-Ht:Bn-t[1])}var by=Ix(function(){return!0},jN,QN,[-It,-Bn]);function jN(e){var t=NaN,r=NaN,n=NaN,i;return{lineStart:function(){e.lineStart(),i=1},point:function(s,a){var o=s>0?It:-It,u=Xr(s-t);Xr(u-It)<Ht?(e.point(t,r=(r+a)/2>0?Bn:-Bn),e.point(n,r),e.lineEnd(),e.lineStart(),e.point(o,r),e.point(s,r),i=0):n!==o&&u>=It&&(Xr(t-n)<Ht&&(t-=n*Ht),Xr(s-o)<Ht&&(s-=o*Ht),r=KN(t,r,s,a),e.point(n,r),e.lineEnd(),e.lineStart(),e.point(o,r),i=0),e.point(t=s,r=a),n=o},lineEnd:function(){e.lineEnd(),t=r=NaN},clean:function(){return 2-i}}}function KN(e,t,r,n){var i,s,a=Dr(e-r);return Xr(a)>Ht?qp((Dr(t)*(s=yr(n))*Dr(r)-Dr(n)*(i=yr(t))*Dr(e))/(i*s*a)):(t+n)/2}function QN(e,t,r,n){var i;if(e==null)i=r*Bn,n.point(-It,i),n.point(0,i),n.point(It,i),n.point(It,0),n.point(It,-i),n.point(0,-i),n.point(-It,-i),n.point(-It,0),n.point(-It,i);else if(Xr(e[0]-t[0])>Ht){var s=e[0]<t[0]?It:-It;i=r*s/2,n.point(-s,i),n.point(0,i),n.point(s,i)}else n.point(t[0],t[1])}var ZN=function(e,t){var r=yr(e),n=r>0,i=Xr(r)>Ht;function s(l,c,h,d){zN(d,e,t,h,l,c)}function a(l,c){return yr(l)*yr(c)>r}function o(l){var c,h,d,m,g;return{lineStart:function(){m=d=!1,g=1},point:function(p,v){var _=[p,v],y,x=a(p,v),E=n?x?0:f(p,v):x?f(p+(p<0?It:-It),v):0;if(!c&&(m=d=x)&&l.lineStart(),x!==d&&(y=u(c,_),(!y||pc(c,y)||pc(_,y))&&(_[0]+=Ht,_[1]+=Ht,x=a(_[0],_[1]))),x!==d)g=0,x?(l.lineStart(),y=u(_,c),l.point(y[0],y[1])):(y=u(c,_),l.point(y[0],y[1]),l.lineEnd()),c=y;else if(i&&c&&n^x){var S;!(E&h)&&(S=u(_,c,!0))&&(g=0,n?(l.lineStart(),l.point(S[0][0],S[0][1]),l.point(S[1][0],S[1][1]),l.lineEnd()):(l.point(S[1][0],S[1][1]),l.lineEnd(),l.lineStart(),l.point(S[0][0],S[0][1])))}x&&(!c||!pc(c,_))&&l.point(_[0],_[1]),c=_,d=x,h=E},lineEnd:function(){d&&l.lineEnd(),c=null},clean:function(){return g|(m&&d)<<1}}}function u(l,c,h){var d=Cu(l),m=Cu(c),g=[1,0,0],p=Oc(d,m),v=uc(p,p),_=p[0],y=v-_*_;if(!y)return!h&&l;var x=r*v/y,E=-r*_/y,S=Oc(g,p),I=fc(g,x),P=fc(p,E);Mm(I,P);var w=S,N=uc(I,w),B=uc(w,w),C=N*N-B*(uc(I,I)-1);if(!(C<0)){var b=fh(C),T=fc(w,(-N-b)/B);if(Mm(T,I),T=jm(T),!h)return T;var A=l[0],R=c[0],F=l[1],D=c[1],O;R<A&&(O=A,A=R,R=O);var U=R-A,q=Xr(U-It)<Ht,Y=q||U<Ht;if(!q&&D<F&&(O=F,F=D,D=O),Y?q?F+D>0^T[1]<(Xr(T[0]-A)<Ht?F:D):F<=T[1]&&T[1]<=D:U>It^(A<=T[0]&&T[0]<=R)){var W=fc(w,(-N+b)/B);return Mm(W,I),[T,jm(W)]}}}function f(l,c){var h=n?e:It-e,d=0;return l<-h?d|=1:l>h&&(d|=2),c<-h?d|=4:c>h&&(d|=8),d}return Ix(a,o,s,n?[0,-e]:[-It,e-It])};function Lx(e){return function(t){var r=new Zm;for(var n in e)r[n]=e[n];return r.stream=t,r}}function Zm(){}Zm.prototype={constructor:Zm,point:function(e,t){this.stream.point(e,t)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}};function Px(e,t,r){var n=t[1][0]-t[0][0],i=t[1][1]-t[0][1],s=e.clipExtent&&e.clipExtent();e.scale(150).translate([0,0]),s!=null&&e.clipExtent(null),BN(r,e.stream(Ey));var a=Ey.result(),o=Math.min(n/(a[1][0]-a[0][0]),i/(a[1][1]-a[0][1])),u=+t[0][0]+(n-o*(a[1][0]+a[0][0]))/2,f=+t[0][1]+(i-o*(a[1][1]+a[0][1]))/2;return s!=null&&e.clipExtent(s),e.scale(o*150).translate([u,f])}function JN(e,t,r){return Px(e,[[0,0],t],r)}var wy=16,$N=yr(30*Mr),Sy=function(e,t){return+t?tF(e,t):eF(e)};function eF(e){return Lx({point:function(t,r){t=e(t,r),this.stream.point(t[0],t[1])}})}function tF(e,t){function r(n,i,s,a,o,u,f,l,c,h,d,m,g,p){var v=f-n,_=l-i,y=v*v+_*_;if(y>4*t&&g--){var x=a+h,E=o+d,S=u+m,I=fh(x*x+E*E+S*S),P=Kf(S/=I),w=Xr(Xr(S)-1)<Ht||Xr(s-c)<Ht?(s+c)/2:jf(E,x),N=e(w,P),B=N[0],C=N[1],b=B-n,T=C-i,A=_*b-v*T;(A*A/y>t||Xr((v*b+_*T)/y-.5)>.3||a*h+o*d+u*m<$N)&&(r(n,i,s,a,o,u,B,C,w,x/=I,E/=I,S,g,p),p.point(B,C),r(B,C,w,x,E,S,f,l,c,h,d,m,g,p))}}return function(n){var i,s,a,o,u,f,l,c,h,d,m,g,p={point:v,lineStart:_,lineEnd:x,polygonStart:function(){n.polygonStart(),p.lineStart=E},polygonEnd:function(){n.polygonEnd(),p.lineStart=_}};function v(P,w){P=e(P,w),n.point(P[0],P[1])}function _(){c=NaN,p.point=y,n.lineStart()}function y(P,w){var N=Cu([P,w]),B=e(P,w);r(c,h,l,d,m,g,c=B[0],h=B[1],l=P,d=N[0],m=N[1],g=N[2],wy,n),n.point(c,h)}function x(){p.point=v,n.lineEnd()}function E(){_(),p.point=S,p.lineEnd=I}function S(P,w){y(i=P,w),s=c,a=h,o=d,u=m,f=g,p.point=y}function I(){r(c,h,l,d,m,g,s,a,i,o,u,f,wy,n),p.lineEnd=x,x()}return p}}var rF=Lx({point:function(e,t){this.stream.point(e*Mr,t*Mr)}});function nF(e){return iF(function(){return e})()}function iF(e){var t,r=150,n=480,i=250,s,a,o=0,u=0,f=0,l=0,c=0,h,d,m=null,g=by,p=null,v,_,y,x=xy,E=.5,S=Sy(B,E),I,P;function w(T){return T=d(T[0]*Mr,T[1]*Mr),[T[0]*r+s,a-T[1]*r]}function N(T){return T=d.invert((T[0]-s)/r,(a-T[1])/r),T&&[T[0]*pi,T[1]*pi]}function B(T,A){return T=t(T,A),[T[0]*r+s,a-T[1]*r]}w.stream=function(T){return I&&P===T?I:I=rF(g(h,S(x(P=T))))},w.clipAngle=function(T){return arguments.length?(g=+T?ZN(m=T*Mr,6*Mr):(m=null,by),b()):m*pi},w.clipExtent=function(T){return arguments.length?(x=T==null?(p=v=_=y=null,xy):qN(p=+T[0][0],v=+T[0][1],_=+T[1][0],y=+T[1][1]),b()):p==null?null:[[p,v],[_,y]]},w.scale=function(T){return arguments.length?(r=+T,C()):r},w.translate=function(T){return arguments.length?(n=+T[0],i=+T[1],C()):[n,i]},w.center=function(T){return arguments.length?(o=T[0]%360*Mr,u=T[1]%360*Mr,C()):[o*pi,u*pi]},w.rotate=function(T){return arguments.length?(f=T[0]%360*Mr,l=T[1]%360*Mr,c=T.length>2?T[2]%360*Mr:0,C()):[f*pi,l*pi,c*pi]},w.precision=function(T){return arguments.length?(S=Sy(B,E=T*T),b()):fh(E)},w.fitExtent=function(T,A){return Px(w,T,A)},w.fitSize=function(T,A){return JN(w,T,A)};function C(){d=xx(h=Ex(f,l,c),t);var T=t(o,u);return s=n-T[0]*r,a=i+T[1]*r,b()}function b(){return I=P=null,w}return function(){return t=e.apply(this,arguments),w.invert=t.invert&&N,C()}}function Mx(e,t){return[e,Cx(yx((Bn+t)/2))]}Mx.invert=function(e,t){return[e,2*qp(_x(t))-Bn]};function sF(e){var t=nF(e),r=t.center,n=t.scale,i=t.translate,s=t.clipExtent,a=null,o,u,f;t.scale=function(c){return arguments.length?(n(c),l()):n()},t.translate=function(c){return arguments.length?(i(c),l()):i()},t.center=function(c){return arguments.length?(r(c),l()):r()},t.clipExtent=function(c){return arguments.length?(c==null?a=o=u=f=null:(a=+c[0][0],o=+c[0][1],u=+c[1][0],f=+c[1][1]),l()):a==null?null:[[a,o],[u,f]]};function l(){var c=It*n(),h=t(VN(t.rotate()).invert([0,0]));return s(a==null?[[h[0]-c,h[1]-c],[h[0]+c,h[1]+c]]:e===Mx?[[Math.max(h[0]-c,a),o],[Math.min(h[0]+c,u),f]]:[[a,Math.max(h[1]-c,o)],[u,Math.min(h[1]+c,f)]])}return l()}function Ax(e,t){return[Cx(yx((Bn+t)/2)),-e]}Ax.invert=function(e,t){return[-t,2*qp(_x(e))-Bn]};var aF=function(){var e=sF(Ax),t=e.center,r=e.rotate;return e.center=function(n){return arguments.length?t([-n[1],n[0]]):(n=t(),[n[1],-n[0]])},e.rotate=function(n){return arguments.length?r([n[0],n[1],n.length>2?n[2]+90:90]):(n=r(),[n[0],n[1],n[2]-90])},r([0,0,90]).scale(159.155)};function oF(e,t,r){r=r||{};var n=r.units,i=r.steps||64;if(!e)throw new Error("geojson is required");if(typeof r!="object")throw new Error("options must be an object");if(typeof i!="number")throw new Error("steps must be an number");if(t===void 0)throw new Error("radius is required");if(i<=0)throw new Error("steps must be greater than 0");i=i||64,n=n||"kilometers";var s=[];switch(e.type){case"GeometryCollection":return Mi(e,function(a){var o=gc(a,t,n,i);o&&s.push(o)}),ge(s);case"FeatureCollection":return wt(e,function(a){var o=gc(a,t,n,i);o&&wt(o,function(u){u&&s.push(u)})}),ge(s)}return gc(e,t,n,i)}function gc(e,t,r,n){var i=e.properties||{},s=e.type==="Feature"?e.geometry:e;if(s.type==="GeometryCollection"){var a=[];return Mi(e,function(p){var v=gc(p,t,r,n);v&&a.push(v)}),ge(a)}var o,u=ur(e),f=u[1]>50&&u[3]>50;f?o={type:s.type,coordinates:Rx(s.coordinates,Ty(s))}:o=Ca(s);var l=new Lu,c=l.read(o),h=Jo(eo(t,r),"meters"),d=xr.bufferOp(c,h),m=new il;if(d=m.write(d),!Dx(d.coordinates)){var g;return f?g={type:d.type,coordinates:Ox(d.coordinates,Ty(s))}:g=Yc(d),g.geometry?g:nr(g,i)}}function Dx(e){return Array.isArray(e[0])?Dx(e[0]):isNaN(e[0])}function Rx(e,t){return typeof e[0]!="object"?t(e):e.map(function(r){return Rx(r,t)})}function Ox(e,t){return typeof e[0]!="object"?t.invert(e):e.map(function(r){return Ox(r,t)})}function Ty(e){var t=qc(e).geometry.coordinates.reverse(),r=t.map(function(n){return-n});return aF().center(t).rotate(r).scale(_r)}function Hp(){for(var e=new Lu,t=e.read(JSON.stringify(arguments[0].geometry)),r=1;r<arguments.length;r++)t=Xf.union(t,e.read(JSON.stringify(arguments[r].geometry)));var n=new il;return t=n.write(t),{type:"Feature",geometry:t,properties:arguments[0].properties}}function xu(e,t){var r=Tn(e),n=Tn(t);if(ks(Yo(n,{precision:4})).coordinates[0].length<4||ks(Yo(r,{precision:4})).coordinates[0].length<4)return null;var i=new Lu,s=i.read(Yo(r)),a=i.read(Yo(n)),o=xe.intersection(s,a);if(o.isEmpty())return null;var u=new il,f=u.write(o);return nr(f)}/**
 * @license get-closest https://github.com/cosmosio/get-closest
 *
 * The MIT License (MIT)
 *
 * Copyright (c) 2014-2017 Olivier Scherrer <pode.fr@gmail.com>
 */function uF(e,t,r){var n,i;if(!Array.isArray(t))throw new Error("Get closest expects an array as second argument");return t.forEach(function(s,a){var o=r(s,e);o>=0&&(typeof i>"u"||o<i)&&(i=o,n=a)}),n}function fF(e,t){return uF(e,t,function(r,n){return r-n})}function lF(e,t){if(t=t||{},!fe(t))throw new Error("options is invalid");var r=t.propertyName;Qi(e,"Polygon","dissolve");var n=Kr(e),i=n.features,s=[];i.forEach(function(l,c){l.properties.origIndexPosition=c});var a=Zf();a.load(n);for(var o in i){var u=i[o],f=!1;if(a.search(u).features.forEach(function(l){u=i[o];var c=l.properties.origIndexPosition;if(s.length>0&&c!==0)if(c>s[s.length-1])c=c-s.length;else{var h=fF(c,s);h!==0&&(c=c-h)}if(c!==+o){var d=i[c];!d||!u||r!==void 0&&d.properties[r]!==u.properties[r]||!P0(u,d)||!cF(u,d)||(i[o]=Hp(u,d),s.push(l.properties.origIndexPosition),s.sort(function(m,g){return m-g}),a.remove(l),i.splice(c,1),u.properties.origIndexPosition=o,a.remove(u,function(m,g){return m.properties.origIndexPosition===g.properties.origIndexPosition}),f=!0)}}),f){if(!u)continue;u.properties.origIndexPosition=o,a.insert(u),o--}}return i.forEach(function(l){delete l.properties.origIndexPosition,delete l.bbox}),n}function cF(e,t){var r=Pt(ls(e)),n=Pt(ls(t)),i=Zs(r,n).features;return i.length>0}function Nx(e,t,r){if(r=r||{},!fe(r))throw new Error("options is invalid");var n=r.properties||{},i=r.triangles,s=r.mask;if(t==null)throw new Error("cellSide is required");if(!bt(t))throw new Error("cellSide is invalid");if(!e)throw new Error("bbox is required");if(!Array.isArray(e))throw new Error("bbox must be array");if(e.length!==4)throw new Error("bbox must contain 4 numbers");if(s&&["Polygon","MultiPolygon"].indexOf(Mt(s))===-1)throw new Error("options.mask must be a (Multi)Polygon");var a=e[0],o=e[1],u=e[2],f=e[3],l=(o+f)/2,c=(a+u)/2,h=t*2/Et([a,l],[u,l],r),d=h*(u-a),m=t*2/Et([c,o],[c,f],r),g=m*(f-o),p=d/2,v=p*2,_=Math.sqrt(3)/2*g,y=u-a,x=f-o,E=3/4*v,S=_,I=(y-v)/(v-p/2),P=Math.floor(I),w=(P*E-p/2-y)/2-p/2+E/2,N=Math.floor((x-_)/_),B=(x-N*_)/2,C=N*_-x>_/2;C&&(B-=_/4);for(var b=[],T=[],A=0;A<6;A++){var R=2*Math.PI/6*A;b.push(Math.cos(R)),T.push(Math.sin(R))}for(var F=[],D=0;D<=P;D++)for(var O=0;O<=N;O++){var U=D%2===1;if(!(O===0&&U)&&!(O===0&&C)){var q=D*E+a-w,Y=O*S+o+B;if(U&&(Y-=_/2),i===!0)dF([q,Y],d/2,g/2,n,b,T).forEach(function(K){s?xu(s,K)&&F.push(K):F.push(K)});else{var W=hF([q,Y],d/2,g/2,n,b,T);s?xu(s,W)&&F.push(W):F.push(W)}}}return ge(F)}function hF(e,t,r,n,i,s){for(var a=[],o=0;o<6;o++){var u=e[0]+t*i[o],f=e[1]+r*s[o];a.push([u,f])}return a.push(a[0].slice()),ze([a],n)}function dF(e,t,r,n,i,s){for(var a=[],o=0;o<6;o++){var u=[];u.push(e),u.push([e[0]+t*i[o],e[1]+r*s[o]]),u.push([e[0]+t*i[(o+1)%6],e[1]+r*s[(o+1)%6]]),u.push(e),a.push(ze([u],n))}return a}function mF(e,t){var r=vF(t),n=gF(e),i=n[0],s=n[1];i=Iy(i),s=Iy(s);var a=pF(r,i,s);return a}function pF(e,t,r){var n=[];return n.push(e.geometry.coordinates[0]),Jt(t,function(i){n.push(i.geometry.coordinates[0])}),Jt(r,function(i){n.push(i.geometry.coordinates[0])}),ze(n)}function gF(e){var t=[],r=[];return Jt(e,function(n){var i=n.geometry.coordinates,s=i[0],a=i.slice(1);t.push(ze([s])),a.forEach(function(o){r.push(ze([o]))})}),[ge(t),ge(r)]}function vF(e){var t=[[[180,90],[-180,90],[-180,-90],[180,-90],[180,90]]],r=e&&e.geometry.coordinates||t;return ze(r)}function Iy(e){if(e.features.length<=1)return e;var t=_F(e),r=[],n={};return Jt(e,function(i,s){if(n[s])return!0;for(t.remove({index:s},Ly),n[s]=!0;;){var a=ur(i),o=t.search({minX:a[0],minY:a[1],maxX:a[2],maxY:a[3]});if(o.length>0){var u=o.map(function(f){return n[f.index]=!0,t.remove({index:f.index},Ly),f.geojson});u.push(i),i=Hp.apply(this,u)}if(o.length===0)break}r.push(i)}),ge(r)}function Ly(e,t){return e.index===t.index}function _F(e){var t=$o(),r=[];return Jt(e,function(n,i){var s=ur(n);r.push({minX:s[0],minY:s[1],maxX:s[2],maxY:s[3],geojson:n,index:i})}),t.load(r),t}function Fx(e,t,r){if(r=r||{},!fe(r))throw new Error("options is invalid");var n=r.properties,i=r.mask,s=[];if(t==null)throw new Error("cellSide is required");if(!bt(t))throw new Error("cellSide is invalid");if(!e)throw new Error("bbox is required");if(!Array.isArray(e))throw new Error("bbox must be array");if(e.length!==4)throw new Error("bbox must contain 4 numbers");if(i&&["Polygon","MultiPolygon"].indexOf(Mt(i))===-1)throw new Error("options.mask must be a (Multi)Polygon");for(var a=e[0],o=e[1],u=e[2],f=e[3],l=t/Et([a,o],[u,o],r),c=l*(u-a),h=t/Et([a,o],[a,f],r),d=h*(f-o),m=u-a,g=f-o,p=Math.floor(m/c),v=Math.floor(g/d),_=(m-p*c)/2,y=(g-v*d)/2,x=a+_,E=0;E<p;E++){for(var S=o+y,I=0;I<v;I++){var P=ze([[[x,S],[x,S+d],[x+c,S+d],[x+c,S],[x,S]]],n);i?xu(i,P)&&s.push(P):s.push(P),S+=d}x+=c}return ge(s)}function Bx(e,t,r){if(r=r||{},!fe(r))throw new Error("options is invalid");var n=r.properties,i=r.mask,s=[];if(t==null)throw new Error("cellSide is required");if(!bt(t))throw new Error("cellSide is invalid");if(!e)throw new Error("bbox is required");if(!Array.isArray(e))throw new Error("bbox must be array");if(e.length!==4)throw new Error("bbox must contain 4 numbers");if(i&&["Polygon","MultiPolygon"].indexOf(Mt(i))===-1)throw new Error("options.mask must be a (Multi)Polygon");for(var a=t/Et([e[0],e[1]],[e[2],e[1]],r),o=a*(e[2]-e[0]),u=t/Et([e[0],e[1]],[e[0],e[3]],r),f=u*(e[3]-e[1]),l=0,c=e[0];c<=e[2];){for(var h=0,d=e[1];d<=e[3];){var m=null,g=null;l%2===0&&h%2===0?(m=ze([[[c,d],[c,d+f],[c+o,d],[c,d]]],n),g=ze([[[c,d+f],[c+o,d+f],[c+o,d],[c,d+f]]],n)):l%2===0&&h%2===1?(m=ze([[[c,d],[c+o,d+f],[c+o,d],[c,d]]],n),g=ze([[[c,d],[c,d+f],[c+o,d+f],[c,d]]],n)):h%2===0&&l%2===1?(m=ze([[[c,d],[c,d+f],[c+o,d+f],[c,d]]],n),g=ze([[[c,d],[c+o,d+f],[c+o,d],[c,d]]],n)):h%2===1&&l%2===1&&(m=ze([[[c,d],[c,d+f],[c+o,d],[c,d]]],n),g=ze([[[c,d+f],[c+o,d+f],[c+o,d],[c,d+f]]],n)),i?(xu(i,m)&&s.push(m),xu(i,g)&&s.push(g)):(s.push(m),s.push(g)),d+=f,h++}l++,c+=o}return ge(s)}function CF(e,t,r){if(r=r||{},typeof r!="object")throw new Error("options is invalid");var n=r.gridType,i=r.property,s=r.weight;if(!e)throw new Error("points is required");if(Qi(e,"Point","input must contain Points"),!t)throw new Error("cellSize is required");if(s!==void 0&&typeof s!="number")throw new Error("weight must be a number");i=i||"elevation",n=n||"square",s=s||1;var a=ur(e),o;switch(n){case"point":case"points":o=p0(a,t,r);break;case"square":case"squares":o=Fx(a,t,r);break;case"hex":case"hexes":o=Nx(a,t,r);break;case"triangle":case"triangles":o=Bx(a,t,r);break;default:throw new Error("invalid gridType")}var u=[];return wt(o,function(f){var l=0,c=0;wt(e,function(d){var m=n==="point"?f:ro(f),g=Et(m,d,r),p;if(i!==void 0&&(p=d.properties[i]),p===void 0&&(p=d.geometry.coordinates[2]),p===void 0)throw new Error("zValue is missing");g===0&&(l=p);var v=1/Math.pow(g,s);c+=v,l+=v*p});var h=Kr(f);h.properties[i]=l/c,u.push(h)}),ge(u)}var Ji={projection:aD,random:pN,clusters:gN,helpers:QP,invariant:JP,meta:ZP,isolines:aM,convex:Yy,pointsWithinPolygon:Dm,concave:mA,collect:gA,flip:vA,simplify:wA,bezierSpline:aC,tag:IA,sample:LA,envelope:e0,square:t0,circle:fp,midpoint:AA,center:qc,centerOfMass:r0,centroid:ro,combine:DA,distance:Et,explode:lp,bbox:ur,tesselate:jA,bboxPolygon:up,booleanPointInPolygon:Ut,nearestPoint:zm,nearestPointOnLine:Fs,nearestPointToLine:lD,planepoint:hD,tin:Xy,bearing:us,destination:cs,kinks:dD,pointOnFeature:vC,area:Mf,along:gD,length:km,lineSlice:vD,lineSliceAlong:c0,pointGrid:p0,truncate:Yo,flatten:LD,lineIntersect:Zs,lineChunk:PD,unkinkPolygon:FD,greatCircle:BD,lineSegment:no,lineSplit:VD,lineArc:_0,polygonToLine:xc,lineToPolygon:PC,bboxClip:UD,lineOverlap:y0,sector:HD,rhumbBearing:_a,rhumbDistance:Wc,rhumbDestination:eu,polygonTangents:YD,rewind:KD,isobands:VR,transformRotate:x0,transformScale:E0,transformTranslate:YR,lineOffset:$R,polygonize:iO,booleanDisjoint:w0,booleanContains:lO,booleanCrosses:CO,booleanClockwise:bc,booleanOverlap:P0,booleanPointOnLine:Fn,booleanEqual:bO,booleanWithin:h0,clone:Kr,cleanCoords:ks,clustersDbscan:IO,clustersKmeans:NO,pointToLineDistance:f0,booleanParallel:FO,booleanIntersects:BO,shortestPath:kO,voronoi:uN,ellipse:B0,centerMean:Sp,centerMedian:fN,standardDeviationalEllipse:lN,difference:NN,buffer:oF,union:Hp,intersect:xu,dissolve:lF,hexGrid:Nx,mask:mF,squareGrid:Fx,triangleGrid:Bx,interpolate:CF,pointOnSurface:vC,polygonToLineString:xc,lineStringToPolygon:PC,inside:Ut,within:Dm,bezier:aC,nearest:zm,pointOnLine:Fs,lineDistance:km,radians2degrees:Ea,degrees2radians:dr,distanceToDegrees:_c,distanceToRadians:eo,radiansToDistance:Jo,bearingToAngle:va,convertDistance:to,toMercator:Ca,toWgs84:Yc,randomPosition:$f,randomPoint:z0,randomPolygon:k0,randomLineString:U0,getCluster:q0,clusterEach:Tp,clusterReduce:H0,createBins:Ip,applyFilter:Qc,propertiesContainsFilter:Lp,filterProperties:W0,earthRadius:_r,factors:Bc,unitsFactors:Py,areaFactors:vc,feature:nr,geometry:My,point:gt,points:Ay,polygon:ze,polygons:Dy,lineString:Pt,lineStrings:Ry,featureCollection:ge,multiLineString:Ra,multiPoint:Vc,multiPolygon:Eu,geometryCollection:Jm,round:Oy,radiansToLength:Jo,lengthToRadians:eo,lengthToDegrees:_c,bearingToAzimuth:va,radiansToDegrees:Ea,degreesToRadians:dr,convertLength:to,convertArea:Ny,isNumber:bt,isObject:fe,validateBBox:bu,validateId:zc,getCoord:Vt,getCoords:le,containsNumber:Uc,geojsonType:Vy,featureOf:wf,collectionOf:Qi,getGeom:Tn,getGeomType:zy,getType:Mt,coordEach:mr,coordReduce:kc,propEach:$m,propReduce:Fy,featureEach:wt,featureReduce:ep,coordAll:ls,geomEach:Mi,geomReduce:tp,flattenEach:Jt,flattenReduce:By,segmentEach:Ns,segmentReduce:rp,lineEach:np,lineReduce:ip};function oi(e){Re._maximumCombinedTextureImageUnits=Cesium.ContextLimits._maximumCombinedTextureImageUnits,Re._maximumCubeMapSize=Cesium.ContextLimits._maximumCubeMapSize,Re._maximumFragmentUniformVectors=Cesium.ContextLimits._maximumFragmentUniformVectors,Re._maximumTextureImageUnits=Cesium.ContextLimits._maximumTextureImageUnits,Re._maximumRenderbufferSize=Cesium.ContextLimits._maximumRenderbufferSize,Re._maximumTextureSize=Cesium.ContextLimits._maximumTextureSize,Re._maximumVertexAttributes=Cesium.ContextLimits._maximumVertexAttributes,Re._maximumVertexTextureImageUnits=Cesium.ContextLimits._maximumVertexTextureImageUnits,Re._maximumVertexUniformVectors=Cesium.ContextLimits._maximumVertexUniformVectors,Re._minimumAliasedLineWidth=Cesium.ContextLimits._minimumAliasedLineWidth,Re._maximumAliasedLineWidth=Cesium.ContextLimits._maximumAliasedLineWidth,Re._minimumAliasedPointSize=Cesium.ContextLimits._minimumAliasedPointSize,Re._maximumAliasedPointSize=Cesium.ContextLimits._maximumAliasedPointSize,Re._maximumViewportWidth=Cesium.ContextLimits._maximumViewportWidth,Re._maximumViewportHeight=Cesium.ContextLimits._maximumViewportHeight,Re._highpFloatSupported=Cesium.ContextLimits._highpFloatSupported,Re._highpIntSupported=Cesium.ContextLimits._highpIntSupported,Re._maximumTextureFilterAnisotropy=Cesium.ContextLimits._maximumTextureFilterAnisotropy,Re._maximumDrawBuffers=Cesium.ContextLimits._maximumDrawBuffers,Re._maximumColorAttachments=Cesium.ContextLimits._maximumColorAttachments,this._scene=e,this._primitives=e._primitives,this._e3ms=new Cesium.AssociativeArray,this.layerAddedEvent=new Cesium.Event,this.layerRemovedEvent=new Cesium.Event,this.layerMovedEvent=new Cesium.Event,this.layerShownOrHiddenEvent=new Cesium.Event,this.selectionChanged=new Cesium.Event,this.featureSelectionChanged=new Cesium.Event,this._selectedFeature=void 0,this._scene.logarithmicDepthBuffer=!0,this._scene.postProcessStages._fxaa.enabled=!0,this._scene._context._gl.getExtension("EXT_shader_texture_lod");var t=this._scene._context._gl.getExtension("OES_texture_float");t?window.NO_support_OES_float=!1:window.NO_support_OES_float=!0}Object.defineProperties(oi.prototype,{scene:{get:function(){return this._scene}},selectedFeature:{get:function(){return this._selectedFeature},set:function(e){this._selectedFeature!==e&&(this._selectedFeature=e,this.featureSelectionChanged.raiseEvent(this._selectedFeature))}}});oi.prototype.add=function(e){var t=xF(this,e);return Cesium.defined(t.scene)||(t.scene=this._scene),t};oi.prototype.remove=function(e){if(e instanceof Uo){var t=e;return Ux(this,t)}return Gx(this,e)};oi.prototype.removeAll=function(){var e=Eo(this);if(!e)return!1;for(var t=e.values;t.length>0;){var r=t[0],n=Ux(this,r);if(!n)return!1}return!0};oi.prototype.get=function(e){if(!Cesium.defined(e))throw new Cesium.DeveloperError("name is required.");var t=Eo(this);if(!Cesium.defined(t))throw new Cesium.DeveloperError("name is error");var r;if(typeof e=="string"){if(t.contains(e))return r=t.get(e),Array.isArray(r._name)?r._cesiumLayer.getLayer(e):r}else if(typeof e=="number"){var n=e,i=t.values;return r=i[n],Array.isArray(r._name)?r._cesiumLayer.getLayer(e):r}return null};oi.prototype.getLayerCount=function(){return this._e3ms.length};oi.prototype.isLayerExits=function(e){var t=Eo(this);return t?t.contains(e):!1};oi.prototype.getLayerCollection=function(){var e=Eo(this);return e};oi.prototype.getE3mLayer=function(e){return EF(this,e)};function Ux(e,t){return!Cesium.defined(t)||!Cesium.defined(t.name)||!Cesium.defined(t.url)?(console.warn("please check layer content. name and url is required!"),!1):Gx(e,t.name)}function Gx(e,t){var r=e._e3ms.get(t),n=r.getCesiumLayer();return e._scene._primitives.remove(n),e._e3ms.remove(t),r&&e.layerRemovedEvent.raiseEvent(r),r}function Eo(e){return e._e3ms}function yF(e,t){var r=Eo(e);return r.contains(t)?r.get(t):null}function xF(e,t){var r=t.name;if(!Cesium.defined(r))throw new Cesium.DeveloperError("name is required");var n=t.url;if(!Cesium.defined(n))throw new Cesium.DeveloperError("url is required");if(typeof r=="string"){if(Cesium.defined(yF(e,r)))throw new Cesium.DeveloperError(r+"already exists")}else throw new Cesium.DeveloperError("name is required to be a string");var i=new Uo(t);e._primitives.add(i.getCesiumLayer());var s=i.layerShownOrHidden._listeners;s.length===0&&i.layerShownOrHidden.addEventListener(function(o,u,f){bF(e,o,u,f)}),s=i.selectionChanged._listeners,s.length===0&&i.selectionChanged.addEventListener(function(o,u){wF(e,o,u)});var a=Eo(e);return a.set(r,i),e.layerAddedEvent.raiseEvent(i),i}function EF(e,t){for(var r=Eo(e),n=r.values,i=0;i<n.length;i++){var s=n[i];if(s.getCesiumLayer()===t)return s}return t}function bF(e,t,r,n){var i=t;e.layerShownOrHiddenEvent.raiseEvent(i,n)}function wF(e,t,r){e.selectionChanged.raiseEvent(t,r)}oi.prototype.getNearestTileProperty=function(e){var t=this.scene.camera,r=t.position.clone(),n=t.direction.clone(),i=Cesium.Cartesian3.multiplyByScalar(n,5,new Cesium.Cartesian3);Cesium.Cartesian3.add(r,i,r);for(var s=this._e3ms,a=s.values,o=[],u=0;u<a.length;u++){var f=a[u],l=f.getCesiumLayer();if(!(!Cesium.defined(l.flowLines)||!l.show))for(var c=l.selectedTiles,h=0;h<c.length;h++){var d=c[h],m=d.boundingSphere.center,g=Cesium.Cartesian3.distance(r,m);if(g<d.boundingSphere.radius+e)if(Cesium.defined(d.content._contents)){for(var p=d.content._contents,v=0;v<p.length;v++)if(Cesium.defined(p[v].flowLines))for(var _=0;_<p[v].flowLines.length;_++){var y=p[v].flowLines[_],x=Vx(y[0],y[1],r);if(x.distance<e&&zx(x.point,t.frustum._offCenterFrustum._cullingVolume)){var E={};for(var S in p[v].batchTable._properties)E[S]=p[v].batchTable._properties[S][_];E.result=x,o.push(E)}}}else{var I=d.content;if(Cesium.defined(I.flowLines))for(var _=0;_<I.flowLines.length;_++){var y=I.flowLines[_],x=Vx(y[0],y[1],r);if(x.distance<e&&zx(x.point,t.frustum._offCenterFrustum._cullingVolume)){var E={};for(var S in I.batchTable._properties)E[S]=I.batchTable._properties[S][_];E.result=x,o.push(E)}}}}}return o};function Vx(e,t,r){var n={},i=Cesium.Cartesian3.subtract(t,e,new Cesium.Cartesian3),s=Cesium.Cartesian3.subtract(r,e,new Cesium.Cartesian3),a=Cesium.Cartesian3.normalize(i,new Cesium.Cartesian3),o=Cesium.Cartesian3.normalize(s,new Cesium.Cartesian3),u=Cesium.Cartesian3.dot(a,o);if(u<=0)return n.distance=Cesium.Cartesian3.distance(r,e,new Cesium.Cartesian3),n.point=e,n;var f=Cesium.Cartesian3.subtract(e,t,new Cesium.Cartesian3),l=Cesium.Cartesian3.subtract(r,t,new Cesium.Cartesian3),c=Cesium.Cartesian3.normalize(f,new Cesium.Cartesian3),h=Cesium.Cartesian3.normalize(l,new Cesium.Cartesian3),d=Cesium.Cartesian3.dot(c,h);if(d<=0)return n.distance=Cesium.Cartesian3.distance(r,t),n.point=t,n;var m=Math.sqrt(1-u*u),g=Cesium.Cartesian3.distance(r,e),p=new Cesium.Cartesian3;return Cesium.Cartesian3.multiplyByScalar(a,g*u,p),Cesium.Cartesian3.add(e,p,p),n.distance=g*m,n.point=p,n}function zx(e,t){for(var r=t.planes,n=!1,i=new Cesium.Plane(new Cesium.Cartesian3(1,0,0),0),s=0,a=r.length;s<a;++s){var o=Cesium.Plane.fromCartesian4(r[s],i),u=e,f=o.normal,l=Cesium.Cartesian3.dot(f,u)+o.distance;if(l<=0)return!1;n=!0}return n}oi.prototype.getNearestTileCentreLine=function(){for(var e=this.scene.camera,t=e.position,r=this._e3ms,n=r.values,i=[],s=0;s<n.length;s++){var a=n[s],o=a.getCesiumLayer();if(!(!Cesium.defined(o.flowLines)||!o.show))for(var u=o.selectedTiles,f=0;f<u.length;f++){var l=u[f],c=l.boundingSphere.center,h=Cesium.Cartesian3.distance(t,c);if(h<l.boundingSphere.radius)if(Cesium.defined(l.content._contents)){for(var d=l.content._contents,m=0;m<d.length;m++)if(Cesium.defined(d[m].centreLine)){i.push(d[m].centreLine);break}}else Cesium.defined(l.content.centreLine)&&i.push(l.content.centreLine)}}return i};oi.prototype.queryTile=function(e){for(var t=this._e3ms,r=t.values,n=[],i=0;i<r.length;i++){var s=r[i],a=s.getCesiumLayer();if(!(!Cesium.defined(a.flowLines)||!a.show))for(var o=a.selectedTiles,u=0;u<o.length;u++){var f=o[u];if(SF(e,f.boundingSphere)){var l={};if(l.dataSet=s.customTag.name,Cesium.defined(f.content._contents)){l.content={};for(var c=f.content._contents,h=0;h<c.length;h++)if(c[h].centreLine){var d=kx(e,c[h].centreLine);if(d.length>0){for(var m=0;m<d.length;m++){var g=d[m].index;for(var p in c[h].batchTable._properties)l.content[p]=c[h].batchTable._properties[p][g]}n.push(l)}}}else{if(!f.content.centreLine)continue;var d=kx(e,f.content.centreLine);if(d.length>0){l.content={};for(var m=0;m<d.length;m++){var g=d[m].index;for(var p in f.content.batchTable._properties)l.content[p]=f.content.batchTable._properties[p][g]}n.push(l)}}}}}return n};function SF(e,t){for(var r=t.center,n=Cesium.Cartographic.fromCartesian(r),i=Cesium.Cartographic.fromCartesian(e[0]).height,s=Cesium.Cartesian3.fromRadians(n.longitude,n.latitude,i),a=0;a<e.length;a++){var o=e[a],u=Cesium.Cartesian3.distance(o,s);if(u<t.radius)return!0}return!1}function kx(e,t){for(var r=[],n=[],i=0;i<e.length;i++){var s=Cesium.Cartographic.fromCartesian(e[i]),a=Ji.radiansToDegrees(s.longitude),o=Ji.radiansToDegrees(s.latitude);n.push([a,o])}var s=Cesium.Cartographic.fromCartesian(e[0]),a=Ji.radiansToDegrees(s.longitude),o=Ji.radiansToDegrees(s.latitude);n.push([a,o]);for(var u=Ji.polygon([n]),i=0;i<t.length;i++){for(var f=t[i],l=[],c=0;c<f.length;c+=3){var a=Ji.radiansToDegrees(f[c]),o=Ji.radiansToDegrees(f[c+1]);l.push([a,o])}var h=Ji.lineString(l),d=Ji.lineIntersect(u,h);d.features.length>0&&r.push({index:i,intersects:d})}return r}var TF=oi;function Es(e,t){this._viewer=e,this._evLayerManager=t,this._eventHandler=new Cesium.ScreenSpaceEventHandler(e.canvas),this._selectedFeature=void 0,this._selectedColor=Cesium.Color.LIME,this.eventTypes=[],this._silhouetteStage=void 0,this._edgeDetectionStage=void 0}Object.defineProperties(Es.prototype,{selectedColor:{get:function(){return this._selectedColor},set:function(e){e instanceof Cesium.Color&&(this._selectedColor=e)}}});Es.prototype.start=function(){IF(this)};Es.prototype.stop=function(){LF(this)};var ui=[],lh=void 0,ch=[];Es.prototype.startSelected=function(e,t){Cesium.defined(t)||(t=Cesium.ScreenSpaceEventType.LEFT_CLICK),this.eventTypes.indexOf(t)===-1&&this.eventTypes.push(t);var r=this,n=this._viewer,i=function(a){var o;Cesium.defined(a.endPosition)?o=a.endPosition:o=a.position;var u=n.scene.pick(o);if(!Cesium.defined(u)){r.clear();return}var f=r._evLayerManager;if(u instanceof Rn){if(u._content.pointCloud3DTileContent){r.clear();return}var l=u.tileset,c=f.getE3mLayer(l);if(qx(l),e===0){u.primitive.colorBlendMode=Cesium.ColorBlendMode.HIGHLIGHT;var h=u.getProperty("phaseType"),d=u.getProperty("id");if(Cesium.defined(h)&&Cesium.defined(d)){var m=r._selectedColor.toCssColorString(),g='${phaseType} === "'+h+'" && ${id} ==='+d,p=[],v=[],_=[];p.push(g),p.push(m),_.push("true"),_.push("color('white')"),v.push(p),v.push(_),Cesium.defined(l.style)?(l.style.color={conditions:v},l._styleEngine._styleDirty=!0):l.style=new hr({color:{conditions:v}})}else{var y=u.getProperty("EVID");if(Cesium.defined(y)){var x=[];x.push(y),c.setFeaturesColor("EVID",x,r._selectedColor)}else{var E=u.getPropertyNames();E.indexOf("name")!=-1&&E.indexOf("id")!=-1&&E.splice(E.indexOf("name"),1);for(var S=[],I=u.content._features.length,P=0;P<I;P++){var w=u._content.batchTable.getProperty(P,E[0]);S.indexOf(w)===-1&&S.push(w)}c.setFeaturesColor(E[0],S,r._selectedColor)}}}else if(e===1){u.content instanceof Qu&&(u.primitive.colorBlendMode=Cesium.ColorBlendMode.REPLACE);var E=u.getPropertyNames();E.indexOf("name")!=-1&&E.indexOf("id")!=-1&&E.splice(E.indexOf("name"),1);for(var g="",P=0;P<E.length;P++){var w=u.getProperty(E[P]);typeof w=="number"?g+="${"+E[P]+"} ==="+w+" && ":typeof w=="string"&&(g+="${"+E[P]+'} ==="'+w+'" && ')}g=g.substr(0,g.length-4);var m=r._selectedColor.toCssColorString(),p=[],v=[],_=[];p.push(g),p.push(m),_.push("true"),_.push("color('white')"),v.push(p),v.push(_),Cesium.defined(l.style)?(l.style.color={conditions:v},l._styleEngine._styleDirty=!0):l.style=new hr({color:{conditions:v}})}else if(e===2){if(Cesium.PostProcessStageLibrary.isSilhouetteSupported(n.scene)){Cesium.defined(r._silhouetteStage)||(r._edgeDetectionStage=Cesium.PostProcessStageLibrary.createEdgeDetectionStage(),r._edgeDetectionStage.uniforms.color=r._selectedColor,r._edgeDetectionStage.uniforms.length=.01,r._edgeDetectionStage.selected=[]),Cesium.defined(r._silhouetteStage)||(r._silhouetteStage=Cesium.PostProcessStageLibrary.createSilhouetteStage([r._edgeDetectionStage]),n.scene.postProcessStages.add(r._silhouetteStage));var N=r._edgeDetectionStage.selected[0];u===N&&(r._edgeDetectionStage.selected=[]),r._edgeDetectionStage.selected=[u]}}else if(e===3){if(Cesium.PostProcessStageLibrary.isSilhouetteSupported(n.scene)){Cesium.defined(r._silhouetteStage)||(r._edgeDetectionStage=Cesium.PostProcessStageLibrary.createModelFeatureDetectionStage(n),r._edgeDetectionStage.uniforms.color=r._selectedColor,r._edgeDetectionStage.uniforms.outlineWidth=5,r._edgeDetectionStage.edgeWidth=20,r._edgeDetectionStage.uniforms.useAnimation=!1,r._edgeDetectionStage.uniforms.length=.01,r._edgeDetectionStage.selected=[]),Cesium.defined(r._silhouetteStage)||(r._silhouetteStage=Cesium.PostProcessStageLibrary.createSilhouetteStage([r._edgeDetectionStage]),n.scene.postProcessStages.add(r._silhouetteStage));var N=r._edgeDetectionStage.selected[0];u===N&&(r._edgeDetectionStage.selected=[]),r._edgeDetectionStage.selected=[u]}r._eventHandler.setInputAction(function(C){var b=n.scene.pickPosition(o);if(Cesium.defined(b)){var T=Cesium.Cartesian3.add(b,new Cesium.Cartesian3(5,0,0),new Cesium.Cartesian3),A=Cesium.SceneTransforms.wgs84ToWindowCoordinates(n.scene,b,new Cesium.Cartesian2),R=Cesium.SceneTransforms.wgs84ToWindowCoordinates(n.scene,T,new Cesium.Cartesian2),F=Cesium.Cartesian2.distance(A,R);r._edgeDetectionStage.uniforms.outlineWidth=F}},Cesium.ScreenSpaceEventType.WHEEL)}c.selectedFeature=u,f.selectedFeature=u}else if(Cesium.defined(u.primitive)&&Cesium.defined(u.primitive.crossid)){var B=u.primitive.owner,c=f._crossDataSources.get(B);Cesium.defined(lh)&&f._crossDataSources.get(lh.owner).setSelectedColor(lh.crossid,Cesium.Color.WHITE),c.setSelectedColor(u.primitive.crossid,r._selectedColor),f.selectedFeature=u.primitive,lh=u.primitive}else r.clear()};if(r._eventHandler.setInputAction(i,t),e===1){var s=function(a){var o;Cesium.defined(a.endPosition)?o=a.endPosition:o=a.position;var u=n.scene.pick(o);if(!Cesium.defined(u)){r.clear();return}var f=r._evLayerManager;if(u instanceof Rn){var l=u.tileset,c=f.getE3mLayer(l);if(qx(l),e===1){var h=u.getPropertyNames();h.indexOf("name")!=-1&&h.indexOf("id")!=-1&&h.splice(h.indexOf("name"),1);for(var d="",m=0;m<h.length;m++){var g=u.getProperty(h[m]);typeof g=="number"?d+="${"+h[m]+"} ==="+g+" && ":typeof g=="string"&&(d+="${"+h[m]+'} ==="'+g+'" && ')}d=d.substr(0,d.length-4);var p=r._selectedColor.toCssColorString(),v=[],_=[],y=[];v.push(d),v.push(p),ch.indexOf(v)===-1&&ch.push(v),y.push("true"),y.push("color('white')");for(var x=0;x<ch.length;x++)_.push(ch[x]);_.push(y),Cesium.defined(l.style)?(l.style.color={conditions:_},l._styleEngine._styleDirty=!0):l.style=new hr({color:{conditions:_}})}c.selectedFeature=u,f.selectedFeature=u}};r._eventHandler.setInputAction(s,Cesium.ScreenSpaceEventType.LEFT_CLICK,Cesium.KeyboardEventModifier.CTRL)}};Es.prototype.clear=function(){for(var e=0;e<ui.length;e++)Cesium.defined(ui[e].style)&&ui[e].style.color&&(ui[e].style.color=void 0,ui[e]._styleEngine._styleDirty=!0);ui=[];var t=this._viewer;Cesium.defined(this._silhouetteStage)&&(this._edgeDetectionStage.selected=[]),Cesium.defined(this._silhouetteStage)&&(t.scene.postProcessStages.remove(this._silhouetteStage),this._edgeDetectionStage=void 0,this._silhouetteStage=void 0),Cesium.defined(this._edgeDetectionStage)&&(this._edgeDetectionStage.selected=[],t.scene.postProcessStages.remove(this._edgeDetectionStage),this._edgeDetectionStage=void 0)};Es.prototype.stopSelected=function(){for(var e=this,t=0;t<e.eventTypes.length;t++)e._eventHandler.removeInputAction(e.eventTypes[t]);e.eventTypes=[];var r=e._viewer;Cesium.defined(e._silhouetteStage)&&(e._edgeDetectionStage.selected=[]),Cesium.defined(e._silhouetteStage)&&(r.scene.postProcessStages.remove(e._silhouetteStage),e._edgeDetectionStage=void 0,e._silhouetteStage=void 0);var n=this._evLayerManager;n._selectedFeature=void 0};Es.prototype.getPropertyNames=function(e){var t=this;t._eventHandler.setInputAction(function(r){var n=r.position,i,s=viewer.scene.pick(n);return Cesium.defined(s)&&s instanceof Rn?e(s.getPropertyNames()):e(void 0)},Cesium.ScreenSpaceEventType.LEFT_CLICK)};function IF(e){e._eventHandler.setInputAction(function(t){var r=e._viewer,n=t.position;e._actionType===Cesium.ScreenSpaceEventType.MOUSE_MOVE&&(n=t.endPosition);var i=r.scene.pick(n);if(!Cesium.defined(i)){for(var s=e._evLayerManager._e3ms._array,a=0;a<s.length;a++){var o=s[a];o.clearSelection(),e._selectedFeature=void 0}return}e._selectedFeature=i;var u=e._evLayerManager;if(i instanceof Rn||i.cesium3DTileFeature){var f=i.getProperty("name");if(f){var l=i.tileset,o=u.getE3mLayer(l);o&&o.setSelectedComponentName&&f!==o.getSelectedComponentName()&&(o.setSelectedComponentName(f),o.selectedFeature=i)}}else u.selectionChanged.raiseEvent(o,i.name)},Cesium.ScreenSpaceEventType.LEFT_CLICK)}function qx(e){ui.indexOf(e)===-1&&ui.push(e);for(var t=0;t<ui.length;t++)Cesium.defined(ui[t].style)&&ui[t].style.color&&(ui[t].style.color=void 0,ui[t]._styleEngine._styleDirty=!0)}function LF(e){e._eventHandler.removeInputAction(Cesium.ScreenSpaceEventType.LEFT_CLICK),e._selectedFeature=void 0}Es.prototype.startMoveModelFeature=function(){PF(this)};Es.prototype.stopMoveModelFeature=function(){MF(this)};function PF(e){let t=!1,r=null,n=null,i=null,s=e._viewer,a=e._evLayerManager;e._eventHandler.setInputAction(function(o){if(r=s.scene.pick(o.position),Cesium.defined(r)&&r.cesium3DTileFeature){let u=r.content.tileset;a.getE3mLayer(u).setSelectedComponentName(r.getProperty("name"));let l=Cesium.Matrix4.unpack(r.content.tile.computedTransform);Cesium.Matrix4.multiplyTransformation(l,Cesium.Axis.Y_UP_TO_Z_UP,l),i=Cesium.Matrix4.inverse(l,new Cesium.Matrix4),r.translation=Cesium.Matrix4.multiplyByPoint(i,r.center,new Cesium.Matrix4),n=s.scene.globe.pick(s.camera.getPickRay(o.position),s.scene),s.scene.screenSpaceCameraController.enableRotate=!1,t=!0}},Cesium.ScreenSpaceEventType.LEFT_DOWN),e._eventHandler.setInputAction(function(o){if(t&&Cesium.defined(r)&&r.cesium3DTileFeature){let u=o.endPosition,f=s.scene.globe.pick(s.camera.getPickRay(u),s.scene),l=Cesium.Matrix4.multiplyByPoint(i,f,new Cesium.Matrix4),c=Cesium.Matrix4.multiplyByPoint(i,n,new Cesium.Matrix4),h=Cesium.Cartesian3.subtract(l,r.translation,new Cesium.Cartesian3);r.setTranslation(h)}},Cesium.ScreenSpaceEventType.MOUSE_MOVE),e._eventHandler.setInputAction(function(){t&&Cesium.defined(r)&&r.cesium3DTileFeature,t=!1,i=null,s.scene.screenSpaceCameraController.enableRotate=!0},Cesium.ScreenSpaceEventType.LEFT_UP)}function MF(e){e._eventHandler.removeInputAction(Cesium.ScreenSpaceEventType.LEFT_DOWN)}var AF=Es;globalThis.CESIUM_VERSION="1.105.2";export{aa as Batched3DModel3DTileContent,Xa as Cesium3DTile,zr as Cesium3DTileBatchTable,fa as Cesium3DTileContentFactory,Rn as Cesium3DTileFeature,ws as Cesium3DTileFeatureTable,ha as Cesium3DTilePass,Md as Cesium3DTilePointFeature,hr as Cesium3DTileStyle,Qd as Cesium3DTileset,ca as Cesium3DTilesetTraversal,$x as CesiumExternalMixin,Wu as Composite3DTileContent,ea as CompressedTextureBuffer,rm as ConditionsExpression,es as DracoLoader,Oh as EV_E3MInternalInstance,Uo as EV_E3MLayer,TF as EV_E3mLayerManager,Ts as EV_IndexDBHandler,Xt as EV_IndexDBType,Fa as EV_LayerType,AF as EV_SelectorEventHandler,_h as EarthViewTerrainProvider,pa as Expression,zu as Instanced3DModel3DTileContent,GP as LayerManager,No as Model,Xh as ModelInstance,Kh as ModelInstanceCollection,Nh as ModelLoadResources,zh as ModelMaterial,kh as ModelMesh,Sl as ModelOutlineLoader,ee as ModelUtility,gd as PointCloud,vd as PointCloud3DTileContent,Gd as PointCloudEyeDomeLighting,kd as PointCloudEyeDomeLightingShader,vh as TerrainLayer,ph as TerrainLayerCollection,Ir as Texture,_d as Tileset3DTileContent,Qu as Vector3DTileContent,Dd as Vector3DTilePoints,Hh as addDefaults,Ba as arrayFill,xn as arraySlice,Ch as createTerrainProvider,ka as hasExtension,Va as loadCRN,za as loadKTX,Bd as measureText,Fh as processModelMaterialsCommon,Vh as processPbrMaterials,Ji as turf,Yh as updateVersion,Ne as when};
